(globalThis.webpackChunkgraphic=globalThis.webpackChunkgraphic||[]).push([[528],{24191:(e,t,i)=>{"use strict";i.d(t,{$$:()=>ei,g1:()=>Qe,ff:()=>h,RA:()=>Zt,uo:()=>z,fM:()=>Xt,YA:()=>Ke,vu:()=>Ze,q3:()=>qe,Mn:()=>ht,cX:()=>f,uN:()=>Le,$R:()=>s,zh:()=>n.q$,xZ:()=>V,hm:()=>W,cJ:()=>ft,jg:()=>pt,cY:()=>p,xv:()=>me,zL:()=>oe,vz:()=>ie,p4:()=>N});class r{setAxiosInstances(e){this.axiosInstances=e}}var n=i(8757),a=i(67986);const o="custom-host-name-type",s="need-x-lvweb-idc-header";var l=i(62347),c=i(18398),d=i.n(c);class u{constructor(){this._interceptors=[],this._baseInterceptors=[u.commonInterceptor]}static get apiSetting(){return u._apiSetting}static setApiSetting(e){u._apiSetting=e,u.commonInterceptor.updateApiSetting(e)}addInterceptor(e){return Array.isArray(e)?this._interceptors.push(...e):this._interceptors.push(e),this}setDefaultConfig(e){return this._defaultConfig=null!=e?e:{},this}useJsonBigTransformResponse(){var e,t;return this._defaultConfig={...this._defaultConfig,transformResponse:[...Array.isArray(null===(e=this._defaultConfig)||void 0===e?void 0:e.transformResponse)?null===(t=this._defaultConfig)||void 0===t?void 0:t.transformResponse:[],e=>{try{return d().parse(e)}catch(t){return{data:e}}}]},this}build(){const e=l.default.create(this._defaultConfig);return this._applyInterceptors(e),e}_applyInterceptors(e){const t=[...this._interceptors,...this._baseInterceptors];for(const i of t)i.axiosInstances=e,i.request&&e.interceptors.request.use(i.request.onFulfilled,i.request.onRejected,i.request.options),i.response&&e.interceptors.response.use(i.response.onFulfilled,i.response.onRejected,i.response.options)}}u.commonInterceptor=new class extends r{constructor(){super(...arguments),this.request={onFulfilled:async e=>{var t,i;const r=Boolean(null===(t=e.baseURL)||void 0===t?void 0:t.startsWith("https")),l=e[o]||n.b_.Default,c=null===(i=e[s])||void 0===i||i;if(!r){let t=!1;setTimeout((()=>{t||a.t.error(`current request${e.url} is blocking by route. Please check`)}),2e3);const i=await this._setting.getRequestDomain({type:l});t=!0,e.baseURL=i}const d={...e.headers,loc:await this._setting.getUserRegion(),"x-lvweb-idc":this._setting.userIDC};return c||delete d["x-lvweb-idc"],Object.assign(e,{headers:d,withCredentials:!0}),e}}}updateApiSetting(e){this._setting=e}};const h=u;var p,f;!function(e){e[e.Video=1]="Video",e[e.Image=2]="Image"}(p||(p={})),function(e){e[e.Ever=1]="Ever",e[e.ImageX=2]="ImageX",e[e.CommonURL=4]="CommonURL"}(f||(f={}));class y extends r{constructor(){super(...arguments),this.response={onFulfilled:e=>{if(200!==e.status)return Promise.reject(e);const{data:t}=e;return"0"!==t.ret?Promise.reject(t):t.data}}}}const g="5.8.0",m="13.6.0",_="feed",v={GetCategories:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/get_collections"},GetTemplatesAccordCategory:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/get_collection_templates"},GetRecentList:{hostNameType:n.b_.Default,url:"/lv/v1/editor/template/recent_list"},ReportRecently:{hostNameType:n.b_.Default,url:"/lv/v1/editor/use_report"},GetTemplateDetail:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/get_template_detail"},GetTemplateHotWords:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/replicate/get_search_words"},SearchTemplates:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/replicate/search_templates"},GetAllTemplateRatio:{HostNameType:n.b_.Default,url:"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_49/bee_prod_49_bee_publish_709.json"},GetBatchCategories:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/get_categories"},GetBatchTemplatesByCategory:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/batch_get_collection_templates"},GetPresets:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/get_collection_presets"},GetPresetDetail:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/preset_template_detail"},PostDeletePresetsTemplate:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/del_presets_template"},FuzzySearchTemplateByTitle:{hostNameType:n.b_.Default,url:"/lv/v1/cc_web/plane/fuzzy_search_templates"}};var I=i(98498),T=i.n(I);function w({url:e,pf:t,appvr:i,tdid:r}){const n=Math.floor(Date.now()/1e3);return{sign:T()(`9e2c|${e.slice(-7)}|${t}|${i}|${n}|${r}|11ac`).toLowerCase(),"device-time":n}}class E extends r{constructor(){super(...arguments),this.request={onFulfilled:e=>{var t;const i={...w({url:null!==(t=e.url)&&void 0!==t?t:"",pf:"7",appvr:g,tdid:""}),"sign-ver":1,pf:"7",appvr:g};return Object.assign(e,{headers:{...e.headers,...i}}),e}}}}var x,b,R=i(27175);const k="browser",A=String.fromCharCode(99),P=`https://capcut-web-va.${`by${String.fromCharCode(116)}edan${A}e.net`}`,M=null!==(x=null===(b=i.g.location)||void 0===b?void 0:b.host.startsWith("capcut-os."))&&void 0!==x&&x,L={SaveDraftUrl:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane_draft/save"},GetDraftUrl:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane_draft/get_draft_detail"},SyncDraftOpenTime:{hostNameType:n.b_.Default,url:"/cc/v1/workspace/sync_file_open_time"},SyncSaveToken:{hostNameType:n.b_.Default,url:"/lv/v1/editor/draft/get_version_list"},PublishAsTemplate:{hostNameType:n.b_.Default,url:`${M?P:"https://edit-api-va.capcut.com"}/lv/v1/editor/template/add`},CheckPublishTemplatePermission:{hostNameType:n.b_.Default,url:"/lv/v1/editor/template/check_post_permission"},DraftOpenReport:{hostNameType:n.b_.Default,url:"/lv/v1/event/report"},GetTemplateFile:{hostNameType:n.b_.Default,url:"/lv/v1/editor/draft/get_template_file"}};i(75302);const S=Symbol("reflect_metadata_api:name");function C(e){return function(t,i,r){if(!r.value)return;const n=null!=e?e:i.toString();return Reflect.defineMetadata(S,n,t,i.toString()),r}}class O{constructor(){this._apiMethodMap=new Map}static getInstance(){return O._instance||(O._instance=new O),O._instance}registerApi(e){const t=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(t).filter((e=>"function"==typeof t[e]&&"constructor"!==e)).map((e=>[e,Reflect.getMetadata(S,t,e)])).filter((e=>Boolean(e[1])));for(const[r,n]of i){const i=t[r];this._apiMethodMap.set(n,{name:r,method:i.bind(e)})}}getApiMethod(e){const t=this._apiMethodMap.get(e);return null==t?void 0:t.method}}var F=i(68967);function N(e){let t,i=e.preview_url.bucket_key_1080p;return e.image_transcode_info&&(t={},Object.keys(e.image_transcode_info).forEach((r=>{if(!e.image_transcode_info[r])return;const{preview_url:n,width:a,height:o}=e.image_transcode_info[r];n&&a&&o&&!(0,F.jv)(n)&&(r.includes("origin")?i=n:t[`${a}x${o}`]={width:a,height:o,full_url:n,aesKey:e.preview_key})}))),{assetId:e.asset_id,sourcePath:e.source_path,aesKey:e.preview_key,originUrl:i,transcode:t,md5:e.md5,size:e.size}}const D="custom-axios-retry";function U(e){const t=(null==e?void 0:e[D])||{};return t.retryCount=t.retryCount||0,t}class B extends r{constructor(e){super(),this.request={onFulfilled:e=>{const t=U(e);return t.lastRequestTime=Date.now(),e[D]=t,e}},this.response={onRejected:e=>{const{config:t}=e;if(!t)return Promise.reject(e);const{retries:i=1,isRetry:r=(()=>!0),retryDelay:n=200,resetTimeout:a=!0}={...this._retryOptions,...null==t?void 0:t[D]},o=U(t);if((r(t.url,e)||Boolean(o.canRetry))&&o.retryCount<i){o.retryCount+=1;const i="number"==typeof n?n:n(o.retryCount,e);if(function(e,t){e.defaults.agent===t.agent&&delete t.agent,e.defaults.httpAgent===t.httpAgent&&delete t.httpAgent,e.defaults.httpsAgent===t.httpsAgent&&delete t.httpsAgent}(this.axiosInstances,t),!a&&t.timeout&&o.lastRequestTime){const e=Date.now()-o.lastRequestTime;t.timeout=Math.max(t.timeout-e-i,1)}return t.transformRequest=[e=>e],new Promise((e=>setTimeout((()=>e(this.axiosInstances(t))),i)))}return Promise.reject(e)}},this._retryOptions=e}}const G="999.999.999",j="14.7.0",H={method:"POST",headers:{"Content-Type":"application/json","app-sdk-version":G}};var W,z,V,$;!function(e){e.SaleDesign="sales-design",e.SalesSticker="sales-sticker",e.SalesFont="fonts",e.SalesTextTemplate="sales-text-template",e.Svg="svg",e.SalesFrame="sales-frame",e.SalesFilter="sales-filter",e.SalesImageEffect="sales-image-effect",e.YkImage="yk-image",e.AIBackground="ai_background",e.SalesTextPreset="sales-text-preset",e.SalesTextGlow="sales-text-glow",e.SalesGrid="sales-grid"}(W||(W={})),function(e){e.CNSalesSticker="cn-sales-sticker",e.CNSalesFont="cn-fonts",e.CNSalesTextTemplate="cn-sales-text-template"}(z||(z={})),function(e){e.All="all",e.PanelFont="hot",e.PanelFontRecommend="font_recommended",e.PanelFontStyle="style",e.PanelStickers="panel-stickers",e.PanelTextTemplate="hot",e.PanelStickerAlbum="panel-albums",e.PanelFrames="frames_single",e.PanelFrameAlbum="frames_packs",e.PanelNormalEffect="normal",e.PanelEffectPostProcess="post-process"}(V||(V={})),function(e){e.EnterFrom="image_editor"}($||($={}));const Y={ReportRecently:{hostNameType:n.b_.Default,url:"/lv/v1/editor/use_report"}},X="5.8.0";var J,K,q,Z=i(34075),Q=i.n(Z);!function(e){e[e.MetaTypeNone=0]="MetaTypeNone",e[e.MetaTypeVideo=1]="MetaTypeVideo",e[e.MetaTypePhoto=2]="MetaTypePhoto",e[e.MetaTypeGif=3]="MetaTypeGif",e[e.MetaTypeMusic=4]="MetaTypeMusic",e[e.MetaTypeExtractMusic=5]="MetaTypeExtractMusic",e[e.MetaTypeSound=6]="MetaTypeSound",e[e.MetaTypeRecord=7]="MetaTypeRecord",e[e.MetaTypeImage=8]="MetaTypeImage",e[e.MetaTypeText=9]="MetaTypeText",e[e.MetaTypeSubtitle=10]="MetaTypeSubtitle",e[e.MetaTypeLyrics=11]="MetaTypeLyrics",e[e.MetaTypeSticker=12]="MetaTypeSticker",e[e.MetaTypeFilter=13]="MetaTypeFilter",e[e.MetaTypeLUT=14]="MetaTypeLUT",e[e.MetaTypeReshape=15]="MetaTypeReshape",e[e.MetaTypeBeauty=16]="MetaTypeBeauty",e[e.MetaTypeVideoEffect=17]="MetaTypeVideoEffect",e[e.MetaTypeBrightness=18]="MetaTypeBrightness",e[e.MetaTypeContrast=19]="MetaTypeContrast",e[e.MetaTypeSaturation=20]="MetaTypeSaturation",e[e.MetaTypeSharpen=21]="MetaTypeSharpen",e[e.MetaTypeHighlight=22]="MetaTypeHighlight",e[e.MetaTypeShadow=23]="MetaTypeShadow",e[e.MetaTypeTemperature=24]="MetaTypeTemperature",e[e.MetaTypeHue=25]="MetaTypeHue",e[e.MetaTypeFade=26]="MetaTypeFade",e[e.MetaTypeLightSensation=27]="MetaTypeLightSensation",e[e.MetaTypeVignetting=28]="MetaTypeVignetting",e[e.MetaTypeParticle=29]="MetaTypeParticle",e[e.MetaTypeSegCanvas=30]="MetaTypeSegCanvas",e[e.MetaTypeCanvasColor=31]="MetaTypeCanvasColor",e[e.MetaTypeCanvasImage=32]="MetaTypeCanvasImage",e[e.MetaTypeCanvasBlur=33]="MetaTypeCanvasBlur",e[e.MetaTypeTransition=34]="MetaTypeTransition",e[e.MetaTypeAudioEffect=35]="MetaTypeAudioEffect",e[e.MetaTypeAudioFade=36]="MetaTypeAudioFade",e[e.MetaTypeBeats=37]="MetaTypeBeats",e[e.MetaTypeTailLeader=38]="MetaTypeTailLeader",e[e.MetaTypeAnimation=39]="MetaTypeAnimation",e[e.MetaTypeVideoAnimation=40]="MetaTypeVideoAnimation",e[e.MetaTypeTextEffect=41]="MetaTypeTextEffect",e[e.MetaTypeTextShape=42]="MetaTypeTextShape",e[e.MetaTypeTextToAudio=43]="MetaTypeTextToAudio",e[e.MetaTypeVideoMix=44]="MetaTypeVideoMix",e[e.MetaTypeAdjust=45]="MetaTypeAdjust",e[e.MetaTypeVideoMask=46]="MetaTypeVideoMask",e[e.MetaTypeSpeed=47]="MetaTypeSpeed",e[e.MetaTypeChroma=48]="MetaTypeChroma",e[e.MetaTypeTextTemplate=49]="MetaTypeTextTemplate",e[e.MetaTypeVideoOriginalSound=50]="MetaTypeVideoOriginalSound",e[e.MetaTypeStretchLeg=51]="MetaTypeStretchLeg",e[e.MetaTypeRealtimeDenoise=52]="MetaTypeRealtimeDenoise",e[e.MetaTypeFigure=53]="MetaTypeFigure",e[e.MetaTypeFaceEffect=54]="MetaTypeFaceEffect",e[e.MetaTypeVideoTracking=55]="MetaTypeVideoTracking",e[e.MetaTypeHsl=56]="MetaTypeHsl",e[e.MetaTypeColorCurves=57]="MetaTypeColorCurves",e[e.MetaTypeAudioBalance=58]="MetaTypeAudioBalance",e[e.MetaTypeComposition=59]="MetaTypeComposition",e[e.MetaTypeCover=60]="MetaTypeCover",e[e.MetaTypeLeader=61]="MetaTypeLeader",e[e.MetaTypeTailer=62]="MetaTypeTailer",e[e.MetaTypePrimaryColorWheels=63]="MetaTypePrimaryColorWheels",e[e.MetaTypeLogColorWheels=64]="MetaTypeLogColorWheels",e[e.MetaTypeHandwriteImage=65]="MetaTypeHandwriteImage",e[e.MetaTypeHandwriteRes=66]="MetaTypeHandwriteRes",e[e.MetaTypeCombination=67]="MetaTypeCombination",e[e.MetaTypeManualDeformation=68]="MetaTypeManualDeformation",e[e.MetaTypePluginEffect=69]="MetaTypePluginEffect",e[e.MetaTypeAdCube=70]="MetaTypeAdCube",e[e.MetaTypeAll=71]="MetaTypeAll"}(J||(J={})),function(e){e[e.EffectPlatformLoki=0]="EffectPlatformLoki",e[e.EffectPlatformArtist=1]="EffectPlatformArtist",e[e.EffectPlatformBrand=2]="EffectPlatformBrand"}(K||(K={})),function(e){e.CurveHSL="curve-hsl",e.VoiceChange="voice-change",e.ShootProject="shoot-project",e.ManualFigure="manual-figure",e.LiveshortenPanEntertainment="liveshorten-pan-entertainment",e.FaceProp="face-prop",e.Beauty2="beauty2",e.SkeletonBody="skeleton-body",e.TextTemplate="text-template",e.ShootProp="shoot-prop",e.Shoot="shoot",e.Play="play",e.SystemFonts="system-fonts",e.Beauty="beauty",e.Flower2="flower2",e.Filter2="filter2",e.Bubble2="bubble2",e.Effects="effects2",e.Tone="tone",e.Filter="filter",e.Canvas="canvas",e.Bubble="bubble",e.Flower="flower",e.Video="video",e.Transitions="transitions",e.Mix="mix",e.Sticker="sticker",e.Text="text",e.Insert="insert",e.Fonts="fonts",e.Videomask="videomask",e.Curvespeed="curvespeed",e.Integration="integration",e.Iosemojinew="iosemojinew",e.Emoji="emoji",e.Emojiandroid="emojiandroid",e.Emojiios="emojiios",e.Shape="shape"}(q||(q={}));const ee=e=>{switch(e){case q.TextTemplate:return J.MetaTypeTextTemplate;case q.Flower:return J.MetaTypeTextEffect;default:return J.MetaTypeAll}},te=e=>{var t;if(!e)return"";const i=null===(t=e.ImageURLList)||void 0===t?void 0:t.map((e=>({width:e.Width,height:e.Height,url:e.URL})));return{imageWidth:e.ImageWidth,imageHeight:e.ImageHeight,imageUrlList:i,uri:e.URI,url:e.URL,md5:e.Md5}},ie=(e,t)=>{var i,r,n;const a=e.ModelNames?JSON.parse(e.ModelNames):{},o=Object.values(a).reduce(((e,t)=>[...e,...t]),[]),s={md5:e.FileUrl.Uri,url:e.FileUrl.UrlList[0],name:e.Name,previewUrl:e.IconUrl.UrlList[0],animatedUrl:e.IconUrl.UrlList[0],metaType:ee(e.Panel),effectId:e.EffectId.toString(),resourceId:e.ResourceId.toString(),relatedId:"",sourcePlatform:K.EffectPlatformLoki,requirements:e.Requirements,modelNames:o,isBusiness:!1,author:"",duration:0,extra:{},sdkExtra:{},contentJSON:e.ContentJson,contentFile:e.ContentFile,dependency:(null===(i=e.DependResourceList)||void 0===i?void 0:i.map((({ResourceId:e,...t})=>({...t,ResourceId:e.toString()}))))||[],panel:e.Panel,stickerImage:te(e.StickerImage),reportTimestamp:null!==(r=e.UseReportMs)&&void 0!==r?r:Date.now(),childEffects:null===(n=e.ChildEffects)||void 0===n?void 0:n.map((e=>ie(e))),sdkVersion:e.SdkVersion,imageFiles:(l=e.ImageFiles,null!=l&&l.length?l.map((e=>{var t;const i=null===(t=e.ImageURLList)||void 0===t?void 0:t.map((e=>({width:e.Width,height:e.Height,url:e.URL})));return{imageWidth:e.ImageWidth,imageHeight:e.ImageHeight,imageUrlList:i,uri:e.URI,url:e.URL,md5:e.Md5,imageSize:e.ImageSize,path:e.Path,name:e.Name,mime:e.Mime,imageFormat:e.ImageFormat}})):[])};var l;try{const t=/^[{].*[}]$/.test(e.Extra)?e.Extra:"{}";s.extra=JSON.parse(t)}catch(d){}try{const t=/^[{].*[}]$/.test(e.SdkExtra)?e.SdkExtra:"{}";s.sdkExtra=JSON.parse(t)}catch(d){}if(Object.keys(s.extra).length>0){var c;const{Resources:i,canvas_cover:r,video_duration:n,hover_icon:a,preview_cover:o,track_thumbnail:l,is_business:d,web_icon:u}=s.extra;if(d&&(s.isBusiness=!0),n&&(s.duration=1e3*n),void 0===t&&(null===(c=e.FileUrl)||void 0===c?void 0:c.UrlList.length)>0&&(t=Q().dirname(e.FileUrl.UrlList[0])),(a||o||l)&&(s.previewUrl=`${t}/${a||o||l}`),u&&(s.previewUrl=`${t}${u}`),i||r){const e=i||r;s.md5=Q().basename(e,Q().extname(e)),s.url=`${t}/${e}`}}return s};var re=i(75924);const ne=e=>({GET_CATEGORY_EFFECTS:{HostNameType:n.b_.Default,url:"/lv/v1/effect/get_category_effects"},GET_RECENT_LIST:{HostNameType:n.b_.Default,url:"/lv/v1/editor/effect/recent_list"},GET_EFFECTS_BY_RES_ID:{HostNameType:n.b_.Default,url:"/lv/v1/effect/batch_by_resource"},GET_LOKI_CATEGORY_BY_ID:{HostNameType:n.b_.Default,url:"/lv/v1/effect/get_panel_info"},GET_LOKI_ALL_FONT:{HostNameType:n.b_.Default,url:"/lv/v1/effect/get_all_fonts"}}[e]),ae=e=>{const{category:t,limit:i,offset:r,sortingPosition:n,panel:a}=e;return{panel:a,sortingPosition:n,category:t,limit:i,offset:r,album_resource_id:e.albumResourceId,enable_album:e.enableAlbum,album_size_limit:e.albumSizeLimit,hasChildrenCategory:e.hasChildrenCategory}};const oe=new class{constructor(e={}){const t={transformRequest:[(e,t)=>{const i={...e,lang:R.ZP.language};return JSON.stringify(i)}]},i=(new h).setDefaultConfig({...H,...t,...e}).useJsonBigTransformResponse().addInterceptor(new B({})).build();i.interceptors.response.use((e=>{if(200===e.status){const t=e.data;if(!t.BaseResp||0===t.BaseResp.StatusCode)return Promise.resolve(t)}return Promise.reject(e)})),this._service=i}switchLokiPanelRegion(e){this.hasDependencyCN=e}async sendRecentMaterialItem(e){const{url:t,hostNameType:i}=Y.ReportRecently,r={...e};this._service.interceptors.request.use((e=>(e.headers={...e.headers,...w({url:`${location.origin}${e.url}`,pf:"7",appvr:X,tdid:""}),"app-sdk-version":G,"sign-ver":1,pf:"7",appvr:X},e)));const n=await this._service({url:t,data:r,[o]:i}),{ret:a,errmsg:s,svr_time:l,log_id:c}=n;return{ret:a,errMsg:s,svrTime:l,logId:c}}async getEffectsByResourceIds(e){var t;const{url:i,hostNameType:r}=ne("GET_EFFECTS_BY_RES_ID"),n={appVersion:G,sdkVersion:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),enter_from:$.EnterFrom,list:e.map((e=>({...e,appVersion:G})))};return null===(t=(await this._service({url:i,data:n,[o]:r})).data)||void 0===t?void 0:t.map((e=>ie(e)))}async fetchMaterialRecentList(e){const{url:t,hostNameType:i}=ne("GET_RECENT_LIST"),r={...e,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},n=await this._service({url:t,data:r,[o]:i}),{has_more:a,new_cursor:s,item_list:l=[],artist_item_list:c=[]}=n.data,d=null==c?void 0:c.map((e=>({...(0,re.tv)(e),reportTimestamp:e.UseReportMs})));return{list:null==l?void 0:l.map((e=>ie(e))),cursor:s,hasMore:a,photoList:d}}async fetchCategoryEffectsAll(e){const{url:t,hostNameType:i}=ne("GET_CATEGORY_EFFECTS"),r=await this._service({url:t,[o]:i,data:{appVersion:G,sdkVersion:j,enter_from:$.EnterFrom,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),...ae(e)}}),{CategoryEffects:{Effects:n,Cursor:a,HasMore:s,SortingPosition:l},UrlPrefix:c}=r.data;if(!n)throw new Error("loki resource bad response");return{list:n.map((e=>ie(e,null==c?void 0:c[0]))),cursor:a,hasMore:s,sortingPosition:l}}async fetchLokiCategory(e){const{url:t,hostNameType:i}=ne("GET_LOKI_CATEGORY_BY_ID"),r=await this._service({url:t,[o]:i,data:{appVersion:G,sdkVersion:j,enter_from:$.EnterFrom,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),...ae(e),category:void 0,hasCategoryEffects:!0}}),{CategoryList:n}=r.data,{category_info_map:a}=r;if(!n)throw new Error("loki resource bad response");return{list:n.map((e=>{var t;const i=(null!==(t=null==e?void 0:e.ChildrenCategories)&&void 0!==t?t:[]).map((e=>a[e]?{id:a[e].Id,name:a[e].Name,key:a[e].Key,extra:a[e].Extra}:{}));return{id:e.Id,name:e.Name,key:e.Key,childrenCategories:i}}))}}async fetchLokiAllText(e){const{url:t,hostNameType:i}=ne("GET_LOKI_ALL_FONT"),r=await this._service({url:t,[o]:i,data:{appVersion:G,sdkVersion:j,enter_from:$.EnterFrom,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),panel:e.panel,limit:1e3}}),{CategoryEffects:{Effects:n,Cursor:a,HasMore:s,SortingPosition:l},UrlPrefix:c}=r.data;if(!n)throw new Error("loki resource bad response");return{list:n.map((e=>ie(e,null==c?void 0:c[0]))),cursor:a,hasMore:s,sortingPosition:l}}};var se,le,ce,de,ue,he,pe=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class ye{constructor(){this.axiosInstance=(new h).addInterceptor([new E,new y]).addInterceptor(new B({isRetry:e=>e.indexOf(L.SaveDraftUrl.url)>=0,retries:1})).build()}serverReport(e,t,i){const r={params:t,event_name:e,custom_info:i},{url:n,hostNameType:a}=L.DraftOpenReport;return this.axiosInstance.post(n,r,{[o]:a})}async syncSaveTicket(e,t){const i={package_key:e,package_type:5,workspace_id:t,cursor:0,count:1},{url:r,hostNameType:n}=L.SyncSaveToken,{version_list:a}=await this.axiosInstance.post(r,i,{[o]:n});return a.map((e=>e.package_id))[0]}async submitDraftData(e){var t,i,r,n;const a=(null===(t=e.cloudAlbumAssert)||void 0===t?void 0:t.map((e=>({source_path:e.sourcePath,md5:e.md5,size:e.size}))))||[],s=a.filter((t=>{var i;return null===(i=e.referencedAssert)||void 0===i?void 0:i.includes(t.md5)})),l=null===(i=e.cover)||void 0===i||null===(i=i.split("base64,"))||void 0===i?void 0:i[1],c=null!==(r=e.cloudDraftMeta)&&void 0!==r?r:this._getCloudDraftMeta(e.id,e.name,e.dimension,!e.ticket||"0"===e.ticket,function(e,t,i){const r=new TextEncoder;let n=r.encode(e).length+r.encode(t).length;return i.forEach((e=>n+=e)),n}(e.draftData,null!=l?l:"",s.map((e=>e.size))),e.userInfo),{url:d,hostNameType:u}=L.SaveDraftUrl;return await this.axiosInstance.post(d,{workspace_id:e.workspaceId,package_type:5,package_key:e.id,base_package_id:null!==(n=e.ticket)&&void 0!==n?n:"0",template_data:e.draftData,template_meta:JSON.stringify(c),package_assets:a,referenced_assets:s,materials:e.materials,user_actions:"{}",cover_image_content:l,page_covers:e.coverList.map(((e,t)=>({data:e,source_path:`cover${t>0?`_${t}`:""}.jpg`})))},{[o]:u})}async publishAsTemplate(e){var t,i;const{id:r,name:n,dimension:a,userInfo:s,item_type:l,title:c,cover_height:u,cover_width:h,template_data:p,template_file:f,limit:y,extra:g,extra_v2:m,fragment_count:_,replaceable_image_list:v,main_version:I,features_version:T,revise_version:w,source_workspace_id:E,template_theme:x}=e,{url:b,hostNameType:R}=L.PublishAsTemplate,A=null===(t=e.cover)||void 0===t||null===(t=t.split("base64,"))||void 0===t?void 0:t[1];null!==(i=y.platform)&&void 0!==i&&i.length||(y.platform=[k]);const P={create_time:Date.now(),platform:k,feature_list:y.features};return await this.axiosInstance.post(b,{item_type:l,title:c,cover:A,cover_height:u,cover_width:h,template_data:p,template_meta:JSON.stringify(P),template_theme:x,template_file:f,limit:y,extra:g,extra_v2:{...m,source_draft_id:r},fragment_count:_,replaceable_image_list:v,main_version:I,features_version:T,revise_version:w,source_workspace_id:E},{[o]:R,transformResponse:e=>d().parse(e)})}async getDraftData(e,t){const i=await this.axiosInstance.post(L.GetDraftUrl.url,{package_key:e,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),workspace_id:t,package_asset_limit:30},{[o]:L.GetDraftUrl.hostNameType}),r=JSON.parse(i.template_data),n=function(e){let t,i="",r=[],n=[],o=Date.now();try{n=e.package_assets.map((e=>({md5:e.md5,size:e.size,sourcePath:e.source_path}))),t=JSON.parse(e.package_meta),o=t.createSource.createTime,i=t.draft.name,r=e.referenced_assets.map((e=>JSON.parse(e))).map((e=>N(e)))}catch(s){a.t.error("draft-api-helper parse json error",s)}return{draftTitle:i,draftCreateTime:o,draftUsedEverAsserts:r,draftAllEverAsserts:n,draftData:e.template_data,token:e.package_id,materials:e.materials,allowToEdit:e.allow_to_edit}}(i);return this._draftCreateTime=n.draftCreateTime,{...n,draftData:r}}async getTemplateFile(e){return await this.axiosInstance.post(L.GetTemplateFile.url,{uris:e},{[o]:L.GetDraftUrl.hostNameType})}reportDraftOpen(e,t){return this.axiosInstance.post(L.SyncDraftOpenTime.url,{workspace_id:t,file_id:e,file_type:1},{[o]:L.SyncDraftOpenTime.hostNameType})}async checkPublishTemplatePermission(){const e=await this.axiosInstance.post(L.CheckPublishTemplatePermission.url,{},{[o]:L.CheckPublishTemplatePermission.hostNameType});return{hasPermission:e.has_permission,hasCNPermission:e.has_cn_permission,publishCoverTemplate:e.cover_template_permission}}_getCloudDraftMeta(e,t,r,n,a,o){var s,l,c;const d=Date.now(),u="editor-batch"===(0,F.Cm)()||void 0;return{draft:{id:e,name:t,type:5,duration:0,updateTime:d,size:a,segmentCount:0,version:"1.0.0",platformSupport:k,isMainTrackEmpty:!1,isScriptTemplate:!1,renderIndexTrackMode:!1,canvasInfo:{width:r[0].width,height:r[0].height,sizeUnit:r[0].unit,pageInfoList:r.map((e=>({...e,sizeUnit:e.unit})))},coverUrl:"cover.jpg",cover:"cover.jpg",graphicInfo:{isUseInCn:null!==(s=oe.hasDependencyCN)&&void 0!==s&&s,isBatch:u}},uploadSource:{owner:null!==(l=null==o?void 0:o.uid)&&void 0!==l?l:"0",platform:k,systemVersion:i.g.navigator.userAgent,appVersion:"1.0.0",createTime:n||!this._draftCreateTime?d:this._draftCreateTime},createSource:{owner:null!==(c=null==o?void 0:o.uid)&&void 0!==c?c:"0",platform:k,systemVersion:i.g.navigator.userAgent,appVersion:"1.0.0",createTime:n||!this._draftCreateTime?d:this._draftCreateTime}}}}pe([C(),fe("design:type",Function),fe("design:paramtypes",[String,String,String]),fe("design:returntype",void 0)],ye.prototype,"serverReport",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[String,String]),fe("design:returntype","function"==typeof(se="undefined"!=typeof Promise&&Promise)?se:Object)],ye.prototype,"syncSaveTicket",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype","function"==typeof(le="undefined"!=typeof Promise&&Promise)?le:Object)],ye.prototype,"submitDraftData",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[Object]),fe("design:returntype",Promise)],ye.prototype,"publishAsTemplate",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[String,String]),fe("design:returntype","function"==typeof(ce="undefined"!=typeof Promise&&Promise)?ce:Object)],ye.prototype,"getDraftData",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[Array]),fe("design:returntype","function"==typeof(de="undefined"!=typeof Promise&&Promise)?de:Object)],ye.prototype,"getTemplateFile",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[String,String]),fe("design:returntype","function"==typeof(ue="undefined"!=typeof Promise&&Promise)?ue:Object)],ye.prototype,"reportDraftOpen",null),pe([C(),fe("design:type",Function),fe("design:paramtypes",[]),fe("design:returntype","function"==typeof(he="undefined"!=typeof Promise&&Promise)?he:Object)],ye.prototype,"checkPublishTemplatePermission",null);var ge=i(75709);const me=e=>{if(!e)return;const{effects:t=[],local_images:i,replaceable_images:r,yk_images:o}=e;return{effects:t.map((e=>{const t=d().parse(e);var i;return t.Source===n.UI.HeyPan?{name:t.Name,md5:t.FileUrl.Uri,url:t.FileUrl.UrlList[0],resourceId:t.ResourceId.toString(),panel:null!==(i=(0,ge.j)(t.EffectType))&&void 0!==i?i:"",effectId:t.EffectId.toString()}:ie(t)})),localImages:i,replaceableImages:r,ykImages:null==o?void 0:o.map((e=>{try{return JSON.parse(e)}catch(t){a.t.warn("template-api","parse yk image error",e)}return null})).filter((e=>Boolean(e)))}};var _e,ve,Ie,Te,we,Ee,xe,be,Re,ke,Ae,Pe,Me,Le,Se,Ce=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Fe{constructor(){const e=new h;this._service=e.setDefaultConfig(H).useJsonBigTransformResponse().addInterceptor([new B({}),new E,new y]).build();const t=new h;this._serviceWithFullData=t.setDefaultConfig(H).addInterceptor([new B({}),new E]).build()}async getAllTemplateRatio(){var e;const{data:t,status:i}=null!==(e=await l.default.get(v.GetAllTemplateRatio.url).catch((()=>{})))&&void 0!==e?e:{};if(200===i)return t}async getCategories(e){const{url:t,hostNameType:i}=v.GetCategories,r={sdk_version:m,category_type:e.categoryType,scale:e.scale,canvas_width:e.canvasWidth,canvas_height:e.canvasHeight};return{categories:(await this._service({url:t,data:r,[o]:i})).collections}}async getTemplateAccordCategory(e){var t;const{url:i,hostNameType:r}=v.GetTemplatesAccordCategory,n={};if(Boolean(!1)||Boolean(!1)){const e=localStorage.getItem("__mock_category_id__");e&&(n.id=Number(e))}const a={...e,...n},s={sdk_version:m,enter_from:_,count:20,...a},l=await this._service({url:i,data:s,[o]:r});return{cursor:l.new_cursor,hasMore:l.has_more,list:null===(t=l.item_list)||void 0===t?void 0:t.map((e=>({...e,id:e.id.toString()})))}}async getRecentList(e){var t;const{url:i,hostNameType:r}=v.GetRecentList,n={count:50,...e},a=await this._service({url:i,data:n,[o]:r});return{cursor:a.new_cursor,hasMore:a.has_more,list:null===(t=a.item_list)||void 0===t?void 0:t.map((e=>({...e,id:e.id.toString()})))}}async reportRecently(e){const{url:t,hostNameType:i}=v.ReportRecently,r={type:"template",...e};return await this._service({url:t,data:r,[o]:i})}async getTemplateDetail(e){const{url:t,hostNameType:i}=v.GetTemplateDetail,r={sdk_version:m,enter_from:_,app_version:g,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),template_id:e.templateId,need_draft:e.needDraft},n=await this._service({url:t,data:r,[o]:i}),{template_data:a,creator_info:s}=n,{template_url:l,materials:c,main_version:d,revise_version:u,feature_version:p,draft_data:f,theme_data:y,text_theme_covers:I,text_theme_effects:T}=n;return{templateUrl:l,draftData:f,templateData:a,templateVersion:`${d}.${p}.${u}`,creator:s,materials:me(c),textThemeCovers:I,themeData:y,textThemeEffects:T}}async getTemplateDataByUrl(e){const t=await l.default.get(e.replace(/^https*:\/\//,"https://"));return 200!==t.status&&204!==t.status?Promise.reject(new Error(`get template data fail, url:${e}`)):t.data}async getTemplateHotWords(){const{url:e,hostNameType:t}=v.GetTemplateHotWords;return{list:(await this._service({url:e,[o]:t})).hot_word_list}}async searchTemplates(e){var t;const{url:i,hostNameType:r}=v.SearchTemplates,{sdkVersion:n,enterForm:a,searchId:s,enterFrom:l,...c}=e,d={sdk_version:n,enter_form:a,search_id:s,enter_from:l,...c},u=await this._serviceWithFullData({url:i,data:d,[o]:r});if(200!==u.status)return Promise.reject(u);const{data:h}=u;if("0"!==h.ret)return Promise.reject(h);const{data:p,log_id:f}=u.data;return{hasMore:p.has_more,list:(null!==(t=p.image_templates)&&void 0!==t?t:[]).map((e=>({...e,id:e.web_id,searchId:p.search_id,requestId:f}))),cursor:p.new_cursor,searchId:p.search_id,requestId:f}}async getBatchCategories(){const{url:e,hostNameType:t}=v.GetBatchCategories;return{categories:await this._service({url:e,data:{sdk_version:j},[o]:t})}}async getBatchTemplatesByCategory(e){const{url:t,hostNameType:i}=v.GetBatchTemplatesByCategory,r={...e};return{templatesDataList:(await this._service({url:t,data:r,[o]:i})).map((e=>({...e,item_list:e.item_list.map((e=>({...e,id:e.web_id})))})))}}async getPresets(e){const{url:t,hostNameType:i}=v.GetPresets,r={...e},n=await this._service({url:t,data:r,[o]:i});return{...n,item_list:n.item_list.map((e=>({...e,id:e.web_id})))}}async getPresetDetail(e){const{url:t,hostNameType:i}=v.GetPresetDetail,r={sdk_version:j,enter_from:_,app_version:g,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),template_id:e.templateId,need_draft:e.needDraft,work_space_id:e.workspaceId},n=await this._service({url:t,data:r,[o]:i}),{template_data:a,creator_info:s}=n,{template_url:l,materials:c,main_version:d,revise_version:u,feature_version:p,draft_data:f,extra_v2:y}=n;return{templateUrl:l,draftData:f,templateData:a,templateVersion:`${d}.${p}.${u}`,creator:s,materials:me(c),extra:y}}async postDeletePresetsTemplate(e){const{url:t,hostNameType:i}=v.PostDeletePresetsTemplate,r={...e};await this._service({method:"post",url:t,data:r,[o]:i})}async fuzzySearchTemplateByTitle(e){const{url:t,hostNameType:i}=v.FuzzySearchTemplateByTitle,r={...e};return{item_list:(await this._service({method:"post",url:t,data:r,[o]:i})).item_list.map((e=>({...e,id:e.web_id})))}}}Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[]),Oe("design:returntype","function"==typeof(_e="undefined"!=typeof Promise&&Promise)?_e:Object)],Fe.prototype,"getAllTemplateRatio",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(ve="undefined"!=typeof Promise&&Promise)?ve:Object)],Fe.prototype,"getCategories",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(Ie="undefined"!=typeof Promise&&Promise)?Ie:Object)],Fe.prototype,"getTemplateAccordCategory",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(Te="undefined"!=typeof Promise&&Promise)?Te:Object)],Fe.prototype,"getRecentList",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",Promise)],Fe.prototype,"reportRecently",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(we="undefined"!=typeof Promise&&Promise)?we:Object)],Fe.prototype,"getTemplateDetail",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[String]),Oe("design:returntype","function"==typeof(Ee="undefined"!=typeof Promise&&Promise)?Ee:Object)],Fe.prototype,"getTemplateDataByUrl",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[]),Oe("design:returntype","function"==typeof(xe="undefined"!=typeof Promise&&Promise)?xe:Object)],Fe.prototype,"getTemplateHotWords",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(be="undefined"!=typeof Promise&&Promise)?be:Object)],Fe.prototype,"searchTemplates",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[]),Oe("design:returntype","function"==typeof(Re="undefined"!=typeof Promise&&Promise)?Re:Object)],Fe.prototype,"getBatchCategories",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(ke="undefined"!=typeof Promise&&Promise)?ke:Object)],Fe.prototype,"getBatchTemplatesByCategory",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(Ae="undefined"!=typeof Promise&&Promise)?Ae:Object)],Fe.prototype,"getPresets",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype","function"==typeof(Pe="undefined"!=typeof Promise&&Promise)?Pe:Object)],Fe.prototype,"getPresetDetail",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",Promise)],Fe.prototype,"postDeletePresetsTemplate",null),Ce([C(),Oe("design:type",Function),Oe("design:paramtypes",[Object]),Oe("design:returntype",Promise)],Fe.prototype,"fuzzySearchTemplateByTitle",null),function(e){e[e.HeyCan=1]="HeyCan",e[e.Loki=2]="Loki"}(Me||(Me={})),function(e){e.Text="text",e.Image="image",e.Shape="shape",e.Color="color",e.Line="line"}(Le||(Le={})),function(e){e.Template="template",e.Effect="effect",e.Material="material",e.Common="common"}(Se||(Se={}));const Ne={GetAutoColorTheme:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/color/auto"},GetRecommendPalette:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/color/recommend"},GetApplyPalette:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/color/apply"},GetRecentList:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/common/recent_list"},GetPlanePaletteFeed:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/color/feed"},ReportRecently:{hostNameType:n.b_.Default,url:"/lv/v1/editor/use_report"}},De=Se.Common;var Ue,Be,Ge,je,He,We,ze=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Ve=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class $e{constructor(){const e=new h;this._service=e.setDefaultConfig(H).useJsonBigTransformResponse().addInterceptor([new B({}),new E,new y]).build()}async getAutoColorTheme(e){const{url:t,hostNameType:i}=Ne.GetAutoColorTheme,r={...e,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},n=await this._service({url:t,data:r,[o]:i}),{canvas:a,layers:s=[],palette_recommend_list:l}=JSON.parse(n.result);return{canvas:a,layers:s,paletteList:l[0].palette_list}}async getRecommendColorPalette(e){const{url:t,hostNameType:i}=Ne.GetRecommendPalette,r={...e,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},n=await this._service({url:t,data:r,[o]:i}),{canvas:a,layers:s=[],palette_recommend_list:l}=n;return{canvas:a,layers:s,recommendList:null==l?void 0:l.map((e=>({layerId:e.layer_id,paletteList:e.palette_list})))}}async getApplyColorPalette(e){const{url:t,hostNameType:i}=Ne.GetApplyPalette,r={...e,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},n=await this._service({url:t,data:r,[o]:i}),{canvas:a,layers:s=[]}=JSON.parse(n.result);return{canvas:a,layers:s}}async getRecentlyUsedColorPalette(){const{url:e,hostNameType:t}=Ne.GetRecentList,i={cursor:0,count:50,common_action_key:"palette",app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},r=await this._service({url:e,data:i,[o]:t}),{new_cursor:n,has_more:a,item_list:s=[]}=r;return{newCursor:n,hasMore:a,itemList:s}}async reportRecentlyUsedPalette(e){const{url:t,hostNameType:i}=Ne.ReportRecently,r={type:De,common_action_key:"palette",common_action_value:e.commonActionValue};return await this._service({url:t,data:r,[o]:i})}async getPlanePaletteFeedList(){const{url:e,hostNameType:t}=Ne.GetPlanePaletteFeed,i={type:De,common_action_key:"palette"};return await this._service({url:e,data:i,[o]:t})}}ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype","function"==typeof(Ue="undefined"!=typeof Promise&&Promise)?Ue:Object)],$e.prototype,"getAutoColorTheme",null),ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype","function"==typeof(Be="undefined"!=typeof Promise&&Promise)?Be:Object)],$e.prototype,"getRecommendColorPalette",null),ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype","function"==typeof(Ge="undefined"!=typeof Promise&&Promise)?Ge:Object)],$e.prototype,"getApplyColorPalette",null),ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype","function"==typeof(je="undefined"!=typeof Promise&&Promise)?je:Object)],$e.prototype,"getRecentlyUsedColorPalette",null),ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[Object]),Ve("design:returntype","function"==typeof(He="undefined"!=typeof Promise&&Promise)?He:Object)],$e.prototype,"reportRecentlyUsedPalette",null),ze([C(),Ve("design:type",Function),Ve("design:paramtypes",[]),Ve("design:returntype","function"==typeof(We="undefined"!=typeof Promise&&Promise)?We:Object)],$e.prototype,"getPlanePaletteFeedList",null);const Ye="0.0.1",Xe="14.0.0",Je={GetAICutout:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/saliency_seg"},GetAICutoutWithBrush:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/interactive_matting"},GetAIBackground:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/gen_background"},ApplyAutoLayout:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/resize/auto"},GetAutoLayoutDimensions:{url:"https://sf16-muse-va.ibytedtos.com/obj/ies-fe-bee-maliva/bee_prod/biz_149/bee_prod_149_bee_publish_676.json",HostNameType:n.b_.Default},AIChangeStickerColor:{HostNameType:n.b_.Default,url:"/lv/v1/editor/color/change_sticker_color"},T2DTemplateLists:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/intelligence/query_recommend_template"},T2DTemplateDetails:{hostNameType:n.b_.Default,url:"/lv/v1/editor/plane/intelligence/fill_render"}};var Ke,qe,Ze,Qe;!function(e){e[e.QuickBrush=0]="QuickBrush",e[e.QuickEraser=1]="QuickEraser",e[e.Brush=2]="Brush",e[e.Eraser=3]="Eraser"}(Ke||(Ke={})),function(e){e[e.OnlyMask=0]="OnlyMask",e[e.ResultPng=1]="ResultPng",e[e.ResultWebp=2]="ResultWebp",e[e.ResultJpgAndAlphaPng=3]="ResultJpgAndAlphaPng"}(qe||(qe={})),function(e){e[e.EverCloud=1]="EverCloud",e[e.ImageXUri=2]="ImageXUri",e[e.YkItemId=3]="YkItemId",e[e.ImageUrl=4]="ImageUrl",e[e.ImageBase64=5]="ImageBase64"}(Ze||(Ze={})),function(e){e[e.EverPhoto=1]="EverPhoto",e[e.ImageX=2]="ImageX",e[e.Yk=3]="Yk",e[e.CommonURL=4]="CommonURL",e[e.Raw=5]="Raw"}(Qe||(Qe={}));var et,tt,it,rt,nt,at,ot=i(54643),st=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},lt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const ct={[n.F5.IMAGE]:"image",[n.F5.TEXT]:"text",[n.F5.SHAPE]:"shape",[n.F5.LINE]:"line",[n.F5.GROUP_LAYER]:"group",[n.F5.IMAGE_CONTAINER]:"image",[n.F5.GRID]:"image",[n.F5.SVG_IMAGE]:"image"};class dt{constructor(){const e=new h;this._service=e.setDefaultConfig(H).addInterceptor([new B({}),new E,new y]).build();const t=new h;this._serviceWithFullData=t.setDefaultConfig(H).addInterceptor([new B({}),new E]).build()}async getAutoLayoutDimensions(){const{data:e}=await l.default.get(Je.GetAutoLayoutDimensions.url),t={recommend:{},scenarioList:[]};return Object.keys(e).forEach((i=>{const r={name:i,i18Key:e[i].listConfig.listTitleKey,list:e[i].listConfig.list.map((e=>({title:e.scenario,titleI18Key:e.titleKey,dimension:e.extInfo})))};"customSize"===i?t.recommend=r:t.scenarioList.push(r)})),t}async getAiAutoLayoutResult(e,t,i){const{ApplyAutoLayout:r}=Je;e.canvas={width:Math.round(e.canvas.width),height:Math.round(e.canvas.height)},e.layers=e.layers.map((e=>{const{fontSize:t}=e;e.fontSize=void 0;const i={...e,layout:e.layout.map((e=>Math.round(e))),type:ct[e.type],font_size:t?Math.round(t):void 0};return e.assetMD5?i.asset_md5=e.assetMD5:e.imagePath?i.template_file_uri=e.imagePath:e.effect&&(i.effect_panel=e.effect.panel,i.effect_source=e.effect.source,i.effect_resource_id=e.effect.resourceId),i})).filter((e=>e.type!==ct[n.F5.GROUP_LAYER]));return(await this._service.post(r.url,{...e,aspect_ratio:t.map((e=>{const{width:t,height:i}=(0,ot.Ln)(e);return[Math.round(t),Math.round(i)]})),workspace_id:i,app_version:G,sdk_version:j,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()},{[o]:r.hostNameType})).results.map((e=>0===e.status?e:null))}async aiCutout(e){var t,i;const{url:r,hostNameType:n}=Je.GetAICutout,a={...this.src2Source(e.src),image_width:null===(t=e.size)||void 0===t?void 0:t.width,image_height:null===(i=e.size)||void 0===i?void 0:i.height,workspace_id:e.workspaceId,skip_image_output:e.skipImgOutput,seg_option:{get_algo_resp_json:!0,only_mask:4,refine_mask:2,rgb:[-1,-1,-1]},app_version:Ye,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()};return await this._service({url:r,data:a,[o]:n})}async aiCutoutWithBrush(e){const{url:t,hostNameType:i}=Je.GetAICutoutWithBrush,r={draw_info:e.drawInfo,pen_type:e.penType,pen_size:e.penSize,ret_mode:e.retMode},n={...this.src2Source(e.src),prev_result_type:e.prevResultType,prev_result:e.prevResult,workspace_id:e.workspaceId,matting_option:r,app_version:Ye,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()};return await this._service({url:t,data:n,[o]:i})}async aiBackground(e){var t,i;const{url:r,hostNameType:n}=Je.GetAIBackground,a={source_type:null!==(t=e.sourceType)&&void 0!==t?t:Qe.ImageX,source:e.uri,prompt:e.prompt||"",mode:e.mode,image_width:e.width,image_height:e.height,canvas_width:e.width,canvas_height:e.height,num_generate:null!==(i=e.num)&&void 0!==i?i:1,position_x:0,position_y:0,app_version:Ye,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()};return await this._service({url:r,data:a,[o]:n})}async aiBackgroundFull(e){var t,i;const{url:r,hostNameType:n}=Je.GetAIBackground,a={source_type:null!==(t=e.sourceType)&&void 0!==t?t:Qe.ImageX,source:e.uri,prompt:e.prompt||"",mode:e.mode,image_width:e.width,image_height:e.height,canvas_width:e.width,canvas_height:e.height,num_generate:null!==(i=e.num)&&void 0!==i?i:1,position_x:0,position_y:0,app_version:Ye,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()};return await this._serviceWithFullData({url:r,data:a,[o]:n})}async aiChangeStickerColor(e){const{type:t,url:i,width:r,height:n,rgb:a}=e,{url:s,HostNameType:l}=Je.AIChangeStickerColor,c={source_type:t,source:i,image_width:r,image_height:n,refer_rgb:a,use_pad:!0};return(await this._service({url:s,data:c,[o]:l})).image}src2Source(e){switch(e.type){case n.lJ.CloudImageSticker:return{source_type:Qe.EverPhoto,source:e.md5};case n.lJ.Svg:case n.lJ.Cutout:case n.lJ.ReplaceableCutout:return{source_type:Qe.ImageX,source:e.path};case n.lJ.YkSicker:case n.lJ.YkImage:return{source_type:Qe.Yk,source:e.resourceId};case n.lJ.Raw:return{source_type:Qe.Raw,source:e.path.substring(e.path.indexOf(",")+1)};default:return{source_type:Qe.CommonURL,source:e.path}}}}st([C(),lt("design:type",Function),lt("design:paramtypes",[]),lt("design:returntype","function"==typeof(et="undefined"!=typeof Promise&&Promise)?et:Object)],dt.prototype,"getAutoLayoutDimensions",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object,Array,Object]),lt("design:returntype","function"==typeof(tt="undefined"!=typeof Promise&&Promise)?tt:Object)],dt.prototype,"getAiAutoLayoutResult",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype","function"==typeof(it="undefined"!=typeof Promise&&Promise)?it:Object)],dt.prototype,"aiCutout",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype","function"==typeof(rt="undefined"!=typeof Promise&&Promise)?rt:Object)],dt.prototype,"aiCutoutWithBrush",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype","function"==typeof(nt="undefined"!=typeof Promise&&Promise)?nt:Object)],dt.prototype,"aiBackground",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype","function"==typeof(at="undefined"!=typeof Promise&&Promise)?at:Object)],dt.prototype,"aiBackgroundFull",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype",Promise)],dt.prototype,"aiChangeStickerColor",null),st([C(),lt("design:type",Function),lt("design:paramtypes",[Object]),lt("design:returntype",void 0)],dt.prototype,"src2Source",null);const ut={GetSearchWords:{hostNameType:n.b_.Default,url:"/artist/v1/effect/get_search_words"},GetRecommends:{hostNameType:n.b_.Default,url:"/artist/v1/effect/ccweb/feed"},Search:{hostNameType:n.b_.Default,url:"/artist/v1/effect/search"},Order:{hostNameType:n.b_.Default,url:"/artist/v1/library/tuchong/order"},PhotoAdobeSearch:{hostNameType:n.b_.Default,url:"/artist/v1/library/tuchong/search"},PhotoHeycanList:{hostNameType:n.b_.Default,url:"/artist/v1/effect/mget_artist_item"},GetSuggestWords:{hostNameType:n.b_.Default,url:"/artist/v1/effect/get_suggest_words"},PhotoAdobeList:{hostNameType:n.b_.Default,url:"/artist/v1/effect/mget_item"}};var ht,pt,ft;!function(e){e[e.EffectTypeAudioEffect=3]="EffectTypeAudioEffect",e[e.EffectTypeSong=4]="EffectTypeSong",e[e.EffectTypeVideo=5]="EffectTypeVideo",e[e.EffectTypeImage=9]="EffectTypeImage",e[e.EffectTypeWebImageTemplate=203]="EffectTypeWebImageTemplate"}(ht||(ht={})),function(e){e[e.SearchWordTypeBeforeSearch=1]="SearchWordTypeBeforeSearch",e[e.SearchWordTypeSearching=2]="SearchWordTypeSearching"}(pt||(pt={})),function(e){e.TrackEditor="track_editor",e.Export="export"}(ft||(ft={}));var yt,gt,mt,_t,vt,It,Tt,wt,Et,xt,bt=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Rt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class kt{constructor(){const e=new h;this._service=e.addInterceptor([new B({}),new E,new y]).build()}async getSearchWords(e){var t;const{url:i,hostNameType:r}=ut.GetSearchWords,n={app_id:e.appId,effect_type:e.effectType,search_word_type:e.searchWordType,cc_web_use_new_search:e.ccWebUseNewSearch},a=await this._getParamsConfig(),l=await this._service.post(i,n,{[o]:r,[s]:!1,...a});return{defaultWord:l.default_word,recommendWords:null!==(t=null==l?void 0:l.recommend_words)&&void 0!==t?t:[]}}async getRecommends(e){var t;const{url:i,hostNameType:r}=ut.GetRecommends,n={offset:e.offset,count:e.count,effect_type:e.effectType,pack_optional:e.packOptional,statistics_optional:e.statisticsOptional,request_id:e.requestId},a=await this._getParamsConfig(),l=await this._service.post(i,n,{[o]:r,[s]:!1,...a});return{hasMore:l.has_more,nextOffset:l.next_offset,list:(0,re.aW)(null!==(t=l.effect_item_list)&&void 0!==t?t:[])}}async search(e){var t;const{url:i,hostNameType:r}=ut.Search,n=await this._getParamsConfig(),a={app_id:e.appId,effect_type:e.effectType,query:e.query,offset:e.offset,count:e.count,pack_optional:e.packOptional,need_recommend:e.needRecommend};e.searchId&&(a.search_id=e.searchId);const l=await this._service.post(i,a,{[o]:r,[s]:!1,...n});return{hasMore:l.has_more,nextOffset:l.next_offset,list:(0,re.aW)(null!==(t=l.effect_item_list)&&void 0!==t?t:[],{searchId:l.search_id,requestId:l.request_id}),searchId:l.search_id,isSearchResult:l.is_search_result,relatedWords:l.related_words,emptySearchReason:l.empty_search_reason,requestId:l.request_id}}async order(e){const{url:t,hostNameType:i}=ut.Order,r=await this._getParamsConfig();return await this._service.post(t,e,{[o]:i,[s]:!1,...r})}async photoAdobeSearch(e){var t;const{url:i,hostNameType:r}=ut.PhotoAdobeSearch,n=await this._getParamsConfig(),a={effect_type:e.effectType,query:e.query,offset:e.offset,count:e.count,pack_optional:e.packOptional};e.searchId&&(a.search_id=e.searchId);const l=await this._service.post(i,a,{[o]:r,[s]:!1,...n});return{hasMore:l.has_more,nextOffset:l.next_offset,searchId:l.search_id,requestId:l.request_id,list:(0,re.EJ)(null!==(t=l.effect_item_list)&&void 0!==t?t:[],{searchId:l.search_id,requestId:l.request_id})}}async photoHeycanRecentList(e){var t;const{url:i,hostNameType:r}=ut.PhotoHeycanList,a={id_list:e.idList,pack_optional:e.packOptional},l=await this._service.post(i,a,{[o]:r,[s]:!1,params:{aid:n.AF,device_platform:"web",region:await h.apiSetting.getUserRegion(),lang:R.ZP.language}});return{list:(0,re.aW)(null!==(t=l.effect_item_list)&&void 0!==t?t:[])}}async getSuggestWords(e){const{url:t,hostNameType:i}=ut.GetSuggestWords,r=await this._getParamsConfig(),n={app_id:e.appId,query:e.query,count:e.count,effect_type:e.effectType,cc_web_use_new_search:e.ccWebUseNewSearch};return await this._service.post(t,n,{[o]:i,[s]:!1,...r})}async photoAdobeRecentList(e){var t;const{url:i,hostNameType:r}=ut.PhotoAdobeList,n=await this._getParamsConfig(),a=await this._service.post(i,e,{[o]:r,[s]:!1,...n});return{list:(0,re.aW)(null!==(t=a.effect_item_list)&&void 0!==t?t:[])}}async _getParamsConfig(){return{params:{aid:n.AF,version_name:"10.1.0",version_code:"10.1.0",sdk_version:"13.6.0",effect_sdk_version:"13.6.0",device_platform:"web",region:await h.apiSetting.getUserRegion(),language:R.ZP.language}}}}bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(yt="undefined"!=typeof Promise&&Promise)?yt:Object)],kt.prototype,"getSearchWords",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(gt="undefined"!=typeof Promise&&Promise)?gt:Object)],kt.prototype,"getRecommends",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(mt="undefined"!=typeof Promise&&Promise)?mt:Object)],kt.prototype,"search",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(_t="undefined"!=typeof Promise&&Promise)?_t:Object)],kt.prototype,"order",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(vt="undefined"!=typeof Promise&&Promise)?vt:Object)],kt.prototype,"photoAdobeSearch",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(It="undefined"!=typeof Promise&&Promise)?It:Object)],kt.prototype,"photoHeycanRecentList",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(Tt="undefined"!=typeof Promise&&Promise)?Tt:Object)],kt.prototype,"getSuggestWords",null),bt([C(),Rt("design:type",Function),Rt("design:paramtypes",[Object]),Rt("design:returntype","function"==typeof(wt="undefined"!=typeof Promise&&Promise)?wt:Object)],kt.prototype,"photoAdobeRecentList",null),function(e){e[e.beta=0]="beta",e[e.online=1]="online"}(Et||(Et={})),function(e){e[e.SUCCESS=0]="SUCCESS",e[e.COMMON_ERROR=1]="COMMON_ERROR",e[e.PARAM_ERROR=400]="PARAM_ERROR",e[e.MODEL_VERSION_MAP_ERROR=401]="MODEL_VERSION_MAP_ERROR",e[e.SDK_ERROR=1001]="SDK_ERROR",e[e.NOT_EXSIT=1002]="NOT_EXSIT",e[e.VERSION_MAP_EMPTY=2e3]="VERSION_MAP_EMPTY"}(xt||(xt={}));class At extends r{constructor(){super(...arguments),this.response={onFulfilled:e=>200!==e.status?Promise.reject(e):e.data.status_code!==xt.SUCCESS?Promise.reject(e.data):e.data}}}const Pt={url:"/model/api/arithmetics"};var Mt=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Lt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class St{constructor(){const e=new h;this._service=e.addInterceptor([new B({}),new At]).build()}async getEffectModelArithmetics(e){var t;const i=`${window.location.origin}${Pt.url}`;return(await this._service.get(i,{params:{busi_id:100,sdk_version:j,device_type:"capcut_web",device_platform:"web",aid:0,app_name:"capcut",app_version:G,platform_sdk_version:j,...null!=e&&null!==(t=e.list)&&void 0!==t&&t.length?{required_model_list:e.list.join(",")}:null}})).data.arithmetics}}Mt([C(),Lt("design:type",Function),Lt("design:paramtypes",[Object]),Lt("design:returntype",Promise)],St.prototype,"getEffectModelArithmetics",null);const Ct={GetModelSourceList:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/ai_model/materials"},getClothMaskInfo:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/ai_model/create_cloth_mask"},submitModelTask:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/ai_model/submit_task"},getModelGenerateResult:{hostNameType:n.b_.Default,url:"/lv/v1/editor/image/ai_model/batch_get_results"}};var Ot,Ft,Nt,Dt,Ut,Bt,Gt,jt=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Ht=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Wt{constructor(){const e=new h;this._service=e.setDefaultConfig(H).useJsonBigTransformResponse().addInterceptor([new B({}),new E,new y]).build();const t=new h;this._serviceWithFullData=t.setDefaultConfig(H).addInterceptor([new B({}),new E]).build()}async getModelSourceList(){const{url:e,hostNameType:t}=Ct.GetModelSourceList;return(await this._service({url:e,data:{},[o]:t})).model_resources||[]}async getClothMaskInfo(e){const{url:t,hostNameType:i}=Ct.getClothMaskInfo;return await this._service({url:t,data:e,[o]:i})}async submitModelTask(e){const{url:t,hostNameType:i}=Ct.submitModelTask,r=await this._serviceWithFullData({url:t,data:e,[o]:i});return null==r?void 0:r.data}async getModelGenerateResult(e){const{url:t,hostNameType:i}=Ct.getModelGenerateResult,r=await this._serviceWithFullData({url:t,data:e,[o]:i});return null==r?void 0:r.data}async aiT2DTemplateList(e){const{inputText:t,assets:i,workspaceId:r,assetType:n,aspectRatio:a}=e,{url:l,hostNameType:c}=Je.T2DTemplateLists,d={asset_type:n,input_text:t,assets:i,workspace_id:r,app_version:j,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion(),aspect_ratio:[a]};return(await this._serviceWithFullData({url:l,data:d,[o]:c,[s]:!1})).data}async aiT2DTemplateDetail(e){const{url:t,hostNameType:i}=Je.T2DTemplateDetails,{templateIdList:r,reqId:n,workspaceId:a,assetType:l}=e,c={asset_type:l,template_id_list:r,req_id:n,workspace_id:a,app_version:j,sdk_version:Xe,lang:R.ZP.language,region:await h.apiSetting.getUserRegion()};return(await this._serviceWithFullData({url:t,data:c,[o]:i,[s]:!1})).data}}jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[]),Ht("design:returntype","function"==typeof(Ot="undefined"!=typeof Promise&&Promise)?Ot:Object)],Wt.prototype,"getModelSourceList",null),jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[Object]),Ht("design:returntype","function"==typeof(Ft="undefined"!=typeof Promise&&Promise)?Ft:Object)],Wt.prototype,"getClothMaskInfo",null),jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[Object]),Ht("design:returntype","function"==typeof(Nt="undefined"!=typeof Promise&&Promise)?Nt:Object)],Wt.prototype,"submitModelTask",null),jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[Object]),Ht("design:returntype","function"==typeof(Dt="undefined"!=typeof Promise&&Promise)?Dt:Object)],Wt.prototype,"getModelGenerateResult",null),jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[Object]),Ht("design:returntype","function"==typeof(Ut="undefined"!=typeof Promise&&Promise)?Ut:Object)],Wt.prototype,"aiT2DTemplateList",null),jt([C(),Ht("design:type",Function),Ht("design:paramtypes",[Object]),Ht("design:returntype","function"==typeof(Bt="undefined"!=typeof Promise&&Promise)?Bt:Object)],Wt.prototype,"aiT2DTemplateDetail",null),function(e){e[e.needSubmitData=0]="needSubmitData",e[e.needCheckEmail=1]="needCheckEmail",e[e.done=2]="done"}(Gt||(Gt={}));const zt={GetEnableList:{hostNameType:n.b_.Default,url:"/lv/v1/ad_maker/user/get_enable_list"}};var Vt,$t,Yt,Xt,Jt=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Kt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class qt{constructor(){var e;this.axiosInstance=(new h).setDefaultConfig({...H,headers:{...H.headers,lan:null!==(e=R.ZP.language)&&void 0!==e?e:"en",tdid:""},withCredentials:!0}).addInterceptor([new E,new y]).build()}async getEnableList(){return(await this.axiosInstance.post(zt.GetEnableList.url,void 0,{[o]:zt.GetEnableList.hostNameType})).enable_list}}Jt([C(),Kt("design:type",Function),Kt("design:paramtypes",[]),Kt("design:returntype","function"==typeof(Vt="undefined"!=typeof Promise&&Promise)?Vt:Object)],qt.prototype,"getEnableList",null),function(e){e[e.MetaTypeNone=0]="MetaTypeNone",e[e.MetaTypeVideo=1]="MetaTypeVideo",e[e.MetaTypePhoto=2]="MetaTypePhoto",e[e.MetaTypeGif=3]="MetaTypeGif",e[e.MetaTypeMusic=4]="MetaTypeMusic",e[e.MetaTypeExtractMusic=5]="MetaTypeExtractMusic",e[e.MetaTypeSound=6]="MetaTypeSound",e[e.MetaTypeRecord=7]="MetaTypeRecord",e[e.MetaTypeImage=8]="MetaTypeImage",e[e.MetaTypeText=9]="MetaTypeText",e[e.MetaTypeSubtitle=10]="MetaTypeSubtitle",e[e.MetaTypeLyrics=11]="MetaTypeLyrics",e[e.MetaTypeSticker=12]="MetaTypeSticker",e[e.MetaTypeFilter=13]="MetaTypeFilter",e[e.MetaTypeLUT=14]="MetaTypeLUT",e[e.MetaTypeReshape=15]="MetaTypeReshape",e[e.MetaTypeBeauty=16]="MetaTypeBeauty",e[e.MetaTypeVideoEffect=17]="MetaTypeVideoEffect",e[e.MetaTypeBrightness=18]="MetaTypeBrightness",e[e.MetaTypeContrast=19]="MetaTypeContrast",e[e.MetaTypeSaturation=20]="MetaTypeSaturation",e[e.MetaTypeSharpen=21]="MetaTypeSharpen",e[e.MetaTypeHighlight=22]="MetaTypeHighlight",e[e.MetaTypeShadow=23]="MetaTypeShadow",e[e.MetaTypeTemperature=24]="MetaTypeTemperature",e[e.MetaTypeHue=25]="MetaTypeHue",e[e.MetaTypeFade=26]="MetaTypeFade",e[e.MetaTypeLightSensation=27]="MetaTypeLightSensation",e[e.MetaTypeVignetting=28]="MetaTypeVignetting",e[e.MetaTypeParticle=29]="MetaTypeParticle",e[e.MetaTypeSegCanvas=30]="MetaTypeSegCanvas",e[e.MetaTypeCanvasColor=31]="MetaTypeCanvasColor",e[e.MetaTypeCanvasImage=32]="MetaTypeCanvasImage",e[e.MetaTypeCanvasBlur=33]="MetaTypeCanvasBlur",e[e.MetaTypeTransition=34]="MetaTypeTransition",e[e.MetaTypeAudioEffect=35]="MetaTypeAudioEffect",e[e.MetaTypeAudioFade=36]="MetaTypeAudioFade",e[e.MetaTypeBeats=37]="MetaTypeBeats",e[e.MetaTypeTailLeader=38]="MetaTypeTailLeader",e[e.MetaTypeAnimation=39]="MetaTypeAnimation",e[e.MetaTypeVideoAnimation=40]="MetaTypeVideoAnimation",e[e.MetaTypeTextEffect=41]="MetaTypeTextEffect",e[e.MetaTypeTextShape=42]="MetaTypeTextShape",e[e.MetaTypeTextToAudio=43]="MetaTypeTextToAudio",e[e.MetaTypeVideoMix=44]="MetaTypeVideoMix",e[e.MetaTypeAdjust=45]="MetaTypeAdjust",e[e.MetaTypeVideoMask=46]="MetaTypeVideoMask",e[e.MetaTypeSpeed=47]="MetaTypeSpeed",e[e.MetaTypeChroma=48]="MetaTypeChroma",e[e.MetaTypeTextTemplate=49]="MetaTypeTextTemplate",e[e.MetaTypeVideoOriginalSound=50]="MetaTypeVideoOriginalSound",e[e.MetaTypeStretchLeg=51]="MetaTypeStretchLeg",e[e.MetaTypeRealtimeDenoise=52]="MetaTypeRealtimeDenoise",e[e.MetaTypeFigure=53]="MetaTypeFigure",e[e.MetaTypeFaceEffect=54]="MetaTypeFaceEffect",e[e.MetaTypeVideoTracking=55]="MetaTypeVideoTracking",e[e.MetaTypeHsl=56]="MetaTypeHsl",e[e.MetaTypeColorCurves=57]="MetaTypeColorCurves",e[e.MetaTypeAudioBalance=58]="MetaTypeAudioBalance",e[e.MetaTypeComposition=59]="MetaTypeComposition",e[e.MetaTypeCover=60]="MetaTypeCover",e[e.MetaTypeLeader=61]="MetaTypeLeader",e[e.MetaTypeTailer=62]="MetaTypeTailer",e[e.MetaTypePrimaryColorWheels=63]="MetaTypePrimaryColorWheels",e[e.MetaTypeLogColorWheels=64]="MetaTypeLogColorWheels",e[e.MetaTypeHandwriteImage=65]="MetaTypeHandwriteImage",e[e.MetaTypeHandwriteRes=66]="MetaTypeHandwriteRes",e[e.MetaTypeCombination=67]="MetaTypeCombination",e[e.MetaTypeManualDeformation=68]="MetaTypeManualDeformation",e[e.MetaTypePluginEffect=69]="MetaTypePluginEffect",e[e.MetaTypeAdCube=70]="MetaTypeAdCube",e[e.MetaTypeAll=71]="MetaTypeAll"}($t||($t={})),function(e){e[e.EffectPlatformLoki=0]="EffectPlatformLoki",e[e.EffectPlatformArtist=1]="EffectPlatformArtist",e[e.EffectPlatformBrand=2]="EffectPlatformBrand"}(Yt||(Yt={})),function(e){e[e.unknown=-1]="unknown",e[e.top=0]="top",e[e.dress=1]="dress"}(Xt||(Xt={}));const Zt=function(e){for(const t of e)O.getInstance().registerApi(t);return new Proxy({},{get(e,t){const i=O.getInstance().getApiMethod(t);if(i)return i}})}([new ye,new Fe,new $e,new dt,new kt,new St,new Wt,new qt]);var Qt=i(24380);class ei{constructor(){this.hostName={[n.b_.Default]:""},this._initLocker=new Qt.G}get userIDC(){return this._userIdc}updateRequestSetting(e){this.hostName=e.domain,this._userIdc=e.webIdc,this._userRegion=e.region,this._initLocker.hasBeenDone||this._initLocker.initDone()}async getUserRegion(){return await this._initLocker.awaitForInit(),this._userRegion}async getRequestDomain(e){await this._initLocker.awaitForInit();const{type:t}=Object.assign({},{type:n.b_.Default},e);return this.hostName[t]}}},75709:(e,t,i)=>{"use strict";i.d(t,{j:()=>a});var r=i(8757);const n={[r.xP.SalesSticker]:[r.Ms.EffectTypeSticker],[r.xP.SalesFont]:[r.Ms.EffectTypeFont],[r.xP.YkImage]:[r.Ms.EffectTypeImage]};function a(e){for(const[t,i]of Object.entries(n))if(i.includes(e))return t}},75924:(e,t,i)=>{"use strict";i.d(t,{EJ:()=>s,aW:()=>a,tv:()=>l});var r=i(8757);const n=e=>{var t,i;const[r,n]=null!==(t=e.image.large_images)&&void 0!==t?t:[],{id:a,effect_id:o,source:s,title:l,copyright:c,is_business:d,aspect_ratio:u}=e.common_attr;return{resourceId:a,effectId:o,source:s,cardUrl:r.image_url,width:r.width,height:r.height,previewUrl:null==n?void 0:n.image_url,orderInfo:e.order_info,title:l,copyrightName:null!==(i=null==c?void 0:c.copyright_text)&&void 0!==i?i:"Deposit",artistName:null==c?void 0:c.artist_name,copyrightLogo:null==c?void 0:c.copyright_logo,previewWidth:null==n?void 0:n.width,previewHeight:null==n?void 0:n.height,isCommercial:d,aspectRatio:u}},a=(e,t)=>e.map((e=>t?{...n(e),...t}:n(e))),o=e=>{var t;const[i]=null!==(t=e.image.large_images)&&void 0!==t?t:[],[r]=e.common_attr.item_urls,{id:n,effect_id:a,source:o,title:s,copyright:l,is_business:c,aspect_ratio:d}=e.common_attr;return{resourceId:n,effectId:a,source:o,cardUrl:i.image_url,width:i.width,height:i.height,previewUrl:r,orderInfo:e.order_info,title:s,copyrightName:null==l?void 0:l.copyright_text,artistName:null==l?void 0:l.artist_name,copyrightLogo:null==l?void 0:l.copyright_logo,isCommercial:c,aspectRatio:d}},s=(e,t)=>e.map((e=>t?{...o(e),...t}:o(e))),l=e=>{const{common_attr:t}=e;return t.source===r.iJ.TuChong?o(e):n(e)}},92312:(e,t,i)=>{"use strict";function r(e){let t="";t=e<102.4?`${e.toFixed(2)}B`:e<104857.6?`${(e/1024).toFixed(2)}KB`:e<1073741824?`${(e/1048576).toFixed(2)}MB`:e<1099511627776?`${(e/1073741824).toFixed(2)}GB`:`${(e/1099511627776).toFixed(2)}TB`;const i=`${t}`,r=i.indexOf(".");return"00"==i.substr(r+1,2)?i.substring(0,r)+i.substr(r+3,2):t}i.d(t,{y:()=>r})},91372:(e,t,i)=>{"use strict";i.d(t,{Il:()=>l,Zs:()=>g,tB:()=>m,GG:()=>w,Oo:()=>I,go:()=>h,aj:()=>v,nr:()=>u,KL:()=>d,ru:()=>c,aX:()=>_,xc:()=>T,Ox:()=>p});var r=i(8757);function n(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}var a=i(19111);const o=/(rgba?)\(\s*?(\d+?)\s*?,\s*?(\d+?)\s*?,\s*?(\d+?)\s*?(?:,\s*?((0\.)?\d+?)\s*)?\)/,s=/#([0-9a-fA-F]{6})([0-9a-fA-F]{2})?/;class l{constructor(e){if(this._v={r:0,b:0,g:0,a:1},"string"==typeof e){const t=o.exec(e);if(t){const[,e,i,r,n,a]=t;return void(this._v={r:Number(i),g:Number(r),b:Number(n),a:"rgb"===e?1:Number(a)})}const i=s.exec(e);if(i){const e=[],[,t]=i;for(let i=0;i<6;i+=2)e.push(parseInt(t.slice(i,i+2),16));this._v={r:e[0],g:e[1],b:e[2],a:1}}}else if(Array.isArray(e)){var t;const[i,r,n]=e.map((e=>e>1?e:Math.round(255*e)));this._v={r:i,g:r,b:n,a:null!==(t=e[3])&&void 0!==t?t:1}}else this._v={...e}}get r(){return this._v.r}set r(e){this._v.r=e}get g(){return this._v.g}set g(e){this._v.g=e}get b(){return this._v.b}set b(e){this._v.b=e}get a(){var e;return null!==(e=this._v.a)&&void 0!==e?e:1}set a(e){this._v.a=e}rgba(){return{...this._v}}hex(){const{r:e,g:t,b:i,a:r}=this._v;return`#${[e,t,i,null!=r?r:1].map(((e,t)=>{const i=Number(3===t?Math.round(255*e):e).toString(16);return 1===i.length?`0${i}`:i})).join("")}`}array(){const{r:e,g:t,b:i,a:r}=this._v,n=[e,t,i];return void 0!==r&&n.push(r),n}string(){const{r:e,g:t,b:i,a:r}=this._v;return void 0===r?`rgb(${e},${t},${i})`:`rgba(${e},${t},${i},${r})`}colorPick(){return{hex:this.hex(),rgb:this.rgba(),formatRGBA:this.string()}}}function c(e,t){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function d(e){if(!Array.isArray(e)||4!==e.length)return!1;for(let t=0;t<3;t++)if(!n(e[t])||e[t]<0||e[t]>255)return!1;return!(!n(e[3])||e[3]<0||e[3]>1)}function u(e){const t=null==e?void 0:e.type;return!![r.cF.LinearGradient,r.cF.RadialGradient].includes(t)}function h(e,t){return void 0===e&&void 0===t||(!!(d(e)&&d(t)&&c(e,t))||!!(u(e)&&u(t)&&function(e,t){return(0,a.v)(e,t)}(e,t)))}function p(e){const t=e[0]/255,i=e[1]/255,r=e[2]/255,n=Math.max(t,i,r),a=Math.min(t,i,r),o=(n+a)/2;let s=0,l=0;if(n===a)s=0,l=0;else{const e=n-a;switch(l=o>.5?e/(2-n-a):e/(n+a),n){case t:s=(i-r)/e+(i<r?6:0);break;case i:s=(r-t)/e+2;break;case r:s=(t-i)/e+4}s/=6}return[s,l,o,e[3]]}function f(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function y(e){const[t,i,r,n]=e;let a,o,s;if(0===i)a=r,o=r,s=r;else{const e=r<.5?r*(1+i):r+i-r*i,n=2*r-e;a=f(n,e,t+1/3),o=f(n,e,t),s=f(n,e,t-1/3)}return[Math.round(255*a),Math.round(255*o),Math.round(255*s),n]}function g(e,t,i=.5){if(!d(e)||isNaN(t))return e;if(e[0]!==e[1]||e[1]!==e[2])return e;const r=p(e);return t<i&&r[2]<i||t>i&&r[2]>i?y([r[0],r[1],1-r[2],r[3]]):e}const m=e=>e?Array.isArray(e)?{solid:e}:e.type===r.cF.LinearGradient?{linearGradient:e,gradient:e}:e.type===r.cF.RadialGradient?{radialGradient:e,gradient:e}:{}:{},_=e=>{const{solid:t}=m(e);return!!(t&&t[3]<1)};function v(e,t){const{solid:i,gradient:n}=m(e),{solid:a,gradient:o}=m(t);if(i||a){const e=null!=i?i:[-1,-1,-1,-1],t=null!=a?a:[-1,-1,-1,-1];for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!0}return!(!n&&!o)&&(!n||!o||(n.type===r.cF.LinearGradient&&o.type===r.cF.LinearGradient?!(n.rotation===o.rotation&&n.stops.length===o.stops.length&&n.stops.every(((e,t)=>!v(e.color,o.stops[t].color)&&e.offset===o.stops[t].offset))):n.type!==r.cF.RadialGradient||o.type!==r.cF.RadialGradient||!(n.center[0]===o.center[0]&&n.center[1]===o.center[1]&&n.radius[0]===o.radius[0]&&n.radius[1]===o.radius[1]&&n.stops.length===o.stops.length&&n.stops.every(((e,t)=>!v(e.color,o.stops[t].color)&&e.offset===o.stops[t].offset)))))}function I(e){const t=s.exec(e);if(t){const e=[],[,i,r]=t;for(let t=0;t<6;t+=2)e.push(parseInt(i.slice(t,t+2),16));return[e[0],e[1],e[2],parseInt(null!=r?r:"ff",16)/255]}return[0,0,0,0]}function T(e){return`#${e.map(((e,t)=>{const i=Number(3===t?Math.round(255*e):e).toString(16);return 1===i.length?`0${i}`:i})).join("")}`}const w=e=>{const{solid:t,linearGradient:i,radialGradient:r}=m(e);return t?T(t):i?`linear-gradient(${Math.round(i.rotation)}deg, ${i.stops.map((e=>`${w(e.color)} ${Math.round(100*e.offset)}%`)).join(", ")})`:r?`radial-gradient(${Math.round(100*r.radius[0])}% ${Math.round(100*r.radius[1])}%  at ${Math.round(100*r.center[0])}% ${Math.round(100*r.center[1])}%, ${r.stops.map((e=>`${w(e.color)} ${Math.round(100*e.offset)}%`)).join(", ")})`:""}},60110:(e,t,i)=>{"use strict";i.d(t,{GL:()=>r,QR:()=>n,oe:()=>a});const r=[255,255,255,1],n=[255,255,255,0],a="#ffffff00"},30920:(e,t,i)=>{"use strict";i.d(t,{H:()=>r});const r=1e-4},56185:(e,t,i)=>{"use strict";var r;i.d(t,{b:()=>r}),function(e){e.SelectAll="Select all",e.Copy="Copy",e.Paste="Paste",e.Cut="Cut",e.Undo="Undo",e.Redo="Redo",e.ViewShortcutList="View shortcut list",e.ZoomIn="Zoom in",e.ZoomOut="Zoom out",e.ZoomToFit="Zoom to fit",e.ZoomTo50Percent="Zoom to 50%",e.ZoomTo100Percent="Zoom to 100%",e.ZoomTo200Percent="Zoom to 200%",e.ScrollToZoom="Scroll to zoom",e.ScrollLeftOrRight="Scroll left or right",e.Move="Move",e.HandTool="Hand tool",e.SendBackward="Send backward",e.SendToBack="Send to back",e.BringForward="Bring forward",e.BringToFront="Bring to front",e.SelectOrInvertSelection="Select or invert selection",e.ShowOrHidePagePanel="Show/hide page panel",e.ShowOrHideRulers="Show/hide rulers",e.PreviousPage="Previous page",e.NextPage="Next page",e.DuplicatePage="Duplicate page",e.DeletePage="Delete page",e.DeepSelect="Deep select",e.MoveUp1px="Move up 1px",e.MoveDown1px="Move down 1px",e.MoveLeft1px="Move left 1px",e.MoveRight1px="Move right 1px",e.MoveUp10px="Move up 10px",e.MoveDown10px="Move down 10px",e.MoveLeft10px="Move left 10px",e.MoveRight10px="Move right 10px",e.Delete="Delete",e.Group="Group",e.Ungroup="Ungroup",e.DragAndHideSmartGuides="Drag and hide smart guides",e.MoveHorizontallyOrVertically="Move horizontally or vertically",e.ShowOrHidePanel="Show/hide material panel",e.Distance="Show distance between layers",e.AlignLeft="Align left",e.AlignCenter="Align center",e.AlignRight="Align right",e.AlignTop="Align top",e.AlignMiddle="Align middle",e.AlignBottom="Align bottom",e.LockOrUnLockLayer="Lock/Unlock layer",e.FlipHorizontal="Flip horizontal",e.FlipVertical="Flip vertical",e.EvenSpacingHorizontally="Even spacing horizontally",e.EvenSpacingVertically="Even spacing vertically",e.Bold="Bold",e.Italics="Italics",e.Underline="Underline",e.InsertText="Insert text",e.InsertRectangle="Insert rectangle",e.InsertCircle="Insert circle",e.InsertLine="Insert line",e.InsertArrow="Insert arrow",e.DragToCopy="Drag to copy"}(r||(r={}))},15516:(e,t,i)=>{"use strict";i.d(t,{$3:()=>n,G6:()=>a,ID:()=>h,KL:()=>l,_$:()=>u,internalEffectResource:()=>s,js:()=>o,s:()=>c,zZ:()=>d});var r=i(8757);const n="Internal_Filter",a=[r.vA.SATURATION,r.vA.BRIGHTNESS,r.vA.CONTRAST,r.vA.LIGHT_SENSATION,r.vA.EXPOSURE,r.vA.FADE,r.vA.HIGHLIGHT,r.vA.SHADOW,r.vA.TEMPERATURE,r.vA.TONE,r.vA.VIBRANCE,r.vA.OLITEXTURE,r.vA.GRAIN],o=a.reduce(((e,t)=>({...e,[t]:void 0})),{}),s={colorScheme:{id:"53061813",resourceId:"7259669436393591297"},lumiHub:{id:"75349634",resourceId:"7272983534673859074"}},l=Object.keys(s).reduce(((e,t)=>({...e,[s[t].resourceId]:t})),{}),c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwAQMAAABtzGvEAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAhOAAAITgBRZYxYAAAAAZQTFRFAAAA////pdmf3QAAAAJ0Uk5TFBRC584QAAAAF0lEQVR4nGNgYGD4//8/w6CnBt4FRFEAKFKPccE5jG0AAAAASUVORK5CYII=",d="backgroundDefaultTransparentGrid",u="backgroundDefaultWhite",h="backgroundColor"},7737:(e,t,i)=>{"use strict";i.d(t,{L:()=>n,P:()=>r});const r=50;var n;!function(e){e[e.Multi=0]="Multi",e[e.Single=1]="Single"}(n||(n={}))},22390:(e,t,i)=>{"use strict";i.d(t,{B:()=>r});const r="data-all-render-ready"},43825:(e,t,i)=>{"use strict";i.d(t,{$Y:()=>c,CT:()=>r,DI:()=>m,He:()=>l,I7:()=>x,Kt:()=>n,MY:()=>h,O1:()=>T,R0:()=>v,SQ:()=>w,YW:()=>o,cW:()=>y,du:()=>p,f$:()=>g,gX:()=>u,m_:()=>a,pn:()=>f,q2:()=>d,r9:()=>_,t9:()=>s,uj:()=>I,wS:()=>E});const r=.2,n=12,a=[0,0,0,1],o=[0,0,0,1],s=[0,0,0,1],l=[0,0,0,1],c=[1,1,1,1],d=.048,u=.04,h=.15,p=35,f=4,y=0,g=.5,m=1,_=.5,v=.008,I=10,T="textFontResource_",w=[0,0,0,1],E={actualMax:300,actualMin:5,displayMax:1500,displayMin:.05,scaleMax:5,scaleMin:.01},x=1e3},48607:(e,t,i)=>{"use strict";i.d(t,{C3:()=>c,Oo:()=>s,SA:()=>l,dV:()=>n,ln:()=>a,ly:()=>r,mg:()=>o,tV:()=>d});const r=1010,n=1e3,a=50,o=40,s=30,l=20,c=10,d=1e4},58236:(e,t,i)=>{"use strict";i.d(t,{ab:()=>c});var r=i(71230);const n=[],a=[],o=function(e){const[t,i,r]=e;i.call(t,...r)},s=i.n(r)()((()=>{for(;a.length;)o(a.shift());for(;n.length;)o(n.shift())})),l=function(e,t,i){i&&function(e,t,i){return e.some((e=>t===e[0]&&i===e[1]))}(e,t[0],t[1])||e.push(t)},c=(e=!0)=>function(t,i,r){const a=r.value;return r.value=function(...t){l(n,[this,a,t],e),s()},r}},92202:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});var r=i(66465);async function n({url:e,key:t}){var i;const n=await fetch(e),a=await n.arrayBuffer(),o=r.Buffer.from(t,"base64"),s=await window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:256},!1,["decrypt"]),l=a.slice(0,16),c=a.slice(16);return{buffer:await crypto.subtle.decrypt({name:"AES-CBC",iv:l,length:256},s,c),contentType:null!==(i=n.headers.get("content-type"))&&void 0!==i?i:""}}},49469:(e,t,i)=>{"use strict";i.d(t,{U:()=>a,s:()=>r});var r,n=i(67986);!function(e){e.METHOD="_method",e.GETTER="_getter",e.SETTER="_setter"}(r||(r={}));class a{constructor(e,t){this._methods=new Set,this._getters=new Set,this._setters=new Set,this._proto=e,this._target=t}static delegates(e,t,i){const r=new a(e,t);return Object.entries(i).forEach((([e,t])=>{r[t](e)})),r}_method(e){this._methods.has(e)&&n.t.error("[common][delegator]\u51fa\u73b0\u76f8\u540c\u7684\u65b9\u6cd5\u540d"),this._methods.add(e);const{_target:t}=this;return this._proto[e]=function(...i){return this[t][e](...i)},this}_getter(e){this._getters.add(e);const{_target:t}=this;return Object.defineProperty(this._proto,e,{get(){return this[t][e]}}),this}_setter(e){this._setters.add(e);const{_target:t}=this;return Object.defineProperty(this._proto,e,{set(i){return this[t][e]=i}}),this}}},27688:(e,t,i)=>{"use strict";i.d(t,{g:()=>s});var r=i(22647),n=i.n(r),a=i(84616),o=i.n(a);function s(){const e=function(e){const t=n().random(4*e).toString(),i=o().parse(t),r=new Uint32Array(e);for(let n=0;n<e;n++){const e=4*n;r[n]=i.words[e/4]}return r}(8);let t=0;return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(i=>{const r=e[t>>3]>>t%8*4&15;return t++,("x"===i?r:3&r|8).toString(16)}))}},43382:(e,t,i)=>{"use strict";i.d(t,{G:()=>r,S:()=>n});const r=()=>{};class n{constructor(){this._disposeSets=new Set}add(...e){e.forEach((e=>this._disposeSets.add(e)))}clear(){Array.from(this._disposeSets).forEach((e=>e())),this._disposeSets.clear()}}},52034:(e,t,i)=>{"use strict";i.d(t,{J:()=>n});var r=i(43382);class n{constructor(){this._store=new r.S}destroy(){this._store.clear()}_register(e){this._store.add(e)}}},55900:(e,t,i)=>{"use strict";i.d(t,{j:()=>n});const r=new(i(95411).Z);class n{constructor(){this._eventName=Symbol(),this.event=(e,t)=>{const i={filter:t,callback:e},n=t=>{i.filter&&!i.filter(t)||e(t)};return r.on(this._eventName,n),()=>{r.removeListener(this._eventName,n)}},this.once=(e,t)=>{const i={filter:t,callback:e};r.once(this._eventName,(t=>{i.filter&&!i.filter(t)||e(t)}))},this.fire=e=>{r.emit(this._eventName,e)}}}},16172:(e,t,i)=>{"use strict";function r(e){return URL.createObjectURL(e)}i.d(t,{S:()=>r})},9561:(e,t,i)=>{"use strict";i.d(t,{$k:()=>a,H1:()=>n,NF:()=>r,VC:()=>o,l_:()=>s});const r=(()=>{const e={file:{acceptType:[],acceptSuffix:[]},video:{acceptType:[],acceptSuffix:[]},audio:{acceptType:[],acceptSuffix:[]},image:{acceptType:["image/jpeg","image/jpg","image/png","image/heif","image/heic","image/avif","image/vnd.adobe.photoshop","image/svg+xml","image/bmp","image/tiff","image/webp","image/x-icon"],acceptSuffix:[".jpeg",".jpg",".png",".heif",".heic",".avif",".psd",".svg",".bmp",".tif",".tiff",".webp",".ico"]}},t=t=>[...e[t].acceptType,...e[t].acceptSuffix].join(",");return{file:{...e.file,accept:t("file")},video:{...e.video,accept:t("video")},audio:{...e.audio,accept:t("audio")},image:{...e.image,accept:t("image")},allAccept:`${t("video")},${t("audio")},${t("image")}`}})();function n({file:e,accepts:t=["video","audio","image"]}){const i=function({file:e,accepts:t=["audio","video","image"]}){const i=e.name.lastIndexOf(".");let n="";if(-1!==i&&(n=e.name.substr(i)),n)for(const o of t)if(r[o].acceptSuffix.includes(n.toLocaleLowerCase()))return o;const a=e.type.toLocaleLowerCase();if(a)for(const o of t)if(r[o].acceptType.includes(a))return o}({file:e,accepts:t});return Boolean(i)}function a(){return r.image.acceptType.reduce(((e,t)=>(e[t]=r.image.acceptSuffix,e)),{})}function o(e,t){const i=a();return Object.entries(i).some((([i,r])=>e===i||r.includes(t)))}function s({files:e,accepted:t,rejected:i}){for(const r of e){const e=r.type,n=`.${r.name.toLowerCase().split(".").pop()}`,o=a();Object.entries(o).some((([t,i])=>e===t||i.includes(n)))?t(r):i(r)}}},12229:(e,t,i)=>{"use strict";i.d(t,{$D:()=>a,Pl:()=>o,_1:()=>n,vz:()=>s});var r=i(17529);function n(e,t,i){return{x:i.x+(e.x-i.x)*Math.cos(t)-(e.y-i.y)*Math.sin(t),y:i.y+(e.x-i.x)*Math.sin(t)+(e.y-i.y)*Math.cos(t)}}function a(e,t,i){const r=i.x+(e.x-i.x)*Math.cos(t)-(e.y-i.y)*Math.sin(t),n=i.y+(e.x-i.x)*Math.sin(t)+(e.y-i.y)*Math.cos(t);return{...e,rotation:e.rotation+t,x:r,y:n}}function o(e,t){const i=function(e){return{x:e.x+e.width/2*Math.cos(e.rotation)+e.height/2*Math.sin(-e.rotation),y:e.y+e.height/2*Math.cos(e.rotation)+e.width/2*Math.sin(e.rotation)}}(e);return a(e,t,i)}const s=e=>{const{width:t,height:i,path:n}=e,a=new r.OU(n).normalizeHVZ(),{minX:o,minY:s,maxX:l,maxY:c}=a.getBounds(),d=l-o,u=c-s;return a.scale(t/d,i/u)}},10224:(e,t,i)=>{"use strict";function r(e,t,i){const r={...i},{x:n=0,y:a=0,width:o=0,height:s=0}=i,l=o/s,c=t.width-e.width,d=Math.abs(n);return d<c?(r.width=o+Math.abs(c-d),r.height=r.width/l,r.x=0,r.y=a-(r.height-s)/2):r.x=n+c,{...t,clipRect:r}}function n(e,t,i){const r={...i},{x:n=0,y:a=0,width:o=0,height:s=0}=i,l=o/s,c=t.width-e.width,d=o-(Math.abs(n)+e.width);return d<c&&(r.width=o+Math.abs(c-d),r.height=r.width/l,r.x=t.width-r.width,r.y=a-(r.height-s)/2),{...t,clipRect:r}}function a(e,t,i){const r={...i},{x:n=0,y:a=0,width:o=0,height:s=0}=i,l=o/s,c=t.height-e.height,d=s-(Math.abs(a)+e.height);return d<c&&(r.height=s+Math.abs(c-d),r.width=r.height*l,r.y=t.height-r.height,r.x=n-(r.width-o)/2),{...t,clipRect:r}}function o(e,t,i){const r={...i},{x:n=0,y:a=0,width:o=0,height:s=0}=i,l=o/s,c=t.height-e.height,d=Math.abs(a);return d<c?(r.height=s+Math.abs(c-d),r.width=r.height*l,r.y=0,r.x=n-(r.width-o)/2):r.y=a+c,{...t,clipRect:r}}function s(e,t,i){const{clipRect:n}=r(e,t,i);return o(e,t,null!=n?n:i)}function l(e,t,i){const{clipRect:r}=n(e,t,i);return o(e,t,null!=r?r:i)}function c(e,t,i){const{clipRect:n}=r(e,t,i);return a(e,t,null!=n?n:i)}function d(e,t,i){const{clipRect:r}=n(e,t,i);return a(e,t,null!=r?r:i)}i.d(t,{U:()=>F});var u=i(17529),h=i(12229);const p=(e,t)=>{const{width:i=0,height:r=0,clipRect:n}=e,a=n?{width:n.width*t.x,height:n.height*t.y,x:n.x*t.x,y:n.y*t.y}:void 0;return{...e,width:i*t.x,height:r*t.y,clipRect:a}},f=e=>{const{rotation:t=0,width:i=0,height:r=0,x:n=0,y:a=0,clipRect:o}=e,s={x:n,y:a};if(!o)return s;if(s.x=n+o.x,s.y=a+o.y,0!==t){const e=t*Math.PI/180,l={...(0,h._1)(s,e,{x:n+i/2,y:a+r/2}),width:o.width,height:o.height,rotation:e},c=(0,h.Pl)(l,-t*Math.PI/180);s.x=c.x,s.y=c.y}return s},y=e=>{const{clipRect:t}=e;return t?{...e,...f({...e}),width:t.width,height:t.height,clipRect:void 0}:e},g=(e,t,i,r)=>{const n=r?(0,h.vz)({width:t,height:i,path:r}):new u.OU(`M0,0L${t},0L${t},${i}L0,${i}L0,0`),{minX:a,minY:o}=n.getBounds(),s=n.rotate(-e*Math.PI/180,t/2,i/2),{minX:l,minY:c,maxX:d,maxY:p}=s.getBounds();return{pathBox:{width:d-l,height:p-c},ltPointOffset:{x:l-a,y:c-o}}},m=(e,t,i,r)=>{const n=null!=r?r:0,{pathBox:a,ltPointOffset:o}=g(n,e,t,i),s=0,l=0;return{...(0,h._1)({x:s+o.x,y:l+o.y},n*Math.PI/180,{x:s+e/2,y:l+t/2}),...a}},_=(e,t,i,r)=>{const n=null!=r?r:0,a=m(e,t,i,n),{rotation:o,...s}=(0,h.Pl)({...a,rotation:n*Math.PI/180},-n*Math.PI/180);return s},v=(e,t)=>{if(!t)return;return((e,t)=>{var i,r;const{scale:n={x:1,y:1}}=t,a={...p(t,n),scale:{x:1,y:1}},o=null!==(i=a.width)&&void 0!==i?i:0,s=null!==(r=a.height)&&void 0!==r?r:0,l=Math.max(e.width/o,e.height/s),c={...p(a,{x:l,y:l}),x:e.x+(e.width-o*l)/2,y:e.y+(e.height-s*l)/2};return y(c)})(_(e.width,e.height,e.path,t.rotation),t)};var I=i(30920);const T=(e,t,i)=>{const{rotation:r=0,width:n=0,height:a=0,x:o=0,y:s=0,clipRect:l}=e,c=_(t.width,t.height,t.path,r);if(!((e,t)=>{const i=Math.abs(e.width-t.width),r=Math.abs(e.height-t.height);return i>I.H||r>I.H})({width:n,height:a},{width:c.width,height:c.height})||i)return e;const d=c.width/n,u=c.height/a,h=l?{x:l.x*d,y:l.y*u,width:l.width*d,height:l.height*u}:void 0;return{...e,x:o*d,y:s*u,width:n*d,height:a*u,clipRect:h?{...h}:void 0}},w=(e,t=!1)=>{const{items:i}=e;return{...e,items:i.map((e=>((e,t)=>{const{layout:i,fill:r,path:n}=e,{image:a}=r;if(!a)return e;const o=T(a.layout,{width:i.width,height:i.height,path:n},t),s=y(o);return a.layout={...s},{...e,fill:{...e.fill,image:{...a}}}})(e,t)))}},E=e=>(0,h.vz)(e).encode();var x=i(60551),b=i(65047);const R=e=>{if(0===e.length)return{width:0,height:0,x:0,y:0};let t=e[0].x,i=e[0].x,r=e[0].y,n=e[0].y;return e.forEach((e=>{t=Math.min(e.x,t),i=Math.max(e.x,i),r=Math.min(e.y,r),n=Math.max(e.y,n)})),{x:t,y:r,width:i-t,height:n-r}},k=e=>{const{width:t,height:i,areas:r,points:n,spacing:{horizontal:a,vertical:o},radius:s=0}=e,l=new Map;n.forEach((e=>{l.set(e.id,{x:t*e.x,y:i*e.y})}));const c=t*a/(t+a),d=i*o/(i+o),u=a?c/a:1,p=o?d/o:1,f=r.map((e=>{const t=e.points.map((e=>l.get(e))),i=R(t),r=(i.width-c)/u,n=(i.height-d)/p,a=((e,t={x:0,y:0,width:0,height:0},i)=>{if(0===e.length)return"";let r="";for(const[a,{x:o,y:s}]of e.reverse().entries())r+=0===a?`M${o-t.x}, ${s-t.y}`:`L${o-t.x}, ${s-t.y}`;r+=`L${e[0].x-t.x}, ${e[0].y-t.y}`;const n=(0,h.vz)({width:t.width,height:t.height,path:r}).encode();return(0,b.J)(n,2*i)})(t,{x:i.x,y:i.y,width:r,height:n},s);return{...e,layout:{x:i.x/u,y:i.y/p,width:r,height:n},path:a}}));return f},A=e=>{const{width:t,height:i,areas:r,points:n,spacing:{horizontal:a,vertical:o}}=e,s=new Map;n.forEach((e=>{s.set(e.id,{x:e.x,y:e.y})}));let l=1,c=1;r.forEach((e=>{const t=e.points.map((e=>s.get(e))),i=R(t);l=Math.min(i.width,l),c=Math.min(i.height,c)}));return{minRect:{width:(1+a-a*l)/l,height:(1+o-o*c)/c},maxSpacing:{horizontal:l<1?(l*t-1)/(1-l):100,vertical:c<1?(c*i-1)/(1-c):100}}};var P=i(8757);const M=1e-6;var L;!function(e){e[e.width=0]="width",e[e.height=1]="height"}(L||(L={}));const S=[P.Py,P.DA,P.XE,P.Wk],C=(e,t,i)=>S.includes(e)?((e,t,i)=>{var r,n;if(i.fill.fillType!==P.kl.IMAGE)return;const a=i.fill.image,o=m(t.layout.width,t.layout.height,t.path,null!==(r=a.layout.rotation)&&void 0!==r?r:0),s=m(i.layout.width,i.layout.height,i.path,null!==(n=a.layout.rotation)&&void 0!==n?n:0),l=i.layout.width-t.layout.width,c=i.layout.height-t.layout.height,{x:d=0,y:u=0,width:p=0,height:f=0,rotation:y=0}=a.layout,g={imageBox:{...(0,h.Pl)({x:d,y:u,width:p,height:f,rotation:0},y*Math.PI/180),rotation:y},pathBoxLayout:o,newPathBoxLayout:s,increase:[P.Wk,P.XE].includes(e)?l:c,parentRect:{width:t.layout.width,height:t.layout.height}};let _=x.G.RIGHT;return P.XE===e&&(_=x.G.LEFT),P.Py===e&&(_=x.G.TOP),P.DA===e&&(_=x.G.BOTTOM),(0,x.K)(g,_)})(e,t,i):((e,t,i)=>{var r,n;if(i.fill.fillType!==P.kl.IMAGE)return;const a=i.fill.image,{width:o,height:s}=i.layout;let{width:l,height:c}=t.layout;const d=o-l,u=s-c,p=Math.abs(d)>Math.abs(u)?s/c:o/l;l*=p,c*=p;const f=Math.abs(d)>Math.abs(u)?L.width:L.height,y=Math.abs(d)>Math.abs(u)?o-l:s-c,g=m(l,c,t.path,null!==(r=a.layout.rotation)&&void 0!==r?r:0),_=m(o,s,i.path,null!==(n=a.layout.rotation)&&void 0!==n?n:0),{x:v=0,y:I=0,width:T=0,height:w=0,rotation:E=0}=a.layout,b={imageBox:{...(0,h.Pl)({x:v*p,y:I*p,width:T*p,height:w*p,rotation:0},E*Math.PI/180),rotation:E},pathBoxLayout:g,newPathBoxLayout:_,increase:y,parentRect:{width:l,height:c}};let R=x.G.RIGHT;switch(e){case P.EK:R=f===L.width?x.G.RIGHT:x.G.TOP;break;case P.nh:R=f===L.width?x.G.LEFT:x.G.TOP;break;case P.ng:R=f===L.width?x.G.LEFT:x.G.BOTTOM;break;case P.Z0:default:R=f===L.width?x.G.RIGHT:x.G.BOTTOM}return(0,x.K)(b,R)})(e,t,i),O=e=>{const{rect:t,oldRect:i,points:r,areas:n,spacing:a,radius:o,oldSpacing:s,anchor:l,dpr:c=1}=e,d=k({...t,areas:n,points:r,spacing:a,radius:o*c}),u=k({...i,areas:n,points:r,spacing:null!=s?s:a,radius:o*c});if(!d||!u)return{layout:t};return{layout:t,items:d.map((e=>{const{id:t}=e,i=u.find((e=>e.id===t));if(!i)return e;const r=C(null!=l?l:((e,t)=>{const i=Math.abs(t.layout.width-e.layout.width),r=Math.abs(t.layout.height-e.layout.height);return i<M&&r>M?P.DA:i<M&&r>M?P.Wk:P.Z0})(i,e),i,e);return{...e,fillLayout:r}})).filter((e=>void 0!==e))}};const F=new class{constructor(){this.calImageLayoutToFillContainer=v,this.calPathBoxLayout=_,this.calPathBoxLayoutOfRotation=m,this.getPathBoxOfRotation=g,this.scalePath=E,this.calGridScaling=O,this.calGridLimit=A,this.transformImageContainerData=w,this.calLeftNonScaling=r,this.calRightNonScaling=n,this.calBottomNonScaling=a,this.calTopNonScaling=o,this.callLeftTopScaling=s,this.callRightTopScaling=l,this.callLeftBottomScaling=c,this.callRightBottomScaling=d,this.calContainerNonUniformScaling=x.K,this.calGridAreaLayouts=k}}},60551:(e,t,i)=>{"use strict";i.d(t,{G:()=>l,K:()=>h});var r=i(12229);const n=e=>{const{imageBox:t,newPathRect:i,pathRect:r,increase:n}=e,{x:a,y:o,width:s,height:l,rotation:c}=t,d={x:a,y:o,width:s,height:l},u=s/l,h=i.width-r.width,p=Math.abs(h/n),f=s-(Math.abs(a)+r.width),y=i.height-r.height,g=Math.abs(y/n),m=l-(Math.abs(o)+r.height);if(f>=h&&m>=y)return d;if(m/g>=f/p){if(d.width=s+Math.abs(h-f),d.height=d.width/u,d.x=i.width-d.width,d.y=o-(d.height-l)/2,Math.abs(d.y)+i.height>d.height){const e=Math.abs(d.y)+i.height,t=e*u;d.x=d.x-(t-d.width)/2,d.y=i.height-e,d.width=t,d.height=e}}else if(d.height=l+Math.abs(y-m),d.width=d.height*u,d.y=i.height-d.height,d.x=a-(d.width-s)/2,Math.abs(d.x)+i.width>d.width){const e=Math.abs(d.x)+i.width,t=e/u;d.y=d.y-(t-d.height)/2,d.x=i.width-e,d.width=e,d.height=t}return d},a=e=>{const{imageBox:t,newPathRect:i,pathRect:r,increase:n}=e,{x:a,y:o,width:s,height:l,rotation:c}=t,d={x:a,y:o,width:s,height:l},u=s/l,h=i.width-r.width,p=Math.abs(h/n),f=s-(Math.abs(a)+r.width),y=i.height-r.height,g=Math.abs(y/n),m=Math.abs(o),_=m/g>=f/p;if(f>=h&&m>=y)return d.y=o+y,d;if(_){if(d.width=s+Math.abs(h-f),d.height=d.width/u,d.x=i.width-d.width,d.y=o+y-(d.height-l)/2,d.y>0){const e=d.y+d.height,t=e*u;d.x=d.x-(t-d.width)/2,d.y=0,d.width=t,d.height=e}}else if(d.height=l+Math.abs(y-m),d.width=d.height*u,d.y=0,d.x=a-(d.width-s)/2,Math.abs(d.x)+i.width>d.width){const e=Math.abs(d.x)+i.width,t=e/u;d.y=d.y-(t-d.height)/2,d.x=i.width-e,d.width=e,d.height=t}return d},o=e=>{const{imageBox:t,newPathRect:i,pathRect:r,increase:n}=e,{x:a,y:o,width:s,height:l,rotation:c}=t,d={x:a,y:o,width:s,height:l},u=s/l,h=i.width-r.width,p=Math.abs(h/n),f=Math.abs(a),y=i.height-r.height,g=Math.abs(y/n),m=l-(Math.abs(o)+r.height),_=m/g>=f/p;if(f>=h&&m>=y)return d.x=a+h,d;if(_){if(d.width=s+Math.abs(h-f),d.height=d.width/u,d.x=0,d.y=o-(d.height-l)/2,Math.abs(d.y)+i.height>d.height){const e=Math.abs(d.y)+i.height,t=e*u;d.x=d.x-(t-d.width)/2,d.y=i.height-e,d.width=t,d.height=e}}else if(d.height=l+Math.abs(y-m),d.width=d.height*u,d.y=i.height-d.height,d.x=a+h-(d.width-s)/2,d.x>0){const e=Math.abs(d.x)+d.width,t=e/u;d.y=d.y-(t-d.height)/2,d.x=0,d.width=e,d.height=t}return d},s=e=>{const{imageBox:t,newPathRect:i,pathRect:r,increase:n}=e,{x:a,y:o,width:s,height:l,rotation:c}=t,d={x:a,y:o,width:s,height:l},u=s/l,h=i.width-r.width,p=Math.abs(h/n),f=Math.abs(a),y=i.height-r.height,g=Math.abs(y/n),m=Math.abs(o),_=m/g>=f/p;if(f>=h&&m>=y)return d.x=a+h,d.y=o+y,d;if(_){if(d.width=s+Math.abs(h-f),d.height=d.width/u,d.x=0,d.y=o+y-(d.height-l)/2,d.y>0){const e=d.y+d.height,t=e*u;d.x=d.x-(t-d.width)/2,d.y=0,d.width=t,d.height=e}}else if(d.height=l+Math.abs(y-m),d.width=d.height*u,d.y=0,d.x=a+h-(d.width-s)/2,d.x>0){const e=Math.abs(d.x)+d.width,t=e/u;d.y=d.y-(t-d.height)/2,d.x=0,d.width=e,d.height=t}return d};var l;function c(e){const{rotation:t}=e.imageBox,i=Math.round(t);return i>=-180&&i<-90?o(e):i>=-90&&i<=0?n(e):i>0&&i<=90?a(e):s(e)}!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.TOP=2]="TOP",e[e.BOTTOM=3]="BOTTOM"}(l||(l={}));const d=(e,t,i)=>{const{width:n,height:a,x:o,y:s}=(0,r.Pl)({...t,rotation:i*Math.PI/180},-i*Math.PI/180),l={x:o,y:s};if(l.x=o+e.x,l.y=s+e.y,0!==i){const t=i*Math.PI/180,c={...(0,r._1)(l,t,{x:o+n/2,y:s+a/2}),width:e.width,height:e.height,rotation:t},d=(0,r.Pl)(c,-i*Math.PI/180);l.x=d.x,l.y=d.y}return{...e,...l}},u=(e,t,i)=>{const n={x:i.width/2,y:i.height/2},{rotation:a}=e,o=-a*Math.PI/180,s=(0,r.$D)(e,o,n),l=(0,r.$D)({...t,rotation:a},o,n);return{...e,x:s.x-l.x,y:s.y-l.y}};function h(e,t){const{newPathBoxLayout:i,imageBox:r,pathBoxLayout:h,parentRect:p,increase:f}=e,y={imageBox:u(r,h,p),pathRect:{width:h.width,height:h.height},newPathRect:{width:i.width,height:i.height},increase:f};let g;switch(t){case l.LEFT:g=function(e){const{rotation:t}=e.imageBox,i=Math.round(t);return i>=-180&&i<-90?a(e):i>=-90&&i<=0?s(e):i>0&&i<=90?o(e):n(e)}(y);break;case l.RIGHT:g=c(y);break;case l.TOP:g=function(e){const{rotation:t}=e.imageBox,i=Math.round(t);return i>=-180&&i<-90?n(e):i>=-90&&i<=0?a(e):i>0&&i<=90?s(e):o(e)}(y);break;case l.BOTTOM:g=function(e){const{rotation:t}=e.imageBox,i=Math.round(t);return i>=-180&&i<-90?s(e):i>=-90&&i<=0?o(e):i>0&&i<=90?n(e):a(e)}(y);break;default:g=c(y)}return d(g,i,r.rotation)}},76326:(e,t,i)=>{"use strict";i.d(t,{F:()=>o});var r=i(8757),n=i(54643);const a=(e,t)=>{const i=Number(e).toFixed(t);return Number(i)},o=(e,t,i=r.fb.PX)=>{if(!e||!t)return;const o=e>n.Xk||t>n.Xk,s=e<n.Uw||t<n.Uw;if(o){const[o,s]=((e,t)=>{if(e>t){const i=e/n.Xk;return[n.Xk,t/i]}return[e/(t/n.Xk),n.Xk]})(e,t);return{width:a(o),height:a(s),unit:null!=i?i:r.fb.PX}}if(s){const[o,s]=((e,t)=>{if(e>t)return[e*(n.Uw/t),n.Uw];const i=n.Uw/e;return[n.Uw,t*i]})(e,t);return{width:a(o),height:a(s),unit:null!=i?i:r.fb.PX}}return{width:a(e),height:a(t),unit:null!=i?i:r.fb.PX}}},6884:(e,t,i)=>{"use strict";function r(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,i.drawImage(e,0,0);const r=i.getImageData(0,0,e.width,e.height);let n=e.width,a=0,o=e.height,s=0;for(let l=0;l<(null==r?void 0:r.data.length);l+=4){if((null==r?void 0:r.data[l+3])/255>=.05){const t=Math.floor(l/4%e.width),i=Math.floor(l/4/e.width);n=Math.min(n,t),a=Math.max(a,t),o=Math.min(o,i),s=Math.max(s,i)}}return{x:n,y:o,width:a-n,height:s-o}}i.d(t,{n:()=>r})},14415:(e,t,i)=>{"use strict";i.d(t,{p:()=>o});var r=i(65748),n=i(34269);const a=new r.z6({_capacity:1e3,_cacheKey:n.or}),o=e=>new Promise((t=>{let i=a.get(e);i?t(i):(i=new Image,i.crossOrigin="anonymous",i.onload=function(){a.set(i.getAttribute("src"),i),t(i)},i.onerror=()=>{a.remove(e),t(null)},i.src=e)}))},8091:(e,t,i)=>{"use strict";i.d(t,{I:()=>r});const r=(e,t)=>{var i;const r=Object.values(e);let n,a,o=Number.MAX_SAFE_INTEGER,s=0;for(const l of r){const e=l.width*l.height;e>=t&&(!n||e<o)&&(n=l,o=e),e<=t&&(!a||e>s)&&(a=l,s=e)}return null!==(i=n)&&void 0!==i?i:a}},33955:(e,t,i)=>{"use strict";i.d(t,{U:()=>c});const r=Symbol("state");function n(e){return e.mutated?e.draftValue:e.originalValue}function a(e,t){if(Array.isArray(e))for(let i=0;i<t.length;i++)i in e||(e[i]=t[i]);else Reflect.ownKeys(t).forEach((i=>{const r=Object.getOwnPropertyDescriptor(t,i);i in e||Object.defineProperty(e,i,r)}))}function o(e){const{originalValue:t,draftValue:i,mutated:r,onWrite:n}=e;r||(e.mutated=!0,n&&n(i),a(i,t))}function s(e,t,i){const{originalValue:r,draftValue:n,onWrite:o}=i;return l(e,(e=>{n.mutated||(i.mutated=!0,a(n,r)),n[t]=e,o&&o(n)}))}function l(e,t){const i=Array.isArray(e)?[]:(a=e,Object.create(Object.getPrototypeOf(a)));var a;const l=Object.create(null),c={originalValue:e,draftValue:i,mutated:!1,onWrite:t};return new Proxy(e,{get:(t,n,a)=>n===r?c:n in l?l[n]:"object"==typeof e[n]&&null!==e[n]?(l[n]=s(e[n],n,c),l[n]):c.mutated?i[n]:Reflect.get(t,n,a),set:(e,t,r)=>("object"==typeof r&&(l[t]=s(r,t,c)),o(c),i[t]=r,!0),has:(e,...t)=>Reflect.has(n(c),...t),ownKeys:(e,...t)=>Reflect.ownKeys(n(c),...t),getOwnPropertyDescriptor:(e,...t)=>Reflect.getOwnPropertyDescriptor(n(c),...t),getPrototypeOf:(t,...i)=>Reflect.getPrototypeOf(e,...i),deleteProperty:(e,...t)=>(o(c),Reflect.deleteProperty(i,...t)),defineProperty:(e,...t)=>(o(c),Reflect.defineProperty(i,...t)),setPrototypeOf:(e,...t)=>(o(c),Reflect.setPrototypeOf(i,...t))})}function c(e,t){const i=l(e);t(i);const{originalValue:n,draftValue:a,mutated:o}=i[r];return o?a:n}},24380:(e,t,i)=>{"use strict";i.d(t,{G:()=>r});class r{constructor(){this._hasBeenDone=!1,this._isIniting=!1,this._initCostTimes=void 0,this._waitingResolvers=new Set,this._waitingResolverMap=new Map}get hasBeenDone(){return this._hasBeenDone}get costTimes(){if(!this._initCostTimes)return;const{start:e,end:t}=this._initCostTimes;return(null!=t?t:Date.now())-e}get initResult(){if(this._hasBeenDone)return{resolve:this._resolveResult,reject:this._rejectResult}}get isIniting(){return this._isIniting}awaitForInit({key:e,timeout:t}={}){if(this._hasBeenDone&&this.initResult){const{resolve:e,reject:t}=this.initResult;return t?Promise.reject(t):Promise.resolve(e)}if(e&&this._waitingResolverMap.has("key"))return this._waitingResolverMap.get("key");if(!t){const t=new Promise(((e,t)=>{this._waitingResolvers.add([e,t])}));return e&&this._waitingResolverMap.set(e,t),t}let i,r;const n=Promise.race([new Promise(((e,t)=>{i=[()=>{clearTimeout(r),e()},t],this._waitingResolvers.add([i,t])})),new Promise(((e,n)=>{r=setTimeout((()=>{this._waitingResolvers.delete(i),n(new Error("Timed out waiting for init"))}),t)}))]);return e&&this._waitingResolverMap.set(e,n),n}startToInit(){return!this._hasBeenDone&&(!this._isIniting&&(this._isIniting=!0,this._initCostTimes={start:Date.now()},!0))}initDone(e){if(this._hasBeenDone)throw new Error("Cannot release an inited locker");this._initCostTimes&&(this._initCostTimes.end=Date.now());let t=!1;null!=e&&e.reject?(t=!0,this._rejectResult=e.reject):this._resolveResult=null==e?void 0:e.resolve;for(const i of this._waitingResolvers)t?i[1](this._rejectResult):i[0](this._resolveResult);this._waitingResolverMap.clear(),this._waitingResolvers.clear(),this._hasBeenDone=!0,this._isIniting=!1}}},54643:(e,t,i)=>{"use strict";i.d(t,{$S:()=>s,BE:()=>o,Ln:()=>l,NW:()=>c,SY:()=>d,Uw:()=>a,Xk:()=>n});var r=i(8757);const n=5e3,a=60;function o(e,t=96){return e/(2.54/t)}function s(e,t=96){return e/(t/2.54)}function l(e,t=!1){let{width:i,height:n}=e;return e.unit===r.fb.CM&&(i=o(e.width),n=o(e.height)),t&&(i=Math.round(i),n=Math.round(n)),{width:i,height:n,unit:r.fb.PX}}function c(e,t,i){const n=i===r.ms.ASPECT_FILL?Math.max(e.width/t.width,e.height/t.height):Math.min(e.width/t.width,e.height/t.height);return{x:(e.width-t.width*n)/2,y:(e.height-t.height*n)/2,width:t.width*n,height:t.height*n,transformScale:n}}function d(e,t){const i=t?t.width/t.height:1,r=e.width/e.height<i?{width:e.width,height:e.width/i}:{width:e.height*i,height:e.height};return{x:e.width/2-r.width/2,y:e.height/2-r.height/2,...r}}},67986:(e,t,i)=>{"use strict";var r;i.d(t,{t:()=>s});const n=function(){},a=Object.keys(console).reduce(((e,t)=>(e[t]=n,e)),{});class o{static setLogInstance(e){this._instance=e}static setEnvironmentFlag(e){o._isProductionEnv=e}static debug(e,...t){o._isProductionEnv||o._instance.debug(e,...t)}static log(e,...t){o._isProductionEnv||o._instance.log(e,...t)}static error(e,...t){o._instance.error(e,...t)}static info(e,...t){o._instance.info(e,...t)}static time(e){o._isProductionEnv||o._instance.time(e)}static timeEnd(e){o._isProductionEnv||o._instance.timeEnd(e)}static warn(e,...t){o._instance.warn(e,...t)}static hideConsole(){i.g.console=a,o.setLogInstance(a)}static showConsole(){i.g.console=o._console,o.setLogInstance(o._console)}}(r=o)._instance=a,r._isProductionEnv=!0,r._console=console,i.g.showConsole=o.showConsole,i.g.hideConsole=o.hideConsole;const s=o},65748:(e,t,i)=>{"use strict";i.d(t,{z6:()=>r});class r{constructor(e){this.db=new Map,this._cacheKey=e._cacheKey,this._capacity=e._capacity;const{db:t}=e;t&&(this.db=t)}get(e){const t=this.getCache();if(t.FIFO.includes(e)){const i=t.data[e];return this._resetKeyByFIFO(t,e),i}}set(e,t){const i=this._put(e,t);this.db.set(this._cacheKey,i)}remove(e){const t=this.getCache();delete t.data[e],this._removeKeyByFIFO(t,e),this.db.set(this._cacheKey,t)}getCache(){const e=this.db.get(this._cacheKey);return e||this._generateCache()}_put(e,t){const i=this.getCache();i.data[e]=t;const r=this._resetKeyByFIFO(i,e),n=r.FIFO.length;if(void 0!==this._capacity&&n>this._capacity){const e=r.FIFO[n-1];e&&(r.FIFO.pop(),delete r.data[e])}return r}_removeKeyByFIFO(e,t){const i=e.FIFO.indexOf(t);return-1!==i&&e.FIFO.splice(i,1),e}_resetKeyByFIFO(e,t){const i=this._removeKeyByFIFO(e,t);return i.FIFO.unshift(t),i}_generateCache(){return{FIFO:[],data:{}}}}},34269:(e,t,i)=>{"use strict";i.d(t,{KU:()=>n,RE:()=>r,bW:()=>a,or:()=>c,q2:()=>s,qh:()=>o,rj:()=>l,vw:()=>d,zB:()=>u});const r="RENDER_ASSETS_CACHE_MAP_KEY",n="RENDER_EFFECT_CACHE_MAP_KEY",a="RENDER_TYPR_FONT_CACHE_MAP_KEY",o="RENDER_LOCK_PROPORTION_CACHE_MAP_KEY",s="RENDER_FILTER_ENGINE_NODE_MAP_KEY",l="RENDER_FILTER_ENGINE_CACHE_MAP_KEY",c="COMMON_IMAGE_ELEMENT_MAP_KEY",d="PERSISTENT_CACHE",u="ATTRIBUTE_TOOLS_POSITION"},79227:(e,t,i)=>{"use strict";function r(e){const[t,i,r,n]=e,a=Math.min(t.x,i.x,n.x,r.x),o=Math.min(t.y,i.y,n.y,r.y),s=Math.max(t.x,i.x,n.x,r.x),l=Math.max(t.y,i.y,n.y,r.y);return[{x:a,y:o},{x:s,y:o},{x:s,y:l},{x:a,y:l}]}i.d(t,{x:()=>r})},54845:(e,t,i)=>{"use strict";function r(e,t){return Math.sqrt(e*e+t*t)}function n(e,t){const i=Math.pow(10,null!=t?t:0);return Math.round(e*i)/i}i.d(t,{G:()=>r,v:()=>n})},67830:(e,t,i)=>{"use strict";i.d(t,{B:()=>n,V:()=>r});const r=e=>e*Math.PI/180,n=e=>180*e/Math.PI},59626:(e,t,i)=>{"use strict";i.d(t,{w:()=>r});class r{constructor(){this._awaitQueue=[],this._locked=!1}get isLocked(){return this._locked}acquire(){if(this._locked){return new Promise(((e,t)=>{this._awaitQueue.push({resolve:e,reject:t})}))}return this._locked=!0,Promise.resolve()}release(){if(!this._locked)throw new Error("mutex lock is not locked.");this._locked=!1;const e=this._awaitQueue.pop();e&&(this._locked=!0,e.resolve())}}},52609:(e,t,i)=>{"use strict";i.d(t,{Y:()=>r});const r=()=>{const e=performance.getEntriesByType("navigation");if(null==e||!e[0])return;const{redirectEnd:t,redirectStart:i,fetchStart:r,responseEnd:n}=e[0],a=n-r,o=t-i,s=performance.getEntriesByType("resource").filter((e=>"script"===e.initiatorType));return{htmlLoadDuration:a,redirectDuration:o,hasResourceCache:s.filter((e=>e.duration<=50)).length>=s.length/2,navigatorStart:performance.timing.navigationStart}}},349:(e,t,i)=>{"use strict";i.d(t,{f:()=>a});var r=i(50528),n=i(62587);const a=(e,t)=>(i,a,o)=>{const s=r.X.getInstance(),l=o.value;return o.value=async function(...i){const r=(0,n.Y)(t);s.markStageStart(e,r);const a=await l.apply(this,i);return s.markStageEnd(e,r),a},o}},50528:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});var r=i(67986);class n{constructor(){this._data={}}static getInstance(){return n._instance||(n._instance=new n),n._instance}setReporter(e){this._reporter=e}setStageStartTime(e,t,i="0"){const r=t,n={id:i,name:e.name,startTime:r};this._putStageRecord(e,n)}markStageStart(e,t="0"){const i=Date.now();Array.isArray(e)?e.forEach((e=>{this._putStageRecord(e,{id:t,name:e.name,startTime:i})})):this._putStageRecord(e,{id:t,name:e.name,startTime:i})}markStageEnd(e,t="0",i=Date.now()){if(Array.isArray(e))return void e.forEach((e=>this.markStageEnd(e,t,i)));let n,a;var o;e.parentStage?(a=this._data[e.parentStage.name],n=null===(o=a)||void 0===o?void 0:o.child.find((t=>t.name===e.name))):n=this._data[e.name];if(!n){if(!a)return void r.t.warn("mark stage end but stage not start before!",e);var s;if(a.records.find((e=>e.id!==t)))return void r.t.warn("mark stage end but stage not start before!",e);n={name:e.name,child:[],records:[{id:t,name:e.name,startTime:null!==(s=a.records.find((e=>e.id===t)).startTime)&&void 0!==s?s:0}]},a.child.push(n)}let l=n.records.find((e=>e.id===t));if(!l){var c;if(null===(c=a)||void 0===c||!c.records.find((e=>e.id===t)))return void r.t.warn("mark stage end but stage id record not start before!",e,t);{const e=a.records.find((e=>e.id===t));l={name:n.name,startTime:e.startTime,id:t},n.records.push(l)}}if(l.duration=i-l.startTime,this._reporter&&!e.disableReport){let e;n.child.length>0&&(e=[],n.child.forEach((t=>{const i=t.records.find((e=>e.id===l.id));i&&e.push(i)}))),setTimeout((()=>{e?this._reporter({...l,child:e}):this._reporter(l)}))}}_putStageRecord(e,t){if(e.parentStage){let i=this._data[e.parentStage.name];i||(i={name:e.parentStage.name,child:[],records:[{name:e.parentStage.name,id:t.id,startTime:t.startTime}]},this._data[e.parentStage.name]=i);let r=i.child.find((t=>t.name===e.name));r||(r={name:e.name,child:[],records:[]},i.child.push(r)),r.records.push(t)}else this._data[e.name]?this._data[e.name].records.push(t):this._data[e.name]={name:e.name,records:[t],child:[]}}}},77204:(e,t,i)=>{"use strict";i.d(t,{cM:()=>a,lR:()=>n,x5:()=>o});const r="canvas",n={name:`${r}-first-render`},a={name:`${r}-render`},o={name:`${r}-effect-render`}},16263:(e,t,i)=>{"use strict";i.d(t,{E:()=>l,l:()=>s});var r,n=i(8757),a=i(37722);const o={[n.F5.IMAGE]:"layer_image_cnt",[n.F5.IMAGE_CONTAINER]:"layer_image_container_cnt",[n.F5.LINE]:"layer_line_cnt",[n.F5.SHAPE]:"layer_shape_cnt",[n.F5.TEXT]:"layer_text_cnt"};function s(e){var t,i;let r=0;const s={},l=null===(t=a.I.getInstance().getContext(n.K6))||void 0===t?void 0:t.modelApi.common;return(null!==(i=null!=e?e:null==l?void 0:l.getLayersByFilter(!0,(()=>!0)))&&void 0!==i?i:[]).forEach((({type:e})=>{if(e===n.F5.GROUP_LAYER)return;r++;const t=o[e];s[t]?s[t]=s[t]+1:s[t]=1})),{allLayerCount:r,...s}}class l{static reset(){l.stageStart={},l.stageCost={}}static markStageStart(e){this.stageStart[e]=Date.now()}static markStageEnd(e){var t;const i=Date.now();if(void 0===this.stageStart[e])return void(this.stageCost[e]=-1);const r=i-this.stageStart[e];this.stageCost[e]=null!==(t=this.stageCost[e])&&void 0!==t?t:0+r}static getAllStageCost(){return this.stageCost}}(r=l).stageCost={},r.stageStart={}},78619:(e,t,i)=>{"use strict";i.d(t,{Mq:()=>c});var r,n=i(71229),a=i.n(n);let o;!function(e){e.OSX="osx",e.WINDOWS="windows"}(r||(r={}));const s=()=>{var e,t;if(o)return o;const i=null!==(e=null===(t=a().os)||void 0===t||null===(t=t.family)||void 0===t?void 0:t.toLowerCase().replace(/ /g,""))&&void 0!==e?e:"";return o=/\bwin/.test(i)?`${r.WINDOWS}`:/darwin|osx/.test(i)?`${r.OSX}`:`${r.WINDOWS}`,o};let l;const c=s()===`${r.OSX}`;s(),r.WINDOWS,(()=>{var e,t;if(l)return l;const i=null!==(e=null===(t=a().os)||void 0===t||null===(t=t.family)||void 0===t?void 0:t.toLowerCase().replace(/ /g,""))&&void 0!==e?e:"";l=/\bwin/.test(i)?`${r.WINDOWS}`:/darwin|osx/.test(i)?`${r.OSX}`:"linux"})()},61619:(e,t,i)=>{"use strict";i.d(t,{i:()=>r});const r=(e,t)=>{const i=e.width*e.scale.x,r=e.height*e.scale.y;return e.x+i<=t.width&&e.y+r<=t.height}},37722:(e,t,i)=>{"use strict";i.d(t,{C:()=>a,I:()=>n});var r=i(67986);class n{constructor(){this._contexts=new Map,this._collectorMap=new Map}static getInstance(){return n.instance||(n.instance=new n),n.instance}setReporter(e){this._reporter=e}setSlardarReporter(e){this._slardarReporter=e}reportSlardarEvent(e,t){this._slardarReporter.reportEvent(e,t)}reportEvent(...e){if(this._reporter){if(!(e.length<=0))if("string"==typeof e[0])this._reporter.reportEvent(e[0],e[1]);else{const t=e[0];this._reporter.reportEvent(t.eventName,t.getEventParams())}}else r.t.info("it unsupported report event before set reporter")}createContext(e){const t={};return this._contexts.set(e,t),t}getContext(e){return this._contexts.get(e)}destroyContext(e){this._contexts.delete(e)}getServerReportCustomString(){if(this._reporter)return JSON.stringify(this._reporter.getTeaConfig())}registerEventCollector(e,t){this._collectorMap.set(e,t)}eventReportStart(e){const t=this._collectorMap.get(e);if(!t)return;const i=new t;return i.report=()=>{this.reportEvent(i.eventName,i.getEventParams())},i}}class a{isAllowReportToSlardar(){return!1}report(){n.getInstance().reportEvent(this),this.isAllowReportToSlardar()&&n.getInstance().reportSlardarEvent(this.eventName,this.getEventParams())}}},53625:(e,t,i)=>{"use strict";function r(){let e,t;const i=new Promise(((i,r)=>{e=i,t=r}));return{resolve:e,reject:t,promise:i}}i.d(t,{P:()=>r})},90200:(e,t,i)=>{"use strict";var r;i.d(t,{Ib:()=>a,Qg:()=>o,kU:()=>n,zC:()=>r}),function(e){e.MouseDevice="mouse",e.TouchPadDevice="touchpad"}(r||(r={}));const n=e=>{const{deltaX:t,deltaY:i,wheelDeltaX:n,wheelDeltaY:a}=e;return a!==-3*i&&0===t||n===-3*t&&0===i&&e.shiftKey?r.MouseDevice:r.TouchPadDevice};var a;!function(e){e.None="",e.Right="right",e.Left="left",e.Up="up",e.Down="down",e.Inside="inside",e.Outside="outside"}(a||(a={}));const o=e=>{const{platform:t}=navigator,{ctrlKey:i,metaKey:o,shiftKey:s}=e;let{deltaX:l,deltaY:c}=e;const d=i||o;if(n(e)===r.TouchPadDevice&&d){if(c>0)return a.Inside;if(c<0)return a.Outside;if(l<0)return a.Right;if(l>0)return a.Left}if(t.startsWith("Win")&&s&&(l=c,c=0),0!==Math.abs(l)&&0!==Math.abs(c))return a.None;if(l<0)return a.Right;if(l>0)return a.Left;if(d){if(c>0)return a.Inside;if(c<0)return a.Outside}else{if(c>0)return a.Up;if(c<0)return a.Down}return a.None}},75834:(e,t,i)=>{"use strict";i.d(t,{J:()=>r});const r={type:"Line",data:{sourceFrom:"all shapes",type:i(8757).F5.LINE,name:"4",svgContent:"",id:"20102214",resourceId:"7214019749028565506",md5:"b30ae317ce5f1b96d7cf237abb7b99a7"},sourceRect:{x:0,y:-6,width:272,height:16}}},41074:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});const r={type:"Shape",data:{sourceFrom:"all shapes",type:i(8757).F5.SHAPE,name:"3",svgContent:"",id:"18058719",resourceId:"7211079126977909256",md5:"0e2002c8fab1b81a0fa8fc0ebe343fda"},sourceRect:{x:0,y:0,width:64,height:64}}},30816:(e,t,i)=>{"use strict";i.d(t,{X:()=>r});const r={type:"Line",data:{sourceFrom:"all shapes",type:i(8757).F5.LINE,name:"1",svgContent:"",id:"19815969",resourceId:"7214019749024371202",md5:"6d8192bb5cfff2d4ed60bd60e2d3e302"},sourceRect:{x:0,y:0,width:272,height:4}}},9011:(e,t,i)=>{"use strict";i.d(t,{X:()=>r});const r={type:"Shape",data:{sourceFrom:"all shapes",type:i(8757).F5.SHAPE,name:"1",svgContent:"",id:"18057784",resourceId:"7211079126977892882",md5:"15365a4f761612a3cf93b167cb140985"},sourceRect:{x:0,y:0,width:64,height:64}}},65047:(e,t,i)=>{"use strict";i.d(t,{J:()=>f});var r=i(67986),n=i(22169);function a(e){const t=e.match(/([A-Da-dF-Zf-z][\s\-e0-9.,]+)/g);if(!t)return r.t.error(`[round parse]Invalid d: ${e}`),[];return null==t?void 0:t.map((e=>{var t,i;const r=e.match(/([A-Da-dF-Zf-z])([\s\-e0-9.,]*)/);return{type:r[1],points:null!==(t=null===(i=r[2].match(/([-e0-9.]+)/g))||void 0===i?void 0:i.map((e=>parseFloat(e))))&&void 0!==t?t:[]}}))}function o(e){return e.reduce(((e,t)=>{var i,r;if("Z"===t.type)return e+t.type;const n=null!==(i=null===(r=t.points)||void 0===r?void 0:r.join(" "))&&void 0!==i?i:"";return e+`${t.type} ${n} `}),"")}function s(e){var t;const i=null===(t=e.points)||void 0===t?void 0:t.length;return{x:e.points[i-2],y:e.points[i-1]}}function l(e,t,i){return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}}function c(e,t,i){const r=t.x-e.x,n=t.y-e.y,a=Math.sqrt(r*r+n*n);return l(e,t,Math.min(1,i/a))}function d(e,t,i,r){if(!e.points||!t.points||!i.points)return[];const n=s(e),a=s(t),o=s(i);return[c(a,n,r),c(a,o,r)]}function u(e,t,i){const r=l(e,t,.5),n=l(t,i,.5);return{type:"C",points:[r.x,r.y,n.x,n.y,i.x,i.y]}}function h(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function p(e){const{commands:t,index:i,radius:r}=e,n=t[i-1],a=t[i],o=i===t.length-1?t[1]:t[i+1],l=s(n),c=s(a),d=s(o),u=h(l,c),p=h(c,d);return Math.min(u/3,p/3,r)}function f(e,t){const i=t/4,r=a(e),l=[];if(l.push(r[0]),function(e){const t=s(e[0]),i=s(e[e.length-1]);return t.x===i.x&&t.y===i.y}(r)||r.push({type:"L",points:r[0].points}),function(e){const t=e.filter((e=>!["M","Z"].includes(e.type)));for(let i=0;i<t.length-1;i++)if("L"===t[i].type&&"L"===t[i+1].type)return!1;return!0}(r)||r.length<=1)return e;const c=(0,n.cloneDeep)(r);for(let n=1;n<r.length;n++){const e=l[l.length-1],t=r[n],a=n===r.length-1?r[1]:r[n+1];if("L"===t.type&&"L"===a.type){const r=p({commands:c,index:n,radius:i}),[o,h]=d(e,t,a,r),f=s(t);t.points=[o.x,o.y],l.push(t);const y=u(o,f,h);l.push(y)}else l.push(t)}const h=s(l[l.length-1]);l[0].points=[h.x,h.y],l.push({type:"Z"});return o(l)}},56537:(e,t,i)=>{"use strict";var r;i.d(t,{F:()=>xe}),function(e){e.Root="Root",e.Element="Element",e.Text="Text"}(r||(r={}));const n=/[a-zA-Z0-9:_-]/,a=/[\s\t\r\n]/,o=/['"]/;const s=e=>{if(!e)return[];const t=e[1].trim();if(!t)return[];let i;const r=t.split(",");if(r.length>1)return i=r.map((e=>e.trim()?parseFloat(e.trim()):void 0)),i.filter(((e,t)=>e||t!==i.length-1));const n=t.split(" ");return i=n.map((e=>e.trim()?parseFloat(e.trim()):void 0)),i.filter(((e,t)=>e||t!==i.length-1))},l=e=>{const t=[],i=s(/translate\((.*)\)/.exec(e)),r=s(/scale\((.*)\)/.exec(e));var n,a;(null==i?void 0:i.length)>1&&t.push({translate:{x:null!==(n=i[0])&&void 0!==n?n:0,y:null!==(a=i[1])&&void 0!==a?a:0}});return 1===(null==r?void 0:r.length)&&t.push({scale:{x:r[0]||1,y:r[0]||1}}),(null==r?void 0:r.length)>1&&t.push({scale:{x:r[0]||1,y:r[1]||1}}),t};function c(e){var t;let i="";const s=[];let c,d=f,u={type:r.Element,tagName:""},h=f.length;function p(t){var i,r;const n=function(e,t,i){if("number"==typeof i)throw new Error("locate takes a { startIndex, offsetLine, offsetColumn } object as the third argument");return function(e,t){void 0===t&&(t={});const i=t.offsetLine||0,r=t.offsetColumn||0,n=e.split("\n");let a=0;const o=n.map((function(e,t){const i=a+e.length+1,r={start:a,end:i,line:t};return a=i,r}));let s=0;function l(e,t){return e.start<=t&&t<e.end}function c(e,t){return{line:i+e.line,column:r+t-e.start,character:t}}return function(t,i){"string"==typeof t&&(t=e.indexOf(t,i||0));let r=o[s];const n=t>=r.end?1:-1;for(;r;){if(l(r,t))return c(r,t);s+=n,r=o[s]}}}(e,i)(t,i&&i.startIndex)}(e,h),a=null==n?void 0:n.line,o=null==n?void 0:n.column,s=e.slice(0,h),l=null===(i=/(^|\n).*$/.exec(s))||void 0===i?void 0:i[0].replace(/\t/g,"  "),c=e.slice(h),d=""+l+(null===(r=/.*(\n|$)/.exec(c))||void 0===r?void 0:r[0])+"\n"+function(e,t=0){let i="";for(;t--;)i+=e;return i}(" ",null==l?void 0:l.length)+"^";throw new Error(t+" ("+a+":"+o+"). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues \u2013 thanks!\n\n"+d)}function f(){for(;h<e.length&&"<"!==e[h]||!n.test(e[h+1]);)i+=e[h++];return y()}function y(){let t="";for(;h<e.length&&"<"!==e[h];)t+=e[h++];var i;/\S/.test(t)&&(null===(i=c)||void 0===i||null===(i=i.children)||void 0===i||i.push({type:r.Text,value:t}));return"<"===e[h]?g:y}function g(){let t=e[h];if("?"===t)return y;if("!"===t){if("--"===e.slice(h+1,h+3))return m;if("[CDATA["===e.slice(h+1,h+8))return _;if(/doctype/i.test(e.slice(h+1,h+8)))return y}if("/"===t)return v;const i=I(),n={type:r.Element,tagName:i,properties:{},children:[]};var a;c?null===(a=c.children)||void 0===a||a.push(n):u=n;let o;for(;h<e.length&&(o=T());)"transform"===o.name?n.properties[o.name]=l(o.value):n.properties[o.name]=o.value;let d=!1;return"/"===e[h]&&(h+=1,d=!0),">"!==e[h]&&p("Expected >"),d||(c=n,s.push(n)),y}function m(){const t=e.indexOf("--\x3e",h);return~t||p("expected --\x3e"),h=t+2,y}function _(){var t;const i=e.indexOf("]]>",h);return~i||p("expected ]]>"),null===(t=c)||void 0===t||null===(t=t.children)||void 0===t||t.push(e.slice(h+7,i)),h=i+2,y}function v(){var t;const i=I();var r;(i||p("Expected tag name"),i!==(null===(t=c)||void 0===t?void 0:t.tagName))&&p("Expected closing tag </"+i+"> to match opening tag <"+(null===(r=c)||void 0===r?void 0:r.tagName)+">");return w(),">"!==e[h]&&p("Expected >"),s.pop(),c=s[s.length-1],y}function I(){let t="";for(;h<e.length&&n.test(e[h]);)t+=e[h++];return t}function T(){if(!a.test(e[h]))return null;w();const t=I();if(!t)return null;let i=!0;return w(),"="===e[h]&&(h+=1,w(),i=o.test(e[h])?function(){const t=e[h++];let i="",r=!1;for(;h<e.length;){const n=e[h++];if(n===t&&!r)return i;"\\"!==n||r||(r=!0),i+=r?"\\"+n:n,r=!1}}():function(){let t="";do{let i=e[h];if(" "===i||">"===i||"/"===i)return t;t+=i,h+=1}while(h<e.length);return t}(),isNaN(i)||""===i.trim()||(i=+i)),{name:t,value:i}}function w(){for(;h<e.length&&a.test(e[h]);)h+=1}for(;h<e.length;)d||p("Unexpected character"),d=d(),h+=1;return d!==y&&p("Unexpected end of input"),"svg"===(null===(t=u)||void 0===t?void 0:t.tagName)&&(u.metaData=i),{type:r.Root,children:[u]}}var d;!function(e){e.NONE="none",e.VERTICAL_LINE="vertical_line",e.ARROW="arrow",e.SOLID_ARROW="solid_arrow",e.CIRCLE="circle",e.SOLID_CIRCLE="solid_circle",e.RECT="rect",e.SOLID_RECT="solid_rect",e.RHOMBUS="rhombus",e.SOLID_RHOMBUS="solid_rhombus"}(d||(d={}));const u={[d.NONE]:{source:{},lineOffsetX:{value:0,baseStrokeWidth:4}},[d.SOLID_ARROW]:{source:{start:'<path fill="inherit" stroke-linecap="round" stroke-linejoin="round" d="M 2.5,-1.5,0.5,0,2.5,1.5 Z"/>',end:'<path fill="inherit" stroke-linecap="round" stroke-linejoin="round" d="M -2.5,-1.5,-0.5,0,-2.5,1.5 Z"/>'},lineOffsetX:{value:11,baseStrokeWidth:4}},[d.ARROW]:{source:{start:'<path fill="none" stroke-linecap="round" stroke-linejoin="round" d="M 2.5,-1.5,0.5,0,2.5,1.5 "/>',end:'<path fill="none" stroke-linecap="round" stroke-linejoin="round" d="M -2.5,-1.5,-0.5,0,-2.5,1.5 "/>'},lineOffsetX:{value:2,baseStrokeWidth:4}},[d.VERTICAL_LINE]:{source:{start:'<rect stroke="none" width="1" height="4" x="0" y="-2" rx="0.5"/>',end:'<rect stroke="none" width="1" height="4" x="-1" y="-2" rx="0.5"/>'},lineOffsetX:{value:3,baseStrokeWidth:4}},[d.SOLID_RECT]:{source:{start:'<rect fill="inherit" stroke-linejoin="round" width="3" height="3" x="0.5" y="-1.5"/>',end:'<rect fill="inherit" stroke-linejoin="round" width="3" height="3" x="-3.5" y="-1.5"/>'},lineOffsetX:{value:15,baseStrokeWidth:4}},[d.RECT]:{source:{start:'<rect fill="none" stroke-linejoin="round" width="3" height="3" x="0.5" y="-1.5"/>',end:'<rect fill="none" stroke-linejoin="round" width="3" height="3" x="-3.5" y="-1.5"/>'},lineOffsetX:{value:15,baseStrokeWidth:4}},[d.SOLID_CIRCLE]:{source:{start:'<circle fill="inherit" cx="2" r="1.5"/>',end:'<circle fill="inherit" cx="-2" r="1.5"/>'},lineOffsetX:{value:15,baseStrokeWidth:4}},[d.CIRCLE]:{source:{start:'<circle fill="none" cx="2" r="1.5"/>',end:'<circle fill="none" cx="-2" r="1.5"/>'},lineOffsetX:{value:15,baseStrokeWidth:4}},[d.SOLID_RHOMBUS]:{source:{start:'<path fill="inherit" stroke-linejoin="round" d="M 0.5,0 l 1.5,-1.5 1.5,1.5 -1.5,1.5 Z"/>',end:'<path fill="inherit" stroke-linejoin="round" d="M -0.5,0 l -1.5,-1.5 -1.5,1.5 1.5,1.5 Z"/>'},lineOffsetX:{value:13,baseStrokeWidth:4}},[d.RHOMBUS]:{source:{start:'<path fill="none" stroke-linejoin="round" d="M 0.5,0 l 1.5,-1.5 1.5,1.5 -1.5,1.5 Z"/>',end:'<path fill="none" stroke-linejoin="round" d="M -0.5,0 l -1.5,-1.5 -1.5,1.5 1.5,1.5 Z"/>'},lineOffsetX:{value:13,baseStrokeWidth:4}}};function h(e,t){return u[t].source[e]}function p({parent:e,item:t},i){var r;if(!t)return;Boolean(null===(r=t.children)||void 0===r?void 0:r.length)&&t.children.forEach((e=>p({parent:t,item:e},i))),null==i||i.forEach((i=>i(t,{parent:e})))}const f=["stroke","fill","strokeWidth","strokeDasharray","d"],y=(e,t)=>{if(!e||!t)return e===t;return!Object.keys(e).some((i=>e[i]!==t[i]))};function g(e){const t=e.split("C");return 5===t.length&&"59.542745950000004 0 64 4.45725405 64 9.956L64 54.044"===t[1]}var m,_,v,I=i(8757);function T(e){var t,i;return(null==e||null===(t=e.properties)||void 0===t?void 0:t.type)===m.LeftArrow&&(null==e||null===(i=e.properties)||void 0===i?void 0:i["sub-type"])}function w(e){var t,i;return(null==e||null===(t=e.properties)||void 0===t?void 0:t.type)===m.RightArrow&&(null==e||null===(i=e.properties)||void 0===i?void 0:i["sub-type"])}function E(e){var t;return(null==e||null===(t=e.properties)||void 0===t?void 0:t.type)===m.Line}!function(e){e.Line="line",e.LeftArrow="endpoint_l",e.RightArrow="endpoint_r"}(m||(m={})),function(e){e.FillLinear="fill-linear",e.FillRadial="fill-radial",e.StrokeLinear="stroke-linear",e.StrokeRadial="stroke-radial"}(_||(_={})),function(e){e.Rect="rect",e.Circle="circle",e.Ellipse="ellipse",e.Line="line",e.Polyline="polyline",e.Polygon="polygon",e.Path="path",e.Text="text"}(v||(v={}));const x=["stroke","fill","strokeWidth","strokeDasharray","d"],b=2,R="#ffffff";var k=i(7842),A=i.n(k);class P{constructor(e){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,e&&(Array.isArray(e)?6===e.length&&([this.a,this.b,this.c,this.d,this.e,this.f]=e):e instanceof P&&(this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f))}multiply(e){const t=new P;return t.a=this.a*e.a+this.c*e.b,t.b=this.b*e.a+this.d*e.b,t.c=this.a*e.c+this.c*e.d,t.d=this.b*e.c+this.d*e.d,t.e=this.a*e.e+this.c*e.f+this.e,t.f=this.b*e.e+this.d*e.f+this.f,t}translate(e,t=0,i=0){const r=new P;return r.e=e,r.f=t,this.multiply(r)}scale(e,t=0,i=0){const r=new P;return r.a=e,r.d=e,r.e=-e*t+t,r.f=-e*i+i,this.multiply(r)}rotate(e,t=0,i=0){const r=new P;return r.a=Math.cos(e),r.b=Math.sin(e),r.c=-Math.sin(e),r.d=Math.cos(e),r.e=-t*r.a+i*r.c+t,r.f=-t*r.b+i*r.d+i,this.multiply(r)}skewX(e){const t=new P;return t.c=Math.tan(e),this.multiply(t)}skewY(e){const t=new P;return t.b=Math.tan(e),this.multiply(t)}toString(){return`matrix(${this.a}, ${this.b}, ${this.c}, ${this.d}, ${this.e}, ${this.f})`}}const M=e=>{const t=[];let i=new P;return e.forEach((e=>{const i=(e=>{if(e.translate){const{x:t,y:i}=e.translate;return new P([1,0,0,1,t,i])}if(e.scale){const{x:t,y:i}=e.scale;return new P([t,0,0,i,0,0])}})(e);i&&t.push(i)})),t.forEach((e=>{e&&(i=i.multiply(e))})),i},L=e=>{let t=new P;for(let i=e.length-1;i>=0;i--)t=t.multiply(e[i]);return t};class S{constructor(e=0,t=0,i=0,r=1){this.x=e,this.y=t,this.z=i,this.w=r}static fromPoint(e){return new S(e.x,e.y,e.z,e.w)}matrixTransform(e){const t=new S;return t.x=e.a*this.x+e.c*this.y+e.e,t.y=e.b*this.x+e.d*this.y+e.f,t}toJSON(){return{x:this.x,y:this.y,z:this.z,w:this.w}}toString(){return`[${this.x}, ${this.y}, ${this.z}, ${this.w}]`}}const C=["path","rect","circle"],O=e=>{let t={minX:0,maxX:0,minY:0,maxY:0};switch(e.tagName){case v.Path:t=(e=>{const{properties:t}=e,i=A().makeAbsolute(A().parseSVG(t.d)),r={minX:i[0].x,maxX:i[0].x,minY:i[0].y,maxY:i[0].y};return i.forEach((e=>{const{x:t,y:i}=e;t<r.minX&&(r.minX=t),i<r.minY&&(r.minY=i),t>r.maxX&&(r.maxX=t),i>r.maxY&&(r.maxY=i)})),r})(e);break;case v.Circle:t=(e=>{const{properties:t}=e,{cx:i=0,cy:r=0,r:n=0}=t;return{minX:i-n,maxX:i+n,minY:r-n,maxY:r+n}})(e);break;case v.Rect:t=(e=>{const{properties:t}=e,{x:i=0,y:r=0,width:n=0,height:a=0}=t;return{minX:i,maxX:i+n,minY:r,maxY:r+a}})(e)}return t},F=e=>{if(null==e||!e.length)return;const t={minX:e[0].minX,maxX:e[0].maxX,minY:e[0].minY,maxY:e[0].maxY};return e.forEach((e=>{const{minX:i,minY:r,maxX:n,maxY:a}=e;i<t.minX&&(t.minX=i),r<t.minY&&(t.minY=r),n>t.maxX&&(t.maxX=n),a>t.maxY&&(t.maxY=a)})),t},N=(e,t=[])=>{const i=O(e),r=L(t),n=((e,t)=>{const{minX:i,minY:r,maxX:n,maxY:a}=e,o=new S(i,r),s=new S(n,a),l=o.matrixTransform(t),c=s.matrixTransform(t);return{minX:l.x,maxX:c.x,minY:l.y,maxY:c.y}})(i,r),a=((e,t,i)=>{const{properties:r={},tagName:n}=t,a=r["stroke-width"]||1,o=r["stroke-linecap"]||"butt",s=r.type||"",l=i.a*a/2,c=i.d*a/2;return"line"===s&&"butt"===o&&"path"===n?{...e,minY:e.minY-c,maxY:e.maxY+c}:"none"===r.stroke?e:{minX:e.minX-l,maxX:e.maxX+l,minY:e.minY-c,maxY:e.maxY+c}})(n,e,r);return a},D=(e,t=[],i,r)=>{const{properties:n={},children:a=[],tagName:o}=e,s=[],l={};if(!o)return{box:void 0};if(null!=n&&n.transform&&t.push(M(null==n?void 0:n.transform)),"g"===o&&n.type&&(l.type=n.type),C.includes(o)){const n=N(e,t);return null!=r&&r(e,i)?{box:n,target:{matrixList:t,data:e,parent:i}}:{box:n}}for(let d=0;d<(null==a?void 0:a.length);d++){const i=D({...a[d],properties:{...a[d].properties,...l}},[...t],e,r);if(i.target)return{...i};i.box&&s.push(i.box)}const c=F(s);return null!=r&&r(e,i)?{box:c,target:{matrixList:t,data:e,parent:i}}:{box:c}};const U=e=>{if(!e.target)return 0;const{data:t,matrixList:i,parent:r}=e.target,n=null==r?void 0:r.properties["sub-type"],a=t.properties["stroke-width"]||1,o=L(i||[]);if(!u[n])return 0;const{lineOffsetX:s}=u[n];return Number(o.a)*a/s.baseStrokeWidth*s.value};var B;function G(e){const t=e.split(" ");return{x:Number(t[0].trim()),y:Number(t[1].trim()),width:Number(t[2].trim()),height:Number(t[3].trim())}}!function(e){e[e.LACK_SVG_TAG=0]="LACK_SVG_TAG",e[e.FORMAT_ERROR=1]="FORMAT_ERROR",e[e.LINE_FORMAT_ERROR=2]="LINE_FORMAT_ERROR",e[e.RIGHT_POINT_FORMAT_ERROR=3]="RIGHT_POINT_FORMAT_ERROR",e[e.LEFT_POINT_FORMAT_ERROR=4]="LEFT_POINT_FORMAT_ERROR"}(B||(B={}));var j=i(67986);const H=(e,t)=>{const i=/#(.*)/.exec(e),r=/rgba\((.*)\)/.exec(e),n=/rgb\((.*)\)/.exec(e);let a,o,s,l;if(i&&i.length>1){const e=i[1].trim();a=parseInt(e.substring(0,2),16),o=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16)}if(n&&n.length>1){const e=n[1].trim().split(",").map((e=>Number(e.trim())));a=e[0]||255,o=e[1]||255,s=e[2]||255}if(r&&r.length>1){const e=r[1].trim().split(",").map((e=>Number(e.trim())));a=e[0]||255,o=e[1]||255,s=e[2]||255,l=e[3]||1}return[a,o,s,1]},W=e=>{const t="number"==typeof e[0]?e[0].toString(16).padStart(2,"0"):"none",i="number"==typeof e[1]?e[1].toString(16).padStart(2,"0"):"none",r="number"==typeof e[2]?e[2].toString(16).padStart(2,"0"):"none";return[t,i,r].includes("none")?(j.t.error(`compose shape error: getHexColor has error color ${e}`),{hex:"#5A5A5A",alpha:1}):{hex:`#${t}${i}${r}`,alpha:1}};var z=i(91372);function V(e){let t="";return e?(Object.keys(e).forEach((i=>{void 0!==e[i]&&("transform"===i?t=`${t} ${i}="${function(e){let t="";return e?(e.forEach((e=>{let i="";e.translate&&(i=`translate(${e.translate.x} ${e.translate.y})`),e.scale&&(e.scale.x===e.scale.y&&(i=`scale(${e.scale.x})`),e.scale.x!==e.scale.y&&(i=`scale(${e.scale.x} ${e.scale.y})`)),t=t?`${t} ${i}`:i})),t):t}(e[i])}"`:"scale"===i||(t=`${t} ${i}="${e[i]}"`))})),t):t}function $(e){const{tagName:t,metaData:i,children:r}=e;let n="";return t?(i&&(n=`${n}${i}`),["svg","clipPath","g","defs","linearGradient","radialGradient","mask"].includes(t)?(n=`${n}<${t}${V(e.properties)} >`,null==r||r.forEach((e=>{n=`${n}\n\t${$(e)}`})),n=`${n}\n</${t}>`):n=`${n}<${t}${V(e.properties)} />`,n):""}function Y(e){let t="";return e.children.forEach((e=>{t=t?`${t}\n${$(e)}`:`${$(e)}`})),t}function X(e,t){return e?t===I.cF.LinearGradient?_.FillLinear:_.FillRadial:t===I.cF.LinearGradient?_.StrokeLinear:_.StrokeRadial}function J(e){return e.map((e=>({type:r.Element,tagName:"stop",properties:{offset:`${e.offset}`,"stop-color":(0,z.xc)(e.color)}})))}function K(e){var t;return null!==(t=null==e?void 0:e.map((e=>({offset:parseFloat(e.properties.offset),color:(0,z.Oo)(e.properties["stop-color"])}))))&&void 0!==t?t:[]}function q(e,t){return t.type===I.cF.LinearGradient?{type:r.Element,tagName:"linearGradient",properties:{id:X(e,t.type),gradientTransform:`rotate(${t.rotation-90}, 0.5, 0.5)`},children:J(t.stops)}:{type:r.Element,tagName:"radialGradient",properties:{id:X(e,t.type),cx:`${t.center[0]}`,cy:`${t.center[1]}`,r:`${t.radius[0]}`},children:J(t.stops)}}const Z=/^url\(#(.*?)\)$/;function Q(e,t){const i={start:{type:d.NONE,position:[0,0]},end:{type:d.NONE,position:[0,0]}},r=t.children,n=r[0].children,a={};switch(e){case I.Wq.LINE:r[0].properties.viewBox?i.viewBox=G(r[0].properties.viewBox):i.viewBox=function(e,t=[]){const i=D(e,[...t]).box;return i?{x:i.minX>0?i.minX:0,y:i.minY,width:i.maxX-(i.minX>0?i.minX:0),height:i.maxY-i.minY}:void 0}(r[0]),p({item:r[0]},[e=>{const t=e.properties.stroke,r=e.properties["stroke-opacity"];t&&"none"!==t&&(r&&Number(r),i.stroke=H(t))},(e,t)=>{const r=e.properties["stroke-width"];r&&"null"!==r&&E(null==t?void 0:t.parent)&&(i.strokeWidth=r)},e=>{const t=e.properties["stroke-dasharray"];t&&"null"!==t&&(i.strokeDasharray=t.split(",").map((e=>Number(e.trim()))))},e=>{T(e)&&(i.start={type:e.properties["sub-type"],position:[0,0]}),w(e)&&(i.end={type:e.properties["sub-type"],position:[0,0]})}]);break;case I.Wq.SHAPE:default:{const e=r[0].properties.viewBox.split(" ").map((e=>Number(e))),t={x:e[0],y:e[1],width:e[2],height:e[3]};i.viewBox=t,null==n||n.forEach((e=>{"path"===e.tagName&&e.properties?Object.keys(e.properties).forEach((t=>{const r=t.replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));if(f.includes(r)||"d"===r){var n;let o=e.properties[t];if("fill"===r&&"none"===o)return;if("stroke"===r&&"none"===o)return;if("strokeWidth"===r&&o&&(o/=2),"strokeDasharray"===r&&null!==(n=o)&&void 0!==n&&n.length&&(o=o.split(",").map((e=>Number(e.trim())/2))),"fill"===r&&o){const t=Z.exec(o);if(t){const e=t[1];a[e]&&(o=a[e])}else{const t=e.properties["fill-opacity"];t&&Number(t);o=H(o)}}if("stroke"===r&&o){const t=Z.exec(o);if(t){const e=t[1];a[e]&&(o=a[e])}else{const t=e.properties["stroke-opacity"];t&&Number(t);o=H(o)}}i[r]=o}})):"defs"===e.tagName&&e.children&&e.children.forEach((e=>{const t=function(e){if("linearGradient"===e.tagName){const t=e.properties.gradientTransform.indexOf("("),i=e.properties.gradientTransform.indexOf(",");return{type:I.cF.LinearGradient,rotation:parseFloat(e.properties.gradientTransform.slice(t+1,i))+90,stops:K(e.children)}}if("radialGradient"===e.tagName)return{type:I.cF.RadialGradient,center:[parseFloat(e.properties.cx),parseFloat(e.properties.cy)],radius:[parseFloat(e.properties.r),parseFloat(e.properties.r)],stops:K(e.children)}}(e);t&&(a[e.properties.id]=t)}))}))}}return i}function ee(e,t){var i;let r=[];if(null!==(i=e.strokeDasharray)&&void 0!==i&&i.length){let i;t===I.Wq.LINE?(i=e.strokeWidth||1,r=[e.strokeDasharray[0]/i,e.strokeDasharray[1]/i]):t===I.Wq.SHAPE?(i=e.strokeWidth||2,r=[e.strokeDasharray[0]/(i/2),e.strokeDasharray[1]/(i/2)]):j.t.error(`Wrong layer type in getSliderValues: ${t}`)}return{...e,strokeDasharray:r}}var te=i(14415);const ie=async(e,t)=>{var i;const{width:r=150,height:n=150,dpr:a=b}=e;let{data:o}=e;o.match(/<svg[^>]*\bwidth="([^"]+)"[^>]*\bheight="([^"]+)"/g)||o.match(/<svg[^>]*\bheight="([^"]+)"[^>]*\bwidth="([^"]+)"/g)||(o=e.data.replace(/viewBox="(-?\d+)\s(-?\d+)\s(-?\d+)\s(-?\d+)"/g,'viewBox="$1 $2 $3 $4" width="$3" height="$4"'));const s=(new DOMParser).parseFromString(o,"image/svg+xml"),l=(new XMLSerializer).serializeToString(s),c=await(0,te.p)(`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`);if(!c)return null;c.width=Math.max(1,r),c.height=Math.max(1,n);const d=(t=null!==(i=t)&&void 0!==i?i:document.createElement("canvas")).getContext("2d"),u=Math.max(1,r*a),h=Math.max(1,n*a);return t.width=u,t.height=h,d.clearRect(0,0,u,h),d.drawImage(c,0,0,u,h),t};function re(e,t){if(e.tagName===t)return e;if(e.children)for(const i of e.children){const e=re(i,t);if(e)return e}}function ne(e,t,i=!0){const n=c(e),a=n.children[0],o=a.properties.viewBox.split(" "),s=re(a,"g");if(s){!function(e,t,i){var r,n;const{strokeWidth:a,start:o,end:s}=t,l=!!o.type&&o.type!==d.NONE,u=!!s.type&&s.type!==d.NONE;if(e.children=null===(r=e.children)||void 0===r?void 0:r.filter((e=>E(e))),l){var f;const t=`transform="translate(0 ${a/2}) scale(${a})"`,i=c(`<g type="${m.LeftArrow}" sub-type="${o.type}" ${t}>${h("start",o.type)}</g>`);null===(f=e.children)||void 0===f||f.push(i.children[0])}if(u){var y;const t=`transform="translate(${i[2]} ${a/2}) scale(${a})"`,r=c(`<g type="${m.RightArrow}" sub-type="${s.type}" ${t}>${h("end",s.type)}</g>`);null===(y=e.children)||void 0===y||y.push(r.children[0])}var g;null===(n=e.children)||void 0===n||n.forEach((e=>{var t;E(e)&&(null===(t=e.children)||void 0===t||t.forEach((e=>{e.properties["stroke-width"]=a})))})),p({item:e},[(g="stroke",e=>{var i,r;if(!Boolean(null===(i=e.children)||void 0===i?void 0:i.length)){var n;const i=t[g],{solid:r,gradient:a}=(0,z.tB)(i),o=r&&W(r);let s="none";a?s=R:o&&(s=o.hex),"none"!==e.properties[g]&&(e.properties[g]=s),o&&1!==(null==o?void 0:o.alpha)&&(e.properties["stroke-opacity"]=o.alpha),"none"!==(null===(n=e.properties)||void 0===n?void 0:n.fill)&&(e.properties.fill=s)}const a=new RegExp(`(s*\b${g}s*:s*.+s*;?)`,"g");null===(r=e.properties)||void 0===r||null===(r=r.style)||void 0===r||r.replace(a)}),(e=>(i,r)=>{var n;const a=Boolean(null===(n=i.children)||void 0===n?void 0:n.length),o=!(null==r||!r.parent)&&E(r.parent);if(!a&&o&&"path"===i.tagName){const r=t.strokeDasharray;return null!=r&&r.length?void(i.properties[e]=r):void(i.properties[e]=void 0)}})("stroke-dasharray")])}(s,t,o),function(e,t){var i,r,n,a;const{children:o,tagName:s,properties:l}=e;if("svg"!==s)return Promise.resolve({status:!1,errType:B.LACK_SVG_TAG});if(null==o||null===(i=o[0])||void 0===i||null===(i=i.children)||void 0===i||!i.length)return Promise.resolve({status:!1,errType:B.FORMAT_ERROR});let c,d,u,h,p;if(o[0].children.forEach((e=>{E(e)&&(c=e),T(e)&&(d=e),w(e)&&(u=e)})),null===(r=c)||void 0===r||null===(r=r.children)||void 0===r||null===(r=r[0])||void 0===r||null===(r=r.properties)||void 0===r||!r["stroke-width"]||null===(n=c)||void 0===n||null===(n=n.children)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.properties)||void 0===n||!n.d)return Promise.resolve({status:!1,errType:B.LINE_FORMAT_ERROR});const f=c.children[0].properties["stroke-width"],y=A().makeAbsolute(A().parseSVG(c.children[0].properties.d));if(y.length<2)return Promise.resolve({status:!1,errType:B.LINE_FORMAT_ERROR});let g=y[0].x,m=y[1].x;const _=[];if(d){var v;if(d.properties.transform.forEach((e=>{e.translate&&(e.translate.x=0)})),h=D(e,[],void 0,((e,t)=>Boolean(t&&T(t)))),null===(v=h.target)||void 0===v||!v.data)return Promise.resolve({status:!1,errType:B.LEFT_POINT_FORMAT_ERROR});g=U(h),h.box&&_.push(h.box)}else g=0;if(u){var I;if(u.properties.transform.forEach((e=>{e.translate&&(e.translate.x=t)})),p=D(e,[],void 0,((e,t)=>Boolean(t&&w(t)))),null===(I=p.target)||void 0===I||!I.data)return Promise.resolve({status:!1,errType:B.RIGHT_POINT_FORMAT_ERROR});m=t-U(p),p.box&&_.push(p.box)}else m=t;_.push({minX:g,maxX:m,minY:0,maxY:f});const x=F(_),b=`${x.minX>0?x.minX:0} ${x.minY} ${t} ${x.maxY-x.minY}`,R=`M ${g},${f/2} L ${m},${f/2}`;null!==(a=c.children[0])&&void 0!==a&&null!==(a=a.properties)&&void 0!==a&&a.d&&(c.children[0].properties.d=R),l.viewBox=b,Promise.resolve({status:!0})}(a,t.viewBox.width);const{gradient:e}=(0,z.tB)(t.stroke),n=[],l=[];if(e&&i){l.push(q(!0,e)),l.push({type:r.Element,tagName:"mask",properties:{id:"mask"},children:[s]}),n.push({type:r.Element,tagName:"defs",children:l});const t=G(a.properties.viewBox);n.push({type:r.Element,tagName:"rect",properties:{x:t.x-1,y:t.y-1,width:t.width+2,height:t.height+2,fill:`url(#${X(!0,e.type)})`,mask:"url(#mask)"}})}else n.push(s);a.children=n}return n}function ae(e,t){return Y(ne(e,t))}function oe(e,t){return Y(ne(e,t,!1))}var se=i(65047),le=i(17529);const ce=1e-5,de=(e,t,i)=>{const r=e.reduce(((e,t)=>e+t[1]-t[0]),0),n=t-r,a=i-r;let o=0,s=!1;const l=[];let c=0;if(e.forEach((([e,t],i)=>{c<e?l.push({start:c,end:e,type:"stretch",initLen:e-c,transLen:a*((e-c)/n)}):c>0&&(l.push({start:c,end:e,type:"stretch",initLen:0,transLen:0}),s=!0),l.push({start:e,end:t,type:"fixed",initLen:t-e,transLen:t-e}),o+=c<e||c>0?1:0,c=t})),!s&&c<t&&(l.push({start:c,end:t,type:"stretch",initLen:t-c,transLen:a*((t-c)/n)}),o+=1,c=t),s){const e=a/o;for(const t of l)"stretch"===t.type&&(t.transLen=e)}return{stretchCnt:o,isAverageScale:s,segments:l}},ue=(e,t)=>{let i,r=0;for(const n of t)if(e>n.end)r+=n.transLen;else{if(e<n.end){r+=n.transLen*((e-n.start)/n.initLen);break}n.end===n.start?i=r+n.transLen:r+=n.transLen}return{pos:r,supportPos:i}},he=(e,t,i,r)=>{const n=de(t.horizontal,r.width,i.width),a=de(t.vertical,r.height,i.height),o=e.find((e=>e.type===le.OU.MOVE_TO)),s=((e,t,i)=>{const r=(e,t)=>0===t?e[e.length-1]:e[t-1],n=e.map(((n,a)=>{const{keyPoint:o,command:s}=n,l=ue(o.x,t),c=ue(o.y,i);if(void 0!==l.supportPos||void 0!==c.supportPos){const t=r(e,a).keyPoint,i=((e,t)=>t===e.length-1?e[0]:e[t+1])(e,a).keyPoint,n={x:l.pos,y:c.pos},d={x:l.pos,y:c.pos};return void 0!==l.supportPos&&(t.x<=o.x&&o.x<=i.x&&t.x!==i.x?(n.x=l.supportPos,d.x=l.pos):t.x>=o.x&&o.x>=i.x&&t.x!==i.x&&(n.x=l.pos,d.x=l.supportPos)),void 0!==c.supportPos&&(t.y<=o.y&&o.y<=i.y&&t.y!==i.y?(n.y=c.supportPos,d.y=c.pos):t.y>=o.y&&o.y>=i.y&&t.y!==i.y&&(n.y=c.pos,d.y=c.supportPos)),n.x===d.x&&n.y===d.y?{keyPoint:o,command:s,stretchPoint:{x:l.pos,y:c.pos}}:[{keyPoint:o,command:s,stretchPoint:{x:d.x,y:d.y}},{keyPoint:o,command:{type:le.OU.LINE_TO,...n},stretchPoint:{x:n.x,y:n.y}}]}return{keyPoint:o,command:s,stretchPoint:{x:l.pos,y:c.pos}}})).flat();return n.map(((e,t)=>{const{stretchPoint:i,keyPoint:a,command:o}=e,s={...o},l={};void 0!==s.x&&(l.x=i.x),void 0!==s.y&&(l.y=i.y);const c=r(n,t);if(Math.abs(c.stretchPoint.x-i.x)<ce&&Math.abs(c.stretchPoint.y-i.y)<ce)return[];if(void 0!==s.x1){const e=(i.x-c.stretchPoint.x)/(a.x-c.keyPoint.x);l.x1=c.stretchPoint.x+(s.x1-c.keyPoint.x)*e}if(void 0!==s.y1){const e=(i.y-c.stretchPoint.y)/(a.y-c.keyPoint.y);l.y1=c.stretchPoint.y+(s.y1-c.keyPoint.y)*e}if(void 0!==s.x2){const e=(i.x-c.stretchPoint.x)/(a.x-c.keyPoint.x);l.x2=i.x+(s.x2-a.x)*e}if(void 0!==s.y2){const e=(i.y-c.stretchPoint.y)/(a.y-c.keyPoint.y);l.y2=i.y+(s.y2-a.y)*e}return{stretchPoint:i,keyPoint:a,command:{...o,...l}}})).flat()})(((e,t)=>{let i={...t};return e.map((e=>{const t={...e},r={x:void 0!==t.x?t.x:i.x,y:void 0!==t.y?t.y:i.y};return i={...r},{keyPoint:r,command:e}}))})(e.filter((e=>e.type!==le.OU.CLOSE_PATH&&e.type!==le.OU.MOVE_TO)),{x:o.x,y:o.y}),n.segments,a.segments),l=s[s.length-1].stretchPoint;return[{...o,x:l.x,y:l.y},...s.map((e=>e.command)),{type:le.OU.CLOSE_PATH}]},pe=(e,t,i,r)=>{const n={...e},{d:a,viewBox:o}=n;let s=a;if(g(s)&&(s="M0,0L64,0L64,64L0,64L0,0"),i){if(r){const{width:e,height:t}=i,n=he(new le.OU(s).commands,r,{width:e,height:t},o);s=new le.OU((0,le.QI)(n)).encode()}else s=new le.OU(s).scale(i.width/o.width,i.height/o.height).encode();const e=new le.OU(s).scale(i.scale.x,i.scale.y),t=e.getBounds(),a={...o,width:t.maxX-t.minX,height:t.maxY-t.minY};s=e.encode(),n.viewBox={...a}}return t&&(s=(0,se.J)(s,t)),n.d=s,n},fe=2,ye=(e,t,i)=>{if(i)return[`url(#${X(e,i.type)})`,1];{const e=t&&W(t),i=e?e.hex:"none";let r=1;return e&&1!==(null==e?void 0:e.alpha)&&(r=e.alpha),[i,r]}};function ge(e,t,i=0,n,a=1,o=!0,s){var l,d;const u=c(e),h=u.children;let p=h[0].children;const f=pe(t,i*fe*a,n,s),{viewBox:y}=f;h[0].properties.viewBox=`${y.x} ${y.y} ${y.width} ${y.height}`,(i||n)&&(h[0].properties.width=`${y.width}px`,h[0].properties.height=`${y.height}px`);const{solid:g,gradient:m}=(0,z.tB)(t.fill),{solid:_,gradient:v}=(0,z.tB)(t.stroke),I=o?m:void 0,T=o?v:void 0,w=[];I&&w.push(q(!0,I)),T&&w.push(q(!1,T)),p=null===(l=p)||void 0===l?void 0:l.filter((e=>"defs"!==e.tagName)),w.length>0&&p&&p.unshift({type:r.Element,tagName:"defs",children:w}),null===(d=p)||void 0===d||d.forEach((e=>{if(e&&["path","clipPath"].includes(e.tagName||"")&&("path"===e.tagName&&(x.forEach((t=>{const i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();let r=f[t];var n,a;"strokeWidth"===t&&(r=(null!==(n=r)&&void 0!==n?n:0)*fe);"strokeDasharray"===t&&Array.isArray(r)&&r.length&&(r=null===(a=r)||void 0===a?void 0:a.map((e=>e*fe)));if("stroke"===t){const[t,i]=ye(!1,_,T);return e.properties.stroke=t,void(1!==i&&(e.properties["stroke-opacity"]=i))}if("fill"===t){const[t,i]=ye(!0,g,I);return e.properties.fill=t,void(1!==i&&(e.properties["fill-opacity"]=i))}e.properties[i]=r})),e.properties.d=f.d),"clipPath"===e.tagName&&e.children)){const t=e.children[0];t&&"path"===t.tagName&&(t.properties.d=f.d)}})),h[0].children=p;return Y(u)}function me(e,t){return ge(e,t,0,void 0,1,!1)}const _e={left:[{type:"none",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="2" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 0 40 2" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_arrow",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 5.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="solid_arrow" transform="translate(0 1) scale(2)" >\n\t<path fill="#000000" stroke-linecap="round" stroke-linejoin="round" d="M 2.5,-1.5,0.5,0,2.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"arrow",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 1,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="arrow" transform="translate(0 1) scale(2)" >\n\t<path fill="none" stroke-linecap="round" stroke-linejoin="round" d="M 2.5,-1.5,0.5,0,2.5,1.5 " stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"vertical_line",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 1.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="vertical_line" transform="translate(0 1) scale(2)" >\n\t<rect stroke="none" width="1" height="4" x="0" y="-2" rx="0.5" fill="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_rect",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 7.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="solid_rect" transform="translate(0 1) scale(2)" >\n\t<rect fill="#000000" stroke-linejoin="round" width="3" height="3" x="0.5" y="-1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"rect",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 7.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="rect" transform="translate(0 1) scale(2)" >\n\t<rect fill="none" stroke-linejoin="round" width="3" height="3" x="0.5" y="-1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_circle",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 7.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="solid_circle" transform="translate(0 1) scale(2)" >\n\t<circle fill="#000000" cx="2" r="1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"circle",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 7.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="circle" transform="translate(0 1) scale(2)" >\n\t<circle fill="none" cx="2" r="1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_rhombus",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 6.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="solid_rhombus" transform="translate(0 1) scale(2)" >\n\t<path fill="#000000" stroke-linejoin="round" d="M 0.5,0 l 1.5,-1.5 1.5,1.5 -1.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"rhombus",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 6.5,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_l" sub-type="rhombus" transform="translate(0 1) scale(2)" >\n\t<path fill="none" stroke-linejoin="round" d="M 0.5,0 l 1.5,-1.5 1.5,1.5 -1.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'}],right:[{type:"none",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="2" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 0 40 2" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 40,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_arrow",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 34.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="solid_arrow" transform="translate(40 1) scale(2)" >\n\t<path fill="#000000" stroke-linecap="round" stroke-linejoin="round" d="M -2.5,-1.5,-0.5,0,-2.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"arrow",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 39,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="arrow" transform="translate(40 1) scale(2)" >\n\t<path fill="none" stroke-linecap="round" stroke-linejoin="round" d="M -2.5,-1.5,-0.5,0,-2.5,1.5 " stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"vertical_line",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 38.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="vertical_line" transform="translate(40 1) scale(2)" >\n\t<rect stroke="none" width="1" height="4" x="-1" y="-2" rx="0.5" fill="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_rect",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 32.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="solid_rect" transform="translate(40 1) scale(2)" >\n\t<rect fill="#000000" stroke-linejoin="round" width="3" height="3" x="-3.5" y="-1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"rect",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 32.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="rect" transform="translate(40 1) scale(2)" >\n\t<rect fill="none" stroke-linejoin="round" width="3" height="3" x="-3.5" y="-1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_circle",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 32.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="solid_circle" transform="translate(40 1) scale(2)" >\n\t<circle fill="#000000" cx="-2" r="1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"circle",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 32.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="circle" transform="translate(40 1) scale(2)" >\n\t<circle fill="none" cx="-2" r="1.5" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"solid_rhombus",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 33.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="solid_rhombus" transform="translate(40 1) scale(2)" >\n\t<path fill="#000000" stroke-linejoin="round" d="M -0.5,0 l -1.5,-1.5 -1.5,1.5 1.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'},{type:"rhombus",content:'<svg xmlns="http://www.w3.org/2000/svg" class="urh_lA" width="40" height="8" style="stroke: rgb(0, 0, 0); fill: rgb(0, 0, 0);" viewBox="0 -3 40 8" >\n\t<g >\n\t<g type="line" class="_682gpw" style="touch-action: pan-x pan-y pinch-zoom;" >\n\t<path d="M 0,1 L 33.5,1" stroke-linecap="butt" stroke-width="2" fill="none" pointer-events="auto" stroke="#000000" />\n</g>\n\t<g type="endpoint_r" sub-type="rhombus" transform="translate(40 1) scale(2)" >\n\t<path fill="none" stroke-linejoin="round" d="M -0.5,0 l -1.5,-1.5 -1.5,1.5 1.5,1.5 Z" stroke="#000000" />\n</g>\n</g>\n</svg>'}]};function ve(e,t,i,r){const n={strokeWidth:i,strokeDasharray:r,viewBox:G(ne(e,t).children[0].properties.viewBox)};return r.length&&(n.strokeDasharray=i?[r[0]*i,r[1]*i]:[...r]),n}function Ie(e,t){const i={strokeWidth:e,strokeDasharray:t};if(t.length){const r=e||2;i.strokeDasharray=[t[0]*r/2,t[1]*r/2]}return i}function Te(e,t){const i={strokeWidth:e,strokeDasharray:t};return i.strokeDasharray=t.length?[t[0]*e,t[1]*e]:[],i}function we(e,t){const i={strokeWidth:e,strokeDasharray:t};return i.strokeDasharray=t.length?[t[0]*e/2,t[1]*e/2]:[],i}function Ee(e,t){return{attr:t,viewBox:G(ne(e,t).children[0].properties.viewBox)}}const xe=new class{constructor(){this.LinePointType=u,this.LayerType=I.Wq,this.LinePointIcon=_e,this.DefaultShapeDpr=b,this.svgToImage=ie,this.shadowCompareAttrs=y,this.parseSvg=c,this.getSvgAttrs=Q,this.getSliderValues=ee,this.composeLineByAttrs=ae,this.composeLineByAttrsForExport=oe,this.composePolygonByAttrs=ge,this.composePolygonByAttrsForExport=me,this.isCornerRect=g,this.updateLineStrokeWidth=ve,this.updateShapeStrokeWidth=Ie,this.updateLineStrokeDasharray=Te,this.updateShapeStrokeDasharray=we,this.updateLinePointType=Ee,this.updatePolygonPath=pe}getSvgAttrsByString(e,t){return Q(e,c(t))}}},22231:(e,t,i)=>{"use strict";var r,n,a,o,s,l,c;i.d(t,{t:()=>d});const d={Windows:null!==(r=null===(n=i.g.navigator)||void 0===n?void 0:n.platform.startsWith("Win"))&&void 0!==r&&r,MacOS:null!==(a=null===(o=i.g.navigator)||void 0===o?void 0:o.platform.startsWith("Mac"))&&void 0!==a&&a,Linux:null!==(s=null===(l=i.g.navigator)||void 0===l?void 0:l.platform.startsWith("Linux"))&&void 0!==s&&s,IOS:["iPhone","iPad","iPod"].indexOf(null===(c=i.g.navigator)||void 0===c?void 0:c.platform)>=0}},61054:(e,t,i)=>{"use strict";var r;i.d(t,{p:()=>n}),function(e){e[e.One2One=1]="One2One",e[e.Nine2Sixteen=2]="Nine2Sixteen",e[e.Sixteen2Nine=3]="Sixteen2Nine",e[e.Four2Three=4]="Four2Three",e[e.Two2Three=5]="Two2Three",e[e.ShorterRectangle=6]="ShorterRectangle",e[e.LongRectangle=7]="LongRectangle",e[e.LongerRectangle=8]="LongerRectangle",e[e.Other=9999]="Other"}(r||(r={}));r.One2One,r.Nine2Sixteen,r.Sixteen2Nine,r.Four2Three,r.Two2Three,r.ShorterRectangle,r.LongRectangle,r.LongerRectangle,r.Other;const n=[{serverScaleType:r.One2One,size:[1,1],range:{min:.85,max:1.15}},{serverScaleType:r.Nine2Sixteen,size:[9,16],range:{min:.25,max:.85}},{serverScaleType:r.ShorterRectangle,size:[940,788],range:{min:1.15,max:1.5}},{serverScaleType:r.LongRectangle,size:[1640,924],range:{min:1.77,max:1.78}},{serverScaleType:r.Sixteen2Nine,size:[16,9],range:{min:1.5,max:4}},{serverScaleType:r.LongerRectangle,size:[4,1],range:{min:3.5,max:5}}]},72918:(e,t,i)=>{"use strict";i.d(t,{G:()=>a,o:()=>n});var r=i(8757);const n="CAPCUT_THEME",a=()=>i.g.localStorage.getItem(n)!==r.hY.Dark},24657:(e,t,i)=>{"use strict";var r,n;i.d(t,{M:()=>n,Z:()=>r}),function(e){e[e.left=0]="left",e[e.center=1]="center",e[e.right=2]="right"}(r||(r={})),function(e){e.add="add",e.delete="delete",e.edit="edit",e.swap="swap",e.init="init"}(n||(n={}))},36451:(e,t,i)=>{"use strict";let r,n;i.d(t,{F:()=>a,v:()=>o});const a=()=>{if(!n){const e=document.createElement("canvas");n=e.getContext("2d",{willReadFrequently:!0}),r=e}return n},o=e=>{const t=a();t.save(),e(r,t),t.restore()}},45065:(e,t,i)=>{"use strict";function r(e,t){let i=0;return(...r)=>{const n=(new Date).getTime();if(!(n-i<t))return i=n,e(...r)}}i.d(t,{r:()=>r})},41658:(e,t,i)=>{"use strict";function r(e){return"number"==typeof e&&!isNaN(e)}function n(e,t,i,a){return(i||Object.keys(e)).some((i=>{const o=e[i],s=t[i];return o instanceof Object&&s instanceof Object?n(o,s,void 0,a):r(o)&&r(s)?!function(e,t,i=0){return i?Math.abs(e-t)<i:e===t}(o,s,a):o!==s}))}i.d(t,{d:()=>n})},20484:(e,t,i)=>{"use strict";i.d(t,{Sw:()=>n,ei:()=>a});const r=e=>"[object Array]"===Object.prototype.toString.call(e),n=e=>{const t=new Map,i=e=>{if("function"==typeof e)return e;if("object"==typeof e){if(null===e)return e;if(t.has(e))return t.get(e);const n=r(e)?[]:{};return t.set(e,n),r(e)?e.forEach((e=>{n.push(i(e))})):Object.keys(e).forEach((t=>{n[t]=i(e[t])})),n}return e};return i(e)},a=(e,t)=>"object"!=typeof e||null===e?e:t.reduce(((t,i)=>void 0===e[i]?t:{...t,[i]:e[i]}),{})},62587:(e,t,i)=>{"use strict";function r(e){return`${null!=e?e:"default"}-${Date.now()}`}i.d(t,{Y:()=>r})},68967:(e,t,i)=>{"use strict";i.d(t,{Cm:()=>o,PZ:()=>c,fw:()=>m,gO:()=>d,jv:()=>s,m4:()=>u,nk:()=>h,qM:()=>a,tP:()=>n,td:()=>g,vG:()=>y});var r=i(93062);const n="/:category(editor-graphic|editor-batch)/:draftId?";function a(){var e;const t=(0,r.EQ)(n)(i.g.location.pathname);return null==t||null===(e=t.params)||void 0===e?void 0:e.draftId}function o(){var e;const t=(0,r.EQ)(n)(i.g.location.pathname);return null==t||null===(e=t.params)||void 0===e?void 0:e.category}function s(e){try{return new URL(e),!0}catch(t){return!1}}const l="originParams";function c(e){i.g.location[l]=e}function d(){var e;return null!==(e=i.g.location[l])&&void 0!==e?e:{}}class u{constructor(e){this._currentUrl=e}static create(e){return new u(e)}addQueryParameter(e,t){const i=-1===this._currentUrl.indexOf("?")?"?":"&";return this._currentUrl=`${this._currentUrl}${i}${encodeURIComponent(e)}=${encodeURIComponent(t)}`,this}removeAllQueryParameter(e=[]){const t=this._currentUrl.split("?")[1];if(!t)return this;const i=t.split("&");for(let r=0;r<i.length;r++){const t=i[r].split("=")[0];e.includes(t)||(i.splice(r,1),r--)}return i.length>0?this._currentUrl=this._currentUrl.replace(t,i.join("&")):this._currentUrl=this._currentUrl.replace(`?${t}`,""),this}removeQueryParameter(e){const t=new RegExp(`([&?])${e}=[^&]*[&]?`);return this._currentUrl=this._currentUrl.replace(t,(e=>e.startsWith("?")?"?":e.endsWith("&")?"&":"")),this}replaceResourceName(e){const t=this._currentUrl.match(/^(.*\/)([^/]+)$/);if(t&&t.length>2){const i=t[1],r=e.startsWith("/")?e.substr(1):e;this._currentUrl=`${i}${r}`}return this}getQueryParameterValue(e){const t=this._currentUrl.split("?")[1];return new URLSearchParams(t).get(e)}getAllQueryParameterValues(){const e=this._currentUrl.split("?")[1];if(!e)return{};const t={},i=new URLSearchParams(e);for(const[r,n]of i)t[r]=n;return t}toString(){return this._currentUrl}}function h(){if(document.referrer.includes(location.host))return{};const e=d(),t=e.utm_source;if(!t)return{};return{channel_level1:t,channel_level2:e.utm_medium,channel_level3:e.utm_sub_source}}var p;function f(){const{utm_campaign:e}=d();return e}function y(){return f()===p.chatgpt}function g(){const{state:e}=d();return f()===p.googleDrive&&Boolean(e)}function m(){const{uploadCreate:e,coverId:t}=d();return"1"===e||Boolean(t)}!function(e){e.chatgpt="chatgpt",e.googleDrive="googledrive"}(p||(p={}))},58789:(e,t,i)=>{"use strict";function r(e){return e.split(".")}function n(e,t){return Number(r(e).join(""))-Number(r(t).join(""))}i.d(t,{f:()=>r,y:()=>n})},3549:(e,t,i)=>{"use strict";function r(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<10;i++)e+=t.charAt(Math.floor(62*Math.random()));return e+Date.now().toString()}i.d(t,{V:()=>r})},82440:(e,t,i)=>{"use strict";i.d(t,{ss:()=>d,XD:()=>M,Bm:()=>C,Mk:()=>N,U5:()=>D,Tl:()=>S,yM:()=>ce,fc:()=>ue,_g:()=>P,QI:()=>L,ZP:()=>he,Nf:()=>_,Kt:()=>c,fO:()=>B,Uz:()=>F});var r=i(67986),n=i(68967),a=i(92202),o=i(62889);const s="lvweb-editor-graphic-cache-db-version0331",l=["application/zip","application/x-7z-compressed","application/gzip","application/x-tar"],c=[{id:"effect_text_fallback_0",resourceId:"effect_text_fallback_0",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/en.zip",md5:"effect_text_fallback_0"}},{id:"effect_text_fallback_1",resourceId:"effect_text_fallback_1",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/ja.zip",md5:"effect_text_fallback_1"}},{id:"effect_text_fallback_2",resourceId:"effect_text_fallback_2",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/ko.zip",md5:"effect_text_fallback_2"}},{id:"effect_text_fallback_3",resourceId:"effect_text_fallback_3",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/emoji.zip",md5:"effect_text_fallback_3"}},{id:"effect_text_fallback_4",resourceId:"effect_text_fallback_4",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/th.zip",md5:"effect_text_fallback_4"}},{id:"effect_text_fallback_5",resourceId:"effect_text_fallback_5",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/zh-hans.zip",md5:"effect_text_fallback_5"}},{id:"effect_text_fallback_6",resourceId:"effect_text_fallback_6",fileUrl:{url:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/font/zh-hant.zip",md5:"effect_text_fallback_6"}}];class d{constructor(e=s,t=50){this._cacheStore=i.g.indexedDB?o.MT(e,"store"):void 0,this._cacheSize=t}async set(e){try{const t=this._untieArray(e);return Array.isArray(t)?await this._setMany(t):await this._set(t),!0}catch(t){return!1}}get(e){try{const t=this._untieArray(e);return this._get(t)}catch(t){return r.t.error("[graphic cache sdk]indexdb get value failed",t),Promise.resolve(void 0)}}delete(e){try{o.IV(e,this._cacheStore)}catch(t){r.t.error("[graphic cache sdk]indexdb delete value failed",t)}return Promise.resolve()}async saveLocalFile(){}clear(){o.ZH()}_untieArray(e){if(Array.isArray(e)){if(!e.length)throw new Error("[cache sdk]_untieArray: items array must not be empty");return e.length<=1?e[0]:e}return e}async _set(e){await o.t8(e.key,e.value,this._cacheStore)}async _setMany(e){const t=e.map((e=>[e.key,e.value]));await o.vw(t,this._cacheStore)}_get(e){return o.U2(e,this._cacheStore)}_getMany(e){return o.yS(e,this._cacheStore)}}var u=i(95411);class h extends u.Z{constructor(e=5){super(),this._concurrency=e,this._activeMap=new Map,this._waitingList=[]}active(e){const t=this._isActive(e.id),i=this._isWaiting(e.id);return t||i?i?(this._splice(this._waitingList,e.id),this._run(e)):new Promise(((t,i)=>{this.on(`DONE:${e.id}`,t),this.on(`FAIL:${e.id}`,i)})):this._run(e)}enQueue(e){const t=this._isActive(e.id),i=this._isWaiting(e.id);if(!t&&!i){if(this._activeMap.size<this._concurrency)return this._run(e);this._waitingList.push(e)}return new Promise(((t,i)=>{this.on(`DONE:${e.id}`,t),this.on(`FAIL:${e.id}`,i)}))}_isActive(e){return Boolean(this._activeMap.get(e))}_isWaiting(e){return Boolean(this._waitingList.find((t=>t.id===e)))}_splice(e,t){const i=e.findIndex((e=>e.id===t));this._waitingList.splice(i,1)}async _run(e){let t;this._activeMap.set(e.id,e);try{t=await e.start(),this.emit(`DONE:${e.id}`,t)}catch(i){this.emit(`FAIL:${e.id}`,i)}if(this._activeMap.delete(e.id),this._waitingList.length){const e=this._waitingList.shift();e&&this.active(e)}return t}}var p=i(62347);class f{constructor(e){this._queue=new h(e)}run(e,t=!1){const i=this._genTask(e);return t?this._queue.enQueue(i):this._queue.active(i)}_genTask(e){var t;const i=p.default.CancelToken.source();return{id:null!==(t=e.md5)&&void 0!==t?t:e.url,start:async()=>{const t=await this._downloadFileByUrl(e.url,{cancelToken:i.token});return null!=t&&t.data?e.md5?t:Promise.reject(new TypeError("md5 in identifier is undefined")):Promise.reject()},abort:()=>{i.cancel()}}}async _downloadFileByUrl(e,t){try{const i=e.startsWith("http://")?e.replace(/^http:\/\//,"https://"):e;return await(0,p.default)({method:"get",url:i,responseType:"arraybuffer",...t})}catch(i){return Promise.reject(i)}}}var y=i(17597),g=i(8757);class m{constructor(e){this._db=new d(s),this._downloader=new f(e)}static getInstance(e){return m._instance||(this._instance=Symbol.for("graphicCacheSDK"),i.g[this._instance]=new m(e)),i.g[this._instance]}async getMaterial(e,t=!1){try{var i;const{isExisted:o,cacheValue:s}=await this.getMaterialFromCache(null!==(i=e.md5)&&void 0!==i?i:"");if(o)return s;if(!e.url)return void r.t.error(`[graphic-cache-sdk]getMaterial: url(${e.url}) is undefined.`);if(!e.isDefaultFont&&!(0,n.jv)(e.url))return void r.t.error(`[graphic-cache-sdk]getMaterial: url(${e.url}) is invalid.`);let l,c;if(e.type===g.xP.EverCloud&&e.aesKey){const t=await(0,a.V)({url:e.url,key:e.aesKey});l=t.buffer,c=t.contentType}else{const i=await this._downloader.run(e,t);l=i.data,c=i.headers["content-type"]}const d=await this._getCacheValue(l,c);return e.md5&&this._db.set({key:e.md5,value:d}),d}catch(s){var o;const t=null!==(o=s.message)&&void 0!==o?o:"getLokiResource failed";return void r.t.error(`[graphic cache sdk]${t}, url: ${e.url} md5: ${e.md5}`)}}async getMaterialFromCache(e){const t=await this._db.get(e);return t?{isExisted:!0,cacheValue:t}:{isExisted:!1}}async _getCacheValue(e,t=""){let i={};if(l.includes(t)){const{entries:t}=await(0,y.Ri)(e);for(const[e,r]of Object.entries(t)){if(r.isDirectory||e.startsWith("__MACOSX")||e.includes(".DS_Store"))continue;const n=await t[e].arrayBuffer();i[e.replaceAll("//","/")]=n}}else i=e;return i}}const _=e=>{var t;return{id:e.Md5,resourceId:e.ResourceId.toString(),md5:e.FileUrl.Uri,url:null===(t=e.FileUrl.UrlList)||void 0===t?void 0:t[0],effectId:e.EffectId,name:e.Name,panel:e.Panel,fileUrl:e.FileUrl,resource:e.Source}};class v{constructor(){this._cacheManager=m.getInstance(1)}async downloadToBuffer(e,t,i){const r=[],{type:n,fileUrl:a,aesKey:o,isDefaultFont:s}=e,l=await this._cacheManager.getMaterial({type:n,url:a.url,md5:a.md5,aesKey:o,isDefaultFont:s});l?(await this._formatDownloadBuffer(e,l,r,this._cacheManager),t(r)):null==i||i()}getMaterialTypeBuffer(e,t){switch(e){case g.xP.SalesSticker:const i=Object.keys(t).find((e=>e.endsWith(".png")));if(!i)return;return t[i];case g.xP.Svg:if(!Object.keys(t).find((e=>e.endsWith(".svg"))))return;return t;case g.xP.SalesFrame:case g.xP.SalesGrid:return t;case g.xP.Fonts:case g.xP.SalesFont:case g.xP.CNFont:const r=Object.keys(t).find((e=>{const t=e.toLowerCase();return t.endsWith(".ttf")||t.endsWith(".otf")}));if(!r)return;return{filename:r,data:t[r]};case g.xP.SalesTextTemplate:case g.xP.EverCloud:case g.xP.SalesFilter:case g.xP.SalesImageEffect:case g.xP.EffectModel:case g.xP.AIBackground:case g.xP.ImageInTemplate:case g.xP.SalesTextGlow:case g.xP.SalesFontsCombination:return t;case g.xP.SalesTextPreset:case g.xP.SvgSticker:const n=Object.keys(t).find((e=>e.endsWith("content.json")));if(!n)return;return t[n];default:throw new Error(`${e} is not support`)}}async _formatDownloadBuffer(e,t,i,r){const n=this.getMaterialTypeBuffer(e.type,t);i.push({resourceId:e.resourceId.toString(),id:e.id.toString(),buffer:n}),e.type===g.xP.SalesTextTemplate&&await Promise.all(e.dependency.map((async e=>{const{id:t,resourceId:n,url:a,md5:o}=_(e);if(!a)return;const s=await r.getMaterial({url:a,md5:o});return i.push({resourceId:n,id:t,buffer:s}),s})))}}var I,T,w,E=i(75709);!function(e){e[e.MetaTypeNone=0]="MetaTypeNone",e[e.MetaTypeVideo=1]="MetaTypeVideo",e[e.MetaTypePhoto=2]="MetaTypePhoto",e[e.MetaTypeGif=3]="MetaTypeGif",e[e.MetaTypeMusic=4]="MetaTypeMusic",e[e.MetaTypeExtractMusic=5]="MetaTypeExtractMusic",e[e.MetaTypeSound=6]="MetaTypeSound",e[e.MetaTypeRecord=7]="MetaTypeRecord",e[e.MetaTypeImage=8]="MetaTypeImage",e[e.MetaTypeText=9]="MetaTypeText",e[e.MetaTypeSubtitle=10]="MetaTypeSubtitle",e[e.MetaTypeLyrics=11]="MetaTypeLyrics",e[e.MetaTypeSticker=12]="MetaTypeSticker",e[e.MetaTypeFilter=13]="MetaTypeFilter",e[e.MetaTypeLUT=14]="MetaTypeLUT",e[e.MetaTypeReshape=15]="MetaTypeReshape",e[e.MetaTypeBeauty=16]="MetaTypeBeauty",e[e.MetaTypeVideoEffect=17]="MetaTypeVideoEffect",e[e.MetaTypeBrightness=18]="MetaTypeBrightness",e[e.MetaTypeContrast=19]="MetaTypeContrast",e[e.MetaTypeSaturation=20]="MetaTypeSaturation",e[e.MetaTypeSharpen=21]="MetaTypeSharpen",e[e.MetaTypeHighlight=22]="MetaTypeHighlight",e[e.MetaTypeShadow=23]="MetaTypeShadow",e[e.MetaTypeTemperature=24]="MetaTypeTemperature",e[e.MetaTypeHue=25]="MetaTypeHue",e[e.MetaTypeFade=26]="MetaTypeFade",e[e.MetaTypeLightSensation=27]="MetaTypeLightSensation",e[e.MetaTypeVignetting=28]="MetaTypeVignetting",e[e.MetaTypeParticle=29]="MetaTypeParticle",e[e.MetaTypeSegCanvas=30]="MetaTypeSegCanvas",e[e.MetaTypeCanvasColor=31]="MetaTypeCanvasColor",e[e.MetaTypeCanvasImage=32]="MetaTypeCanvasImage",e[e.MetaTypeCanvasBlur=33]="MetaTypeCanvasBlur",e[e.MetaTypeTransition=34]="MetaTypeTransition",e[e.MetaTypeAudioEffect=35]="MetaTypeAudioEffect",e[e.MetaTypeAudioFade=36]="MetaTypeAudioFade",e[e.MetaTypeBeats=37]="MetaTypeBeats",e[e.MetaTypeTailLeader=38]="MetaTypeTailLeader",e[e.MetaTypeAnimation=39]="MetaTypeAnimation",e[e.MetaTypeVideoAnimation=40]="MetaTypeVideoAnimation",e[e.MetaTypeTextEffect=41]="MetaTypeTextEffect",e[e.MetaTypeTextShape=42]="MetaTypeTextShape",e[e.MetaTypeTextToAudio=43]="MetaTypeTextToAudio",e[e.MetaTypeVideoMix=44]="MetaTypeVideoMix",e[e.MetaTypeAdjust=45]="MetaTypeAdjust",e[e.MetaTypeVideoMask=46]="MetaTypeVideoMask",e[e.MetaTypeSpeed=47]="MetaTypeSpeed",e[e.MetaTypeChroma=48]="MetaTypeChroma",e[e.MetaTypeTextTemplate=49]="MetaTypeTextTemplate",e[e.MetaTypeVideoOriginalSound=50]="MetaTypeVideoOriginalSound",e[e.MetaTypeStretchLeg=51]="MetaTypeStretchLeg",e[e.MetaTypeRealtimeDenoise=52]="MetaTypeRealtimeDenoise",e[e.MetaTypeFigure=53]="MetaTypeFigure",e[e.MetaTypeFaceEffect=54]="MetaTypeFaceEffect",e[e.MetaTypeVideoTracking=55]="MetaTypeVideoTracking",e[e.MetaTypeHsl=56]="MetaTypeHsl",e[e.MetaTypeColorCurves=57]="MetaTypeColorCurves",e[e.MetaTypeAudioBalance=58]="MetaTypeAudioBalance",e[e.MetaTypeComposition=59]="MetaTypeComposition",e[e.MetaTypeCover=60]="MetaTypeCover",e[e.MetaTypeLeader=61]="MetaTypeLeader",e[e.MetaTypeTailer=62]="MetaTypeTailer",e[e.MetaTypePrimaryColorWheels=63]="MetaTypePrimaryColorWheels",e[e.MetaTypeLogColorWheels=64]="MetaTypeLogColorWheels",e[e.MetaTypeHandwriteImage=65]="MetaTypeHandwriteImage",e[e.MetaTypeHandwriteRes=66]="MetaTypeHandwriteRes",e[e.MetaTypeCombination=67]="MetaTypeCombination",e[e.MetaTypeManualDeformation=68]="MetaTypeManualDeformation",e[e.MetaTypePluginEffect=69]="MetaTypePluginEffect",e[e.MetaTypeAdCube=70]="MetaTypeAdCube",e[e.MetaTypeAll=71]="MetaTypeAll"}(I||(I={})),function(e){e[e.EffectPlatformLoki=0]="EffectPlatformLoki",e[e.EffectPlatformArtist=1]="EffectPlatformArtist",e[e.EffectPlatformBrand=2]="EffectPlatformBrand"}(T||(T={})),function(e){e.CurveHSL="curve-hsl",e.VoiceChange="voice-change",e.ShootProject="shoot-project",e.ManualFigure="manual-figure",e.LiveshortenPanEntertainment="liveshorten-pan-entertainment",e.FaceProp="face-prop",e.Beauty2="beauty2",e.SkeletonBody="skeleton-body",e.TextTemplate="text-template",e.ShootProp="shoot-prop",e.Shoot="shoot",e.Play="play",e.SystemFonts="system-fonts",e.Beauty="beauty",e.Flower2="flower2",e.Filter2="filter2",e.Bubble2="bubble2",e.Effects="effects2",e.Tone="tone",e.Filter="filter",e.Canvas="canvas",e.Bubble="bubble",e.Flower="flower",e.Video="video",e.Transitions="transitions",e.Mix="mix",e.Sticker="sticker",e.Text="text",e.Insert="insert",e.Fonts="fonts",e.Videomask="videomask",e.Curvespeed="curvespeed",e.Integration="integration",e.Iosemojinew="iosemojinew",e.Emoji="emoji",e.Emojiandroid="emojiandroid",e.Emojiios="emojiios",e.Shape="shape"}(w||(w={}));const x=new TextDecoder("utf-8"),b=e=>{if(!e)return null;const t=x.decode(e);if(!t)return null;try{return JSON.parse(t)}catch(i){return null}};class R{constructor(){this.effectManager=new Map,this.initDependency=({id:e,name:t,resourceId:i,previewUrl:r,resource:n,from:a,type:o,localImage:s})=>{if(ue.getDependency(i))return;let l,c;const d=new Promise(((e,t)=>{l=t=>{const r=ue.getDependency(i);r&&(r.content=t.content,r.buffer=t.buffer,r.isPreview=!1,r.previewUrl=void 0),t.resource=n,e(t||r)},c=t})),u={id:e,name:t,resourceId:i,type:null!=o?o:g.xP.SalesSticker,isPreview:!0,previewUrl:r,resource:n,ready:d,_resolve:l,_reject:c,from:a,localImage:s};return ue.setDependency(i,u),u}}static getInstance(){return R._instance||(R._instance=new R),R._instance}async fetchData(e){const{id:t,name:i,resourceId:r,previewUrl:n="",resource:a,type:o,localImage:s,extraInfo:l}=e;this.initDependency({id:t,name:i,resourceId:r,previewUrl:n,resource:a,type:o,localImage:s}),l&&this.effectManager.set(r,l);const c=ue.getDependency(r);try{var d;const t=await new Promise((t=>ue.getInstance().push(e,(i=>{if("boolean"!=typeof i){const r=this.parser(i,e.resourceId,e.id,e.type);t(r)}else t(c)}))));return null===(d=c._resolve)||void 0===d||d.call(c,t),t}catch(h){var u;throw null===(u=c._reject)||void 0===u||u.call(c,h),h}}parser(e,t,i,r){const n=e[0],a=new Blob([n.buffer]);return{id:i,resourceId:t,content:URL.createObjectURL(a),type:r,buffer:n.buffer}}}class k{static getInstance(){return k._instance?k._instance:k._instance=new k}fetchData(e){const t=e.id,i=ue.getDependency(t);if(i)return i;const r=e.content,n={...e,isPreview:!0};return ue.setDependency(t,n),n.ready=r?Promise.resolve(n):new Promise((t=>{ue.getInstance().push(e,(e=>{!0!==e&&(n.content=this.parser(e),n.isPreview=!1),t(n)}))})),n}parser(e){const t=e[0],i=new TextDecoder("utf-8").decode(t.buffer);try{return JSON.parse(i).svg}catch(r){return""}}}class A{static getInstance(){return A._instance||(A._instance=new A),A._instance}fetchData(e){return new Promise((t=>{ue.getInstance().push(e,(i=>{!0===i&&t(ue.getDependency(e.id));const r=this.parser(i,e.resourceId,e.id,e.type);ue.setDependency(e.id,r),t(r)}))}))}parser(e,t,i,r){const{buffer:n}=e[0],a=Object.keys(n).find((e=>e.endsWith(".svg"))),o=new TextDecoder("utf-8"),s=o.decode(n[null!=a?a:""]);let l;if(n["content.json"]){var c;const e=o.decode(n["content.json"]);l=null===(c=JSON.parse(e))||void 0===c?void 0:c.fixedAreas}return{id:i,resourceId:t,content:JSON.stringify({shapeStr:s,fixedAreas:l}),type:r}}}var P,M,L,S,C;!function(e){e.sticker="sticker",e.default="default",e.text="text",e.image="image",e.fonts="fonts",e.zip="zip"}(P||(P={})),function(e){e[e.ERROR_CODE_FONT_FAIL_RENDER=-18]="ERROR_CODE_FONT_FAIL_RENDER"}(M||(M={})),function(e){e[e.CT_ENTER_EDIT_STATE=0]="CT_ENTER_EDIT_STATE",e[e.CT_EXIT_EDIT_STATE=1]="CT_EXIT_EDIT_STATE",e[e.CT_INPUT_STR=2]="CT_INPUT_STR",e[e.CT_INPUT_RICH_STR=3]="CT_INPUT_RICH_STR",e[e.CT_BACK_DELETE=4]="CT_BACK_DELETE",e[e.CT_START_COMPOSE=6]="CT_START_COMPOSE",e[e.CT_PREEDIT_COMPOSE=7]="CT_PREEDIT_COMPOSE",e[e.CT_END_COMPOSE=8]="CT_END_COMPOSE",e[e.CT_MOVE_CURSOR_LR=16]="CT_MOVE_CURSOR_LR",e[e.CT_MOVE_CURSOR_UPDOWN=17]="CT_MOVE_CURSOR_UPDOWN",e[e.CT_MOVE_CURSOR_LINE_BEGIN_END=18]="CT_MOVE_CURSOR_LINE_BEGIN_END",e[e.CT_MOVE_CURSOR_BY_INDEX=19]="CT_MOVE_CURSOR_BY_INDEX",e[e.CT_MOVE_CURSOR_BY_POS=20]="CT_MOVE_CURSOR_BY_POS",e[e.CT_SELECT_CONTENT=32]="CT_SELECT_CONTENT",e[e.CT_SELECT_LR_CONTENT=33]="CT_SELECT_LR_CONTENT",e[e.CT_SELECT_UPDOWN_CONTENT=34]="CT_SELECT_UPDOWN_CONTENT",e[e.CT_SELECT_MOUSE_CONTENT=35]="CT_SELECT_MOUSE_CONTENT",e[e.CT_SELECT_ALL_CONTENT=36]="CT_SELECT_ALL_CONTENT",e[e.CT_EDIT_FONT=48]="CT_EDIT_FONT",e[e.CT_EDIT_COLOR=49]="CT_EDIT_COLOR",e[e.CT_EDIT_ALPHA=50]="CT_EDIT_ALPHA",e[e.CT_EDIT_BGCOLOR=51]="CT_EDIT_BGCOLOR",e[e.CT_EDIT_BG_ALPHA=52]="CT_EDIT_BG_ALPHA",e[e.CT_EDIT_SIZE=53]="CT_EDIT_SIZE",e[e.CT_EDIT_BOLD=54]="CT_EDIT_BOLD",e[e.CT_EDIT_ITALIC=55]="CT_EDIT_ITALIC",e[e.CT_EDIT_UNDERLINE=56]="CT_EDIT_UNDERLINE",e[e.CT_EDIT_OUTLINE=57]="CT_EDIT_OUTLINE",e[e.CT_EDIT_OUTLINE_COLOR=58]="CT_EDIT_OUTLINE_COLOR",e[e.CT_EDIT_OUTLINE_ALPHA=59]="CT_EDIT_OUTLINE_ALPHA",e[e.CT_EDIT_OUTLINE_WIDTH=60]="CT_EDIT_OUTLINE_WIDTH",e[e.CT_EDIT_SHADOW=61]="CT_EDIT_SHADOW",e[e.CT_EDIT_SHADOW_COLOR=62]="CT_EDIT_SHADOW_COLOR",e[e.CT_EDIT_SHADOW_ALPHA=63]="CT_EDIT_SHADOW_ALPHA",e[e.CT_EDIT_SHADOW_SMOOTH=64]="CT_EDIT_SHADOW_SMOOTH",e[e.CT_EDIT_SHADOW_OFFSET=65]="CT_EDIT_SHADOW_OFFSET",e[e.CT_EDIT_TEXT_PARAM=68]="CT_EDIT_TEXT_PARAM",e[e.CT_EDIT_RESET_TEXT_CONTEXT=70]="CT_EDIT_RESET_TEXT_CONTEXT",e[e.CT_EDIT_FILL=73]="CT_EDIT_FILL",e[e.CT_EDIT_MULTI_STROKE=74]="CT_EDIT_MULTI_STROKE",e[e.CT_EDIT_MULTI_SHADOW=75]="CT_EDIT_MULTI_SHADOW",e[e.CT_GET_RICH_STR=257]="CT_GET_RICH_STR",e[e.CT_GET_CURSOR_RECT=258]="CT_GET_CURSOR_RECT",e[e.CT_GET_CURSOR_CHAR_INDEX=259]="CT_GET_CURSOR_CHAR_INDEX",e[e.CT_GET_SELECT_RANGE=261]="CT_GET_SELECT_RANGE",e[e.CT_GET_EDIT_CONTEXT_INFO=263]="CT_GET_EDIT_CONTEXT_INFO",e[e.CT_GET_SELECT_HANDLE_RECT=264]="CT_GET_SELECT_HANDLE_RECT",e[e.CT_GET_TEXT_RECT=265]="CT_GET_TEXT_RECT"}(L||(L={})),function(e){e[e.GCT_EDIT_EFFECT=0]="GCT_EDIT_EFFECT",e[e.GCT_ADD_EFFECT=1]="GCT_ADD_EFFECT",e[e.GCT_REMOVE_EFFECT=2]="GCT_REMOVE_EFFECT",e[e.GCT_EDIT_LUMI_EFFECT=10]="GCT_EDIT_LUMI_EFFECT",e[e.GCT_ADD_LUMI_EFFECT=11]="GCT_ADD_LUMI_EFFECT",e[e.GCT_REMOVE_LUMI_EFFECT=12]="GCT_REMOVE_LUMI_EFFECT"}(S||(S={})),function(e){e.effectAwaitLoader="[effectsdk]-[wasm] loader\u52a0\u8f7d",e.effectAnalyzeWasm="[effectsdk]-[wasm] \u89e3\u6790wasm\u5b9e\u4f8b",e.effectWasmInit="[effectsdk]-[wasm] \u521d\u59cb\u5316",e.createEffectCanvas="[effectsdk]-[effect] \u521d\u59cb\u5316 canvas",e.createWebCanvas="[effectsdk]-[web] \u521d\u59cb\u5316 canvas",e.addText="[effectsdk]-[effect] \u6dfb\u52a0\u8f68\u9053",e.renderText="[effectsdk]-[effect&web] \u6e32\u67d3\u6587\u672c",e.updateAllTime="[effectsdk]-[effect&web] effect\u66f4\u65b0\u6587\u672c",e.seekFrame="[effectsdk]-[effect] \u7ed8\u5236\u5355\u6b21",e.setCanvasSize="[effectsdk]-[effect] \u91cd\u65b0\u8bbe\u7f6ecanvas\u5c3a\u5bf8",e.setTextUpdateCommand="[effectsdk]-[effect] \u8bbe\u7f6e\u7f16\u8f91\u6307\u4ee4",e.enterEdit="[effectsdk]-[effect] \u8fdb\u5165\u7f16\u8f91\u6001",e.exitEdit="[effectsdk]-[effect] \u9000\u51fa\u7f16\u8f91\u6001",e.editParams="[effectsdk]-[effect] \u4fee\u6539\u6587\u672cjson\u6570\u636e",e.editScale="[effectsdk]-[effect] \u4fee\u6539scale\u503c",e.getFontLayout="[effectsdk]-[effect] \u83b7\u53d6\u6587\u672c\u5bbd\u9ad8\u4fe1\u606f\u63a5\u53e3",e.webCreateCanvas="[effectsdk]-[web] \u521b\u5efa\u5907\u4efdcanvas",e.webUpdateSeekFrame="[effectsdk]-[web] \u66f4\u65b0\u7ed8\u5236\u5355\u6b21",e.getFontLayoutApi="[effectsdk]-[effect] \u83b7\u53d6\u6587\u672c\u5bbd\u9ad8\u4fe1\u606f",e.setSysFontPaths="[effectsdk]-[effect] \u8bbe\u7f6e\u7cfb\u7edf\u5b57\u4f53",e.selectSomeText="[effectsdk]-[effect] \u9009\u4e2d\u4e00\u4e32\u6587\u5b57",e.setTextCursor="[effectsdk]-[effect] \u8bbe\u7f6e\u5149\u6807\u4f4d\u7f6e",e.getTextCursorRect="[effectsdk]-[effect] \u83b7\u53d6\u5149\u6807\u4f4d\u7f6erect",e.getTextCursorIndex="[effectsdk]-[effect] \u83b7\u53d6\u5149\u6807\u4f4d\u7f6eindex",e.getTextCursorPos="[effectsdk]-[effect] \u83b7\u53d6\u5149\u6807\u7edd\u5bf9\u4f4d\u7f6e",e.getCursorPosByClick="[effectsdk]-[web&effect] \u6839\u636e\u70b9\u51fb\u4f4d\u7f6e\u83b7\u53d6\u5149\u6807\u4f4d\u7f6e",e.updateEditText="[effectsdk]-[web&effect] \u66f4\u65b0\u5c4f\u4e0a\u7f16\u8f91\u6587\u672c",e.getTextStatic="[effectsdk]-[effect] \u83b7\u53d6\u6587\u5b57\u9759\u6001\u63a5\u53e3",e.setTextCursorByIndex="[effectsdk]-[effect] \u901a\u8fc7index\u8bbe\u7f6e\u5149\u6807\u4f4d\u7f6e",e.setTextInfo="[effectsdk]-[effect] \u540c\u6b65\u6587\u672c\u5168\u91cf\u4fe1\u606f",e.getCursorPosByIndex="[effectsdk]-[effect] \u901a\u8fc7index\u83b7\u53d6\u5149\u6807\u4f4d\u7f6e",e.insertText="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u63d2\u5165\u6587\u672c",e.deleteText="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u5220\u9664\u6587\u672c",e.setCursorByMovePos="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u79fb\u52a8\u5149\u6807",e.setTextCursorAndSelect="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u79fb\u52a8\u5149\u6807,\u5e76\u9009\u4e2d\u7ecf\u8fc7\u533a\u57df\u6587\u5b57",e.getTextEditInfo="[effectsdk]-[effect] \u83b7\u53d6\u7f16\u8f91\u6001\u4e2d\u7684\u6587\u672c\u4fe1\u606f",e.resetTextEditInfo="[effectsdk]-[effect] \u91cd\u7f6e\u7f16\u8f91\u6001\u4e2d\u7684\u6587\u672c\u4fe1\u606f",e.composeStart="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u5f00\u59cb\u5408\u6210\u6587\u672c",e.composeUpdate="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u6b63\u5728\u5408\u6210\u6587\u672c",e.composeEnd="[effectsdk]-[effect] \u7f16\u8f91\u6001\u4e2d\u7ed3\u675f\u5408\u6210\u6587\u672c",e.addGraphic="[effectsdk]-[effect]-[image] \u6dfb\u52a0\u56fe\u7247",e.replaceGraphic="[effectsdk]-[effect]-[image] \u66ff\u6362\u56fe\u7247",e.updateGraphic="[effectsdk]-[effect]-[image] \u66f4\u65b0\u56fe\u7247\u7279\u6548",e.removeGraphic="[effectsdk]-[effect]-[image] \u79fb\u9664\u56fe\u7247",e.renderGraphic="[effectsdk]-[web]-[image] \u7ed8\u5236\u56fe\u7247\u7279\u6548\u6574\u4f53\u8017\u65f6",e.initGraphicPostProcess="[effectsdk]-[effect]-[image]-[lumi] \u521d\u59cb\u5316 LumiHub",e.addGraphicPostProcess="[effectsdk]-[web]-[image]-[lumi] \u6dfb\u52a0\u540e\u5904\u7406\u9053\u5177",e.updateGraphicPostProcess="[effectsdk]-[web]-[image]-[lumi] \u66f4\u65b0\u540e\u5904\u7406\u9053\u5177\u53c2\u6570",e.removeGraphicPostProcess="[effectsdk]-[web]-[image]-[lumi] \u79fb\u9664\u540e\u5904\u7406\u9053\u5177",e.getOutputTextureSize="[effectsdk]-[effect]-[image]-[lumi] getOutputTextureSize"}(C||(C={}));const O=async(e,t,i)=>{const n={},a=[];return Object.keys(i).forEach((e=>{n[e.replaceAll("//","/")]=i[e]})),await Promise.all(Object.keys(n).map((async i=>{const o=i.split("/");o.forEach(((i,r)=>{if(r!==o.length-1){const i=o.slice(0,r+1).join("/"),n=`${t}/${i}`;a.push(n),e.mkdirTree(n)}}));const s=`${t}/${i}`;a.push(s),await(async(e,t,i)=>{const n=decodeURI(t),a=t.substring(0,n.lastIndexOf("/"));try{return e.stat(n),r.t.log(`File exists just return${n}`),""}catch(c){}const o=i instanceof Blob?await i.arrayBuffer():i,s=new Uint8Array(o);try{e.mkdirTree(a)}catch(c){r.t.log(c)}e.stat(a);const l=e.open(n,"w+");return e.write(l,s,0,s.length,0),e.close(l),n})(e,s,n[i])}))),a},F=async(e,t,i,r)=>{const n=await O(e,i,r);return t===P.fonts?n.find((e=>{const t=e.toLowerCase();return t.endsWith(".ttf")||t.endsWith(".otf")})):i};var N;!function(e){e[e.Loki=0]="Loki",e[e.Local=1]="Local",e[e.Static=2]="Static"}(N||(N={}));const D={entriesChanged:"entriesChanged"};class U extends u.Z{constructor(){return super(),this.resource=new Map,this.lokiResourceIdList=[],this.docResourceList=[],this._entryMap=new Map,this._option={dirty:!0,list:[]},this._storage={dirty:!0,list:[]},this.addEntries=e=>{e.forEach((e=>{const t=this._entryMap.get(e.key);if(e.type===N.Loki)this._option.dirty=!0,this.lokiResourceIdList.push(e.resourceId);else if(e.type===N.Local&&(null==t?void 0:t.type)===N.Loki)return;this._entryMap.set(e.key,e)})),this.emit(D.entriesChanged)},this.setDocResourceList=e=>{this.docResourceList=e,this._storage.dirty=!0,this.emit(D.entriesChanged)},this.getEntry=e=>this._entryMap.get(e),this.updateLocalResource=async({resourceId:e,filename:t,buffer:i})=>{if(this.resource.get(e))return;const n=await(async(e,t,i)=>{const{wasm:n}=ue.getInstance();try{await n.init();const r=`textTemplate/${t}`;return await F(n.fs,P.fonts,r,{[i]:e})}catch(a){r.t.log("setFsError==",a)}})(i,e,t);n&&this.resource.set(e,{fsPath:n})},U._instance||(U._instance=this),U._instance}get entries(){return Array.from(this._entryMap.values())}get optionList(){if(!this._option.dirty)return this._option.list;const e=this.lokiResourceIdList.reduce(((e,t)=>{const i=this._entryMap.get(t);return i?[...e,i]:e}),[]);return this._option.dirty=!1,this._option.list=e,e}get storageList(){if(!this._storage.dirty)return this._storage.list;const e=this.docResourceList.reduce(((e,t)=>{const i=this._entryMap.get(t);return i?[...e,i]:e}),[]);return this._storage.dirty=!1,this._storage.list=e,e}}const B=new U;class G{constructor(){this.initDependency=({id:e,resourceId:t,from:i,type:r})=>{let n,a,o;if(n=ue.getDependency(t))return n;const s=new Promise(((e,i)=>{a=()=>{n=ue.getDependency(t),n&&(n.isPreview=!1),e(n)},o=i})),l={id:e,resourceId:t,type:r,isPreview:!0,ready:s,_resolve:a,_reject:o,from:i};return ue.setDependency(t,l),l},this.cacheFont=async({id:e,resourceId:t,filename:i,buffer:r,type:n})=>{var a,o;await B.updateLocalResource({resourceId:t,filename:i,buffer:r});let s=ue.getDependency(t);if(s||(s=this.initDependency({id:e,resourceId:t,type:n})),!s.content){const e=URL.createObjectURL(new Blob([r],{type:"application/font-sfnt"}));Object.assign(s,{content:e,buffer:r})}null===(a=(o=s)._resolve)||void 0===a||a.call(o)}}static getInstance(){return G._instance||(G._instance=new G),G._instance}fetchData(e,t){return this.initDependency({id:e.id,resourceId:e.resourceId,from:e.from,type:e.type}),new Promise((i=>{ue.getInstance().push(e,(async t=>{if("boolean"!=typeof t){var r;const{filename:i,data:n}=null===(r=t[0])||void 0===r?void 0:r.buffer;i&&n&&await this.cacheFont({id:e.id,resourceId:e.resourceId,filename:i,buffer:n,type:e.type})}const n=ue.getDependency(e.id);i(n)}),t)}))}}class j{constructor(){this.initDependency=({id:e,resourceId:t,previewUrl:i,transcode:r})=>{if(ue.getDependency(t))return;let n,a;const o=new Promise(((e,i)=>{n=i=>{const r=ue.getDependency(t);r&&(r.content=i.content,r.isPreview=!1,r.previewUrl=void 0),e(i||r)},a=i})),s={id:e,resourceId:t,type:g.xP.EverCloud,isPreview:!0,previewUrl:i,ready:o,transcode:r,_resolve:n,_reject:a};return ue.setDependency(t,s),s}}static getInstance(){return j._instance||(j._instance=new j),j._instance}fetchData(e){const{id:t,previewUrl:i="",transcode:r}=e;return this.initDependency({id:t,resourceId:e.fileUrl.md5,previewUrl:i,transcode:r}),new Promise((i=>{ue.getInstance().push(e,(n=>{if(!0===n)return void i(ue.getDependency(e.fileUrl.md5));const a={id:t,resourceId:e.resourceId,type:g.xP.EverCloud,content:this.parser(n),transcode:r,extraInfo:{imageUrl:e.fileUrl.url}},o=ue.getDependency(e.fileUrl.md5);var s;o&&(null===(s=o._resolve)||void 0===s||s.call(o,a));i(a)}))}))}parser(e){return e.map((e=>{const t=new Blob([e.buffer]);return URL.createObjectURL(t)}))[0]}}var H=i(24191);class W{static getInstance(){return W._instance||(W._instance=new W),W._instance}async load(e){var t;const{id:i,resourceId:n,type:a,fileUrl:o}=e;let{content:s}=e;const{extra:l,imageFiles:c}=e,d=this.fetchData({id:i,resourceId:n,type:a,fileUrl:o});if(!s||this.isNeedExtra(s)&&(null==l||null===(t=l.image_list)||void 0===t||!t.length)){await d;const e=ue.getDependency(i);s=null==e?void 0:e.content}let u;try{var h,p;u=JSON.parse(null!==(h=s)&&void 0!==h?h:""),this.isNeedExtra(null!==(p=s)&&void 0!==p?p:"")&&await this.replaceOriginImageSrc(u,l,c)}catch(f){return void r.t.error(`[frame-loader-plugin]JSON ${s} is invalid, ${null==f?void 0:f.message}`)}return u}fetchData(e){return new Promise((t=>ue.getInstance().push(e,(async i=>{if(!0===i)return void t(ue.getDependency(e.id));const{buffer:r}=i[0],n=b(r["content.json"]),a=b(r["extra.json"]),o=await this.parser(e,n,a);ue.setDependency(e.id,o),t(o)}))))}async parser(e,t,i){t.paths.some((e=>Boolean(e.fill.origin_image)))&&await this.replaceOriginImageSrc(t,i);return{resourceId:e.resourceId,id:e.id,content:JSON.stringify(t),type:g.xP.SalesFrame}}async replaceOriginImageSrc(e,t,i){var r;if(null==t||null===(r=t.image_list)||void 0===r||!r.length)return;const n=t.image_list.reduce(((e,t)=>({...e,[t.src]:t.uri})),{});e.paths.forEach((e=>{if(!e.fill.origin_image)return;const{src:t}=e.fill.origin_image;t&&n[t]&&(e.fill.origin_image.src=n[t])}));const a={...n};if(Object.keys(n).forEach((e=>{const t=n[e],r=null==i?void 0:i.filter((e=>e.uri===t));if(null==r||!r.length)return;const o=r[0],s=o.imageUrlList.reduce(((e,t)=>({...e,[`${t.width}x${t.height}`]:{full_url:t.url,width:t.width,height:t.height}})),{});ue.setDependency(o.uri,{id:o.uri,resourceId:o.uri,fileUrl:{url:o.url,md5:o.md5},type:g.xP.ImageInTemplate,localImage:{uri:o.uri},transcode:s}),delete a[e]})),!Object.keys(a).length)return;(await H.RA.getTemplateFile(Object.values(n))).template_file_infos.forEach((e=>{ue.setDependency(e.uri,{id:e.uri,resourceId:e.uri,fileUrl:{url:e.full_url,md5:e.md5},type:g.xP.ImageInTemplate,localImage:{uri:e.uri},transcode:e.transcode})}))}isNeedExtra(e){return e.includes("origin_image")}}class z{static getInstance(){return z._instance||(z._instance=new z),z._instance}async load(e){var t;const{id:i,resourceId:r,type:n,fileUrl:a}=e;let{content:o}=e;const s=this.fetchData({id:i,resourceId:r,type:n,fileUrl:a});if(!o){await s;const e=ue.getDependency(i);o=null==e?void 0:e.content}return JSON.parse(null!==(t=o)&&void 0!==t?t:"")}fetchData(e){return new Promise((t=>ue.getInstance().push(e,(i=>{if(!0===i)return void t(ue.getDependency(e.id));const{buffer:r}=i[0],n=b(r["content.json"]),a={resourceId:e.resourceId,id:e.id,content:JSON.stringify(n),type:g.xP.SalesGrid};ue.setDependency(e.id,a),t(a)}))))}}var V=i(18398),$=i.n(V),Y=i(50528),X=i(37722);class J extends X.C{constructor(e){super(),this.eventName="graphic_editor_effect_status",this.wasmFetchError=0,this.wasmLoadError=0,this.wasmFetchError=e.wasmFetchError,this.wasmLoadError=e.wasmLoadError}getEventParams(){var e,t;return{wasmFetchError:null!==(e=this.wasmFetchError)&&void 0!==e?e:0,wasmLoadError:null!==(t=this.wasmLoadError)&&void 0!==t?t:0}}}const K={name:C.effectWasmInit},q={name:C.effectAwaitLoader},Z={name:C.effectAnalyzeWasm};let Q=null;var ee=i(75924),te=i(14415),ie=i(15516);const re={pkg:"/res/filter",model:"/res/model"},ne=/(\w+)_v\d+.\d+(?:(?:\.model)+|(?:_model)+|(?:.dat+)+)/;class ae{constructor(){return this.pkgManager=new Map,this.modelManager=new Map,this._arithmetics={promise:null,data:new Map,retry:!1},this.initDependency=({id:e,resourceId:t,type:i})=>{let r,n,a;if(r=ue.getDependency(t))return r;const o={id:e,resourceId:t,type:i,ready:new Promise(((e,t)=>{n=e,a=t})),isPreview:!0,_resolve:n,_reject:a};return ue.setDependency(t,o),o},this._parseColorFilter=(e,t)=>{const i=b(e[`${t.path}config.json`]),{tag:r,content:n}=i;return{...t,tag:r,filters:Object.keys(n).map((i=>{const{}=n[i],r=new Blob([e[`${t.path}${i}/${i}.png`]]),a=URL.createObjectURL(r);return(0,te.p)(a),{key:i,texture:a}}))}},this._extractRequirements=(e,t)=>{const i=[];null!=t&&t.requirement&&i.push(t.requirement),Object.keys(e).forEach((t=>{if(/\/content.json$/.test(t)){const r=b(e[t]);null!=r&&r.requirement&&i.push(r.requirement)}if(/^algorithmConfig.json$/.test(t)){var r;const n=b(e[t]);if(null==n||null===(r=n.nodes)||void 0===r||!r.length)return;n.nodes.forEach((e=>{i.push({[e.type]:!0})}))}}));const r={};return i.forEach((e=>{Object.keys(e).forEach((t=>{e[t]&&(r[t]=e[t])}))})),r},ae._instance?ae._instance:(ae._instance=this,this)}fetchData(e){const{resourceId:t,type:i}=e;return this.initDependency({id:e.id,resourceId:t,type:i}),new Promise(((i,r)=>{ue.getInstance().push(e,(async n=>{if("boolean"!=typeof n&&n[0])try{await this.parseEffectPkg(e,n[0])}catch(o){r(o)}const a=ue.getDependency(t);i(a)}))}))}async parseEffectPkg(e,t){var i;const{buffer:r}=t,n=b(r["config.json"]),a=b(r["extra.json"]),o=[],s=[],l=[];var c;null!=n&&null!==(i=n.effect)&&void 0!==i&&null!==(i=i.Link)&&void 0!==i&&i.length&&(null==n||null===(c=n.effect)||void 0===c||c.Link.forEach((e=>{e.path&&o.push(e.path),"Filter"===e.type&&(l.push({key:ie.$3,defaultValue:1}),s.push(this._parseColorFilter(r,e)))})));null!=a&&a.settings&&Object.keys(a.settings).forEach((e=>{l.push({key:e,defaultValue:a.settings[e]})}));const d=this._extractRequirements(r,n),u=await this._extractModelNames({buffer:r,config:n,requirements:d}),h={id:e.id,resourceId:e.resourceId,fsPath:`${re.pkg}/${e.resourceId}`,requirements:d,modelNames:Array.from(u),attributes:l,features:s};this.pkgManager.set(e.resourceId,h),await Promise.all([this._saveToFs({prefix:h.fsPath,data:r}),h.modelNames.length&&this.fetchEffectModel(h.modelNames)]);const p=ue.getDependency(e.resourceId);var f;p&&(p.isPreview=!1,null===(f=p._resolve)||void 0===f||f.call(p))}fetchArithmetics(){return this._arithmetics.promise&&!this._arithmetics.retry||(this._arithmetics.promise=new Promise((async(e,t)=>{try{const t=await H.RA.getEffectModelArithmetics();Object.values(t).flat().forEach((e=>{this._arithmetics.data.set(e.name,e)})),e()}catch(i){this._arithmetics.retry=!0,t()}}))),this._arithmetics.promise}async fetchEffectModel(e){const t=new Set;e.forEach((e=>{ue.getDependency(e)||t.add(e)})),t.size&&(await this.fetchArithmetics(),await Promise.all(Array.from(t).map((e=>{const t=this._arithmetics.data.get(e);if(!t)return;const i=ue.getDependency(e);return i?i.ready:this.fetchModelResource({id:e,resourceId:e,fileUrl:{md5:t.file_url.uri,url:t.file_url.zip_url_list[0]}})}))))}fetchModelResource(e){const{resourceId:t}=e;return this.initDependency({id:e.id,resourceId:t,type:g.xP.EffectModel}),new Promise((i=>{ue.getInstance().push({...e,type:g.xP.EffectModel},(async r=>{"boolean"!=typeof r&&r[0]&&await this.parseEffectModel(e,r[0]);const n=ue.getDependency(t);i(n)}))}))}async parseEffectModel(e,t){const{id:i}=e,r=this.modelManager.get(i);if(!r)return;const{filename:n}=r,a=Object.values(t.buffer)[0],o=r.prefix?[re.model,r.prefix].filter((e=>e)).join("/"):"";Object.assign(r,{modelFsPath:`${re.model}/${i}`,requirementFsPath:o?`${o}/${n}`:""}),await Promise.all([this._saveToFs({prefix:re.model,data:{[i]:a}}),o&&n&&this._saveToFs({prefix:o,data:{[n]:a}})]);const s=ue.getDependency(e.resourceId);var l;s&&(s.isPreview=!1,null===(l=s._resolve)||void 0===l||l.call(s))}fetchBackGroundConfig(e){return new Promise((t=>{ue.getInstance().push(e,(e=>{if("boolean"!=typeof e&&e[0]){const{buffer:i}=e[0],r=b(i["config.json"]);t(r)}}))}))}async getModelNamesByRequirements(e){const t=new Set;if(!e.length)return t;try{await ue.getInstance().wasm.init()}catch(o){throw r.t.error("getModelNamesByRequirements error",o),o}let i;try{var n;const{VectorString:r}=ue.getInstance().wasm;if(!r)return t;const a=new r;e.forEach((e=>{a.push_back(e)})),i=await(null===(n=ue.getInstance().wasm.effectInstance)||void 0===n?void 0:n.peekResourcesByRequirements(a))}catch(o){throw r.t.error("peekResourcesByRequirements error",{error:o,vector:e}),o}const a=JSON.parse(`${i}`);return null==a||a.forEach((e=>{var i;const r=e.split("/").slice(-2);if(2!==r.length)return;const[n,a]=r,o=ne.exec(a);if(!o||o.length<2)return;const s=o[1],l=null!==(i=this.modelManager.get(s))&&void 0!==i?i:{id:s};Object.assign(l,{filename:a,prefix:n}),this.modelManager.set(s,l),t.add(s)})),t}async _extractModelNames({buffer:e,config:t,requirements:i}){var r,n;const a=new Set,o=new Set,s=e=>{e&&Object.keys(e).forEach((t=>{const i=e[t];null==i||i.forEach((e=>null==o?void 0:o.add(e)))}))};s(null==t||null===(r=t.effect)||void 0===r?void 0:r.model_names),s(null===(n=b(e["algorithmConfig.json"]))||void 0===n?void 0:n.model_names),Array.from(o).forEach((e=>{this.modelManager.has(e)||this.modelManager.set(e,{id:e}),a.add(e)}));const l=Object.keys(i).reduce(((e,t)=>i[t]?[...e,t]:e),[]);return(await this.getModelNamesByRequirements(l)).forEach((e=>{a.add(e)})),a}async _saveToFs(e){const{wasm:t}=ue.getInstance();try{await t.init();const{prefix:i,data:r}=e;await F(t.fs,P.fonts,i,r)}catch(i){r.t.log("setFsError==",i)}}}class oe{constructor(){this.initDependency=({id:e,name:t,resourceId:i,previewUrl:r,resource:n,orderInfo:a})=>{if(ue.getDependency(i))return;let o,s;const l=new Promise(((e,t)=>{o=t=>{const r=ue.getDependency(i);r&&(r.content=t.content,r.isPreview=!1,r.previewUrl=void 0),t.resource=n,e(t||r)},s=t})),c={id:e,name:t,resourceId:i,type:g.xP.YkImage,isPreview:!0,previewUrl:r,resource:n,ready:l,_resolve:o,_reject:s,orderInfo:a};return ue.setDependency(i,c),c}}static getInstance(){return oe._instance||(oe._instance=new oe),oe._instance}fetchData(e){const{id:t,name:i,resourceId:r,previewUrl:n,resource:a,fileUrl:o,orderInfo:s}=e;this.initDependency({id:t,name:i,resourceId:r,previewUrl:n,resource:a,orderInfo:s}),a===g.UI.TuChong&&s?this._getAdobeHDUrl([s]).then((e=>{const t=null==e?void 0:e[r];this._loadImage(null!=t?t:o.url,r)})):this._loadImage(o.url,r)}batchFetchData(e){const t=[],i=[];e.forEach((e=>{const{id:r,name:n,resourceId:a,previewUrl:o,resource:s,fileUrl:l,orderInfo:c}=e;this.initDependency({id:r,name:n,resourceId:a,previewUrl:o,resource:s,orderInfo:c}),s===g.UI.TuChong&&c?(i.push(e),t.push(c)):this._loadImage(l.url,a)})),0!==t.length&&this._getAdobeHDUrl(t).then((e=>{i.forEach((({resourceId:t,fileUrl:i})=>{const r=null==e?void 0:e[t];this._loadImage(null!=r?r:i.url,t)}))}))}async _loadImage(e,t){await(0,te.p)(e);const i=ue.getDependency(t);var r;i&&(null===(r=i._resolve)||void 0===r||r.call(i,{content:e}))}async _getAdobeHDUrl(e){const t=e.map((e=>({...e,effect_type:H.Mn.EffectTypeImage})));try{const{origin_resource:e}=await H.RA.order({items:t,scene:H.cJ.TrackEditor});return e}catch(i){return}}}class se{constructor(){this._cachedFsPath={},this.initDependency=({id:e,resourceId:t,from:i})=>{let r,n,a;if(r=ue.getDependency(t))return r;const o=new Promise(((e,i)=>{n=()=>{r=ue.getDependency(t),r&&(r.isPreview=!1),e(r)},a=i})),s={id:e,resourceId:t,type:g.xP.SalesTextGlow,isPreview:!0,ready:o,_resolve:n,_reject:a,from:i};return ue.setDependency(t,s),s},this.cacheGlow=async({id:e,resourceId:t,data:i})=>{var n,a;const{wasm:o}=ue.getInstance();try{await o.init();const e=(e=>e?`textGlow/${e}`:"")(t);this._cachedFsPath[t]=await F(o.fs,P.default,e,i)}catch(l){r.t.log("setFsError==",l)}let s=ue.getDependency(t);s||(s=this.initDependency({id:e,resourceId:t})),null===(n=(a=s)._resolve)||void 0===n||n.call(a)}}static getInstance(){return se._instance||(se._instance=new se),se._instance}getCachedFsPath(e){return this._cachedFsPath[e]||""}fetchData(e){return this.initDependency({id:e.id,resourceId:e.resourceId,from:e.from}),new Promise((t=>{ue.getInstance().push(e,(async i=>{if("boolean"!=typeof i){var r;const t=null===(r=i[0])||void 0===r?void 0:r.buffer;t&&await this.cacheGlow({id:e.id,resourceId:e.resourceId,data:t})}const n=ue.getDependency(e.id);t(n)}))}))}}class le{static getInstance(){return le._instance||(le._instance=new le),le._instance}fetchData(e){return new Promise((t=>{ue.getInstance().push(e,(i=>{!0===i&&t(ue.getDependency(e.resourceId));const r=this.parser(i,e.resourceId,e.id,e.type);ue.setDependency(e.resourceId,r),t(r)}))}))}parser(e,t,i,r){return{id:i,resourceId:t,contentJSON:e.map((e=>new TextDecoder("utf-8").decode(e.buffer)))[0],type:r}}}var ce;!function(e){e.PREFETCH="prefetch",e.USER_USE="userUse"}(ce||(ce={}));const de=new class{constructor(){this._promise=null,this.init()}isReady(){return this.effectInstance&&this.fs}init(){return!(!this.effectInstance||!this.fs)||(this._promise||(this._promise=new Promise((async e=>{const t=await(async()=>{if(Q)return Q;try{var e,t,n,a,o,s;const l=performance.now();Y.X.getInstance().markStageStart(q,q.name),Y.X.getInstance().markStageStart(K,K.name);const{loader:c}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,82362));return Y.X.getInstance().markStageEnd(q,q.name),Y.X.getInstance().markStageStart(Z,Z.name),Q=await c({wasm:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/wasm/effect_c_1700554136027.wasm",js:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/wasm/effect_c_1700554136027.js",worker:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies.lvve-os.graphic/wasm/effect_c_1700554136027.worker.js",cache:{name:"wasm-cache"},logger:r.t,pWasmResult:null===(e=window)||void 0===e||null===(e=e.pWasm)||void 0===e?void 0:e.pWasmResult,instantiateStreaming:!0}),new J({wasmFetchError:null!==(t=null===(n=window)||void 0===n||null===(n=n.ccwebEffectPerf)||void 0===n?void 0:n.wasmFetchError)&&void 0!==t?t:0,wasmLoadError:null!==(a=null===(o=window)||void 0===o||null===(o=o.ccwebEffectPerf)||void 0===o?void 0:o.wasmLoadError)&&void 0!==a?a:0}).report(),null===(s=window.pWasm)||void 0===s||null===(s=s.worker)||void 0===s||s.terminate(),window.pWasm=null,Y.X.getInstance().markStageEnd(Z,Z.name),Y.X.getInstance().markStageEnd(K,K.name),r.t.info(`[effectsdk]-[wasm] \u521d\u59cb\u5316\u8017\u65f6: ${performance.now()-l}ms`),Q}catch(h){var l,c,d,u;return new J({wasmFetchError:null!==(l=null===(c=window)||void 0===c||null===(c=c.ccwebEffectPerf)||void 0===c?void 0:c.wasmFetchError)&&void 0!==l?l:0,wasmLoadError:null!==(d=null===(u=window)||void 0===u||null===(u=u.ccwebEffectPerf)||void 0===u?void 0:u.wasmLoadError)&&void 0!==d?d:0}).report(),r.t.error("[worker][effect][loadmodule][error]",h),null}})();this.effectInstance=new t.EffectWasmBind,this.VectorString=t.VectorString,this.fs=t.FS,e(!0)}))),this._promise)}};class ue{constructor(){this.dependencyMap=new Map,this.wasm=de,this._downloadManager=new v,this._event=new u.Z,this.initMaterialParser()}get event(){return this._event}static getInstance(){return ue._instance||(ue._instance=new ue,ue.getInstance().initFallBackFont()),ue._instance}static getDependency(e){const t=ue.getInstance().dependencyMap.get(e);return null!=t&&t.isPreview||(null==t?void 0:t.from)!==ce.PREFETCH||(t.from=ce.USER_USE,ue.getInstance().dependencyMap.set(e,t)),t}static setDependency(e,t){ue.getInstance().dependencyMap.set(e,t)}static removePreviewUrl(e){const t=ue.getInstance().dependencyMap.get(e);null!=t&&t.previewUrl&&(t.previewUrl=void 0),null!=t&&t.isPreview&&(t.isPreview=void 0)}static getAllDependency(){const e=[];return ue.getInstance().dependencyMap.forEach((t=>{[g.xP.EverCloud,g.xP.ImageInTemplate,g.xP.SalesTextTemplate].includes(t.type)||t.from!==ce.PREFETCH&&(t.type!==g.xP.SvgSticker?e.push({id:t.resourceId,panel:t.type,source:t.resource}):e.push({id:t.resourceId,panel:g.xP.SalesSticker,source:t.resource}))})),e}static getAllFileInfo(){return Array.from(ue.getInstance().dependencyMap.values()).reduce(((e,t)=>{if(t.type===g.xP.ImageInTemplate){const{uri:i}=t.localImage;return e.concat({uri:i})}return e}),[])}initMaterialParser(){this.parser={image:new R,svg:new k,shape:new A,text:new G,everCloud:new j,frame:new W,grid:new z,filter:new ae,ykImage:new oe,textGlow:new se,textPreset:new le}}async initFallBackFont(){await Promise.all(c.map((e=>{this.parser.text.fetchData({id:e.resourceId,resourceId:e.resourceId,type:g.xP.SalesFont,fileUrl:{url:e.fileUrl.url,md5:e.fileUrl.md5},from:ce.PREFETCH})})))}initResourceFromServer(e,t){var i,r;t.effects=t.effects.map((e=>"string"==typeof e?$().parse(e):e));const n=null!==(i=null===(r=t.images)||void 0===r?void 0:r.map((e=>JSON.parse(e))))&&void 0!==i?i:[];this.initResourceLocalImageFromDb(t),this.initResourceEverCloudImageFromServer(e),this.initResourceEffectModel(t.effects),this.initResourceEffectFromDb(t.effects),this.initResourceYkImageFromServer(n)}async initResourceFromEffectList(e){const t=new Map;e.forEach((e=>{var i;if(ue.getDependency(e.resourceId))return;const r=null!==(i=t.get(e.panel))&&void 0!==i?i:[];r.push(e.resourceId),t.set(e.panel,r);const n={id:e.effectId,resourceId:e.resourceId,type:e.type};let a;switch(e.type){case g.xP.SalesImageEffect:case g.xP.SalesFilter:a=this.parser.filter;break;case g.xP.SalesFont:case g.xP.CNFont:a=this.parser.text}a&&a.initDependency(n)}));const i=Array.from(t.entries()).map((([e,t])=>({type:e,ids:t})));if(!i.length)return;(await H.zL.getEffectsByResourceIds(i)).forEach((e=>{const t={id:e.effectId,resourceId:e.resourceId,fileUrl:{url:e.url,md5:e.md5}};switch(e.panel){case H.hm.SalesFont:this.parser.text.fetchData({...t,type:g.xP.SalesFont});break;case H.hm.SalesFilter:this.parser.filter.fetchData({...t,type:g.xP.SalesFilter});break;case H.hm.SalesImageEffect:this.parser.filter.fetchData({...t,type:g.xP.SalesImageEffect})}}))}initResourceEverCloudImageFromServer(e){for(const t of e)ue.getInstance().parser.everCloud.fetchData({id:t.md5,resourceId:t.assetId,fileUrl:{url:t.originUrl,md5:t.md5},type:g.xP.EverCloud,aesKey:t.aesKey,transcode:t.transcode})}initResourceLocalImageFromDb(e){for(let t=0;t<e.template_file_infos.length;t++){const i=e.template_file_infos[t];ue.getInstance().parser.image.effectManager.set(i.uri,{stickerImage:{url:i.full_url,uri:i.uri,md5:i.md5}}),ue.setDependency(i.uri,{type:g.xP.ImageInTemplate,resourceId:i.uri,localImage:{path:i.path,uri:i.uri,url:i.full_url},transcode:i.transcode,id:i.uri})}}initResourceEffectFromDb(e){e.forEach((e=>{var t;const i=e.Source===g.UI.HeyPan?{name:(n=e).Name,md5:n.FileUrl.Uri,url:n.FileUrl.UrlList[0],resourceId:n.ResourceId.toString(),panel:null!==(a=(0,E.j)(n.EffectType))&&void 0!==a?a:"",effectId:n.EffectId.toString()}:(0,H.vz)(e);var n,a;const{md5:o,url:s,resourceId:l,name:c,effectId:d,panel:u}=i;if(e.Panel=e.Source===g.UI.HeyPan?u:e.Panel,[g.xP.SalesFont,g.xP.Fonts,"sales-font",g.xP.CNFont,g.xP.CNSalesTextTemplate].includes(e.Panel))return this.parser.text.fetchData({name:c,id:d,resourceId:l,type:e.Panel,fileUrl:{url:s,md5:o}}),void B.addEntries([{type:N.Local,id:d,resourceId:l,key:l,name:c}]);switch(e.Panel){case g.xP.Svg:this.parser.shape.fetchData({name:c,id:l,resourceId:l,type:g.xP.Svg,fileUrl:{url:s,md5:o}});break;case g.xP.SalesSticker:case g.xP.CNSalesSticker:"svg_sticker"===(null===(t=i.sdkExtra)||void 0===t?void 0:t.type)?this.parser.svg.fetchData({name:c,id:l,resourceId:l,type:g.xP.SvgSticker,fileUrl:{url:s,md5:o},content:i.content,sdkExtra:i.sdkExtra,previewUrl:i.previewUrl}):this.parser.image.fetchData({name:c,id:l,resourceId:l,resource:e.Source,type:e.Panel,fileUrl:{url:s,md5:o},extraInfo:i});break;case g.xP.SalesFrame:this.parser.frame.load({id:d,resourceId:l,type:g.xP.SalesFrame,fileUrl:{url:s,md5:o},content:i.contentJSON,extra:i.sdkExtra,imageFiles:i.imageFiles});break;case g.xP.SalesGrid:this.parser.grid.load({id:d,resourceId:l,type:g.xP.SalesGrid,fileUrl:{url:s,md5:o},content:i.contentJSON});break;case g.xP.SalesFilter:case g.xP.SalesImageEffect:this.parser.filter.fetchData({name:c,id:d,resourceId:l,type:e.Panel,fileUrl:{url:s,md5:o}});break;case g.xP.EffectModel:break;case g.xP.SalesTextGlow:this.parser.textGlow.fetchData({name:c,id:l,resourceId:l,resource:e.Source,type:g.xP.SalesTextGlow,fileUrl:{url:s,md5:o}});break;default:r.t.error("\u4e0d\u652f\u6301\u7684 item panel:",e.Panel)}}))}async initResourceEffectModel(e){const t=new Set,i=new Set;if(e.forEach((e=>{var r,n;e.Panel&&[g.xP.SalesFilter,g.xP.SalesImageEffect].includes(e.Panel)&&(null===(r=e.Requirements)||void 0===r||r.forEach((e=>e&&t.add(e))),null===(n=e.ModelNames)||void 0===n||n.split(",").forEach((e=>e&&i.add(e))))})),t.size){(await this.parser.filter.getModelNamesByRequirements(Array.from(t))).forEach((e=>e&&i.add(e)))}i.size&&await this.parser.filter.fetchEffectModel(Array.from(i))}initResourceYkImageFromServer(e){const t=e.map((e=>{const{resourceId:t,cardUrl:i,previewUrl:r,orderInfo:n,source:a}=(0,ee.tv)(e);return{id:t,resourceId:t,type:g.xP.YkImage,fileUrl:{md5:"",url:null!=r?r:i},previewUrl:i,orderInfo:n,resource:a===g.iJ.TuChong?g.UI.TuChong:g.UI.HeyPan}}));ue.getInstance().parser.ykImage.batchFetchData(t)}processShape(e){return new TextDecoder("utf-8").decode(e).toString()}processSticker(e){const t=new Blob([e]);return URL.createObjectURL(t)}push(e,t,i){const r=this.dependencyMap.get(e.resourceId.toString());!r||r.isPreview?this._downloadManager.downloadToBuffer(e,(e=>{t(e)}),i):t(!0)}}const he=m},27191:(e,t,i)=>{"use strict";i.d(t,{n:()=>r});const r="1.4.2"},39113:(e,t,i)=>{"use strict";i.d(t,{default:()=>o});var r,n=i(8757);const a=100;class o{}(r=o).tool={model:{contrast:e=>e/a,brightness:e=>e/a,saturation:e=>e/a,exposure:e=>e/a,highlight:e=>e/a,shadow:e=>e/a,temperature:e=>e/a,tone:e=>e/a,vibrance:e=>e/a,lightSensation:e=>e/a,fade:e=>e/a,oilTexture:e=>e/a,grain:e=>e/a,shadowAngle:e=>e},render:{contrast:e=>e/a,brightness:e=>e/a,saturation:e=>e/a,exposure:e=>e/a,highlight:e=>e/a,shadow:e=>e/a,temperature:e=>e/a,tone:e=>e/a,vibrance:e=>e/a,lightSensation:e=>e/a,fade:e=>e/a,oilTexture:e=>e/a,grain:e=>e/a}},r.render={tool:{contrast:e=>e*a,brightness:e=>e*a,saturation:e=>e*a,exposure:e=>e*a,highlight:e=>e*a,shadow:e=>e*a,temperature:e=>e*a,tone:e=>e*a,vibrance:e=>e*a,lightSensation:e=>e*a,fade:e=>e*a,oilTexture:e=>e*a,grain:e=>e*a}},r.model={render:{contrast:e=>e*a,brightness:e=>e,saturation:e=>e,exposure:e=>e,highlight:e=>e,shadow:e=>e,temperature:e=>e,tone:e=>e,vibrance:e=>e,lightSensation:e=>e,fade:e=>e,oilTexture:e=>e,grain:e=>e},tool:{contrast:e=>e*a,brightness:e=>e*a,saturation:e=>e*a,exposure:e=>e*a,highlight:e=>e*a,shadow:e=>e*a,temperature:e=>e*a,tone:e=>e*a,vibrance:e=>e*a,lightSensation:e=>e*a,fade:e=>e*a,oilTexture:e=>e*a,grain:e=>e*a,shadowAngle:e=>e},hypic:{contrast:e=>(e+1)/2,brightness:e=>(e+1)/2,saturation:e=>(e+1)/2,exposure:e=>(e+1)/2,highlight:e=>(e+1)/2,temperature:e=>(e+1)/2,tone:e=>(e+1)/2,vibrance:e=>(e+1)/2,lightSensation:e=>(e+1)/2,fade:e=>e,oilTexture:e=>e,grain:e=>e,shadow:e=>({color:e.color.slice(0,3).map((e=>e/255)),opacity:e.color[3],blurIntensity:e.blur,scale:e.size,distance:e.distance,angle:e.angle}),getPostProcessParams:e=>{switch(e.type){case n.zI.SHADOW:return r.model.hypic.shadow(e);case n.zI.OUTLINE:return r.model.effect.outline(e);case n.zI.GLOW:return r.model.effect.glow(e);case n.zI.FEATHER:return r.model.effect.feather(e)}}},effect:{shadow:e=>({color:e.color.slice(0,3).map((e=>e/255)),opacity:e.color[3],blurIntensity:e.blur||1e-4,scale:e.size,distance:e.distance,angle:e.angle<0?360+e.angle:e.angle}),outline:e=>({color:e.color.slice(0,3).map((e=>e/255)),opacity:e.color[3],intensity:e.size}),glow:e=>({color:e.color.slice(0,3).map((e=>e/255)),opacity:e.color[3],glowIntensity:e.size,blurIntensity:e.blur}),feather:e=>({intensity:e.size}),getPostProcessParams:e=>{switch(e.type){case n.zI.SHADOW:return r.model.effect.shadow(e);case n.zI.OUTLINE:return r.model.effect.outline(e);case n.zI.GLOW:return r.model.effect.glow(e);case n.zI.FEATHER:return r.model.effect.feather(e)}}}},r.hypic={model:{contrast:e=>2*e-1,brightness:e=>2*e-1,saturation:e=>2*e-1,exposure:e=>2*e-1,highlight:e=>2*e-1,temperature:e=>2*e-1,tone:e=>2*e-1,vibrance:e=>2*e-1,lightSensation:e=>2*e-1,fade:e=>e,oilTexture:e=>e,grain:e=>e}}},57123:(e,t,i)=>{"use strict";i.d(t,{EY:()=>c,cE:()=>d,sY:()=>h,w3:()=>u});var r=i(43825),n=i(24657),a=i(91372);const o=(e=r.Kt)=>300*e/72,s=e=>e*Math.PI/180,l=(e,t)=>{const i=s(e);return[t*Math.cos(i),t*Math.sin(i)]},c={effect:{shadowOffset:e=>{var t,i,n,a,o;return null!==(t=e.shadow)&&void 0!==t&&t.enable?l(null!==(i=null===(n=e.shadow)||void 0===n?void 0:n.angle)&&void 0!==i?i:-r.du,null!==(a=null===(o=e.shadow)||void 0===o?void 0:o.distance)&&void 0!==a?a:r.pn/100):[0,0]},curveAngle:(e=0)=>360*e,solidColor:e=>{var t;const[i,r,n]=e.map((e=>e/255));return{render_type:"solid",solid:{color:[i,r,n],alpha:null!==(t=e[3])&&void 0!==t?t:1}}}},render:{pt2px:(e=0)=>o(e),fontSize:(e=r.Kt)=>o(e),letterSpacing:(e=r.Kt,t=0)=>o(e)*t,lineHeight:(e=0)=>e+1,innerPadding:(e=r.Kt,t=0)=>o(e)*t,shadowOffset:(e=r.Kt,t)=>{const{angle:i=-r.du,distance:n=r.pn/100}=null!=t?t:{},a=o(e),[s,c]=l(-i,n);return{x:a*s,y:a*c}},align:e=>void 0===e.align||void 0===n.Z[e.align]||1===e.orientation?n.Z.center:e.align},tool:{outlineWidth:(e=0)=>500*e,letterSpacing:(e=0)=>20*e,lineHeight:(e=0)=>20*e,backgroundCornerRadiusScale:(e=0)=>100*e,opacity:(e=1)=>100*e,shadowDistance:(e=0)=>100*e,glowIntensity:(e=0)=>100*e,glowRange:(e=0)=>100*e,curveAngle:(e=0)=>100*e}},d={layer:{shadowDistance:e=>{const{shadowOffset:t="0.1,-0.1",shadowAngle:i=-r.du}=e,[n,a]=t.split(",").map((e=>Number(e))),o=s(i),l=Math.cos(o),c=Math.sin(o);return l?n/l:Math.abs(a)/c},curveAngle:(e=0)=>e/360},tool:{shadowBlur:e=>100*e,outlineWidth:e=>500*e,opacity:(e=1)=>100*e,color:e=>{let t=null;if(!e)return t;if("gradient"===e.render_type){const i=e.gradient;t={linearGradient:{type:"linear",stops:i.color.map(((e,t)=>{var r,n;return{color:new a.Il([...e,null!==(r=null===(n=i.alpha)||void 0===n?void 0:n[t])&&void 0!==r?r:1]).hex(),offset:i.percent[t]}})),rotation:i.angle+90}}}else{var i;const r=null!==(i=e.solid.alpha)&&void 0!==i?i:1,[n,o,s]=e.solid.color,l=new a.Il([n,o,s,r]);t=null==l?void 0:l.colorPick()}return t},shadow:e=>{var t;const i=d.tool.color(e.content);return{color:null!=i?i:null,opacity:d.tool.opacity(null!==(t=e.alpha)&&void 0!==t?t:1),blur:d.tool.shadowBlur(e.feather),distance:e.distance,angle:e.angle}},outline:e=>{var t;const i=d.tool.color(e.content);return{color:null!=i?i:null,opacity:d.tool.opacity(null!==(t=e.alpha)&&void 0!==t?t:1),width:d.tool.outlineWidth(e.width)}}}},u={layer:{outlineWidth:(e=0)=>e/500,lineSpacing:(e=0)=>e/20,letterSpacing:(e=0)=>e/20,backgroundCornerRadiusScale:(e=0)=>e/100,opacity:(e=100)=>e/100,glowIntensity:(e=0)=>e/100,glowRange:(e=0)=>e/100,curveAngle:(e=0)=>e/100},effect:{outlineWidth:(e=0)=>e/500,shadowBlur:e=>e/100,alpha:(e=100)=>e/100,parseColor:(e,t)=>{if(!e)return null;const{linearGradient:i}=e;if(i){var r;const e=i,t={gradient:{color:[],alpha:[],percent:[],angle:(null!==(r=e.rotation)&&void 0!==r?r:0)-90,mode:"all"},render_type:"gradient"};return e.stops.forEach((e=>{const{color:i,offset:r}=e,[n,o,s,l]=(0,a.Oo)(i);t.gradient.color.push([n/255,o/255,s/255]),t.gradient.alpha.push(l),t.gradient.percent.push(r)})),t}{const{r:t,g:i,b:r,a:n}=e.rgb;return{render_type:"solid",solid:{alpha:n,color:[t/255,i/255,r/255]}}}},color:(e,t)=>({fill:{alpha:1,content:u.effect.parseColor(e)}}),shadow:e=>{var t,i;const n=u.effect.parseColor(e.color,r.He);return{enable:!0,alpha:void 0===e.opacity?1:e.opacity/100,content:n,distance:null!==(t=e.distance)&&void 0!==t?t:r.pn,angle:null!==(i=e.angle)&&void 0!==i?i:-r.du,feather:void 0===e.blur?r.cW:u.effect.shadowBlur(e.blur)}},outline:e=>{var t;const i=u.effect.parseColor(e.color,r.t9);return{enable:!0,alpha:void 0===e.opacity?1:e.opacity/100,content:i,width:u.effect.outlineWidth(null!==(t=e.width)&&void 0!==t?t:500*r.q2)}}}},h={tool:{px2pt:(e=0)=>72*e/300}}},89811:(e,t,i)=>{"use strict";var r;i.d(t,{R8:()=>_,xW:()=>m,vd:()=>y}),function(e){e.sticker="sticker",e.default="default",e.text="text",e.image="image",e.fonts="fonts",e.zip="zip"}(r||(r={}));var n=i(82440),a=i(57123),o=i(24657),s=i(43825),l=i(67986),c=i(8757);const d=e=>e.source===c.UI.HeyPan&&e.type===c.xP.Default;var u=i(81254);const h=a.cE.layer,p=a.EY.effect;class f{}class y extends f{static unmarshal(e){const t={type:c.F5.TEXT,fallbackFontResources:[],fontDependResources:[],text:""};if(!e)return null;if(void 0!==e.richText){const i=(0,u.a$)(e.richText);t.richText=i?JSON.stringify(i):void 0,t.text=null==i?void 0:i.text}if(t.letterSpacing=e.letterSpacing,t.lineMaxWidth=e.lineMaxWidth,t.lineSpacing=e.lineSpacing,t.innerPadding=e.innerPadding,t.align=e.typeSettingAlign,t.orientation=e.typeSettingKind,e.canvas){const i=e.canvasColor.slice(0,3),r={enable:!0,type:c.Wv.COLOR,color:[...i.map((e=>255*e)),e.canvasColor[3]],cornerRadius:0};if(e.canvasRoundCorner&&(r.cornerRadius=e.canvasRoundRadiusScale),e.canvasCustomized){const[t,i]=e.canvasWHCustomized;Object.assign(r,{width:t,height:i})}t.background=r}if(e.bloomPath&&e.bloomColor){const i={enable:!0,color:[...e.bloomColor.slice(0,3).map((e=>255*e)),e.bloomColor[3]],intensity:e.bloomStrength,range:e.bloomRange,resourceId:""};t.glow=i}var i,r;e.typeSettingPathEnable&&(t.curve={enable:!0,angle:h.curveAngle(null!==(i=null===(r=e.typeSettingPathParam)||void 0===r||null===(r=r.curvesInfo)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.curveAngle)&&void 0!==i?i:0)});return t}static marshal(e){var t,i,r;const a={globalAlpha:1,autoAdaptDpiEnabled:!1,canvasCustomized:!0,canvasOffsetCustomized:[0,0],canvasRoundCorner:!0,canvasSplitPadding:0,canvasSplitThreshold:1e3,canvasWHCustomized:[0,0],canvasWrapped:!1,fallbackFontPathList:[],oneLineCutOff:!1,selectedColor:[0,.792156862745098,.8784313725490196,.4],shapeFlipX:!1,shapeFlipY:!1,shapePath:"",version:"2"};if("lineMaxWidth"in e&&null!==(t=e.layout)&&void 0!==t&&t.width&&null!==(i=e.layout)&&void 0!==i&&i.scale)if(-1!==e.lineMaxWidth){var l,c;const t=e.layout.width,i=Math.max(null!==(l=null===(c=e.extra)||void 0===c||null===(c=c.textOuterRect)||void 0===c?void 0:c.width)&&void 0!==l?l:t,t);a.lineMaxWidth=t/i/e.layout.scale.x}else a.lineMaxWidth=e.lineMaxWidth;var d,h,f,y,g,m,_,v,I,T,w,E,x,b,R,k,A,P;(e.richText&&(a.richText=JSON.stringify((0,u.a$)(e.richText))),"letterSpacing"in e&&(a.letterSpacing=e.letterSpacing),"lineSpacing"in e&&(a.lineSpacing=e.lineSpacing),"innerPadding"in e&&(a.innerPadding=e.innerPadding),"orientation"in e&&(a.typeSettingKind=e.orientation),a.typeSettingAlign=null!==(r=e.align)&&void 0!==r?r:o.Z.center,a.decorationWidth=.04,a.decorationOffset=.15,a.boldValue=s.R0,a.italicDegree=s.uj,"background"in e)&&(a.canvasRoundRadiusScale=(null===(d=e.background)||void 0===d?void 0:d.cornerRadius)||0,a.canvasColor=(0,u.P5)(null!==(h=null===(f=e.background)||void 0===f?void 0:f.color)&&void 0!==h?h:[0,0,0,0]),a.canvas=Boolean((null===(y=e.background)||void 0===y?void 0:y.enable)&&!(null!==(g=e.curve)&&void 0!==g&&g.enable)));"glow"in e&&(a.bloomPath=null!==(m=e.glow)&&void 0!==m&&m.enable?n.fc.getInstance().parser.textGlow.getCachedFsPath(null===(_=e.glow)||void 0===_?void 0:_.resourceId):"",a.bloomColor=(0,u.P5)(null===(v=e.glow)||void 0===v?void 0:v.color),a.bloomRange=null!==(I=e.glow)&&void 0!==I&&I.enable?null!==(T=null===(w=e.glow)||void 0===w?void 0:w.range)&&void 0!==T?T:s.DI:0,a.bloomStrength=null!==(E=null===(x=e.glow)||void 0===x?void 0:x.intensity)&&void 0!==E?E:s.f$,a.bloomColorCustomized=!0,a.bloomDirX=0,a.bloomDirY=0,a.bloomBlurDegree=1);"curve"in e&&(a.typeSettingPathEnable=null!==(b=null===(R=e.curve)||void 0===R?void 0:R.enable)&&void 0!==b&&b,a.enableMergeLines=!0,null!==(k=e.curve)&&void 0!==k&&k.enable&&(a.typeSettingPathParam={curvesInfo:[{curveType:1,curveAngle:p.curveAngle(null!==(A=null===(P=e.curve)||void 0===P?void 0:P.angle)&&void 0!==A?A:0),offsetOnCurve:0,points:[]}]}));const M={type:"text",fallbackFontPathList:n.Kt.map((e=>{var t,i;return null!==(t=null===(i=n.fO.resource.get(e.resourceId))||void 0===i?void 0:i.fsPath)&&void 0!==t?t:""})).filter((e=>e)),text_params:a};if("layout"in e){var L,S,C,O,F,N,D,U,B;const t=null!==(L=null==e||null===(S=e.layout)||void 0===S||null===(S=S.scale)||void 0===S?void 0:S.x)&&void 0!==L?L:1,i=null!==(C=null==e||null===(O=e.layout)||void 0===O||null===(O=O.scale)||void 0===O?void 0:O.y)&&void 0!==C?C:1,{width:r=0,height:n=0}=null!==(F=e.layout)&&void 0!==F?F:{},a=Math.ceil(((null!==(N=null===(D=e.extra)||void 0===D||null===(D=D.textOuterRect)||void 0===D?void 0:D.width)&&void 0!==N?N:r)-r)/2),o=Math.ceil(((null!==(U=null===(B=e.extra)||void 0===B||null===(B=B.textOuterRect)||void 0===B?void 0:B.height)&&void 0!==U?U:n)-n)/2);Object.assign(M,{offsetParams:{offsetX:a*t,offsetY:o*i,layoutWidth:r*t,layoutHeight:n*i}})}return M}}const g={image:class extends f{static unmarshal(e,t){const i=e.sticker_resource_id||"",r=null==t?void 0:t.find((e=>e.resource_id===i));if(!i)return null;const n=r&&d(r)?{ykId:i,resourceId:i,id:i,type:c.lJ.YkSicker}:{resourceId:i,id:"",type:c.lJ.Cutout};return{type:c.F5.IMAGE,src:n,title:e.name,replaceable:r&&!d(r),extra:{resourceId:i}}}static marshal(e){var t;const i=e.src;return{sticker_alpha:null!==(t=e.layout.opacity)&&void 0!==t?t:1,sticker_design_type:0,sticker_path:i.path||"",sticker_resource_id:i.resourceId||"",type:"sticker"}}},text:y,layout:class extends f{static unmarshal(e){var t;const[i,n]=e.position,[a,o]=e.scale,[s,l]=e.original_size;return{x:360+i-s*a/2,y:360-n-l*o/2,width:s,height:l,scale:{x:a,y:o},rotation:-e.rotation[2]||0,opacity:(e.type===r.text?null===(t=e.text_params)||void 0===t?void 0:t.globalAlpha:e.sticker_alpha)||1}}static marshal(e){var t,i,r,n;const{layout:a}=e;if(!a)return{};const o=a.x+a.width/2-360,s=-(a.y+a.height/2-360);return{...{original_size:[a.width,a.height],position:[o,s,0],rotation:[0,0,-a.rotation||0],scale:[null!==(t=null===(i=a.scale)||void 0===i?void 0:i.x)&&void 0!==t?t:1,null!==(r=null===(n=a.scale)||void 0===n?void 0:n.y)&&void 0!==r?r:1,1]},anims:[],duration:3,layout_params:{bottom_toBottomOf:"",fix_dimensionRatio:!1,fix_height:!0,fix_width:!0,hCenter_toHCenterOf:"",left_toLeftOf:"",right_toRightOf:"",top_toTopOf:"",vCenter_toVCenterOf:""},order_in_layer:2,start_time:0,visible:!0}}}};class m{constructor(e,t){try{this._list=JSON.parse(e),this._dependency=t}catch(i){l.t.error(null==i?void 0:i.message)}}parse(){var e,t;return null!==(e=null===(t=this._list)||void 0===t||null===(t=t.children)||void 0===t?void 0:t.sort(((e,t)=>e.order_in_layer-t.order_in_layer)).reduce(((e,t)=>{const i=g.layout.unmarshal(t);let r;if("sticker"===t.type)r=g.image.unmarshal(t,this._dependency);else{if("text"!==t.type)return e;r=g.text.unmarshal(t.text_params)}return r?[...e,{...r,layout:i}]:e}),[]))&&void 0!==e?e:[]}}class _{constructor(e){this._layers=[],this._layers=e}parse(){return{children:this._layers.reduce(((e,t)=>{const i=g.layout.marshal(t);let r;return r=t.type===c.F5.IMAGE?g.image.marshal(t):g.text.marshal(t),r?[...e,{...r,...i}]:e}),[]),root:{duration:3,name:"rootWidget",preview_time:.7666666666666666},type:"ScriptTemplate"}}}},44362:(e,t,i)=>{"use strict";i.d(t,{Q:()=>y});class r{constructor(e,t){this.skipWhiteSpace=e=>{let t=e;for(;t<this.raw.length&&" "===this.raw[t];)t++;return t},this.raw=e,this.index=t}}class n extends r{constructor(){super(...arguments),this.content="",this.parse=()=>{this.index++;let e=this.index;const{raw:t}=this;for(;e<t.length;){const i=t[e];if("]"===i){if(e++,"]"!==t[e])break;this.content+="]"}else this.content+=i;e++}return this.index=e,this.index}}}class a{constructor(){this.name="",this.attributes=[],this.children=[]}}class o extends r{constructor(){super(...arguments),this.element=new a,this.parseName=()=>{let e="",t=this.index;for(;/[a-zA-Z0-9_\-\.\:]/.test(this.raw[t]);)t++;return e+=this.raw.slice(this.index,t),this.index=t,e},this.parseAttribute=()=>{const e=[];let t=this.index;const i=this.raw.length;for(;t<i;){const r={label:"",value:""};if(t=this.skipWhiteSpace(t),t>=i||">"===this.raw[t])break;let n=t;for(;n<i&&/[a-zA-Z0-9_\-\.\:]/.test(this.raw[n]);)n++;if(r.label=this.raw.slice(t,n),t=n,t=this.skipWhiteSpace(t),t>=i)break;if(">"===this.raw[t]){t++;break}"="===this.raw[t]&&t++;const a="("===this.raw[t],o='"'===this.raw[t];for((o||a)&&t++,n=t;n<i;){const e=this.raw[n];if(a&&")"===e||o&&'"'===e){r.value=this.raw.slice(t,n),t=n+1;break}if(!(o||a||" "!==e&&">"!==e)){r.value=this.raw.slice(t,n),t=n+(">"===e?0:1);break}n++}e.push(r)}return this.index=t,e},this.parseEndTag=()=>{const e="invalid tag";if("</"!==this.raw.substring(this.index,this.index+2))throw new Error(e);this.index+=2;if(this.parseName()!==this.element.name)throw new Error(`tag doesnt match! current name: ${this.element.name}`);if(this.index=this.skipWhiteSpace(this.index),">"!==this.raw[this.index])throw new Error(e);this.index++},this.parseStartTag=()=>{if(this.index++,this.element.name=this.parseName(),this.index=this.skipWhiteSpace(this.index),!(this.index>=this.raw.length||(this.element.attributes=this.parseAttribute(),this.index=this.skipWhiteSpace(this.index),this.index>=this.raw.length)))if("/>"!==this.raw.substring(this.index,this.index+2)){if(">"!==this.raw[this.index])throw new Error("invalid tag");this.index++}else this.index+=2},this.parseChildren=()=>{for(;this.index<this.raw.length;){if("<"===this.raw[this.index]){if("/"===this.raw[this.index+1])break;const e=new o(this.raw,this.index);e.parse(),this.index=e.index,this.element.children.push(e.element)}if("["===this.raw[this.index]){const e=new n(this.raw,this.index);this.index=e.parse(),this.element.children.push(e.content)}}},this.parse=()=>(this.parseStartTag(),this.parseChildren(),this.parseEndTag(),this.index)}}class s{constructor(){this.children=[]}}class l extends r{constructor(){super(...arguments),this.element=new s}parse(){let e=this.index;for(;e<this.raw.length;){const t=this.raw[e];if("<"===t){const t=new o(this.raw,e);t.parse(),e=t.index,this.element.children.push(t.element)}else if("["===t){const t=new n(this.raw,e);e=t.parse(),this.element.children.push(t.content)}}return this.index=e,this.index}}var c=i(82440),d=i(43825),u=i(81254);const h=i(57123).cE.layer,p=/^([a-z])(.*)/,f=e=>(0,u.Ic)(e.split(",").map((e=>Number(e))));class y{static xmlToJson(e){const t=[];if(!e)return{text:"",styles:[]};const i=new l(`<root>${e}</root>`,0);i.parse();const r=(e,i)=>{e.forEach((e=>{if("string"==typeof e)return void t.push({text:e,...i});const n=e.attributes.reduce(((t,i)=>(t[`${e.name}${i.label.replace(p,((e,t,i)=>`${t.toUpperCase()}${i}`))}`]=i.value,t)),{});e.attributes.length||"root"===e.name||(n[e.name]=!0),r(e.children,{...i,...n})}))};r(i.element.children,{});let n="";const a=[];return t.forEach((e=>{var t,i,r;const o=n.length,s=e.text.length;a.push({version:"3.0",select:e.select,range:[o,o+s],font:{id:null!==(t=e.fontId)&&void 0!==t?t:"",path:null!==(i=e.fontPath)&&void 0!==i?i:""},size:Number(e.size),bold:e.b,italic:e.i,underline:e.u,fill:e.color?f(e.color):(0,u.Ic)([1,1,1,1]),effectStyle:e.effectStyleId?{id:e.effectStyleId,path:null!==(r=e.effectStylePath)&&void 0!==r?r:""}:void 0,strokes:e.outlineColor&&!1!==e.outlineEnable?[{enable:!0,...f(e.outlineColor),width:void 0===e.outlineWidth?d.q2:Number(e.outlineWidth)}]:void 0,shadows:e.shadowColor&&!1!==e.shadowEnable?[{enable:!0,distance:100*h.shadowDistance(e),feather:void 0===e.shadowSmooth?d.cW:Number(e.shadowSmooth),angle:void 0===e.shadowAngle?-d.du:Number(e.shadowAngle),...f(e.shadowColor)}]:void 0}),n+=e.text})),{text:n,styles:a}}}y.toJSON=e=>{var t,i,r;const n=isNaN(Number(e.fontSize))?12:Number(e.fontSize),a=e.text?(e.upperCase?e.text.toLocaleUpperCase():e.text).replace(/\t|\r/g," "):"",o={version:"3.0",range:[0,a?a.length:0],size:n,underline:Boolean(e.underline&&!(null!==(t=e.curve)&&void 0!==t&&t.enable)),bold:Boolean(e.boldWidth),italic:Boolean(e.italicDegree),strokes:[],shadows:[]};if(e.font){var s,l;const t=(null===(s=e.font)||void 0===s?void 0:s.resourceId)||"";let i="";var h;if(t)i=null===(h=c.fO.resource.get(t))||void 0===h?void 0:h.fsPath;o.font={id:t,path:null!==(l=i)&&void 0!==l?l:""}}var p,f,y,g;(e.color&&(o.fill=(0,u.Ic)(e.color,!0)),null!==(i=e.outline)&&void 0!==i&&i.enable)&&(null===(p=o.strokes)||void 0===p||p.push({enable:!0,...(0,u.Ic)(e.outline.color,!0),width:e.outline.width}));null!==(r=e.shadow)&&void 0!==r&&r.enable&&(null===(f=o.shadows)||void 0===f||f.push({enable:!0,distance:void 0===e.shadow.distance?d.pn:100*e.shadow.distance,feather:null!==(y=e.shadow.smoothing)&&void 0!==y?y:d.cW,angle:null!==(g=e.shadow.angle)&&void 0!==g?g:-d.du,...(0,u.Ic)(e.shadow.color,!0)}));return{text:a,styles:[o]}}},81254:(e,t,i)=>{"use strict";i.d(t,{Ic:()=>s,P5:()=>o,a$:()=>l});var r=i(44362),n=i(82440),a=i(67986);const o=e=>{var t;const i=[0,0,0,1];let r=0;for(;r<3;){const t=Number(null==e?void 0:e[r]);Number.isNaN(t)||(i[r]=t/255),r++}return i[r]=null!==(t=null==e?void 0:e[r])&&void 0!==t?t:1,i},s=(e,t)=>{var i;let[r,n,a,s]=[...null!=e?e:[]];return t&&([r,n,a,s]=o([...null!=e?e:[]])),{alpha:1,content:{solid:{color:[r,n,a],alpha:null!==(i=s)&&void 0!==i?i:1},render_type:"solid"}}},l=e=>{if(!e)return;const t=e.trim();let i;if("{"!==t[0]||"}"!==t[t.length-1])try{i=r.Q.xmlToJson(e)}catch(o){return void a.t.error(`failed to parse xml rich text to json: ${e}`,o)}else i=JSON.parse(e);return i.styles.forEach((e=>{var t,i;e.font&&!e.font.path&&(e.font.path=null!==(t=null===(i=n.fO.resource.get(e.font.id))||void 0===i?void 0:i.fsPath)&&void 0!==t?t:"")})),i}},30680:(e,t,i)=>{"use strict";i.d(t,{O:()=>Ge});var r=i(82440),n=i(8757),a=i(67986),o=i(95411),s=i(87606),l=i(50788),c=i(81363),d=i(89816);class u{constructor(e){this.type=n.x1.REMOVE_LAYER;const{layerId:t}=e;this.layerId=t,this._sideEffect={}}runOnDocument(e){const t=e.getPageByChildLayerId(this.layerId),i=e.getLayerById(this.layerId);this._storeSideEffect(i),this._sideEffect.pageId=null==t?void 0:t.id,t.removeLayer(this.layerId)}check(e){const t=e.getPageByChildLayerId(this.layerId);if(!t)return!1;return!!t.getLayerById(this.layerId)}invert(e){const t=e.getPageByChildLayerId(this.layerId);if(!t)throw new Error(`layerId ${this.layerId} does not exist on page`);let i,r;if(t.isFirstLevelLayerChild(this.layerId)){const e=t.getLayerAndPositionById(this.layerId);i=e.layer,r=e.position}else i=t.getLayerById(this.layerId),r=0;const n={...i.clone(!0)};return[new p({pageId:t.id,position:r,delta:n})]}getMutationSideEffect(){const{delImgsSrc:e,childLayerIds:t,pageId:i}=this._sideEffect;return{pageId:null!=i?i:"",layerId:this.layerId,delImgsSrc:e,childLayerIds:t}}_storeSideEffect(e){const t=[],i=e=>{e.type!==n.F5.GROUP_LAYER?t.push(e.id):e.children.forEach((e=>{i(e)}))};i(e),this._sideEffect.childLayerIds=t,this._sideEffect.delImgsSrc=function(e){const t=[],i=e=>{e&&t.push(e)},r=e=>{e instanceof c.i?e.children.forEach((e=>r(e))):e instanceof d.Z?e.items.forEach((e=>{var t;e.fill&&e.fill.image&&i(null===(t=e.fill)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.src)})):i(null==e?void 0:e.src)};return r(e),t}(e)}}function h(e,t){var i,r;const a=[],o=[],s=(e,t)=>{null!=e&&e.src||null==t||!t.src||o.push(t.src),null!=e&&e.src&&(a.push(e.src),null!=t&&t.src&&o.push(t.src))};var l;(null!=e&&null!==(i=e.childrenDelta)&&void 0!==i&&i.length&&e.childrenDelta.forEach(((e,i)=>{const r=h(e,null==t?void 0:t.children[i]);a.push(...r.addImgsSrc),o.push(...r.delImgsSrc)})),null!==(r=e.items)&&void 0!==r&&r.length&&e.items.forEach(((e,i)=>{var r;const n=null==e||null===(r=e.fill)||void 0===r?void 0:r.image,a=null==t?void 0:t.items[i].fill,o=null==a?void 0:a.image;s(n,o)})),e.areas)&&(null===(l=e.areas)||void 0===l||l.forEach(((e,i)=>{const r=(null==e?void 0:e.fill.fillType)===n.kl.IMAGE?e.fill.image:void 0,a=null==t?void 0:t.areas[i].fill,o=(null==a?void 0:a.fillType)===n.kl.IMAGE?a.image:void 0;s(r,o)})));return null!=e&&e.src&&s(e,t),{addImgsSrc:a,delImgsSrc:o}}class p{constructor(e){this.type=n.x1.ADD_LAYER;const{pageId:t,position:i,delta:r}=e;this.pageId=t,this.position=i,this.delta=r}runOnDocument(e){const t=l.Z.getInstance().createLayer(this.delta.type,this.delta);e.addLayer(this.pageId,this.position,t)}check(e){const t=e.getPageById(this.pageId);return!!t&&(0===t.layers.length||!(this.position<0||this.position>t.layers.length))}invert(e){return[new u({layerId:this.delta.id})]}getMutationSideEffect(){var e;return{layerId:this.delta.id,pageId:this.pageId,addImgsSrc:h(this.delta).addImgsSrc,templateId:null===(e=this.delta.extra)||void 0===e||null===(e=e.sourceInfo)||void 0===e?void 0:e.templateId}}}const f={[n.F5.GROUP_LAYER]:class{build(e,t,i){var r,n;const a=e.getPageById(t.pageId);if(!a)return;const o={...t.delta,id:null!==(r=t.delta.id)&&void 0!==r?r:(0,s.L)()};i(new p({pageId:t.pageId,position:null!==(n=t.position)&&void 0!==n?n:a.layers.length,delta:o}))}},[n.F5.IMAGE]:class{build(e,t,i){var r,n;const a=e.getPageById(t.pageId);if(!a)return;const o={...t.delta,id:null!==(r=t.delta.id)&&void 0!==r?r:(0,s.L)(),visibility:!0};i(new p({pageId:t.pageId,position:null!==(n=t.position)&&void 0!==n?n:a.layers.length,delta:o}))}},[n.F5.TEXT]:class{build(e,t,i){var r,n;const a=e.getPageById(t.pageId);if(!a)return;const o={...t.delta,id:null!==(r=t.delta.id)&&void 0!==r?r:(0,s.L)()};i(new p({pageId:t.pageId,position:null!==(n=t.position)&&void 0!==n?n:a.layers.length,delta:o}))}},[n.F5.SHAPE]:class{build(e,t,i){var r;const n=e.getPageById(t.pageId);if(!n)return;const{id:a}=t.delta,o={...t.delta,id:null!=a?a:(0,s.L)()};i(new p({pageId:t.pageId,position:null!==(r=t.position)&&void 0!==r?r:n.layers.length,delta:o}))}},[n.F5.LINE]:class{build(e,t,i){var r;const n=e.getPageById(t.pageId);if(!n)return;const{id:a}=t.delta,o={...t.delta,id:null!=a?a:(0,s.L)()};i(new p({pageId:t.pageId,position:null!==(r=t.position)&&void 0!==r?r:n.layers.length,delta:o}))}},[n.F5.IMAGE_CONTAINER]:class{build(e,t,i){var r;const n=e.getPageById(t.pageId);if(!n)return;const{id:a}=t.delta,o={id:null!=a?a:(0,s.L)(),...t.delta};i(new p({pageId:t.pageId,position:null!==(r=t.position)&&void 0!==r?r:n.layers.length,delta:o}))}},[n.F5.GRID]:class{build(e,t,i){var r;const n=e.getPageById(t.pageId);if(!n)return;const{id:a}=t.delta,o={id:null!=a?a:(0,s.L)(),...t.delta};i(new p({pageId:t.pageId,position:null!==(r=t.position)&&void 0!==r?r:n.layers.length,delta:o}))}},[n.F5.SVG_IMAGE]:class{build(e,t,i){var r,n;const a=e.getPageById(t.pageId);if(!a)return;const o={...t.delta,id:null!==(r=t.delta.id)&&void 0!==r?r:(0,s.L)(),visibility:!0};i(new p({pageId:t.pageId,position:null!==(n=t.position)&&void 0!==n?n:a.layers.length,delta:o}))}}};class y{static getBuilder(e){const t=f[e];if(!t)throw new Error("not support layer type getBuilder");return new t}}class g{constructor(e){this.actionId=(0,s.L)();const{canUndoRedo:t}=e;this.canUndoRedo=t}}class m extends g{constructor(e){var t;super(e),this.type=n.Us.AddLayerAction;const{pageId:i,position:r,delta:a}=e;this.pageId=i,this.position=r,this.delta={...a,id:null!==(t=a.id)&&void 0!==t?t:(0,s.L)()}}do(e,t){var i;const r=e.getPageById(this.pageId);return y.getBuilder(this.delta.type).build(e,{pageId:this.pageId,position:null!==(i=this.position)&&void 0!==i?i:r.layers.length,delta:this.delta,canUndoRedo:this.canUndoRedo},t),!0}check(e){const t=e.getPageById(this.pageId);return!!t&&(!e.isPageInPreview(this.pageId)&&(void 0===this.position||!(this.position<0||this.position>t.layers.length)))}}var _,v=i(41684),I=i(16052);!function(e){e.UPDATE_POSITION="updatePosition",e.MOVE_PAGE="movePage",e.UPDATE_LAYER="updateLayer"}(_||(_={}));class T{constructor(e){this.type=n.x1.UPDATE_LAYER;const{layerId:t,detail:i}=e;this.layerId=t,this.detail=i}runOnDocument(e){const t=e.getLayerById(this.layerId);if(!t)return;const i=e.getPageByChildLayerId(this.layerId);if(this._sideEffect={layerId:t.id,pageId:i.id},this.detail.type===_.UPDATE_POSITION)return this.updatePosition(e);if(this.detail.type===_.MOVE_PAGE)return;const{delta:r}=this.detail;this._storeSideEffect(t,r),t.mergeDelta(r),this._isUpdateLayerLayoutInGroup(i,this.layerId,r)&&this._autoUpdate(i)}updatePosition(e){const{position:t}=this.detail;e.getPageByChildLayerId(this.layerId).updateLayerPosition(this.layerId,t)}check(e){return!!e.getLayerById(this.layerId)}invert(e){const t=e.getLayerById(this.layerId);if(!t)return[];let i;if(this.detail.type===_.UPDATE_POSITION){const t=e.getPageByChildLayerId(this.layerId);i=this._getInvertUpdatePositionDelta(t,this.layerId)}else if(this.detail.type===_.MOVE_PAGE){const t=e.getPageByChildLayerId(this.layerId);i={type:this.detail.type,pageId:t.id}}else{const r=e.getPageByChildLayerId(this.layerId),{delta:n}=this.detail;i=this._getInvertUpdateLayerDelta(r,t,n)}return[new T({layerId:this.layerId,detail:i})]}getMutationSideEffect(){var e;const{addImgsSrc:t,delImgsSrc:i,pageId:r}=null!==(e=this._sideEffect)&&void 0!==e?e:{};return{layerId:this.layerId,pageId:r,addImgsSrc:t||[],delImgsSrc:i||[]}}_getInvertUpdatePositionDelta(e,t){if(e.isFirstLevelLayerChild(t)){const{position:t}=e.getLayerAndPositionById(this.layerId);return{type:_.UPDATE_POSITION,position:t}}const i=e.getLayerAccessRoad(t),r=e.getLayerById(i[i.length-2]).children.findIndex((e=>e.id===t));return{type:_.UPDATE_POSITION,position:r}}_getInvertUpdateLayerDelta(e,t,i){let r={};if(Object.keys(i).forEach((e=>{r[e]=(0,I.p)(i[e],t[e],!0)})),this._isUpdateLayerLayoutInGroup(e,this.layerId,i)){const n=e.getParentLayerByLayerId(this.layerId),a=n.children.map((e=>e.id===t.id?{...e.layout,...i.layout}:e.layout)),o=(0,v._E)(null==n?void 0:n.layout,...a),s={x:t.layout.x-o.offset.x,y:t.layout.y-o.offset.y};r={...r,layout:{...r.layout,...s}}}return{type:_.UPDATE_LAYER,delta:r}}_isUpdateLayerLayoutInGroup(e,t,i){if(e.isFirstLevelLayerChild(t))return!1;const r=null==i?void 0:i.layout;return void 0!==(null==r?void 0:r.width)||void 0!==(null==r?void 0:r.height)||void 0!==(null==r?void 0:r.x)||void 0!==(null==r?void 0:r.y)}_autoUpdate(e){const t=e.getParentLayerByLayerId(this.layerId),i=t.children.map((e=>e.layout)),r=(0,v._E)(t.layout,...i);0===r.offset.x&&0===r.offset.y||t.children.forEach((e=>{e.layout={...e.layout,x:e.layout.x-r.offset.x,y:e.layout.y-r.offset.y}})),t.layout={...t.layout,x:r.x,y:r.y,width:r.width,height:r.height}}_storeSideEffect(e,t){const{addImgsSrc:i,delImgsSrc:r}=h(t,e);this._sideEffect.addImgsSrc=i,this._sideEffect.delImgsSrc=r}}class w{constructor(e){this.type=n.x1.UNGROUP_LAYER;const{layerId:t}=e;this.layerId=t}runOnDocument(e){const t=e.getPageByChildLayerId(this.layerId),{layer:i,position:r}=t.getLayerAndPositionById(this.layerId),n=i.children,a=i.layout;this._sideEffect={layerIds:n.map((e=>e.id)),ungroupedLayerLayout:JSON.parse(JSON.stringify(a)),pageId:t.id};for(const o of n){const{x:e,y:t,width:i,height:r,scale:n,rotation:s,opacity:l}=o.layout,c=(0,v.HP)({...o.layout,width:i*n.x,height:r*n.y},{x:0,y:0,width:a.width,height:a.height},(0,v.S3)(a.rotation));o.layout=Object.assign({},{...o.layout,x:(c.x+e)*a.scale.x+a.x,y:(c.y+t)*a.scale.y+a.y,scale:{x:a.scale.x*n.x,y:a.scale.y*n.y},rotation:a.rotation+s,opacity:a.opacity*l})}t.removeLayer(i.id),t.addLayer(r,...n)}getLayerPoint(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}check(e){const t=e.getLayerById(this.layerId);return!!(t&&t instanceof c.i)}invert(e){const t=e.getLayerById(this.layerId),{layout:i}=t,r=[];if(0===i.opacity){const e=t.children.map((e=>new T({layerId:e.id,detail:{type:_.UPDATE_LAYER,delta:{layout:{opacity:e.layout.opacity}}}})));r.push(...e)}const n=new E({id:this.layerId,layers:t.children.map((e=>e.id)),wrapLayout:{x:i.x,y:i.y,width:i.width,height:i.height,scale:{x:i.scale.x,y:i.scale.y},rotation:i.rotation,opacity:i.opacity}});return r.push(n),r}getMutationSideEffect(){const{layerIds:e,ungroupedLayerLayout:t,pageId:i}=this._sideEffect;return{layerId:this.layerId,pageId:i,childLayerIds:e,layout:t}}}class E{constructor(e){this.type=n.x1.GROUP_LAYER;const{id:t,layers:i,wrapLayout:r,delta:a}=e;this.id=t,this.layerIds=i,this.wrapLayout=r,this.delta=a}runOnDocument(e){var t;const i=e.getPageByChildLayerId(this.layerIds[0]);let r=0;const a=this.layerIds.map((e=>i.getLayerAndPositionById(e))).sort(((e,t)=>e.position-t.position)).map((e=>(r=Math.max(r,e.position),e.layer))),o=null!==(t=this.wrapLayout)&&void 0!==t?t:(0,v.aR)(...a.map((e=>e.layout))),s=l.Z.getInstance().createLayer(n.F5.GROUP_LAYER,{type:n.F5.GROUP_LAYER,id:this.id,layout:o,visibility:!0,isLocked:!1,childrenDelta:[],...this.delta});s.addLayers(a,{isNeedCalcChildLayout:!0,isNeedCalcWrapLayout:void 0===this.wrapLayout}),i.addLayer(r,s),i.removeLayer(...this.layerIds),this._sideEffect={pageId:i.id}}check(e){if(!e.getPageByChildLayerId(this.layerIds[0]))return!1;if(this.layerIds.length<2)return!1;for(const t of this.layerIds)if(!e.getLayerById(t))return!1;return!0}invert(e){const t=[],i=new w({layerId:this.id});t.push(i);const r=e.getPageByChildLayerId(this.layerIds[0]),n=this.layerIds.map((e=>{const{layer:t,position:i}=r.getLayerAndPositionById(e);return new T({layerId:t.id,detail:{type:_.UPDATE_POSITION,position:i}})}));return t.push(...n),t}getMutationSideEffect(){return{layerId:this.id,childLayerIds:this.layerIds,pageId:this._sideEffect.pageId}}}class x extends g{constructor(e){super(e),this.type=n.Us.DeleteLayerAction;const{layerId:t}=e;this.layerId=t}do(e,t){const i=e.getPageByChildLayerId(this.layerId);if(i.isFirstLevelLayerChild(this.layerId)){return t(new u({layerId:this.layerId})),!0}const r=i.getLayerAccessRoad(this.layerId),n=r[r.length-2],a=i.getLayerById(n),o=a.children.filter((e=>e.id!==this.layerId)),s=(0,v._E)(a.layout,...o.map((e=>e.layout)));t(new w({layerId:a.id}));if(t(new u({layerId:this.layerId})),1===o.length)return!0;const l={...a.layout,x:s.x,y:s.y,width:s.width,height:s.height};return t(new E({id:a.id,layers:o.map((e=>e.id)),wrapLayout:l})),!0}check(e){if(!this.layerId)return!1;return!!e.getPageByChildLayerId(this.layerId)}}class b extends g{constructor(e){super(e),this.type=n.Us.UpdateLayerAction;const{layerId:t,detail:i}=e;this.layerId=t,this.detail=i}do(e,t){if(this.detail.type===_.UPDATE_POSITION){t(new T({layerId:this.layerId,detail:this._generateUpdatePositionDelta(e,this.detail)}))}if(this.detail.type===_.UPDATE_LAYER){t(new T({layerId:this.layerId,detail:{type:this.detail.type,delta:this.detail.delta}}))}return!0}check(e){return!!e.getLayerById(this.layerId)}_generateUpdatePositionDelta(e,t){const i=e.getPageByChildLayerId(this.layerId);let r;if(i.isFirstLevelLayerChild(this.layerId)){const e=i.getLayerPositionById(this.layerId),n=i.layers.length;r=this._getUpdatePositionByUpdateType(t.updatePositionType,e,n)}else{const e=i.getParentLayerByLayerId(this.layerId),n=e.children.length,a=e.getLayerPositionById(this.layerId);r=this._getUpdatePositionByUpdateType(t.updatePositionType,a,n)}return{type:t.type,position:r}}_getUpdatePositionByUpdateType(e,t,i){let r;switch(e){case n.l7.BRING_FORWARD:r=Math.min(i-1,t+1);break;case n.l7.BRING_TO_FRONT:r=i-1;break;case n.l7.SEND_BACKWARD:r=Math.max(0,t-1);break;case n.l7.SEND_TO_BACK:r=0;break;default:throw new Error(`not supper update position type ${e}`)}return r}}class R extends g{constructor(e){super(e),this.type=n.Us.MultiAction,this.actions=e.actions}do(e,t){for(const i of this.actions){let r=i.check(e);if(!r)return!1;if(r=i.do(e,t),!r)return!1}return!0}check(e){return 0!==this.actions.length}}class k{constructor(e,t,i){this.document=e,this.behavior=t,this.api=i}updateOpacity(...e){const t=e.map((e=>({layerId:e.layerId,layout:{opacity:e.opacity}})));return this._updateLayerDelta(...t)}lock(e){return this._updateIsLocked(e,!0)}unlock(e){return this._updateIsLocked(e,!1)}updateRotation(...e){const t=e.map((e=>({layerId:e.layerId,layout:{rotation:e.rotation}})));return this._updateLayerDelta(...t)}updateScale(...e){const t=e.map((e=>({layerId:e.layerId,layout:{scale:e.scale}})));return this._updateLayerDelta(...t)}updateEditParam(e,t,i){return this._apply([new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{filter:{[t]:i}}},canUndoRedo:!0})])}updateBrightness(...e){const t=e.map((e=>({layerId:e.layerId,filter:{brightness:e.brightness}})));return this._updateLayerDelta(...t)}updateContrast(...e){const t=e.map((e=>({layerId:e.layerId,filter:{contrast:e.contrast}})));return this._updateLayerDelta(...t)}updateSaturation(...e){const t=e.map((e=>({layerId:e.layerId,filter:{saturation:e.saturation}})));return this._updateLayerDelta(...t)}updatePosition(e,t){return!!this.document.getPageByChildLayerId(t)&&this._apply([new b({layerId:t,detail:{type:_.UPDATE_POSITION,updatePositionType:e},canUndoRedo:!0})])}flipHorizontal(e){const t=this.document.getLayerById(e);return!!t&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{isFlipHorizontal:!t.isFlipHorizontal}},canUndoRedo:!0})})}flipVertical(e){const t=this.document.getLayerById(e);return!!t&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{isFlipVertical:!t.isFlipVertical}},canUndoRedo:!0})})}remove(...e){const t=e.map((e=>new x({layerId:e,canUndoRedo:!0})));return this._apply(t)}removeLayersByFilter(e,t=!0){const i=this.document.getLayerIdsByFilter(t,e).map((e=>new x({layerId:e,canUndoRedo:!0})));return this._apply(i)}updateLayout(...e){const t=e.map((e=>{var t;return{layerId:e.layerId,layout:e.layout,canUndoRedo:null===(t=null==e?void 0:e.canUndoRedo)||void 0===t||t,...e.extra?{extra:e.extra}:void 0}}));return this._updateLayerDelta(...t)}copy(...e){if(!this._isLayerInSamePage(e.map((e=>e.layerId))))return!1;const t=e.map((({layerId:e,position:t})=>{const i=this.document.getPageByChildLayerId(e);if(!i)return;const r=i.getLayerAccessRoad(e),n=r.length>2?r[r.length-2]:e,a=i.getLayerById(n),{layout:o}=a,s={...l.Z.getInstance().cloneLayer(a),layout:{...o,...t},isMainImage:void 0};return new m({pageId:i.id,delta:s,canUndoRedo:!0})})).filter((e=>Boolean(e)));return this._apply(t)}switchPreviewMode(e,t,i,r){return this.behavior.switchPreviewMode(e,t,i,r)}getLayersByFilter(e=!0,t){return this.document.getLayersByFilter(e,t)}updateBlendMode(e,t){return!!this.document.getLayerById(e)&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{blendMode:t}},canUndoRedo:!0})})}_updateProperties(e,t=!0){return!!this.document.getLayerById(e.layerId)&&this.behavior.applyLocal({action:new b({layerId:e.layerId,detail:{type:_.UPDATE_LAYER,delta:e.delta},canUndoRedo:null==t||t})})}_apply(e){return 0!==e.length&&(e.length>1?this.behavior.applyLocal({action:new R({actions:e,canUndoRedo:!0})}):this.behavior.applyLocal({action:e[0]}))}_updateLayerDelta(...e){const t=e.map((e=>{const{layerId:t,canUndoRedo:i,...r}=e;return new b({layerId:t,detail:{type:_.UPDATE_LAYER,delta:r},canUndoRedo:null==i||i})}));return this._apply(t)}_updateIsLocked(e,t){const i=[],r=e=>new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{isLocked:t}},canUndoRedo:!0});return e.forEach((e=>{const t=this.document.getPageByChildLayerId(e);if(!t)return;const n=t.getLayerAccessRoad(e),a=n.length>2?n[n.length-2]:e,o=this.document.getLayerById(a);if(i.push(r(a)),o instanceof c.i){const e=this.document.getLayerIdsByFilter(!0,((e,t)=>(null==t?void 0:t.id)===o.id));i.push(...e.map(r))}})),this._apply(i)}_isLayerInSamePage(e){if(e.length<=0)return!1;if(1===e.length)return!0;const t=this.document.getPageByChildLayerId(e[0]);if(!t)return!1;return e.every((e=>{const i=this.document.getPageByChildLayerId(e);return(null==i?void 0:i.id)===(null==t?void 0:t.id)}))}_isLayerInSameParent(e){if(e.length<=0)return!1;if(1===e.length)return!0;const t=e.map((e=>this.document.pages[0].getLayerAccessRoad(e)));if(!t.length)return!1;const i=t[0].slice(0,t[0].length-1).join("_");return t.every((e=>e.slice(0,e.length-1).join("_")===i))}}class A{constructor(e){this.type=n.x1.UPDATE_DOCUMENT;const{delta:t}=e;this.delta=t}runOnDocument(e){const t=Object.keys(this.delta);for(const i of t)e[i]=(0,I.p)(e[i],this.delta[i])}check(e){return!0}invert(e){return[new A({delta:{title:e.title,guideLine:e.guideLine,pipeline:e.pipeline}})]}getMutationSideEffect(){return{pipeline:this.delta.pipeline}}}class P extends g{constructor(e){super(e),this.type=n.Us.UpdateDocumentAction;const{delta:t}=e;this.delta=t}do(e,t){return t(new A({delta:this.delta})),!0}check(e){return!0}}var M=i(12238);class L extends k{getDimension(e){return this.document.pages.find((t=>t.id===e)).dimension}getDocumentMeta(){return{...this.document.meta}}addPipelineOperation(e){const{pipeline:t=[]}=this.document,i={pipeline:null==t?void 0:t.filter((t=>t.operationType!==e.operationType)).concat(e)},r=new P({delta:{pipeline:[]},canUndoRedo:!0}),n=new P({delta:i,canUndoRedo:!0});return this._apply([r,n])}delPipelineOperation(e){const t=new P({delta:{pipeline:[]},canUndoRedo:!0});if(e){const{pipeline:i=[]}=this.document,r=i.filter((t=>t.operationType!==e)),n=new P({delta:{pipeline:r},canUndoRedo:!0});return this._apply([t,n])}return this._apply([t])}getTitle(){return this.document.title}updateTitle(e){return this.behavior.applyLocal({action:new P({delta:{title:e},canUndoRedo:!0})})}addGuideLine(e,t,i){var r;const n=null!==(r=this.document.guideLine.lines)&&void 0!==r?r:[];if(-1!==n.findIndex((t=>t.id===e)))return!1;const a=[...n,{id:e,direction:t,position:i}],o={guideLine:{...this.document.guideLine,lines:a}},s=new P({delta:o,canUndoRedo:!0});return this._apply([s])}deleteGuideLine(e){if(this.document.guideLine.lines.length<=0)return!0;const t=this.document.guideLine.lines.filter((t=>t.id!==e)),i=new P({delta:{guideLine:{lines:t}},canUndoRedo:!0});return this._apply([i])}updateGuideLinePosition(e,t){const i=this.document.guideLine.lines.map((i=>{if(i.id===e)return{...i,position:t}})),r=new P({delta:{guideLine:{lines:i}},canUndoRedo:!0});return this._apply([r])}lockGuideLine(){const e=new P({delta:{guideLine:{isLocked:!0}},canUndoRedo:!0});return this._apply([e])}unlockGuideLine(){const e=new P({delta:{guideLine:{isLocked:!1}},canUndoRedo:!0});return this._apply([e])}getPageBackgroundImage(e){var t,i;const r=null!=e?e:null===(t=this.document.pages[0])||void 0===t?void 0:t.id;return null===(i=this.document.getPageById(r))||void 0===i||null===(i=i.background)||void 0===i?void 0:i.image}createNewDocumentWithPages(e){const t=new M.Z;return t.meta=this.getDocumentMeta(),t.title=this.getTitle(),t.pages=e,t}}class S extends g{constructor(e){super(e),this.type=n.Us.GroupLayerAction,this.layers=e.layers,this.delta=e.delta,this.wrapLayout=e.wrapLayout}do(e,t){const i=[];for(const r of this.layers){const n=this._recursiveUngroupChildLayer(e,r,t);i.push(...n)}return t(new E({id:(0,s.L)(),layers:i,wrapLayout:this.wrapLayout,delta:this.delta})),!0}check(e){if(!this.layers.length)return!1;for(const t of this.layers){if(!e.getLayerById(t))return!1}return!0}_recursiveUngroupChildLayer(e,t,i){const r=e.getLayerById(t);if(r.type===n.F5.GROUP_LAYER){i(new w({layerId:r.id}));const t=[],n=r.children.map((e=>e.id));for(const r of n){const n=this._recursiveUngroupChildLayer(e,r,i);t.push(...n)}return[...t]}return[t]}}class C extends g{constructor(e){super(e),this.type=n.Us.UngroupLayerAction,this.layerId=e.layerId}do(e,t){return t(new w({layerId:this.layerId})),!0}check(e){return!!this.layerId}}class O extends k{group(e,t){return this.behavior.applyLocal({action:new S({layers:e,wrapLayout:t,canUndoRedo:!0})})}unGroup(e){return this.behavior.applyLocal({action:new C({layerId:e,canUndoRedo:!0})})}}var F=i(55351),N=i(13659),D=i(26007);class U extends k{add(e,t,i,r){var a,o,s;const l=this.document.getPageById(e);if(!l)return(0,N.wf)(-1,"pageId invalid");const c=null!==(a=i.clipRect)&&void 0!==a?a:{x:0,y:0,width:i.width,height:i.height};return this.behavior.applyLocal({action:new m({pageId:e,delta:{...r,type:n.F5.IMAGE,layout:{...i,clipRect:c},visibility:null===(o=null==r?void 0:r.visibility)||void 0===o||o,isLocked:null!==(s=null==r?void 0:r.isLocked)&&void 0!==s&&s,title:null==r?void 0:r.title,src:t,extra:null==r?void 0:r.extra},canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(l.layers,"id")):(0,N.wf)(-1,"add layer fail")}replace(e,t){const i=this.document.getLayerById(e);if(!i)return!1;const{layout:r}=i;return this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{src:t.src,postProcessEffects:void 0,layout:{...r,clipRect:t.clipRect},isFlipVertical:void 0,isFlipHorizontal:void 0,aiTool:void 0}},canUndoRedo:!0})})}removeEffectFilters(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.IMAGE)return!1;const r=(i.effectFilters?[...i.effectFilters]:[]).filter((e=>!t.includes(e.resourceId)));return this.updateEffectFilters(e,r)}updateEffectFilters(e,t){var i;const r=this.document.getLayerById(e);if(!r||![n.F5.IMAGE,n.F5.SVG_IMAGE].includes(r.type))return!1;const a=[...t];return null===(i=r.effectFilters)||void 0===i||i.forEach(((e,t)=>{const i=a[t];i&&Object.keys(e.params).forEach((e=>{e in i.params||Object.assign(i.params,{[e]:void 0})}))})),this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{effectFilters:a}},canUndoRedo:!0})})}applyAiTool(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.IMAGE)return!1;const o=(0,D.R5)(null!==(i=null===(r=a.aiTool)||void 0===r?void 0:r.pipelines)&&void 0!==i?i:[],(e=>(0,F.B)(e.toolType,t.toolType))),s={aiTool:{...a.aiTool,pipelines:[t,...o]}},l=this._buildClearAiToolAction(e),c=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:s},canUndoRedo:!0});return this._apply([l,c])}resetAiTool(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.IMAGE)return!1;const o=(0,D.R5)(null!==(i=null===(r=a.aiTool)||void 0===r?void 0:r.pipelines)&&void 0!==i?i:[],(e=>(0,F.B)(e.toolType,t))),s={aiTool:{...a.aiTool,pipelines:o}},l=this._buildClearAiToolAction(e),c=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:s},canUndoRedo:!0});return this._apply([l,c])}updateCutout(e,t,i,r){const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.IMAGE||t&&!i)return!1;const o={aiTool:(0,F.OM)(a.aiTool,t,i,r)},s=this._buildClearAiToolAction(e),l=this._buildUpdatePostProcessEffectsStatusAction(e,t),c=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:o},canUndoRedo:!0});return this._apply([s,l,c])}updateCutoutBackground(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.IMAGE)return!1;const a={aiTool:(0,F.yd)(r.aiTool,t,i)},o=this._buildClearAiToolAction(e),s=this._buildUpdatePostProcessEffectsStatusAction(e,!t),l=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:a},canUndoRedo:!0});return this._apply([o,s,l])}updateReplacePalette(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.IMAGE||t&&!i)return!1;let a;return a=t?{replacePalette:{enable:t,uri:i}}:{replacePalette:void 0},this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:a},canUndoRedo:!0})})}clearPostProcessEffects(e){const t=this.document.getLayerById(e);return!(!t||t.type!==n.F5.IMAGE)&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:[],extra:{postProcessPreset:void 0}}},canUndoRedo:!0})})}updatePostProcessEffects(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.IMAGE)return!1;const o=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:[],extra:{postProcessPreset:void 0}}},canUndoRedo:!0}),s=null===(i=t.list)||void 0===i?void 0:i.map((e=>({...e}))),l=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:s,extra:{postProcessPreset:null!=s&&s.length?null!==(r=t.preset)&&void 0!==r?r:a.extra.postProcessPreset:void 0}}},canUndoRedo:!0});return this._apply([o,l])}markMainImage(e){const t=this.document.getLayerById(e);return!!t&&(!!t.isMainImage||this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{isMainImage:!0}},canUndoRedo:!0})}))}unmarkMainImage(e){const t=this.document.getLayerById(e);return!!t&&(!t.isMainImage||this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{isMainImage:!1}},canUndoRedo:!0})}))}_buildUpdatePostProcessEffectsStatusAction(e,t){var i;const r=null===(i=this.document.getLayerById(e).postProcessEffects)||void 0===i?void 0:i.map((e=>({...e,enable:t})));return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:r}},canUndoRedo:!0})}_buildClearAiToolAction(e){return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{aiTool:void 0}},canUndoRedo:!0})}}var B=i(15516);class G extends k{add(e,t){const i=this.document.getPageById(e);if(!i)return(0,N.wf)(-1,"pageId invalid");return this.behavior.applyLocal({action:new m({pageId:e,delta:{type:n.F5.IMAGE_CONTAINER,...t},canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(i.layers,"id")):(0,N.wf)(-1,"add layer fail")}fillContainerItemWithLayerId(e,t,i,r){const a=this.document.getLayerById(i);if(!a||a.type!==n.F5.IMAGE)return!1;const o={...a.clone(!0),layout:{...r},isFlipHorizontal:a.isFlipHorizontal,isFlipVertical:a.isFlipVertical},{isValid:s,delta:l}=this._buildContainerItemDelta(e,{fill:{fillType:n.lm.IMAGE,image:o}},((e,i,r)=>{if(t===i){if(e.fill.fillType===n.lm.IMAGE){const e=r.fill.image;return e&&(e.filter={...B.js,...e.filter}),r}return r}}));if(!s)return!1;const c=new x({layerId:i,canUndoRedo:!0}),d=this._buildClearFillImageAction(e,t),u=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:l}},canUndoRedo:!0});return this._apply(d?[c,d,u]:[c,u])}fillContainerItemWithImage(e,t,i,r){const{isValid:a,delta:o}=this._buildContainerItemDelta(e,{fill:{fillType:n.lm.IMAGE,image:{id:(0,s.L)(),type:n.F5.IMAGE,layout:r,visibility:!0,isLocked:!1,src:i,aiTool:void 0,isFlipHorizontal:void 0,isFlipVertical:void 0,postProcessEffects:void 0}}},((e,i,r)=>{if(t===i){if(e.fill.fillType===n.lm.IMAGE){var a,o;const t=null===(a=e.fill.image)||void 0===a?void 0:a.filter;t&&(r.fill.image.filter=t);const i=null===(o=e.fill.image)||void 0===o?void 0:o.effectFilters;i&&(r.fill.image.effectFilters=i)}return r}}));if(!a)return!1;const l=this._buildClearFillImageAction(e,t),c=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:o}},canUndoRedo:!0});return this._apply(l?[l,c]:[c])}fillContainerItemWithColor(e,t,i){const r={fill:{fillType:n.lm.COLOR,image:void 0,color:i}},{isValid:a,delta:o}=this._buildSingleContainerItemDelta(e,r,t);return!!a&&this._updateProperties({layerId:e,delta:{items:o}})}clearFillImage(e,t){const i=this._buildClearFillImageAction(e,t);return!!i&&this._apply([i])}updateFillImage(e,t,i){const r={fill:{image:{...i.filter?{filter:i.filter}:void 0,...i.layout?{layout:i.layout}:void 0,...i.effectFilters?{effectFilters:i.effectFilters}:void 0,blendMode:i.blendMode,...i.postProcessEffects?{postProcessEffects:i.postProcessEffects}:void 0,...i.extra?{extra:i.extra}:void 0}}},{isValid:n,delta:a}=this._buildSingleContainerItemDelta(e,r,t);return!!n&&this._updateProperties({layerId:e,delta:{items:a}})}updateContainerItems(e,t){const i=this.document.getLayerById(e);return!(!i||i.type!==n.F5.IMAGE_CONTAINER)&&this._updateProperties({layerId:e,delta:{items:t}})}applyAiTool(e,t,i){var r,a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.IMAGE_CONTAINER)return!1;const s=null===(r=o.items[t].fill.image)||void 0===r?void 0:r.aiTool,l=(0,D.R5)(null!==(a=null==s?void 0:s.pipelines)&&void 0!==a?a:[],(e=>(0,F.B)(e.toolType,i.toolType))),c={fill:{image:{aiTool:{...s,pipelines:[i,...l]}}}},{isValid:d,delta:u}=this._buildSingleContainerItemDelta(e,c,t);if(!d)return!1;const h=this._buildClearAiToolAction(e,t),p=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:u}},canUndoRedo:!0});return this._apply(h?[h,p]:[p])}resetAiTool(e,t,i){var r,a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.IMAGE_CONTAINER)return!1;const s=null===(r=o.items[t].fill.image)||void 0===r?void 0:r.aiTool,l=(0,D.R5)(null!==(a=null==s?void 0:s.pipelines)&&void 0!==a?a:[],(e=>(0,F.B)(e.toolType,i))),c={fill:{image:{aiTool:{...s,pipelines:l}}}},{isValid:d,delta:u}=this._buildSingleContainerItemDelta(e,c,t);if(!d)return!1;const h=this._buildClearAiToolAction(e,t),p=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:u}},canUndoRedo:!0});return this._apply(h?[h,p]:[p])}updateCutout(e,t,i,r,a){var o;const s=this.document.getLayerById(e);if(!s||s.type!==n.F5.IMAGE_CONTAINER||t&&!r)return!1;const{image:l}=s.items[i].fill,c={fill:{image:{aiTool:(0,F.OM)(null==l?void 0:l.aiTool,t,r,a),postProcessEffects:null==l||null===(o=l.postProcessEffects)||void 0===o?void 0:o.map((e=>({...e,enable:t})))}}},{isValid:d,delta:u}=this._buildSingleContainerItemDelta(e,c,i);if(!d)return!1;const h=this._buildClearAiToolAction(e,i),p=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:u}},canUndoRedo:!0});return this._apply(h?[h,p]:[p])}nonUniformScaling(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.IMAGE_CONTAINER)return!1;const a=null==i?void 0:i.map((e=>({layout:{...e.layout.width?{width:e.layout.width}:void 0,...e.layout.height?{height:e.layout.height}:void 0},...e.fillLayout?{fill:{image:{layout:{...e.fillLayout}}}}:void 0}))),{isValid:o,delta:s}=this._buildContainerItemDelta(e,{},((e,t)=>a[t]));return!!o&&this._updateProperties({layerId:e,delta:{layout:t,items:s}})}updateCutoutBackground(e,t,i,r){var a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.IMAGE_CONTAINER)return!1;const{image:s}=o.items[i].fill,l={fill:{image:{aiTool:(0,F.yd)(null==s?void 0:s.aiTool,t,r),postProcessEffects:null==s||null===(a=s.postProcessEffects)||void 0===a?void 0:a.map((e=>({...e,enable:!t})))}}},{isValid:c,delta:d}=this._buildSingleContainerItemDelta(e,l,i);if(!c)return!1;const u=this._buildClearAiToolAction(e,i),h=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:d}},canUndoRedo:!0});return this._apply(u?[u,h]:[h])}markMainImage(e,t){const i=this._buildChangeMainImageAction(e,t,!0);return!!i&&this._apply([i])}unmarkMainImage(e,t){const i=this._buildChangeMainImageAction(e,t,!1);return!!i&&this._apply([i])}_buildChangeMainImageAction(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.IMAGE_CONTAINER)return;const a=r;if(t<0||t>a.items.length)return;if(a.items[t].fill.fillType!==n.lm.IMAGE)return;const{isValid:o,delta:s}=this._buildSingleContainerItemDelta(e,{fill:{image:{isMainImage:i}}},t);if(!o)return;return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:s}},canUndoRedo:!0})}_buildClearAiToolAction(e,t){const{isValid:i,delta:r}=this._buildSingleContainerItemDelta(e,{fill:{image:{aiTool:void 0}}},t);if(i)return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:r}},canUndoRedo:!0})}_buildSingleContainerItemDelta(e,t,i){return this._buildContainerItemDelta(e,t,((e,r)=>{if(i===r)return t}))}_buildContainerItemDelta(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.IMAGE_CONTAINER)return{isValid:!1};return{isValid:!0,delta:r.items.map(((e,r)=>null==i?void 0:i(e,r,t)))}}_buildClearFillImageAction(e,t){const i=this.document.getLayerById(e);if(!i||t<0||i.items.length<=t)return;const r=i.items[t];if(r.fill.fillType!==n.lm.IMAGE)return;const a=r.fill;if(!a.image)return;const o={fill:{...a,image:void 0}},{isValid:s,delta:l}=this._buildSingleContainerItemDelta(e,o,t);return s?new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{items:l}},canUndoRedo:!0}):void 0}}class j extends k{add(e,t,i,r,a,o){const s=this.document.getPageById(e);if(!s)return(0,N.wf)(-1,"pageId invalid");const l={type:n.F5.LINE,...t,title:a,attr:i,layout:r,...o?{extra:o}:void 0};return this.behavior.applyLocal({action:new m({pageId:e,delta:l,canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(s.layers,"id")):(0,N.wf)(-1,"add layer fail")}updateAttribute(e,t,i){return!!this.document.getLayerById(e)&&this._updateProperties({layerId:e,delta:{...i?{layout:i}:void 0,attr:{...t}}})}}class H{constructor(e){this.type=n.x1.UPDATE_PAGE;const{pageId:t}=e;this.pageId=t,void 0!==e.position&&(this.position=e.position),void 0!==e.delta&&(this.delta=e.delta)}isValidPosition(){return void 0!==this.position}runOnDocument(e){const t=e.getPageById(this.pageId);t&&(this.isValidPosition()&&this._movePage(e,t,this.position),void 0!==this.delta&&t.mergeDelta(this.delta))}check(e){if(void 0!==this.position&&(this.position<0||this.position>e.pageCount))return!1;return!!e.getPageById(this.pageId)}invert(e){let t;if(this.delta){const i=e.getPageById(this.pageId),r=this.delta,n={};Object.keys(r).forEach((e=>{n[e]=(0,I.p)(r[e],i[e],!0)})),t=new H({pageId:this.pageId,delta:n})}else{if(void 0===this.position)throw new Error("updatePageMutation arguments is invalid");{const i=e.getPageById(this.pageId);let r=0;for(let t=0;t<e.pageCount;t++)e.pages[t].id===i.id&&(r=t);t=new H({pageId:this.pageId,position:r})}}return[t]}getMutationSideEffect(){return{pageId:this.pageId,position:this.position}}_movePage(e,t,i){e.removePageById(this.pageId),e.addPage(t,i)}}class W extends g{constructor(e){super(e),this.type=n.Us.UpdateLayerAction;const{pageId:t}=e;this.pageId=t,void 0!==e.position&&(this.position=e.position),void 0!==e.delta&&(this.delta=e.delta)}do(e,t){return t(new H({pageId:this.pageId,position:this.position,delta:this.delta})),!0}check(e){return!!e.getPageById(this.pageId)&&(!e.isPageInPreview(this.pageId)&&(void 0===this.position||!(this.position<0||this.position>e.pageCount)))}}var z=i(20484),V=i(54643),$=i(10224),Y=i(17882);function X(e){const t=new Ge,i=Y.m.toDraftProto(e);return t.buildFromServerData(e.meta.draftId,{draftData:i,draftTitle:e.title,draftUsedEverAsserts:[],materials:{effects:[],images:[],template_file_infos:[]}}),t}class J{constructor(e){this.type=n.x1.ADD_PAGE;const{page:t,position:i}=e;this.page=t,this.position=i}runOnDocument(e){e.addPage(this.page,this.position)}check(e){return!((0!==this.position||0!==e.pageCount)&&(this.position<0||this.position>e.pageCount))&&!e.getPageById(this.page.id)}invert(e){return[new K({pageId:this.page.id})]}getMutationSideEffect(){return{pageId:this.page.id,position:this.position}}}class K{constructor(e){this.type=n.x1.REMOVE_PAGE;const{pageId:t}=e;this.pageId=t}runOnDocument(e){e.removePageById(this.pageId)}check(e){return!!e.getPageById(this.pageId)}invert(e){const t=e.getPageById(this.pageId);if(!t)return[];let i=0;for(let r=0;r<e.pageCount;r++)e.pages[r].id===t.id&&(i=r);return[new J({page:t,position:i})]}getMutationSideEffect(){return{pageId:this.pageId}}}class q extends g{constructor(e){super(e),this.type=n.Us.RemovePageAction;const{pageId:t}=e;this.pageId=t}do(e,t){return t(new K({pageId:this.pageId})),!0}check(e){return!!e.getPageById(this.pageId)}}var Z=i(54464);class Q extends g{constructor(e){super(e),this.type=n.Us.AddPageAction;const{position:t,dimension:i,layers:r,background:a,id:o}=e;this.position=t,this.dimension=i,this.layers=r,this.background=a,this.id=o}do(e,t){var i;const r=new Z.Z({dimension:this.dimension,background:this.background,isLocked:!1,id:this.id}),n=new J({page:r,position:this.position});return t(n),null===(i=this.layers)||void 0===i||i.forEach(((i,n)=>{y.getBuilder(i.type).build(e,{pageId:r.id,position:null!=n?n:r.layers.length,delta:i,canUndoRedo:!1},t)})),!0}check(e){return!(this.position<0)}}var ee,te=i(8325);!function(e){e[e.width=0]="width",e[e.height=1]="height"}(ee||(ee={}));const ie=(e,t)=>{const i=e.width/e.height;return t.width/t.height<i?t.width/i/e.height:t.height*i/e.width};class re extends k{updateBackgroundColor(e,t,i=!1){if(!this.document.getPageById(e))return!1;const r={background:{color:t,...i?{image:void 0}:void 0}};return this.behavior.applyLocal({action:new W({pageId:e,delta:r,canUndoRedo:!0})})}updateTitle(e,t){if(!this.document.getPageById(e))return!1;const i={title:t};return this.behavior.applyLocal({action:new W({pageId:e,delta:i,canUndoRedo:!0})})}setBackgroundImageWithResource(e,t,i){const r=this.document.getPageById(e);if(!r)return!1;const a=[],o=r.background.image;if(o){const t=new W({pageId:e,delta:{background:{image:void 0}},canUndoRedo:!0});a.push(t)}const l=null==o?void 0:o.effectFilters,c=null==o?void 0:o.filter,d={id:(0,s.L)(),type:n.F5.IMAGE,layout:i,visibility:!0,isLocked:!1,src:t,effectFilters:l,filter:c,aiTool:void 0},u=new W({pageId:e,delta:{background:{image:d}},canUndoRedo:!0});return a.push(u),this.behavior.applyLocal({action:new R({actions:a,canUndoRedo:!0})})}setBackgroundImageWithLayer(e,t,i){const r=this.document.getPageById(e);if(!r)return!1;const a=this.document.getLayerById(t);if(!a||![n.F5.IMAGE,n.F5.IMAGE_CONTAINER].includes(a.type))return!1;const o=[];if(r.background.image){const t=new W({pageId:e,delta:{background:{...r.background,image:void 0}},canUndoRedo:!0});o.push(t)}const s=(0,z.Sw)(a);s.layout={...s.layout,...i};const l={background:{...r.background,image:s}},c=new W({pageId:e,delta:l,canUndoRedo:!0});return o.push(c),this.behavior.applyLocal({action:new R({actions:o,canUndoRedo:!0})})}updateBackgroundImageLayout(e,t){const i=this.document.getPageById(e);if(!i)return!1;const r=i.background.image;if(!r||r.type!==n.F5.IMAGE)return!1;const a={background:{image:{layout:{...r.layout,...t}}}};return this.behavior.applyLocal({action:new W({pageId:e,delta:a,canUndoRedo:!0})})}removeBackgroundImage(e){if(!this.document.getPageById(e))return!1;const t={background:{image:void 0}};return this.behavior.applyLocal({action:new W({pageId:e,delta:t,canUndoRedo:!0})})}updateDimension(e,t){const i=this._buildUpdateDimensionAction(e,t);return!!i&&this._apply([i])}autoLayout(e,t){const i=this.document.pages.find((t=>t.id===e));if(!i)return!1;const r=(0,V.Ln)(i.dimension),n=(0,V.Ln)(t),a=ie(r,n),o={x:(n.width-r.width*a)/2,y:(n.height-r.height*a)/2};return this._applyAutoLayout(e,t,a,o)}autoLayoutForBoundingBox(e,t){const i=this.document.pages.find((t=>t.id===e));if(!i)return!1;const r=this._getPageLayersRectList(i),n=(0,v.aR)(...r),a=(0,V.Ln)(i.dimension),o=(0,V.Ln)(t),{scale:s,xyOffset:l}=((e,t,i)=>{const r=i.x,n=e.width-(i.x+i.width),a=i.y,o=e.height-(i.y+i.height),s=.01,l=e.width*s,c=Boolean(r<l),d=Boolean(n<l),u=Boolean(a<l),h=Boolean(o<l),p=!(c&&d&&u&&h);let f=i.width,y=i.height,g=r,m=a;i.width-i.x>e.width&&(f=e.width,g=0),i.height-i.y>e.height&&(y=e.height,m=0);let _=0,v=0;p&&(_=t.width*s,v=t.height*s);const I=f+2*_,T=y+2*v,w=ie({width:I,height:T,unit:e.unit},t);return{xyOffset:{x:(t.width-I*w)/2-g*w+_*w,y:(t.height-T*w)/2-m*w+v*w},scale:w}})(a,o,n);return this._applyAutoLayout(e,t,s,l)}getAutoLayoutResult(e,t,i=this.document){const r=X(i);return r.api.page.autoLayout(e,t),r.document.pages.find((t=>t.id===e))}add(e,t){const{dimension:i,background:r,layers:n=[],id:a}=t;if(this.behavior.applyLocal({action:new Q({position:e,dimension:i,background:r,layers:n,canUndoRedo:!0,id:a})})){const t=this.document.pages[e];return(0,N.oW)(t.id)}return(0,N.wf)(-1,"add page fail")}delete(e){const t=e.map((e=>new q({pageId:e,canUndoRedo:!0})));return this._apply(t)}copyPage(...e){if(e.length<=0)return!1;let t=Math.max(...e.map((e=>this.document.getPagePositionById(e))));const i=e.map((e=>{const i=this.document.getPageById(e);if(!i)return;t+=1;return new Q({position:t,dimension:i.dimension,background:i.background,layers:i.layers.map((e=>e.clone(!1))),canUndoRedo:!0})})).filter((e=>Boolean(e)));return this._apply(i)}move(e,t){const i=e.map((e=>new W({pageId:e,position:t,canUndoRedo:!0})));return this._apply(i)}getPageLayersByFilter(e,t,i){var r,n;return null!==(r=null===(n=this.document.getPageById(e))||void 0===n?void 0:n.getLayersByFilter(t,i))&&void 0!==r?r:[]}getPageById(e){return this.document.getPageById(e)}getPageMainImage(e){const t=this.document.getPageById(e);if(t)return t.layers.find((e=>(0,te.Pz)(e)))}removeBgImageEffectFilters(e,t){const i=this._getBackgroundImageLayer(e);if(!i)return!1;const r=(i.effectFilters?[...i.effectFilters]:[]).filter((e=>!t.includes(e.resourceId)));return this.updateBgImageEffectFilters(e,r)}updateBgImageEffectFilters(e,t){var i;const r=this._getBackgroundImageLayer(e);if(!r)return!1;const n=[...t];return null===(i=r.effectFilters)||void 0===i||i.forEach(((e,t)=>{const i=n[t];i&&Object.keys(e.params).forEach((e=>{e in i.params||Object.assign(i.params,{[e]:void 0})}))})),this.behavior.applyLocal({action:new W({pageId:e,delta:{background:{image:{effectFilters:n}}},canUndoRedo:!0})})}applyBgImageAiTool(e,t){var i,r;const n=this._getBackgroundImageLayer(e);if(!n)return!1;const a=(0,D.R5)(null!==(i=null===(r=n.aiTool)||void 0===r?void 0:r.pipelines)&&void 0!==i?i:[],(e=>(0,F.B)(e.toolType,t.toolType))),o={aiTool:{...n.aiTool,pipelines:[t,...a]}},s=this._buildClearAiToolAction(e),l=new W({pageId:e,delta:{background:{image:o}},canUndoRedo:!0});return this._apply([s,l])}resetBgImageAiTool(e,t){var i,r;const n=this._getBackgroundImageLayer(e);if(!n)return!1;const a=(0,D.R5)(null!==(i=null===(r=n.aiTool)||void 0===r?void 0:r.pipelines)&&void 0!==i?i:[],(e=>(0,F.B)(e.toolType,t))),o={aiTool:{...n.aiTool,pipelines:a}},s=this._buildClearAiToolAction(e),l=new W({pageId:e,delta:{background:{image:o}},canUndoRedo:!0});return this._apply([s,l])}updateBgImageCutout(e,t,i,r){const n=this._getBackgroundImageLayer(e);if(!n)return!1;const a=(0,F.OM)(n.aiTool,t,i,r),o=this._buildClearAiToolAction(e),s=this._buildUpdatePostProcessEffectsStatusAction(e,t);if(!s)return!1;const l=new W({pageId:e,delta:{background:{image:{aiTool:a}}},canUndoRedo:!0});return this._apply([o,s,l])}updateBgImageCutoutBackground(e,t,i){const r=this._getBackgroundImageLayer(e);if(!r)return!1;const n=(0,F.yd)(r.aiTool,t,i),a=this._buildClearAiToolAction(e),o=this._buildUpdatePostProcessEffectsStatusAction(e,!t);if(!o)return!1;const s=new W({pageId:e,delta:{background:{image:{aiTool:n}}},canUndoRedo:!0});return this._apply([a,o,s])}updateBgImageEditParam(e,t,i){return!!this._getBackgroundImageLayer(e)&&this._apply([new W({pageId:e,delta:{background:{image:{filter:{[t]:i}}}},canUndoRedo:!0})])}bgImageFlipHorizontal(e){const t=this._getBackgroundImageLayer(e);if(!t)return!1;const i=new W({pageId:e,delta:{background:{image:{isFlipHorizontal:!t.isFlipHorizontal}}},canUndoRedo:!0});return this._apply([i])}bgImageFlipVertical(e){const t=this._getBackgroundImageLayer(e);if(!t)return!1;const i=new W({pageId:e,delta:{background:{image:{isFlipVertical:!t.isFlipVertical}}},canUndoRedo:!0});return this._apply([i])}updateBgImageOpacity(e,t){if(!this._getBackgroundImageLayer(e))return!1;const i=new W({pageId:e,delta:{background:{image:{layout:{opacity:t}}}},canUndoRedo:!0});return this._apply([i])}updateBgImagePostProcessEffects(e,t){var i,r,n;const a=this._getBackgroundImageLayer(e);if(!a)return!1;const o=new W({pageId:e,delta:{background:{image:{postProcessEffects:[]}}},canUndoRedo:!0}),s=new W({pageId:e,delta:{background:{image:{postProcessEffects:null===(i=t.list)||void 0===i?void 0:i.map((e=>({...e}))),extra:{postProcessPreset:null!==(r=t.preset)&&void 0!==r?r:null===(n=a.extra)||void 0===n?void 0:n.postProcessPreset}}}},canUndoRedo:!0});return this._apply([o,s])}_buildClearAiToolAction(e){return new W({pageId:e,delta:{background:{image:{aiTool:void 0}}},canUndoRedo:!0})}_getBackgroundImageLayer(e){var t;const i=this.document.getPageById(e);if((null==i||null===(t=i.background)||void 0===t||null===(t=t.image)||void 0===t?void 0:t.type)===n.F5.IMAGE)return i.background.image}_buildUpdatePostProcessEffectsStatusAction(e,t){var i;const r=this._getBackgroundImageLayer(e);if(!r)return;const n=null===(i=r.postProcessEffects)||void 0===i?void 0:i.map((e=>({...e,enable:t})));return new W({pageId:e,delta:{background:{image:{postProcessEffects:n}}},canUndoRedo:!0})}_getPageLayersRectList(e){const t=[];return e.layers.forEach((e=>{const{x:i,y:r,scale:n,rotation:a,width:o,height:s}=e.layout;t.push({x:i,y:r,scale:n,rotation:a,width:o,height:s})})),t}_buildUpdateDimensionAction(e,t){const i=this.document.getPageById(e);if(!i)return;let r;if(i.background.image){const e={...i.background.image.layout},{width:n,height:a}=(0,V.Ln)(t);r={...i.background.image,layout:{...$.U.calImageLayoutToFillContainer({width:n,height:a},e)}}}const n={dimension:t,background:{...i.background,image:r}};return new W({pageId:e,delta:n,canUndoRedo:!0})}_applyAutoLayout(e,t,i,r){const n=this.document.pages.find((t=>t.id===e));if(!n)return!1;const a=[],o=this._buildUpdateDimensionAction(e,t);return!!o&&(a.push(o),n.layers.forEach((e=>{const{layout:t,id:n}=e,o={x:t.x*i+r.x,y:t.y*i+r.y,scale:{x:t.scale.x*i,y:t.scale.y*i}};a.push(new b({layerId:n,detail:{type:_.UPDATE_LAYER,delta:{layout:o}},canUndoRedo:!0}))})),this._apply(a))}}class ne extends k{add(e,t,i){const r=this.document.getPageById(e);if(!r)return(0,N.wf)(-1,"pageId invalid");const a={type:n.F5.SHAPE,...i,paths:t};return this.behavior.applyLocal({action:new m({pageId:e,delta:a,canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(r.layers,"id")):(0,N.wf)(-1,"add layer fail")}updateAttribute(e,t,i){if(!this.document.getLayerById(e))return!1;const{radius:r,...n}=t;return this._updateProperties({layerId:e,delta:{...i?{layout:i}:void 0,paths:[{...void 0!==r?{radius:r}:void 0,attr:{...n}}]}})}}const ae=i(57123).EY.effect;class oe extends k{add(e,t,i){const r=this.document.getPageById(e);if(!r)return(0,N.wf)(-1,"pageId invalid");const{visibility:a=!0,isLocked:o=!1,layout:s,...l}=null!=i?i:{};return this.behavior.applyLocal({action:new m({pageId:e,delta:{type:n.F5.TEXT,layout:s,visibility:a,isLocked:o,text:t,...l},canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(r.layers,"id")):(0,N.wf)(-1,"add layer fail")}updateProperties(e,t,i=!0){return this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:t},canUndoRedo:!0})})}updateAlign(e,t){const i={left:n.PH.LEFT,center:n.PH.CENTER,right:n.PH.RIGHT,bottom:n.PH.TOP,top:n.PH.BOTTOM};return this._updateProperties({layerId:e,delta:{orientation:n.i5.PORTRAIT,align:i[t]}})}updateLineMaxWidth(e,t){return this._updateProperties({layerId:e,delta:{lineMaxWidth:t}})}updateUpperCase(e,t,i){return this._updateProperties({layerId:e,delta:{upperCase:t,...i?{layout:i}:void 0}})}updateLetterSpacing(e,t,i){return this._updateProperties({layerId:e,delta:{letterSpacing:t,...i?{layout:i}:void 0}})}updateLineSpacing(e,t,i){return this._updateProperties({layerId:e,delta:{lineSpacing:t,...i?{layout:i}:void 0}})}disableBackgroundColor(e){return this._updateProperties({layerId:e,delta:{background:{enable:!1}}})}updateBackgroundColor(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.TEXT||!Array.isArray(t)||4!==t.length)return!1;const o=null!==(i=null===(r=a.background)||void 0===r||null===(r=r.color)||void 0===r?void 0:r[3])&&void 0!==i?i:1,[s,l,c]=t,d=[s,l,c,o];return this._updateProperties({layerId:e,delta:{background:{type:n.Wv.COLOR,enable:!0,color:d}}})}updateBackgroundOpacity(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.TEXT)return!1;const[o,s,l]=null!==(i=null===(r=a.background)||void 0===r?void 0:r.color)&&void 0!==i?i:[0,0,0,1];return this._updateProperties({layerId:e,delta:{background:{color:[o,s,l,t]}}})}updateBackgroundCornerRadius(e,t){return this._updateProperties({layerId:e,delta:{background:{cornerRadius:t}}})}updateRichText(e,t){return this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{richText:JSON.stringify(t)}},canUndoRedo:!0})})}updateColor(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.TEXT)return!1;const r=ae.solidColor(t),a=JSON.parse(i.richText);return a.styles.forEach((e=>{e.fill={alpha:1,content:r}})),this.updateRichText(e,a)}updateShadowColor(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.TEXT)return!1;const r=ae.solidColor(t),a=JSON.parse(i.richText);return a.styles.forEach((e=>{var t;null===(t=e.shadows)||void 0===t||t.forEach((e=>{e.content=r}))})),this.updateRichText(e,a)}updateOutlineColor(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.TEXT)return!1;const r=ae.solidColor(t),a=JSON.parse(i.richText);return a.styles.forEach((e=>{var t;null===(t=e.strokes)||void 0===t||t.forEach((e=>{e.content=r}))})),this.updateRichText(e,a)}updateFontSize(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.TEXT)return!1;const r=JSON.parse(i.richText);return r.styles.forEach((e=>{e.size=t})),this.updateRichText(e,r)}updateFontFamily(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.TEXT)return!1;const r=JSON.parse(i.richText);return r.styles.forEach((e=>{e.font={id:t,path:""}})),this.updateRichText(e,r)}}function se(e,t){t&&(e.extra||(e.extra={}),e.extra.sourceInfo||(e.extra.sourceInfo={...t}))}class le extends k{add(e,t,i,r){if(!this.document.getPageById(e))return!1;const n=[],a=[];return t.forEach((t=>{const i=(0,s.L)(),o=t;se(o,r),a.push(i),n.push(new m({pageId:e,delta:{...o,id:i},canUndoRedo:!0}))})),n.length>1&&n.push(new S({layers:a,delta:{extra:{resourceId:i}},canUndoRedo:!0})),this._apply(n)}}class ce extends k{begin(e){return this.behavior.beginTransaction(e)}commit(){return this.behavior.endTransaction()}abort(){return this.behavior.abortTransaction()}}var de,ue=i(76815);!function(e){e.Replace="replace",e.Insert="insert"}(de||(de={}));class he extends g{constructor(e){super(e),this.type=n.Us.ApplyTemplateAction;const{pageId:t,layerDeltas:i,background:r,applyTemplateType:a,pagePosition:o}=e;this.pageId=t,this.layerDeltas=i,this.background=r,this.applyTemplateType=a,this.pagePosition=o}do(e,t){const i=e.getPageById(this.pageId);return t(new H({pageId:this.pageId,delta:{background:{color:ue.modelDefault.page.background.color,image:void 0}}})),this._generateClearPageMutations(i).forEach((e=>t(e))),t(new H({pageId:this.pageId,position:this.pagePosition,delta:{background:this.background}})),this.layerDeltas.forEach(((i,r)=>{y.getBuilder(i.type).build(e,{pageId:this.pageId,position:r,delta:i,canUndoRedo:this.canUndoRedo},t)})),!0}check(e){return!!e.getPageById(this.pageId)&&this.applyTemplateType!==de.Insert}_generateClearPageMutations(e){return e.layers.map((e=>e.id)).map((e=>new u({layerId:e})))}}var pe=i(90949);class fe extends k{applyTemplate(e,t,i){if(0===e.length)return!1;const r=e.map(((e,r)=>{const n=e.layers.map((e=>e.clone(!0)));let a,o;n.forEach((e=>{(0,pe.A)(e)?e.childrenDelta.forEach((e=>se(e,t))):se(e,t)})),i?(a=this.document.getPageById(i),a?o=this.document.getPagePositionById(a.id):(a=this.document.pages[0],o=0)):(a=this.document.pages[r],o=r);return new he({pageId:a.id,background:e.background,layerDeltas:n,canUndoRedo:!0,pagePosition:o,applyTemplateType:de.Replace})}));return this._apply(r)}}var ye=i(91372),ge=i(49824),me=i(7430);class _e extends g{constructor(e){super(e),this.type=n.Us.ResizePageAction;const{pageId:t,pageDelta:i,layerDiffs:r}=e;this.pageId=t,this.pageDelta=i,this.layerDiffs=r}do(e,t){t(new H({pageId:this.pageId,delta:this.pageDelta}));const i={};this.layerDiffs.forEach((({layerId:t,delta:r})=>{if(this._isLayoutPosChange(r)){const n=e.getLayerById(t).layout;i[t]={deltaX:r.layout.x?r.layout.x-n.x:0,deltaY:r.layout.y?r.layout.y-n.y:0}}}));for(const{layerId:r,delta:n}of this.layerDiffs){const a=e.getLayerById(r);let o=n;if(i[r]){const{x:e,y:t}=a.layout;o={...n,layout:{...n.layout,x:e+i[r].deltaX,y:t+i[r].deltaY}}}const s={layerId:r,detail:{type:_.UPDATE_LAYER,delta:o}};t(new T(s))}return!0}check(e){return!!e.getPageById(this.pageId)&&(!e.isPageInPreview(this.pageId)&&this.layerDiffs.every((t=>Boolean(e.getLayerById(t.layerId)))))}_isLayoutPosChange(e){var t,i;return void 0!==(null==e||null===(t=e.layout)||void 0===t?void 0:t.x)||void 0!==(null==e||null===(i=e.layout)||void 0===i?void 0:i.y)}}var ve=i(24191),Ie=i(50650);class Te extends k{constructor(e,t,i){super(e,t,i),this.applyHandlers=new Map,this._initApplyHandlers()}applyAutoColorDraft(e){return!(e.layers.length<=0)&&(this.api.transaction.begin(),e.layers.forEach((e=>{const{font:t,id:i,richText:r,layout:n,textOuterRect:a}=e;if(t){this.api.text.updateProperties(i,{fontDependResources:[t]}),r&&this.api.text.updateRichText(i,r),n&&this.api.text.updateLayout({layerId:i,layout:n}),a&&this.api.text.updateProperties(i,{extra:{textOuterRect:a}});const e=t.attributes,{upperCase:o}=null!=e?e:{};if("boolean"==typeof o&&r){this.api.text.updateUpperCase(i,o);const{text:e}=r;this.api.text.updateRichText(i,{...r,text:o?e.toLocaleUpperCase():e})}}this._applyAutoColor(e)})),this.api.transaction.commit())}applyAutoLayoutDraft(e){const{id:t,draftDiff:i,dimension:r}=e,a=this.document.pages.find((e=>e.id===t));if(!a)return!1;const o=[];for(const n of i.layers){const e=this._getAutoLayoutLayerDelta(n);if(!e)return!1;o.push(e)}let s,l;if(r?s={...r}:(s={...i.canvas,unit:n.fb.PX},a.dimension.unit===n.fb.CM&&(s.width=(0,V.$S)(s.width),s.height=(0,V.$S)(s.height),s.unit=n.fb.CM)),a.background.image){const e={...a.background.image.layout},{width:t,height:i}=(0,V.Ln)(s);l={...a.background.image,layout:{...$.U.calImageLayoutToFillContainer({width:t,height:i},e)}}}return this.behavior.applyLocal({action:new _e({pageId:a.id,pageDelta:{dimension:s,background:{...a.background,image:l}},layerDiffs:o,canUndoRedo:!0})})}getDraftUsedColor(e){const t=[],i=this.document.pages.find((t=>t.id===e));if(!i)return[];const r=this._getColorByLayer(i,!0);return t.push(...Object.values(r).filter(Boolean)),this.document.getLayersByFilter(!0,(e=>{if(e.type===n.F5.SVG_IMAGE){return e.colors.forEach((e=>{var i;return t.push(null!==(i=e.replace)&&void 0!==i?i:e.origin)})),!0}let i=this._getColorByLayer(e,!0);return!!i&&(e.type===n.F5.TEXT&&(i={...i,shadow:void 0,stroke:void 0,background:void 0}),Object.values(i).filter((e=>Boolean(e))).forEach((e=>{t.push(e)})),!0)})),t}getAutoColorByLayerId(e){let t;return this.document.getLayersByFilter(!0,((i,r)=>i.id===e&&(t=this._getAutoColorLayer(i,r),!0))),t}getAutoColorDraft(e){const t=[];this.document.getPageById(e).getLayersByFilter(!0,((e,i)=>(t.push(this._getAutoColorLayer(e,i)),!0)));const i=this.document.pages.find((t=>t.id===e)),{width:r,height:n}=(0,V.Ln)(i.dimension);return t.push({id:i.id,type:"page",layout:[0,0,r,n],colorability:!0,isMainImage:Boolean(i.background.image),color:this._getColorByLayer(i)}),{canvas:{width:r,height:n},layers:t}}getAutoLayoutDraft(e,t){const i=[],r=null!=t?t:this.document,n=r.pages.find((t=>t.id===e));null==n||n.getLayersByFilter(!0,((e,t)=>(i.push(this._getAutoLayoutLayer(e,t,r)),!0)));const{width:a,height:o}=(0,V.Ln)(n.dimension);return{canvas:{width:a,height:o},layers:i}}getAutoLayoutResult(e){const{id:t,document:i=this.document,draftDiff:r,dimension:n}=e,a=X(i);if(a.api.aigc.applyAutoLayoutDraft({id:t,draftDiff:r,dimension:n}))return a.document.pages.find((e=>e.id===t))}_getLayerEffect(e){if(e.type===n.F5.IMAGE){const s=e,l=[n.lJ.Sticker,n.lJ.YkSicker].includes(s.src.type),c=[n.lJ.Cutout].includes(s.src.type),d=[n.lJ.YkImage].includes(s.src.type),u={};if(l){var t;const e={panel:"sales-sticker",source:n.lJ.YkSicker===s.src.type?n.UI.HeyPan:n.UI.Loki,resourceId:null!==(t=s.src.resourceId)&&void 0!==t?t:void 0};u.effect=e}else if(c)u.templateFileUri=s.src.path;else if(d){var i,r,a;const e=(null===(i=s.src)||void 0===i?void 0:i.source)===n.iJ.TuChong?n.UI.TuChong:null===(r=s.src)||void 0===r?void 0:r.source;u.photo={source:e,resourceId:null===(a=s.src)||void 0===a?void 0:a.resourceId,panel:ve.hm.YkImage}}else{var o;u.assetMD5=s.src.md5||void 0,u.imageUrl=null!==(o=s.src.path)&&void 0!==o?o:void 0}return u}if(e.type===n.F5.IMAGE_CONTAINER){var s,l;const t=e,i=null!==(s=(0,ge.yP)(t)[0])&&void 0!==s?s:{};let r;return r=null!=i&&i.source?(null==i?void 0:i.source)===n.iJ.TuChong?n.UI.TuChong:null==i?void 0:i.source:void 0,{photo:{source:null!==(l=r)&&void 0!==l?l:void 0,resourceId:null!=i&&i.resourceId?null==i?void 0:i.resourceId:void 0,panel:ve.hm.YkImage},assetMD5:null!=i&&i.md5?null==i?void 0:i.md5:void 0,templateFileUri:null!=i&&i.path?null==i?void 0:i.path:void 0}}if(e.type===n.F5.GRID){var c,d;const t=e,i=null!==(c=(0,me.Ex)(t)[0])&&void 0!==c?c:{};let r;return r=null!=i&&i.source?(null==i?void 0:i.source)===n.iJ.TuChong?n.UI.TuChong:null==i?void 0:i.source:void 0,{photo:{source:null!==(d=r)&&void 0!==d?d:void 0,resourceId:null!=i&&i.resourceId?null==i?void 0:i.resourceId:void 0,panel:ve.hm.YkImage},assetMD5:null!=i&&i.md5?null==i?void 0:i.md5:void 0,templateFileUri:null!=i&&i.path?null==i?void 0:i.path:void 0}}return{effect:void 0,assetMD5:void 0,imageUrl:void 0}}_getLayerAbsoluteLayout(e,t){const i=t.getPageByChildLayerId(e.id);if(i.isFirstLevelLayerChild(e.id))return e.layout;const r={width:e.layout.width,height:e.layout.height,x:0,y:0},n=i.getLayerAccessRoad(e.id);for(let a=1;a<n.length;a++){const i=t.getLayerById(n[a]);if(!i)return e.layout;r.x+=i.layout.x,r.y+=i.layout.y}return r}_getAutoColorLayer(e,t,i=this.document){const r=this._getLayerAbsoluteLayout(e,i);return{id:e.id,type:e.type,...this._getLayerEffect(e),layout:[r.x+r.width/2,r.y+r.height/2,r.width,r.height],colorability:this._isLayerColorability(e),isMainImage:this._isLayerGeneratePalette(e),groupId:n.F5.GROUP_LAYER===t.type?t.id:void 0,color:this._getColorByLayer(e)}}_isLayerGeneratePalette(e){return!(e.type!==n.F5.IMAGE||!e.replaceable)||(!(e.type!==n.F5.IMAGE_CONTAINER||!(0,ge.av)(e))||!(e.type!==n.F5.GRID||!(0,me.av)(e)))}_isLayerColorability(e){if(e.isLocked)return!1;if(e.type===n.F5.SHAPE||e.type===n.F5.TEXT||e.type===n.F5.LINE)return!0;if(e.type===n.F5.IMAGE){const t=[n.lJ.Sticker,n.lJ.YkSicker,n.lJ.Cutout,n.lJ.Graffiti].includes(e.src.type),i=!e.replaceable;return!(!t||!i)}return!1}_getAutoLayoutLayer(e,t,i=this.document){const{x:r,y:a,width:o,height:s}=this._getLayerAbsoluteLayout(e,i),l=t.type===n.F5.GROUP_LAYER;return{id:e.id,type:e.type,...this._getLayerEffect(e),layout:[0,0,o,s],groupId:l?t.id:void 0,fontSize:e.type===n.F5.TEXT?(0,Ie.Of)(e):void 0,scale:l?[e.layout.scale.x*t.layout.scale.x,e.layout.scale.y*t.layout.scale.y]:[e.layout.scale.x,e.layout.scale.y],rotate:l?e.layout.rotation*t.layout.rotation:e.layout.rotation,alpha:e.layout.opacity,translate:[r+o*e.layout.scale.x/2,a+s*e.layout.scale.y/2]}}_initApplyHandlers(){this.applyHandlers=new Map,this.applyHandlers.set(n.F5.TEXT,this._getTextApplyHandler()),this.applyHandlers.set(n.F5.LINE,this._getLineApplyHandler()),this.applyHandlers.set(n.F5.SHAPE,this._getShapeApplyHandler()),this.applyHandlers.set(n.F5.PAGE,this._getPageApplyHandler()),this.applyHandlers.set(n.F5.IMAGE,this._getImageApplyHandler()),this.applyHandlers.set(n.F5.SVG_IMAGE,this._getSvgApplyHandler()),this.applyHandlers.set(n.F5.IMAGE_CONTAINER,this._getImageContainerApplyHandler())}_getImageContainerApplyHandler(){return{colorInfo:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.colorInfo)},do:e=>{e.color.colorInfo.forEach((({color:t,position:i})=>{this.api.imageContainer.fillContainerItemWithColor(e.id,i,t)}))}}}}_getSvgApplyHandler(){return{colorMap:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.colorMap)},do:e=>{e.color.colorMap.forEach((({origin:t,replace:i})=>{this.api.svgImage.updateFillColor(e.id,t,i)}))}}}}_getTextApplyHandler(){return{fill:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.fill)},do:e=>{this.api.text.updateColor(e.id,e.color.fill)}},shadow:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.shadow)},do:e=>{this.api.text.updateShadowColor(e.id,e.color.shadow)}},stroke:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.stroke)},do:e=>{this.api.text.updateOutlineColor(e.id,e.color.stroke)}},background:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.background)},do:e=>{this.api.text.updateBackgroundColor(e.id,e.color.background)}},glow:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.glow)},do:e=>{const t=e.color.glow;this.api.text.updateProperties(e.id,{glow:t})}}}}_getLineApplyHandler(){return{stroke:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.stroke)},do:e=>{this.api.line.updateAttribute(e.id,{stroke:e.color.stroke})}}}}_getImageApplyHandler(){return{fill:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.colorFilter)},do:e=>{var t,i,r,a;const{id:o,resourceId:s}=B.internalEffectResource.colorScheme,l=null!==(t=null===(i=this.document.getLayerById(e.id).effectFilters)||void 0===i?void 0:i.filter((e=>e.resourceId!==s)))&&void 0!==t?t:[],c=null===(r=e.color)||void 0===r?void 0:r.colorFilter,d=c?c.slice(0,3).map((e=>e/255)).concat([null!==(a=c[3])&&void 0!==a?a:1]):void 0;if(d){const e={type:n.Yl.EFFECT,resourceId:s,id:o,params:{Internal_Size:d[0],Internal_Number:d[1],Internal_Rotate:d[2],Internal_Alpha:d[3]}};l.unshift(e)}this.api.image.updateEffectFilters(e.id,l)}},image:{condition:e=>Boolean(e.imageUrl),do:e=>{this.api.image.removeEffectFilters(e.id,[B.internalEffectResource.colorScheme.resourceId]),this.api.image.updateReplacePalette(e.id,!0,e.imageUrl)}}}}_getShapeApplyHandler(){return{fill:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.fill)},do:e=>{this.api.shape.updateAttribute(e.id,{fill:e.color.fill})}},stroke:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.stroke)},do:e=>{this.api.shape.updateAttribute(e.id,{stroke:e.color.stroke})}}}}_getPageApplyHandler(){return{background:{condition:e=>{var t;return Boolean(null===(t=e.color)||void 0===t?void 0:t.background)},do:e=>{this.api.page.updateBackgroundColor(e.id,e.color.background)}}}}_applyAutoColor(e){const t=this.applyHandlers.get(e.type);if(!t)return;const i=Object.keys(t);for(const n of i){var r;null!==(r=t[n])&&void 0!==r&&r.condition(e)&&t[n].do(e)}}_getColorByLayer(e,t=!1){const i=e=>{const{solid:i,gradient:r}=(0,ye.tB)(e);let n=i;return!n&&r&&(n=r.stops[0].color),t&&r?r:n};if([n.F5.TEXT].includes(e.type))return(0,Ie.Pk)(e);if([n.F5.LINE].includes(e.type)){const t=e,{attr:r}=t;return{fill:i(r.stroke),shadow:void 0,stroke:i(r.stroke),background:void 0}}if([n.F5.SHAPE].includes(e.type)){var r;const t=null===(r=e.paths[0])||void 0===r?void 0:r.attr;return{fill:i(null==t?void 0:t.fill),shadow:void 0,stroke:0!==(null==t?void 0:t.strokeWidth)?i(null==t?void 0:t.stroke):void 0,background:void 0}}if(e.type===n.F5.PAGE){return{fill:i(e.background.color),shadow:void 0,stroke:void 0,background:void 0}}}_getAutoLayoutLayerDelta(e){var t,i;const{id:r}=e,a=this.document.getLayerById(r);if(!a)return;let o;const s=this.document.getLayerParentByLayerId(r),[l,c]=e.translate,[d,u]=e.scale,h=l-a.layout.width*d/2,p=c-a.layout.height*u/2;if(s){const{x:e,y:t}=this._getLayerAbsoluteLayout(s,this.document),{x:i,y:r}=s.layout.scale;o={layout:{x:h-e,y:p-t,scale:{x:d/i,y:u/r}}}}else o={layout:{x:h,y:p,scale:{x:d,y:u}}};if(a.type===n.F5.LINE&&null!==(t=o.layout)&&void 0!==t&&t.scale){const e=a,t=o.layout.scale.x*e.layout.width,i=o.layout.scale.x*e.attr.viewBox.width;o.attr={viewBox:{width:i}},o.layout.width=t,delete o.layout.scale}if(a.type===n.F5.GRID&&null!==(i=o.layout)&&void 0!==i&&i.scale){const e=a,{layout:t,spacing:i,radius:s,points:l,areas:c}=e,d=o.layout.scale.x*t.width,u=o.layout.scale.y*t.height;o.layout={...o.layout,width:d,height:u,scale:{x:1,y:1}};const h=$.U.calGridScaling({rect:{width:d,height:u,scale:{x:1,y:1}},oldRect:{width:t.width*t.scale.x,height:t.height*t.scale.y,scale:{x:1,y:1}},spacing:i,radius:s,points:l,areas:c});if(null==h||!h.items)return{layerId:r,delta:o};const p=h.items.map((e=>({id:e.id,fillLayout:e.fillLayout}))),f=e.areas.map((e=>{const t=p.find((t=>t.id===e.id));if(t){if(!(e.fill.fillType===n.kl.IMAGE))return;return{fill:{image:{layout:t.fillLayout}}}}}));o={...o,...f?{areas:f}:void 0}}return{layerId:r,delta:o}}}class we extends k{add(e,t,i){const r=this.document.getPageById(e);if(!r)return(0,N.wf)(-1,"pageId invalid");const a={type:n.F5.GRID,...t,...i};return this.behavior.applyLocal({action:new m({pageId:e,delta:a,canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(r.layers,"id")):(0,N.wf)(-1,"add layer fail")}updateFillRadius(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.GRID)return!1;const r=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{radius:t}},canUndoRedo:!0});return this._apply([r])}updateSpacing(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.GRID)return!1;const a=this._buildUpdateChildLayoutDelta(r,i),o=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{spacing:t,...a?{areas:a}:void 0}},canUndoRedo:!0});return this._apply([o])}transformLayout(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.GRID)return!1;const a=this._buildUpdateChildLayoutDelta(r,i),o=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{layout:t,...a?{areas:a}:void 0}},canUndoRedo:!0});return this._apply([o])}updateGridFillWithLayerId(e,t,i,r){const a=this.document.getLayerById(i);if(!a||a.type!==n.F5.IMAGE)return!1;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.GRID)return!1;const s={...a.clone(!0),layout:{...r}},l=o.areas.map((e=>{if(e.id===t)return{fill:{fillType:n.kl.IMAGE,image:s}}})),c=new x({layerId:i,canUndoRedo:!0}),d=this._buildClearGridFillAction(e,t),u=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:l}},canUndoRedo:!0});return this._apply(d?[c,d,u]:[c,u])}updateGridFillWithImage(e,t,i,r){const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.GRID)return!1;const o=a.areas.map((e=>{if(e.id===t)return{fill:{fillType:n.kl.IMAGE,image:{id:(0,s.L)(),type:n.F5.IMAGE,layout:r,visibility:!0,isLocked:!1,src:i,aiTool:void 0}}}})),l=this._buildClearGridFillAction(e,t),c=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:o}},canUndoRedo:!0});return this._apply(l?[l,c]:[c])}clearGridFill(e,t){const i=this._buildClearGridFillAction(e,t);return!!i&&this._apply([i])}applyAiTool(e,t,i){var r,a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.GRID)return!1;const s=o.areas.find((e=>e.id===t));if(!s)return!1;const l=s.fill;if(l.fillType!==n.kl.IMAGE)return!1;const c=l.image,d=(0,D.R5)(null!==(r=null===(a=c.aiTool)||void 0===a?void 0:a.pipelines)&&void 0!==r?r:[],(e=>(0,F.B)(e.toolType,i.toolType))),u={fill:{image:{aiTool:{...c.aiTool,pipelines:[i,...d]}}}},h=o.areas.map((e=>{if(e.id===t)return u})),p=this._buildClearGridFillAiToolAction(e,t),f=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:h}},canUndoRedo:!0});return this._apply(p?[p,f]:[f])}resetAiTool(e,t,i){var r,a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.GRID)return!1;const s=o.areas.find((e=>e.id===t));if(!s)return!1;const l=s.fill;if(l.fillType!==n.kl.IMAGE)return!1;const c=null===(r=l.image)||void 0===r?void 0:r.aiTool,d=(0,D.R5)(null!==(a=null==c?void 0:c.pipelines)&&void 0!==a?a:[],(e=>(0,F.B)(e.toolType,i))),u={fill:{image:{aiTool:{...c,pipelines:d}}}},h=o.areas.map((e=>{if(e.id===t)return u})),p=this._buildClearGridFillAiToolAction(e,t),f=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:h}},canUndoRedo:!0});return this._apply(p?[p,f]:[f])}updateCutout(e,t,i,r,a){var o;const s=this.document.getLayerById(e);if(!s||s.type!==n.F5.GRID||t&&!r)return!1;const l=s.areas.find((e=>e.id===i));if(!l)return!1;const c=l.fill;if(c.fillType!==n.kl.IMAGE)return!1;const d=c.image,u={fill:{image:{aiTool:(0,F.OM)(null==d?void 0:d.aiTool,t,r,a),postProcessEffects:null==d||null===(o=d.postProcessEffects)||void 0===o?void 0:o.map((e=>({...e,enable:t})))}}},h=s.areas.map((e=>{if(e.id===i)return u})),p=this._buildClearGridFillAiToolAction(e,i),f=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:h}},canUndoRedo:!0});return this._apply(p?[p,f]:[f])}updateCutoutBackground(e,t,i,r){var a;const o=this.document.getLayerById(e);if(!o||o.type!==n.F5.GRID)return!1;const s=o.areas.find((e=>e.id===i));if(!s)return!1;const l=s.fill;if(l.fillType!==n.kl.IMAGE)return!1;const c=l.image,d={fill:{image:{aiTool:(0,F.yd)(null==c?void 0:c.aiTool,t,r),postProcessEffects:null==c||null===(a=c.postProcessEffects)||void 0===a?void 0:a.map((e=>({...e,enable:!t})))}}},u=o.areas.map((e=>{if(e.id===i)return d})),h=this._buildClearGridFillAiToolAction(e,i),p=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:u}},canUndoRedo:!0});return this._apply(h?[h,p]:[p])}updateFillImage(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.GRID)return!1;const a=r.areas.find((e=>e.id===t));if(!a)return!1;if(a.fill.fillType!==n.kl.IMAGE)return!1;const o={fill:{image:{...i.filter?{filter:i.filter}:void 0,...i.layout?{layout:i.layout}:void 0,...i.effectFilters?{effectFilters:i.effectFilters}:void 0,blendMode:i.blendMode,...i.postProcessEffects?{postProcessEffects:i.postProcessEffects}:void 0,...i.extra?{extra:i.extra}:void 0}}},s=r.areas.map((e=>{if(e.id===t)return o}));return this._updateProperties({layerId:e,delta:{areas:s}})}markMainImage(e,t){const i=this._buildChangeMainImageAction(e,t,!0);return!!i&&this._apply([i])}unmarkMainImage(e,t){const i=this._buildChangeMainImageAction(e,t,!1);return!!i&&this._apply([i])}_buildChangeMainImageAction(e,t,i){const r=this.document.getLayerById(e);if(!r||"number"!=typeof t)return;const a=r.areas.find((e=>e.id===t));if(!a)return;if(a.fill.fillType!==n.kl.IMAGE)return;const o=r.areas.map((e=>{if(e.id===t)return{fill:{image:{isMainImage:i}}}}));return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:o}},canUndoRedo:!0})}_buildClearGridFillAiToolAction(e,t){const i=this.document.getLayerById(e);if(!i||"number"!=typeof t)return;const r=i.areas.find((e=>e.id===t));if(!r)return;if(r.fill.fillType===n.kl.NONE)return;const a=i.areas.map((e=>{if(e.id===t)return{fill:{image:{aiTool:void 0}}}}));return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:a}},canUndoRedo:!0})}_buildClearGridFillAction(e,t){const i=this.document.getLayerById(e);if(!i||"number"!=typeof t)return;const r=i.areas.find((e=>e.id===t));if(!r)return;if(r.fill.fillType===n.kl.NONE)return;const a=i.areas.map((e=>{if(e.id===t)return{fill:{fillType:n.kl.NONE}}}));return new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{areas:a}},canUndoRedo:!0})}_buildUpdateChildLayoutDelta(e,t){return t.length>0?e.areas.map((e=>{const i=t.find((t=>t.id===e.id));if(i){if(!(e.fill.fillType===n.kl.IMAGE))return;return{fill:{image:{layout:i.fillLayout}}}}})):void 0}}class Ee extends k{add(e,t,i,r,a){var o,s,l;const c=this.document.getPageById(e);if(!c)return(0,N.wf)(-1,"pageId invalid");const d=null!==(o=r.clipRect)&&void 0!==o?o:{x:0,y:0,width:r.width,height:r.height};return this.behavior.applyLocal({action:new m({pageId:e,delta:{...a,type:n.F5.SVG_IMAGE,colors:i,layout:{...r,clipRect:d},visibility:null===(s=null==a?void 0:a.visibility)||void 0===s||s,isLocked:null!==(l=null==a?void 0:a.isLocked)&&void 0!==l&&l,title:null==a?void 0:a.title,src:t},canUndoRedo:!0})})?(0,N.oW)((0,D.$g)(c.layers,"id")):(0,N.wf)(-1,"add layer fail")}updateFillColor(e,t,i){const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.SVG_IMAGE)return!1;let a=!1;const o=r.colors.map((e=>{if((0,ye.go)(e.origin,t))return a=!0,{origin:t,replace:i}}));return!!a&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{colors:o}},canUndoRedo:!0})})}removeEffectFilters(e,t){const i=this.document.getLayerById(e);if(!i||i.type!==n.F5.SVG_IMAGE)return!1;const r=(i.effectFilters?[...i.effectFilters]:[]).filter((e=>!t.includes(e.resourceId)));return this.updateEffectFilters(e,r)}updateEffectFilters(e,t){var i;const r=this.document.getLayerById(e);if(!r||r.type!==n.F5.SVG_IMAGE)return!1;const a=[...t];return null===(i=r.effectFilters)||void 0===i||i.forEach(((e,t)=>{const i=a[t];i&&Object.keys(e.params).forEach((e=>{e in i.params||Object.assign(i.params,{[e]:void 0})}))})),this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{effectFilters:a}},canUndoRedo:!0})})}clearPostProcessEffects(e){const t=this.document.getLayerById(e);return!(!t||t.type!==n.F5.SVG_IMAGE)&&this.behavior.applyLocal({action:new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:[],extra:{postProcessPreset:void 0}}},canUndoRedo:!0})})}updatePostProcessEffects(e,t){var i,r;const a=this.document.getLayerById(e);if(!a||a.type!==n.F5.SVG_IMAGE)return!1;const o=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:[],extra:{postProcessPreset:void 0}}},canUndoRedo:!0}),s=null===(i=t.list)||void 0===i?void 0:i.map((e=>({...e}))),l=new b({layerId:e,detail:{type:_.UPDATE_LAYER,delta:{postProcessEffects:s,extra:{postProcessPreset:s.length?null!==(r=t.preset)&&void 0!==r?r:a.extra.postProcessPreset:void 0}}},canUndoRedo:!0});return this._apply([o,l])}}class xe extends k{canUndo(){return this.behavior.undoRedoStack.canUndo()}canRedo(){return this.behavior.undoRedoStack.canRedo()}undo(){return this.behavior.applyUndo()}redo(){return this.behavior.applyRedo()}beginNestUndoRedoStack(){return this.behavior.beginNestUndoRedoStack()}endNestUndoRedoStack(){return this.behavior.endNestUndoRedoStack()}abortNestUndoRedoStack(){return this.behavior.abortNestUndoRedoStack()}}class be{constructor(e,t){this.text=new oe(e,t,this),this.image=new U(e,t,this),this.svgImage=new Ee(e,t,this),this.group=new O(e,t,this),this.shape=new ne(e,t,this),this.common=new k(e,t,this),this.page=new re(e,t,this),this.document=new L(e,t,this),this.textTemplate=new le(e,t,this),this.line=new j(e,t,this),this.imageContainer=new G(e,t,this),this.transaction=new ce(e,t,this),this.aigc=new Te(e,t,this),this.template=new fe(e,t,this),this.grid=new we(e,t,this),this.undoRedo=new xe(e,t,this)}}class Re{applyCommand(e,t){t.mutations.forEach((t=>{this.applyMutation(e,t)}))}follow(e,t,i){return[]}applyMutation(e,t){t.check(e)&&t.runOnDocument(e)}}class ke{constructor(){this.maxStackSize=1/0,this.undoStack=[],this.redoStack=[]}undo(){if(!this.canUndo())return[];const e=this.popUndoItems();if(!e.length)return[];for(const t of e){const e=t.reverse();this.redoStack.push(e),t.execute(n.wI.UNDO)}return this.afterUndo(),e}redo(){if(!this.canRedo())return[];const e=this.popRedoItems();if(!e.length)return[];for(const t of e){const e=t.reverse();this.undoStack.push(e),t.execute(n.wI.REDO)}return this.afterRedo(),e}canUndo(){return this.undoStack.filter((e=>e.currentCommand.canUndoRedo)).length>0}canRedo(){return this.redoStack.filter((e=>e.invertCommand.canUndoRedo)).length>0}push(e){this.clearRedoStack(),this.undoStack.push(e),this.isItemOverflow()&&this.doWhenOverflow()}clearUndoStack(){this.undoStack.length=0}clearRedoStack(){this.redoStack.length=0}setMaxSize(e){this.maxStackSize=e}destroy(){this.clearRedoStack(),this.clearUndoStack()}popUndoItems(){return this.undoStack.splice(this.redoStack.length-1,1)}popRedoItems(){return this.redoStack.splice(this.redoStack.length-1,1)}isItemOverflow(){return this.maxStackSize!==1/0&&this.maxStackSize<=this.undoStack.length}doWhenOverflow(){this.undoStack.shift()}afterUndo(){}afterRedo(){}}class Ae{constructor(e,t,i,r){this.currentCommand=e,this.invertCommand=t,this.executeCallback=i,this.operateId=r}reverse(){const{invertCommand:e,currentCommand:t}=this;return new Ae(e,t,this.executeCallback,this.operateId)}execute(e){this.executeCallback({...this.invertCommand,commandType:e})}}class Pe extends ke{popUndoItems(){const e=this._findFirstCanUndoItem();if(-1===e)return[];const t=this.undoStack[e];return t.operateId?this._popSameOperateItemsFromUndoStack(t.operateId):this.undoStack.splice(e,1)}popRedoItems(){const e=this._findFirstCanRedoItem();if(-1===e)return[];const t=this.redoStack[e];return t.operateId?this._popSameOperateItemsFromRedoStack(t.operateId):this.redoStack.splice(e,1)}_findFirstCanUndoItem(){for(let e=this.undoStack.length-1;e>=0;e--){if(this.undoStack[e].currentCommand.canUndoRedo)return e}return-1}_findFirstCanRedoItem(){for(let e=this.redoStack.length-1;e>=0;e--){if(this.redoStack[e].currentCommand.canUndoRedo)return e}return-1}_popSameOperateItemsFromUndoStack(e){const t=this.undoStack.filter((t=>t.operateId===e)).reverse();return this.undoStack=this.undoStack.filter((t=>t.operateId!==e)),t}_popSameOperateItemsFromRedoStack(e){const t=this.redoStack.filter((t=>t.operateId===e)).reverse();return this.redoStack=this.redoStack.filter((t=>t.operateId!==e)),t}}var Me=i(84020),Le=i(30185);function Se(e,t,i){const r=(0,s.L)(),n=function(e){if(0===e.length)return(0,N.wf)(-1,"undoRedoItems must has at less one item!");const t=(0,Le.I)(e[0]);return t.currentCommand.mutations=e.map((e=>e.currentCommand.mutations)).flat(),t.invertCommand.mutations=e.reverse().map((e=>e.invertCommand.mutations)).flat(),(0,N.oW)(t)}(e);if(!n.ok)return n;const{currentCommand:a,invertCommand:o}=n.pair()[1];Object.assign(a,{actionId:r,canUndoRedo:t}),Object.assign(o,{actionId:r,canUndoRedo:t});const l=new Ae(a,o,i);return(0,N.oW)(l)}class Ce{constructor(){this.undoRedoStack=new Pe,this._isOpened=!1,this._hasError=!1,this._canUndoRedo=!0}get isOpened(){return this._isOpened}get hasError(){return this._hasError}get canUndoRedo(){return this._canUndoRedo}get operateId(){return this._operateId}markError(){this._hasError=!0}begin(e){var t;if(this.isOpened)throw Error("transaction is already opened, don't open again");this._canUndoRedo=null===(t=null==e?void 0:e.canUndoRedo)||void 0===t||t,this._operateId=null==e?void 0:e.operateId,this._isOpened=!0,this._check=setTimeout((()=>{if(this._isOpened)throw this._isOpened=!1,new Error("transaction is opened, but not call commit!")}),0)}commit(e){if(this._clearCheck(),this.hasError)for(;this.undoRedoStack.canUndo();)this.undoRedoStack.undo();const t=Se(this.undoRedoStack.undoStack,this.canUndoRedo,(()=>{throw new Error("this stub function is unexpected execute")}));let i=!1;return t.ok&&(i=e(t.pair()[1])),this.undoRedoStack.clearUndoStack(),this.undoRedoStack.clearRedoStack(),this._isOpened=!1,this._hasError=!1,i}abort(){return this._isOpened=!1,this._clearCheck(),!0}_clearCheck(){this._check&&(clearTimeout(this._check),this._check=void 0)}}var Oe=i(37722);class Fe extends Oe.C{constructor(){var e,t;super(),this.eventName="after-mutation-run-cost",this._eventCostRecords=[],this._lastReportTime=Date.now(),null===(e=i.g)||void 0===e||null===(t=e.addEventListener)||void 0===t||t.call(e,"unload",(()=>this.report()))}markEventFire(e){this._eventFireTime=Date.now(),this._actionType=e.actionType}markEventEnd(){if(!this._eventFireTime||this._eventFireTime<=0)return;const e=Date.now()-this._eventFireTime;this._eventCostRecords.push({actionType:this._actionType,cost:e}),this._eventFireTime=-1,this._tryToReport()}getEventParams(){const e=this._eventCostRecords.sort(((e,t)=>e.cost-t.cost)),t=e[e.length-1].actionType,i=e.map((e=>e.cost)),r=i.reduce(((e,t)=>e+t),0)/e.length,n=i.map((e=>Math.pow(e-r,2))).reduce(((e,t)=>e+t),0)/e.length;return{maxCost:e[e.length-1].cost,maxCostActionType:t,cost:e.map((e=>e.cost)).reduce(((e,t)=>e+t),0)/e.length,variance:n,eventCount:e.length}}isAllowReportToSlardar(){return!0}report(){this._eventCostRecords.length<=0||super.report()}_tryToReport(){Date.now()-this._lastReportTime<Fe.REPORT_DURATION||(this.report(),this._lastReportTime=Date.now(),this._eventCostRecords=[],this._eventFireTime=0)}}Fe.REPORT_DURATION=1e4;const Ne=new Fe;class De{constructor(e,t,i,r){this.transaction=new Ce,this.document=e,this.mutationApi=t,this.event=i,this.undoRedoStackManager=r}get undoRedoStack(){return this.undoRedoStackManager.getCurrentUndoRedoStack()}switchPreviewMode(e,t,i,r){const n=this.document.switchPreviewMode(e,t,i,r);return n&&this.event.emit(Me.B.MODEL_PREVIEW_STATUS_CHANGE,e),n}beginNestUndoRedoStack(){return this.undoRedoStackManager.beginNestUndoRedoStack()}endNestUndoRedoStack(){const e=this.undoRedoStackManager.endNestUndoRedoStack((e=>{this.mutationApi.applyCommand(this.document,e),this._fireAfterMutationRunEvent(e)}));return e.ok&&this.event.emit(Me.B.AFTER_NEST_UNDO_REDO_STACK_COMMITTED),e}abortNestUndoRedoStack(){return this.undoRedoStackManager.abortNestUndoRedoStack()}beginTransaction(e){this.transaction.begin(e)}endTransaction(){return this.transaction.commit((e=>{if(this.transaction.hasError)return this._fireAfterMutationRunEvent(e.currentCommand),!1;const t=new Ae(e.currentCommand,e.invertCommand,(e=>{this.mutationApi.applyCommand(this.document,e),this._fireAfterMutationRunEvent(e)}),this.transaction.operateId);return this.undoRedoStack.push(t),this._fireAfterMutationRunEvent(t.currentCommand),!0}))}abortTransaction(){return this.transaction.abort()}applyUndo(){const e=new Set,t=this.undoRedoStack.undoStack.slice(-1)[0];return t&&t.currentCommand.mutations.forEach((t=>{const i=t.getMutationSideEffect();"pageId"in i&&this.document.isPageInPreview(i.pageId)&&e.add(i.pageId)})),e.size?(Array.from(e).forEach((e=>{this.switchPreviewMode(!1,e)})),!0):Boolean(this.undoRedoStack.undo().length)}applyRedo(){const e=this.undoRedoStack.redoStack.slice(-1)[0];if(e){if(e.currentCommand.mutations.some((e=>{const t=e.getMutationSideEffect();return Boolean("pageId"in t&&this.document.isPageInPreview(t.pageId))})))return!1}return Boolean(this.undoRedoStack.redo().length)}applyInit(e){const{action:t}=e;if(!t.check(this.document))return!1;const i={...e,commandType:n.wI.INIT};return"success"===this._doAction({...i,canSave:!1}).status}applyLocal(e){const{action:t}=e;if(this.transaction.isOpened&&this.transaction.hasError)return!1;if(!t.check(this.document))return this.transaction.isOpened&&this.transaction.markError(),!1;const i={...e,commandType:n.wI.LOCAL,canSave:!this.undoRedoStackManager.isInNestStack()};return"success"===this._doAction(i).status}_doAction(e){const{action:t}=e,i={actionId:t.actionId,actionType:t.type,desc:"",isTransformed:!1,commandType:e.commandType,mutations:[],canUndoRedo:e.action.canUndoRedo,canSave:e.canSave},r={actionId:t.actionId,actionType:t.type,desc:"",isTransformed:!1,commandType:n.wI.UNDO,canUndoRedo:e.action.canUndoRedo,mutations:[],canSave:e.canSave};if(t.do(this.document,(e=>{i.mutations.push(e);const t=e.invert(this.document);r.mutations.unshift(...t),this.mutationApi.applyMutation(this.document,e)})),this.transaction.isOpened){const e=new Ae(i,r,(e=>{this.mutationApi.applyCommand(this.document,e)}));this.transaction.undoRedoStack.push(e)}else{const e=new Ae(i,r,(e=>{this.mutationApi.applyCommand(this.document,e),this._fireAfterMutationRunEvent(e)}));this.undoRedoStack.push(e),i.commandType!==n.wI.INIT&&this._fireAfterMutationRunEvent(i)}return{status:"success"}}_fireAfterMutationRunEvent(e){!function(e){Ne.markEventFire(e)}(e),this.event.emit(Me.B.AFTER_MUTATION_RUN,e),Ne.markEventEnd()}}var Ue=i(67393);class Be{constructor(e){this._mainUndoRedoStack=e}beginNestUndoRedoStack(){return this._nestUndoRedoStack?(0,N.wf)(-1,"unsupported begin nest stack in nest stack"):(this._nestUndoRedoStack=new Pe,(0,N.ly)())}endNestUndoRedoStack(e){var t;if(!this._nestUndoRedoStack)return(0,N.wf)(-1,"please begin nest undoRedoStack before end!");const i=Se(null===(t=this._nestUndoRedoStack)||void 0===t?void 0:t.undoStack,!0,e);return i.ok?(this._mainUndoRedoStack.push(i.pair()[1]),this._nestUndoRedoStack=void 0,(0,N.oW)(!0)):i}abortNestUndoRedoStack(){if(!this._nestUndoRedoStack)return(0,N.wf)(-1,"please begin nest undoRedoStack before abort!");for(;this._nestUndoRedoStack.canUndo();)this._nestUndoRedoStack.undo();return this._nestUndoRedoStack=void 0,(0,N.oW)(!0)}getCurrentUndoRedoStack(){var e;return null!==(e=this._nestUndoRedoStack)&&void 0!==e?e:this._mainUndoRedoStack}isInNestStack(){return Boolean(this._nestUndoRedoStack)}}class Ge{constructor(){this._modelInitFinish=!1,this.document=new M.Z,this.mutationBehavior=new Re,this.event=new o.Z;const e=new Pe;this.undoRedoStackManager=new Be(e),this.behavior=new De(this.document,this.mutationBehavior,this.event,this.undoRedoStackManager),this.api=new be(this.document,this.behavior)}get modelInitFinish(){return this._modelInitFinish}buildFromServerData(e,t){try{const i=Y.m.draftToModel(t.draftData,e,t.draftTitle);i.title=t.draftTitle,this.document.resetDocument(i),this._modelInitFinish=!0,r.fc.getInstance().initResourceFromServer(t.draftUsedEverAsserts,t.materials),this.event.emit(Me.B.MODEL_INIT_FINISH)}catch(i){throw a.t.error("graphic-sdk get draft data from server error!",i),i}}init(e){this.initLoader();const{isNewDraft:t=!0,dimension:i,scenario:r,useInCN:n,newDraftConfig:a}=e||{};if(n&&(this.document.meta.useInCN=n),t){r&&(this.document.meta.scenario=r);const e=this._buildAddPageAction(i,null!=a?a:{minPageCount:1});e&&this.behavior.applyInit({action:e}),this._modelInitFinish=!0,this.event.emit(Me.B.MODEL_INIT_FINISH)}}getDataExportConvertor(){return e=>JSON.stringify(Y.m.toDraftProto(e))}initLoader(){this.loaders={textTemplateLoader:Ue.g.getInstance()}}_buildAddPageAction(e,t){let i=0;const{minPageCount:r}=t;if(!r)return;const n=[];for(;i<r;)n.push(new Q({position:i,dimension:null!=e?e:ue.modelDefault.page.dimension,canUndoRedo:!1})),i+=1;return new R({actions:n,canUndoRedo:!1})}}},50788:(e,t,i)=>{"use strict";i.d(t,{Z:()=>g});var r=i(8757),n=i(81363),a=i(89816),o=i(69071),s=i(76815),l=i(20484);class c extends o.z{constructor(e){var t;super(e),this.type=r.F5.IMAGE;const{src:i,effectFilters:n}=e;this.src=i,this.effectFilters=null!=n?n:[],this.replaceable=null!==(t=e.replaceable)&&void 0!==t?t:s.modelDefault.layer.image.replaceable,this.aiTool=e.aiTool,this.replacePalette=e.replacePalette,this.postProcessEffects=e.postProcessEffects,this.isMainImage=e.isMainImage}clone(e){var t;return{...super.clone(e),src:this.src,aiTool:(0,l.Sw)(this.aiTool),replaceable:this.replaceable,effectFilters:(0,l.Sw)(this.effectFilters),replacePalette:this.replacePalette?{...this.replacePalette}:void 0,postProcessEffects:(0,l.Sw)(null!==(t=this.postProcessEffects)&&void 0!==t?t:[]),isMainImage:this.isMainImage}}}class d extends o.z{constructor(e){super(e),this.type=r.F5.LINE;const{source:t,attr:i,start:n,end:a}=e;this.source=t,this.attr=i,this.start=n,this.end=a}clone(e){return{...super.clone(e),source:this.source,attr:this.attr,start:this.start,end:this.end}}}class u extends o.z{constructor(e){super(e),this.type=r.F5.SHAPE;const{paths:t,effectFilters:i}=e;this.paths=null!=t?t:[],this.effectFilters=null!=i?i:[]}clone(e){return{...super.clone(e),paths:this.paths,effectFilters:this.effectFilters}}}class h extends o.z{constructor(e){super(e),this.type=r.F5.TEXT;const{ktv:t,orientation:i,align:n,background:a,letterSpacing:o,lineSpacing:l,innerPadding:c,lineMaxWidth:d,glow:u,curve:h,lineThrough:p,upperCase:f,richText:y,text:g,fallbackFontResources:m,fontDependResources:_}=e;this.text=g,this.richText=y,this.ktv=null!=t?t:void 0,this.orientation=null!=i?i:s.modelDefault.layer.text.orientation,this.align=null!=n?n:s.modelDefault.layer.text.align,this.letterSpacing=null!=o?o:s.modelDefault.layer.text.letterSpacing,this.lineSpacing=null!=l?l:s.modelDefault.layer.text.lineSpacing,this.innerPadding=null!=c?c:s.modelDefault.layer.text.innerPadding,this.lineMaxWidth=null!=d?d:-1,this.glow=null!=u?u:void 0,this.curve=null!=h?h:void 0,this.lineThrough=p,this.upperCase=f,this.background=null!=a?a:void 0,this.fallbackFontResources=m,this.fontDependResources=_,this.canClip=!1}clone(e){return{...super.clone(e),...(0,l.Sw)({text:this.text,richText:this.richText,ktv:this.ktv,orientation:this.orientation,align:this.align,background:this.background,letterSpacing:this.letterSpacing,lineSpacing:this.lineSpacing,innerPadding:this.innerPadding,lineMaxWidth:this.lineMaxWidth,glow:this.glow,curve:this.curve,lineThrough:this.lineThrough,upperCase:this.upperCase,boldWidth:this.boldWidth,italicDegree:this.italicDegree,fallbackFontResources:this.fallbackFontResources,fontDependResources:this.fontDependResources})}}}class p extends o.z{constructor(e){super(e),this.type=r.F5.GRID,this.fillCount=e.fillCount,this.points=e.points,this.areas=e.areas,this.spacing=e.spacing,this.radius=e.radius||0}clone(e){return{...super.clone(e),fillCount:this.fillCount,points:this.points,areas:(0,l.Sw)(this.areas),spacing:this.spacing,radius:this.radius}}}var f=i(42058);class y extends o.z{constructor(e){var t;super(e),this.type=r.F5.SVG_IMAGE;const{src:i,effectFilters:n}=e;this.src=i,this.colors=e.colors,this.effectFilters=null!=n?n:[],this.postProcessEffects=null!==(t=e.postProcessEffects)&&void 0!==t?t:[]}clone(e){var t;return{...super.clone(e),src:this.src,effectFilters:(0,l.Sw)(this.effectFilters),colors:(0,l.Sw)(this.colors),postProcessEffects:(0,l.Sw)(null!==(t=this.postProcessEffects)&&void 0!==t?t:[])}}}class g{static getInstance(){return new g}createLayer(e,t){switch(e){case r.F5.IMAGE:return new c(t);case r.F5.TEXT:return new h(t);case r.F5.GROUP_LAYER:const i=new n.i(t),{childrenDelta:o}=t,s=o.map((e=>this.createLayer(e.type,e)));return i.addLayers(s,{isNeedCalcChildLayout:!1,isNeedCalcWrapLayout:!1}),i;case r.F5.SHAPE:return new u(t);case r.F5.LINE:return new d(t);case r.F5.IMAGE_CONTAINER:return new a.Z(t);case r.F5.GRID:return new p(t);case r.F5.SVG_IMAGE:return new y(t);case r.F5.PAGE:(0,f.ss)();default:(0,f.bP)(e,`not support LayerType ${e}`)}}cloneLayer(e){return e.clone(!1)}}},76815:(e,t,i)=>{"use strict";i.d(t,{l:()=>s,modelDefault:()=>o});var r=i(27191),n=i(8757),a=i(60110);const o={document:{meta:{version:r.n,packageId:"0",scenario:"custom",useInCN:!1},title:"Untitled image",guidLine:{isLocked:!1,lines:[]}},page:{dimension:{width:1080,height:1080,unit:n.fb.PX},title:"Untitled page",background:{color:a.GL}},layer:{common:{layout:{opacity:1,scale:{x:1,y:1},translate:{x:0,y:0,z:0},rotation:0,layoutRect:{x:0,y:0,width:100,height:100}},title:{default:"Untitled layer"}},text:{orientation:n.i5.PORTRAIT,align:n.PH.CENTER,innerPadding:.1,lineSpacing:0,letterSpacing:0,fontSize:12},image:{replaceable:!0}}},s={instagram_post:{width:1080,height:1920,unit:n.fb.PX},instagram_story:{width:1080,height:1920,unit:n.fb.PX},facebook_post:{width:940,height:788,unit:n.fb.PX},facebook_cover:{width:1640,height:924,unit:n.fb.PX},youtube_thumbnail:{width:1280,height:720,unit:n.fb.PX},youtube_intro:{width:1920,height:1080,unit:n.fb.PX},twitter_post:{width:1600,height:900,unit:n.fb.PX}}},12238:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var r=i(76815),n=i(81363),a=i(54464);class o{constructor(){this._previewPageMap=new Map,this.isPageInPreview=e=>{var t;return Boolean(null===(t=this._previewPageMap.get(e))||void 0===t?void 0:t.preview)},this.meta={version:r.modelDefault.document.meta.version,draftId:r.modelDefault.document.meta.packageId,scenario:r.modelDefault.document.meta.scenario,useInCN:r.modelDefault.document.meta.useInCN},this._pages=[],this.title=r.modelDefault.document.title,this.guideLine=r.modelDefault.document.guidLine}get pageCount(){return this.pages.length}get pages(){return this._pages.map((e=>{const t=this._previewPageMap.get(e.id);return null!=t&&t.preview?t.page:e}))}set pages(e){this._pages=e}switchPreviewMode(e,t,i,n){var o;const s=null!==(o=this._pages.find((e=>e.id===t)))&&void 0!==o?o:this._pages[0],l=this._previewPageMap.get(s.id);if(!e){var c;if(l)null===(c=l.cancel)||void 0===c||c.call(l),this._previewPageMap.delete(s.id);return!0}var d;e===(null==l?void 0:l.preview)&&(null===(d=l.cancel)||void 0===d||d.call(l));return this._previewPageMap.set(s.id,{page:new a.Z({dimension:s.dimension,background:{...s.background,previewUrl:i,color:r.modelDefault.page.background.color},isLocked:!0,id:t}),cancel:n,preview:!0}),!0}getPageById(e){for(const t of this.pages)if(t.id===e)return t}getPagePositionById(e){return this.pages.findIndex((t=>t.id===e))}getPageByChildLayerId(e){for(const t of this.pages){if(t.getLayerById(e))return t}}getLayerParentByLayerId(e){for(const t of this.pages){const i=t.getParentLayerByLayerId(e);if(i)return i}}addPage(e,t){this._pages.splice(t,0,e)}removePageById(e){this.isPageInPreview(e)&&this.switchPreviewMode(!1,e),this._pages=this._pages.filter((t=>t.id!==e))}addLayer(e,t,i){const r=this.getPageById(e);return!!r&&r.addLayer(t,i)}getLayerById(e){for(const t of this.pages){const i=t.getLayerById(e);if(i)return i}}getLayerPosition(e,t){return e.getLayerPositionById(t)}getLayerIdsByFilter(e=!0,t){const i=[];for(const r of this.pages)i.push(...this._collectLayers(e,r.layers,r,t));return i.map((e=>e.id))}getLayersByFilter(e=!0,t){const i=[];for(const r of this.pages)i.push(...this._collectLayers(e,r.layers,r,t));return i}resetDocument(e){this._pages=e.pages,this.title=e.title,this.meta=e.meta,this.guideLine=e.guideLine,this.pipeline=e.pipeline}updateDocumentMeta(e){this.meta={...this.meta,...e}}_collectLayers(e,t,i,r){const a=[];for(const o of t)if(r(o,i)&&a.push(o),e&&o instanceof n.i){const t=o.children;a.push(...this._collectLayers(e,t,o,r))}return a}}},84020:(e,t,i)=>{"use strict";var r;i.d(t,{B:()=>r}),function(e){e.AFTER_MUTATION_RUN="AFTER_MUTATION_RUN",e.MODEL_INIT_FINISH="MODEL_INIT_FINISH",e.MODEL_PREVIEW_STATUS_CHANGE="MODEL_PREVIEW_STATUS_CHANGE",e.AFTER_NEST_UNDO_REDO_STACK_COMMITTED="AFTER_NEST_UNDO_REDO_STACK_COMMITTED"}(r||(r={}))},81363:(e,t,i)=>{"use strict";i.d(t,{i:()=>s});var r=i(8757),n=i(76815),a=i(41684),o=i(69071);class s extends o.z{constructor(e){super(e),this.type=r.F5.GROUP_LAYER;const{effectFilters:t}=e;this.effectFilters=t,this.children=[]}addLayers(e,t){if(null==t||!t.isNeedCalcChildLayout)return this.children.push(...e),this;let i;if(null!=t&&t.isNeedCalcWrapLayout){const t=(0,a.aR)(this.layout,...e.map((e=>e.layout))),r=n.modelDefault.layer.common.layout;i={...t,scale:r.scale,rotation:r.rotation,opacity:r.opacity}}else i=this.layout;for(const r of e){const{x:e,y:t,width:n,height:o,scale:s,rotation:l,opacity:c}=r.layout,d={x:s.x/i.scale.x,y:s.y/i.scale.y},u=(0,a.HP)({x:(e-i.x)/i.scale.x,y:(t-i.y)/i.scale.y,width:n*d.x,height:o*d.y},{x:0,y:0,width:i.width,height:i.height},(0,a.S3)(-i.rotation)),h={x:(e-i.x)/i.scale.x+u.x,y:(t-i.y)/i.scale.y+u.y};r.layout={...r.layout,...h,scale:d,rotation:l-i.rotation,opacity:0===i.opacity?c:c/i.opacity},this.children.push(r)}return this.layout={...this.layout,...i},this}removeLayer(...e){const t=[];for(const i of this.children)e.includes(i.id)||(t.push(i.id),i instanceof s&&i.removeLayer(...e));this.children=this.children.filter((e=>t.includes(e.id)))}updateLayerPosition(e,t){if(this._isInvalidPosition(t))return!1;const i=this.children.findIndex((t=>t.id===e));if(-1===i)return!1;if(i===t)return!0;const r=this.children.splice(i,1)[0];return this.children.splice(t,0,r),!0}getLayerById(e){for(const t of this.children){if(t.id===e)return t;if(t instanceof s)return t.getLayerById(e)}}getLayerAccessRoad(e){for(const t of this.children){if(t.id===e)return[this.id,t.id];if(t instanceof s){const i=t.getLayerAccessRoad(e);if(i.length>0)return[this.id,...i]}}return[]}getLayerPositionById(e){for(let t=0;t<this.children.length;t++){if(this.children[t].id===e)return t}}clone(e){return{...super.clone(e),effectFilters:this.effectFilters,childrenDelta:this.children.map((t=>t.clone(e)))}}getMergeBlackKeys(){return["children"]}_isInvalidPosition(e){return e<0||e>=this.children.length}}},89816:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var r=i(8757),n=i(69071);class a extends n.z{constructor(e){super(e),this.type=r.F5.IMAGE_CONTAINER;const{items:t}=e;this.items=t}clone(e){return{...super.clone(e),items:this.items}}}},69071:(e,t,i)=>{"use strict";i.d(t,{z:()=>o});var r=i(87606),n=i(76815),a=i(16052);class o{constructor(e){const{id:t,layout:i,visibility:r,isLocked:a,canClip:o,title:s,blendMode:l,filter:c,extra:d={},isFlipHorizontal:u,isFlipVertical:h}=e;this.id=t;const{layoutRect:p,opacity:f,scale:y,rotation:g,translate:m}=n.modelDefault.layer.common.layout;this.layout=Object.assign({},p,{opacity:f,scale:y,rotation:g,translate:m},i),this.visibility=null==r||r,this.isLocked=null!=a&&a,this.canClip=null==o||o,this.title=null!=s?s:"",this.blendMode=l,this.filter=c,this.extra=d,this.isFlipHorizontal=u,this.isFlipVertical=h}mergeDelta(e){const t=Object.keys(e).filter((e=>!this.getMergeBlackKeys().includes(e)));for(const i of t)this[i]=(0,a.p)(this[i],e[i])}clone(e){return{type:this.type,id:e?this.id:(0,r.L)(),layout:JSON.parse(JSON.stringify(this.layout)),visibility:this.visibility,isLocked:this.isLocked,title:this.title,blendMode:this.blendMode,filter:this.filter&&JSON.parse(JSON.stringify(this.filter)),extra:JSON.parse(JSON.stringify(this.extra)),isFlipHorizontal:this.isFlipHorizontal,isFlipVertical:this.isFlipVertical}}getMergeBlackKeys(){return[]}}},54464:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var r=i(87606),n=i(8757),a=i(81363),o=i(16052),s=i(76815);class l{constructor(e){this.type=n.F5.PAGE;const{dimension:t,background:i,title:a,isLocked:o,id:l}=e;this.id=null!=l?l:(0,r.L)(),this.layers=[],this.dimension=t,this.background=null!=i?i:{color:s.modelDefault.page.background.color},this.title=null!=a?a:"",this.isLocked=null!=o&&o}addLayer(e,...t){return!(e<0||e>this.layers.length)&&(this.layers.splice(e,0,...t),!0)}removeLayer(...e){this.layers=this.layers.filter((t=>!e.includes(t.id)))}getLayerById(e){for(const t of this.layers){if(t.id===e)return t;if(t instanceof a.i){const i=t.getLayerById(e);if(i)return i}}}getParentLayerByLayerId(e){const t=this.getLayerAccessRoad(e);if(t.length){const e=t[t.length-2];return this.getLayerById(e)}}getLayerPositionById(e){for(let t=0;t<this.layers.length;t++){if(this.layers[t].id===e)return t}}updateLayerPosition(e,t){const i=this.getLayerAccessRoad(e);if(i.length>2){return this.getLayerById(i[i.length-2]).updateLayerPosition(e,t),!0}return this._updateLayerPositionInPage(e,t),!1}isFirstLevelLayerChild(e){for(const t of this.layers)if(t.id===e)return!0;return!1}getLayerAccessRoad(e){for(const t of this.layers){if(t.id===e)return[this.id,t.id];if(t instanceof a.i){const i=t.getLayerAccessRoad(e);if(i.length)return[this.id,...i]}}return[]}getLayerAndPositionById(e){for(let t=0;t<this.layers.length;t++){const i=this.layers[t];if(i.id===e)return{layer:i,position:t}}}getLayersByFilter(e=!0,t){const i=[];return i.push(...this._collectLayers(e,this.layers,this,t)),i}mergeDelta(e){const t=Object.keys(e);for(const i of t)this[i]=(0,o.p)(this[i],e[i])}_isInvalidPosition(e){return e<0||e>=this.layers.length}_collectLayers(e,t,i,r){const n=[];for(const o of t)if(r(o,i)&&n.push(o),e&&o instanceof a.i){const t=o.children;n.push(...this._collectLayers(e,t,o,r))}return n}_updateLayerPositionInPage(e,t){if(this._isInvalidPosition(t))return!1;const i=this.layers.findIndex((t=>t.id===e));if(-1===i)return!1;if(i===t)return!0;const r=this.layers.splice(i,1)[0];return this.layers.splice(t,0,r),!0}}},16052:(e,t,i)=>{"use strict";function r(e,t,i=!1){if(null!==t){if(null===e)return t;if(void 0!==t){if(void 0===e)return t;if("boolean"==typeof t||"number"==typeof t||"string"==typeof t)return null!=t?t:e;if(Array.isArray(t)){if(!Array.isArray(e))return t;if(void 0===e)return t;return t.map(((t,n)=>{const a=null==e?void 0:e[n];return void 0===t?a:r(a,t,i)}))}if("object"==typeof t){if(Array.isArray(e)||"object"!=typeof e)return t;const n=Object.keys(t).reduce(((e,i)=>(void 0===t[i]&&(e[i]=null),e[i]=t[i],e)),{}),a=i?Object.keys(e):Object.keys(t),o={};for(const t of a)o[t]=r(e[t],n[t],i);return Object.assign({},e,o)}throw new Error("unsupported value type "+typeof t)}}}i.d(t,{p:()=>r})},41684:(e,t,i)=>{"use strict";function r(e){return e*Math.PI/180}function n(e){const{x:t,y:i,width:n,height:a,rotation:o,scale:s}=e,l=n*s.x,c=a*s.y,d=t+l/2,u=i+c/2,h=r(o);return[{x:-l/2,y:-c/2},{x:l/2,y:-c/2},{x:-l/2,y:c/2},{x:l/2,y:c/2}].map((e=>({x:d+e.x*Math.cos(h)-e.y*Math.sin(h),y:u+e.x*Math.sin(h)+e.y*Math.cos(h)})))}function a(...e){let t=Number.MAX_VALUE,i=Number.MAX_VALUE,r=-Number.MAX_VALUE,a=-Number.MAX_VALUE;return e.forEach((e=>{const o=n(e),s=Math.min(...o.map((e=>e.x))),l=Math.max(...o.map((e=>e.x))),c=Math.min(...o.map((e=>e.y))),d=Math.max(...o.map((e=>e.y)));t=Math.min(s,t),i=Math.min(c,i),r=Math.max(l,r),a=Math.max(d,a)})),{x:t,y:i,width:r-t,height:a-i}}function o(e,t,i){return{x:t.x+(e.x-t.x)*Math.cos(i)-(e.y-t.y)*Math.sin(i),y:t.y+(e.x-t.x)*Math.sin(i)+(e.y-t.y)*Math.cos(i)}}function s(e,t,i){const r={x:e.x+e.width/2,y:e.y+e.height/2},n={x:t.x+t.width/2,y:t.y+t.height/2},{x:a,y:s}=o(r,n,i);return{x:a-r.x,y:s-r.y}}function l(e,...t){const i=e.rotation,s=o({x:e.x,y:e.y},{x:0,y:0},r(-i)),l=a(...t),c={x:l.x*e.scale.x+s.x,y:l.y*e.scale.y+s.y},d=o({x:c.x,y:c.y},{x:0,y:0},r(i)),u=n(e)[0],h=n({...e,width:l.width,height:l.height})[0],p=u.x-h.x,f=u.y-h.y;return{x:d.x+p,y:d.y+f,width:l.width,height:l.height,offset:{...l}}}i.d(t,{HP:()=>s,S3:()=>r,_E:()=>l,aR:()=>a})},17882:(e,t,i)=>{"use strict";i.d(t,{m:()=>V});var r=i(12238),n=i(54464),a=i(8757);class o{constructor(e){var t,i,r;this.width=null!==(t=e.width_v2)&&void 0!==t?t:e.width,this.height=null!==(i=e.height_v2)&&void 0!==i?i:e.height,this.unit=null!==(r=e.unit)&&void 0!==r?r:a.fb.PX}}class s{constructor(e){var t,i,r,n;this.width=null!==(t=e.width_v2)&&void 0!==t?t:e.width,this.height=null!==(i=e.height_v2)&&void 0!==i?i:e.height,this.nodeHeight=null!==(r=e.node_height_v2)&&void 0!==r?r:e.node_height,this.nodeWidth=null!==(n=e.node_width_v2)&&void 0!==n?n:e.node_width}}var l=i(71525),c=i(54273),d=i(35405),u=i(71848),h=i(85204),p=i(34939),f=i(43777),y=i(54643),g=i(91372),m=i(11577),_=i(40546);function v(e,t){var i;if(e.type===l.cq.GROUP)e.child.forEach((e=>v(e,t)));else{const{elements:i}=e;i.filter((e=>(0,_.T)(e))).forEach((e=>{var i;null===(i=(0,_.y)(e))||void 0===i||i.forEach((e=>v(e,t)))}))}const r=null===(i=t.layerExtras[e.id])||void 0===i?void 0:i.layer_flip;r&&(e.layout.scale=[e.layout.scale[0]*(r.isHorizonFlip?-1:1),e.layout.scale[1]*(r.isVerticalFlip?-1:1),e.layout.scale[2]])}function I(e,t){const i=c.Ar.restoreLayoutType(new c.Ar(e.layout),t,e.id);e.layout=c.Ar.toProto(i),"group"===e.type&&e.child.forEach((e=>{I(e,i)}))}function T(e){return{width_v2:e.dimension.width,height_v2:e.dimension.height,unit:e.dimension.unit}}class w{static toProto(e,t={layerExtras:{},pageExtras:{}}){var i;const r=function(e){const t=(0,y.Ln)(e.dimension);return{width_v2:t.width,height_v2:t.height,node_width_v2:t.width,node_height_v2:t.height}}(e),n=function(e){const t=(0,y.Ln)(e.dimension);return{x:0,y:0,width:t.width,height:t.height,type:c.ms.ASPECT_FIT,translate:[0,0,0],scale:[1,1,1],rotate:[0,0,0],anchor:[.5,.5]}}(e),{bg:a,bgImage:o}=function(e,t){var i;let{solid:r,gradient:n}=(0,g.tB)(e.background.color);r=null!==(i=r)&&void 0!==i?i:[255,255,255,1];const a={key:u.eN.Background,alpha:Math.floor(255*r[3]),aspect_ratio:1,size_type:1,blue:r[2],green:r[1],ratio:"background_1_1",red:r[0],gradient:n?(0,m.C)(n):void 0},o=(0,y.Ln)(e.dimension),s={type:l.cq.BASE,key:"base",id:(0,h.Ig)(),name:"background",visibility:!0,layout:{x:0,y:0,width:o.width,height:o.height,type:c.ms.SCALE_FILL,translate:[0,0,0],scale:[1,1,1],rotate:[0,0,0],anchor:[.5,.5]},blend_mode:0,elements:[a]};let d;if(e.background.image){const i=e.background.image;d=(0,l.kB)(i,{width:o.width,height:o.height},!0),(0,p.Xo)(i,d,t),d&&(I(d,{width:o.width,height:o.height}),v(d,t))}return{bg:s,bgImage:d}}(e,t),s=[];e.layers.forEach((e=>{const i=(0,l.T2)(e,n,t);i&&(s.push(i),c.Ar.registerProtoId(i.id,e.id))})),s.forEach((e=>{I(e,n)})),s.forEach((e=>{(0,f.H3)(e,r)})),s.forEach((e=>{v(e,t)})),o&&s.unshift(o),s.unshift(a);const d={type:l.cq.GROUP,key:"group",id:(0,h.Ig)(),name:null!==(i=e.title)&&void 0!==i?i:"page",visibility:!0,blend_mode:l.bt.NORMAL,layout:n,child:s};t.pageExtras[d.id]={layer_origin_id:e.id};return{canvas:T(e),design_size:r,layer_group:d}}constructor(e,t,i){this.version=e,this.canvas=new o(t.canvas),this.designSize=new s(t.design_size),this.rootLayerGroup=new d.e(t.layer_group,i)}toModel(e,t,i=[],r){var o;const s=null!=r?r:{width:this.canvas.width,height:this.canvas.height,unit:this.canvas.unit},l=this.rootLayerGroup.layout.width;(0,f._V)(this.rootLayerGroup),this.rootLayerGroup.toFixedLayoutType({width:this.designSize.nodeWidth,height:this.designSize.nodeHeight});const c=this.rootLayerGroup.layout.width/l,d=new n.Z({dimension:s,title:this.rootLayerGroup.name,isLocked:!1});null!=t&&t.pages[this.rootLayerGroup.id]&&(d.id=t.pages[this.rootLayerGroup.id].layer_origin_id);const u=this.rootLayerGroup.toModel(d,e,[],{parentLayout:{x:0,y:0,width:this.designSize.nodeWidth,height:this.designSize.nodeHeight},resourceCollector:i,layerExtras:null!==(o=null==t?void 0:t.layers)&&void 0!==o?o:{},dataVersion:this.version}),h=(0,y.Ln)(s),p=(0,y.Ln)(this.canvas),g=Math.max(h.height/p.height,h.width/p.width)/c;return d.layers=u.children.filter((e=>e.type!==a.F5.GROUP_LAYER||e.children.length>0)).map((e=>{return i=g,(t=e).layout={...t.layout,x:t.layout.x*i,y:t.layout.y*i,scale:{x:t.layout.scale.x*i,y:t.layout.scale.y*i}},t;var t,i})),d}}var E,x=i(58789),b=i(67986);!function(e){e.ANDROID="Android",e.IOS="iOS",e.BROWSER="browser"}(E||(E={}));class R{constructor(e){this.key=u.eN.PlayFunction,this.id=e.effect_id,this.resourceId=e.resource_id}}var k=i(76815);class A{constructor(e){this.layerId=e.layer_id,this.isOriginPictureLayer=e.is_picture_layer,this.isIntelligentCutout=e.intelligent_cutout,e.play_function&&(this.playFunc=new R(e.play_function))}}class P{constructor(e){this.imageIdentifier=e.image_identifier}}class M{constructor(e){this.index=e.index,this.imageDesc=new P(e.image_desc),this.templateLayerIdList=e.tpl_layer_id_list,this.renderLayerIdList=e.render_layer_id_list}}class L{constructor(e){var t,i,r,n,a,o,s;this.type="Header",this.contentType="template",this.platform=e.platform,this.appliedTemplate=e.applied_template,this.replaceableDescList=null===(t=e.replaceable_desc_list)||void 0===t?void 0:t.map((e=>new A(e))),this.userImageRecordList=null===(i=e.user_image_record_list)||void 0===i?void 0:i.map((e=>new M(e))),this.movableStickerLayers=e.movable_sticker_layers,this.scenario=null!==(r=e.scenario)&&void 0!==r?r:k.modelDefault.document.meta.scenario,this.useInCN=null!==(n=e.useInCN)&&void 0!==n?n:k.modelDefault.document.meta.useInCN,this.extra=null!==(a=e.extra)&&void 0!==a?a:{layers:null!==(o=e.layer_extras)&&void 0!==o?o:{},pages:{}},this.guideLine=null!==(s=e.guideLine)&&void 0!==s?s:k.modelDefault.document.guidLine}static toProto(e,t,i,r){return{type:"Header",content_type:"template",platform:E.BROWSER,scenario:t,extra:{pages:e.pageExtras,layers:e.layerExtras},useInCN:i,guideLine:r}}}var S,C=i(27191);!function(e){e[e.DRAFT_ACTION_FLAG=799]="DRAFT_ACTION_FLAG",e[e.DRAFT_COMPRESSED_ACTION_FLAG=975]="DRAFT_COMPRESSED_ACTION_FLAG"}(S||(S={}));class O{constructor(e){this.magicNumber=e.magicNumber;const{major:t,minor:i,patch:r}=e.version;this.version=`${t}.${i}.${r}`,this.flag=e.flag,this.header=new L(e.header),this.draftId=e.draft_id,this.draftTitle=e.draft_title,this.pipeline=e.pipeline;const n=[];e.template?n.push(new w(this.version,e.template)):e.templates.forEach((e=>{n.push(new w(this.version,e))})),this.templates=n}static toProto(e){const{draftId:t,scenario:i,useInCN:r}=e.meta,n={layerExtras:{},pageExtras:{}},a=e.pages.map((e=>w.toProto(e,n))),[o,s,l]=(0,x.f)(C.n);return{magicNumber:1e4*Math.random(),version:{major:Number(o),minor:Number(s),patch:Number(l)},flag:S.DRAFT_ACTION_FLAG,header:L.toProto(n,i,r,e.guideLine),templates:a,draft_id:t,draft_title:e.title,pipeline:e.pipeline}}}var F=i(10224);class N{}var D=i(50788);class U extends N{constructor(){super(...arguments),this._targetVersion="0.1.0"}doUpgrade(e){const{document:t}=e;return t.pages=t.pages.map((e=>(e.layers=e.layers.map((e=>this.doLayerUpgrade(e))),e))),!0}isNeedUpgrade(e){return(0,x.y)(e,this._targetVersion)<0}doLayerUpgrade(e){if(e.type!==a.F5.IMAGE_CONTAINER)return e;const t=e,i=F.U.transformImageContainerData(t);return D.Z.getInstance().createLayer(a.F5.IMAGE_CONTAINER,i)}}class B extends N{constructor(){super(...arguments),this._targetVersion="1.4.1"}doUpgrade(e){const{document:t}=e;return t.pages=t.pages.map((e=>(e.layers=e.layers.map((e=>this.doLayerUpgrade(e))),e))),!0}isNeedUpgrade(e){return(0,x.y)(e,this._targetVersion)<0}doLayerUpgrade(e){if(e.type!==a.F5.IMAGE_CONTAINER)return e;const t=e;return t.items=t.items.map((e=>{const{layout:i}=e;return e.layout={...i,x:i.x/t.layout.width,y:1-i.y/t.layout.height-e.layout.height/t.layout.height},e})),e}}var G=i(91363);const j=new(i.n(G)());class H extends N{constructor(){super(...arguments),this._targetVersion="1.4.2"}doUpgrade(e){const{document:t}=e;return t.pages=t.pages.map((e=>(e.layers=e.layers.map((e=>this.doLayerUpgrade(e))),e))),!0}isNeedUpgrade(e){return(0,x.y)(e,this._targetVersion)<0}doLayerUpgrade(e){if(e.type===a.F5.GROUP_LAYER)return e.children.forEach((e=>{this.doLayerUpgrade(e)})),e;if(e.type!==a.F5.TEXT)return e;const t=e,i=JSON.parse(t.richText);let r=0;const n=j.splitGraphemes(i.text);return i.styles.forEach((e=>{const[t,i]=e.range,a=n.slice(t,i+1).join("");e.range=[r,r+a.length],r+=a.length})),t.richText=JSON.stringify(i),e}}class W{constructor(){this._allUpgrader=[new U,new B,new H]}static getInstance(){return this._instance||(W._instance=new W),W._instance}registerDataUpgrader(e){this._allUpgrader.push(e)}doDataUpgrader(e){const{version:t}=e,i=this._allUpgrader.filter((e=>e.isNeedUpgrade(t)));if(i.length<=0)return!0;try{for(const t of i)t.doUpgrade(e);e.document.meta.version=C.n}catch(r){return b.t.error("dataUpgrade error",r),!1}return!0}}var z;!function(e){e.Template="template",e.Draft="draft"}(z||(z={}));class V{static draftToModel(e,t,i,n){const a=new r.Z;try{let r;r=e.header?new O(e):new O({magicNumber:1e3*Math.random(),header:{platform:E.BROWSER,type:"Header",content_type:"template"},version:{major:0,minor:0,patch:1},draft_id:t,draft_title:i,templates:[e],flag:S.DRAFT_ACTION_FLAG}),a.meta={version:r.version,draftId:r.draftId,scenario:r.header.scenario,useInCN:r.header.useInCN},a.title=r.draftTitle,a.guideLine=r.header.guideLine,a.pipeline=r.pipeline;const o=r.templates.map((e=>e.toModel(a,r.header.extra,n)));a.pages=o;if(!W.getInstance().doDataUpgrader({version:r.version,type:z.Draft,document:a,extra:{draftId:r.draftId}}))throw new Error(`draft execute data upgrade error, version: ${r.version}, draftId: ${r.draftId}`)}catch(o){throw b.t.error("hypic draft proto to model error",o,e),o}return a}static templateToModel({protoVersion:e,protoTemplate:t,dimensions:i,options:n,id:a,creator:o,getInitialExtra:s}){var l;const c=null!==(l=null==n?void 0:n.document)&&void 0!==l?l:new r.Z;let d;try{Array.isArray(t)||(t=[t]);const r=t.map(((t,r)=>{var a,o;const l=new w(e,t,{localImages:null!=n&&n.localImages?[...n.localImages]:[],replaceableImages:null!=n&&n.replaceableImages?[...n.replaceableImages]:[]}),d=null!==(a=null==s?void 0:s(t))&&void 0!==a?a:{layers:{},pages:{}};return{page:l.toModel(c,d,null!==(o=null==n?void 0:n.resourceCollector)&&void 0!==o?o:[],null==i?void 0:i[r]),layerExtras:d.layers}}));c.pages=r.map((e=>e.page));if(!W.getInstance().doDataUpgrader({version:(u=e,(0,x.y)(u,"1.3.3")<=0?"0.0.1":u),document:c,type:z.Template,extra:{id:a,creator:o}}))throw new Error(`template execute data upgrade error, version: ${e}`);return{document:c,pageLayerIdMap:r.map((e=>{const t={};return Object.keys(e.layerExtras).forEach((i=>{t[i]=e.layerExtras[i].layer_origin_id})),t}))}}catch(h){b.t.error("hypic template proto to model error",h,a,t),d=h}var u;return{document:c,error:d,pageLayerIdMap:[]}}static toDraftProto(e){return O.toProto(e)}static toTemplateProto(e,t){return w.toProto(e.pages[t])}}},40546:(e,t,i)=>{"use strict";i.d(t,{T:()=>a,y:()=>o});var r=i(8757),n=i(71848);function a(e){return[n.eN.ImageContainer,n.eN.Grid].includes(e.key)}function o(e){if(a(e))return e.key===n.eN.ImageContainer?e.data.paths.filter((e=>e.fill.fill_type===r.lm.IMAGE&&(e.fill.image||e.fill.originImage))).map((e=>{var t,i,r;return null!==(t=null===(i=e.fill.image)||void 0===i?void 0:i.layer)&&void 0!==t?t:null===(r=e.fill.originImage)||void 0===r?void 0:r.layer})).filter(Boolean):e.key===n.eN.Grid?e.areas.map((e=>e.fill.image)).filter(Boolean):void 0}},71848:(e,t,i)=>{"use strict";i.d(t,{eN:()=>r,qm:()=>s});var r,n=i(85952),a=i(8757);!function(e){e.Sticker="sticker",e.Cutout="cutout",e.DraftCutout="draft_cutout",e.YkSicker="yk_sticker",e.EverPhoto="everphoto",e.Graffiti="graffiti",e.Filter="filter",e.Edit="edit",e.Text="text",e.TextV2="text_v2",e.ImageEffect="image_effect",e.Background="background",e.Image="image",e.ImageCutout="image_cutout",e.Jigsaw="jigsaw",e.LocalAdj="local_adj",e.InLayerTransform="in_layer_transform",e.ImageEnhance="image_enhance",e.NightSceneEnhance="night_scene_enhance",e.Hdr="hdr",e.ReplaceableCutout="replaceable_cutout",e.Mask="mask",e.TextStyle="text_style",e.TextStyleV2="text_style_v2",e.TextStyleV3="text_style_v3",e.HSL="hsl",e.TextDict="text_dict",e.PlayFunction="play_function",e.ColorCurve="color_curve",e.Svg="svg",e.EffectResource="effect_resource",e.Default="default",e.ImageContainer="image_container",e.YkImage="yk_image",e.PostProcessEffect="post_process_effect",e.Grid="grid",e.SvgSticker="svg_sticker"}(r||(r={}));const o={IMAGE:[r.Sticker,r.Image,r.Cutout,r.DraftCutout,r.YkSicker,r.Graffiti,r.EverPhoto,r.ReplaceableCutout,r.YkImage],[a.F5.IMAGE_CONTAINER]:[r.ImageContainer],TEXT:[r.Text,r.TextV2],GROUP_LAYER:[r.TextStyle,r.TextStyleV2],BACKGROUND:[r.Background],[a.F5.GRID]:[r.Grid],[a.F5.SVG_IMAGE]:[r.SvgSticker]};function s(e){for(const[t,i]of Object.entries(o)){if(i.includes(e.key))return t;if(e.key===r.Svg){return e.svgType===n.n.LINE?a.F5.LINE:a.F5.SHAPE}}}},39551:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var r=i(71848),n=i(8757),a=i(39113);class o{constructor(e){var t;(this.key=r.eN.PostProcessEffect,this.type=e.type,this.effectId=e.effect_id,this.resourceId=e.resource_id,this.enable=e.enable,e.color)&&(this.color=[...e.color,null!==(t=e.opacity)&&void 0!==t?t:1]);this.blurIntensity=e.blurIntensity,this.scale=e.scale,this.distance=e.distance,this.angle=e.angle,this.intensity=e.intensity,this.glowIntensity=e.glowIntensity}static toProto(e){return{key:r.eN.PostProcessEffect,type:e.type,enable:e.enable,effect_id:e.effectId,resource_id:e.resourceId,...a.default.model.hypic.getPostProcessParams(e)}}static toLayerDelta(e){if(e.key!==r.eN.PostProcessEffect)return;const t=e,i=t.color?[...t.color.slice(0,3).map((e=>Math.floor(255*e))),t.color[3]]:void 0,{enable:a,resourceId:o,effectId:s}=t;switch(t.type){case"shadow":return{type:n.zI.SHADOW,enable:a,effectId:s,resourceId:o,color:i,blur:t.blurIntensity,size:t.scale,distance:t.distance,angle:t.angle};case"outline":return{type:n.zI.OUTLINE,enable:a,effectId:s,resourceId:o,color:i,size:t.intensity};case"glow":return{type:n.zI.GLOW,enable:a,effectId:s,resourceId:o,color:i,size:t.glowIntensity,blur:t.blurIntensity};case"feather":return{type:n.zI.FEATHER,enable:a,effectId:s,resourceId:o,size:t.intensity}}}}},85952:(e,t,i)=>{"use strict";i.d(t,{n:()=>r,t:()=>o});var r,n=i(71848),a=i(11577);!function(e){e.SHAPE="shape",e.LINE="line"}(r||(r={}));class o{constructor(e){this.key=n.eN.Svg,this.id=e.id,this.content=this._formatFillColor(e.content),this.alpha=e.alpha,this.svgType=e.svg_type,this.radius=e.radius,this.fixedAreas=e.fixedAreas,e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height}),e.fill_gradient&&(this.fillGradient=(0,a.Q)(e.fill_gradient)),e.stroke_gradient&&(this.strokeGradient=(0,a.Q)(e.stroke_gradient)),this.resourceId=e.resource_id}_formatFillColor(e){return e?e.replace(/fill="([a-fA-F0-9]{6})"/g,'fill="#$1"'):e}}},72513:(e,t,i)=>{"use strict";i.d(t,{G:()=>s});var r=i(8757),n=i(71848),a=i(55244),o=i(43825);class s{constructor(e){var t,i,o,l,c,d,u;(this.key=n.eN.Text,this.version=e.version,this.text=null!==(t=e.text_v2)&&void 0!==t?t:s.transformEscapedTextToPureText(e.text),e.font_resource_id)&&(this.font={id:null!==(c=e.font_id)&&void 0!==c?c:"",resourceId:e.font_resource_id,styleFontId:e.style_font_id,styleFontResourceId:e.style_font_resourceId,useEffectDefaultColor:e.use_effect_default_color,fallbackTextInfoList:(null!==(d=e.fallback_text_info_list)&&void 0!==d?d:[]).map((e=>({fontId:e.font_id,fontResourceId:e.font_resource_id})))});(this.fontSize=null!==(i=e.font_size_v2)&&void 0!==i?i:e.font_size,this.color=(0,a.NP)(e.text_color),this.upperCase=null!==(o=e.upper_case)&&void 0!==o&&o,this.shape={id:e.shape_id,resourceId:e.shape_resource_id},this.orientation=e.type_setting_kind,this.align=e.align_type,e.background&&e.background.type===r.Wv.COLOR&&(this.background={type:e.background.type,enable:!0,color:(0,a.NP)(e.background.color),cornerRadius:e.background.corner_radius}),this.letterSpacing=e.char_spacing,this.lineSpacing=e.line_gap,this.innerPadding=e.inner_padding,this.lineMaxWidth=null!==(l=e.line_max_width_v1)&&void 0!==l?l:e.line_max_width,this.scale=e.scale&&{x:e.scale[0],y:e.scale[1]},e.shadow)&&(this.shadow={enable:!0,color:(0,a.NP)(e.shadow_color),smoothing:e.shadow_smoothing,distance:e.shadow_distance,angle:null!==(u=e.shadow_angle_v2)&&void 0!==u?u:e.shadow_angle});e.underline&&(this.underline={width:e.underline_width,offset:e.underline_offset}),e.outline&&(this.outline={enable:!0,color:(0,a.NP)(e.outline_color),width:e.outline_width}),e.glow&&(this.glow={enable:!0,color:(0,a.NP)(e.glow_color),intensity:e.glow_intensity,range:e.glow_range,resourceId:e.glow_resource_id}),(e.text_bend&&void 0!==e.text_bend_intensity||void 0===e.text_bend&&0!==e.text_bend_intensity&&void 0!==e.text_bend_intensity)&&(this.curve={enable:!0,angle:e.text_bend_intensity}),e.ktv_color&&e.ktv_outline_color&&e.ktv_shadow_color&&(this.ktv={color:(0,a.NP)(e.ktv_color),outlineColor:(0,a.NP)(e.ktv_outline_color),shadowColor:(0,a.NP)(e.ktv_shadow_color)}),this.boldWidth=e.bold_width,this.italicDegree=e.italic_degree,e.compact_size&&(this.innerRect={width:e.compact_size[0],height:e.compact_size[1]}),e.extend_size&&(this.outerRect={width:e.extend_size[0],height:e.extend_size[1]})}static transformEscapedTextToPureText(e){if(!e)return"";let t="";for(let i=0;i<e.length;i++)if("\\"===e[i]){if(!(i+1<e.length))break;{const r=e[i+1];switch(r){case"n":t+="\n";break;case"t":t+="\t";break;case"r":t+="\r";break;case"/":t+="/";break;case"\\":t+="\\";break;case'"':t+='"';break;default:t+=e[i]+r}i++}}else t+=e[i];return t}static toProto(e){var t,i,r,s,l,c,d,u,h,p,f,y,g,m,_,v,I,T,w,E,x,b,R,k,A,P,M,L;const S=[e.layout.width*e.layout.scale.x,e.layout.height*e.layout.scale.y],C={upper_case:null!==(t=e.upperCase)&&void 0!==t&&t,compact_size:S,extend_size:e.extra.textOuterRect?[e.extra.textOuterRect.width*e.layout.scale.x,e.extra.textOuterRect.height*e.layout.scale.y]:S},O=-1===e.lineMaxWidth?-1:C.compact_size[0]/C.extend_size[0]/e.layout.scale.x,F={key:n.eN.Text,version:1,text_v2:null!==(i=e.text)&&void 0!==i?i:"",type_setting_kind:e.orientation,align_type:e.align,background:null!==(r=e.background)&&void 0!==r&&r.enable?{type:e.background.type,color:(0,a.ax)(e.background.color),corner_radius:e.background.cornerRadius,id:e.background.effectId,resource_id:e.background.resourceId,flip_horizontal:null===(s=e.background.flip)||void 0===s?void 0:s.horizontal,flip_vertical:null===(l=e.background.flip)||void 0===l?void 0:l.vertical}:void 0,shape_id:null===(c=e.shape)||void 0===c?void 0:c.id,shape_resource_id:null===(d=e.shape)||void 0===d?void 0:d.resourceId,char_spacing:e.letterSpacing,line_gap:e.lineSpacing,inner_padding:e.innerPadding,scale:[e.layout.scale.x,e.layout.scale.y],ktv_color:(0,a.ax)(null===(u=e.ktv)||void 0===u?void 0:u.color),ktv_outline_color:(0,a.ax)(null===(h=e.ktv)||void 0===h?void 0:h.outlineColor),ktv_shadow_color:(0,a.ax)(null===(p=e.ktv)||void 0===p?void 0:p.shadowColor),glow:Boolean(null===(f=e.glow)||void 0===f?void 0:f.enable),glow_resource_id:null===(y=e.glow)||void 0===y?void 0:y.resourceId,glow_color:(0,a.ax)(null===(g=e.glow)||void 0===g?void 0:g.color),glow_intensity:null===(m=e.glow)||void 0===m?void 0:m.intensity,glow_range:null===(_=e.glow)||void 0===_?void 0:_.range,text_bend:Boolean(null===(v=e.curve)||void 0===v?void 0:v.enable),text_bend_intensity:null!==(I=e.curve)&&void 0!==I&&I.enable?null===(T=e.curve)||void 0===T?void 0:T.angle:void 0,line_max_width:O,line_max_width_v1:O,fallback_text_info_list:null===(w=e.fallbackFontResources)||void 0===w?void 0:w.map((e=>({font_id:e.id,font_resource_id:e.resourceId}))),...C},N=JSON.parse(e.richText).styles[0];if(Object.assign(F,{shadow:Boolean(null===(E=N.shadows)||void 0===E?void 0:E.length),outline:Boolean(null===(x=N.strokes)||void 0===x?void 0:x.length),underline:Boolean(N.underline)}),null!==(b=N.shadows)&&void 0!==b&&b.length){const e=N.shadows[0];Object.assign(F,{shadow_color:"gradient"!==e.content.render_type?(0,a.WY)(e.content):(0,a.ax)(o.He),shadow_angle_v2:e.angle,shadow_smoothing:e.feather,shadow_distance:e.distance/100})}if(null!==(R=N.strokes)&&void 0!==R&&R.length){const e=N.strokes[0];Object.assign(F,{outline_width:e.width,outline_color:"gradient"!==e.content.render_type?(0,a.WY)(e.content):(0,a.ax)(o.t9)})}return void 0!==N.underline&&Object.assign(F,{underline_width:o.gX,underline_offset:o.MY}),N.effectStyle&&Object.assign(F,{style_font_id:N.effectStyle.id,style_font_resourceId:N.effectStyle.id}),Object.assign(F,{text_color:N.fill&&"gradient"!==(null===(k=N.fill)||void 0===k?void 0:k.content.render_type)?(0,a.WY)(N.fill.content):(0,a.ax)(o.SQ),use_effect_default_color:Boolean(N.useLetterColor),bold_width:N.bold?o.R0:void 0,italic_degree:N.italic?o.uj:void 0,font_size_v2:null!==(A=N.size)&&void 0!==A?A:12,font_resource_id:null!==(P=null===(M=N.font)||void 0===M?void 0:M.id)&&void 0!==P?P:"",font_id:null===(L=e.fontDependResources.find((e=>{var t;return e.resourceId===(null===(t=N.font)||void 0===t?void 0:t.id)})))||void 0===L?void 0:L.id}),F}}},18204:(e,t,i)=>{"use strict";i.d(t,{u:()=>o});var r=i(39113),n=i(8757);const a=r.default.model.hypic;function o(e){if(!e)return[];const t=[];return Object.keys(e).forEach((i=>{let r=e[i];if(void 0===r)return;i===n.vA.SHADOW?r<0&&(r+=1,i=n.vA.SHADOW_NEGATIVE):i in a&&(r=a[i](r));const o={key:i,value:r};t.push(o)})),t}},35405:(e,t,i)=>{"use strict";i.d(t,{R:()=>v,e:()=>I});var r,n=i(71525),a=i(71848),o=i(54273),s=i(81363),l=i(50788),c=i(15516),d=i(56537),u=i(18204),h=i(8757),p=i(86658),f=i(85204),y=i(39551),g=i(89811),m=i(44362),_=i(43777);function v(e,t,i){const r=[];if(e.children.forEach((t=>{const a=(0,n.T2)(t,e.layout,i);a&&(r.push(a),o.Ar.registerProtoId(a.id,t.id))})),e.effectFilters){const i={type:n.cq.FILTER,key:"base",name:"filter",id:(0,f.Ig)(),blend_mode:n.bt.NORMAL,visibility:!0,layout:o.Ar.toProto(o.Ar.fromModel(e.layout,t)),elements:e.effectFilters.map((e=>({id:e.id,resource_id:e.resourceId,...e.type===h.Yl.EFFECT?{key:a.eN.ImageEffect,params:e.params}:{key:a.eN.Filter,value:e.params[c.$3]}})))};r.push(i)}const s=e.filter?(0,u.u)(e.filter):[],l={type:n.cq.GROUP,key:"group",id:(0,f.Ig)(),name:"layerGroup",visibility:e.visibility,layout:o.Ar.toProto(o.Ar.fromModel(e.layout,t)),child:r,alpha:e.layout.opacity,edit_params:s,blend_mode:n.bt.NORMAL};return o.Ar.registerProtoId(l.id,e.id),l}!function(e){e.FILTER="filter",e.NORMAL="normal"}(r||(r={}));class I{constructor(e,t){this.isNeedNewGroup=e=>!!e&&[r.FILTER].includes(e),this.getPathAttrWithGradient=(e,t,i)=>({...e,fill:null!=t?t:e.fill,stroke:null!=i?i:e.stroke}),this.type="group",this.id=e.id,this.name=e.name,this.alpha=e.alpha,this.visibility=e.visibility,this.layout=new o.Ar(e.layout),this.child=e.child.map((e=>e.type===n.cq.GROUP?new I(e,t):new n.mh(e,t))),this.editParams=e.edit_params}toFixedLayoutType(e){this.layout=o.Ar.toFixedLayoutType(this.layout,e,this.id),this.child.forEach((e=>{e.toFixedLayoutType(this.layout)}))}addEffectFilter(e,t){if([a.eN.Filter,a.eN.ImageEffect].includes(e.key)){if(e.key===a.eN.Filter){const{resourceId:i,eraseInfo:r,id:n,value:a}=e;t.push({type:h.Yl.FILTER,id:n,resourceId:i,params:{[c.$3]:a},eraseInfo:r&&{...r}})}if(e.key===a.eN.ImageEffect){const{resourceId:i,eraseInfo:r,id:n,params:a}=e;t.push({type:h.Yl.EFFECT,id:n,resourceId:i,params:a,eraseInfo:r&&{...r}})}}}getEffectFilter(e){const t=[];return Array.isArray(e)?e.forEach((e=>{this.addEffectFilter(e,t)})):this.addEffectFilter(e,t),t}getPostProcessEffects(e){const t=[];return(Array.isArray(e)?e:[e]).forEach((e=>{const i=y.k.toLayerDelta(e);i&&t.push(i)})),t}getModelLayerImageDelta(e,t,i,r,n){return{type:h.F5.IMAGE,...i,layout:i.layout,src:e,effectFilters:t.elements&&this.getEffectFilter(t.elements),postProcessEffects:t.elements&&this.getPostProcessEffects(t.elements),replaceable:null==n?void 0:n.replaceable,aiTool:null==n?void 0:n.aiTool,replacePalette:null==n?void 0:n.replacePalette,isMainImage:r}}getModelLayerTextDelta(e,t,i){if(t.key===a.eN.TextV2){const{text:e,textParams:r,upperCase:n,outerRect:a,innerRect:o,fallbackTextInfos:s,dependResources:l,glowResourceId:c}=t,d=g.vd.unmarshal(r);return null!=d&&d.glow&&(d.glow.resourceId=c),{type:h.F5.TEXT,...i,...d,upperCase:n,text:e,fallbackFontResources:s,fontDependResources:l,extra:{...i.extra,textOuterRect:{width:Math.max(a.width,o.width),height:Math.max(a.height,null==o?void 0:o.height)}}}}const{text:r,upperCase:n,outerRect:o,innerRect:s,orientation:l,align:c,background:d,shape:u,letterSpacing:p,lineSpacing:f,innerPadding:y,glow:v,curve:I,ktv:T,lineMaxWidth:w,boldWidth:E,italicDegree:x,underline:b,fontSize:R,font:k,color:A,outline:P,shadow:M,scale:L}=t;let S=o;if(!o||!s||o.width<=s.width){const e=(0,_.zB)({fontSize:R,scale:L,innerRect:s,outerRect:o,shadow:M});S={width:s.width+2*e.x,height:s.height+2*e.y}}return{type:h.F5.TEXT,...i,text:r,upperCase:n,orientation:l,align:c,background:d,shape:u,letterSpacing:p,lineSpacing:f,innerPadding:y,glow:v,curve:I,ktv:T,lineMaxWidth:w,richText:JSON.stringify(m.Q.toJSON({text:n?r.toLocaleUpperCase():r,boldWidth:E,italicDegree:x,underline:b,fontSize:R,font:k,color:A,outline:P,shadow:M})),fallbackFontResources:[],fontDependResources:k?[k]:[],extra:{...i.extra,textOuterRect:{width:S.width/e.layout.scale.x,height:S.height/e.layout.scale.y}}}}getElementKey(e,t){return t===r.FILTER?a.eN.Filter:e.key}setElementImport(e,t){if(Array.isArray(e))e.forEach((e=>{const i=this.getResourceInfoFromElement(e);t.push(...i)}));else{const i=this.getResourceInfoFromElement(e);t.push(...i)}}getResourceInfoFromElement(e){const t=this.getElementKey(e);switch(t){case a.eN.YkSicker:case a.eN.Sticker:case a.eN.SvgSticker:return[{key:t,id:e.id,resourceId:e.resourceId}];case a.eN.DraftCutout:case a.eN.Cutout:return[{key:a.eN.Cutout,path:e.path}];case a.eN.EverPhoto:return[{key:t,md5:e.md5,id:e.id}];case a.eN.Graffiti:return[{key:t,id:e.path}];case a.eN.Text:{const i=e;if(!i.font)return[];const r=[];return r.push({key:t,id:i.font.id,resourceId:i.font.resourceId}),i.glow&&r.push({key:"text_glow",resourceId:i.glow.resourceId,id:i.glow.resourceId}),r}case a.eN.TextV2:{const t=e,i=[];return i.push(...t.dependResources.map((e=>({key:a.eN.Text,id:e.id,resourceId:e.resourceId})))),t.glowResourceId&&i.push({key:"text_glow",id:t.glowResourceId,resourceId:t.glowResourceId}),i}case a.eN.YkImage:return[{key:t,id:e.id,resourceId:e.resourceId,source:e.source}];case a.eN.Filter:const i=e;return[{key:t,id:i.id,resourceId:i.resourceId}];case a.eN.ImageEffect:const r=e;return[{key:t,id:r.id,resourceId:r.resourceId}];case a.eN.PostProcessEffect:const n=e,o=c.internalEffectResource.lumiHub;return[{key:t,id:o.id,resourceId:o.resourceId},{key:t,id:n.effectId,resourceId:n.resourceId}];case a.eN.ImageContainer:const s=e;return s.data.paths.length>1?[{key:t,id:s.id,resourceId:s.resourceId}]:[];default:return[]}}getModelLayerDelta(e,t,i,r){var a,s,l,c;const u=null!==(a=null!==(s=t.alpha)&&void 0!==s?s:null==r?void 0:r.alpha)&&void 0!==a?a:1,y={layout:o.Ar.toModel(t.layout,u,i.parentLayout),visibility:t.visibility,isLocked:Boolean(null===(l=i.layerExtras)||void 0===l||null===(l=l[t.id])||void 0===l?void 0:l.layer_locked),id:(0,f.rw)(t.id,i.layerExtras),title:t.name,filter:(0,p.kT)(t.editParams),isFlipHorizontal:t.isFlipHorizontal,isFlipVertical:t.isFlipVertical,extra:null===(c=i.layerExtras)||void 0===c||null===(c=c[t.id])||void 0===c?void 0:c.layer_extra,blendMode:(0,n.C6)(t.blendMode)};switch(t.elements&&this.setElementImport(t.elements,i.resourceCollector),e){case h.F5.TEXT:return this.getModelLayerTextDelta(t,r,y);case h.F5.LINE:{const{content:e,resourceId:t,id:i,strokeGradient:n}=r;return{type:h.F5.LINE,...y,source:e,attr:this.getPathAttrWithGradient(d.F.getSvgAttrsByString(d.F.LayerType.LINE,e),void 0,n),extra:{...y.extra,resourceId:t,effectId:i}}}case h.F5.SHAPE:{const{content:e,radius:i,id:n,resourceId:a,fillGradient:o,strokeGradient:s,fixedAreas:l}=r,c=d.F.getSvgAttrsByString(d.F.LayerType.SHAPE,e);return{type:h.F5.SHAPE,...y,paths:[{radius:d.F.isCornerRect(c.d)&&!i?46:i,source:e,attr:this.getPathAttrWithGradient(c,o,s),fixedAreas:l}],effectFilters:t.elements&&this.getEffectFilter(t.elements),extra:{...y.extra,resourceId:a,effectId:n}}}case h.F5.IMAGE:const n=(0,p.Mq)(r),a=i.layerExtras[t.id].layer_main;return this.getModelLayerImageDelta(n,t,y,a,r);case h.F5.IMAGE_CONTAINER:{const e=r;return this.getImageContainerModelDelta(e,y,i)}case h.F5.GRID:return r.getModelDelta(y,{...i,parentLayout:{...y.layout}},this.getModelLayerDelta.bind(this));case h.F5.GROUP_LAYER:return{type:h.F5.GROUP_LAYER,...y,effectFilters:t.elements&&this.getEffectFilter(t.elements),childrenDelta:[]};case h.F5.SVG_IMAGE:return{...r.getModelDelta(),effectFilters:t.elements&&this.getEffectFilter(t.elements),postProcessEffects:t.elements&&this.getPostProcessEffects(t.elements),...y};default:throw new Error(`layer type: ${e} is not allowed`)}}getImageContainerModelDelta(e,t,i){return{type:h.F5.IMAGE_CONTAINER,...t,items:e.data.paths.map((e=>{var r,a;const o=Boolean(e.fill.fill_type),s=null!==(r=e.fill.image)&&void 0!==r&&r.layer?new n.mh(e.fill.image.layer):void 0,l=null!==(a=e.fill.originImage)&&void 0!==a&&a.layer?new n.mh(e.fill.originImage.layer):void 0,c=o?{x:e.layout.x*t.layout.width,y:(1-(e.layout.y+e.layout.height))*t.layout.height,width:e.layout.width*t.layout.width,height:e.layout.height*t.layout.height}:e.layout,d={...i,parentLayout:c};return{layout:c,fill:o?{fillType:e.fill.fill_type,canUpdate:e.fill.can_update,validFillType:e.fill.valid_fill_type,color:e.fill.color,image:s?this.getModelLayerDelta(h.F5.IMAGE,s,d,s.elements[0]):void 0,originImage:l?this.getModelLayerDelta(h.F5.IMAGE,l,{...d,resourceCollector:[]},l.elements[0]):void 0}:e.fill,path:e.path.data,viewBox:{x:0,y:0,...e.path.viewbox_size},isBoundingBox:e.path.is_bounding_box}})),extra:{effectId:e.id,resourceId:e.resourceId}}}loopChildren(e,t,i,r){let s=[];return this.child.forEach((c=>{if(c.type===n.cq.GROUP){const n=c.toModel(e,t,i,r);s.push(n)}else if(c.type===n.cq.FILTER){if(!c.elements)return;const e=this.getModelLayerDelta(h.F5.GROUP_LAYER,c,r,void 0),t=l.Z.getInstance().createLayer(h.F5.GROUP_LAYER,e);t.addLayers(s,{isNeedCalcChildLayout:!0,isNeedCalcWrapLayout:!0}),s=[t]}else{var d;null===(d=c.elements)||void 0===d||d.forEach((t=>{const i=(0,a.qm)(t);if(t.key!==a.eN.Background){if(i){const n=this.getModelLayerDelta(i,c,r,t);if(t.isBackground){const t=n;return void(e.background.image=t)}const a=l.Z.getInstance().createLayer(i,n);o.Ar.registerModelId(a.id,c.id),s.push(a)}}else e.background={color:t.color}}))}})),s}toModel(e,t,i,r){var n,a,l;const c=o.Ar.toModel(this.layout,null!==(n=this.alpha)&&void 0!==n?n:1,r.parentLayout),d=this.loopChildren(e,t,i,{...r,parentLayout:c}),u=new s.i({type:h.F5.GROUP_LAYER,layout:c,title:this.name,id:(0,f.rw)(this.id,r.layerExtras),visibility:this.visibility,isLocked:null===(a=r.layerExtras)||void 0===a||null===(a=a[this.id])||void 0===a?void 0:a.layer_locked,filter:(0,p.kT)(this.editParams),childrenDelta:[],extra:null===(l=r.layerExtras)||void 0===l||null===(l=l[this.id])||void 0===l?void 0:l.layer_extra});return u.children=d,u}}},71525:(e,t,i)=>{"use strict";i.d(t,{bt:()=>D,cq:()=>U,mh:()=>q,C6:()=>z,$k:()=>V,kB:()=>Y,T2:()=>K});var r=i(8757),n=i(91372),a=i(56537),o=i(67986),s=i(18204),l=i(71848),c=i(11577);class d{constructor(e){this.key=l.eN.Background,e.gradient?this.color=(0,c.Q)(e.gradient):this.color=[e.red,e.green,e.blue,e.alpha/255],this.ratio=e.ratio,this.aspectRatio=e.aspect_ratio}}var u,h,p=i(15516);class f{constructor(e){this.key=l.eN.Filter,this.resourceId=e.resource_id,this.id=e.id,this.value=Number(e.value),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height})}static toProto(e){return{id:e.id,resource_id:e.resourceId,key:l.eN.Filter,value:e.params[p.$3]}}}class y{constructor(e){this.key=l.eN.ImageContainer,this.resourceId=e.resource_id,this.id=e.id,this.data=e.data}}!function(e){e[e.ORIGNAL=1]="ORIGNAL",e[e.OTHER=2]="OTHER"}(u||(u={})),function(e){e[e.NOTHING=0]="NOTHING",e[e.INTELLIGENT=1]="INTELLIGENT"}(h||(h={}));class g{constructor(e){this.key=l.eN.Image,this.type=e.type,this.cutoutAlgorithm=e.cutout_algo,this.path=e.path}}class m{constructor(e,t){this.key=l.eN.ReplaceableCutout,this.replaceable=!0,this.isIntelligent=e.is_intelligent,this.alpha=e.alpha,this.path=t}}var _=i(86658);class v{constructor(e){this.key=l.eN.EverPhoto,this.md5="",this.replaceable=!0,this.alpha=e.alpha,this.id=e.id,this.md5=e.md5,this.resourceId=e.resource_id,this.aiTool=(0,_.B)(e),e.is_background&&(this.isBackground=!0)}static toProto(e,t=1,i,r){return{key:l.eN.EverPhoto,md5:e.md5,resource_id:e.resourceId,is_background:r,alpha:t,id:e.id,...(0,_.PF)(i)}}}class I{constructor(e){this.md5="",this.replaceable=!1,this.key=l.eN.Cutout,this.path=e.path,this.alpha=e.alpha,this.isBackground=Boolean(e.is_background),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height}),e.replaceable&&(this.replaceable=e.replaceable)}}class T{constructor(e){this.key=l.eN.Sticker,this.replaceable=!1,this.resourceId=e.resource_id,this.id=e.id,this.alpha=e.alpha,this.replacePalette=(0,_.Bu)(e),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height})}static toProto(e,t=1,i){return{key:l.eN.Sticker,id:e.id,alpha:t,resource_id:e.resourceId,...(0,_.cU)(i)}}}class w{constructor(e){this.key=l.eN.YkSicker,this.replaceable=!1,this.resourceId=e.resource_id,this.alpha=e.alpha,this.id=e.id,this.ykId=e.yk_id,this.replacePalette=(0,_.Bu)(e),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height})}static toProto(e,t=1,i){return{key:l.eN.YkSicker,yk_id:e.ykId,resource_id:e.resourceId,alpha:t,id:e.id,...(0,_.cU)(i)}}}var E=i(85952),x=i(72513);class b{constructor(e){this.key=l.eN.DraftCutout,this.md5="",this.path=e.path,this.alpha=e.alpha,this.replacePalette=(0,_.Bu)(e),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height}),this.aiTool=(0,_.B)(e),this.replaceable=e.is_replace_able,e.is_background&&(this.isBackground=!0)}static toProto(e,t=1,i=!1,r,n,a){return{key:l.eN.DraftCutout,path:e.path,alpha:t,is_replace_able:i,is_background:n,...(0,_.PF)(r),...(0,_.cU)(a)}}}class R{constructor(e){this.key=l.eN.YkImage,this.resourceId=e.resource_id,this.id=e.id,this.source=e.source,this.replaceable=e.is_replaceable,this.aiTool=(0,_.B)(e),e.is_background&&(this.isBackground=!0)}static toProto(e,t=!0,i,r){return{key:l.eN.YkImage,id:e.id,resource_id:e.resourceId,source:e.source,is_replaceable:t,is_background:r,...(0,_.PF)(i)}}}class k{constructor(e){var t;this.key=l.eN.ImageEffect,this.resourceId=e.resource_id,this.id=e.id,this.params=null!==(t=e.params.reduce(((e,t)=>({...e,[t.key]:Number(t.value)})),{}))&&void 0!==t?t:{},e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height})}static toProto(e){return{id:e.id,resource_id:e.resourceId,key:l.eN.ImageEffect,params:Object.keys(e.params).reduce(((t,i)=>void 0===e.params[i]?t:[...t,{key:i,value:e.params[i]}]),[])}}}var A,P=i(39551),M=i(34939);!function(e){e.Color="color",e.Image="image",e.None="none"}(A||(A={}));class L{constructor(e,t){this.key=l.eN.Grid,this.areaFillLayers=new Map,this.fillCount=e.fill_count,this.points=e.points.map((e=>({id:e.point_id,x:e.x,y:1-e.y}))),this.protoAreas=e.areas,this.spacing={horizontal:e.spacing_horizontal,vertical:e.spacing_vertical},this.radius=e.radius,e.areas.filter((e=>e.fill.fill_type===A.Image&&e.fill.image)).forEach((e=>{this.areaFillLayers.set(e.area_id,new q(e.fill.image,t))}))}static toProto(e,t,i){const n=V(e,t),a={key:l.eN.Grid,fill_count:e.fillCount,points:e.points.map((e=>({point_id:e.id,x:e.x,y:1-e.y}))),spacing_horizontal:e.spacing.horizontal,spacing_vertical:e.spacing.vertical,radius:e.radius,areas:e.areas.map((e=>{let t;if(e.fill.fillType===r.kl.NONE)t={fill_type:A.None};else if(e.fill.fillType===r.kl.COLOR)t={fill_type:A.Color,color:e.fill.color};else{const r=e.fill.image,a=K(r,n.layout);(0,M.Xo)(r,a,i),t=a?{fill_type:A.Image,color:e.fill.color,image:a}:{fill_type:A.None}}return{area_id:e.id,point_ids:e.points,fill:t}}))};return n.elements=[a],n}getModelDelta(e,t,i){const n=this.protoAreas.map((e=>{const{area_id:n,point_ids:a,fill:o}=e,s={id:n,points:a,fill:{fillType:o.fill_type}};if(o.color&&(s.fill.color=o.color),o.fill_type===A.Image&&o.image){const e=this.areaFillLayers.get(s.id);e&&(s.fill.image=i(r.F5.IMAGE,e,{...t},e.elements[0]))}return s}));return{...e,type:r.F5.GRID,points:this.points,spacing:this.spacing,radius:this.radius,areas:n,fillCount:this.fillCount}}}class S{constructor(e){this.key=l.eN.SvgSticker,this.replaceable=!1,this.resourceId=e.resource_id,this.id=e.id,this.alpha=e.alpha,this.replacePalette=(0,_.Bu)(e),e.erase_height&&e.erase_width&&e.erase_path&&(this.eraseInfo={path:e.erase_path,width:e.erase_width,height:e.erase_height}),e.colorMap&&(this.colorMap=[],e.colorMap.forEach((e=>{const{key:t,value:i}=e,r=Array.isArray(t)?t:(0,c.Q)(t),n=Array.isArray(i)?i:(0,c.Q)(i);r&&this.colorMap.push({origin:r,replace:n})})))}static toProto(e){return{key:l.eN.SvgSticker,alpha:e.layout.opacity,resource_id:e.src.resourceId,id:e.src.id,colorMap:e.colors.map((e=>{const t=Array.isArray(e.origin)?e.origin:(0,c.C)(e.origin);let i;return i=e.replace?Array.isArray(e.replace)?e.replace:(0,c.C)(e.replace):t,{key:t,value:i}})),is_intelligent_palette:!1}}getModelDelta(){return{type:r.F5.SVG_IMAGE,src:{id:this.id,resourceId:this.resourceId,type:r.lJ.Sticker},colors:this.colorMap}}}var C=i(89811);class O{constructor(e){this.key=l.eN.TextV2,this.text=e.text,this.upperCase=e.upper_case,this.fallbackTextInfos=e.fallbackTextInfos,this.dependResources=e.dependResources,this.glowResourceId=e.glow_resource_id,this.textParams=e.text_params,this.fontPanelType=e.font_panel_type,this.innerRect={width:e.compact_size[0],height:e.compact_size[1]},this.outerRect={width:e.extend_size[0],height:e.extend_size[1]}}static toProto(e){var t,i,r,n;const a=[e.layout.width,e.layout.height],o={upper_case:null!==(t=e.upperCase)&&void 0!==t&&t,compact_size:a,extend_size:e.extra.textOuterRect?[e.extra.textOuterRect.width,e.extra.textOuterRect.height]:a},s=e.clone(!1),{text_params:c}=C.vd.marshal(s);return{key:l.eN.TextV2,text_params:c,text:null!==(i=e.text)&&void 0!==i?i:"",glow_resource_id:null!==(r=null===(n=e.glow)||void 0===n?void 0:n.resourceId)&&void 0!==r?r:"",dependResources:e.fontDependResources.map((e=>({key:l.eN.EffectResource,...e}))),fallbackTextInfos:e.fallbackFontResources.map((e=>({key:l.eN.EffectResource,...e}))),font_panel_type:"",...o}}}class F{static createElement(e,t,i){switch(t.key){case l.eN.Background:return new d(t);case l.eN.Image:return new g(t);case l.eN.ImageContainer:{const e=new y(t),n=function(e){return e.data.paths.filter((e=>e.fill.fill_type===r.lm.IMAGE&&(e.fill.image||e.fill.originImage))).map((e=>{var t,i,r;return null!==(t=null===(i=e.fill.image)||void 0===i?void 0:i.layer)&&void 0!==t?t:null===(r=e.fill.originImage)||void 0===r?void 0:r.layer})).filter(Boolean)}(e);return n.forEach((e=>{e.elements=e.elements.map((e=>{if(e.key===l.eN.Cutout){var t,r;const n=e,a=null==i||null===(t=i.localImages)||void 0===t?void 0:t.find((e=>e.path===n.path));return n.path=null!==(r=null==a?void 0:a.uri)&&void 0!==r?r:n.path,n}return e}))})),e}case l.eN.Sticker:return new T(t);case l.eN.Filter:return new f(t);case l.eN.ImageEffect:return new k(t);case l.eN.Text:return new x.G(t);case l.eN.TextV2:return new O(t);case l.eN.Svg:return new E.t(t);case l.eN.Cutout:{var n,a;const e=t,r=null==i||null===(n=i.localImages)||void 0===n?void 0:n.find((t=>t.path===e.path));return e.path=null!==(a=null==r?void 0:r.uri)&&void 0!==a?a:e.path,new I(e)}case l.eN.DraftCutout:return new b(t);case l.eN.YkSicker:return new w(t);case l.eN.EverPhoto:return new v(t);case l.eN.ReplaceableCutout:{var s;const r=null==i||null===(s=i.replaceableImages)||void 0===s||null===(s=s.find((t=>t.layer_id===e.id)))||void 0===s?void 0:s.uri;return new m(t,null!=r?r:"")}case l.eN.YkImage:return new R(t);case l.eN.PostProcessEffect:return new P.k(t);case l.eN.Grid:return new L(t,i);case l.eN.SvgSticker:return new S(t);default:return o.t.error(`element key: ${t.key} is not support`),null}}}class N{constructor(e){this.key=l.eN.HSL,this.intensityKeys=e.intensity_keys,this.intensityValues=e.intensity_values}}var D,U,B=i(35405),G=i(54273),j=i(85204),H=i(43777);function W(e){switch(e){case r.bt.MULTIPLY:return D.MULTIPLY;case r.bt.COLOR_BURN:return D.COLOR_BURN;case r.bt.SCREEN:return D.SCREEN;case r.bt.OVERLAY:return D.OVERLAY;case r.bt.SOFT_LIGHT:return D.SOFT_LIGHT;case r.bt.LIGHTEN:return D.LIGHTEN;case r.bt.DARKEN:return D.DARKEN;case r.bt.DIFFERENCE:return D.DIFFERENCE;default:return D.NORMAL}}function z(e){switch(e){case D.MULTIPLY:return r.bt.MULTIPLY;case D.COLOR_BURN:return r.bt.COLOR_BURN;case D.SCREEN:return r.bt.SCREEN;case D.OVERLAY:return r.bt.OVERLAY;case D.SOFT_LIGHT:return r.bt.SOFT_LIGHT;case D.LIGHTEN:return r.bt.LIGHTEN;case D.DARKEN:return r.bt.DARKEN;case D.DIFFERENCE:return r.bt.DIFFERENCE;default:return}}function V(e,t,i){var r;const n=(0,j.Ig)();return{type:U.BASE,key:"base",id:n,origin_id:e.id,name:null!==(r=e.title)&&void 0!==r?r:`layer-${n}`,blend_mode:e.blendMode?W(e.blendMode):D.NORMAL,visibility:e.visibility,layout:G.Ar.toProto(G.Ar.fromModel(e.layout,t)),elements:null!=i?i:[],edit_params:(0,s.u)(e.filter),extra:e.extra,alpha:e.layout.opacity}}function $(e){if(![r.F5.IMAGE,r.F5.SVG_IMAGE].includes(e.type))return[];const t=e,i=[];if(t.effectFilters){const e=t.effectFilters.reduce(((e,t)=>{if(t.type===r.Yl.EFFECT){const i=k.toProto(t);return i.params.length?e.concat(i):e}const i=f.toProto(t);return void 0===i.value?e:e.concat(i)}),[]);i.push(...e)}return t.postProcessEffects&&i.push(...t.postProcessEffects.map((e=>P.k.toProto(e)))),i}function Y(e,t,i=!1){var n;let a;const o=function(e){const{type:t}=e;return t===r.lJ.YkSicker?l.eN.YkSicker:t===r.lJ.CloudImageSticker?l.eN.EverPhoto:t===r.lJ.Sticker?l.eN.Sticker:t===r.lJ.Cutout?l.eN.DraftCutout:t===r.lJ.YkImage?l.eN.YkImage:l.eN.DraftCutout}(e.src),{opacity:s}=e.layout;switch(o){case l.eN.Sticker:a=T.toProto(e.src,s,e.replacePalette);break;case l.eN.YkSicker:a=w.toProto(e.src,s,e.replacePalette);break;case l.eN.DraftCutout:a=b.toProto(e.src,s,e.replaceable,e.aiTool,i,e.replacePalette);break;case l.eN.EverPhoto:a=v.toProto(e.src,s,e.aiTool,i);break;case l.eN.YkImage:a=R.toProto(e.src,e.replaceable,e.aiTool,i)}const c=V(e,t);var d;a&&(null===(d=c.elements)||void 0===d||d.push(a));return null===(n=c.elements)||void 0===n||n.push(...$(e)),c}function X(e,t,i){const n={key:l.eN.ImageContainer,id:e.extra.effectId,resource_id:e.extra.resourceId,data:{paths:e.items.map((t=>function(e,t,i){const{fill:n,layout:a}=e,o={fill_type:n.fillType,valid_fill_type:n.validFillType,can_update:n.canUpdate,color:n.color};if(n.fillType===r.lm.IMAGE&&n.image){const e=n.image,t=Y(e,a);(0,M.Xo)(e,t,i),o.image={layer:t}}return n.fillType===r.lm.IMAGE&&n.originImage&&(o.originImage={layer:Y(n.originImage,a)}),{layout:{x:a.x/t.width,y:1-(a.y+e.layout.height)/t.height,width:e.layout.width/t.width,height:e.layout.height/t.height},path:{data:e.path,viewbox_size:e.viewBox,is_bounding_box:e.isBoundingBox},fill:o}}(t,e.layout,i)))}},a=V(e,t);return a.elements=[n],a}function J(e,t,i,r,n,a,o,s,d=((t,i)=>null!==(t=null===(i=e.layout)||void 0===i?void 0:i.opacity)&&void 0!==t?t:1)()){var u;const h={key:l.eN.Svg,alpha:d,resource_id:e.extra.resourceId,id:e.extra.effectId,content:null!=i?i:"",svg_type:r,radius:n,fill_gradient:o?(0,c.C)(o):void 0,stroke_gradient:s?(0,c.C)(s):void 0,fixedAreas:a},p=V(e,t);return null===(u=p.elements)||void 0===u||u.push(h),p}function K(e,t,i){let s;switch(e.type){case r.F5.GROUP_LAYER:s=(0,B.R)(e,t,i);break;case r.F5.TEXT:s=function(e,t){const i=(0,H.ek)(e)?O.toProto(e):x.G.toProto(e),r=V(e,t);return r.elements=[i],r}(e,t);break;case r.F5.IMAGE:s=Y(e,t);break;case r.F5.SHAPE:s=function(e,t,i){const{source:r,attr:o,radius:s,fixedAreas:l}=e.paths[0],{gradient:c}=(0,n.tB)(o.fill),{gradient:d}=(0,n.tB)(o.stroke);return J(e,t,a.F.composePolygonByAttrsForExport(r,o)||"",E.n.SHAPE,s,l,c,d,i)}(e,t);break;case r.F5.LINE:s=function(e,t,i){const{gradient:r}=(0,n.tB)(e.attr.stroke);return J(e,t,a.F.composeLineByAttrsForExport(e.source,e.attr),E.n.LINE,void 0,void 0,void 0,r,i)}(e,t);break;case r.F5.IMAGE_CONTAINER:s=X(e,t,i);break;case r.F5.GRID:s=L.toProto(e,t,i);break;case r.F5.SVG_IMAGE:s=V(e,t,[S.toProto(e),...$(e)]);break;default:o.t.error(`\u6682\u4e0d\u652f\u6301\u7684\u5bfc\u51fa\u7c7b\u578b ${e.type}`),s=null}return(0,M.Xo)(e,s,i),s}!function(e){e[e.NORMAL=0]="NORMAL",e[e.MULTIPLY=1]="MULTIPLY",e[e.COLOR_BURN=2]="COLOR_BURN",e[e.LINEAR_DODGE=3]="LINEAR_DODGE",e[e.SCREEN=4]="SCREEN",e[e.OVERLAY=5]="OVERLAY",e[e.SOFT_LIGHT=6]="SOFT_LIGHT",e[e.LIGHTEN=7]="LIGHTEN",e[e.DARKEN=8]="DARKEN",e[e.DIFFERENCE=9]="DIFFERENCE"}(D||(D={})),function(e){e.BASE="base",e.FILTER="filter",e.GROUP="group"}(U||(U={}));class q{constructor(e,t){this.type=e.type,this.id=e.id,this.alpha=e.alpha,this.renderLayerId=e.renderLayerId,this.name=e.name,this.blendMode=e.blend_mode,this.visibility=e.visibility,this.elements=this.initElement(e,t),this.isFlipHorizontal=e.layout.scale[0]<0,this.isFlipVertical=e.layout.scale[1]<0,this.layout=new G.Ar(e.layout),this.blendMode=e.blend_mode,this.editParams=e.edit_params,this.hsl=e.hsl&&new N(e.hsl),this.extra=e.extra}toFixedLayoutType(e){this.layout=G.Ar.toFixedLayoutType(this.layout,e,this.id)}initElement(e,t){var i;const r=[];return null===(i=e.elements)||void 0===i||i.forEach((e=>{const i=F.createElement(this,e,t);i&&r.push(i)})),r}}},54273:(e,t,i)=>{"use strict";i.d(t,{Ar:()=>p,ms:()=>r});var r,n=i(8757);function a(e,t){const{width:i,height:n}=t,{width:a,height:o}=e;return{...e,type:r.FIXED,x:i/2-a/2,y:n/2-o/2}}function o(e,t){const{width:i,height:n}=t,{width:a,height:o}=e,s=Math.max(i/a,n/o),l=a*s,c=o*s;return{...e,type:r.FIXED,width:l,height:c,x:i/2-l/2,y:n/2-c/2}}function s(e,t){const{width:i,height:n}=t,{width:a,height:o}=e,s=Math.min(i/a,n/o),l=a*s,c=o*s;return{...e,type:r.FIXED,width:l,height:c,x:i/2-l/2,y:n/2-c/2}}function l(e,t,i){var r;return{...e,x:e.x,y:t.height-(e.y+e.height*(null!==(r=null==i?void 0:i.y)&&void 0!==r?r:1))}}function c(e){return e?-e:0}!function(e){e.ASPECT_FIT="aspect_fit",e.ASPECT_FILL="aspect_fill",e.CENTER="center",e.SCALE_FILL="scale_fill",e.FIXED="fixed"}(r||(r={}));const d=new Map,u=new Map,h=new Map;class p{constructor(e){var t,i,r,n,a;if(this.type=e.type,this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.translate=e.translate&&{x:e.translate[0],y:e.translate[1],z:e.translate[2]},this.scale={x:Math.abs(e.scale[0]),y:Math.abs(e.scale[1])},this.rotation=null!==(t=null===(i=e.rotate)||void 0===i?void 0:i[2])&&void 0!==t?t:0,this.anchor=e.anchor&&{x:e.anchor[0],y:e.anchor[1]},e.clip_info)this.clipRect={x:e.clip_info[0],y:e.clip_info[1],width:null===(n=e.clip_info)||void 0===n?void 0:n[2],height:null===(a=e.clip_info)||void 0===a?void 0:a[3]};else if(e.clip_rect&&4===e.clip_rect.length&&void 0!==e.clip_rect[2]&&0!==e.clip_rect[2]&&void 0!==e.clip_rect[3]&&0!==(null===(r=e.clip_rect)||void 0===r?void 0:r[3])){var o,s,l,c;this.clipRect={x:null===(o=e.clip_rect)||void 0===o?void 0:o[0],y:null===(s=e.clip_rect)||void 0===s?void 0:s[1],width:null===(l=e.clip_rect)||void 0===l?void 0:l[2],height:null===(c=e.clip_rect)||void 0===c?void 0:c[3]}}}static toProto(e){var t;const i=e.translate&&[e.translate.x,e.translate.y,e.translate.z]||[0,0,0],r=e.scale&&[e.scale.x,e.scale.y,1]||[1,1,1],n=[0,0,null!==(t=e.rotation)&&void 0!==t?t:0],a=e.anchor&&[e.anchor.x,e.anchor.y]||[.5,.5];return{type:e.type,x:e.x,y:e.y,width:e.width,height:e.height,translate:i,scale:r,rotate:n,anchor:a,clip_info:e.clipRect&&[e.clipRect.x,e.clipRect.y,e.clipRect.width,e.clipRect.height]}}static fromModel(e,t){const i=c(e.rotation),n=l(e,t,e.scale),{x:a,y:o}=(s=n,(d=e.scale)?{...s,x:s.x+s.width*(d.x-1)/2,y:s.y+s.height*(d.y-1)/2}:s);var s,d;return{type:r.FIXED,width:e.width,height:e.height,x:a,y:o,rotation:i,translate:e.translate&&{...e.translate},anchor:e.anchor&&{...e.anchor},scale:e.scale,clipRect:e.clipRect&&{...e.clipRect}}}static toModel(e,t,i){const r=c(e.rotation),a=function(e,t){return t?{...e,x:e.x-e.width*(t.x-1)/2,y:e.y-e.height*(t.y-1)/2}:e}(e,e.scale);e.translate&&(a.x+=e.translate.x,a.y+=e.translate.y);const{x:o,y:s}=l(a,i,e.scale);return{type:n.ms.FIXED,width:e.width,height:e.height,x:o,y:s,rotation:r,translate:void 0,anchor:e.anchor&&{...e.anchor},scale:e.scale||{x:1,y:1},clipRect:e.clipRect&&{...e.clipRect},opacity:t}}static toFixedLayoutType(e,t,i){const{type:n}=e;switch(d.set(i,e.type),n){case r.ASPECT_FIT:return s(e,t);case r.SCALE_FILL:case r.ASPECT_FILL:return o(e,t);case r.CENTER:return a(e,t);default:case r.FIXED:return{...e}}}static registerModelId(e,t){u.set(e,t)}static releaseModelId(e){const t=u.get(e);return u.delete(e),t}static registerProtoId(e,t){h.set(e,t)}static releaseProtoId(e){const t=h.get(e);return h.delete(e),t}static releaseOriginalType(e){const t=r.CENTER,i=p.releaseProtoId(e);if(!i)return t;const n=p.releaseModelId(i);if(!n)return t;const a=d.get(n);return a?(d.delete(n),a):t}static restoreLayoutType(e,t,i){switch(p.releaseOriginalType(i)){case r.ASPECT_FIT:return function(e,t){var i,n;const{x:a,y:o,width:l,height:c}=s(e,t),d=null!==(i=e.translate)&&void 0!==i?i:{x:0,y:0,z:0};d.x+=e.x-(l-e.width)/2-a,d.y+=e.y-(c-e.height)/2-o;const u=null!==(n=e.scale)&&void 0!==n?n:{x:1,y:1,z:1};return u.x*=e.width/l,u.y*=e.height/c,{...e,type:r.ASPECT_FIT,x:0,y:0,translate:d,scale:u}}(e,t);case r.SCALE_FILL:case r.ASPECT_FILL:return function(e,t){var i,n;const{x:a,y:s,width:l,height:c}=o(e,t),d=null!==(i=e.translate)&&void 0!==i?i:{x:0,y:0,z:0};d.x+=e.x-(l-e.width)/2-a,d.y+=e.y-(c-e.height)/2-s;const u=null!==(n=e.scale)&&void 0!==n?n:{x:1,y:1,z:1};return u.x*=e.width/l,u.y*=e.height/c,{...e,type:r.ASPECT_FILL,x:0,y:0,translate:d,scale:u}}(e,t);case r.FIXED:return{...e};default:case r.CENTER:return function(e,t){var i;const{x:n,y:o}=a(e,t),s=null!==(i=e.translate)&&void 0!==i?i:{x:0,y:0,z:0};return s.x+=e.x-n,s.y+=e.y-o,{...e,type:r.CENTER,x:0,y:0,translate:s}}(e,t)}}}},55244:(e,t,i)=>{"use strict";function r(e){if(!e)return e;const t=Array.from(e);return t[3]=Math.round(255*e[3]),t}function n(e){if(!e)return e;const t=Array.from(e);return t[3]=e[3]/255,t}i.d(t,{NP:()=>n,WY:()=>a,ax:()=>r});const a=e=>{var t;return[...e.solid.color,null!==(t=e.solid.alpha)&&void 0!==t?t:1].map((e=>Math.round(255*e)))}},11577:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s,C:()=>o});var r,n=i(8757);!function(e){e[e.Linear=1]="Linear",e[e.Radial=2]="Radial"}(r||(r={}));var a=i(55244);function o(e){return{type:e.type===n.cF.LinearGradient?r.Linear:r.Radial,stops:e.stops.map((e=>({...e,color:(0,a.ax)(e.color)}))),rotation:e.rotation,center:e.center,radius:e.radius}}function s(e){var t,i,o;return e.type===r.Linear?{type:n.cF.LinearGradient,stops:e.stops.map((e=>({color:(0,a.NP)(e.color),offset:e.offset}))),rotation:null!==(t=e.rotation)&&void 0!==t?t:0}:e.type===r.Radial?{type:n.cF.RadialGradient,stops:e.stops.map((e=>({color:(0,a.NP)(e.color),offset:e.offset}))),center:null!==(i=e.center)&&void 0!==i?i:[.5,.5],radius:null!==(o=e.radius)&&void 0!==o?o:[.717,.717]}:void 0}},86658:(e,t,i)=>{"use strict";i.d(t,{B:()=>p,Bu:()=>u,DC:()=>v,Mq:()=>l,Ns:()=>m,PF:()=>h,Sz:()=>f,cU:()=>d,kT:()=>c,o_:()=>_,qP:()=>I,rC:()=>y,yV:()=>g,zj:()=>T});var r=i(8757),n=i(71848),a=i(39113),o=i(21204);const s=a.default.hypic.model;function l(e){const{id:t,resourceId:i,path:a,md5:o,ykId:s,source:l}=e;switch(e.key){case n.eN.Sticker:return{id:t,resourceId:i,type:r.lJ.Sticker};case n.eN.YkSicker:return{id:t,resourceId:i,ykId:s,type:r.lJ.YkSicker};case n.eN.EverPhoto:return{resourceId:i,id:t,md5:o,type:r.lJ.CloudImageSticker};case n.eN.YkImage:return{resourceId:i,id:t,type:r.lJ.YkImage,source:l};default:return{path:a,type:r.lJ.Cutout}}}const c=e=>{if(!e)return;const t={};return null==e||e.forEach((e=>{const{key:i}=e;let{value:n}=e;i!==r.vA.SHADOW_NEGATIVE?(i in s&&(n=s[i](n)),Object.assign(t,{[i]:n})):t[r.vA.SHADOW]=n-1})),t};function d(e){var t;return{is_intelligent_palette:null!==(t=null==e?void 0:e.enable)&&void 0!==t&&t,intelligent_palette_path:null!=e&&e.enable&&null!=e&&e.uri?null==e?void 0:e.uri:void 0}}function u(e){if(null!=e&&e.is_intelligent_palette)return{enable:!0,uri:e.intelligent_palette_path}}function h(e){var t;const i=(0,o.AL)({aiTool:e});return{is_intelligent_cutout:null!==(t=null==i?void 0:i.enable)&&void 0!==t&&t,intelligent_cutout_path:null!=i&&i.enable?i.uri:void 0,intelligent_cutout_mask_path:null!=i&&i.enable?i.maskUri:void 0,intelligent_cutout_bg_path:null!=i&&i.enable&&null!=i&&i.background?i.background:void 0,ai_tool:e}}function p(e){if(null!=e&&e.ai_tool)return e.ai_tool;if(null!=e&&e.is_intelligent_cutout){const t={toolType:r.no.ImageCutout,artifact:{uri:e.intelligent_cutout_path,uriType:r.q$.ImageX,maskUri:e.intelligent_cutout_mask_path}};return e.intelligent_cutout_bg_path?{pipelines:[{toolType:r.no.ImageBackground,artifact:{uri:e.intelligent_cutout_bg_path,uriType:r.q$.ImageX}},t]}:{pipelines:[t]}}}function f(e){return!!e.is_intelligent_cutout}function y(e){if(!f(e))return!1;return Boolean(e.intelligent_cutout_bg_path)}function g(e){var t;if(!f(e))return;const i=e;return null!==(t=null==i?void 0:i.intelligent_cutout_bg_path)&&void 0!==t?t:null==i?void 0:i.intelligent_cutout_path}function m(e){return Boolean(e.is_background)}function _(e){return"is_intelligent_palette"in e&&Boolean(e.is_intelligent_palette)}function v(e){if(_(e))return e.intelligent_palette_path}function I(e){var t;return Boolean(null===(t=e.ai_tool)||void 0===t?void 0:t.pipelines.length)}function T(e){var t;if(I(e))return null===(t=e.ai_tool)||void 0===t||null===(t=t.pipelines[0])||void 0===t?void 0:t.artifact}},85204:(e,t,i)=>{"use strict";i.d(t,{Ig:()=>a,rw:()=>n});var r=i(87606);function n(e,t){var i;if(!t){return(0,r.L)()}let n=null===(i=t[e])||void 0===i?void 0:i.layer_origin_id;return n||(n=(0,r.L)(),t[e]={...t[e],layer_origin_id:n}),n}const a=function(){let e=Math.floor(100*Math.random());return function(){return e+=1,e}}()},34939:(e,t,i)=>{"use strict";i.d(t,{Xo:()=>d,ft:()=>s,N$:()=>c});var r=i(71848),n=i(71525),a=i(54273),o=i(8757);function s(e,t){const i=[],r=[e],n=[e.layout];if("group"===e.type)for(const a of e.child){const e=s(a,t);i.push(...e.elements),r.push(...e.layers),n.push(...e.layouts)}else e.elements&&(null!=t&&t.onElement&&(e.elements=e.elements.map((i=>{var r,n;return null!==(r=null===(n=t.onElement)||void 0===n?void 0:n.call(t,e,i))&&void 0!==r?r:i}))),i.push(...e.elements)),null!=t&&t.onLayer&&(null==t||t.onLayer(e));return{elements:i,layers:r,layouts:n}}const l={Template:{platform:"template.web"},LayerTypes:{base:"layer.base",filter:"layer.filter",group:"layer.group",combination:"layer.combination"},LayoutTypes:{[a.ms.ASPECT_FILL]:"layout.aspect_fill",[a.ms.ASPECT_FIT]:"layout.aspect_fit",[a.ms.CENTER]:"layout.center",[a.ms.FIXED]:"layout.fixed",[a.ms.SCALE_FILL]:"layout.scale_fill"},ElementKeys:{[r.eN.Background]:"element.background",[r.eN.Filter]:"element.filter",[r.eN.Image]:"element.image",[r.eN.ImageEffect]:"element.image_effect",[r.eN.PostProcessEffect]:"element.post_process_effect",[r.eN.Sticker]:"element.sticker",[r.eN.Text]:"element.text",[r.eN.TextV2]:"element.text_v2",[r.eN.Graffiti]:"element.graffiti",[r.eN.Cutout]:"element.cutout",[r.eN.Hdr]:"element.hdr",[r.eN.Svg]:"element.svg",[r.eN.ReplaceableCutout]:"element.replaceable_cutout",[r.eN.YkSicker]:"element.yk_sticker",[r.eN.Edit]:"element.layer_edit",[r.eN.ImageContainer]:"element.image_container",[r.eN.YkImage]:"element.yk_image",[r.eN.Grid]:"element.grid",[r.eN.SvgSticker]:"element.svg_sticker"},ElementEditTypes:{[o.vA.BRIGHTNESS]:"element.edit.brightness",[o.vA.BRILLIANCE]:"element.edit.brilliance",[o.vA.CONTRAST]:"element.edit.contrast",[o.vA.EXPOSURE]:"element.edit.exposure",[o.vA.FADE]:"element.edit.fade",[o.vA.GRAIN]:"element.edit.grain",[o.vA.HIGHLIGHT]:"element.edit.highlight",[o.vA.LIGHT_SENSATION]:"element.edit.lightSensation",[o.vA.OLITEXTURE]:"element.edit.oilTexture",[o.vA.SATURATION]:"element.edit.saturation",[o.vA.SHADOW]:"element.edit.shadow",[o.vA.SHARP]:"element.edit.sharp",[o.vA.STRUCTURE]:"element.edit.structure",[o.vA.TEMPERATURE]:"element.edit.temperature",[o.vA.TONE]:"element.edit.tone",[o.vA.VIBRANCE]:"element.edit.vibrance",[o.vA.SHADOW_NEGATIVE]:"element.edit.shadow_negative"},Background:{image:"element.is_background_image",gradient:"element.background.gradient"},ImageContainer:{layout:"element.image_container_layout_v2",multi:"element.image_container_multi_layers_v2"},Text:{glow:"element.text.glow",curve:"element.text.curve"},Svg:{gradient:"element.svg.gradient",nonuniformScale:"element.svg.nonuniform_scale"},ImagePostProcess:{[o.zI.GLOW]:"element.post_process_effect.glow",[o.zI.SHADOW]:"element.post_process_effect.shadow",[o.zI.OUTLINE]:"element.post_process_effect.outline",[o.zI.FEATHER]:"element.post_process_effect.feather"}};function c(e){const{layers:t,layouts:i,elements:a}=e,o=new Set;let s=0;for(const r of t){const e=l.LayerTypes[r.type];r.type===n.cq.GROUP&&(s+=1),e&&o.add(e)}for(const r of i){const e=l.LayoutTypes[r.type];e&&o.add(e)}for(const n of a){const e=l.ElementKeys[n.key];if(e&&o.add(e),n.key===r.eN.Edit){const e=n,t=l.ElementEditTypes[e.type];t&&o.add(t)}if(n.key===r.eN.ImageContainer){o.add(l.ImageContainer.layout);const{data:e}=n;e.paths.length>1&&o.add(l.ImageContainer.multi)}if(n.key===r.eN.Text&&(n.glow&&o.add(l.Text.glow),n.text_bend_intensity&&o.add(l.Text.curve)),n.key===r.eN.Background&&n.gradient&&o.add(l.Background.gradient),n.key===r.eN.Svg){const e=n,{fixedAreas:t}=n;(e.fill_gradient||e.stroke_gradient)&&o.add(l.Svg.gradient),t&&o.add(l.Svg.nonuniformScale)}if(n.key===r.eN.PostProcessEffect){const e=l.ImagePostProcess[n.type];e&&o.add(e)}n.is_background&&o.add(l.Background.image)}return s>1&&o.add(l.LayerTypes.combination),o.add(l.Template.platform),Array.from(o)}function d(e,t,i){var r,n,a;t&&i&&(i.layerExtras[t.id]={layer_origin_id:e.id,layer_extra:e.extra,layer_flip:(r=e,{isVerticalFlip:null!==(n=r.isFlipVertical)&&void 0!==n&&n,isHorizonFlip:null!==(a=r.isFlipHorizontal)&&void 0!==a&&a}),layer_locked:e.isLocked},e.type===o.F5.IMAGE&&(i.layerExtras[t.id].layer_main=e.isMainImage))}},43777:(e,t,i)=>{"use strict";i.d(t,{H3:()=>f,_V:()=>p,ek:()=>y,zB:()=>h});var r=i(57123),n=i(71848),a=i(43825),o=i(41658),s=i(72513);const l=r.EY.render,c=r.EY.effect,d=e=>void 0!==e&&-1!==e,u=e=>e.innerRect&&e.outerRect?{x:Math.abs(e.outerRect.width-e.innerRect.width)/2,y:Math.abs(e.outerRect.height-e.innerRect.height)/2}:null,h=e=>{var t,i,r;const{x:n=1}=null!==(t=e.scale)&&void 0!==t?t:{},o=(null!==(i=null==e?void 0:e.fontSize)&&void 0!==i?i:a.Kt)*n,s=l.fontSize(o),c={x:s*a.CT,y:s*a.CT};if(null!==(r=e.shadow)&&void 0!==r&&r.enable){const t=l.shadowOffset(o,{angle:e.shadow.angle,distance:e.shadow.distance});c.x+=Math.abs(t.x),c.y+=Math.abs(t.y)}return c};function p(e){var t;if("group"===e.type)return void e.child.forEach((e=>p(e)));const i=null===(t=e.elements)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.key;if(i===n.eN.Text){var r;const t=e.elements[0],{x:i=1,y:n=1}=null!==(r=t.scale)&&void 0!==r?r:{},a={x:e.layout.scale.x*i,y:e.layout.scale.y*n},o=h(t),s=u(t)||o;if(!t.innerRect){const i={width:e.layout.width-2*s.x+1,height:e.layout.height-2*s.y+1};t.innerRect=i}return t.outerRect||(t.outerRect={width:e.layout.width,height:e.layout.height}),e.layout.width=t.innerRect.width/i,e.layout.height=t.innerRect.height/n,void(e.layout.scale=a)}if(i===n.eN.TextV2){const t=e.elements[0];e.layout.width=t.innerRect.width,e.layout.height=t.innerRect.height}}function f(e,t){var i,r;if("group"!==e.type)if((null===(i=e.elements)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.key)!==n.eN.Text){if((null===(r=e.elements)||void 0===r||null===(r=r[0])||void 0===r?void 0:r.key)===n.eN.TextV2){const t=e.elements[0];[e.layout.width,e.layout.height]=t.extend_size}}else{var a,o;const i=e.elements[0];if(i.shadow){const e=c.shadowOffset({shadow:{enable:!0,angle:i.shadow_angle_v2,distance:i.shadow_distance}});[i.shadow_offset_x,i.shadow_offset_y]=e}const r={x:e.layout.scale[0],y:e.layout.scale[1]};if(null!==(a=i.extend_size)&&void 0!==a&&a[0]&&null!==(o=i.extend_size)&&void 0!==o&&o[1])[e.layout.width,e.layout.height]=i.extend_size;else{const t=h(new s.G(i));e.layout.width=e.layout.width*r.x+2*t.x,e.layout.height=e.layout.height*r.y+2*t.y}e.layout.scale=[1,1,1];const n=i.line_max_width;if(d(n)){const r=n*e.layout.width/t.node_width_v2;i.line_max_width=r,i.line_max_width_v1=r}}else e.child.forEach((e=>{f(e,t)}))}const y=e=>{const t=JSON.parse(e.richText),{range:i,...r}=t.styles[0];return t.styles.some(((e,t)=>{if(["strokes","shadows"].some((t=>{var i;if(null===(i=e[t])||void 0===i||!i.length)return!1;if(e[t].length>1)return!0;const r=e[t][0].content.render_type;return!(!r||"solid"===r)})))return!0;if(t){const{range:t,...i}=e;if((0,o.d)(r,i))return!0}return!1}))}},67393:(e,t,i)=>{"use strict";i.d(t,{g:()=>s});var r=i(82440),n=i(89811),a=i(67986),o=i(8757);class s{constructor(){this.initDependency=({id:e,resourceId:t,previewUrl:i,from:n,dependency:a})=>{if(r.fc.getDependency(t))return;let s,l;const c=new Promise(((e,i)=>{s=i=>{const n=r.fc.getDependency(t);n&&(n.isPreview=!1,n.previewUrl=void 0),e(i||n)},l=i})),d={id:e,resourceId:t,type:o.xP.SalesTextTemplate,isPreview:!0,previewUrl:i,ready:c,_resolve:s,_reject:l,from:n};r.fc.setDependency(t,d),a&&a.forEach((e=>{const t=(0,r.Nf)(e),{effectId:i,resourceId:a,name:s,panel:l}=t;l!==o.xP.Fonts&&l!==o.xP.CNFont||r.fc.getInstance().parser.text.initDependency({id:i,resourceId:a,from:n,type:l}),t.panel!==o.xP.Default&&t.panel!==o.xP.SalesSticker||r.fc.getInstance().parser.image.initDependency({name:s,id:a,resourceId:a,resource:t.resource,from:n})}))},this.cacheFont=(e,t,i,n)=>{if(!t.buffer)return;const a=Object.keys(t.buffer).find((e=>{const t=e.toLowerCase();return t.endsWith(".ttf")||t.endsWith(".otf")}));return a?(r.fc.getInstance().parser.text.initDependency({id:t.id,resourceId:e,type:n}),r.fO.addEntries([{key:e,resourceId:e,id:t.id,name:i,type:r.Mk.Local}]),r.fc.getInstance().parser.text.cacheFont({id:t.id,resourceId:e,filename:a,buffer:t.buffer[a],type:n})):void 0},this.cacheSticker=(e,t)=>{const{url:i,md5:n}=t;i&&n&&r.fc.getInstance().parser.image.fetchData({id:e,resourceId:e,resource:t.resource,type:o.xP.SalesSticker,fileUrl:{url:i,md5:n}})},this._collectTextDependResources=(e,t)=>{const i=JSON.parse(e.richText),r={};i.styles.forEach((e=>{const{id:i}=e.font,n=t[i];r[i]=n})),e.fontDependResources=Object.entries(r).map((([e,t])=>({id:t,resourceId:e})))}}static getInstance(){return s._instance||(s._instance=new s),s._instance}fetchData(e){const{id:t,resourceId:i,previewUrl:n="",contentJSON:o,dependency:s,sdkExtra:l,from:c}=e;this.initDependency({id:t,resourceId:i,previewUrl:n,dependency:s,from:c});const d=new Promise((t=>{r.fc.getInstance().push(e,(async n=>{const o=r.fc.getDependency(i);if(!0===n)return void t(await(null==o?void 0:o.ready));const s=await this.parse(e,n);var l;o?null===(l=o._resolve)||void 0===l||l.call(o,s):a.t.error(`text-template: id ${i} lost`);t(s)}))}));return n?Promise.resolve(this.parseThumb(o,null==l?void 0:l.depend_resource_list,e.dependency)):d}parse(e,t){var i,a,s;const l=null!==(i=null===(a=e.dependency)||void 0===a?void 0:a.reduce(((e,t)=>({...e,[t.ResourceId]:(0,r.Nf)(t)})),{}))&&void 0!==i?i:{},c=null===(s=e.sdkExtra)||void 0===s?void 0:s.depend_resource_list,d=t.reduce(((e,t)=>({...e,[t.resourceId]:t})),{}),u=new TextDecoder("utf-8").decode(d[e.resourceId].buffer["content.json"]),h=new n.xW(u,c).parse(),p=t.reduce(((e,t)=>({...e,[t.resourceId]:d[t.resourceId].id})),{});return h.forEach((e=>{if(e.type===o.F5.TEXT)this._collectTextDependResources(e,p),e.fontDependResources.forEach((e=>{const t=e.resourceId,i=l[t],r=d[t];i&&r&&this.cacheFont(t,r,i.name,i.panel)}));else if(e.type===o.F5.IMAGE){var t;const i=null===(t=e.src)||void 0===t?void 0:t.resourceId;i&&l[i]&&this.cacheSticker(e.src.resourceId,l[i])}})),h}parseThumb(e,t,i){var r;if(!e)return"";const a=null!==(r=null==i?void 0:i.reduce(((e,t)=>({...e,[t.ResourceId]:t.EffectId})),{}))&&void 0!==r?r:{},s=new n.xW(e,t).parse();return s.forEach((e=>{e.type===o.F5.TEXT&&this._collectTextDependResources(e,a)})),s}}},55351:(e,t,i)=>{"use strict";i.d(t,{B:()=>o,OM:()=>s,yd:()=>l});var r=i(26007),n=i(8757);function a(e){return!!e&&[n.no.ImageStyleConversion,n.no.ImageStyleAvatar].includes(e)}function o(e,t){return void 0!==e&&void 0!==t&&e===t||a(e)&&a(t)}function s(e,t,i,a){var o;if(!t)return{...e,pipelines:(0,r.R5)(null!==(o=null==e?void 0:e.pipelines)&&void 0!==o?o:[],(e=>e.toolType===n.no.ImageBackground||e.toolType===n.no.ImageCutout))};const s={toolType:n.no.ImageCutout,artifact:{uri:i,uriType:n.q$.ImageX,maskUri:a}};return e?{...e,pipelines:[s].concat((0,r.R5)(e.pipelines,(e=>e.toolType===n.no.ImageBackground||e.toolType===n.no.ImageCutout)))}:{pipelines:[s]}}function l(e,t,i){var a;if(!t)return{...e,pipelines:(0,r.R5)(null!==(a=null==e?void 0:e.pipelines)&&void 0!==a?a:[],(e=>e.toolType===n.no.ImageBackground))};const o=[{toolType:n.no.ImageBackground,artifact:{uri:i.backgroundUri,uriType:n.q$.ImageX}},{toolType:n.no.ImageCutout,artifact:{uri:i.cutoutUri,uriType:n.q$.ImageX,maskUri:i.cutoutMaskUri}}];return e?{...e,pipelines:o.concat((0,r.R5)(e.pipelines,(e=>e.toolType===n.no.ImageBackground||e.toolType===n.no.ImageCutout)))}:{pipelines:o}}},7430:(e,t,i)=>{"use strict";i.d(t,{Ex:()=>n,Kr:()=>s,Ty:()=>a,av:()=>o});var r=i(8757);function n(e){if(!e||e.type!==r.F5.GRID)return[];return e.areas.map((e=>e.fill.fillType===r.kl.IMAGE?e.fill.image.src:void 0)).filter((e=>Boolean(e)))}function a(e){return e.type===r.F5.GRID}function o(e){if(!e||e.type!==r.F5.GRID)return!1;return e.areas.some((e=>e.fill.fillType===r.kl.IMAGE))}function s(e){if(!o(e))return;return e.areas.map((e=>e.fill.fillType===r.kl.IMAGE?e.fill.image:void 0)).filter(Boolean)}},90949:(e,t,i)=>{"use strict";i.d(t,{A:()=>a,C:()=>n});var r=i(8757);function n(e){return e.type===r.F5.GROUP_LAYER}const a=e=>e.type===r.F5.GROUP_LAYER},49824:(e,t,i)=>{"use strict";i.d(t,{CU:()=>l,av:()=>c,tu:()=>o,uR:()=>s,yP:()=>a});var r=i(8757),n=i(21204);function a(e){if(!e||e.type!==r.F5.IMAGE_CONTAINER)return[];return e.items.map((e=>{if(e.fill.fillType===r.lm.IMAGE){const{image:t}=e.fill;return t?(0,n.pg)(t):void 0}})).filter((e=>Boolean(e)))}function o(e,t){if(!e||e.type!==r.F5.IMAGE_CONTAINER)return;return e.items.map((e=>e.fill.fillType===r.lm.IMAGE?e.fill.image:void 0)).filter((e=>Boolean(e)))[t]}function s(e){return e.type===r.F5.IMAGE_CONTAINER&&e.items.length>1}function l(e){return function(e){return e.type===r.F5.IMAGE_CONTAINER&&1===e.items.length}(e)||s(e)}function c(e){if(!e||e.type!==r.F5.IMAGE_CONTAINER)return!1;return e.items.some((e=>Boolean(e.fill.image)))}},21204:(e,t,i)=>{"use strict";i.d(t,{AL:()=>u,JP:()=>m,MD:()=>s,Or:()=>d,Qp:()=>y,U0:()=>c,fA:()=>g,i9:()=>v,ow:()=>f,pg:()=>_,px:()=>I,uo:()=>h});var r=i(8757),n=i(49824),a=i(67986),o=i(7430);function s(e){return e.type===r.F5.IMAGE}function l(e){return s(e)&&e.src.type}function c(e){const t=l(e);return t===r.lJ.Sticker||t===r.lJ.YkSicker}function d(e){const t=l(e);return t===r.lJ.CloudImageSticker||t===r.lJ.Cutout||t===r.lJ.ReplaceableCutout||t===r.lJ.YkImage}function u(e){var t,i,n,o;const s=null==e||null===(t=e.aiTool)||void 0===t?void 0:t.pipelines;if(null!=s&&null!==(i=s[0])&&void 0!==i&&i.toolType&&((null===(n=s[0])||void 0===n?void 0:n.toolType)===r.no.ImageCutout||(null===(o=s[0])||void 0===o?void 0:o.toolType)===r.no.ImageBackground))return s[0].toolType===r.no.ImageBackground?s[1].toolType!==r.no.ImageCutout?void a.t.error("cutout result not found."):{enable:!0,background:s[0].artifact.uri,uri:s[1].artifact.uri,maskUri:s[1].artifact.maskUri}:s[0].toolType===r.no.ImageCutout?{enable:!0,uri:s[0].artifact.uri,maskUri:s[0].artifact.maskUri}:void s[0].toolType}function h(e,t){if(e.type===r.F5.PAGE)return u(e.background.image);if(e.type===r.F5.IMAGE)return u(e);if(e.type===r.F5.IMAGE_CONTAINER&&void 0!==t){var i,n;const{fill:a}=null!==(i=null==e||null===(n=e.items)||void 0===n?void 0:n[t])&&void 0!==i?i:{};return(null==a?void 0:a.fillType)===r.lm.IMAGE?u(null==a?void 0:a.image):void 0}if(e.type===r.F5.GRID&&void 0!==t){var a,o;const{fill:i}=null!==(a=null==e||null===(o=e.areas)||void 0===o?void 0:o[t])&&void 0!==a?a:{};return(null==i?void 0:i.fillType)===r.kl.IMAGE?u(null==i?void 0:i.image):void 0}}function p(e){return null==e?void 0:e.aiTool}function f(e,t){if(e.type===r.F5.IMAGE)return p(e);if(e.type===r.F5.IMAGE_CONTAINER){var i,n;if(void 0===t)return;const{fill:a}=null!==(i=null==e||null===(n=e.items)||void 0===n?void 0:n[t])&&void 0!==i?i:{};if((null==a?void 0:a.fillType)===r.lm.IMAGE)return p(null==a?void 0:a.image)}else if(e.type===r.F5.GRID){var a,o;if(void 0===t)return;const{fill:i}=null!==(a=null==e||null===(o=e.areas)||void 0===o?void 0:o[t])&&void 0!==a?a:{};if((null==i?void 0:i.fillType)===r.kl.IMAGE)return p(null==i?void 0:i.image)}else if(e.type===r.F5.PAGE)return p(e.background.image)}function y(e){var t;if(e.type===r.F5.IMAGE)return null!==(t=e.replacePalette)&&void 0!==t&&t.enable?e.replacePalette:void 0}function g(e,t){const i=h(e,t);return Boolean(null==i?void 0:i.enable)}function m(e,t){const i=h(e,t);return g(e,t)&&Boolean(null==i?void 0:i.background)}function _(e){var t;if(null!==(t=e.aiTool)&&void 0!==t&&t.pipelines.length){const{artifact:t}=e.aiTool.pipelines[0];return{path:t.uri,resourceId:t.uriType===r.q$.Evercloud?t.md5:t.uri,type:t.uriType===r.q$.Evercloud?r.lJ.CloudImageSticker:r.lJ.Cutout}}const i=y(e);return i?{path:i.uri,type:e.src.type}:e.src}function v(e,t){const i=function(e,t){if(e.type===r.F5.IMAGE)return e.layout;if(e.type===r.F5.IMAGE_CONTAINER){const i=e.items[t],{fill:n}=i,{fillType:a}=n;return a===r.lm.IMAGE?n.image.layout:i.layout}if(e.type===r.F5.GRID){const i=e.areas[t],{fill:n}=i,{fillType:a}=n;if(a===r.kl.IMAGE)return n.image.layout}}(e,t);return i?e.type===r.F5.IMAGE&&i.clipRect?{width:i.clipRect.width,height:i.clipRect.height}:{width:i.width,height:i.height}:{width:0,height:0}}function I(e,t){if(s(e))return t(e)?e:void 0;if((0,n.CU)(e)&&(0,n.av)(e)){const i=e.items.findIndex((e=>!!e.fill.image&&t(e.fill.image)));if(-1===i)return;return{image:e.items[i].fill.image,position:i}}if((0,o.Ty)(e)&&(0,o.av)(e)){const i=e.areas.find((e=>!!e.fill.image&&t(e.fill.image)));if(i)return{areaId:i.id,image:i.fill.image}}}},75318:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});var r=i(8757);function n(e){return e.type===r.F5.LINE}},8325:(e,t,i)=>{"use strict";i.d(t,{Pz:()=>a,gQ:()=>o});var r=i(8757),n=i(49824);function a(e){if(![r.F5.GRID,r.F5.IMAGE,r.F5.IMAGE_CONTAINER].includes(e.type))return!1;switch(e.type){case r.F5.IMAGE:return Boolean(e.isMainImage);case r.F5.IMAGE_CONTAINER:return!!(0,n.av)(e)&&e.items.some((e=>{var t;return e.fill.fillType===r.lm.IMAGE&&(null===(t=e.fill.image)||void 0===t?void 0:t.isMainImage)}));case r.F5.GRID:return e.areas.some((e=>e.fill.fillType===r.kl.IMAGE&&e.fill.image.isMainImage));default:return!1}}function o(e){if(a(e)){if(e.type===r.F5.GRID){const t=e.areas.find((e=>e.fill.fillType===r.kl.IMAGE&&!!e.fill.image.isMainImage));return t?{areaId:t.id}:void 0}if(e.type===r.F5.IMAGE_CONTAINER){let t=-1;return e.items.forEach(((e,i)=>{var n;e.fill.fillType===r.lm.IMAGE&&null!==(n=e.fill.image)&&void 0!==n&&n.isMainImage&&(t=i)})),-1===t?void 0:{position:t}}}}},87606:(e,t,i)=>{"use strict";function r(e=1e9,t=9999999999){const i=Math.floor(Math.random()*(t-e+1))+e;return`${String(i)}${Date.now()}`}i.d(t,{L:()=>r})},38928:(e,t,i)=>{"use strict";i.d(t,{G:()=>d});var r=i(8757),n=i(7430),a=i(49824);function o(e){const t=[];if(!e)return t;return(0,a.yP)(e).forEach((e=>{e&&e.md5&&t.push(e.md5)})),t}function s(e){var t;const i=[];if(null===(t=e.aiTool)||void 0===t||!t.pipelines.length)return[];const{pipelines:n}=e.aiTool;return n.forEach((({artifact:{md5:e,uriType:t}})=>{e&&t===r.q$.Evercloud&&i.push(e)})),i}function l(e){const t=[];return e.items.forEach((e=>{const{fillType:i,image:n}=e.fill;i===r.lm.IMAGE&&n&&t.push(...s(n))})),t}function c(e){const t=[];do{if(![r.F5.IMAGE,r.F5.IMAGE_CONTAINER,r.F5.GROUP_LAYER,r.F5.GRID].includes(e.type))break;if(e.type===r.F5.GROUP_LAYER){var i;null===(i=e.children)||void 0===i||i.forEach((e=>t.push(...c(e))));break}if(e.type===r.F5.IMAGE_CONTAINER){const i=o(e);t.push(...i),t.push(...l(e));break}if(e.type===r.F5.GRID){var a;(0,n.Ex)(e).filter((e=>e.type===r.lJ.CloudImageSticker)).forEach((e=>t.push(e.md5))),null===(a=(0,n.Kr)(e))||void 0===a||a.forEach((e=>t.push(...s(e))));break}const d=e;t.push(...s(d));const{md5:u}=d.src;if(!u)break;t.push(u)}while(0);return t}function d(e){const t=[];return e.pages.forEach((e=>{var i;null!==(i=e.background)&&void 0!==i&&i.image&&t.push(...c(e.background.image)),e.layers.forEach((e=>t.push(...c(e))))})),Array.from(new Set(t))}},78101:(e,t,i)=>{"use strict";i.d(t,{I:()=>n});var r=i(8757);function n(e){return e.type===r.F5.SHAPE}},50650:(e,t,i)=>{"use strict";i.d(t,{Of:()=>o,Pk:()=>l,lj:()=>s,qd:()=>n});var r=i(8757);function n(e){return e.type===r.F5.TEXT}const a=e=>{let t,i=0;return Object.keys(e).forEach((r=>{const n=e[r];n>i&&(i=n,t=r)})),t},o=e=>{const t=JSON.parse(e.richText),i={};t.styles.forEach((e=>{var t,r;const n=e.range[1]-e.range[0],a=null!==(t=e.size)&&void 0!==t?t:12,o=null!==(r=i[a])&&void 0!==r?r:0;i[a]=o+n}));return a(i)},s=e=>JSON.parse(e.richText),l=e=>{const{richText:t,background:i}=e,r=JSON.parse(t),n={},o={},s={},l=e=>{const{color:t,alpha:i=1}=e;return t.map((e=>Math.round(255*e))).concat(i).join(",")},c=e=>{const t=a(e);return null==t?void 0:t.split(",").map(Number)};return r.styles.forEach((e=>{var t,i;const r=e.range[1]-e.range[0];if(e.fill&&"gradient"!==e.fill.content.render_type){var a;const t=l(e.fill.content.solid),i=null!==(a=n[t])&&void 0!==a?a:0;n[t]=i+r}null===(t=e.shadows)||void 0===t||t.forEach((e=>{if("gradient"!==e.content.render_type){var t;const i=l(e.content.solid),n=null!==(t=o[i])&&void 0!==t?t:0;o[i]=n+r}})),null===(i=e.strokes)||void 0===i||i.forEach((e=>{if(e.width&&"gradient"!==e.content.render_type){var t;const i=l(e.content.solid),n=null!==(t=s[i])&&void 0!==t?t:0;s[i]=n+r}}))})),{fill:c(n),shadow:c(o),stroke:c(s),background:null!=i&&i.enable?null==i?void 0:i.color:void 0}}},69326:(e,t,i)=>{"use strict";i.d(t,{o:()=>a});var r=i(76815),n=i(68967);function a(){const{width:e,height:t,scenario:i,unit:a}=(0,n.gO)(),o=Math.abs(parseFloat(null!=e?e:"")),s=Math.abs(parseFloat(null!=t?t:""));let l;var c;isNaN(o)||isNaN(s)||!["px","cm"].includes(null!=a?a:"")?l=null!==(c=r.l[null!=i?i:""])&&void 0!==c?c:r.modelDefault.page.dimension:l={width:o,height:s,unit:a};return l}},8757:(e,t,i)=>{"use strict";var r,n,a,o,s,l;i.d(t,{AF:()=>Ke,Us:()=>u,IH:()=>P,q$:()=>L,no:()=>R,B8:()=>k,xv:()=>Ue,Ac:()=>A,bt:()=>_,WK:()=>We,s4:()=>te,wI:()=>f,xb:()=>re,bM:()=>he,Nm:()=>ie,lF:()=>a,Wv:()=>U,ot:()=>Ae,Yl:()=>v,YM:()=>ce,tR:()=>Ge,lm:()=>g,vA:()=>I,BB:()=>b,K6:()=>Fe,Y0:()=>He,lN:()=>je,oI:()=>Be,cF:()=>c,kl:()=>D,wb:()=>d,ul:()=>pe,cM:()=>Me,Ms:()=>Ze,b_:()=>Oe,zI:()=>F,lJ:()=>B,IB:()=>Qe,Ll:()=>de,yU:()=>w,F5:()=>m,ms:()=>K,DW:()=>Se,xP:()=>r,CR:()=>Q,HY:()=>o,x1:()=>p,ch:()=>ne,q6:()=>ae,i5:()=>q,pI:()=>De,$l:()=>ue,nx:()=>Re,QB:()=>$e,iJ:()=>Je,d:()=>ee,Z$:()=>N,ry:()=>Ne,z_:()=>oe,Wq:()=>le,ii:()=>xe,$I:()=>be,d0:()=>Le,gy:()=>Ce,O4:()=>Pe,zX:()=>y,Cb:()=>se,UI:()=>n,TN:()=>et,PH:()=>x,rM:()=>O,hY:()=>ze,xx:()=>Z,fb:()=>z,l7:()=>h,Qf:()=>ke,d7:()=>Ee,DA:()=>ve,ng:()=>ge,Z0:()=>me,Y:()=>M,h_:()=>we,U_:()=>J,Vt:()=>$,XE:()=>Ie,Wk:()=>Te,Jy:()=>X,HW:()=>V,Py:()=>_e,nh:()=>fe,EK:()=>ye}),function(e){e.SalesSticker="sales-sticker",e.SvgSticker="svg-sticker",e.CNFont="cn-fonts",e.CNSalesTextTemplate="cn-sales-text-template",e.CNSalesSticker="cn-sales-sticker",e.SalesFont="fonts",e.SalesTextTemplate="sales-text-template",e.SalesTextGlow="sales-text-glow",e.SalesTextPreset="sales-text-preset",e.Svg="svg",e.Fonts="fonts",e.EverCloud="ever-cloud",e.ImageInTemplate="image-in-template",e.SalesFrame="sales-frame",e.SalesGrid="sales-grid",e.SalesFilter="sales-filter",e.SalesImageEffect="sales-image-effect",e.Default="default",e.YkImage="yk-image",e.AIBackground="ai_background",e.EffectModel="effect_model",e.SalesFontsCombination="sales_fonts_combination"}(r||(r={})),function(e){e[e.Loki=0]="Loki",e[e.HeyPan=1]="HeyPan",e[e.TuChong=2]="TuChong"}(n||(n={})),function(e){e.ERROR_SAVE_DRAFT="2001",e.ERROR_DRAFT_PARSE_ERROR="2008",e.ERROR_GET_DRAFT_TEMPLATE_FILE_ERROR="2003",e.ERROR_GET_DRAFT_VERSION_LIST_ERROR="2004",e.ERROR_DRAFT_NOT_FOUND="2005",e.ERROR_DRAFT_VERSION_CONFLICT="2006",e.ERROR_DRAFT_ILLEGAL="2007",e.ERROR_DRAFT_NOT_PERMISSION="1017",e.ERROR_DRAFT_DUPLICATE_CREATION="2010"}(a||(a={})),function(e){e.PNG="image/png",e.JPEG="image/jpeg"}(o||(o={})),function(e){e.PNG="PNG",e.JPEG="JPEG",e.PDF="PDF"}(s||(s={})),function(e){e.Success="Success",e.Failed="Failed",e.None="None"}(l||(l={}));var c,d,u,h,p,f,y,g,m,_,v,I,T,w,E,x,b,R,k,A,P;!function(e){e.LinearGradient="LinearGradient",e.RadialGradient="RadialGradient"}(c||(c={})),function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"}(d||(d={})),function(e){e[e.UpdateDocumentAction=0]="UpdateDocumentAction",e[e.AddPageAction=100]="AddPageAction",e[e.MovePageAction=101]="MovePageAction",e[e.RemovePageAction=102]="RemovePageAction",e[e.ResizePageAction=103]="ResizePageAction",e[e.AddLayerAction=200]="AddLayerAction",e[e.UpdateLayerAction=201]="UpdateLayerAction",e[e.DeleteLayerAction=202]="DeleteLayerAction",e[e.GroupLayerAction=203]="GroupLayerAction",e[e.UngroupLayerAction=204]="UngroupLayerAction",e[e.InsertTextTemplateAction=300]="InsertTextTemplateAction",e[e.ApplyTemplateAction=301]="ApplyTemplateAction",e[e.MultiAction=400]="MultiAction"}(u||(u={})),function(e){e.SEND_BACKWARD="send_backward",e.SEND_TO_BACK="send_to_back",e.BRING_FORWARD="bring_forward",e.BRING_TO_FRONT="bring_to_front"}(h||(h={})),function(e){e[e.UPDATE_DOCUMENT=0]="UPDATE_DOCUMENT",e[e.ADD_PAGE=100]="ADD_PAGE",e[e.REMOVE_PAGE=101]="REMOVE_PAGE",e[e.UPDATE_PAGE=102]="UPDATE_PAGE",e[e.ADD_LAYER=200]="ADD_LAYER",e[e.REMOVE_LAYER=201]="REMOVE_LAYER",e[e.UPDATE_LAYER=202]="UPDATE_LAYER",e[e.GROUP_LAYER=203]="GROUP_LAYER",e[e.UNGROUP_LAYER=204]="UNGROUP_LAYER"}(p||(p={})),function(e){e.INIT="init",e.LOCAL="local",e.COLLAB="collab",e.HISTORY="history",e.UNDO="undo",e.REDO="redo"}(f||(f={})),function(e){e.SvgSticker="svg_sticker"}(y||(y={})),function(e){e.IMAGE="image",e.COLOR="color"}(g||(g={})),function(e){e.PAGE="PAGE",e.GROUP_LAYER="GROUP_LAYER",e.TEXT="TEXT",e.IMAGE="IMAGE",e.LINE="LINE",e.SHAPE="SHAPE",e.IMAGE_CONTAINER="IMAGE_CONTAINER",e.GRID="GRID",e.SVG_IMAGE="SVG_IMAGE"}(m||(m={})),function(e){e.SOURCE_OVER="source-over",e.SOURCE_IN="source-in",e.SOURCE_OUT="source-out",e.SOURCE_ATOP="source-atop",e.DESTINATION_OVER="destination-over",e.DESTINATION_IN="destination-in",e.DESTINATION_OUT="destination-out",e.DESTINATION_ATOP="destination-atop",e.LIGHTER="lighter",e.COPY="copy",e.XOR="xor",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.DARKEN="darken",e.LIGHTEN="lighten",e.COLOR_DODGE="color-dodge",e.COLOR_BURN="color-burn",e.HARD_LIGHT="hard-light",e.SOFT_LIGHT="soft-light",e.DIFFERENCE="difference",e.EXCLUSION="exclusion",e.HUE="hue",e.SATURATION="saturation",e.COLOR="color",e.LUMINOSITY="luminosity"}(_||(_={})),function(e){e.FILTER="filter",e.EFFECT="effect"}(v||(v={})),function(e){e.LIGHT_SENSATION="lightSensation",e.BRIGHTNESS="brightness",e.CONTRAST="contrast",e.BRILLIANCE="brilliance",e.SATURATION="saturation",e.OLITEXTURE="oilTexture",e.SHARP="sharp",e.STRUCTURE="structure",e.HIGHLIGHT="highlight",e.SHADOW="shadow",e.TEMPERATURE="temperature",e.TONE="tone",e.GRAIN="grain",e.FADE="fade",e.EXPOSURE="exposure",e.VIBRANCE="vibrance",e.SHADOW_NEGATIVE="shadow_negative"}(I||(I={})),function(e){e[e.ERASE_ALGO_NONE=0]="ERASE_ALGO_NONE",e[e.ERASE_ALGO_INTELLIGENT=1]="ERASE_ALGO_INTELLIGENT",e[e.ERASE_ALGO_INTELLIGENT_INVERT=2]="ERASE_ALGO_INTELLIGENT_INVERT",e[e.ERASE_ALGO_NORMAL=3]="ERASE_ALGO_NORMAL"}(T||(T={})),function(e){e.Template="template",e.TextTemplate="textTemplate",e.TextToDraft="text2draft",e.ColorCard="colorCard",e.AiModel="aiModel",e.AiBackground="aiBackground"}(w||(w={})),function(e){e.NONE="none",e.VERTICAL_LINE="vertical_line",e.ARROW="arrow",e.SOLID_ARROW="solid_arrow",e.CIRCLE="circle",e.SOLID_CIRCLE="solid_circle",e.RECT="rect",e.SOLID_RECT="solid_rect",e.RHOMBUS="rhombus",e.SOLID_RHOMBUS="solid_rhombus"}(E||(E={})),function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM"}(x||(x={})),function(e){e.SalesFont="fonts",e.CNSalesFont="cn-fonts"}(b||(b={})),function(e){e[e.TextToImage=1]="TextToImage",e[e.ImageToImage=2]="ImageToImage",e[e.ImageStyleAvatar=3]="ImageStyleAvatar",e[e.ImageNightEnhance=4]="ImageNightEnhance",e[e.ImageStyleConversion=5]="ImageStyleConversion",e[e.ImageUpscaler=6]="ImageUpscaler",e[e.ImageAiToning=7]="ImageAiToning",e[e.ImageColoring=8]="ImageColoring",e[e.ImageRestoration=9]="ImageRestoration",e[e.ImageCutout=2e3]="ImageCutout",e[e.ImageBackground=2001]="ImageBackground"}(R||(R={})),function(e){e.TextToImage="text_to_image",e.ImageToImage="image_to_image",e.TextToDesign="text_to_draft",e.ImageStyleAvatar="portrait_generator",e.ImageNightEnhance="low_light_image_enhancement",e.ImageStyleConversion="image_style_transfer",e.ImageUpscaler="image_upscaler",e.ImageAiToning="ai_color_correction",e.ImageRestoration="old_photo_restoration",e.AiModel="ai_model_tryon",e.AiBackground="ai_background",e.AutoLayout="auto_layout",e.Batch="batch",e.default=""}(k||(k={})),function(e){e.MaterialUpload="material_upload",e.BackgroundUpload="background_upload",e.TtdUpload="t2d_upload"}(A||(A={})),function(e){e.YES="1",e.NO="0"}(P||(P={}));const M=e=>{switch(e){case R.ImageStyleAvatar:return k.ImageStyleAvatar;case R.ImageNightEnhance:return k.ImageNightEnhance;case R.ImageStyleConversion:return k.ImageStyleConversion;case R.ImageUpscaler:return k.ImageUpscaler;case R.ImageAiToning:return k.ImageAiToning;case R.ImageRestoration:return k.ImageRestoration;case R.TextToImage:return k.TextToImage;case R.ImageToImage:return k.ImageToImage;default:return k.default}};var L,S,C,O,F,N,D,U,B,G,j,H,W,z;!function(e){e[e.Heycan=0]="Heycan",e[e.Giphy=1]="Giphy",e[e.Vcloud=2]="Vcloud",e[e.Evercloud=3]="Evercloud",e[e.ImageX=4]="ImageX",e[e.TuChong=5]="TuChong"}(L||(L={})),function(e){e[e["360P"]=1]="360P",e[e["480P"]=2]="480P",e[e["720P"]=3]="720P",e[e["1080P"]=4]="1080P",e[e["2K"]=5]="2K",e[e["4K"]=6]="4K",e[e["8K"]=7]="8K"}(S||(S={})),function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six"}(C||(C={})),function(e){e[e.HorizontalScreen=1]="HorizontalScreen",e[e.VerticalScreen=2]="VerticalScreen",e[e.SquareScreen=3]="SquareScreen"}(O||(O={})),function(e){e.OUTLINE="outline",e.GLOW="glow",e.FEATHER="feather",e.SHADOW="shadow"}(F||(F={})),function(e){e[e.Internal=0]="Internal",e[e.Loki=1]="Loki"}(N||(N={})),function(e){e.NONE="none",e.COLOR="color",e.IMAGE="image"}(D||(D={})),function(e){e[e.COLOR=1]="COLOR",e[e.TEXTURE=2]="TEXTURE"}(U||(U={})),function(e){e.Sticker="sticker",e.YkSicker="yk_sticker",e.CloudImageSticker="everphoto",e.ReplaceableCutout="replaceable_cutout",e.Cutout="cutout",e.Graffiti="graffiti",e.Svg="svg",e.YkImage="yk_image",e.Raw="raw"}(B||(B={})),function(e){e.Template="template",e.Cutout="cutout",e.Background="background",e.Resize="resize",e.Position="position"}(G||(G={})),function(e){e.Original="original",e.Center="center",e.Template="template"}(j||(j={})),function(e){e.Preset="preset",e.Template="template"}(H||(H={})),function(e){e.Color="color",e.File="file",e.Generate="generate"}(W||(W={})),function(e){e.PX="px",e.CM="cm"}(z||(z={}));const V=60,$=5e3,Y=96/2.54,X=Number((V/Y).toFixed(3)),J=Number(($/Y).toFixed(3));var K,q,Z,Q,ee,te,ie,re;!function(e){e.ASPECT_FIT="aspect_fit",e.CENTER="center",e.SCALE_FILL="scale_fill",e.FIXED="fixed",e.ASPECT_FILL="aspect_fill"}(K||(K={})),function(e){e[e.PORTRAIT=0]="PORTRAIT",e[e.VERTICAL=1]="VERTICAL"}(q||(q={})),function(e){e[e.init=0]="init",e[e.edit=1]="edit"}(Z||(Z={})),function(e){e.Canvas="canvas",e.Element="elements"}(Q||(Q={})),function(e){e.Include="include",e.Overlap="overlap",e.Opposite="opposite",e.Horizontal="horizontal",e.Vertical="vertical"}(ee||(ee={})),function(e){e.MATERIAL_TEMPLATES="material_templates",e.MATERIAL_STICKER="material_sticker",e.MATERIAL_SHAPE="material_shape",e.MATERIAL_FRAME="material_frame",e.MATERIAL_EVER_CLOUD="material_ever_cloud",e.MATERIAL_TEXT="material_text",e.MATERIAL_DESIGN="material_design",e.MATERIAL_PHOTO="material_photo",e.MATERIAL_APPS="material_apps",e.MATERIAL_GRID="material_grid"}(te||(te={})),function(e){e[e.LEFT=0]="LEFT",e[e.UP=1]="UP",e[e.RIGHT=2]="RIGHT",e[e.DOWN=3]="DOWN"}(ie||(ie={})),function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End"}(re||(re={}));const ne=-1,ae=-1;var oe,se;!function(e){e.BleedLine="BleedLine",e.MarginLine="MarginLine",e.RulerLine="RulerLine"}(oe||(oe={})),function(e){e.PAGE="PAGE",e.KONVA_LAYER="KONVA_LAYER",e.KONVA_STAGE="KONVA_STAGE",e.PAGE_CONTAINER="PAGE_CONTAINER",e.RULER_LINE="RulerLine"}(se||(se={}));const le={...m,...se};var ce,de,ue,he,pe;!function(e){e[e.Select=0]="Select",e[e.ModelChange=1]="ModelChange",e[e.LayerListSelect=2]="LayerListSelect"}(ce||(ce={})),function(e){e.Mouse="mouse",e.Hand="hand"}(de||(de={})),function(e){e.Zoom="zoom",e.Move="move",e.Resize="resize",e.Fit="Fit"}(ue||(ue={})),function(e){e.Contextmenu="contextmenu",e.RulerMenu="rulerMenu",e.RulerLineMenu="rulerLineMenu"}(he||(he={})),function(e){e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e.HORIZONTAL_ISOMETRIC_LINE="HORIZONTAL_ISOMETRIC_LINE",e.VERTICAL_ISOMETRIC_LINE="VERTICAL_ISOMETRIC_LINE",e.PAGE_MARGIN_LINE="PAGE_MARGIN_LINE",e.RULER_LINE="RULER_LINE"}(pe||(pe={}));const fe="top-left",ye="top-right",ge="bottom-left",me="bottom-right",_e="top-center",ve="bottom-center",Ie="middle-left",Te="middle-right",we="custom-rotater",Ee="back";var xe,be,Re,ke,Ae;!function(e){e[e.horizontal=0]="horizontal",e[e.vertical=1]="vertical",e[e.all=2]="all"}(xe||(xe={})),function(e){e[e.horizontal=0]="horizontal",e[e.vertical=1]="vertical"}(be||(be={})),function(e){e[e.editable=0]="editable",e[e.readonly=1]="readonly"}(Re||(Re={})),function(e){e[e.MIN=.1]="MIN",e[e.MAX=5]="MAX"}(ke||(ke={})),function(e){e.Main="main",e.CoverEditorPC="coverEditorPC",e.CoverEditorWeb="coverEditorWeb",e.BatchEditor="batchEditor"}(Ae||(Ae={}));const Pe=40,Me=56,Le=22;var Se,Ce,Oe;!function(e){e[e.MIN_WIDTH=2]="MIN_WIDTH",e[e.MIN_HEIGHT=2]="MIN_HEIGHT",e[e.MAX_HEIGHT=5e3]="MAX_HEIGHT",e[e.MAX_WIDTH=5e3]="MAX_WIDTH"}(Se||(Se={})),function(e){e[e.MIN_WIDTH=2]="MIN_WIDTH",e[e.MIN_HEIGHT=2]="MIN_HEIGHT",e[e.MAX_HEIGHT=8192]="MAX_HEIGHT",e[e.MAX_WIDTH=8192]="MAX_WIDTH"}(Ce||(Ce={})),function(e){e.Default="web_domain"}(Oe||(Oe={}));const Fe="root",Ne="page-resize",De="page-edit",Ue="guide-editor-graphic",Be="guide_editor_graphic_space_upgrade_",Ge="ExportProduct",je="GLOBAL_GUIDE_SAFE_TO_DEFAULT_SPACE",He="guide_editor_graphic_google_drive_";var We,ze,Ve,$e,Ye,Xe,Je;!function(e){e.ColorCard="colorCard",e.ThemeCard="themeCard",e.PhotoCard="photoCard",e.FontCard="fontCard"}(We||(We={})),function(e){e.Dark="dark",e.Light="light"}(ze||(ze={})),function(e){e.Theme="lv-theme"}(Ve||(Ve={})),function(e){e.ERROR_ORDER_EXCEED_LIMIT="2037"}($e||($e={})),function(e){e[e.EffectTypeAudioEffect=3]="EffectTypeAudioEffect",e[e.EffectTypeSong=4]="EffectTypeSong",e[e.EffectTypeVideo=5]="EffectTypeVideo",e[e.EffectTypeImage=9]="EffectTypeImage"}(Ye||(Ye={})),function(e){e.TrackEditor="track_editor",e.Export="export"}(Xe||(Xe={})),function(e){e[e.HeyCan=1]="HeyCan",e[e.TuChong=5]="TuChong"}(Je||(Je={}));const Ke=348188;var qe,Ze,Qe,et,tt;!function(e){e[e.UGC=1]="UGC",e[e.PGC=2]="PGC",e[e.UGC_CN=3]="UGC_CN",e[e.AIGC=4]="AIGC",e[e.SUPPLIER=5]="SUPPLIER"}(qe||(qe={})),function(e){e[e.EffectTypeWordArt=1]="EffectTypeWordArt",e[e.EffectTypeSticker=2]="EffectTypeSticker",e[e.EffectTypeAudioEffect=3]="EffectTypeAudioEffect",e[e.EffectTypeSong=4]="EffectTypeSong",e[e.EffectTypeVideo=5]="EffectTypeVideo",e[e.EffectTypeTextTemplate=6]="EffectTypeTextTemplate",e[e.EffectTypeSpecialEffect=7]="EffectTypeSpecialEffect",e[e.EffectTypeFaceTool=8]="EffectTypeFaceTool",e[e.EffectTypeImage=9]="EffectTypeImage",e[e.EffectTypeFont=10]="EffectTypeFont",e[e.EffectTypeTimbre=11]="EffectTypeTimbre",e[e.EffectTypeFilter=12]="EffectTypeFilter",e[e.EffectTypeVideoAnimation=13]="EffectTypeVideoAnimation",e[e.EffectTypeColor=14]="EffectTypeColor",e[e.EffectTypeTextAnimation=18]="EffectTypeTextAnimation",e[e.EffectTypeTransitions=19]="EffectTypeTransitions",e[e.EffectTypeRecipe=50]="EffectTypeRecipe",e[e.EffectTypeWordArtCollection=101]="EffectTypeWordArtCollection",e[e.EffectTypeStickerCollection=102]="EffectTypeStickerCollection",e[e.EffectTypeAudioEffectCollection=103]="EffectTypeAudioEffectCollection",e[e.EffectTypeVideoEffectCollection=104]="EffectTypeVideoEffectCollection",e[e.EffectTypeEmoticonCollection=105]="EffectTypeEmoticonCollection",e[e.EffectTypeTextTemplateCollection=106]="EffectTypeTextTemplateCollection",e[e.EffectTypeImageCollection=109]="EffectTypeImageCollection",e[e.EffectTypeFilterCollection=112]="EffectTypeFilterCollection",e[e.EffectTypeVideoImage=201]="EffectTypeVideoImage"}(Ze||(Ze={})),function(e){e.Default="default",e.TextEdit="text-edit"}(Qe||(Qe={})),function(e){e[e.BottomLine=0]="BottomLine",e[e.Suggestion=1]="Suggestion"}(et||(et={})),function(e){e.Common="Common",e.Text="Text",e.Image="Image",e.Container="Container",e.Grid="Grid"}(tt||(tt={}))},62406:()=>{},4934:(e,t,i)=>{"use strict";i(72045),i(32706),i(16373),i(65667),i(41194),i(73430),i(43263),i(13836),i(48128),i(3606),i(77784),i(75070),i(18052),i(45757),i(31500),i(19159),i(80711),i(25739),i(14680),i(70166),i(28601),i(11941),i(0),i(26012),i(75802),i(22374),i(64077),i(74702),i(49102),i(24011),i(24709),i(14028),i(5679),i(44030),i(96917),i(8206),i(99094),i(54325),i(86871),i(38260),i(99448),i(21211),i(86428),i(98636),i(64879),i(83416),i(32074),i(31584),i(48998),i(25547),i(20993),i(30656),i(60078),i(61093),i(53913),i(35783),i(27748),i(70766),i(96759),i(52731),i(52762),i(50157),i(7871),i(45459),i(39768),i(53756),i(8686),i(8516),i(63749),i(65442),i(4826),i(14338),i(65885),i(86877),i(85008),i(49006),i(45316),i(64048),i(19899),i(15854),i(40229),i(95017),i(78328),i(7518),i(98940),i(31607),i(21029),i(30506),i(63034),i(39336),i(81533),i(76),i(99852),i(3753),i(93743),i(58631),i(92271),i(77923),i(41245),i(77363),i(68497),i(3587),i(83550),i(63204),i(9591),i(73420),i(76778),i(85589),i(21528),i(18865),i(4461),i(75147),i(238),i(20582),i(20274),i(78318),i(81951),i(18397),i(9228),i(50888),i(95508),i(60330),i(7304),i(95902),i(68155),i(94405),i(59569),i(93485),i(24271),i(24161),i(40459),i(43618),i(82669),i(27027),i(10346),i(6198),i(95409),i(18929),i(64559),i(14485),i(80314),i(33752),i(43667),i(48974),i(9606),i(46134),i(79560),i(85569),i(88977),i(84340),i(65882),i(5974),i(57281),i(70565),i(82735),i(24741),i(76348),i(47883),i(78702),i(98491),i(18762),i(69227),i(77394),i(61283),i(53425),i(1325),i(70501),i(91551),i(89738),i(80442),i(51144),i(76434),i(12931),i(60246),i(26758),i(11518),i(77666),i(32244),i(77036),i(58846),i(98849),i(96147),i(7935),i(48473),i(10257),i(39883),i(37232),i(37117),i(78250),i(4888),i(48014),i(67558),i(45587),i(22295),i(41381),i(12558),i(80124),i(17332),i(57359),i(28512),i(12201),i(68374),i(30526),i(71425),i(85627),i(49058),i(45195),i(474),i(69684),i(64656),i(63198),i(84740),i(38693),i(92785),i(37674),i(57689),i(2),i(13940),i(91109),i(78816)},13670:()=>{"use strict";window.__assetPrefix__="//lf16-web-buz.capcut.com/obj/capcut-web-buz-us/ies/lvweb/graphic_online"}}]);