"use strict";(globalThis.webpackChunkgraphic=globalThis.webpackChunkgraphic||[]).push([[635],{45119:(e,t,r)=>{r.d(t,{z:()=>o});const o={appid:r(8757).AF,channel:"va",enableAbTest:!0,abChannelDomain:"https://vmweb-sg.byteoversea.com",disableWebId:!1,isProd:Boolean(!0),disableAutoReportPv:!0,appVersion:"1.0.0.1212",commonReportParams:{current_page:"picture_edit"}}},45500:(e,t,r)=>{r.d(t,{g:()=>o,t:()=>i});var o,n=r(37722);!function(e){e.SERVICE_EXCEPTION="service exception",e.PROJECT_NOT_EXIST="project does not exist",e.BROWSER_NOT_SUPPORT="browser not supported",e.DRAFT_BROKEN="draft broken",e.DEVICE_NOT_SUPPORT="device not supported",e.NOT_PERMISSION="not have permission",e.MOBILE_NOT_SUPPORT="mobile not supported",e.COOKIES_DISABLED="cookies disabled"}(o||(o={}));class i extends n.C{constructor(e,t=[]){super(),this.eventName="draft_open_fail",this.unsupported=[],this.failReason=e,this.unsupported=t}getEventParams(){return{fail_reason:this.failReason,unsupported:this.unsupported.join(",")}}}},12090:(e,t,r)=>{r.d(t,{m:()=>n});var o=r(37722);class n extends o.C{constructor(e){super(),this.options=e,this.eventName="effect_load_draft_restore"}getEventParams(){var e,t;return{is_effect_ready:null!==(e=this.options.isEffectReady)&&void 0!==e?e:0,is_new_draft:null!==(t=this.options.isNewDraft)&&void 0!==t?t:0}}}},25947:(e,t,r)=>{r.d(t,{m:()=>i});var o=r(37722),n=r(68967);class i extends o.C{constructor(e){super(),this.eventName="enter_picture_edit_page",this._pageType=e}setIsUseRulers(e){this._isUseRulers=e?1:0}setIsUseGuide(e){this._isUseGuide=e?1:0}setIsUseMargin(e){this._isUseMargin=e?1:0}setIsUsePrintBleed(e){this._isUsePrintBleed=e?1:0}getEventParams(){var e,t;const r=(0,n.gO)(),o=r.from_page||"first_page";return{from_page:o,enter_from:r.enter_from||"first_page",position:"article_page"===o?"":null!==(e=r.position)&&void 0!==e?e:"",scale:r.scale,scenario:r.scenario,space_id:r.space_id,space_type:r.space_type,raw_space_type:r.raw_space_type,space_user_cnt:r.space_user_cnt,video_type_id:r.video_type_id,template_id:r.create_id,article_type:r.article_type,article_title:null!==(t=r.article_title)&&void 0!==t?t:"",page_type:this._pageType,is_use_rulers:this._isUseRulers,is_use_guide:this._isUseGuide,is_use_margin:this._isUseMargin,is_use_print_bleed:this._isUsePrintBleed,template_search_id:r.template_search_id,template_search_no_result:r.template_search_no_result,template_tab_name:r.template_tab_name}}}},30047:(e,t,r)=>{r.d(t,{g:()=>s});var o=r(68967),n=r(52609),i=r(37722);function s(e,t){var s,a,c,l;const{enter_from:u="",create_id:d="",from_page:f="",err_code:h=0,server_cost_time:p}=(0,o.gO)();const v={};["id","name","startTime","duration"].forEach((t=>{var r;v[t]=null!==(r=e[t])&&void 0!==r?r:""}));const g=(0,n.Y)();v.domain=r.g.location.host,v.effectWasmCached=null!==(s=null===(a=r.g.ccWebPerf)||void 0===a?void 0:a.effectWasmCached)&&void 0!==s?s:0,v.isNewDraft=t?1:0,v.enterFrom=u,v.serverErrCode=h,v.htmlLoadDuration=null!==(c=null==g?void 0:g.htmlLoadDuration)&&void 0!==c?c:-1,v.redirectDuration=null!==(l=null==g?void 0:g.redirectDuration)&&void 0!==l?l:-1,v.serverCreateDraftDuration=null!=p?p:-1,v.createId=d,v.fromPage=f,i.I.getInstance().reportEvent("graphic_editor_perf",v)}},42406:(e,t,r)=>{r.d(t,{U:()=>o});const o=new(r(24191).$$)},97385:(e,t,r)=>{r.d(t,{t:()=>i});var o=r(8757);const n=r.p+"static/rubik-light.d7e4fa44.zip";let i;i={effectId:"20107232",resourceId:"7215557092847915521",type:o.xP.SalesFont,uri:n,md5:"bec1971a8c6d60873d41854fa9dd2c8d",isDefaultFont:!0,fontName:"Rubik-Light"}},69197:(e,t,r)=>{r.d(t,{m:()=>o});const o=(0,r(67126).yh)("ai-tool-common")},93313:(e,t,r)=>{r.d(t,{g:()=>M});var o=r(98720),n=r(18781),i=r(13659),s=r(42058),a=r(86245),c=r(58201),l=r(8757),u=r(50246),d=r(27319),f=r(26690),h=r(36702),p=r(24451),v=r(27175),g=r(14906),y=r(9339),m=r(72322);function _(){return new Promise((e=>{function t(){r.close(),e(!1)}const r=h.Z.confirm({title:null,simple:!0,closeIcon:null,autoFocus:!1,escToExit:!1,maskClosable:!1,footer:(0,m.jsxs)("div",{className:"illinoisPopup__footer",children:[(0,m.jsx)(p.Z,{onClick:t,size:"large",children:v.oc.t("web_magicTools_button_back",{},"Go back")}),(0,m.jsx)(p.Z,{onClick:function(){r.close(),e(!0)},size:"large",type:"primary",children:v.oc.t("web_magicTools_button_continue",{},"Continue")})]}),wrapClassName:"illinoisPopup",content:(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"illinoisPopup__title",children:[v.oc.t("web_magicTools_text_ready_to_create",{},"Ready to create?"),(0,m.jsx)("div",{className:"illinoisPopup__close",children:(0,m.jsx)(g.TmF,{className:"close-icon",onClick:t})})]}),(0,m.jsx)("div",{className:"illinoisPopup__content",children:(0,m.jsxs)("span",{children:[v.oc.t("web_magicTools_toast_toast_text",{},"To enable effects, help keep our product safe, and provide an improved experience, we collect and use information about faces and voices each time you use face- and voice- related effects and filters on CapCut. This information isn\u2019t used to identify you."),v.oc.t("web_magicTools_text_agree_continue",{},"To agree, tap \u201cContinue\u201d."),"\xa0",v.oc.t("web_magicTools_toast_learn_more",{"text-href":e=>(0,m.jsx)("a",{onClick:e=>{e.preventDefault(),function(){const{Paragraph:e}=y.default;h.Z.info({icon:null,title:v.oc.t("web_magicTools_toast_how_we_process",{},"How we process face and voice information"),footer:null,className:"legal-policy-modal",content:(0,m.jsxs)("div",{children:[(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_roll_out",{},"If you choose to use face- and voice-related effects and filters, we collect and analyze face and voice information in videos, photos, templates, and other effects you uploaded. For example, an effect that adds sunglasses to your face may need to know where your eyes are on the screen to correctly position the sunglasses on your face. Similarly, a voice filter may need to identify your pitch to make you sound more like a robot.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_one",{},"We also collect and analyze face and voice information in videos, photos, and other effects to improve safety and user experience, to recommend and moderate content, and for analytics and demographic classification, such as inferred age range.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_two",{},"By uploading videos, photos, and templates and using filters, effects, and templates, you agree to allow CapCut to use the face and voice information upoaded by you for these purposes. If you don\u2019t agree to your face or voice information being used for these purposes:")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_three",{},"\u2022 Don\u2019t upload videos, photos or templates or use filters, templates, and effects")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_four",{},"\u2022 Delete any videos or photos you uploaded to CapCut")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_five",{},"If you delete your CapCut account, any face- or voice-related information associated with your account will also be deleted.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_six",{},"Important things to know when you create or post content on CapCut:")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_seven",{},"\u2022 If other people appear in your videos, photos, effects, or templates, you\u2019re responsible for making sure CapCut has the consent to collect and analyze their face and voice information.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_eight",{},"\u2022 We don\u2019t use any face or voice information to identify you or other people in your videos, templates, effects, or photos, and we don't share such information with third parties.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_nine",{},"\u2022 Once a filter, template, or effect that uses face or voice information has been added to your content, that information is deleted.")}),(0,m.jsx)(e,{children:v.oc.t("web_magicTools_text_notice_ten",{},"\u2022 Once your video, photo, or template has been analyzed for any other purpose described above, the face- and voice-related information collected is deleted.")})]})})}()},className:"illinoisPopup__link",children:e})},"<text-href>Learn more</text-href>")]})})]})})}))}var b,R,w,S,k,T=r(22329),C=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e,t){return function(r,o){t(r,o,e)}};!function(e){e.Manga="prequel_cartoon",e.HongKongCartoon="hkcartoon",e.OilPaint="cartoon_oilpaintv2_img2img"}(S||(S={})),function(e){e.ThreeDCartoon="tupo_cartoon",e.Pop="bopu_cartoon_abroad_pixsoul",e.Manga="prequel_cartoon",e.ThreeDGame="3dgame_cartoon_abroad",e.HongKongCartoon="hkcartoon"}(k||(k={}));const O="smart-tools-illinios-check";let M=class{constructor(e,t,r){this._browserStorageService=t,this.accountService=r,this._loadingTasks=[],this._draftId="",this.cachedRemoteCheck=(0,a.Z)((()=>this._aiCreateService.aiCreate.aiCheckPopup()),(()=>this.accountService.hasLogin)),this._aiCreateService=e,this._cacheMap={},this._passLegalCheck=(0,o.PQ)()}setDraftId(e){this._draftId=e}isRiskyToolType(e){return[l.no.ImageStyleAvatar,l.no.ImageStyleConversion,l.no.ImageRestoration].includes(e)}maybeWaitForLegalCheck(e){return this.isRiskyToolType(e)?this._passLegalCheck.promise:Promise.resolve()}getAiReportParams(e,t){const r={};switch(e){case l.no.ImageAiToning:case l.no.ImageNightEnhance:r.enhance_level=null==t?void 0:t.level;break;case l.no.ImageRestoration:r.restore_mode=1===(null==t?void 0:t.level)?"original":"colored";break;case l.no.ImageUpscaler:const{scale:e=2,width:o=0,height:n=0}=t;r.resolution=e,r.original_resolution=`${o/e}*${n/e}`;break;case l.no.ImageStyleAvatar:switch(null==t?void 0:t.styleKey){case k.HongKongCartoon:r.style="hong_kong_cartoon";break;case k.Manga:r.style="manga";break;case k.Pop:r.style="pop";break;case k.ThreeDCartoon:r.style="3d_cartoon";break;case k.ThreeDGame:r.style="3d_game"}break;case l.no.ImageStyleConversion:switch(null==t?void 0:t.styleKey){case S.HongKongCartoon:r.style="hong_kong_cartoon";break;case S.Manga:r.style="manga";break;case S.OilPaint:r.style="oil_painting"}}return r}async generate(e){const t=Date.now();await this.maybeWaitForLegalCheck(e.aiToolType);const{aiToolType:r,params:a}=e,c=this.matchCache(e);if(c)return await(0,n.D)(200),(0,i.oW)(c);if([l.no.ImageAiToning,l.no.ImageNightEnhance,l.no.ImageRestoration].includes(r)){const t=this._loadingTasks.find((t=>this.isSameBatchParams(t.createReq,e)));if(t){const r=await t.resultDeferred.promise;if(r.ok){const t=this.matchCache(e);return(0,s.Y2)(t),(0,i.oW)(t)}return r}}const u={createReq:e,resultDeferred:(0,o.PQ)()};this._loadingTasks.push(u);const[d,f]=(await this._aiCreateService.aiCreate.aiCreate(e)).pair();if(d)return u.resultDeferred.resolve(d),this._loadingTasks=this._loadingTasks.filter((e=>e!==u)),(0,T.r)({tool_type:(0,l.Y)(r),status:"fail",duration:Date.now()-t,draft_id:this._draftId,fail_reason:d.msg,...this.getAiReportParams(r,a)}),d;const[h,p]=(await this._aiCreateService.aiCreate.aiProcessQuery(f)).pair();if(h)return u.resultDeferred.resolve(h),this._loadingTasks=this._loadingTasks.filter((e=>e!==u)),(0,T.r)({tool_type:(0,l.Y)(r),status:"fail",duration:Date.now()-t,draft_id:this._draftId,fail_reason:h.msg,...this.getAiReportParams(r,a)}),h;switch(r){case l.no.ImageAiToning:case l.no.ImageNightEnhance:case l.no.ImageRestoration:{let o={};return p.forEach((t=>{t.level===a.level&&(o=this.getImageInfoFromAiResource(t)),this._cacheMap[f+t.level]={createReq:{...e,params:{level:t.level}},queryRes:{createTime:Date.now(),platform:t.platform,...this.getImageInfoFromAiResource(t)}}})),(0,T.r)({tool_type:(0,l.Y)(r),status:"success",duration:Date.now()-t,draft_id:this._draftId,...this.getAiReportParams(r,a)}),u.resultDeferred.resolve((0,i.ly)()),(0,i.oW)(o)}case l.no.ImageUpscaler:case l.no.ImageStyleAvatar:case l.no.ImageStyleConversion:{const o=p[0],n=this.getImageInfoFromAiResource(o);return this._cacheMap[f]={createReq:{...e,params:a},queryRes:{createTime:Date.now(),platform:o.platform,...n}},(0,T.r)({tool_type:(0,l.Y)(r),status:"success",duration:Date.now()-t,draft_id:this._draftId,...this.getAiReportParams(r,a)}),(0,i.oW)(n)}case l.no.TextToImage:case l.no.ImageToImage:return(0,T.r)({tool_type:(0,l.Y)(r),status:"success",duration:Date.now()-t,draft_id:this._draftId,...this.getAiReportParams(r,a)}),(0,i.oW)(p.map(this.getImageInfoFromAiResource));case l.no.ImageCutout:case l.no.ImageBackground:case l.no.ImageColoring:(0,s.ss)();default:(0,s.bP)(r)}}generateAIGC(e){return this.generate(e)}async preload(e){await this.maybeWaitForLegalCheck(e.aiToolType),this._loadingTasks.find((t=>this.isSameBatchParams(t.createReq,e)))||this.generate(e)}matchCache(e){if(e.aiToolType===l.no.TextToImage||e.aiToolType===l.no.ImageToImage)return;const t=Object.entries(this._cacheMap).find((([t,{createReq:r,queryRes:o}])=>(0,c.Z)(r,e)&&Date.now()-o.createTime<216e5));return null==t?void 0:t[1].queryRes}getImageInfoFromAiResource(e){return{uri:e.resource_id,url:e.image.url,platform:e.platform,md5:e.md5,filename:e.resource_name,image_width:Number(e.width),image_height:Number(e.height),url_list:e.image.url_list.map((e=>({image_height:Number(e.height),image_width:Number(e.width),url:e.url}))),preview_key:e.image.preview_key}}async checkLegalAgreement(e){if(this.hasCheckedAgreementLocally())return void this._passLegalCheck.resolve();const t=await this.cachedRemoteCheck();if(!t.ok||!t.value.need_check)return void this._passLegalCheck.resolve();await _()?(this._passLegalCheck.resolve(),this.handleCheckedAgreement()):null==e||e()}getLegalStorageKey(){return this.accountService.hasLogin?`${O}-${this.accountService.userProfile.uid}`:O}handleCheckedAgreement(){this._browserStorageService.keyValue.set(this.getLegalStorageKey(),"true"),this.accountService.hasLogin&&this._aiCreateService.aiCreate.aiConfirmPopup()}hasCheckedAgreementLocally(){const e=this.getLegalStorageKey(),t=this._browserStorageService.keyValue.query(e);return!t.ok||"true"===t.value}isSameBatchParams(e,t){return e.aiToolType===t.aiToolType&&e.assetId===t.assetId&&e.platform===t.platform}};M=C([P(0,u.r),P(1,d.d),P(2,f.D),j("design:paramtypes",["function"==typeof(b=void 0!==u.r&&u.r)?b:Object,"function"==typeof(R=void 0!==d.d&&d.d)?R:Object,"function"==typeof(w=void 0!==f.D&&f.D)?w:Object])],M)},22329:(e,t,r)=>{r.d(t,{r:()=>a});var o=r(8757),n=r(37722);const i=e=>JSON.parse(null!=e?e:"[]").map((e=>Object.values(e).map((e=>e.trim())))).flat().filter(Boolean).join(",");class s{constructor(e){var t,r,s,a,c,l,u,d;this.eventName="smart_tool_generate_status";const f=n.I.getInstance().getContext(o.K6),h=null!==(t=null==f?void 0:f.draftId)&&void 0!==t?t:"";Object.assign(this,e),this.tool_type=e.tool_type,this.status=e.status,this.fail_reason=e.fail_reason,this.style=e.style,this.resolution=e.resolution,this.original_resolution=e.original_resolution,this.duration=null!==(r=e.duration)&&void 0!==r?r:0,this.draft_id=null!==(s=e.draft_id)&&void 0!==s?s:h,this.model_cnt=null!==(a=e.model_cnt)&&void 0!==a?a:0,this.model_id=null!==(c=e.model_id)&&void 0!==c?c:"",this.material_id=null!==(l=e.material_id)&&void 0!==l?l:"",this.intelligent_request_id=null!==(u=e.intelligent_request_id)&&void 0!==u?u:"",this.background_id=null!==(d=e.background_id)&&void 0!==d?d:"";try{this.resp_text=i(e.resp_text),this.resp_tag=i(e.resp_tag)}catch(p){}}getEventParams(){return{tool_type:this.tool_type,status:this.status,fail_reason:this.fail_reason,style:this.style,resolution:this.resolution,original_resolution:this.original_resolution,intelligent_request_id:this.intelligent_request_id,duration:this.duration,draft_id:this.draft_id,model_cnt:this.model_cnt,model_id:this.model_id,material_id:this.material_id,is_placeholder:this.is_placeholder,prompt:this.prompt,filling_request_id:this.filling_request_id,canva_scale:this.canva_scale,aspect_ratio:this.aspect_ratio,resp_text:this.resp_text,resp_tag:this.resp_tag,text_generate_id:this.text_generate_id,background_id:this.background_id}}}function a(e){const t=new s(e);n.I.getInstance().reportEvent(t)}},58830:(e,t,r)=>{r.d(t,{C:()=>i});var o=r(77685),n=r(14463);class i{constructor(){this._onEnableChange=new o.Q,this._enable=!1,this.onEnableChange=this._onEnableChange.event;const{firstPartyAnalytics:e}=n.cookieConsent.getSettings();this._enable=e,n.cookieConsent.onChange((e=>{this._enable=e.firstPartyAnalytics,this._onEnableChange.fire(this._enable)}))}get enable(){return this._enable}}},57018:(e,t,r)=>{r.d(t,{n:()=>o});const o=(0,r(67126).yh)("cookie-consent")},50:(e,t,r)=>{r.d(t,{e:()=>n});var o=r(77685);class n{constructor(){this._onEnableChange=new o.Q,this.onEnableChange=this._onEnableChange.event,this._enable=!0}get enable(){return this._enable}}},50246:(e,t,r)=>{r.d(t,{r:()=>o});const o=(0,r(67126).yh)("ai-create-ds")},75786:(e,t,r)=>{r.d(t,{h:()=>_});var o=r(18398),n=r.n(o),i=r(74504),s=r(83055),a=r(5261),c=r(33648);const l={headers:{"Content-Type":"application/json"},transformRequest:[(e={})=>n().stringify(e)],transformResponse:[function(e){try{return n().parse(e)}catch(t){return{data:e}}}]};var u=r(79651),d=r(3804);const f={baseURL:"/lv/v1",get domain(){return d._L.getVar("web_domain")},urlMap:{AI_CREATE:"/intelligence/create",AI_PROCESS_QUERY:"/intelligence/query",AI_CHECK_POPUP:"/intelligence/check_popup",AI_CONFIRM_POPUP:"/intelligence/confirm_popup"},webmssdk:!0};var h,p=r(67889);class v{constructor(e){this._networkClient=function(e){const t=(0,i.eI)(l),{businessHeader:r}=e;return(0,a.V)(t,r),(0,c.e)(t),(0,s.V)(t),t}(e),this._urlGenerator=new u.w(f)}aiCreate(e,t,r,o,n){let i;return n&&(i=Object.assign({},...Object.keys(n).map((e=>"styleKey"===e?{style_key:n[e]}:{[e]:n[e]})))),this._networkClient.request({method:"POST",withCredentials:!0,url:this._urlGenerator.url("AI_CREATE"),data:{asset_id:e,platform:t,workspace_id:r,smart_tool_type:o,params:JSON.stringify(i),scene:p.cJ.GraphEditor}})}aiProcessQuery(e){return this._networkClient.request({method:"POST",withCredentials:!0,url:this._urlGenerator.url("AI_PROCESS_QUERY"),data:{task_id:e}})}aiCheckPopup(){return this._networkClient.request({method:"POST",withCredentials:!0,url:this._urlGenerator.url("AI_CHECK_POPUP")})}aiConfirmPopup(){return this._networkClient.request({method:"POST",withCredentials:!0,url:this._urlGenerator.url("AI_CHECK_POPUP")})}}!function(e){e[e.Processing=1]="Processing",e[e.Success=2]="Success",e[e.Fail=3]="Fail",e[e.NotFound=4]="NotFound"}(h||(h={}));var g=r(13659);class y{constructor(e){this.aiCreateRepository=new v(e)}async aiCreate(e){const{assetId:t,platform:r,workspaceId:o,aiToolType:n,params:i}=e;try{const e=await this.aiCreateRepository.aiCreate(t,r,o,n,i);return(0,g.oW)(e.task_id)}catch(s){return(0,g.Mx)(Number(s.ret)||-1,"ai create task failed",s)}}async aiProcessQuery(e){try{const o=await this.aiCreateRepository.aiProcessQuery(e),{status:n,task_detail:i}=o;switch(n){case h.Processing:return await(t=500,new Promise(((e,o)=>setTimeout(r?()=>o(r):e,t)))),await this.aiProcessQuery(e);case h.Success:return(0,g.oW)(i);case h.Fail:case h.NotFound:default:return(0,g.wf)(-1,"ai process query failed")}}catch(o){return(0,g.Mx)(Number(o.ret)||-1,"ai process query failed",o)}var t,r}async aiCheckPopup(){try{const e=await this.aiCreateRepository.aiCheckPopup();return(0,g.oW)(e)}catch(e){return(0,g.Mx)(Number(e.ret)||-1,"aiCheckPopup failed",e)}}async aiConfirmPopup(){try{return await this.aiCreateRepository.aiConfirmPopup(),(0,g.ly)()}catch(e){return(0,g.Mx)(Number(e.ret)||-1,"aiConfirmPopup failed",e)}}}const m={businessHeader:{loc:"sg",appSDKVesion:"76.0.0",lan:"en",pf:"7",appVersion:"10.5.0",tdid:"web",signVer:1},draftVersion:"72.0.0"};class _{constructor(){this._serviceBrand=void 0,this.aiCreate=new y(m),console.log("aiCreate service created by DI")}}},67889:(e,t,r)=>{r.d(t,{AI:()=>c,cJ:()=>i});var o,n,i,s,a;r(8757);!function(e){e[e.isMute=1]="isMute",e[e.noMute=2]="noMute"}(o||(o={})),function(e){e[e.video=0]="video",e[e.image=1]="image",e[e.audio=2]="audio"}(n||(n={})),function(e){e[e.SmartTool=0]="SmartTool",e[e.GraphEditor=1]="GraphEditor"}(i||(i={})),function(e){e[e.VA=0]="VA",e[e.GCP=1]="GCP",e[e.SG=2]="SG"}(s||(s={})),function(e){e.VA="maliva",e.GCP="useast2a",e.SG="sg1"}(a||(a={}));s.GCP,a.GCP,s.VA,a.VA,s.SG,a.SG,a.GCP,s.GCP,a.VA,s.VA,a.SG,s.SG;const c={UNSUPPORT_FORMAT:203103,ACCESS_TIME_LIMIT:203101,NO_AVATAR:203102,AIGC_SENSITIVE_WORDS:203104,AIGC_SENSITIVE_IMAGES:203105,NOT_ENOUGH_STORAGE:200406,NO_LOGIN:1015}},9670:(e,t,r)=>{r.d(t,{k:()=>l});var o=r(42058),n=r(77685),i=r(43193),s=r(67986);const a={[i.G5.onBtnClick]:{originEventName:"btnClicked",emitter:new n.Q},[i.G5.initCoverImage]:{originEventName:"initCoverImage",emitter:new n.Q}};class c{constructor(){this._callbackTicket=0,this._callbackStore=[],this._events={[i.G5.onBtnClick]:a[i.G5.onBtnClick].emitter.event,[i.G5.initCoverImage]:a[i.G5.initCoverImage].emitter.event},this._initialize()}get events(){return(0,o.ZB)(this._events),this._events}request({name:e,data:t}){return new Promise((r=>{const o=this._callbackTicket++;try{var n;const r=window;r.cefQuery?r.cefQuery({request:JSON.stringify({callType:e,data:{callbackId:String(o),params:t}})}):null!==(n=r.webkit)&&void 0!==n&&null!==(n=n.messageHandlers)&&void 0!==n&&n[e]&&r.webkit.messageHandlers[e].postMessage(JSON.stringify({callbackId:String(o),params:t}))}catch(i){s.t.error("json stringify error")}this._callbackStore.push({callbackTicket:o,resolve:r})}))}_initialize(){window.Capcut={JSBridge:{_handleCallbackFromNative:this._handleCallbackFromNative.bind(this),_handleEventFromNative:this._handleEventFromNative.bind(this)}}}_handleCallbackFromNative(e){let t;if("string"==typeof e)try{t=JSON.parse(e)}catch(i){throw new Error("[CefBridge]_handleCallbackFromNative: JSON parse error")}else t=e;const r=Number(t.callbackId),o=this._callbackStore.findIndex((e=>e.callbackTicket===r));if(-1===o)return;const n=this._callbackStore[o];this._callbackStore.splice(o,1),n.resolve(t.result)}_handleEventFromNative(e){let t;if("string"==typeof e)try{t=JSON.parse(e)}catch(n){throw new Error("[CefBridge]_handleEventFromNative: JSON parse error")}else t=e;const r=t.event,o=t.result.data;Object.keys(a).forEach((e=>{const t=a[e];r===t.originEventName&&t.emitter.fire(o)}))}}class l{static getInstance(){return this._instance||(this._instance=new l),this._instance}constructor(){this._cefBridge=new c}get events(){return this._cefBridge.events}async saveCover({draft:e,fileCode:t,reportParams:r}){s.t.debug("--- save cover clicked ---",r);const o=await this._cefBridge.request({name:i.uq.saveCover,data:{draft:e,fileCode:t,reportParams:r}});return s.t.debug("--- save cover callback received ---"),o}async closeCover(){s.t.debug("--- close cover clicked ---");const e=await this._cefBridge.request({name:i.uq.closeCover,data:{}});return s.t.debug("--- close cover callback received ---"),e}async coverAssets({type:e,saveFileCode:t,fileName:r,width:n,height:s,md5:a,extra_info:c}){let l;switch(e){case i.Pw.add:l=await this._cefBridge.request({name:i.uq.coverAssets,data:{type:i.Pw.add,saveFileCode:t,fileName:r,width:n,height:s}});break;case i.Pw.get:l=await this._cefBridge.request({name:i.uq.coverAssets,data:{type:i.Pw.get}});break;case i.Pw.del:l=await this._cefBridge.request({name:i.uq.coverAssets,data:{type:i.Pw.del,md5:a}});break;case i.Pw.update:l=await this._cefBridge.request({name:i.uq.coverAssets,data:{type:i.Pw.update,md5:a,extra_info:c}})}return(0,o.ZB)(l),l}async getFileByPath(e){const t=encodeURIComponent(e);return await this._cefBridge.request({name:i.uq.getFileByPath,data:{filePath:t}})}async getFileByMd5(e){return await this._cefBridge.request({name:i.uq.getFileByMd5,data:{md5:e}})}async getSelectCoverPath(){return await this._cefBridge.request({name:i.uq.getSelectCoverPath,data:{}})}downLoadFile(){return Promise.resolve(this._mockBridgeResponse({}))}async login(){return await this._cefBridge.request({name:i.uq.login,data:{}})}async getVideoTitle(){return await this._cefBridge.request({name:i.uq.getVideoTitle,data:{}})}async webComplete(){return await this._cefBridge.request({name:i.uq.webComplete,data:{}})}async showWebView(e){return await this._cefBridge.request({name:i.uq.showWebview,data:{timestamp:e}})}async reportTemplateAddPageTimeCost(e){return await this._cefBridge.request({name:i.uq.reportAppLog,data:{eventName:"click_cover_template_time",params:e}})}async reportTemplateSaveTimeCost(e){return await this._cefBridge.request({name:i.uq.reportAppLog,data:{eventName:"cover_template_save_time",params:e}})}_mockBridgeResponse(e){return{code:1,msg:"",data:e}}}},43193:(e,t,r)=>{var o,n,i;r.d(t,{G5:()=>i,Pw:()=>o,uq:()=>n}),function(e){e.add="add",e.get="get",e.del="del",e.update="update"}(o||(o={})),function(e){e.saveCover="saveCover",e.closeCover="closeCover",e.coverAssets="coverAssets",e.getFileByPath="getFileByPath",e.getFileByMd5="getFileByMd5",e.getSelectCoverPath="getSelectCoverPath",e.login="login",e.webComplete="webComplete",e.getVideoTitle="getVideoTitle",e.showWebview="showWebView",e.reportAppLog="reportAppLog"}(n||(n={})),function(e){e.onBtnClick="onBtnClick",e.initCoverImage="initCoverImage"}(i||(i={}))},8073:(e,t,r)=>{r.d(t,{n:()=>o});const o=(0,r(67126).yh)("desktop-bridge-service")},92110:(e,t,r)=>{r.d(t,{z:()=>h});var o=r(42058),n=r(18781),i=r(13659),s=r(9670),a=r(43193),c=r(66265),l=r(15862),u=r(26069),d=r(67986),f=r(47470);class h{constructor(e){this._createBridgeInstance(),this._reportExportStatus=e.reportExportStatus}get events(){return(0,o.ZB)(this._bridge),this._bridge.events}async saveDraftAsCover({draft:e,cover:t,exportDuration:r,hasTemplateImage:s,useTemplateReportParams:a}){return(0,o.ZB)(this._bridge),s&&await this._bridge.reportTemplateSaveTimeCost({time_consumed:r}),r<=2e3&&await(0,n.D)(2e3-r),await this._bridge.saveCover({draft:e,fileCode:t.content,reportParams:a}),(0,i.ly)()}handleCancelClick(){var e;null===(e=this._bridge)||void 0===e||e.closeCover()}async saveEvercloudFile(e){var t;(0,o.ZB)(this._bridge);const{file:r,extraInfo:n}=e,{width:s,height:l}=await this._calculateAdaptiveSize(r),u=await r.arrayBuffer(),d=(0,c.m)(u),f=await this._bridge.coverAssets({type:a.Pw.add,saveFileCode:d,fileName:r.name,width:s,height:l,extra_info:n?JSON.stringify(n):void 0});if(1!==f.code||null===(t=f.data)||void 0===t||!t.fileInfos)return(0,i.wf)(f.code,f.msg);const h=this._formattedCoverAsset2PCEverFileInfo(f.data.fileInfos[0]);return h.width&&h.height?(0,i.oW)(h):(0,i.wf)(-1,"unsupported file format")}async deleteEvercloudFile(e){(0,o.ZB)(this._bridge);const t=await this._bridge.coverAssets({type:a.Pw.del,md5:e});return 1!==t.code?(0,i.wf)(t.code,t.msg):(0,i.ly)()}async getProjectFileList(){var e;(0,o.ZB)(this._bridge);const t=await this._bridge.coverAssets({type:a.Pw.get});if(null===(e=t.data)||void 0===e||!e.fileInfos)return(0,i.wf)(t.code,t.msg);const r=[];t.data.fileInfos.forEach((e=>{-1===r.findIndex((t=>t.md5===e.md5))&&r.push(e)}));const n=r.map((e=>{const t=this._transformFileContentToUrl(e.fileThumbnailCode);return{filename:e.name,fileSize:e.fileSize,filePath:e.filePath,width:e.width,height:e.height,md5:e.md5,coverUrl:t}}));return(0,i.oW)(n)}async getFileMetadataByMd5(e){(0,o.ZB)(this._bridge);const t=await this._bridge.coverAssets({type:a.Pw.get});if(!t.data.fileInfos)return(0,i.wf)(t.code,t.msg);const{fileInfos:r}=t.data,n=null==r?void 0:r.find((t=>t.md5===e));if(!n)return(0,i.wf)(-1,"can't find cover asset");const s=n.extra_info;let c;if(s)try{c=JSON.parse(s)}catch(l){c=void 0,d.t.error(`getFileMetadataByMd5: parse ${s} failed`)}return(0,i.oW)({fileName:n.name,fileSize:n.fileSize,width:n.width,height:n.height,md5:n.md5,extraInfo:c})}async updateExtraInfoByMd5(e,t){(0,o.ZB)(this._bridge);const r=await this.getFileMetadataByMd5(e);if(!r.ok)return(0,i.wf)(-1,r.msg);const n=r.value.extraInfo,s=n?(0,f.Z)(n,t):t,c=await this._bridge.coverAssets({type:a.Pw.update,md5:e,extra_info:this._escapeQuotes(JSON.stringify(s))});return 1!==c.code?(0,i.wf)(-1,c.msg):(0,i.ly)()}async getFileBlobInfoByMd5(e){(0,o.ZB)(this._bridge);const t=await this._bridge.getFileByMd5(e);if(1!==t.code)return(0,i.wf)(t.code,t.msg);const r=(0,l.u)(t.data.fileCode,"image/jpg"),n=URL.createObjectURL(r);return(0,i.oW)({blobUrl:n,md5:e,width:t.data.width,height:t.data.height})}async getFileBlobInfoByPath(e){(0,o.ZB)(this._bridge);const t=await this._bridge.getFileByPath(e);if(1!==t.code)return(0,i.wf)(t.code,t.msg);const r=(0,l.u)(t.data.fileCode,"image/jpg"),n=URL.createObjectURL(r);return(0,i.oW)({blobUrl:n,md5:t.data.md5,width:t.data.width,height:t.data.height})}async getDraftDataFromLocal(e){var t;(0,o.ZB)(this._bridge);const r=await(null===(t=this._bridge)||void 0===t?void 0:t.getFileByPath(e));if(1!==r.code)return(0,i.wf)(-1,"getDraftDataFromLocal failed");try{const e=(0,u.g)(r.data.fileCode),t=JSON.parse(e);return(0,i.oW)(t)}catch(n){return(0,i.wf)(-1,"getDraftDataFromLocal parse json error")}}async login(){(0,o.ZB)(this._bridge);const e=await this._bridge.login();return 1!==e.code?(0,i.wf)(-1,"pc login failed"):(0,i.oW)(e.data)}async selectFromVideo(){(0,o.ZB)(this._bridge);const e=await this._bridge.getSelectCoverPath();var t;if(1!==e.code||!e.data)return(0,i.wf)(-1,null!==(t=e.msg)&&void 0!==t?t:"selectFromVideo failed");const r=this._formattedCoverAsset2PCEverFileInfo({name:e.data.fileName,...e.data});return(0,i.oW)(r)}async getVideoTitle(){(0,o.ZB)(this._bridge);const e=await this._bridge.getVideoTitle();return 1===e.code&&e.data?(0,i.oW)(e.data.title):(0,i.wf)(e.code,e.msg)}async notifyWebComplete(){(0,o.ZB)(this._bridge);const e=await this._bridge.webComplete();return 1!==e.code?(0,i.wf)(-1,e.msg):(0,i.ly)()}async notifyShowWebView(e){(0,o.ZB)(this._bridge);const t=await this._bridge.showWebView(e);return 1!==t.code?(0,i.wf)(-1,t.msg):(0,i.ly)()}_createBridgeInstance(){this._bridge=s.k.getInstance()}_transformFileContentToUrl(e){let t;return t="string"==typeof e?(0,l.u)(e,"image/jpg"):new Blob([e]),URL.createObjectURL(t)}_calculateAdaptiveSize(e){return new Promise(((t,r)=>{const o=new Image;o.onload=()=>{const e=o.width,r=o.height;if(e<300&&r<300)t({width:e,height:r});else{const o=e/r;let n;if(n=e>r?e:r,n>=300){const e=300,r=Math.floor(e/o);t({width:e,height:r})}else t({width:e,height:r})}},o.onerror=()=>{t({width:0,height:0})};const n=new FileReader;n.onload=e=>{var t;o.src=null===(t=e.target)||void 0===t?void 0:t.result},n.readAsDataURL(e)}))}_formattedCoverAsset2PCEverFileInfo(e){const t=this._transformFileContentToUrl(e.fileThumbnailCode);return{filename:e.name,fileSize:e.fileSize,filePath:e.filePath,width:e.width,height:e.height,md5:e.md5,coverUrl:t}}_escapeQuotes(e){return e.replace(/"/g,'\\"')}}},43659:(e,t,r)=>{r.d(t,{s:()=>f});var o,n,i=r(35545),s=r(8073),a=r(26690),c=r(6118),l=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e,t){return function(r,o){t(r,o,e)}};let f=class extends i.JT{constructor(e,t){super(),this.accountService=e,this.desktopBridgeService=t}submitDraftData(e,t){var r;const o=new c.U(e,{uid:this.accountService.userProfile.uid,isUseInCn:!1});return this.desktopBridgeService.saveDraftAsCover({draft:JSON.stringify(o.data),cover:{content:null!==(r=e.coverList[0])&&void 0!==r?r:"",width:e.dimension[0].width,height:e.dimension[0].height},exportDuration:Date.now()-e.startedAt,hasTemplateImage:t.hasTemplateImage,useTemplateReportParams:t.useTemplateReportParams})}};f=l([d(0,a.D),d(1,s.n),u("design:paramtypes",["function"==typeof(o=void 0!==a.D&&a.D)?o:Object,"function"==typeof(n=void 0!==s.n&&s.n)?n:Object])],f)},1045:(e,t,r)=>{r.d(t,{W:()=>o,Y:()=>i});var o,n=r(67126);!function(e){e[e.CAPACITY_INSUFFICIENT=1]="CAPACITY_INSUFFICIENT",e[e.NETWORK_ERROR=2]="NETWORK_ERROR",e[e.DRAFT_NOT_FOUND=3]="DRAFT_NOT_FOUND",e[e.DRAFT_VERSION_CONFLICT=4]="DRAFT_VERSION_CONFLICT",e[e.DRAFT_TYPE_ERROR=5]="DRAFT_TYPE_ERROR",e[e.NOT_PERMISSION=6]="NOT_PERMISSION",e[e.DRAFT_DUPLICATE_CREATION=7]="DRAFT_DUPLICATE_CREATION",e[e.DELETED_PACKAGE=9]="DELETED_PACKAGE"}(o||(o={}));const i=(0,n.yh)("draft-full-save")},85175:(e,t,r)=>{r.d(t,{Y:()=>f});var o,n,i=r(35545),s=r(62917),a=r(6118),c=r(26690),l=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e,t){return function(r,o){t(r,o,e)}};let f=class extends i.JT{constructor(e,t){super(),this.accountService=e,this.iframeBridgeService=t}submitDraftData(e,t){const r=new a.U(e,{uid:this.accountService.userProfile.uid,isUseInCn:!1});return r.data.reportParams=null==t?void 0:t.reportParams,this.iframeBridgeService.saveCover({draft:JSON.stringify(r.data),packageAssets:r.data.draftAllEverAsserts,startedAt:e.startedAt,cover:{data:e.coverList[0],width:e.dimension[0].width,height:e.dimension[0].height}})}};f=l([d(0,c.D),d(1,s.Z),u("design:paramtypes",["function"==typeof(o=void 0!==c.D&&c.D)?o:Object,"function"==typeof(n=void 0!==s.Z&&s.Z)?n:Object])],f)},16031:(e,t,r)=>{r.d(t,{DraftApiPath:()=>s,dV:()=>i,f$:()=>n});var o=r(8757);const n=5,i="browser",s={SaveDraftUrl:{hostNameType:o.b_.Default,url:"/lv/v1/editor/plane_draft/save"}}},99741:(e,t,r)=>{r.d(t,{X:()=>j});var o=r(35545),n=r(83290),i=r(13659),s=r(26690),a=r(1045),c=r(67986),l=r(8757);var u,d=r(16031),f=r(32082),h=r(39375),p=r(33648),v=r(98778),g=r(89930),y=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class _{constructor(){this._networkClient=function(){const e=(new f.yk).build({headers:{"Content-Type":"application/json"}});return(0,h.mH)(e),(0,p.e)(e),(0,v.J)(e),e}()}saveDraftData(e,t){return this._networkClient.post(d.DraftApiPath.SaveDraftUrl.url,e,t)}}y([(0,g.K)(),m("design:type",Function),m("design:paramtypes",[Object,Object]),m("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],_.prototype,"saveDraftData",null);var b=r(45280);class R extends b.o{startedAt(){}id(e){this.data.package_key=e}packageType(){this.data.package_type=d.f$}name(e){}workspaceId(e){this.data.workspace_id=e}cloudAlbumAssert(e){var t;const r=null!==(t=null==e?void 0:e.map((e=>({source_path:e.sourcePath,md5:e.md5,size:e.size,meta:JSON.stringify(e.meta)}))))&&void 0!==t?t:[];this.data.package_assets=r,this._assets=r}ticket(e){this.data.base_package_id=null!=e?e:"0"}draftData(e){this.data.template_data=e}referencedAssert(e){this._referencedAssert=e}effectsPreloadInfos(e){this.data.materials||(this.data.materials={}),this.data.materials.effects=e}imagePreloadInfos(e){this.data.materials||(this.data.materials={}),this.data.materials.template_file_infos=e}dimension(e){}commitId(e){}isBatch(){}cover(e){}coverList(e){this.data.page_covers=this.pageCover.assetCovers}pageCount(e){}draftCreateTime(e){}combineResult(){this.data.referenced_assets=this._assets.filter((e=>{var t;return null===(t=this._referencedAssert)||void 0===t?void 0:t.includes(e.md5)})),this.data.template_meta=JSON.stringify(this.cloudDraftMeta)}}var w,S=r(24191),k=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=function(e,t){return function(r,o){t(r,o,e)}};let j=class extends o.JT{constructor(e){super(),this.accountService=e,this._draftRepository=new _}async submitDraftData(e){try{const{hostNameType:t}=d.DraftApiPath.SaveDraftUrl,r=new R(e,{uid:this.accountService.userProfile.uid,isUseInCn:S.zL.hasDependencyCN}),o=await this._draftRepository.saveDraftData(r.data,{[n.T]:t});return(0,i.oW)({packageId:o.package_id})}catch(t){c.t.error(`DraftManagerService: save draft error ${t}`);const e=function(e){switch(e){case l.lF.ERROR_DRAFT_NOT_FOUND:return a.W.DRAFT_NOT_FOUND;case l.lF.ERROR_DRAFT_ILLEGAL:return a.W.DRAFT_TYPE_ERROR;case l.lF.ERROR_DRAFT_VERSION_CONFLICT:return a.W.DRAFT_VERSION_CONFLICT;case l.lF.ERROR_DRAFT_NOT_PERMISSION:return a.W.NOT_PERMISSION;case l.lF.ERROR_DRAFT_DUPLICATE_CREATION:return a.W.DRAFT_DUPLICATE_CREATION;default:return a.W.NETWORK_ERROR}}(t.ret);return e===a.W.DRAFT_DUPLICATE_CREATION?(0,i.oW)({packageId:t.data.package_id}):(0,i.wf)(e,e.toString())}}};j=k([C(0,s.D),T("design:paramtypes",["function"==typeof(w=void 0!==s.D&&s.D)?w:Object])],j)},45280:(e,t,r)=>{r.d(t,{o:()=>n});var o=r(16031);class n{constructor(e,t){this.origin=e,this.extra=t,this.data={},this.pageCover=this._getPageCovers(e.coverList),this.cloudDraftMeta=this._getDraftMetaInfo(),Object.entries(e).forEach((([e,t])=>{this[e](t)})),this.packageType(),this.combineResult()}_getDraftMetaInfo(){var e,t;return function({id:e,name:t,dimensions:n,pageCount:i,isNewCreate:s,size:a,uid:c,pageCoverList:l,createTime:u,isUseInCn:d,commitId:f,isBatch:h}){var p,v,g;const y=Date.now();return{draft:{id:e,name:t,type:o.f$,duration:0,updateTime:y,size:a,segmentCount:0,version:"1.0.0",platformSupport:o.dV,isMainTrackEmpty:!1,isScriptTemplate:!1,renderIndexTrackMode:!1,canvasInfo:{width:null===(p=n[0])||void 0===p?void 0:p.width,height:null===(v=n[0])||void 0===v?void 0:v.height,sizeUnit:null===(g=n[0])||void 0===g?void 0:g.unit,pageInfoList:n.map(((e,t)=>({...e,...null==l?void 0:l[t],sizeUnit:e.unit}))),pageCount:i},coverUrl:"cover.jpg",cover:"cover.jpg",graphicInfo:{isUseInCn:d,isBatch:h}},uploadSource:{owner:null!=c?c:"0",platform:o.dV,systemVersion:r.g.navigator.userAgent,appVersion:"1.0.0",createTime:s?y:u,commitId:f},createSource:{owner:null!=c?c:"0",platform:o.dV,systemVersion:r.g.navigator.userAgent,appVersion:"1.0.0",createTime:s?y:u}}}({id:this.origin.id,name:this.origin.name,dimensions:this.origin.dimension,pageCount:this.origin.pageCount,isNewCreate:"0"===this.origin.ticket,size:this._getDraftUsedSize({draftJson:this.origin.draftData,coverBase64:this.origin.coverList.map((e=>{var t;return null==e||null===(t=e.split("base64,"))||void 0===t?void 0:t[1]})),usedMaterialSize:this.origin.cloudAlbumAssert.map((e=>e.size))}),pageCoverList:this.pageCover.pageCoverList,uid:null!==(e=this.extra.uid)&&void 0!==e?e:"0",createTime:this.origin.draftCreateTime,isUseInCn:null!==(t=this.extra.isUseInCn)&&void 0!==t&&t,commitId:this.origin.commitId,isBatch:this.origin.isBatch})}_getPageCovers(e){const t=new Map,r=[],o=[],n=e=>e>0?`_${e}`:"";e.forEach(((e,i)=>{var s;if(!e)return;e=null===(s=e)||void 0===s||null===(s=s.split("base64,"))||void 0===s?void 0:s[1];const a=`cover${n(i)}.jpg`;t.has(e)?o.push({[`page${n(i)}`]:t.get(e)}):(r.push({data:e,source_path:a,index:i}),o.push({[`page${n(i)}`]:a}),t.set(e,a))}));if(!r.find((e=>"cover.jpg"===e.source_path))&&r.length){const e=r[0];e.source_path="cover.jpg";const t=o.find((t=>t[n(e.index)]));o.unshift({page:e.source_path}),t[n(e.index)]=e.source_path}return{assetCovers:r,pageCoverList:o}}_getDraftUsedSize({draftJson:e,coverBase64:t,usedMaterialSize:r}){const o=new TextEncoder;let n=o.encode(e).length;return t.forEach((e=>e&&(n+=o.encode(e).length))),r.forEach((e=>n+=e)),n}}},6118:(e,t,r)=>{r.d(t,{U:()=>i});var o=r(45280),n=r(16031);class i extends o.o{startedAt(e){}id(e){this.data.packageId=e}packageType(){this.data.packageType=n.f$}name(e){}workspaceId(e){}cloudAlbumAssert(e){var t;const r=null!==(t=null==e?void 0:e.map((e=>({source_path:e.sourcePath,md5:e.md5,size:e.size,meta:JSON.stringify({source:"graphic"})}))))&&void 0!==t?t:[];this.data.draftAllEverAsserts=r,this._assets=r}ticket(e){}draftData(e){this.data.draftData=e}referencedAssert(e){this._referencedAssert=e}effectsPreloadInfos(e){this.data.materials||(this.data.materials={}),this.data.materials.effects=e}imagePreloadInfos(e){this.data.materials||(this.data.materials={}),this.data.materials.template_file_infos=e}dimension(e){}commitId(e){}cover(e){}coverList(e){}pageCount(e){}draftCreateTime(e){}combineResult(){this.data.draftUsedEverAsserts=this._assets.filter((e=>{var t;return null===(t=this._referencedAssert)||void 0===t?void 0:t.includes(e.md5)})),this.data.draftMeta=JSON.stringify(this.cloudDraftMeta)}isBatch(){}}},82334:(e,t,r)=>{r.d(t,{D:()=>y});var o,n=r(35545),i=r(83290),s=r(42058),a=r(13659),c=r(8073),l=r(5195),u=r(37689),d=r(27175),f=r(67986),h=r(32082),p=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t){return function(r,o){t(r,o,e)}};let y=class extends n.JT{constructor(e){super(),this.desktopBridgeService=e,this.getDraftRepository=new l.a}async getDraftData(e){const{hostNameType:t}=u.DraftApiPath.GetDraftUrl,r=await this.desktopBridgeService.getDraftDataFromLocal(e);if(!r.ok)return r;try{const e=r.value,o=await this.getDraftRepository.getDraftResource({referenced_assets:[],materials:e.materials,app_version:u.eP,sdk_version:u.AS,lang:d.ZP.language,region:await h.yk.apiSetting.getUserRegion()},{[i.T]:t}),n=await this._getPcEverAssets(e.draftUsedEverAsserts);(0,s.Y2)(n.ok);const c=JSON.parse(e.draftMeta);return(0,a.oW)({draftData:JSON.parse(e.draftData),draftCreateTime:c.createSource.createTime,draftUsedEverAsserts:n.value,draftAllEverAsserts:e.draftAllEverAsserts.map((e=>({md5:e.md5,sourcePath:e.source_path,size:e.size}))),materials:o.materials,token:"",draftTitle:"Video Cover",allowToEdit:!0})}catch(o){return(0,a.wf)(-1,`parser draft failure: ${null==o?void 0:o.message}`)}}async _getPcEverAssets(e){const t=await this.desktopBridgeService.getProjectFileList();var r;if(!t.ok)return(0,a.wf)(-1,null!==(r=t.msg)&&void 0!==r?r:"_getPcEverAssets failed");const o=await Promise.all(e.map((async r=>{const o=t.value.find((e=>e.md5===r.md5));if(!o)throw f.t.debug(`draftUsedEverAssets: ${JSON.stringify(e)}`),f.t.debug(`allCoverAssets: ${JSON.stringify(t)}`),new Error("can not find draft cover asset in local directory");const n=await this.desktopBridgeService.getFileBlobInfoByMd5(r.md5);return(0,s.Y2)(n.ok),{name:o.filename,assetId:o.md5,md5:o.md5,size:o.fileSize,sourcePath:r.source_path,aesKey:"",originUrl:n.value.blobUrl}})));return(0,a.oW)(o)}};y=p([g(0,c.n),v("design:paramtypes",["function"==typeof(o=void 0!==c.n&&c.n)?o:Object])],y)},24954:(e,t,r)=>{r.d(t,{H:()=>i,o:()=>o});var o,n=r(67126);!function(e){e.XHR="xhr",e.JSONP="jsonp"}(o||(o={}));const i=(0,n.yh)("draft-get-data")},44307:(e,t,r)=>{r.d(t,{j:()=>g});var o,n=r(35545),i=r(83290),s=r(13659),a=r(62917),c=r(5195),l=r(37689),u=r(14324),d=r(27175),f=r(32082),h=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e,t){return function(r,o){t(r,o,e)}};let g=class extends n.JT{constructor(e){super(),this.graphicIframeBridgeService=e,this.getDraftRepository=new c.a}async getDraftData(e,t){const{hostNameType:r}=l.DraftApiPath.GetDraftUrl,o=await this.graphicIframeBridgeService.getDraft();if(!o.ok)return o;const n=o.value;try{const e=JSON.parse(n.draft),o=await Promise.race([this.getDraftRepository.getDraftResource({workspace_id:t,referenced_assets:e.draftUsedEverAsserts,materials:e.materials,app_version:l.eP,sdk_version:l.AS,lang:d.ZP.language,region:await f.yk.apiSetting.getUserRegion()},{[i.T]:r}),new Promise((async e=>{const t=await this.graphicIframeBridgeService.getDraftResource();t.ok&&e(t.value)}))]),a=JSON.parse(e.draftMeta);return(0,s.oW)({draftData:JSON.parse(e.draftData),draftUsedEverAsserts:(0,u.d)(o.referenced_assets),draftCreateTime:a.createSource.createTime,draftAllEverAsserts:e.draftAllEverAsserts.map((e=>({md5:e.md5,sourcePath:e.source_path,size:e.size}))),materials:o.materials,token:"",draftTitle:"Video Cover",allowToEdit:!0})}catch(a){return(0,s.wf)(-1,`parser draft failure: ${null==a?void 0:a.message}`)}}};g=h([v(0,a.Z),p("design:paramtypes",["function"==typeof(o=void 0!==a.Z&&a.Z)?o:Object])],g)},37689:(e,t,r)=>{r.d(t,{AS:()=>i,DraftApiPath:()=>s,eP:()=>n});var o=r(8757);const n="999.999.999",i="13.6.0",s={GetDraftUrl:{hostNameType:o.b_.Default,url:"/lv/v1/editor/plane_draft/get_draft_detail"},GetDraftReSource:{hostNameType:o.b_.Default,url:"/lv/v1/editor/pack_resource"}}},80473:(e,t,r)=>{r.d(t,{w:()=>p});var o=r(35545),n=r(13659),i=r(24954),s=r(67986),a=r(32082),c=r(37689),l=r(5195),u=r(14324),d=r(27175),f=r(83290);class h{constructor(){this._draftCreateTime=0,this._draftRepository=new l.a}async getDraftData(e,t){const{hostNameType:r}=c.DraftApiPath.GetDraftUrl,o=await this._draftRepository.getDraftData({package_key:e,app_version:c.eP,sdk_version:c.AS,lang:d.ZP.language,region:await a.yk.apiSetting.getUserRegion(),workspace_id:t,package_asset_limit:30},{[f.T]:r}),n=JSON.parse(o.template_data),i=(0,u.x)(o);return this._draftCreateTime=i.draftCreateTime,{...i,draftData:n}}}class p extends o.JT{constructor(){super(...arguments),this._draftId="",this._workspaceId="",this._draftAggregate=new h}async getDraftData(e,t){this._draftId=e,this._workspaceId=t;const r=await this._fetchData();return r.ok?(0,n.oW)(this._data):r.pair()[0]}async _fetchData(){let e;const[t,r]=(await this._getDraftDataFromJsonp()).pair();if(t)return t;let o=!0;if(e=r,!r){o=!1,s.t.info("Custom Initialize","get draft from jsonp fail, try from server!");const[t,r]=(await this._getDraftDataFromServer(this._draftId)).pair();if(t)return t;e=r}return this._data={...e,from:o?i.o.JSONP:i.o.XHR},(0,n.ly)()}_getDraftDataFromJsonp(){const e=r.g.jsonpDraft;if(!document.getElementById("draft-detail-jsonp"))return Promise.resolve((0,n.ly)());if(void 0===e.response&&void 0===e.status)return new Promise((t=>{e.callback=(r,o)=>{e.callback=void 0,0!==r&&t((0,n.ly)()),"0"!==o.ret&&t((0,n.wf)(Number(o.ret),o.msg)),t((0,n.oW)((0,u.x)(o.data)))}}));if(0===e.status&&e.response){if("0"!==e.response.ret)return Promise.resolve((0,n.wf)(Number(e.response.ret),e.response.msg));const t=(0,u.x)(e.response.data);return Promise.resolve((0,n.oW)(t))}return Promise.resolve((0,n.ly)())}async _getDraftDataFromServer(e){try{const t=await this._draftAggregate.getDraftData(e,this._workspaceId);return(0,n.oW)(t)}catch(t){return s.t.error("graphic-sdk get draft data from server error!",t),(0,n.wf)(Number(t.ret),t.msg)}}}},5195:(e,t,r)=>{r.d(t,{a:()=>h});var o,n,i=r(37689),s=r(32082),a=r(39375),c=r(33648),l=r(98778),u=r(89930),d=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class h{constructor(){this._networkClient=function(){const e=(new s.yk).build({headers:{"Content-Type":"application/json"}});return(0,a.mH)(e),(0,c.e)(e),(0,l.J)(e),e}()}getDraftData(e,t){return this._networkClient.post(i.DraftApiPath.GetDraftUrl.url,e,t)}getDraftResource(e,t){return this._networkClient.post(i.DraftApiPath.GetDraftReSource.url,e,t)}}d([(0,u.K)(),f("design:type",Function),f("design:paramtypes",[Object,Object]),f("design:returntype","function"==typeof(o="undefined"!=typeof Promise&&Promise)?o:Object)],h.prototype,"getDraftData",null),d([(0,u.K)(),f("design:type",Function),f("design:paramtypes",[Object,Object]),f("design:returntype","function"==typeof(n="undefined"!=typeof Promise&&Promise)?n:Object)],h.prototype,"getDraftResource",null)},14324:(e,t,r)=>{r.d(t,{d:()=>i,x:()=>s});var o=r(68967),n=r(67986);function i(e){return e.map((e=>JSON.parse(e))).map((e=>{let t,r=e.preview_url.bucket_key_1080p;return e.image_transcode_info&&(t={},Object.keys(e.image_transcode_info).forEach((n=>{if(!e.image_transcode_info[n])return;const{preview_url:i,width:s,height:a}=e.image_transcode_info[n];i&&s&&a&&!(0,o.jv)(i)&&(n.includes("origin")?r=i:t[`${s}x${a}`]={width:s,height:a,full_url:i,aesKey:e.preview_key})}))),{assetId:e.asset_id,sourcePath:e.source_path,aesKey:e.preview_key,originUrl:r,transcode:t,md5:e.md5,size:e.size}}))}function s(e){let t,r="",o=[],s=[],a=Date.now(),c="";try{s=e.package_assets.map((e=>({md5:e.md5,size:e.size,sourcePath:e.source_path,meta:e.meta?JSON.parse(e.meta):void 0}))),t=JSON.parse(e.package_meta),a=t.createSource.createTime,r=t.draft.name,o=i(e.referenced_assets),c=e.bizz_owner_id}catch(l){n.t.error("draft-api-helper parse json error",l)}return{draftTitle:r,draftCreateTime:a,draftUsedEverAsserts:o,draftAllEverAsserts:s,draftData:e.template_data,token:e.package_id,materials:e.materials,allowToEdit:e.allow_to_edit,draftOwner:c}}},62917:(e,t,r)=>{r.d(t,{Z:()=>o});const o=(0,r(67126).yh)("graphic-iframe-bridge-service")},43214:(e,t,r)=>{r.d(t,{E:()=>u});var o,n,i=r(35545),s=r(77685),a=r(13659),c=r(42058);!function(e){e[e.Success=0]="Success"}(o||(o={}));class l{constructor(e){this.props=e,this.callbacks=new Map,this.listener=this._handlerMsgFromEditor.bind(this),window.addEventListener("message",this.listener)}get isParent(){return!this.props.iframe}get sender(){return this.isParent?window.parent:this.props.iframe.contentWindow}dispose(){this.callbacks.clear(),window.removeEventListener("message",this.listener)}on(e,t){let r=this.callbacks.get(e);r||(r=[]),r.push({cb:t}),this.callbacks.set(e,r)}off(e,t){const r=this.callbacks.get(e);r&&this.callbacks.set(e,r.filter((e=>e.cb!==t)))}once(e,t){let r=this.callbacks.get(e);r||(r=[]),r.push({cb:t,once:!0}),this.callbacks.set(e,r)}action(e,t){var r;e.actionId=(null==t?void 0:t.actionId)||`action-${this._genActionId()}`,e.requireResponse=!1,null===(r=this.sender)||void 0===r||r.postMessage(JSON.stringify(e),window.location.origin)}awaitAction(e){return new Promise((t=>{var r;e.actionId=`awaitAction-${this._genActionId()}`,e.requireResponse=!0,this.once(e.event,(r=>{r.actionId===e.actionId&&t(r.data)})),null===(r=this.sender)||void 0===r||r.postMessage(JSON.stringify(e),window.location.origin)}))}_genActionId(){return`${Date.now().valueOf()}-${Math.floor(1e3*Math.random())}`}_handlerMsgFromEditor(e){const t=[];if(this.isParent||e.source===this.sender)try{const r=JSON.parse(e.data),o=this.callbacks.get(r.event);null==o||o.forEach((e=>{e.cb(r),e.once&&t.push(e.cb)})),t.forEach((e=>{this.off(r.event,e)}))}catch(r){(0,c.Y2)(!1,`invalid event:${r}`)}}}!function(e){e.READY="READY",e.GET_MATERIAL_ASSET="GET_MATERIAL_ASSET",e.GET_DRAFT_RESOURCE="GET_DRAFT_RESOURCE",e.SELECT_VIDEO_FRAME="SELECT_VIDEO_FRAME",e.INSERT_COVER_TO_CANVAS="INSERT_COVER_TO_CANVAS",e.GET_VIDEO_COVER_DRAFT="GET_VIDEO_COVER_DRAFT",e.CANCEL_GRAPHIC="CANCEL_GRAPHIC",e.SAVE_COVER="SAVE_COVER"}(n||(n={}));class u extends i.JT{constructor(){super(),this._onInsertCoverToCanvas=this._store.add(new s.Q),this.onInsertCoverToCanvas=this._onInsertCoverToCanvas.event,this.bridge=new l({}),this.bridge.on(n.INSERT_COVER_TO_CANVAS,(e=>{e.data&&this._onInsertCoverToCanvas.fire(e.data)}))}dispose(){this.bridge.dispose(),super.dispose()}notifyReady(){this.bridge.action({event:n.READY})}async getDraft(){const e=await this.bridge.awaitAction({event:n.GET_VIDEO_COVER_DRAFT});return e.code===o.Success?(0,a.oW)(e.data):(0,a.wf)(e.code,e.msg)}async getMaterialAsset(e){const t=await this.bridge.awaitAction({event:n.GET_MATERIAL_ASSET,data:{md5:e}});return t.code===o.Success?(0,a.oW)(t.data):(0,a.wf)(t.code,t.msg)}async getDraftResource(){const e=await this.bridge.awaitAction({event:n.GET_DRAFT_RESOURCE});return e.code===o.Success?(0,a.oW)(e.data):(0,a.wf)(e.code,e.msg)}async selectVideoFrameByMd5(){var e;const t=await this.bridge.awaitAction({event:n.SELECT_VIDEO_FRAME});return t.code===o.Success&&null!==(e=t.data)&&void 0!==e&&e.md5?(0,a.oW)(t.data.md5):(0,a.wf)(t.code,t.msg)}async saveCover(e){const t=await this.bridge.awaitAction({event:n.SAVE_COVER,data:e});return t.code===o.Success?(0,a.ly)():(0,a.wf)(t.code,t.msg)}cancelModal(){this.bridge.action({event:n.CANCEL_GRAPHIC,data:void 0})}selectVideoFrame(){return Promise.resolve("")}}},72838:(e,t,r)=>{r.d(t,{BL:()=>o});const o=(0,r(67126).yh)("image-sync")},12613:(e,t,r)=>{r.d(t,{G:()=>_});var o=r(18781),n=r(13659),i=r(42058),s=r(16938),a=r(3804);const c={baseURL:"/lv/v1",get domain(){return a._L.getVar("web_domain")},urlMap:{SYNC_ASSET:"/editor/image/sync_asset",BATCH_GET_SYNC_STATE:"/editor/image/batch_get_sync_state"},webmssdk:!0};var l=r(79651),u=r(18398),d=r.n(u),f=r(74504),h=r(83055),p=r(5261),v=r(33648);const g={withCredentials:!0,headers:{"Content-Type":"application/json"},transformRequest:[(e={})=>d().stringify(e)],transformResponse:[function(e){try{return d().parse(e)}catch(t){return{data:e}}}]},y={businessHeader:{loc:"sg",appSDKVesion:"76.0.0",lan:"en",pf:"7",appVersion:"10.5.0",tdid:"web",signVer:1},draftVersion:"72.0.0"};class m{constructor(){this._urlGenerator=new l.w(c)}get _networkClient(){return this._networkClientInstance||(this._networkClientInstance=function(e=y){const t=(0,f.eI)(g),{businessHeader:r}=e;return(0,p.V)(t,r),(0,v.e)(t),(0,h.V)(t),t}()),this._networkClientInstance}async syncAsset(e){try{return await this._networkClient.post(this._urlGenerator.url("SYNC_ASSET"),e),(0,n.ly)()}catch{return(0,n.wf)(-1,"failed to sync")}}async batchGetSyncAssetState(e){try{const t=await this._networkClient.post(this._urlGenerator.url("BATCH_GET_SYNC_STATE"),e);return(0,n.oW)(t)}catch(t){return(0,n.wf)(-2,"failed to sync")}}}class _{constructor(){this._imageSyncRepo=new m}async syncAsset(e){var t;const r=await this._imageSyncRepo.syncAsset({resources:e});if(!r.ok)return r;let a,c=0;for(;c<10;){await(0,o.D)(300);const t=await this._imageSyncRepo.batchGetSyncAssetState({resources:e});if(a=t,!t.ok){c++;continue}if(t.value.status===s.w.SyncStateFull)return(0,n.wf)(s.w.SyncStateFull,"storage full");let r=0,l=0;t.value.sync_asset_state.forEach((e=>{switch(e.status){case s.w.SyncStateDoing:break;case s.w.SyncStateSuccess:r++;break;case s.w.SyncStateFull:case s.w.SyncStateFail:case s.w.SyncStateNotFound:l++;break;default:(0,i.bP)(e.status)}}));const u=r===t.value.sync_asset_state.length,d=l>0;if(u)return(0,n.oW)(t.value.sync_asset_state);d&&l++}return!1===(null===(t=a)||void 0===t?void 0:t.ok)?a:(0,n.wf)(-1,"failed to sync images")}}},16938:(e,t,r)=>{var o,n;r.d(t,{c:()=>o,w:()=>n}),function(e){e[e.ImageX=108]="ImageX"}(o||(o={})),function(e){e[e.SyncStateDoing=1]="SyncStateDoing",e[e.SyncStateSuccess=2]="SyncStateSuccess",e[e.SyncStateFail=3]="SyncStateFail",e[e.SyncStateNotFound=4]="SyncStateNotFound",e[e.SyncStateFull=20113]="SyncStateFull"}(n||(n={}))},3906:(e,t,r)=>{r.d(t,{p:()=>o});const o=(0,r(67126).yh)("imagex-service")},38294:(e,t,r)=>{r.d(t,{z:()=>p});var o=r(13659),n=r(24191),i=r(32082),s=r(39375),a=r(33648),c=r(98778),l=r(89930);const u={GET_IMAGEX_TOKEN:{url:"/lv/v1/upload_sign"}};var d=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class h{constructor(){this._networkClient=function(){const e=(new i.yk).build({headers:{"Content-Type":"application/json"}});return(0,s.mH)(e),(0,a.e)(e),(0,c.J)(e),e}()}async getImageXToken(){const{url:e}=u.GET_IMAGEX_TOKEN,t=await this._networkClient.post(e,{key_version:"v5",biz:"effect_resource_v5"},{[n.$R]:!1});return{key:t.key,sign:t.sign,accessKeyId:t.access_key_id,secretAccessKey:t.secret_access_key,sessionToken:t.session_token,expiredTime:t.expired_time,currentTime:t.current_time,spaceName:t.space_name}}}d([(0,l.K)(),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",Promise)],h.prototype,"getImageXToken",null);class p{constructor(){this._repository=new h}async getImageXToken(){try{const e=await this._repository.getImageXToken();return(0,o.oW)(e)}catch(e){return(0,o.wf)(-1,"data-service getImageXToken api failed")}}}},47216:(e,t,r)=>{r.d(t,{r:()=>o});const o=(0,r(67126).yh)("upload-link-service")},44461:(e,t,r)=>{r.d(t,{S:()=>O});var o=r(35545),n=r(77685),i=r(42058),s=r(13659),a=r(83055),c=r(32082),l=r(39375),u=r(98778);function d(e){return e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))}function f(e){return e.replace(/_([a-z])/g,((e,t)=>t.toUpperCase()))}function h(e,t){if(e&&"object"==typeof e)for(const r of Object.keys(e)){const o=t(r);o!==r&&(e[o]=e[r],delete e[r]),h(e[o],t)}return e}var p=r(33648);const v="/cc/v1/workspace/update_workspace_upload_link",g="/cc/v1/workspace/get_workspace_upload_link";function y(){const e=(new c.yk).build({headers:{"Content-Type":"application/json"}});var t;return(0,l.mH)(e),(0,u.J)(e),(0,a.V)(e),(t=e).interceptors.request.use((e=>(e.data=h(e.data,d),e))),t.interceptors.response.use((e=>(e.data=h(e.data,f),e))),(0,p.e)(e),e}class m{get _networkClient(){return this._networkClientInstance||(this._networkClientInstance=y()),this._networkClientInstance}async registerUploadLink(e){try{const t=await this._networkClient.post(v,{workspaceId:e.workspaceId});return(0,s.oW)(t.uploadLink)}catch(t){return(0,s.wf)(-1,"api call error")}}async getUploadInfo(e){try{const t=await this._networkClient.post(g,{workspaceId:e.workspaceId});return(0,s.oW)(t)}catch(t){return(0,s.wf)(-1,"api call error")}}}var _,b=r(59626),R=r(24386),w=r(23843);!function(e){e[e.ALL=0]="ALL",e[e.NORMAL=1]="NORMAL",e[e.VIDEO=2]="VIDEO"}(_||(_={}));class S extends o.JT{get url(){return this._params.url}constructor(e){var t;super(),this._params=e,this._preUploadFileCount=0,this._mutex=new b.w,this._onDidUpload=this._store.add(new n.Q),this.onDidUpload=this._onDidUpload.event,this._timer=setInterval((()=>{this._getUploadFileAndCount()}),null!==(t=this._params.loopDuration)&&void 0!==t?t:3e3)}async _getUploadFileAndCount(){await this._mutex.acquire();try{const e=await this._params.uploadLinkRepository.getUploadInfo({workspaceId:this._params.workspaceId});if(!e.ok)return;const t=e.value.fileCount;if(this._params.url=e.value.uploadLink,t>this._preUploadFileCount){const e=t-this._preUploadFileCount,r=await this._params.userMaterialsService.getMaterials((0,R.ib)({count:Math.floor(11*Math.random())+e,assetSource:_.ALL,orderBy:"modify_time",order:"desc",workspaceId:this._params.workspaceId},[]));if(!r.ok)return;const o=r.value.value.slice(0,e);this._onDidUpload.fire({workspaceId:this._params.workspaceId,uploadedCount:t,newUploadedCount:e,newUploadMaterialIds:o.map((e=>((0,i.Y2)(e.sourceType===w.ov.EverCloud),e.assetId)))}),this._preUploadFileCount=t}}finally{this._mutex.release()}}dispose(){r.g.clearInterval(this._timer),super.dispose()}}var k,T=r(31067),C=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e,t){return function(r,o){t(r,o,e)}};let O=class extends o.JT{constructor(e){super(),this._userMaterialsService=e,this._uploadLinkRepository=new m,this._registerUploadTask=new Map,this._onDidUpload=this._store.add(new n.Q),this.onDidUpload=this._onDidUpload.event}async registerUploadLink(e){(0,i.Y2)(!this._registerUploadTask.has(e.workspaceId),"this workspace link is register, pleace check the logic");const t=await this._uploadLinkRepository.registerUploadLink({workspaceId:e.workspaceId});if(!t.ok)return t;const r=new S({workspaceId:e.workspaceId,url:t.value,userMaterialsService:this._userMaterialsService,uploadLinkRepository:this._uploadLinkRepository});return r.onDidUpload(((...e)=>{this._onDidUpload.fire(...e)})),this._registerUploadTask.set(e.workspaceId,r),(0,s.oW)({url:t.value})}getRegisteredUploadLink(e){const t=this._registerUploadTask.get(e);return t?(0,s.oW)({url:t.url}):(0,s.wf)(-1,"not found register link")}unRegisterUploadLink(e){const t=this._registerUploadTask.get(e);(0,i.Y2)(t,"this workspace link is not register, please check the logic"),t.dispose(),this._registerUploadTask.delete(e)}};O=C([P(0,T.b),j("design:paramtypes",["function"==typeof(k=void 0!==T.b&&T.b)?k:Object])],O)},31067:(e,t,r)=>{r.d(t,{b:()=>o});const o=(0,r(67126).yh)("userMaterialsService")},18572:(e,t,r)=>{r.d(t,{x:()=>N});var o=r(35545),n=r(77685),i=r(48018),s=r(42058),a=r(28628),c=r(47006),l=r(11042),u=r(81666),d=r(96354),f=r(55610),h=r(83055),p=r(13659),v=r(32082),g=r(39375),y=r(98778),m=r(33648),_=r(24386);const b="lv/v1/asset/list",R="lv/v1/asset/detail",w="lv/v1/asset/copy",S="lv/v1/asset/delete";var k=r(23843);function T(e){var t;if(e&&null!==e.detail_infos&&0!==(null==e||null===(t=e.common_info)||void 0===t?void 0:t.single_frame_height))return{common:{singleFrameHeight:e.common_info.single_frame_height,singleFrameWidth:e.common_info.single_frame_width,totalSetNum:e.common_info.total_set_num},details:e.detail_infos.map((e=>({frameCount:e.frame_count,imageWidth:e.width,imageHeight:e.height,url:e.url,encryptedBucketKey:e.encrypted_bucket_key,encryptedKey:e.encrypted_key})))}}function C(e){var t;const r={};return Object.entries(null!==(t=e.preview_url)&&void 0!==t?t:{}).forEach((([t,o])=>{const n=t.replace("bucket_key_","");r[n]={width:0,height:0,url:o,key:e.preview_key}})),r}function j(e,t){var r;const o={},n="video"===t?"player_":"audio_";return Object.entries(null!==(r=e.play_info)&&void 0!==r?r:{}).forEach((([e,t])=>{if(e.startsWith(n)&&t){if(!t.primary_url&&!t.secondary_url)return;const r=e.replace(n,"");o[r]={url:t.primary_url,backupUrl:t.secondary_url,key:t.url_key}}})),Object.keys(o).length?o:void 0}function P(e){const t={key:e.md5,sourceType:k.ov.EverCloud,assetId:e.asset_id,filename:e.filename,fileType:k.YB.File,owner:e.owner,md5:e.md5,mime:e.mime,size:e.size,sourcePath:e.source_path,createdAt:e.create_time?new Date(e.create_time).valueOf():void 0,updatedAt:e.updated_at,url:e.origin_download_link,subType:e.sub_type,meta:e.meta},r=function(e){let t;try{return e?(t=JSON.parse(e),t):{}}catch(r){return{}}}(e.meta);if(!t.filename||(null!==(n=(o=r).is_matting)&&void 0!==n?n:o.is_reverse))return t;var o,n;switch(e.file_type||(0,f.Gt)(t.mime)){case k.YB.Image:return function(e,t){var r,o;const n=null!==(r=e.preview_url)&&void 0!==r&&r.bucket_key_360p?{url:null===(o=e.preview_url)||void 0===o?void 0:o.bucket_key_360p,key:e.preview_key}:void 0;return{...t,fileType:k.YB.Image,cover:n,width:e.width,height:e.height,isImgTranscoding:e.image_async_resize,imgTranscodeInfo:C(e)}}(e,t);case k.YB.Video:return function(e,t){var r,o,n;const i=null!==(r=e.preview_url)&&void 0!==r&&r.bucket_key_360p?{url:null===(o=e.preview_url)||void 0===o?void 0:o.bucket_key_360p,key:e.preview_key}:void 0;return{...t,fileType:k.YB.Video,cover:i,width:e.width,height:e.height,duration:(null!==(n=e.duration)&&void 0!==n?n:0)/1e3,isVideoTranscoding:1===e.transcode_status,videoTranscodeInfo:j(e,"video"),thumb:T(null==e?void 0:e.sprite_frame)}}(e,t);case k.YB.Audio:return function(e,t){var r;return{...t,fileType:k.YB.Audio,duration:(null!==(r=e.duration)&&void 0!==r?r:0)/1e3,isAudioTranscoding:1===e.transcode_status,audioTranscodeInfo:j(e,"audio")}}(e,t);default:return t}}class O{get _networkClient(){return this._networkClientInstance||(this._networkClientInstance=function(){const e=(new v.yk).build({headers:{"Content-Type":"application/json"}});return(0,g.mH)(e),(0,y.J)(e),(0,h.V)(e),(0,m.e)(e),e}()),this._networkClientInstance}async getMaterials(e){const{count:t,assetSource:r,orderBy:o,order:n,workspaceId:i,spaceId:s}=e.config;try{const a=await this._networkClient.request({method:"POST",url:b,data:{count:t,asset_source:r,order_by:o,order:n,cursor:`${e.offset}`,workspace_id:i,space_id:s},withCredentials:!0}),{assets:c,has_more:l,new_cursor:u}=a;return(0,p.oW)((0,_.ib)(e.config,c.map(P),{hasMore:l,offset:Number(u)}))}catch(a){return(0,p.wf)(-1,null==a?void 0:a.message)}}async getMaterialsByIds(e){const t=this._splitArray(e.assetIds,100),r=(await Promise.all(t.map((t=>this._networkClient.request({method:"POST",url:R,data:{workspace_id:e.workspaceId,space_id:e.spaceId,asset_ids:t}}))))).reduce(((e,t)=>e.concat(t.assets.map(P))),[]);return e.assetIds.length>r.length?(0,p.wf)(-1,"not found all assets"):(0,p.oW)(r)}async copyMaterialToWorkspace(e){const{fromWorkspaceId:t,toWorkspaceId:r,meta:o,assetId:n}=e;try{return await this._networkClient.request({method:"POST",url:w,data:{from_workspace_id:t,to_workspace_id:r,meta:o,asset_id:n},withCredentials:!0}),(0,p.ly)()}catch(i){return(0,p.wf)(-1,null==i?void 0:i.message)}}async deleteMaterials(e){const{workspaceId:t,assetIds:r}=e;try{return await this._networkClient.request({method:"POST",url:S,data:{workspace_id:t,asset_ids:r},withCredentials:!0}),(0,p.ly)()}catch(o){return(0,p.wf)(-1,null==o?void 0:o.message)}}_splitArray(e,t){const r=[];for(let o=0;o<e.length;o+=t)r.push(e.slice(o,o+t));return r}}var M,I,x,E,D,A=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},U=function(e,t){return function(r,o){t(r,o,e)}};let N=class extends o.JT{constructor(e,t,r,o,s){super(),this.accountService=e,this.workspaceService=t,this.environmentService=r,this.reporterService=o,this.teaAdapterService=s,this._onReady=this._store.add(new n.Q),this.onReady=this._onReady.event,this._initAwaitLocker=new i.G,this._userMaterialsRepository=new O,f.m7.prefetchWasmCode(),f.m7.setCachePlugin(new f.dV),t.initialize().then((()=>{this._initWithLoginState()})),this.accountService.hasLogin||this._initWithUnLoginState()}get isReady(){return this._initAwaitLocker.hasBeenDone}getBaseEvercloud(){return f.m7}async getEvercloudInstance(e){await this._initAwaitLocker.awaitForInit();const t=this.workspaceService.getWorkspace(e);return f.m7.getSdkInstance({spaceId:t.space_id,dcName:t.space_idc,netconf:{base:t.space_host,media:t.space_res_host}})}disposeEvercloudInstance(e){const t=this.workspaceService.getWorkspace(e);f.m7.destroySdk(t.space_id)}async getMaterials(e){await this._initAwaitLocker.awaitForInit();const t=this.workspaceService.getWorkspace(e.config.workspaceId);return e.config.spaceId=t.space_id,this._userMaterialsRepository.getMaterials(e)}getMaterialsByIds(e){return this._userMaterialsRepository.getMaterialsByIds(e)}copyMaterialToWorkspace(e){return this._userMaterialsRepository.copyMaterialToWorkspace(e)}deleteMaterials(e){return this._userMaterialsRepository.deleteMaterials(e)}_initWithLoginState(){(0,s.Y2)(!this._initAwaitLocker.isIniting||!this._initAwaitLocker.hasBeenDone,"bootstrap is call more than once"),this._initAwaitLocker.startToInit();const e=this.accountService.userProfile;f.m7.setOptions({is_boe:!1,user_dc_name:e.idc,reqDomain:null==e?void 0:e.reqDomain,user_id:e.uid,level:"error",disable_start_sync_loop:!0}),f.m7.setTeaReporter({event:(...e)=>{this.reporterService.reportBusinessEvent(...e)},getVar:(e,t,r)=>r()}),this._initAwaitLocker.hasBeenDone||this._initAwaitLocker.initDone(),this._onReady.fire()}async _initWithUnLoginState(){f.m7.setNoSignOptions({uniqueId:await this.teaAdapterService.getWebId(),userRegion:this.accountService.regionSettings.region,isBoe:!this.environmentService.isProd,newIdc:this.accountService.regionSettings.webIdc,reqDomain:this.accountService.regionSettings.domain,imgUploader:{getSliceFunc:e=>e>1048576e3?10485760:5242880}}),this._initAwaitLocker.initDone(),this._onReady.fire()}};N=A([U(0,c.Gw),U(1,l.WL),U(2,u.Y),U(3,d.m),U(4,a.w),B("design:paramtypes",["function"==typeof(M=void 0!==c.Gw&&c.Gw)?M:Object,"function"==typeof(I=void 0!==l.WL&&l.WL)?I:Object,"function"==typeof(x=void 0!==u.Y&&u.Y)?x:Object,"function"==typeof(E=void 0!==d.m&&d.m)?E:Object,"function"==typeof(D=void 0!==a.w&&a.w)?D:Object])],N)},84240:(e,t,r)=>{r.d(t,{S:()=>o});const o=(0,r(67126).yh)("i18n-service")},27671:(e,t,r)=>{r.d(t,{D:()=>f});var o=r(27175),n=r(84568),i=r(86105),s=r(1504),a=r(98410),c=r(35545),l=r(48018),u=r(42058);class d{constructor(e){this._localeParam=e}getCurrentLocale(){return this._localeParam.locale}getSupportLocales(){return[this._localeParam]}setCurrentLocale(e){}formatLocalePath(e,t){return e}}class f extends c.JT{constructor(e){super(),this._initAwaitLock=new l.G,this._bootstrap(e)}get currentLocale(){return(0,u.ZB)(this._locale),this._locale.getCurrentLocale()}get supportLanguages(){return(0,u.ZB)(this._locale),this._locale.getSupportLocales()}changeLocale(e){this._locale.setCurrentLocale(e);const t=`${location.pathname}${location.search}`,r=this._locale.formatLocalePath({path:t,locale:e});t===r?window.location.reload():window.location.href=r}async allowToRender(){await this._initAwaitLock.awaitForInit()}_bootstrap(e){const{customLocaleParam:t,namespace:r,specifyLocale:c,apiKey:l,injectI18nResource:u}=e,f=new a.u({locale:c,countryCode:window.__locationCountryCode,getBrowserLang:()=>window.navigator.language,cookieGetter:s.Z.get.bind(s.Z),cookieSetter:s.Z.set.bind(s.Z)}),h=t?new d(t):f;this._locale=h;const p=h.getSupportLocales().map((e=>e.locale)),v=h.getCurrentLocale(),g=()=>{this._initAwaitLock.hasBeenDone||this._initAwaitLock.initDone()},y=e=>{e||o.ZP.use((0,n.CC)({loadOptions:{apiKey:null!=l?l:"38d171503ca311ee866b4ff6c924e0e2",namespace:null!=r?r:"WebClient",TEAChannelDomain:"",zoneHost:"https://starling-oversea.byteoversea.com",timeout:8e3},simpleLoad:!0,on:{done:()=>{g()}},fallbackTexts:{}})),o.ZP.use(i.p6).init({lng:v,supportedLngs:p,fallbackLng:["en"],thirdParamFallback:!0,saveMissing:!0,resources:e,missingKeyHandler:(...e)=>{}},e?g:void 0)};u&&u.lng===v?u.resources.then((e=>{e?y(e):y()})).catch((()=>{y()})):y()}}},3765:(e,t,r)=>{r.d(t,{B:()=>o});const o=(0,r(67126).yh)("image-upload-service")},53003:(e,t,r)=>{r.d(t,{Y:()=>C});var o=r(35545),n=r(42058),i=r(13659),s=r(3906),a=r(67986);const c="324442",l={serviceId:"danaa4gfht"},u={serviceId:"tnf8g33v4j"},d=String.fromCharCode(98),f=String.fromCharCode(115),h=String.fromCharCode(116),p=String.fromCharCode(121),v=`${d}${p}${h}ed`,g=`${d}${p}${h}evcloudapi`;var y,m;function _({region:e}){const t={imageHost:"",videoHost:"",videoFallbackHost:"",imageFallbackHost:""};switch(e){case"boei18n":t.videoHost=`https://vas-${d}oei18n.${v}ance.net`,t.imageHost=`https://vas-${d}oei18n.${v}ance.net`;break;case"us-east-1":t.videoHost=`https://vod-us-east-1.${g}.com`,t.imageHost=`https://imagex-us-east-1.${g}.com`,t.videoFallbackHost=`https://open-us-east-1.${g}.com`,t.imageFallbackHost=`https://open-us-east-1.${g}.com`;break;case"gcp":t.videoHost=`https://vod-us-east-2.${g}.com`,t.imageHost=`https://imagex-us-east-2.${g}.com`,t.videoFallbackHost=`https://open-us-east-2.${g}.com`,t.imageFallbackHost=`https://open-us-east-2.${g}.com`;break;case"ap-singapore-1":t.videoHost=`https://vod-ap-singapore-1.${g}.com`,t.imageHost=`https://imagex-ap-singapore-1.${g}.com`,t.videoFallbackHost=`https://open-ap-singapore-1.${g}.com`,t.imageFallbackHost=`https://open-ap-singapore-1.${g}.com`;break;case"US-TTP":t.videoHost="https://api16-normal-useast5.us.tiktokv.com/top/v1",t.imageHost="https://api16-normal-useast5.us.tiktokv.com/top/v1",t.videoFallbackHost="https://api19-normal-useast5.us.tiktokv.com/top/v1";break;default:t.videoHost=`https://vod.${v}anceapi.com`,t.imageHost=`https://imagex.${v}anceapi.com`,t.videoFallbackHost=`https://vas-lf-x.${f}ns${f}dk.com`,t.imageFallbackHost=`https://open.${v}anceapi.com`}return t}!function(e){e["us-east-1"]="us-east-1",e["ap-singapore-1"]="ap-singapore-1",e["us-east-red"]="us-east-red",e.boe="boe",e.boei18n="boei18n",e["US-TTP"]="US-TTP",e.gcp="gcp"}(y||(y={})),function(e){e.Video="video",e.Image="image",e.Object="object"}(m||(m={}));var b,R,w=r(47006),S=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},T=function(e,t){return function(r,o){t(r,o,e)}};let C=class extends o.JT{constructor(e,t){super(),this.imageXDataService=e,this.accountService=t,this._lastFlushTokenTime=Date.now(),this._tokenMaxAge=12e5,this._region=y["us-east-1"]}async bootstrap(){this._getStsToken(),this._setUploadRegion();let e,t="unknow";this.accountService.hasLogin&&(t=this.accountService.userProfile.uid),e=this._region===y["us-east-1"]?l.serviceId:u.serviceId;const o=(await Promise.all([r.e(592),r.e(444),r.e(425),r.e(29),r.e(542),r.e(430),r.e(294),r.e(922),r.e(377),r.e(52),r.e(435),r.e(774),r.e(54),r.e(880),r.e(375),r.e(933),r.e(188),r.e(408),r.e(611),r.e(429),r.e(634),r.e(458),r.e(550),r.e(873)]).then(r.t.bind(r,49220,23))).default;this._imageXUploader=new o({userId:t,appId:Number(c),region:this._region,imageConfig:{serviceId:e},..._({region:this._region})})}async uploadImage({file:e}){if((0,n.ZB)(this._imageXUploader),(Date.now()-this._lastFlushTokenTime>this._tokenMaxAge||!this._stsToken)&&await this._getStsToken(),!this._stsToken)return(0,i.wf)(-1,"sts token is undefined");const t=this._imageXUploader.addFile({file:e,stsToken:this._stsToken,type:m.Image});return this._imageXUploader.start(t),new Promise((e=>{var t,r;null===(t=this._imageXUploader)||void 0===t||t.on("complete",(t=>{var r,o,n,s,a;const{uploadResult:c}=t;e((0,i.oW)({uri:null!==(r=c.Uri)&&void 0!==r?r:"",width:null!==(o=c.ImageWidth)&&void 0!==o?o:0,height:null!==(n=c.ImageHeight)&&void 0!==n?n:0,md5:null!==(s=c.ImageMd5)&&void 0!==s?s:"",fileName:null!==(a=c.FileName)&&void 0!==a?a:""}))})),null===(r=this._imageXUploader)||void 0===r||r.on("error",(t=>{var r;e((0,i.wf)(null!==(r=t.extra.errorCode)&&void 0!==r?r:-1,t.extra.message))}))}))}async _getStsToken(){const e=await this.imageXDataService.getImageXToken();if(!e.ok)return a.t.error(`[ImageXUploadService] bootstrap failed when get imagex token: ${e.msg}`),void(this._stsToken=void 0);this._stsToken={AccessKeyId:e.value.accessKeyId,SecretAccessKey:e.value.secretAccessKey,SessionToken:e.value.sessionToken,ExpiredTime:e.value.expiredTime,CurrentTime:e.value.currentTime,SpaceName:e.value.spaceName},this._lastFlushTokenTime=Date.now()}_setUploadRegion(){const{webIdc:e}=this.accountService.regionSettings;let t=y["us-east-1"];"sg1"===e&&(t=y["ap-singapore-1"]),this._region=t}};C=S([T(0,s.p),T(1,w.Gw),k("design:paramtypes",["function"==typeof(b=void 0!==s.p&&s.p)?b:Object,"function"==typeof(R=void 0!==w.Gw&&w.Gw)?R:Object])],C)},32085:(e,t,r)=>{var o,n,i;r.d(t,{N9:()=>i,VD:()=>o,yl:()=>n}),function(e){e[e.EMPTY=-1]="EMPTY",e[e.BREAK=3]="BREAK",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.CLEAR=12]="CLEAR",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.ARROW_LEFT=37]="ARROW_LEFT",e[e.ARROW_UP=38]="ARROW_UP",e[e.ARROW_RIGHT=39]="ARROW_RIGHT",e[e.ARROW_DOWN=40]="ARROW_DOWN",e[e.SELECT=41]="SELECT",e[e.PRINT=42]="PRINT",e[e.EXECUTE=43]="EXECUTE",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.HELP=47]="HELP",e[e.NUM_0=48]="NUM_0",e[e.NUM_1=49]="NUM_1",e[e.NUM_2=50]="NUM_2",e[e.NUM_3=51]="NUM_3",e[e.NUM_4=52]="NUM_4",e[e.NUM_5=53]="NUM_5",e[e.NUM_6=54]="NUM_6",e[e.NUM_7=55]="NUM_7",e[e.NUM_8=56]="NUM_8",e[e.NUM_9=57]="NUM_9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META_LEFT=91]="META_LEFT",e[e.META_RIGHT=93]="META_RIGHT",e[e.NUM_TIMES=106]="NUM_TIMES",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_POINT=110]="NUM_POINT",e[e.NUM_DIVIDE=111]="NUM_DIVIDE",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.SEMI=186]="SEMI",e[e.EQUAL=187]="EQUAL",e[e.COMMA=188]="COMMA",e[e.MINUS=189]="MINUS",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.BACKQUOTE=192]="BACKQUOTE",e[e.BRACKET_LEFT=219]="BRACKET_LEFT",e[e.BACK_SLASH=220]="BACK_SLASH",e[e.BRACKET_RIGHT=221]="BRACKET_RIGHT"}(o||(o={})),function(e){e[e.EQUAL=61]="EQUAL",e[e.MINUS=173]="MINUS",e[e.META_FIREFOX=224]="META_FIREFOX"}(n||(n={})),function(e){e[e.SHIFT=1e3]="SHIFT",e[e.ALT=1e4]="ALT",e[e.CTRL_WIN=1e5]="CTRL_WIN",e[e.CTRL_MAC=2e5]="CTRL_MAC",e[e.WIN=1e6]="WIN",e[e.COMMAND=2e6]="COMMAND"}(i||(i={}))},39871:(e,t,r)=>{r.d(t,{J:()=>p});var o=r(77685),n=r(78619),i=r(35545),s=r(91139),a=r(42058),c=r(33004),l=r(32085);class u{static getKeyCode(e){let{keyCode:t}=e;return s.vU&&(t===l.yl.EQUAL?t=l.VD.EQUAL:t===l.yl.MINUS&&(t=l.VD.MINUS)),t}static getAssistKey(e){let t=0;return s.V5||s.YX?(t+=e.altKey?l.N9.ALT:0,t+=e.shiftKey?l.N9.SHIFT:0,t+=e.ctrlKey?l.N9.CTRL_MAC:0,t+=e.metaKey?l.N9.COMMAND:0):(t+=e.altKey?l.N9.ALT:0,t+=e.shiftKey?l.N9.SHIFT:0,t+=e.ctrlKey?l.N9.CTRL_WIN:0,t+=e.metaKey?l.N9.WIN:0),t}}function d(e,t){return(t.weight||0)-(e.weight||0)}class f extends i.JT{constructor(e,t,r=!1){super(),this._keymap=new Map,this._onKeyDown=e=>{if(this._keybindingService.isKeybindingDisabled)return;const t=u.getKeyCode(e),r=u.getAssistKey(e)+t;this._execute(r,e)},this._targetNode=t,this._keybindingService=e,this._register((0,c.n)(t,"keydown",this._onKeyDown,{capture:r}))}get targetNode(){return this._targetNode}get platform(){return s.V5||s.gn?"mac":"win"}register(e){(0,a.Y2)(this._isValidConfig(e));e.keyBindings[this.platform].slice().forEach((t=>{if(t===l.VD.EMPTY)return;let r=[e];if(this._keymap.has(t)){const e=this._keymap.get(t);e&&(r=r.concat(e))}this._keymap.set(t,r)}))}unregister(e){(0,a.Y2)(this._isValidConfig(e));e.keyBindings[this.platform].slice().forEach((t=>{if(t!==l.VD.EMPTY&&this._keymap.has(t)){const r=this._keymap.get(t);if(r){const t=r.indexOf(e);t>-1&&r.splice(t,1)}}}))}dispose(){this._keybindingService.removeContext(this),super.dispose()}_execute(e,t){const r=this._keymap.get(e);null==r||r.sort(d),null==r||r.forEach((async e=>{const{handler:r,shouldPreventDefault:o=!0,when:n}=e;this._isEnabledOnFormTags(t,e)&&(n&&!await n(t)||(o&&t&&t.preventDefault(),r(t)))}))}_isValidConfig(e){return!!e&&("function"==typeof e.handler&&((!e.when||"function"==typeof e.when)&&(!(e.keyBindings.mac&&!Array.isArray(e.keyBindings.mac))&&(!(e.keyBindings.win&&!Array.isArray(e.keyBindings.win))&&!(e.description&&!Array.isArray(e.description))))))}_isEnabledOnFormTags(e,t){if(!0===t.enableOnFormTags)return!0;const r=t.enableOnFormTags||["INPUT","TEXTAREA","SELECT"],o=e.target.tagName;return!r.includes(o)}}const h=n.Mq?"metaKey":"ctrlKey";class p{get cmdKeyHadDown(){return this._cmdKeyHadDown}get isKeybindingDisabled(){return this._isKeybindingDisabled}constructor(){this._serviceBrand=void 0,this._contextMap=new Map,this._isKeybindingDisabled=!1,this._cmdKeyHadDown=!1,this._cmdKeyDown=new o.Q,this.onCmdKeyDown=this._cmdKeyDown.event,this._cmdKeyDownListener=e=>{this._cmdKeyHadDown!==Boolean(e[h])&&(this._cmdKeyHadDown=!this._cmdKeyHadDown,this._cmdKeyDown.fire(this._cmdKeyHadDown))},this._resetCmdKeyDownState=()=>{this._cmdKeyHadDown=!1,this._cmdKeyDown.fire(this._cmdKeyHadDown)},document.addEventListener("keydown",this._cmdKeyDownListener,!0),document.addEventListener("keyup",this._cmdKeyDownListener,!0),document.addEventListener("mouseenter",this._resetCmdKeyDownState)}getOrCreateContext(e,t=!1){if(this._contextMap.has(e))return this._contextMap.get(e);const r=new f(this,e,t);return this._contextMap.set(e,r),r}removeContext(e){this._contextMap.has(e.targetNode)&&this._contextMap.delete(e.targetNode)}disableKeybinding(){this._isKeybindingDisabled=!0}restoreKeybinding(){this._isKeybindingDisabled=!1}dispose(){document.removeEventListener("keydown",this._cmdKeyDownListener,!0),document.removeEventListener("keyup",this._cmdKeyDownListener,!0),document.removeEventListener("mouseenter",this._resetCmdKeyDownState)}}},68099:(e,t,r)=>{r.d(t,{d:()=>o});const o=(0,r(67126).yh)("keybinding")},22979:(e,t,r)=>{r.d(t,{DT:()=>i,lT:()=>s,zb:()=>o});var o,n=r(67126);!function(e){e.Success="success",e.Info="info",e.Warning="warning",e.Error="error",e.Normal="normal"}(o||(o={}));const i=3,s=(0,n.yh)("notification")},8534:(e,t,r)=>{r.d(t,{g:()=>s});var o=r(35545),n=r(22979),i=r(74532);class s extends o.JT{constructor(){super(...arguments),this._notificationList=[],this._maxNotifications=n.DT}success(e){this._addNotification(e,n.zb.Success)}info(e){this._addNotification(e,n.zb.Info)}warning(e){this._addNotification(e,n.zb.Warning)}error(e){this._addNotification(e,n.zb.Error)}normal(e){this._addNotification(e,n.zb.Normal)}_addNotification(e,t){const r=this._findDuplicated(e);r?r.close():this._notificationList.length===this._maxNotifications&&this._notificationList[0].close();const o=Date.now(),n=i.Z[t]({content:e,onClose:()=>this._onClose(o)});this._notificationList.push({message:e,severity:t,id:o,close:()=>{this._isNotificationExisted(o)&&(n(),this._removeNotificationFromList(o))}})}_findDuplicated(e){return this._notificationList.find((t=>t.message=e))}_isNotificationExisted(e){return-1!==this._notificationList.findIndex((t=>t.id===e))}_removeNotificationFromList(e){const t=this._notificationList.findIndex((t=>t.id===e));this._notificationList.splice(t,1)}_onClose(e){this._removeNotificationFromList(e)}}},28683:(e,t,r)=>{var o;r.d(t,{O:()=>o}),function(e){e[e.readonly=1]="readonly",e[e.editable=2]="editable",e[e.owner=3]="owner"}(o||(o={}))},21100:(e,t,r)=>{r.d(t,{H:()=>o});const o=(0,r(67126).yh)("permission-service")},34823:(e,t,r)=>{r.d(t,{$:()=>i});var o=r(42058),n=r(28683);class i{constructor(){this._draftPermission=n.O.readonly}setDraftPermission(e){this._draftPermission=e}getDraftPermission(){return(0,o.ZB)(this._draftPermission),this._draftPermission}}},29204:(e,t,r)=>{r.d(t,{O:()=>o});class o{constructor(e,t,r,o){this._sdk=e,this._logParams=r,this._captureParams=o;const{metrics:n,categories:i}=this._separateEventParams(t);this._eventMetrics=n,this._eventCategories=i}setConfig(e){this._sdk("config",e)}captureException(e,t,r={},o){const n={...this._captureParams,...r,label:e},i=this._findJsError(t);this._sdk("captureException",i,n,o)}sendEvent(e,t={}){const r=this._separateEventParams(t);this._sdk("sendEvent",{name:e,metrics:{...this._eventMetrics,...r.metrics},categories:{...this._eventCategories,...r.categories}})}sendLog(e,t,r={}){this._sdk("sendLog",{level:e,content:t,extra:{...this._logParams,...r}})}_findJsError(e){let t=e;for(;t;){if(t instanceof Error)return t;t=t.cause}return e.toString()}_separateEventParams(e){const t={},r={};return Object.keys(e).forEach((o=>{"string"==typeof e[o]?r[o]=e[o]:"number"==typeof e[o]&&(t[o]=e[o])})),{metrics:t,categories:r}}}},44260:(e,t,r)=>{r.d(t,{z:()=>ce});var o=r(13659),n=r(42058);class i{constructor(e){this._store=new Map;for(const t of e){(0,n.Y2)(!this._store.has(t.id));const e=new Map;for(const r of t.tables)(0,n.Y2)(!e.has(r.name)),e.set(r.name,r);this._store.set(t.id,{version:t.version,tables:e})}}get store(){return this._store}}var s,a=r(19003);!function(e){e[e.KvError=11e4]="KvError",e[e.KvSetError=110001]="KvSetError",e[e.KvSetOverSize=110002]="KvSetOverSize",e[e.KvDeleteError=110003]="KvDeleteError",e[e.KvQueryError=110004]="KvQueryError",e[e.KvClearError=110005]="KvClearError",e[e.KvKeyNotFound=110006]="KvKeyNotFound",e[e.DbDatabaseNotFound=111001]="DbDatabaseNotFound",e[e.DbTableNotFound=111002]="DbTableNotFound",e[e.DbConnectError=111003]="DbConnectError",e[e.DbQuotaExceeded=111004]="DbQuotaExceeded",e[e.DbSetError=111005]="DbSetError",e[e.DbDeleteError=111006]="DbDeleteError",e[e.DbQueryError=111007]="DbQueryError",e[e.DbClearError=111008]="DbClearError",e[e.DbCleanupError=111009]="DbCleanupError",e[e.DbTransactionError=111010]="DbTransactionError"}(s||(s={}));const c=(0,a.i)(s.KvError,"key value storage fail."),l=(0,a.i)(s.KvSetError,"set key value storage fail."),u=((0,a.i)(s.KvSetOverSize,"set key value storage oversize."),(0,a.i)(s.KvDeleteError,"delete key value storage fail.")),d=(0,a.i)(s.KvQueryError,"query key value storage fail."),f=(0,a.i)(s.KvClearError,"clear key value storage fail."),h=((0,a.i)(s.KvDeleteError,"delete key value storage not found."),(0,a.i)(s.DbDatabaseNotFound,"database not found."),(0,a.i)(s.DbTableNotFound,"table not found."),(0,a.i)(s.DbConnectError,"connect db fail.")),p=((0,a.i)(s.DbQuotaExceeded,"db quota exceeded."),(0,a.i)(s.DbSetError,"set database fail.")),v=(0,a.i)(s.DbDeleteError,"delete database fail."),g=(0,a.i)(s.DbQueryError,"query database fail."),y=(0,a.i)(s.DbClearError,"clear database fail."),m=(0,a.i)(s.DbCleanupError,"cleanup database fail."),_=(0,a.i)(s.DbTransactionError,"invoke transaction fail.");class b{constructor(e,t){this._transaction=e,this._storeName=t}has(e){return new Promise(((t,r)=>{const o=this._transaction.objectStore(this._storeName).openCursor(e);o.onerror=()=>{r(o.error)},o.onsuccess=()=>{t(Boolean(o.result))}}))}async set(e,t){const r=await this.query(e);return t.createTime=r?r.createTime:Date.now(),t.updateTime=Date.now(),new Promise(((e,r)=>{const o=this._transaction.objectStore(this._storeName).put(t);o.onerror=()=>{r(o.error)},o.onsuccess=()=>{e()}}))}setMany(e){const t=[];for(const r of e)t.push(this.set(r.key,r.value));return new Promise(((e,r)=>{Promise.all(t).then((()=>{e()})).catch((e=>{r(e)}))}))}delete(e){return new Promise(((t,r)=>{const o=this._transaction.objectStore(this._storeName).delete(e);o.onerror=()=>{r(o.error)},o.onsuccess=()=>{t()}}))}deleteMany(e){const t=[];for(const r of e)t.push(this.delete(r));return new Promise(((e,r)=>{Promise.all(t).then((()=>{e()})).catch((e=>{r(e)}))}))}query(e){return new Promise(((t,r)=>{const o=this._transaction.objectStore(this._storeName).get(e);o.onerror=()=>{r(o.error)},o.onsuccess=()=>{const e=this._handleResult(o.result);t(e)}}))}queryMany(e){const t=new Map,r=[];for(const o of e)r.push(this.query(o).then((e=>(e&&t.set(o,e),e))));return new Promise(((e,o)=>{Promise.all(r).then((()=>{e(t)})).catch((e=>{o(e)}))}))}clear(){return new Promise(((e,t)=>{const r=this._transaction.objectStore(this._storeName).clear();r.onerror=()=>{t(r.error)},r.onsuccess=()=>{e()}}))}_handleResult(e){if(e){if(void 0===e.maxAge)return e;if(!(e.updateTime+e.maxAge<Date.now()))return e}}}function R(e){return new Promise((t=>{setTimeout(t,e)}))}function w(e,t,r){const o=r.value,n=async(t,...r)=>{const n=await e.reopenDatabase.apply(t);return n.ok?o.apply(t,r):n};return r.value=async function(...t){const r=await o.apply(this,t);if(r.ok)return r;if(!r.cause)return r;switch(r.cause.name){case"QuotaExceededError":{e.readyCleanup.apply(this),await R(500);const o=await n(this,...t);return o.ok?o:r}case"InvalidStateError":{const e=await n(this,...t);return e.ok?e:r}default:return r}},r}var S,k,T,C,j,P,O,M=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class x{constructor(e,t,r,o){this._database=e,this._storeName=t,this._databasePool=r,this._cleanupMgr=o}set(e,t){return new Promise((async r=>{try{const n=this._database.transaction(this._storeName,"readwrite");n.onabort=()=>{r(p(n.error))},n.onerror=()=>{r(p(n.error))},n.oncomplete=()=>{r((0,o.ly)())};const i=new b(n,this._storeName);await i.set(e,t)}catch(n){r(p(n))}}))}setMany(e){return new Promise((async t=>{try{const r=this._database.transaction(this._storeName,"readwrite");r.onabort=()=>{t(p(r.error))},r.onerror=()=>{t(p(r.error))},r.oncomplete=()=>{t((0,o.ly)())};const n=new b(r,this._storeName);await n.setMany(e)}catch(r){t(p(r))}}))}delete(e){return new Promise((async t=>{try{const r=this._database.transaction(this._storeName,"readwrite");r.onabort=()=>{t(v(r.error))},r.onerror=()=>{t(v(r.error))},r.oncomplete=()=>{t((0,o.ly)())};const n=new b(r,this._storeName);await n.delete(e)}catch(r){t(v(r))}}))}deleteMany(e){return new Promise((async t=>{try{const r=this._database.transaction(this._storeName,"readwrite");r.onabort=()=>{t(v(r.error))},r.onerror=()=>{t(v(r.error))},r.oncomplete=()=>{t((0,o.ly)())};const n=new b(r,this._storeName);await n.deleteMany(e)}catch(r){t(v(r))}}))}query(e){return new Promise((async t=>{try{const r=this._database.transaction(this._storeName,"readonly");r.onabort=()=>{t(g(r.error))},r.onerror=()=>{t(g(r.error))};const n=new b(r,this._storeName),i=await n.query(e);t((0,o.oW)(i))}catch(r){t(g(r))}}))}queryMany(e){return new Promise((async t=>{try{const r=this._database.transaction(this._storeName,"readonly");r.onabort=()=>{t(g(r.error))},r.onerror=()=>{t(g(r.error))};const n=new b(r,this._storeName),i=await n.queryMany(e);t((0,o.oW)(i))}catch(r){t(g(r))}}))}clear(){return new Promise((async e=>{try{const t=this._database.transaction(this._storeName,"readwrite");t.onabort=()=>{e(y(t.error))},t.onerror=()=>{e(y(t.error))},t.oncomplete=()=>{e((0,o.ly)())};const r=new b(t,this._storeName);await r.clear()}catch(t){e(y(t))}}))}async reopenDatabase(){try{return this._database=await this._databasePool.getDatabase(this._database.name),(0,o.ly)()}catch(e){return h(e)}}readyCleanup(){this._cleanupMgr.mark()}}M([w,I("design:type",Function),I("design:paramtypes",[String,void 0]),I("design:returntype","function"==typeof(S="undefined"!=typeof Promise&&Promise)?S:Object)],x.prototype,"set",null),M([w,I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype","function"==typeof(k="undefined"!=typeof Promise&&Promise)?k:Object)],x.prototype,"setMany",null),M([w,I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype","function"==typeof(T="undefined"!=typeof Promise&&Promise)?T:Object)],x.prototype,"delete",null),M([w,I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype","function"==typeof(C="undefined"!=typeof Promise&&Promise)?C:Object)],x.prototype,"deleteMany",null),M([w,I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype","function"==typeof(j="undefined"!=typeof Promise&&Promise)?j:Object)],x.prototype,"query",null),M([w,I("design:type",Function),I("design:paramtypes",[Array]),I("design:returntype","function"==typeof(P="undefined"!=typeof Promise&&Promise)?P:Object)],x.prototype,"queryMany",null),M([w,I("design:type",Function),I("design:paramtypes",[]),I("design:returntype","function"==typeof(O="undefined"!=typeof Promise&&Promise)?O:Object)],x.prototype,"clear",null);var E=r(86059),D=r(21698),A=r(80998);class B{constructor(e){this._request=e,this._currentCursor=null,this._request.onsuccess=()=>{this._resolve(this._request.result)},this._request.onerror=()=>{this._resolve(null)}}async next(){return this._continue(),this._currentCursor=await this._waiting,this._currentCursor?{value:this._currentCursor,done:!1}:{value:this._currentCursor,done:!0}}[Symbol.asyncIterator](){return this}_updateWaiting(){this._waiting=new Promise((e=>{this._resolve=e}))}_continue(){var e;this._updateWaiting(),null===(e=this._currentCursor)||void 0===e||e.continue()}}class U{constructor(e){this._schemas=e,this._pool=new Map}getDatabase(e){if(this._pool.has(e))return Promise.resolve(this._pool.get(e));const t=this._schemas.get(e);return new Promise(((r,o)=>{const n=indexedDB.open(e,t.version);n.onupgradeneeded=()=>{try{const t=n.result;this._initTable(t,e)}catch(t){o(t)}},n.onerror=e=>{o(e)},n.onblocked=e=>{o(e)},n.onsuccess=()=>{try{const t=n.result;this._listenDbEvent(t),this._pool.set(e,t),r(t)}catch(t){o(t)}}}))}_initTable(e,t){const r=this._schemas.get(t);(0,n.ZB)(r);const o=new Set;for(const n of e.objectStoreNames)o.add(n);for(const[n,i]of r.tables){if(o.has(n)){const t=this._getObjectStore(e,n);this._createIndex(t,i.index);continue}const t=e.createObjectStore(n,{keyPath:i.key});this._createIndex(t,i.index)}}_getObjectStore(e,t){return e.transaction(t,"readwrite").objectStore(t)}_createIndex(e,t){const r=new Set;for(const o of e.indexNames)r.add(o);for(const o of t)r.has(o.name)||e.createIndex(o.name,o.name,{unique:o.unique})}_removeCache(e){for(const[t,r]of this._pool)if(r===e)return void this._pool.delete(t)}_listenDbEvent(e){e.onversionchange=()=>{e.close(),this._removeCache(e)},e.onabort=()=>{e.close(),this._removeCache(e)},e.onerror=()=>{e.close(),this._removeCache(e)},e.onclose=()=>{this._removeCache(e)}}}var N,F,L,W,$,G,V,K=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Y=function(e,t){return function(r,o){t(r,o,e)}};!function(e){e[e.Idle=0]="Idle",e[e.Running=1]="Running"}(G||(G={})),function(e){e[e.Minor=0]="Minor",e[e.Major=1]="Major"}(V||(V={}));let q=class{constructor(e,t,r){this._schemas=e,this._databasePool=t,this._idleExecuteService=r,this._status=G.Idle,this._times=0,this._mark=!1}mark(){this._mark||(this._mark=!0,this._idleExecuteService.register({run:()=>{this.cleanup((0,E.fC)())}}))}cleanup(e){return this._mark=!1,this._status===G.Running?Promise.resolve((0,o.ly)()):(this._status=G.Running,this._cleanup(e))}_calcType(){return this._times=this._times%3,3==this._times++?V.Major:V.Minor}async _cleanup(e){let t;t=this._calcType()===V.Minor?.5:1;try{return await this._cleanupDatabases(t),(0,o.ly)()}catch(r){return m(r)}finally{this._status=G.Idle}}_getCount(e){return new Promise(((t,r)=>{const o=e.count();o.onsuccess=()=>{t(o.result)},o.onerror=e=>{r(e)}}))}_cleanupTable(e,t,r){return new Promise((async(o,n)=>{const i=e.transaction(t,"readwrite"),s=i.objectStore(t);if(!s.indexNames.contains("updateTime"))return;i.onabort=()=>{n(i.error)},i.onerror=()=>{n(i.error)},i.oncomplete=()=>{o()};const a=s.index("updateTime"),c=IDBKeyRange.lowerBound(0),l=await this._getCount(a),u=Math.floor(l*r);let d=0;for await(const e of function(e,t,r){const o=e.openCursor(t,r);return new B(o)}(a,c,"next")){if(!(e&&d<u))break;e.delete(),d++}}))}async _cleanupDatabases(e){const t=this._schemas.keys();for(const r of t){const t=await this._databasePool.getDatabase(r);for(const r of t.objectStoreNames)await this._cleanupTable(t,r,e)}}};K([(0,D.lI)("storage","cleanup"),H("design:type",Function),H("design:paramtypes",["function"==typeof(W=void 0!==E._y&&E._y)?W:Object]),H("design:returntype","function"==typeof($="undefined"!=typeof Promise&&Promise)?$:Object)],q.prototype,"cleanup",null),q=K([Y(2,A.hR),H("design:paramtypes",["function"==typeof(N="undefined"!=typeof Map&&Map)?N:Object,"function"==typeof(F=void 0!==U&&U)?F:Object,"function"==typeof(L=void 0!==A.hR&&A.hR)?L:Object])],q);var z=r(77685);class Z{constructor(e,t){this._transaction=e,this._cacheResult=new Map,this._tables=new Set,this._onError=new z.Q,this._onComplete=new z.Q,this._done=!1,this.onError=this._onError.event,this.onComplete=this._onComplete.event;for(const r of t)this._tables.add(r);this._transaction.onabort=()=>{this._onError.fire(this._transaction.error)},this._transaction.onerror=()=>{this._onError.fire(this._transaction.error)},this._transaction.oncomplete=()=>{this._onComplete.fire(this._cacheResult)}}get result(){return this._cacheResult}set(e,t,r){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).set(t,r).catch((e=>{this._onError.fire(e)}))}setMany(e,t){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).setMany(t).catch((e=>{this._onError.fire(e)}))}delete(e,t){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).delete(t).catch((e=>{this._onError.fire(e)}))}deleteMany(e,t){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).deleteMany(t).catch((e=>{this._onError.fire(e)}))}query(e,t){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done),this.queryMany(e,[t])}queryMany(e,t){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).queryMany(t).then((t=>{if(t){this._cacheResult.has(e)||this._cacheResult.set(e,new Map);for(const[r,o]of t)this._cacheResult.get(e).set(r,o)}})).catch((e=>{this._onError.fire(e)}))}clear(e){(0,n.Y2)(this._checkTable(e)),(0,n.Y2)(!this._done);new b(this._transaction,e).clear().catch((e=>{this._onError.fire(e)}))}commit(){this._done=!0}_checkTable(e){return this._tables.has(e)}}var Q,J,X=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class te extends i{constructor(e,t){super(e),this._databasePool=new U(this._store),this._cleanupMgr=t.createInstance(q,this._store,this._databasePool)}connect(e,t){return this._store.has(e)?this._connect(e,t):Promise.resolve(h("db not found."))}invokeTransaction(e,t,r,n){return new Promise((async i=>{try{const s=(await this._databasePool.getDatabase(e)).transaction(t,n),a=new Z(s,t);a.onError((e=>{i(_(e))})),a.onComplete((e=>{i((0,o.oW)(e))})),r(a),a.commit()}catch(s){i(_(s))}}))}readyCleanup(){this._cleanupMgr.mark()}_connect(e,t){return new Promise((async r=>{try{const n=await this._databasePool.getDatabase(e),i=new x(n,t,this._databasePool,this._cleanupMgr);r((0,o.oW)(i))}catch(n){r(h(n))}}))}}X([function(e,t,r){const o=r.value;return r.value=async function(...t){const r=await o.apply(this,t);if(r.ok)return r;if(!r.cause)return r;if("QuotaExceededError"===r.cause.name){e.readyCleanup.apply(this),await R(500);const n=await o.apply(this,t);return n.ok?n:r}return r},r},ee("design:type",Function),ee("design:paramtypes",[String,Array,Function,"function"==typeof(Q="undefined"!=typeof IDBTransactionMode&&IDBTransactionMode)?Q:Object]),ee("design:returntype","function"==typeof(J="undefined"!=typeof Promise&&Promise)?J:Object)],te.prototype,"invokeTransaction",null);class re{constructor(){this._localstorage=window.localStorage}set(e,t){if(!this._localstorage)return c();try{this._localstorage.setItem(e,t)}catch(r){return l(r)}return(0,o.ly)()}delete(e){if(!this._localstorage)return c();try{this._localstorage.removeItem(e)}catch(t){return u(t)}return(0,o.ly)()}query(e){if(!this._localstorage)return c();try{const t=this._localstorage.getItem(e);if(t)return(0,o.oW)(t)}catch(t){return d(t)}return(0,o.oW)(void 0)}queryAndParse(e,t){if(!this._localstorage)return c();try{const r=this._localstorage.getItem(e);if(r)return(0,o.oW)(t(r))}catch(r){return d(r)}return(0,o.oW)(void 0)}clear(){if(!this._localstorage)return c();try{this._localstorage.clear()}catch(e){return f(e)}return(0,o.ly)()}}var oe,ne=r(82552),ie=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ae=function(e,t){return function(r,o){t(r,o,e)}};let ce=class{constructor(e,t){this.keyValue=new re,this.database=new te(e,t)}};ce=ie([ae(1,ne.T),se("design:paramtypes",[Array,"function"==typeof(oe=void 0!==ne.T&&ne.T)?oe:Object])],ce)},27319:(e,t,r)=>{r.d(t,{d:()=>i});var o=r(67126),n=r(28620);const i=(0,o.LO)(n.U)},92848:(e,t,r)=>{r.d(t,{X:()=>m});var o=r(95930),n=r(29788),i=r(77685),s=r(42058),a=r(40673),c=r(57018);const l={appId:"app_id",appVersion:"app_version",userId:"user_id",hasLogin:"user_is_login",stagingFlag:"_staging_flag",enableTTWid:"enable_ttwebid"};class u{constructor(){this._customParams={},this._evtParams={},this._canReportPv=!0,this._pendingEventQueue=[]}setConfig(e){const t=this._transformToTeaConfig(e);this._sdk.config(t)}getTeaConfig(){return this._sdk.getConfig()}reportPv(e={}){this._canReportPv&&(this._canReportPv=!1,this._sdk.predefinePageView(e))}disableReportPv(){this._canReportPv=!1}setCustomParams(e){Object.assign(this._customParams,e),this._sdk.config({custom:this._customParams})}setCommonEventParams(e){Object.assign(this._evtParams,e),this._sdk.config({evtParams:this._evtParams})}track(e,t,r=!1){this._canReport()&&(r?this._reportBecon(e,t):this._report(e,t))}ensureTrack(e,t,r=!1){this._canReport()?r?this._reportBecon(e,t):this._report(e,t):this._pendingEventQueue.push({event:e,params:t,immediately:r})}getABTestVar(e,t){return new Promise((r=>{this._sdk.getVar(e,t,r)}))}async getWebId(){return await Promise.resolve(),"null"}_flush(){for(const e of this._pendingEventQueue)e.immediately?this._reportBecon(e.event,e.params):this._report(e.event,e.params)}_transformToTeaConfig(e){const t={};return Object.entries(e).forEach((([e,r])=>{t[l[e]?l[e]:e]=r})),e.userId&&(t.user_unique_id=e.userId),t}_report(e,t){this._sdk.event(e,t)}_reportBecon(e,t){this._sdk.beconEvent(e,t)}}var d=r(13659),f=r(98720);async function h(e,t,o){const n=await function(e){return(0,f.Hp)((async()=>{const t=await new Promise((t=>{e.getToken(t,3e3)})),{web_id:r}=t;return(0,s.ZB)(r),r}),3e3)}(o);return n.ok?async function(e,t){const{TtWid:o}=await Promise.all([r.e(592),r.e(444),r.e(425),r.e(29),r.e(542),r.e(430),r.e(294),r.e(922),r.e(377),r.e(52),r.e(435),r.e(774),r.e(54),r.e(880),r.e(375),r.e(933),r.e(188),r.e(408),r.e(611),r.e(429),r.e(634),r.e(458),r.e(550),r.e(873)]).then(r.bind(r,17267)),n=new o({aid:e,service:location.host,unionHost:t});try{return await n.checkWebIdFromTea(),(0,d.ly)()}catch(i){return(0,d.Mx)(-1,"webId invalid.",i)}}(e,t):n}var p,v=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t){return function(r,o){t(r,o,e)}};let m=class extends u{constructor(e,t,r){super(),this._cookieConsent=r,this._sdk=o.Z,this._running=!1,this._webId="",this._webIdMutexLock=new n.L,this._onBindTtWidError=new i.Q,this.onBindTtWidError=this._onBindTtWidError.event,this._initSdk(e,t),this._startSdk()}async getWebId(){if(this._webId)return this._webId;if(await this._webIdMutexLock.lockShared(),this._webId)return this._webId;const e=await new Promise((e=>{this._sdk.getToken(e,3e3)}));return this._webIdMutexLock.unLockShared(),this._webId=e.web_id,this._webId}_canReport(){return!!this._cookieConsent.enable}_initSdk(e,t){var r,o;this._sdk.init({app_id:e.appId,disable_auto_pv:e.disableAutoPv,disable_sdk_monitor:!this._cookieConsent.enable,channel:e.channel,enable_ab_test:null!==(r=e.enableAbTest)&&void 0!==r&&r,ab_channel_domain:null!==(o=e.abChannelDomain)&&void 0!==o?o:"",autotrack:e.autoTrack,disable_webid:Boolean(e.webId),max_report:e.maxReportMerge,reportTime:e.reportInterval}),e.disableAutoPv||super.disableReportPv(),this.setConfig(t),e.webId&&(this._webId=e.webId,this._sdk.config({web_id:e.webId})),!e.webId&&t.enableTTWid&&((0,s.Y2)(t.ttWidUnionHost,"must pass ttWidUnionHost when enableTTWid(true) and webId(no)."),this._prepareTtWebId(e.appId,t.ttWidUnionHost)),this._preparePermission()}_startSdk(){this._canReport()&&((0,s.Y2)(this._cookieConsent.enable),this._running||(this._sdk.start(),this._running=!0),this._flush())}async _prepareTtWebId(e,t){await this._webIdMutexLock.lock(),h(e,t,this._sdk).then((e=>{e.ok||this._onBindTtWidError.fire()})).finally((()=>{this._webIdMutexLock.unLock()}))}_preparePermission(){this._cookieConsent.enable||(0,a.V)(this._cookieConsent.onEnableChange)((()=>{this._startSdk()}))}};m=v([y(2,c.n),g("design:paramtypes",[Object,Object,"function"==typeof(p=void 0!==c.n&&c.n)?p:Object])],m)},93891:(e,t,r)=>{r.d(t,{X:()=>o});const o=(0,r(67126).yh)("theme-service")},28525:(e,t,r)=>{r.d(t,{f:()=>h});var o,n,i=r(35545),s=r(77685),a=r(42058),c=r(27319),l=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e,t){return function(r,o){t(r,o,e)}};!function(e){e.Dark="dark",e.Light="light"}(n||(n={}));const f="CAPCUT_THEME";let h=class extends i.JT{constructor(e){super(),this.storageService=e,this._onDidThemeChange=this._register(new s.Q),this.onDidThemeChange=this._onDidThemeChange.event}getTheme(){const e=this.storageService.keyValue.query(f);let t;return e.ok&&e.value?((0,a.ZB)(e.value),t=e.value):(t=n.Light,this.storageService.keyValue.set(f,t)),t}setTheme(e){this.storageService.keyValue.set(f,e),this._onDidThemeChange.fire(e)}};h=l([d(0,c.d),u("design:paramtypes",["function"==typeof(o=void 0!==c.d&&c.d)?o:Object])],h)},26690:(e,t,r)=>{r.d(t,{D:()=>o});const o=(0,r(67126).yh)("account")},47006:(e,t,r)=>{r.d(t,{Gw:()=>c,b_:()=>o,d:()=>n});var o,n,i,s=r(67126),a=r(26690);!function(e){e.Default="web_domain"}(o||(o={})),function(e){e.EditorLoginPopup="editor_login_popup",e.PageHeader="page_header",e.Export="export",e.GoogleDrive="google_drive",e.DropBox="dropbox",e.FromPhone="from_phone",e.FromComputer="from_computer",e.CollectionTab="collection_tab",e.useLimit="smart_tool_use_limit",e.uploadResult="smart_tool_upload_results",e.ScreenRecorder="screen_recorder",e.PartExport="part_export",e.PartExportSameTime="part_export_sametime",e.Cover="cover",e.CheckList="checklist"}(n||(n={})),function(e){e.TextToImage="text_to_image",e.ImageToImage="image_to_image",e.TextToDesign="text_to_draft",e.AiModel="ai_model_tryon",e.AiBackground="ai_background"}(i||(i={}));const c=(0,s.LO)(a.D)},9931:(e,t,r)=>{r.d(t,{r:()=>R});var o,n,i=r(70126),s=r(35545),a=r(77685),c=r(42058),l=r(40673),u=r(13659),d=r(47006),f=r(28628),h=r(77349),p=r(14463),v=r(58201),g=r(80941),y=r(72322),m=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},_=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e,t){return function(r,o){t(r,o,e)}};let R=class extends s.JT{constructor(e,t,r){super(),this._currentPage=e,this.teaReportService=t,this.userService=r,this._onDidLogin=this._store.add(new a.Q),this.onDidLogin=this._onDidLogin.event,this._onDidLogout=this._store.add(new a.Q),this.onDidLogout=this._onDidLogout.event,this._onDidChangeProfile=this._store.add(new a.Q),this.onDidChangeProfile=this._onDidChangeProfile.event,this._onDidChangeVipInfo=this._store.add(new a.Q),this.onDidChangeVipInfo=this._onDidChangeVipInfo.event,this._signModalClosable=!0,this._unloginRegion="";const o=window.document.createElement("div");o.id="account-service-container",window.document.body.append(o),this._domContainer=i.createRoot(o),this._render(),this.userService.registerTransition((e=>{var t,r;if(!e)return;const o=null===(t=e.context)||void 0===t?void 0:t.userInfo,n=null===(r=e.context)||void 0===r?void 0:r.vipInfo;(0,v.Z)(this._userProfile,o)||(o.hasLogin||""!==this._unloginRegion||(this._unloginRegion=o.region),this._userProfile=o,this._onDidChangeProfile.fire(o)),(0,v.Z)(this._userVipInfo,n)||(this._userVipInfo=n,this._onDidChangeVipInfo.fire(n))}))}get unloginRegion(){return this._unloginRegion}get regionSettings(){var e;return(0,c.Y2)(this._userProfile,"user profile is undefined"),{webIdc:this._userProfile.newIdc,region:this._userProfile.region,domain:{[d.b_.Default]:null===(e=this._userProfile.reqDomain)||void 0===e?void 0:e.web_domain}}}get userProfile(){return(0,c.Y2)(this._userProfile,"user profile is undefined"),this._userProfile}get isVip(){var e;return Boolean(null===(e=this._userVipInfo)||void 0===e?void 0:e.flag)}get userVipInfo(){return this._userVipInfo}initialize(e={}){const{needFireLoginCallback:t}=e;return new Promise(((e,r)=>{this.userService.listenOnUserStatusChange((({hasSign:o,noSign:n,initFailed:i})=>{if(i){const e=new Error("[user-plugin]: init user-os module failure.");r(e)}if(n||o){const r=o&&!this.hasLogin;this.hasLogin=Boolean(o);const n=h.Oy.getUserInfo();this._userProfile=n,r&&(null==t||t(),this._onDidLogin.fire()),e()}}))}))}login(e){var t;null!=e&&e.reportParams&&(e.reportParams.pageEnterFrom&&!e.reportParams.statusEnterFrom&&(e.reportParams.statusEnterFrom=e.reportParams.pageEnterFrom),this.userService.dangerUsedUserMachineService.send({type:"UPDATE_REPORT_PARAMS",params:{currentPage:this._currentPage,...e.reportParams}})),this._signModalClosable=null===(t=null==e?void 0:e.signModalClosable)||void 0===t||t,this._render(),this.userService.login(e)}loginWithAuthToken(e){return new Promise((t=>{const r=(0,l.V)(this.onDidLogin)((()=>{t((0,u.ly)())}));this.userService.dangerUsedUserMachineService.send({type:"SIGN_IN_WITH_AUTH_TOKEN",data:{token:e.token,state:e.state,onFailure:e=>{r.dispose(),t((0,u.wf)(-1,null==e?void 0:e.message))}}})}))}logout(e){this.userService.logout(e)}resetAndReload(){}_render(){return this._domContainer.render((0,y.jsx)(h.CV,{showFallback:!0,service:this.userService.dangerUsedUserMachineService,options:{isBOE:!1},children:(0,y.jsx)(h.n5,{params:{},enableReporter:!0,cookieConsent:p.cookieConsent,signModalClosable:this._signModalClosable,showProfile:!1})}))}};R=m([b(1,f.w),b(2,g.S),_("design:paramtypes",[String,"function"==typeof(o=void 0!==f.w&&f.w)?o:Object,"function"==typeof(n=void 0!==g.S&&g.S)?n:Object])],R)},80941:(e,t,r)=>{r.d(t,{K:()=>l,S:()=>c});var o=r(67126),n=r(35545),i=r(77685),s=r(4554),a=r(77349);const c=(0,o.yh)("user");class l extends n.JT{constructor(e=void 0){super(),this._onDidWorkspaceChange=this._store.add(new i.Q),this.onDidWorkspaceChange=this._onDidWorkspaceChange.event;const t=(0,s.kJ)(a.Zj.withContext({...a.Zj.context,...null!=e?e:{},shouldFetchLocation:!0,refreshWorkspaceListCb:e=>{e.length&&this._onDidWorkspaceChange.fire(e)}}));t.start(),this._userService=t,a.Oy.init({userService:t})}get dangerUsedUserMachineService(){return this._userService}registerTransition(e){this._userService.onTransition(e)}login(e){this._userService.send({type:"SIGN_IN",preExecTaskWhenLogin:null==e?void 0:e.execAfterLogin})}logout(e){this._userService.send({type:"SIGN_OUT",redirectUrl:e})}listenOnUserStatusChange(e){a.Oy.listenUserWholeStatus(e)}}},69412:(e,t,r)=>{r.d(t,{Ui:()=>c,aU:()=>a});var o,n=r(77685),i=r(42058),s=r(67126);!function(e){e[e.DYNAMIC_CONFIGURATION=0]="DYNAMIC_CONFIGURATION",e[e.AB_TEST=1]="AB_TEST",e[e.USER=2]="USER"}(o||(o={}));class a{constructor(){this._onDidChangeConfiguration=new n.Q,this.onDidChangeConfiguration=this._onDidChangeConfiguration.event}getRegisteredConfigurations(e){(0,i.ss)("not implemented")}registerSectionConfigurations(e,t){(0,i.ss)("not implemented")}removeSectionConfiguration(e){(0,i.ss)("not implemented")}getConfigurationValues(e,t){(0,i.ss)("not implemented")}updateConfigurationValues(e,t){(0,i.ss)("not implemented")}reloadConfigurations(){(0,i.ss)("not implemented")}}const c=(0,s.yh)("configuration")},25177:(e,t,r)=>{r.d(t,{J:()=>y});var o=r(77685),n=r(42058),i=r(84434),s=r(82552),a=r(46251),c=r(2897);class l extends a.F{setParent(e){this._parent=e}dispose(){this._parent=void 0;for(const[e,t]of this._services.entries)t instanceof c.M||t!==this&&t.dispose()}}var u=r(12206);class d extends u.o{register(e,t,r){super.register(e,t,r)}}var f,h,p=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t){return function(r,o){t(r,o,e)}};!function(e){e[e.Empty=1]="Empty",e[e.Starting=2]="Starting",e[e.Eventually=3]="Eventually"}(h||(h={}));let y=class{constructor(e){this._disposableInstantiationService=null,this._phase=h.Empty,this._onReset=new o.Q,this._instantiationService=e,this.onReset=this._onReset.event}get disposableInstantiationService(){return(0,n.ZB)(this._disposableInstantiationService),this._disposableInstantiationService}get invokeFunction(){return(0,n.ZB)(this._invokeFunction),this._invokeFunction}get createInstance(){return(0,n.ZB)(this._createInstance),this._createInstance}get createChild(){return(0,n.ZB)(this._createChild),this._createChild}makeDisposableServiceRegister(){return new d}registerServices(e){(0,n.Y2)(this._phase===h.Empty,"registerServices in invalid state."),this._phase=h.Starting,this._disposableInstantiationService=new l((0,i.T)(e)),this._disposableInstantiationService.setParent(this._instantiationService),this._phase=h.Eventually,this._invokeFunction=this._disposableInstantiationService.invokeFunction.bind(this._disposableInstantiationService),this._createInstance=this._disposableInstantiationService.createInstance.bind(this._disposableInstantiationService),this._createChild=this._disposableInstantiationService.createChild.bind(this._disposableInstantiationService)}reset(){this._disposableInstantiationService.dispose(),this._disposableInstantiationService=null,this._invokeFunction=void 0,this._createInstance=void 0,this._createChild=void 0,this._phase=h.Empty,this._onReset.fire()}};y=p([g(0,s.T),v("design:paramtypes",["function"==typeof(f=void 0!==a.F&&a.F)?f:Object])],y)},7647:(e,t,r)=>{r.d(t,{t:()=>o});const o=(0,r(67126).yh)("container")},3804:(e,t,r)=>{r.d(t,{_L:()=>x});const o=String.fromCharCode(97),n=String.fromCharCode(98),i=String.fromCharCode(99),s=String.fromCharCode(100),a=String.fromCharCode(101),c=String.fromCharCode(102),l=String.fromCharCode(103),u=(String.fromCharCode(104),String.fromCharCode(105),String.fromCharCode(106),String.fromCharCode(107),String.fromCharCode(108),String.fromCharCode(109),String.fromCharCode(110)),d=String.fromCharCode(111),f=(String.fromCharCode(112),String.fromCharCode(113),String.fromCharCode(114),String.fromCharCode(115),String.fromCharCode(116)),h=(String.fromCharCode(117),String.fromCharCode(118),String.fromCharCode(119),String.fromCharCode(120),String.fromCharCode(121)),p=(String.fromCharCode(122),o),v=i,g=s,y=a,m=l,_=u,b=d,R=f,w=h,S=`${n}${w}${R}${y}${g}${p}${_}${v}${y}`,k=`${n}${w}${R}${y}${g}`,T=`${m}${b}${b}${c}${w}`;const C=/^\S+?\.bytedance\.net$/.test(window.location.host),j=window.location.host.split(".")[0].includes("boe"),P=(/^\w+\.web\.bytedance\.net$/.test(window.location.host)||/^\S+?boe\.bytedance\.net$/.test(window.location.host)||/^\S?capcut-os\.bytedance\.net$/.test(window.location.host)||window.location.host.endsWith(`.boe.${T}.app`)||window.location.host.includes("localhost")||"127.0.0.1"===window.location.hostname||/^[\d.]+$/.test(window.location.hostname),{sg1:"wss://sami-sg1.byteintlapi.com",maliva:"wss://sami-maliva.byteintlapi.com"}),O={sg1:"https://sami-sg1.byteintlapi.com",maliva:"https://sami-maliva.byteintlapi.com"},M={web_domain:`https://capcut-os-boe.${S}.net`,tts_domain:`wss://sami-api-boe.${k}.org`,sami_domain:`https://sami-api-boe.${k}.org`,frontier_domain:`wss://capcut-os-boe.${S}.net`,commerce_domain:""},I={code:"US",country_name:"",city:"",web_idc:"maliva",domain:C?{web_domain:`https://capcut-web-va.${S}.net`,frontier_domain:`wss://frontier-va.${S}.net`,commerce_domain:`https://commerce-api-va.${S}.net`,tts_domain:P.maliva,sami_domain:O.maliva}:{web_domain:"https://edit-api-va.capcut.com",commerce_domain:"https://commerce-api-va.capcut.com",frontier_domain:"wss://frontier-va.capcut.com",tts_domain:P.maliva,sami_domain:O.maliva}};j&&(I.domain=M);const x=new class{constructor(e){this._map=new Map,this.setVars(e)}setVar(e,t){this._map.get(e)&&void 0===t||this._map.set(e,t)}setVars(e){for(const t in e)this.setVar(t,e[t])}getVar(e){return this._map.get(e)}getVars(e=[]){e=0===e.length?Array.from(this._map.keys()):e;const t={};for(const r of e)t[r]=this._map.get(r);return t}}(function(){let e=window.__locationInfo;if(e){const t=e.web_idc;e.domain.tts_domain=P[t],e.domain.sami_domain=O[t]}else e=I;return{web_idc:e.web_idc,country_code:e.code,...e.domain}}())},31594:(e,t,r)=>{var o;r.d(t,{_:()=>o}),function(e){e.Sticker="sticker",e.Font="font",e.TextTemplate="textTemplate",e.Shape="shape",e.ImageFrame="imageFrame",e.Photo="photo",e.UserAudio="userAudio",e.UserPhoto="userPhoto",e.UserVideo="userVideo",e.UserFile="userFile",e.ImageFilter="imageFilter",e.ImageEffect="imageEffect",e.AiBackground="aiBackground",e.UserMaterial="everCloud",e.EffectModel="effectModel",e.Video="video",e.Gif="gif",e.CurveHSL="CurveHSL",e.CurvePreset="curve_adjust_preset",e.VoiceChange="voice-change",e.ShootProject="shoot-project",e.LiveshortenPanEntertainment="liveshorten-pan-entertainment",e.FaceProp="face-prop",e.ShootProp="shoot-prop",e.Shoot="shoot",e.Play="play",e.SystemFonts="system-fonts",e.ManualFigure="manual-figure",e.SkeletonBody="skeleton-body",e.AISkeletonBody="beauty2",e.AutoBeautyBody="auto-beauty3",e.Beauty="beauty",e.AutoBeautyShape="auto-beauty",e.AutoBeautyFace="auto-beauty2",e.AutoBeautyMakeup="makeup",e.CoverFlower="flower2",e.ShootFilter="filter2",e.CoverBubble="bubble2",e.Effects="effects2",e.Tone="tone",e.Filter="filter",e.VideoBackground="videoBackground",e.Bubble="bubble",e.TextPreset="flower",e.Transition="transitions",e.Mix="mix",e.TextMotion="textMotion",e.VideoMotion="videoMotion",e.StickerMotion="stickerMotion",e.Insert="insert",e.Mask="videomask",e.CurveSpeed="curvespeed",e.Integration="integration",e.Iosemojinew="iosemojinew",e.Emoji="emoji",e.Emojiandroid="emojiandroid",e.Emojiios="emojiios",e.Audio="audio",e.ArithmeticModel="arithmetic-model",e.VideoTemplate="video-template",e.ShapeAnimation="shape-animation",e.Graffiti="graffiti",e.PathAnimation="path-animation"}(o||(o={}));o.Sticker,o.Font,o.TextTemplate,o.Shape,o.ImageFrame,o.ImageFilter,o.ImageEffect,o.AiBackground,o.UserMaterial,o.EffectModel,o.CurveHSL,o.CurvePreset,o.VoiceChange,o.ShootProject,o.LiveshortenPanEntertainment,o.FaceProp,o.ShootProp,o.Shoot,o.Play,o.SystemFonts,o.ManualFigure,o.SkeletonBody,o.AISkeletonBody,o.AutoBeautyBody,o.Beauty,o.AutoBeautyShape,o.AutoBeautyFace,o.AutoBeautyMakeup,o.CoverFlower,o.ShootFilter,o.CoverBubble,o.Effects,o.Tone,o.Filter,o.VideoBackground,o.Bubble,o.TextPreset,o.Transition,o.Mix,o.TextMotion,o.VideoMotion,o.StickerMotion,o.Insert,o.Mask,o.CurveSpeed,o.Integration,o.Iosemojinew,o.Emoji,o.Emojiandroid,o.Emojiios,o.ShapeAnimation,o.Graffiti,o.PathAnimation},32082:(e,t,r)=>{r.d(t,{kk:()=>s,yk:()=>a});var o=r(18398),n=r.n(o),i=r(74504);const s={headers:{"Content-Type":"application/json"},transformRequest:[(e={})=>n().stringify(e)],transformResponse:[function(e){try{return n()({storeAsString:!0}).parse(e)}catch(t){return{data:e}}}]};class a{static get apiSetting(){return a._apiSetting}static setApiSetting(e){a._apiSetting=e}build(e){return(0,i.eI)(e)}}},89930:(e,t,r)=>{async function o(e,t,{retryTimes:r,delay:n}){try{return await e.apply(this,t)}catch(i){if(--r<0)throw i;return await new Promise((e=>setTimeout(e,n))),o.apply(this,[e,t,{retryTimes:r,delay:n}])}}function n(e){const{retryTimes:t=1,delay:r=200}=null!=e?e:{};return function(e,n,i){const s=i.value;return i.value=function(...e){return o.apply(this,[s,e,{retryTimes:t,delay:r}])},i}}r.d(t,{K:()=>n})},5261:(e,t,r)=>{r.d(t,{V:()=>s});var o=r(98498),n=r.n(o);const i=e=>{const t=(e=>e.startsWith("http://")||e.startsWith("https://")?e:`${location.origin}${e}`)(e);return new URL(t)};function s(e,t){e.interceptors.request.use((e=>{const{url:r="",baseURL:o="",headers:s,data:a={}}=e,{loc:c,appSDKVesion:l,lan:u,pf:d,appVersion:f,tdid:h,signVer:p}=t,{pathname:v}=i(`${o}${r}`),g=v.length>=7?v.slice(-7):v;s.loc=c,s["app-sdk-version"]=l,s.lan=u,s.pf=d,s.appvr=f,s.tdid=h,s["sign-ver"]=p,s["device-time"]=Math.floor(Date.now()/1e3);const y=`9e2c|${g}|${d}|${f}|${s["device-time"]}|${h}|11ac`;return s.sign=n()(y).toLowerCase(),e.data=a,e}))}},98778:(e,t,r)=>{r.d(t,{J:()=>c});var o=r(32082),n=r(8757),i=r(67986);const s="custom-host-name-type",a="need-x-lvweb-idc-header";function c(e){e.interceptors.request.use((async e=>{var t,r;const c=Boolean(null===(t=e.baseURL)||void 0===t?void 0:t.startsWith("https")),l=e[s]||n.b_.Default,u=null===(r=e[a])||void 0===r||r;if(!c){let t=!1;setTimeout((()=>{t||i.t.error(`current request${e.url} is blocking by route. Please check`)}),2e3);const r=await o.yk.apiSetting.getRequestDomain({type:l});t=!0,e.baseURL=r}const d={...e.headers,loc:await o.yk.apiSetting.getUserRegion(),"x-lvweb-idc":o.yk.apiSetting.userIDC};return u||delete d["x-lvweb-idc"],Object.assign(e,{headers:d,withCredentials:!0}),e}))}},33648:(e,t,r)=>{function o(e){e.interceptors.response.use((e=>{if(200===e.status){var t;const r=e.data;if("0"===(null==r?void 0:r.ret)||0===(null==r||null===(t=r.BaseResp)||void 0===t?void 0:t.StatusCode))return Promise.resolve(null==r?void 0:r.data)}return Promise.reject(e.data)}))}function n(e){e.interceptors.response.use((e=>{if(200===e.status){var t;const r=e.data;if("0"===(null==r?void 0:r.ret)||0===(null==r||null===(t=r.BaseResp)||void 0===t?void 0:t.StatusCode)||0===(null==r?void 0:r.status_code))return Promise.resolve(e.data)}return Promise.reject(e.data)}))}r.d(t,{e:()=>o,i:()=>n})},39375:(e,t,r)=>{r.d(t,{mH:()=>l});var o=r(98498),n=r.n(o);const i=1,s="7",a="5.8.0";function c({url:e,pf:t,appvr:r,tdid:o}){const i=Math.floor(Date.now()/1e3);return{sign:n()(`9e2c|${e.slice(-7)}|${t}|${r}|${i}|${o}|11ac`).toLowerCase(),"device-time":i}}function l(e){e.interceptors.request.use((e=>{var t;const r={...c({url:null!==(t=e.url)&&void 0!==t?t:"",pf:s,appvr:a,tdid:""}),"sign-ver":i,pf:s,appvr:a};return Object.assign(e,{headers:{...e.headers,...r}}),e}))}},24386:(e,t,r)=>{r.d(t,{ib:()=>n,ky:()=>i,yt:()=>o});class o{constructor(e,t,r,o){this._config={},this.value=e,this._hasMore=t,this._offset=r,this.combineConfig(null!=o?o:{})}combineConfig(e){this._config=Object.assign({},this._config,e)}get config(){return this._config}set hasMore(e){this._hasMore=e}get hasMore(){return this._hasMore}set offset(e){this._offset=e}get offset(){return this._offset}}function n(e,t,r={hasMore:!0,offset:0}){return new o(t,r.hasMore,r.offset,e)}function i(e){return e instanceof o}},59470:(e,t,r)=>{var o,n,i,s,a;r.d(t,{PS:()=>a}),function(e){e[e.MetaTypeNone=0]="MetaTypeNone",e[e.MetaTypeVideo=1]="MetaTypeVideo",e[e.MetaTypePhoto=2]="MetaTypePhoto",e[e.MetaTypeGif=3]="MetaTypeGif",e[e.MetaTypeMusic=4]="MetaTypeMusic",e[e.MetaTypeExtractMusic=5]="MetaTypeExtractMusic",e[e.MetaTypeSound=6]="MetaTypeSound",e[e.MetaTypeRecord=7]="MetaTypeRecord",e[e.MetaTypeImage=8]="MetaTypeImage",e[e.MetaTypeText=9]="MetaTypeText",e[e.MetaTypeSubtitle=10]="MetaTypeSubtitle",e[e.MetaTypeLyrics=11]="MetaTypeLyrics",e[e.MetaTypeSticker=12]="MetaTypeSticker",e[e.MetaTypeFilter=13]="MetaTypeFilter",e[e.MetaTypeLUT=14]="MetaTypeLUT",e[e.MetaTypeReshape=15]="MetaTypeReshape",e[e.MetaTypeBeauty=16]="MetaTypeBeauty",e[e.MetaTypeVideoEffect=17]="MetaTypeVideoEffect",e[e.MetaTypeBrightness=18]="MetaTypeBrightness",e[e.MetaTypeContrast=19]="MetaTypeContrast",e[e.MetaTypeSaturation=20]="MetaTypeSaturation",e[e.MetaTypeSharpen=21]="MetaTypeSharpen",e[e.MetaTypeHighlight=22]="MetaTypeHighlight",e[e.MetaTypeShadow=23]="MetaTypeShadow",e[e.MetaTypeTemperature=24]="MetaTypeTemperature",e[e.MetaTypeHue=25]="MetaTypeHue",e[e.MetaTypeFade=26]="MetaTypeFade",e[e.MetaTypeLightSensation=27]="MetaTypeLightSensation",e[e.MetaTypeVignetting=28]="MetaTypeVignetting",e[e.MetaTypeParticle=29]="MetaTypeParticle",e[e.MetaTypeSegCanvas=30]="MetaTypeSegCanvas",e[e.MetaTypeCanvasColor=31]="MetaTypeCanvasColor",e[e.MetaTypeCanvasImage=32]="MetaTypeCanvasImage",e[e.MetaTypeCanvasBlur=33]="MetaTypeCanvasBlur",e[e.MetaTypeTransition=34]="MetaTypeTransition",e[e.MetaTypeAudioEffect=35]="MetaTypeAudioEffect",e[e.MetaTypeAudioFade=36]="MetaTypeAudioFade",e[e.MetaTypeBeats=37]="MetaTypeBeats",e[e.MetaTypeTailLeader=38]="MetaTypeTailLeader",e[e.MetaTypeAnimation=39]="MetaTypeAnimation",e[e.MetaTypeVideoAnimation=40]="MetaTypeVideoAnimation",e[e.MetaTypeTextEffect=41]="MetaTypeTextEffect",e[e.MetaTypeTextShape=42]="MetaTypeTextShape",e[e.MetaTypeTextToAudio=43]="MetaTypeTextToAudio",e[e.MetaTypeVideoMix=44]="MetaTypeVideoMix",e[e.MetaTypeAdjust=45]="MetaTypeAdjust",e[e.MetaTypeVideoMask=46]="MetaTypeVideoMask",e[e.MetaTypeSpeed=47]="MetaTypeSpeed",e[e.MetaTypeChroma=48]="MetaTypeChroma",e[e.MetaTypeTextTemplate=49]="MetaTypeTextTemplate",e[e.MetaTypeVideoOriginalSound=50]="MetaTypeVideoOriginalSound",e[e.MetaTypeStretchLeg=51]="MetaTypeStretchLeg",e[e.MetaTypeRealtimeDenoise=52]="MetaTypeRealtimeDenoise",e[e.MetaTypeFigure=53]="MetaTypeFigure",e[e.MetaTypeFaceEffect=54]="MetaTypeFaceEffect",e[e.MetaTypeVideoTracking=55]="MetaTypeVideoTracking",e[e.MetaTypeHsl=56]="MetaTypeHsl",e[e.MetaTypeColorCurves=57]="MetaTypeColorCurves",e[e.MetaTypeAudioBalance=58]="MetaTypeAudioBalance",e[e.MetaTypeComposition=59]="MetaTypeComposition",e[e.MetaTypeCover=60]="MetaTypeCover",e[e.MetaTypeLeader=61]="MetaTypeLeader",e[e.MetaTypeTailer=62]="MetaTypeTailer",e[e.MetaTypePrimaryColorWheels=63]="MetaTypePrimaryColorWheels",e[e.MetaTypeLogColorWheels=64]="MetaTypeLogColorWheels",e[e.MetaTypeHandwriteImage=65]="MetaTypeHandwriteImage",e[e.MetaTypeHandwriteRes=66]="MetaTypeHandwriteRes",e[e.MetaTypeCombination=67]="MetaTypeCombination",e[e.MetaTypeManualDeformation=68]="MetaTypeManualDeformation",e[e.MetaTypePluginEffect=69]="MetaTypePluginEffect",e[e.MetaTypeLockObject=70]="MetaTypeLockObject",e[e.MetaTypeAdCube=71]="MetaTypeAdCube",e[e.MetaTypeMattingStroke=72]="MetaTypeMattingStroke",e[e.MetaTypeSmartColorAdjust=73]="MetaTypeSmartColorAdjust",e[e.MetaTypeChannelMapping=74]="MetaTypeChannelMapping",e[e.MetaTypeBloom=75]="MetaTypeBloom",e[e.MetaTypeTextPreset=76]="MetaTypeTextPreset",e[e.MetaTypeGreenScreen=77]="MetaTypeGreenScreen",e[e.MetaTypeArticleToVideoTemplate=78]="MetaTypeArticleToVideoTemplate",e[e.MetaTypeAll=79]="MetaTypeAll"}(o||(o={})),function(e){e[e.MaterialPlatformDefault=0]="MaterialPlatformDefault",e[e.MaterialPlatformArtist=1]="MaterialPlatformArtist",e[e.MaterialPlatformXTApp=2]="MaterialPlatformXTApp",e[e.MaterialPlatformQYApp=3]="MaterialPlatformQYApp",e[e.MaterialPlatformFaceuApp=4]="MaterialPlatformFaceuApp",e[e.MaterialPlatformLVApp=5]="MaterialPlatformLVApp",e[e.MaterialPlatformCapCutApp=6]="MaterialPlatformCapCutApp",e[e.MaterialPlatformXigua=7]="MaterialPlatformXigua",e[e.MaterialPlatformGiphy=8]="MaterialPlatformGiphy",e[e.MaterialPlatformBrand=9]="MaterialPlatformBrand",e[e.MaterialPlatformEnterprise=10]="MaterialPlatformEnterprise",e[e.MaterialPlatformTuchongAdobe=11]="MaterialPlatformTuchongAdobe",e[e.MaterialPlatformTuchongDeposit=12]="MaterialPlatformTuchongDeposit",e[e.MaterialPlatformTuchongPond5=13]="MaterialPlatformTuchongPond5",e[e.MaterialPlatformStudioShooting=14]="MaterialPlatformStudioShooting"}(n||(n={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.HEYCAN=1]="HEYCAN",e[e.LOKI=2]="LOKI",e[e.MUSIC=3]="MUSIC",e[e.TUCHONG=5]="TUCHONG"}(i||(i={})),function(e){e.DEPOSIT="third_resource_tuchong_deposit",e.ADOBE="third_resource_tuchong_adobe",e.POND5="third_resource_tuchong_pond5"}(s||(s={})),function(e){e.AES_GCM="AES-GCM",e.AES_CBC="AES-CBC"}(a||(a={}))},79651:(e,t,r)=>{r.d(t,{w:()=>o});class o{constructor(e){this._options=e}url(e){const{baseURL:t,domain:r,urlMap:o}=this._options;return r?`${"/"===r?"":r}${t}${o[e]}`:""}}},34639:(e,t,r)=>{r.d(t,{K:()=>o});const o=(0,r(67126).yh)("shape-data-service")},32651:(e,t,r)=>{r.d(t,{b:()=>q});var o=r(35545),n=r(82552),i=r(31594),s=r(47006),a=r(32082),c=r(33648),l=r(3804),u=r(83055),d=r(13659);const f="/lv/v1/effect/get_category_effects",h="/lv/v1/effect/batch_by_resource",p="999.999.999",v="14.2.0";var g,y,m,_=r(27175),b=r(69412),R=r(28620),w=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k=function(e,t){return function(r,o){t(r,o,e)}};let T=class{get _networkClient(){return this._networkClientInstance||(this._networkClientInstance=function(){const e=(new a.yk).build(a.kk);return(0,c.i)(e),(0,u.V)(e),e}()),this._networkClientInstance}constructor(e,t,r){this.accountService=e,this.configurationService=t,this._storageService=r}async batchGetResources(e){try{var t,r;const o=await this._networkClient.post(this._batchApi,this._convertBatchGetResourcesParamsToRequest(e)),n=null===(t=o.BaseResp)||void 0===t?void 0:t.StatusCode,i=null===(r=o.BaseResp)||void 0===r?void 0:r.StatusMessage;if(0!==n)return(0,d.wf)(null!=n?n:-1,null!=i?i:"");const s=this.parseEffectsToResources(o.data);return(0,d.oW)({list:s})}catch(o){return(0,d.wf)(-1,"batchGetResourcesByIds api error")}}_convertBatchGetResourcesParamsToRequest(e){const t={appVersion:p,sdkVersion:v,lang:_.ZP.language,region:this.accountService.userProfile.region,...e.enterFrom?{enter_from:e.enterFrom}:void 0,list:this._getIdList(e)};if(this.configurationService.abTestManager){var r,o;const e=null===(r=(o=this.configurationService.abTestManager).getNewTransitionEffectEnabled)||void 0===r?void 0:r.call(o);t.cc_web_version=e?1:0}const n=this.buildCustomRequest(e);return{...t,...n}}buildCustomRequest(e){return{}}get _batchApi(){return`${l._L.getVar("web_domain")}${h}`}_getIdList(e){return[{type:this.configurationService.resourcePanel[this.resourceType],ids:e.ids,appVersion:p}]}};T=w([k(0,s.Gw),k(1,b.Ui),k(2,R.U),S("design:paramtypes",["function"==typeof(g=void 0!==s.Gw&&s.Gw)?g:Object,"function"==typeof(y=void 0!==b.Ui&&b.Ui)?y:Object,"function"==typeof(m=void 0!==R.U&&R.U)?m:Object])],T);var C=r(42058);function j(e){if(!e)return{};try{return(0,C.Y2)("string"==typeof e),JSON.parse(e)}catch(t){return{}}}function P(e,t){var r,o,n,i,s;return`${e}${null!==(r=null!==(o=null!==(n=null!==(i=null!==(s=t.web_icon)&&void 0!==s?s:t.hover_icon)&&void 0!==i?i:t.preview_cover)&&void 0!==n?n:t.track_thumbnail)&&void 0!==o?o:t.canvas_cover)&&void 0!==r?r:""}`}function O(e,t){const{common:r,extra:o}=function(e,t,r){var o,n,i;const s=j(t.Extra),a=j(t.SdkExtra),c=function(e,t){var r;return null!=e?e:`${function(e){if(!e)return"";const t=e.split("/");return t.pop(),t.join("/")}(null===(r=t.FileUrl.UrlList)||void 0===r?void 0:r[0])}/`}(r,t),l=t.ModelNames?JSON.parse(t.ModelNames):{},u=Object.values(l).reduce(((e,t)=>[...e,...t]),[]);return{common:{key:`${e}_${t.ResourceId.toString()}`,resourceId:t.ResourceId.toString(),effectId:t.EffectId.toString(),name:t.Name,isBusiness:null!==(o=s.is_business)&&void 0!==o&&o,isVip:null!==(n=s.is_vip)&&void 0!==n&&n,package:{uri:t.FileUrl.Uri,urlList:t.FileUrl.UrlList},icon:{uri:t.IconUrl.Uri,urlList:t.IconUrl.UrlList},sdkVersion:t.SdkVersion,requirements:t.Requirements,modelNames:u,previewUrl:null!==(i=P(c,s))&&void 0!==i?i:t.IconUrl.UrlList[0],source:t.Source,panel:t.Panel},extra:s,sdkExtra:a,urlPrefix:c}}(i._.Shape,e,t);return{...r,shapeType:o.type}}class M extends T{get resourceType(){return i._.Shape}parseEffectsToResources(e){return e.map((e=>O(e)))}}var I=r(24386);const x={name:"resource-request",key:"id",index:[{name:"createTime",unique:!1},{name:"updateTime",unique:!1}]},E="resource-request";const D=432e5;function A(e,t,r){const o=e.post;e.post=async function(...e){var n,i;const s=function(e,t=["appVersion","sdkVersion"]){return Object.keys(e).filter((e=>-1===t.indexOf(e))).sort(((e,t)=>e.localeCompare(t))).reduce(((t,r)=>""===t?`${r}_${e[r]}`:`${t}_${r}_${e[r]}`),"")}(null!==(n=e[1])&&void 0!==n?n:{}),a=r?`${r}_${s}`:s,c=0!==(null===(i=e[1])||void 0===i?void 0:i.sortingPosition);let l,u;if(!c){const e=await t.database.connect(E,x.name);if(e.ok){u=e.value;const t=await u.query(a);t.ok&&t.value&&(l=t.value)}}if(l)return o.apply(this,e).then((t=>{u&&t&&u.set(a,{id:a,request:e,response:t,maxAge:D})})),l.response;const d=await o.apply(this,e);return u&&d&&!c&&u.set(a,{id:a,request:e,response:d,maxAge:D}),d}}var B,U,N,F=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},L=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},W=function(e,t){return function(r,o){t(r,o,e)}};let $=class{get _networkClient(){return this._networkClientInstance||(this._networkClientInstance=function(){const e=(new a.yk).build(a.kk);return(0,c.i)(e),(0,u.V)(e),e}(),this.configurationService.disableRequestCache||A(this._networkClientInstance,this._storageService)),this._networkClientInstance}constructor(e,t,r){this.accountService=e,this.configurationService=t,this._storageService=r}async getResources(e){const t=e instanceof I.yt?e.config:e;try{const r=this.convertGetResourcesByCategoryToRequest(e),o=await this._doGetResources(r);if(!o.ok)return o;const n=this._convertGetResourcesByCategoryToQueryToken(t,o.value);return(0,d.oW)(n)}catch(r){return(0,d.wf)(-1,"getResourcesByCategory api error")}}async _doGetResources(e){var t,r;const o=await this._networkClient.post(this._api,e),n=null===(t=o.BaseResp)||void 0===t?void 0:t.StatusCode,i=null===(r=o.BaseResp)||void 0===r?void 0:r.StatusMessage;return 0!==n?(0,d.wf)(null!=n?n:-1,null!=i?i:"do getResources error"):(0,d.oW)(o)}convertGetResourcesByCategoryToRequest(e){var t,r;const o=e instanceof I.yt?e.config:e,n={panel:this.configurationService.resourcePanel[this.resourceType],appVersion:p,sdkVersion:v,lang:_.ZP.language,category:null!==(t=o.category)&&void 0!==t?t:"all",hasCategoryEffects:!1};if(this.configurationService.abTestManager){var i,s;const e=null===(i=(s=this.configurationService.abTestManager).getNewTransitionEffectEnabled)||void 0===i?void 0:i.call(s);n.cc_web_version=e?1:0}const a=this.buildCustomRequest(o),{limit:c,offset:l}=(0,I.ky)(e)?{...e.config.limit?{limit:e.config.limit}:void 0,offset:null!==(r=e.offset)&&void 0!==r?r:0}:{...this.defaultQueryToken,...e.limit?{limit:e.limit}:void 0};return{...n,...a,...c?{limit:c}:void 0,sortingPosition:l}}get defaultQueryToken(){return{offset:0}}buildCustomRequest(e){return{}}get _api(){return`${l._L.getVar("web_domain")}${f}`}_convertGetResourcesByCategoryToQueryToken(e,t){var r;const o=this.parseEffectsToResources(t.data.CategoryEffects.Effects,null===(r=t.data.UrlPrefix)||void 0===r?void 0:r[0]),{HasMore:n,SortingPosition:i}=t.data.CategoryEffects;return(0,I.ib)(e,{list:o},{hasMore:n,offset:i})}};$=F([W(0,s.Gw),W(1,b.Ui),W(2,R.U),L("design:paramtypes",["function"==typeof(B=void 0!==s.Gw&&s.Gw)?B:Object,"function"==typeof(U=void 0!==b.Ui&&b.Ui)?U:Object,"function"==typeof(N=void 0!==R.U&&R.U)?N:Object])],$);class G extends ${buildCustomRequest(e){return{enable_album:e.enableAlbum}}get resourceType(){return i._.Shape}parseEffectsToResources(e,t){return e.map((e=>O(e,t)))}}var V,K=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Y=function(e,t){return function(r,o){t(r,o,e)}};let q=class extends o.JT{constructor(e){super(),this._instantiationService=e,this._shapeRepository=this._instantiationService.createInstance(G),this._batchGetShapeRepository=this._instantiationService.createInstance(M)}getShape(e){return this._shapeRepository.getResources(e)}batchGetShapesByIds(e){return this._batchGetShapeRepository.batchGetResources(e)}};q=K([Y(0,n.T),H("design:paramtypes",["function"==typeof(V=void 0!==n.T&&n.T)?V:Object])],q)},23843:(e,t,r)=>{var o,n,i,s,a;r.d(t,{YB:()=>o,ov:()=>n}),function(e){e.Video="video",e.Image="image",e.Audio="audio",e.File="file"}(o||(o={})),function(e){e.EverCloud="everCloud",e.PublicSpace="publicSpace"}(n||(n={})),function(e){e["360p"]="360p",e["480p"]="480p",e["720p"]="720p",e["1080p"]="1080p",e["2400p"]="2400p"}(i||(i={})),function(e){e["360p"]="360p",e["480p"]="480p",e["720p"]="720p",e["1080p"]="1080p",e["2400p"]="2400p",e.origin="origin"}(s||(s={})),function(e){e["128kb"]="128kb"}(a||(a={}))},95983:(e,t,r)=>{r.d(t,{L:()=>o});class o{constructor(e){this.isDev=e.isDev,this.isProd=e.isProd,this.workspaceIdFromUrl=function(){const{searchParams:e}=new URL(window.location.href);return e.get("workspaceId")}(),this.spaceIdFromUrl=function(){const{searchParams:e}=new URL(window.location.href);return e.get("spaceId")}()}}},81666:(e,t,r)=>{r.d(t,{Y:()=>o});const o=(0,r(67126).yh)("environment")},63447:(e,t,r)=>{var o;r.d(t,{P:()=>o}),function(e){e[e.Eager=0]="Eager",e[e.Idle=1]="Idle"}(o||(o={}))},3936:(e,t,r)=>{r.d(t,{b:()=>d});var o,n,i=r(7647),s=r(80998),a=r(63447),c=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e,t){return function(r,o){t(r,o,e)}};let d=class{constructor(e,t){this._instances=new Map,this._pending=new Map,this._containerService=e,this._idleExecuteService=t,this._containerService.onReset((()=>this._reset()))}register(e,t){if(t.instantiationPhase===a.P.Eager&&this._safeCreate(t),t.instantiationPhase===a.P.Idle){const e=this._idleExecuteService.register({run:()=>{this._safeCreate(t),this._pending.delete(t.id)},priority:s.GA.MIDDLE});this._pending.set(t.id,e)}}_reset(){for(const[,e]of this._instances)e.dispose();for(const[,e]of this._pending)e.dispose()}_safeCreate(e){this._instances.has(e.id)||this._createInstance(e)}_createInstance(e){const t=this._containerService.createInstance(e.ctor);this._instances.set(e.id,t)}};d=c([u(0,i.t),u(1,s.hR),l("design:paramtypes",["function"==typeof(o=void 0!==i.t&&i.t)?o:Object,"function"==typeof(n=void 0!==s.hR&&s.hR)?n:Object])],d)},33594:(e,t,r)=>{r.d(t,{Q:()=>o});const o=(0,r(67126).yh)("extension")},15457:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(35545),n=r(42058),i=r(80998);globalThis.requestIdleCallback=globalThis.requestIdleCallback||function(e){const t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1)},globalThis.cancelIdleCallback=globalThis.cancelIdleCallback||function(e){clearTimeout(e)};class s extends o.JT{constructor(){super(),this._elements=[]}enqueue(e,t){this._elements.push({priority:t,value:e}),this._elements.sort(((e,t)=>e.priority-t.priority))}dequeue(e){if(e){var t;const r=this._elements.findIndex(e),o=this._elements.splice(r,1);return o.length?null===(t=o[0])||void 0===t?void 0:t.value:void 0}var r;return null===(r=this._elements.shift())||void 0===r?void 0:r.value}isEmpty(){return 0===this._elements.length}size(){return this._elements.length}dispose(){this._elements=[],super.dispose()}}class a extends o.JT{constructor(){super(),this._idleTaskPriorityQueue=new s,this._status=i.ws.idle,this._active=!1,(0,n.Y2)("function"==typeof r.g.requestIdleCallback,"This execute environment not support requestIdleCallback. Scheduler will auto destroyed.")}bootstrap(){this._active=!0,this._runIdleTask()}register(e){var t;const r={...e,priority:null!==(t=e.priority)&&void 0!==t?t:i.GA.LOW,id:Date.now()};return this._idleTaskPriorityQueue.enqueue(r,r.priority),this._active&&this._runIdleTask(),{dispose:()=>{this._removeOrStopTask(r)},updatePriority:e=>{r.priority=e}}}dispose(){this._runningTask&&(r.g.cancelIdleCallback(this._runningTask.id),this._runningTask=void 0),this._idleTaskPriorityQueue.dispose(),super.dispose()}_runIdleTask(){var e;if(this._status===i.ws.running||this._idleTaskPriorityQueue.isEmpty())return;const t=this._idleTaskPriorityQueue.dequeue(),o=r.g.requestIdleCallback((async e=>{try{t.run instanceof Promise?await t.run(e):t.run(e)}catch(r){throw r}finally{this._resetScheduler(),this._runIdleTask()}}),{timeout:null!==(e=t.timeout)&&void 0!==e?e:void 0});t.id=o,this._status=i.ws.running,this._runningTask=t}_removeOrStopTask(e){var t;(null===(t=this._runningTask)||void 0===t?void 0:t.id)===e.id?(r.g.cancelIdleCallback(e.id),this._resetScheduler(),this._runIdleTask()):this._idleTaskPriorityQueue.dequeue((t=>t.value.id===e.id))}_resetScheduler(){this._status=i.ws.idle,this._runningTask=void 0}}},80998:(e,t,r)=>{r.d(t,{GA:()=>o,hR:()=>s,ws:()=>n});var o,n,i=r(67126);!function(e){e[e.LOW=1]="LOW",e[e.MIDDLE=10]="MIDDLE",e[e.HIGH=100]="HIGH"}(o||(o={})),function(e){e[e.idle=1]="idle",e[e.running=2]="running"}(n||(n={}));const s=(0,i.yh)("idle")},86835:(e,t,r)=>{r.d(t,{in:()=>o,jd:()=>i,yR:()=>s});var o,n=r(67126);!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error"}(o||(o={}));const i=o.Info,s=(0,n.yh)("logger")},3260:(e,t,r)=>{r.d(t,{g:()=>g});var o=r(46862),n=r(71343),i=r(13659),s=r(86835),a=r(35545),c=r(77685);class l extends a.JT{constructor(e,t){super(),this._level=s.jd,this._onDidChangeLogLevel=this._register(new c.Q),this._label=e,this._loggerService=t,this.onDidChangeLogLevel=this._onDidChangeLogLevel.event}setLevel(e){this._level!==e&&(this._level=e,this._onDidChangeLogLevel.fire(this._level))}getLevel(){return this._level}dispose(){this._loggerService.destroy(this._label),super.dispose()}_checkLogLevel(e){return this._level<=e}}const u={timeZone:"Asia/Shanghai"};class d extends l{constructor(e,t,r="",o={}){var n,i,a,c;super(r,t),this._slardarAdapterService=e,this.setLevel(null!==(n=o.logLevel)&&void 0!==n?n:s.jd),this._contextParams=null!==(i=o.contextParams)&&void 0!==i?i:{},this._timePrefix=null===(a=o.timePrefix)||void 0===a||a,this._logPrefix=null!==(c=o.logPrefix)&&void 0!==c?c:""}debug(e,...t){if(!this._checkLogLevel(s.in.Debug))return;const r=(0,n.g)(e,...t);this._slardarAdapterService.sendLog(o.T.DEBUG,this._addPrefix(r),this._contextParams)}info(e,...t){if(!this._checkLogLevel(s.in.Info))return;const r=(0,n.g)(e,...t);this._slardarAdapterService.sendLog(o.T.INFO,this._addPrefix(r),this._contextParams)}warn(e,...t){if(!this._checkLogLevel(s.in.Warning))return;const r=this._transformErrorMessage(e,...t);this._slardarAdapterService.sendLog(o.T.WARN,this._addPrefix(r),this._contextParams)}error(e,...t){if(!this._checkLogLevel(s.in.Error))return;const r=this._transformErrorMessage(e,...t);this._slardarAdapterService.sendLog(o.T.ERROR,this._addPrefix(r),this._contextParams)}_addPrefix(e){return`${this._label?`[${this._label}]`:""}${this._timePrefix?`[${(new Date).toLocaleString("en-US",u)}]${this._logPrefix?` [${this._logPrefix}]`:""}`:""}${e}`}_transformErrorMessage(e,...t){let r="";return r=e instanceof Error?e.message:(0,i.oi)(e)?e.toString():(0,n.g)(e,...t),r}}var f,h=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e,t){return function(r,o){t(r,o,e)}};let g=class{constructor(e){this._slardarAdapterService=e,this._loggers=new Map}createLogger(e,t={}){if(this._loggers.has(e))return this._loggers.get(e);const r=new d(this._slardarAdapterService,this,e,t);return this._loggers.set(e,r),r}getLogger(e){return this._loggers.get(e)}destroy(e){return this._loggers.delete(e)}};g=h([v(0,o.L),p("design:paramtypes",["function"==typeof(f=void 0!==o.L&&o.L)?f:Object])],g)},50155:(e,t,r)=>{r.d(t,{r:()=>h});var o=r(46862),n=r(28628),i=r(42058);class s{constructor(e,t){this._contextParams=e,this._reportService=t}reportBusinessEvent(e,t={},r={}){const o={...this._contextParams,...t};this._reportService.reportBusinessEvent(e,o,r)}reportBusinessExitEvent(e,t={},r={}){const o={...this._contextParams,...t};this._reportService.reportBusinessExitEvent(e,o,r)}reportDevEvent(e,t={}){const r={...this._contextParams,...t};this._reportService.reportDevEvent(e,r)}reportDevError(e,t,r={}){const o={};Object.entries(this._contextParams).forEach((([e,t])=>{o[e]=String(t)})),Object.entries(r).forEach((([e,t])=>{o[e]=t})),this._reportService.reportDevError(e,t,o)}}class a extends s{constructor(e,t,r){super(e,t),this._filter=r}reportBusinessEvent(e,t={},r={}){this._filter(t)&&super.reportBusinessEvent(e,t,r)}reportBusinessExitEvent(e,t={},r={}){this._filter(t)&&super.reportBusinessExitEvent(e,t,r)}reportDevEvent(e,t={}){this._filter(t)&&super.reportDevEvent(e,t)}reportDevError(e,t,r={}){super.reportDevError(e,t,r)}}var c,l,u=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e,t){return function(r,o){t(r,o,e)}};let h=class{constructor(e,t,r){this._requestStub=e,this._teaAdapterService=t,this._slardarAdapterService=r,this._reporters=new Map}reportBusinessEvent(e,t={},r={}){const{immediately:o=!1,important:n=!0}=r;n?this._teaAdapterService.ensureTrack(e,t,o):this._teaAdapterService.track(e,t,o),r.syncServer&&((0,i.ZB)(this._requestStub),this._requestStub(e,t,this._teaAdapterService.getTeaConfig()))}reportBusinessExitEvent(e,t={},r={}){this.reportBusinessEvent(e,t,{...r,immediately:!0})}reportDevEvent(e,t={}){this._slardarAdapterService.sendEvent(e,function(e){const t={};return Object.entries(e).forEach((([e,r])=>{"number"!=typeof r&&"string"!=typeof r||(t[e]=r)})),t}(t))}reportDevError(e,t,r={}){this._slardarAdapterService.captureException(e,t,r)}createReporter(e,t){(0,i.Y2)(!this._reporters.has(e),"reporter existed.");const r=new s(t,this);return this._reporters.set(e,r),r}createSamplingReporter(e,t,r={}){const o=new a(r,this,t);return this._reporters.set(e,o),o}getReporter(e){return(0,i.Y2)(this._reporters.has(e),"reporter not existed."),this._reporters.get(e)}};h=u([f(1,n.w),f(2,o.L),d("design:paramtypes",[Object,"function"==typeof(c=void 0!==n.w&&n.w)?c:Object,"function"==typeof(l=void 0!==o.L&&o.L)?l:Object])],h)},96354:(e,t,r)=>{r.d(t,{m:()=>o});const o=(0,r(67126).yh)("report")},45319:(e,t,r)=>{r.d(t,{V:()=>I});var o=r(74504),n=r(2897),i=r(42058),s=r(82552),a=r(77685),c=r(93361),l=r(13659),u=r(19111),d=r(26957);const f={name:"resource",key:"id",index:[{name:"updateTime",unique:!1}]},h="resource";var p,v=r(28620),g=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(e,t){return function(r,o){t(r,o,e)}};let _=class{constructor(e,t,r,o,n,i){this._config=e,this._resourceId=t,this._url=r,this._networkClient=o,this._downloadService=n,this._storageService=i,this._status=d.lh.Waiting,this._onSuccess=new a.Q,this._onFail=new a.Q,this._cancellationTokenSource=new c.A,this.onSuccess=this._onSuccess.event,this.onFail=this._onFail.event}get id(){return this._resourceId}get status(){return this._status}get value(){return this._value}get sourceFrom(){return this._sourceFrom}get error(){return this._error}get downloadType(){return this._downloadType}set downloadType(e){this._config.downloadType=e}async fetch(){this._status=d.lh.Loading,this._clearCacheIfExist&&await this._deleteResourceCacheIfExist(),this._databaseFirst&&await this._fetchByStorage(),this._status===d.lh.Loading&&(this._url.startsWith("blob:")?await this._fetchByBlobUrl():await this._fetchByNetwork())}cancel(){this._downloadService.remove(this),this._cancellationTokenSource.cancel(),this._fireFail((0,l.wf)(-1,"download task canceled."))}startImmediately(){this._downloadService.startImmediately(this)}equal(e){return this._resourceId===e._resourceId&&this._url===e._url&&(0,u.v)(this._config,e._config)}get _downloadType(){var e;return null!==(e=this._config.downloadType)&&void 0!==e?e:d._5.Idle}get _cacheInDatabase(){var e;return null===(e=this._config.cacheInDatabase)||void 0===e||e}get _databaseFirst(){var e;return null===(e=this._config.databaseFirst)||void 0===e||e}get _clearCacheIfExist(){var e;return null!==(e=this._config.clearCacheIfExist)&&void 0!==e&&e}get _headers(){return this._config.headers}async _deleteResourceCacheIfExist(){const e=await this._storageService.database.connect(h,f.name);if(!e.ok)return!1;const t=e.value,[r]=(await t.delete(this._resourceId)).pair();return!(r&&!r.ok)}async _fetchByStorage(){const e=await this._storageService.database.connect(h,f.name);if(!e.ok)return;const t=e.value,[r,o]=(await t.query(this._resourceId)).pair();r&&!r.ok||!o||this._fireSuccess(o,d.Gu.Cache)}async _fetchByNetwork(){try{var e;const t=await this._networkClient.request({method:"GET",url:this._url,headers:this._headers}),r=t.data,o=null!==(e=t.headers["content-type"])&&void 0!==e?e:"";this._fireSuccess({id:this._resourceId,buffer:r,contentType:o},d.Gu.Online),this._cacheInDatabase&&this._cache(r,o)}catch(t){this._fireFail((0,l.Mx)(-1,"download error.",t))}}async _fetchByBlobUrl(){try{var e;const t=await fetch(this._url),r=await t.arrayBuffer(),o=null!==(e=t.headers.get("content-type"))&&void 0!==e?e:"";this._fireSuccess({id:this._resourceId,buffer:r,contentType:o},d.Gu.Memory)}catch(t){this._fireFail((0,l.Mx)(-1,"download error.",t))}}_fireSuccess(e,t){this._cancellationTokenSource.token.isCancellationRequested||((0,i.Y2)(this._status===d.lh.Loading),this._status=d.lh.Completed,this._value=e,this._sourceFrom=t,this._onSuccess.fire())}_fireFail(e){this._status!==d.lh.Error&&(this._status=d.lh.Error,this._error=e,this._onFail.fire(this._error))}async _cache(e,t){const r=await this._storageService.database.connect("resource","resource");if(!r.ok)return;r.value.set(this._resourceId,{id:this._resourceId,buffer:e,contentType:t})}};_=g([m(5,v.U),y("design:paramtypes",[Object,String,String,Object,Object,"function"==typeof(p=void 0!==v.U&&v.U)?p:Object])],_);var b,R=r(80998),w=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k=function(e,t){return function(r,o){t(r,o,e)}};let T=class{constructor(e){this._idleExecuteService=e,this._waitingTasks=new Map}addTask(e){(0,i.Y2)(e.downloadType===d._5.Idle),(0,i.Y2)(!this._waitingTasks.has(e),"duplicate task.");const t=this._idleExecuteService.register({run:()=>e.fetch().finally((()=>{this._waitingTasks.delete(e)}))});this._waitingTasks.set(e,t)}removeTask(e){this._waitingTasks.has(e)&&(this._waitingTasks.get(e).dispose(),this._waitingTasks.delete(e))}};T=w([k(0,R.hR),S("design:paramtypes",["function"==typeof(b=void 0!==R.hR&&R.hR)?b:Object])],T);class C{constructor(e){this._concurrency=e,this._activeTasks=new Set,this._waitingTasks=[],this._tasks=new Set,(0,i.Y2)(this._concurrency>0)}addTask(e){(0,i.Y2)(e.downloadType===d._5.Eager),(0,i.Y2)(!this._tasks.has(e),"duplicate task."),this._waitingTasks.push(e),this._tasks.add(e),this._tryStart()}removeTask(e){const t=this._waitingTasks.indexOf(e);t>=0&&this._waitingTasks.splice(t,1),this._tasks.delete(e)}_tryStart(){this._next()}_next(){if(this._activeTasks.size===this._concurrency)return;const e=this._waitingTasks.splice(0,1)[0];e&&this._executeTask(e)}_executeTask(e){this._activeTasks.add(e),e.fetch().finally((()=>{this._activeTasks.delete(e),this._tasks.delete(e),this._next()}))}}var j,P=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},M=function(e,t){return function(r,o){t(r,o,e)}};let I=class{constructor(e){this._instantiationService=e,this._tasks=new Set,this._networkClient=(0,o.eI)({responseType:"arraybuffer"}),this._idleQueue=this._instantiationService.createInstance(new n.M(T,[])),this._immediatelyQueue=this._instantiationService.createInstance(new n.M(C,[5]))}download(e,t,r={}){const o=this._getOrCreateTask(e,t,r);return this._recordTask(o),o.downloadType===d._5.Eager?this._immediatelyQueue.addTask(o):this._idleQueue.addTask(o),o}remove(e){e.downloadType===d._5.Eager?this._immediatelyQueue.removeTask(e):this._idleQueue.removeTask(e)}startImmediately(e){e.status>=d.lh.Loading||e.downloadType===d._5.Eager||(this._idleQueue.removeTask(e),e.downloadType=d._5.Eager,this._immediatelyQueue.addTask(e))}_recordTask(e){this._tasks.add(e),e.onFail((()=>{this._tasks.delete(e)})),e.onSuccess((()=>{this._tasks.delete(e)}))}_getOrCreateTask(e,t,r={}){const o=this._instantiationService.createInstance(new n.M(_,[r,e,t,this._networkClient,this]));for(const n of this._tasks)if((0,i.Y2)(n.status!==d.lh.Completed&&n.status!==d.lh.Error),n.equal(o))return n;return o}};I=P([M(0,s.T),O("design:paramtypes",["function"==typeof(j=void 0!==s.T&&s.T)?j:Object])],I)},26957:(e,t,r)=>{r.d(t,{Gu:()=>i,_5:()=>n,lh:()=>o,tx:()=>a});var o,n,i,s=r(67126);!function(e){e[e.Waiting=0]="Waiting",e[e.Loading=1]="Loading",e[e.Completed=2]="Completed",e[e.Error=3]="Error"}(o||(o={})),function(e){e[e.Eager=0]="Eager",e[e.Idle=1]="Idle"}(n||(n={})),function(e){e[e.Memory=0]="Memory",e[e.Cache=1]="Cache",e[e.Online=2]="Online"}(i||(i={}));const a=(0,s.yh)("resource-download")},53945:(e,t,r)=>{r.d(t,{R:()=>u});var o,n=r(26957),i=r(60278),s=r(55018),a=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t){return function(r,o){t(r,o,e)}};let u=class extends i.B{constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),(()=>this._contentResourceToken),(e=>this._contentResourceToken=e))}_createContentToken(e){const t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,s.tT)({key:t,url:r},this._downloadService,this.contentFileFilter)}_getContentResourceKey(){return`${this.key}_content`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._contentResourceToken=this._createContentToken(e)}};u=a([l(2,n.tx),c("design:paramtypes",[Object,void 0,"function"==typeof(o=void 0!==n.tx&&n.tx)?o:Object])],u)},60278:(e,t,r)=>{r.d(t,{B:()=>u});var o,n=r(26957),i=r(53887),s=r(55018),a=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t){return function(r,o){t(r,o,e)}};let u=class extends i.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}getCoverResourceToken(){return this._getResourceTokenSync(this._createCoverToken.bind(this),(()=>this._coverResourceToken),(e=>this._coverResourceToken=e))}_createCoverToken(e){const t=this._getCoverResourceKey(),r=this.getCover(e);return(0,s.MZ)({key:t,url:r},this._downloadService)}_getCoverResourceKey(){return`${this.key}_cover`}doGenerateResourceTokens(e){this._coverResourceToken=this._createCoverToken(e)}};u=a([l(2,n.tx),c("design:paramtypes",[Object,void 0,"function"==typeof(o=void 0!==n.tx&&n.tx)?o:Object])],u)},47849:(e,t,r)=>{r.d(t,{e:()=>c});var o,n=r(82552),i=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(e,t){return function(r,o){t(r,o,e)}};let c=class{constructor(e){this._instantiationService=e,this._cache=new Map}add(e,t){if(this._cache.has(e))return;const r=this.createResource(e,t);this._cache.set(e,r)}get(e){if(!this._cache.has(e))return;return this._cache.get(e)}};c=i([a(0,n.T),s("design:paramtypes",["function"==typeof(o=void 0!==n.T&&n.T)?o:Object])],c)},53887:(e,t,r)=>{r.d(t,{i:()=>u});var o=r(81358),n=r(77685),i=r(98720),s=r(42058),a=r(13659),c=r(1467),l=r(31702);class u{constructor(e,t){this.key=e,this.status=o.n.init,this._resourceReadyEmitter=new n.Q,this._resourceErrorEmitter=new n.Q,this._onResourceTokenReadyDefer=(0,i.PQ)(),this.value=t,(0,c.R)(t)?Promise.resolve().then((()=>this._doResourceReady(this.value))):Promise.resolve().then((()=>this._tryCompleteResource()))}onReady(e){if(this.status!==o.n.complete)return this._resourceReadyEmitter.event(e);let t=!1;return setTimeout((()=>{t||((0,s.Y2)((0,c.R)(this.value)),e(this.value))})),{dispose:()=>{t=!0}}}onError(e){if(this.status!==o.n.complete)return this._resourceErrorEmitter.event(e);let t=!1;return setTimeout((()=>{t||this.status===o.n.error&&((0,s.Y2)(this.error),e(this.error))})),{dispose:()=>{t=!0}}}restart(){(0,s.Y2)(this.status===o.n.error),this._tryCompleteResource()}async _tryCompleteResource(){const e=await this._fetchResourceDetail();e.ok?this._onHandleResourceReady(e.value):this._onHandleResourceError(e.cause)}_getResourceTokenSync(e,t,r){const o=t();return o||new l.R((()=>new Promise((t=>{const o=this.onReady((o=>{const n=e(o);r(n),t(n)}));this.onError((()=>o.dispose()))}))))}async _getResourceTokenAsync(e){let t=e();return t||(await this._onResourceTokenReadyDefer.promise,t=e(),(0,s.Y2)(t,"token is not available. should create token in doGenerateResourceTokens()"),t)}_onHandleResourceReady(e){this.value=Object.assign(this.value,e),(0,c.K)(this.value),this._doResourceReady(e)}_doResourceReady(e){this.status=o.n.complete,this._resourceReadyEmitter.fire(e),this.doGenerateResourceTokens(e),this._onResourceTokenReadyDefer.resolve(e)}_onHandleResourceError(e){this.status=o.n.error,this._resourceErrorEmitter.fire(e)}async _fetchResourceDetail(){(0,s.Y2)(this.status===o.n.init||this.status===o.n.error);try{this.status=o.n.fetching;const e=await this.doFetch();return(0,a.oW)(e)}catch(e){return this.status=o.n.error,(0,a.Mx)(-1,"fetch resource detail fail.",e)}}}},55018:(e,t,r)=>{r.d(t,{tT:()=>S,rW:()=>T,Dy:()=>k,MZ:()=>w});var o=r(42058),n=r(13659),i=r(77685),s=r(49423);class a{constructor(){this._isTokenDisposed=!1,this.status=s.G.init,this._errorEmitter=new i.Q,this._readyEmitter=new i.Q}onError(e){if(this.status!==s.G.complete)return this._errorEmitter.event(e);let t=!1;return setTimeout((()=>{t||this.status===s.G.error&&((0,o.Y2)(this.error),e(this.error))})),{dispose:()=>{t=!0}}}onReady(e){if(this.status!==s.G.complete)return this._readyEmitter.event(e);let t=!1;return setTimeout((()=>{t||e(this.value)})),{dispose:()=>{t=!0}}}async start(e=!1){if(-1!==[s.G.init,s.G.error].indexOf(this.status))try{this.status=s.G.fetching;const t=await this.loadResource(e);if(this.status=s.G.complete,this._isTokenDisposed)return;this._readyEmitter.fire(t)}catch(t){if(this.status=s.G.error,this._isTokenDisposed)return;this._errorEmitter.fire(t)}}startImmediately(){return this.start(!0)}cancel(){this._isTokenDisposed=!0}}var c=r(81358),l=r(66465);const u=(e,t)=>{const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r};async function d(e,t,r){const o=Buffer.from(r,"hex"),n=await crypto.subtle.importKey("raw",o,{name:"AES-GCM"},!1,["decrypt"]),i=e.slice(0,12),s=e.slice(12,t);return await crypto.subtle.decrypt({name:"AES-GCM",iv:i},n,s)}var f=r(59470),h=r(26957);class p extends a{constructor(e,t,r){super(),this._metadata=e,this._downloadService=t,this.config=r,this.value={...this._metadata}}async startImmediately(){this.status!==s.G.complete&&this.status!==s.G.fetching&&(this.status!==s.G.init&&this.status!==s.G.error||await this.start(!0))}cancel(){super.cancel(),(0,o.ZB)(this._downloadTask),this._downloadTask.cancel()}async loadResource(e){try{return await this._doLoadPersistentResource({downloadType:e?h._5.Eager:h._5.Idle})}catch(t){if((0,n.oi)(t)&&1e3===t.code)return await this._loadResourceWithoutCache(e);throw t}}_loadResourceWithoutCache(e){return this._doLoadPersistentResource({downloadType:e?h._5.Eager:h._5.Idle,clearCacheIfExist:!0,databaseFirst:!1})}_doLoadPersistentResource(e){return new Promise(((t,r)=>{const i=this._downloadService.download(this._metadata.key,this._metadata.url,{...this.config,...e});this._downloadTask=i,i.onSuccess((async()=>{(0,o.ZB)(i.value);try{await this.doParseArrayBuffer(i.value),t(this.value)}catch(e){r((0,n.Mx)(1e3,"parse arraybuffer error",e))}})),i.onFail((e=>{r(e)}))}))}async doParseArrayBuffer(e){let{buffer:t}=e;t=await this.decryptResourceIfNeeded(t),this.value.buffer=t,this.value.contentType=e.contentType}async decryptResourceIfNeeded(e){if((0,c.d)(this._metadata)&&this._metadata.shouldAutoDecrypt){if(this._metadata.encryptType===f.PS.AES_CBC){const t=await async function(e,t){const r=l.Buffer.from(t,"base64"),o=await window.crypto.subtle.importKey("raw",r,{name:"AES-CBC",length:256},!1,["decrypt"]),n=e.slice(0,16),i=e.slice(16);return crypto.subtle.decrypt({name:"AES-CBC",iv:n,length:256},o,i)}(e,this._metadata.decryptKey);return t}if(this._metadata.encryptType===f.PS.AES_GCM){return await(async(e,t)=>{const r=e.byteLength,o=new Uint8Array(e.slice(0,256)),n=Number(new DataView(o.buffer).getBigInt64(24,!0));if(r<256||n<=0)throw new Error("buf size invalid");const i=n+28,s=new Uint8Array(i);let a=new Uint8Array,c=256;for(;c<r;){const o=Math.min(i,r-c);s.set(new Uint8Array(e.slice(c,c+o)));const n=await d(s,o,t);a=u(a,new Uint8Array(n)),c+=o}return a.buffer})(e,this._metadata.decryptKey)}}return e}}var v=r(17597);const g=["application/zip","application/x-7z-compressed","application/gzip","application/x-tar"];async function y(e,t){if(g.includes(t)){const t={},{entries:r}=await(0,v.Ri)(e);for(const[e,o]of Object.entries(r)){if(o.isDirectory||e.startsWith("__MACOSX")||e.includes(".DS_Store"))continue;const r=await o.arrayBuffer();t[e.replaceAll("//","/")]={isDirectory:o.isDirectory,size:o.size,name:o.name,arrayBuffer:r}}return Promise.resolve(t)}return Promise.resolve(e)}class m extends p{constructor(e,t,r){super(e,t),this._contentFileFilter=r}async doParseArrayBuffer(e){super.doParseArrayBuffer(e);const t=await y(e.buffer,e.contentType);(0,o.Y2)(!(t instanceof ArrayBuffer));const r=Object.keys(t).find((e=>this._contentFileFilter(e)));(0,o.Y2)(r),Object.defineProperty(this.value,"content",{get:()=>new TextDecoder("utf-8").decode(t[r].arrayBuffer),enumerable:!0})}}class _ extends p{doParseArrayBuffer(e){return super.doParseArrayBuffer(e),Object.defineProperty(this.value,"files",{value:async()=>{const t=await y(e.buffer,e.contentType);return(0,o.Y2)(!(t instanceof ArrayBuffer)),t},enumerable:!0}),Promise.resolve()}}class b extends p{async doParseArrayBuffer(e){return await super.doParseArrayBuffer(e),Object.defineProperty(this.value,"file",{value:()=>e.buffer,enumerable:!0}),Promise.resolve()}}const R=new Map;function w(e,t,r){if(R.has(e.key))return R.get(e.key);const o=new p(e,t,r);return R.set(e.key,o),o}function S(e,t,r){if(R.has(e.key))return R.get(e.key);const o=new m(e,t,r);return R.set(e.key,o),o}function k(e,t){if(R.has(e.key))return R.get(e.key);const r=new _(e,t);return R.set(e.key,r),r}function T(e,t,r){if(R.has(e.key))return R.get(e.key);const o=new b(e,t,r);return R.set(e.key,o),o}},31702:(e,t,r)=>{r.d(t,{R:()=>s});var o=r(98720),n=r(42058),i=r(49423);class s{constructor(e){this._resourceTokenBuilder=e,this._onTargetReadyDefer=(0,o.PQ)(),this._doCreateResourceToken()}get status(){return this._targetValue?i.G.complete:i.G.init}get value(){var e;return null!==(e=this._targetValue)&&void 0!==e?e:void 0}onReady(e){if(this._targetToken)return this._targetToken.onReady(e);let t=!1;return setTimeout((async()=>{await this._onTargetReadyDefer.promise,t||((0,n.Y2)(this._targetToken),this._targetToken.onReady(e))})),{dispose:()=>{t=!0}}}onError(e){if(this._targetToken)return this._targetToken.onError(e);let t=!1;return setTimeout((async()=>{await this._onTargetReadyDefer.promise,t||((0,n.Y2)(this._targetToken),this._targetToken.onError(e))})),{dispose:()=>{t=!0}}}start(){if(this._targetToken)return this._targetToken.start();this._doTargetStart()}startImmediately(){return this._targetToken?this._targetToken.startImmediately():this._doTargetStartImmediately()}cancel(){if(this._targetToken)return this._targetToken.cancel();this._doTargetCancel()}async _doTargetStart(){await this._onTargetReadyDefer.promise,(0,n.Y2)(this._targetToken),this._targetToken.start()}async _doTargetStartImmediately(){await this._onTargetReadyDefer.promise,(0,n.Y2)(this._targetToken),this._targetToken.startImmediately()}async _doTargetCancel(){await this._onTargetReadyDefer.promise,(0,n.Y2)(this._targetToken),this._targetToken.cancel()}async _doCreateResourceToken(){this._targetToken=await this._resourceTokenBuilder(),this._targetValue=this._targetToken.value,this._onTargetReadyDefer.resolve(this._targetToken)}}},49423:(e,t,r)=>{var o;r.d(t,{G:()=>o}),function(e){e.init="init",e.fetching="fetching",e.complete="complete",e.error="error"}(o||(o={}))},81358:(e,t,r)=>{function o(e){return void 0!==e.decryptKey}var n;r.d(t,{d:()=>o,n:()=>n}),function(e){e.init="init",e.fetching="fetching",e.complete="complete",e.error="error"}(n||(n={}))},81551:(e,t,r)=>{r.d(t,{c:()=>o});const o=(0,r(67126).yh)("resource-service")},63048:(e,t,r)=>{r.d(t,{z:()=>Dc});var o=r(42058),n=r(2897),i=r(82552),s=r(31594),a=r(47849),c=r(67126);const l=(0,c.yh)("video-data-service");var u,d,f=r(26957),h=r(55018),p=r(1467),v=r(60278),g=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(e,t){return function(r,o){t(r,o,e)}};let _=class extends v.B{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoDataService=o}getCover(e){return e.coverUrl}getVideoResourceToken(){return this._getResourceTokenSync(this._createVideoResourceToken.bind(this),(()=>this._videoResourceToken),(e=>this._videoResourceToken=e))}getThumbResourceTokens(){return this._getResourceTokenAsync((()=>this._thumbResourceTokens))}getVideoResolutionInfo(){(0,o.Y2)((0,p.R)(this.value));const e=["480p","360p","540p","720p","1080p"];for(const r of e){const{url:e}=this.value.transcode[r];if(e)return{url:e,resolution:r}}const{url:t}=this.value.originVideo;return{url:t,resolution:"origin"}}_createVideoResourceToken(e){(0,o.Y2)((0,p.R)(this.value));const{url:t,resolution:r}=this.getVideoResolutionInfo(),n=this._getResolutionResourceKey(r);return this._videoResourceToken=(0,h.MZ)({key:n,url:t},this._downloadService),this._videoResourceToken}_createVideoThumbTokens(e){return this._thumbResourceTokens=e.thumb.details.map((t=>{const r=this._getThumbResourceKey(t.url),{singleFrameWidth:o,singleFrameHeight:n}=e.thumb.common,i={frameCount:t.frameCount,singleFrameWidth:o,singleFrameHeight:n,imageWidth:t.imageWidth,imageHeight:t.imageHeight};return(0,h.MZ)({key:r,url:t.url,...i},this._downloadService)})),this._thumbResourceTokens}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getThumbResourceKey(e){return`${this.key}_thumb_${e}`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createVideoResourceToken(e),this._createVideoThumbTokens(e)}async doFetch(){const[e,t]=(await this._videoDataService.getVideos({})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.value.list[0]}}};_=g([m(2,f.tx),m(3,l),y("design:paramtypes",[Object,Object,"function"==typeof(u=void 0!==f.tx&&f.tx)?u:Object,"function"==typeof(d=void 0!==l&&l)?d:Object])],_);var b,R=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(e,t){return function(r,o){t(r,o,e)}};let k=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(_,[e,t]))}};k=R([S(0,i.T),w("design:paramtypes",["function"==typeof(b=void 0!==i.T&&i.T)?b:Object])],k);var T=r(35188);const C=(0,c.yh)("audio-data-service");var j,P,O=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},M=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},I=function(e,t){return function(r,o){t(r,o,e)}};let x=class extends v.B{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._audioDataService=o}getCover(e){return e.coverUrl}getAudioResourceToken(){return this._getResourceTokenSync(this._createAudioResourceToken.bind(this),(()=>this._audioResourceToken),(e=>this._audioResourceToken=e))}_createAudioResourceToken(e){const{originUrl:t}=e,r=this._getAudioResourceKey();return(0,h.MZ)({key:r,url:t},this._downloadService)}_getAudioResourceKey(){return`${this.key}_audio_${this.value.resourceId}`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createAudioResourceToken(e)}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const{audioType:e}=this.value,[t,r]=(await this._audioDataService.batchGetAudios({resourceIds:[this.value.resourceId],audioResourceType:e})).pair();if(t)throw new Error(`doFetch error ${t.code}`);return{type:this.value.type,...r.list[0]}}};x=O([I(2,f.tx),I(3,C),M("design:paramtypes",[Object,Object,"function"==typeof(j=void 0!==f.tx&&f.tx)?j:Object,"function"==typeof(P=void 0!==C&&C)?P:Object])],x);var E,D=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},B=function(e,t){return function(r,o){t(r,o,e)}};let U=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(x,[e,t]))}};U=D([B(0,i.T),A("design:paramtypes",["function"==typeof(E=void 0!==i.T&&i.T)?E:Object])],U);const N=(0,c.yh)("photo-data-service");var F,L,W=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},G=function(e,t){return function(r,o){t(r,o,e)}};let V=class extends v.B{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._photoDataService=o}getCover(e){return e.coverUrl}getAllTranscodeResourceTokens(){return this._getResourceTokenAsync((()=>this._transcodeResourceTokens))}_createPhotoTranscodeTokens(e){return(0,o.Y2)(!this._transcodeResourceTokens),this._transcodeResourceTokens=e.transcode.reduce(((e,t)=>{const r=this._getResolutionResourceKey(t),{url:o}=t;return e[r]=(0,h.MZ)({key:r,url:o},this._downloadService),e}),{}),this._transcodeResourceTokens}_getResolutionResourceKey(e){return`${this.key}_resolution_${e.width}_${e.height}`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createPhotoTranscodeTokens(e)}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._photoDataService.batchGetPhotos({resourceIds:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};V=W([G(2,f.tx),G(3,N),$("design:paramtypes",[Object,Object,"function"==typeof(F=void 0!==f.tx&&f.tx)?F:Object,"function"==typeof(L=void 0!==N&&N)?L:Object])],V);var K,H=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},q=function(e,t){return function(r,o){t(r,o,e)}};let z=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(V,[e,t]))}};z=H([q(0,i.T),Y("design:paramtypes",["function"==typeof(K=void 0!==i.T&&i.T)?K:Object])],z);const Z=(0,c.yh)("curve-preset-data-service");var Q,J,X,ee=r(53945),te=r(69412),re=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ne=function(e,t){return function(r,o){t(r,o,e)}};let ie=class extends ee.R{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._curvePresetDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._curvePresetDataService.batchGetCurvePresetsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};ie=re([ne(2,f.tx),ne(3,Z),ne(4,te.Ui),oe("design:paramtypes",[Object,Object,"function"==typeof(Q=void 0!==f.tx&&f.tx)?Q:Object,"function"==typeof(J=void 0!==Z&&Z)?J:Object,"function"==typeof(X=void 0!==te.Ui&&te.Ui)?X:Object])],ie);var se,ae=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},le=function(e,t){return function(r,o){t(r,o,e)}};let ue=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(ie,[e,t]))}};ue=ae([le(0,i.T),ce("design:paramtypes",["function"==typeof(se=void 0!==i.T&&i.T)?se:Object])],ue);var de,fe=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},pe=function(e,t){return function(r,o){t(r,o,e)}};let ve=class extends v.B{constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),(()=>this._contentResourceToken),(e=>this._contentResourceToken=e))}_createContentToken(e){const t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,h.Dy)({key:t,url:r},this._downloadService)}_getContentResourceKey(){return`${this.key}_content`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._contentResourceToken=this._createContentToken(e)}};ve=fe([pe(2,f.tx),he("design:paramtypes",[Object,void 0,"function"==typeof(de=void 0!==f.tx&&f.tx)?de:Object])],ve);const ge=(0,c.yh)("integration-data-service");var ye,me,_e,be=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},we=function(e,t){return function(r,o){t(r,o,e)}};let Se=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._integrationDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._integrationDataService.batchGetIntegrationsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Se=be([we(2,f.tx),we(3,ge),we(4,te.Ui),Re("design:paramtypes",[Object,Object,"function"==typeof(ye=void 0!==f.tx&&f.tx)?ye:Object,"function"==typeof(me=void 0!==ge&&ge)?me:Object,"function"==typeof(_e=void 0!==te.Ui&&te.Ui)?_e:Object])],Se);var ke,Te=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},je=function(e,t){return function(r,o){t(r,o,e)}};let Pe=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Se,[e,t]))}};Pe=Te([je(0,i.T),Ce("design:paramtypes",["function"==typeof(ke=void 0!==i.T&&i.T)?ke:Object])],Pe);const Oe=(0,c.yh)("mask-data-service");var Me,Ie=r(53887),xe=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},De=function(e,t){return function(r,o){t(r,o,e)}};let Ae=class extends Ie.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),(()=>this._contentResourceToken),(e=>this._contentResourceToken=e))}_createContentToken(e){const t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,h.Dy)({key:t,url:r},this._downloadService)}_getContentResourceKey(){return`${this.key}_content`}doGenerateResourceTokens(e){this._contentResourceToken=this._createContentToken(e)}};Ae=xe([De(2,f.tx),Ee("design:paramtypes",[Object,void 0,"function"==typeof(Me=void 0!==f.tx&&f.tx)?Me:Object])],Ae);var Be,Ue,Ne,Fe=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},We=function(e,t){return function(r,o){t(r,o,e)}};let $e=class extends Ae{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._maskDataService=o,this._configurationService=n}getLightCoverResourceToken(){return this._getResourceTokenSync(this._createLightCoverToken.bind(this),(()=>this._lightCoverResourceToken),(e=>this._lightCoverResourceToken=e))}getDarkCoverResourceToken(){return this._getResourceTokenSync(this._createDarkCoverToken.bind(this),(()=>this._darkCoverResourceToken),(e=>this._darkCoverResourceToken=e))}_createDarkCoverToken(e){const t=this._getDarkCoverResourceKey(),r=e.themeIcon.dark.urlList[0];return(0,h.MZ)({key:t,url:r},this._downloadService)}_createLightCoverToken(e){const t=this._getLightCoverResourceKey(),r=e.themeIcon.light.urlList[0];return(0,h.MZ)({key:t,url:r},this._downloadService)}_getCoverResourceKey(){return`${this.key}_cover`}_getLightCoverResourceKey(){return`${this._getCoverResourceKey()}_light`}_getDarkCoverResourceKey(){return`${this._getCoverResourceKey()}_dark`}getContentUrl(e){return e.package.urlList[0]}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._darkCoverResourceToken=this._createDarkCoverToken(e),this._lightCoverResourceToken=this._createLightCoverToken(e)}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._maskDataService.batchGetMasksByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};$e=Fe([We(2,f.tx),We(3,Oe),We(4,te.Ui),Le("design:paramtypes",[Object,Object,"function"==typeof(Be=void 0!==f.tx&&f.tx)?Be:Object,"function"==typeof(Ue=void 0!==Oe&&Oe)?Ue:Object,"function"==typeof(Ne=void 0!==te.Ui&&te.Ui)?Ne:Object])],$e);var Ge,Ve=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},He=function(e,t){return function(r,o){t(r,o,e)}};let Ye=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M($e,[e,t]))}};Ye=Ve([He(0,i.T),Ke("design:paramtypes",["function"==typeof(Ge=void 0!==i.T&&i.T)?Ge:Object])],Ye);const qe=(0,c.yh)("transition-data-service");var ze,Ze,Qe,Je=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Xe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},et=function(e,t){return function(r,o){t(r,o,e)}};let tt=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._transitionDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._transitionDataService.batchGetTransitionsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};tt=Je([et(2,f.tx),et(3,qe),et(4,te.Ui),Xe("design:paramtypes",[Object,Object,"function"==typeof(ze=void 0!==f.tx&&f.tx)?ze:Object,"function"==typeof(Ze=void 0!==qe&&qe)?Ze:Object,"function"==typeof(Qe=void 0!==te.Ui&&te.Ui)?Qe:Object])],tt);var rt,ot=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},nt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},it=function(e,t){return function(r,o){t(r,o,e)}};let st=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(tt,[e,t]))}};st=ot([it(0,i.T),nt("design:paramtypes",["function"==typeof(rt=void 0!==i.T&&i.T)?rt:Object])],st);const at=(0,c.yh)("audio-voice-data-service");var ct,lt,ut,dt=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ft=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ht=function(e,t){return function(r,o){t(r,o,e)}};let pt=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._audioVoiceDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)((0,p.R)(this.value));const[e,t]=(await this._audioVoiceDataService.batchGetAudioVoicesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};pt=dt([ht(2,f.tx),ht(3,at),ht(4,te.Ui),ft("design:paramtypes",[Object,Object,"function"==typeof(ct=void 0!==f.tx&&f.tx)?ct:Object,"function"==typeof(lt=void 0!==at&&at)?lt:Object,"function"==typeof(ut=void 0!==te.Ui&&te.Ui)?ut:Object])],pt);var vt,gt=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},yt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mt=function(e,t){return function(r,o){t(r,o,e)}};let _t=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(pt,[e,t]))}};_t=gt([mt(0,i.T),yt("design:paramtypes",["function"==typeof(vt=void 0!==i.T&&i.T)?vt:Object])],_t);const bt=(0,c.yh)("video-background-data-service");var Rt,wt,St,kt=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Tt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ct=function(e,t){return function(r,o){t(r,o,e)}};let jt=class extends v.B{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._videoBackgroundDataService=o,this._configurationService=n}getCover(e){return e.previewUrl}getVideoBackgroundResourceToken(){return this._getResourceTokenSync(this._createVideoBackgroundResourceToken.bind(this),(()=>this._videoBackgroundResourceToken),(e=>this._videoBackgroundResourceToken=e))}_createVideoBackgroundResourceToken(e){const t=e.package.urlList[0],r=this._getVideoBackgroundResourceResourceKey();return(0,h.MZ)({key:r,url:t},this._downloadService)}_getVideoBackgroundResourceResourceKey(){return`${this.key}_resource`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createVideoBackgroundResourceToken(e)}async doFetch(){const[e,t]=(await this._videoBackgroundDataService.batchGetVideoBackgroundsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};jt=kt([Ct(2,f.tx),Ct(3,bt),Ct(4,te.Ui),Tt("design:paramtypes",[Object,Object,"function"==typeof(Rt=void 0!==f.tx&&f.tx)?Rt:Object,"function"==typeof(wt=void 0!==bt&&bt)?wt:Object,"function"==typeof(St=void 0!==te.Ui&&te.Ui)?St:Object])],jt);var Pt,Ot=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Mt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},It=function(e,t){return function(r,o){t(r,o,e)}};let xt=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(jt,[e,t]))}};xt=Ot([It(0,i.T),Mt("design:paramtypes",["function"==typeof(Pt=void 0!==i.T&&i.T)?Pt:Object])],xt);var Et,Dt=r(59470),At=r(98720),Bt=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ut=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Nt=function(e,t){return function(r,o){t(r,o,e)}};let Ft=class extends Ie.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}getCoverResourceToken(){return this._getResourceTokenSync(this._createCoverToken.bind(this),(()=>this._coverResourceToken),(e=>this._coverResourceToken=e))}_createCoverToken(e){const t=this._getCoverResourceKey(),{url:r,decryptKey:o,shouldAutoDecrypt:n}=this.getCover(e);return(0,h.MZ)({key:t,url:r,decryptKey:o,shouldAutoDecrypt:n,encryptType:Dt.PS.AES_CBC},this._downloadService)}_getCoverResourceKey(){return`${this.key}_cover`}doGenerateResourceTokens(e){this._coverResourceToken=this._createCoverToken(e)}};Ft=Bt([Nt(2,f.tx),Ut("design:paramtypes",[Object,void 0,"function"==typeof(Et=void 0!==f.tx&&f.tx)?Et:Object])],Ft);var Lt,Wt=r(31702),$t=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Gt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Vt=function(e,t){return function(r,o){t(r,o,e)}};let Kt=class extends Ft{constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r,this._onFastImportDefer=(0,At.PQ)(),this._onThumbDefer=(0,At.PQ)(),this._onCoverDefer=(0,At.PQ)(),this._checkAndMarkResourceToken()}async isSupportFastImport(){var e,t;return await this._onFastImportDefer.promise,null!==(e=null===(t=this.value.uploading)||void 0===t?void 0:t.isSupportFastImport)&&void 0!==e&&e}getPreviewResourceToken(){return this._userVideoPreviewResourceToken?this._userVideoPreviewResourceToken:new Wt.R((()=>new Promise((async e=>{await this._onFastImportDefer.promise,this._userVideoPreviewResourceToken=this._createPreviewResourceToken()}))))}getCover(e){(0,o.Y2)(e.cover);const t=e.cover.key;return{url:e.cover.url,decryptKey:t,shouldAutoDecrypt:Boolean(t),encryptType:Dt.PS.AES_CBC}}getUserVideoResourceToken(){return this._getResourceTokenSync(this._createEncryptedUserVideoResourceToken.bind(this),(()=>this._userVideoEncryptedResourceToken),(e=>this._userVideoEncryptedResourceToken=e))}getUserVideoDecryptedResourceToken(){return this._getResourceTokenSync(this._createDecryptedUserVideoResourceToken.bind(this),(()=>this._userVideoResourceToken),(e=>this._userVideoResourceToken=e))}getCoverResourceToken(){var e,t;return this._userVideoCoverResourceToken?this._userVideoCoverResourceToken:(null===(e=this.value)||void 0===e||null===(e=e.uploading)||void 0===e||null===(t=e.generateCoverTrigger)||void 0===t||t.call(e),new Wt.R((async()=>(await this._onCoverDefer.promise,this._userVideoCoverResourceToken))))}async getThumbResourceTokens(){var e,t;this._userVideoThumbResourceTokens||(null===(e=this.value)||void 0===e||null===(e=e.uploading)||void 0===e||null===(t=e.generateThumbTrigger)||void 0===t||t.call(e));return await this._onThumbDefer.promise,this._userVideoThumbResourceTokens}_createDecryptedUserVideoResourceToken(e){(0,o.Y2)((0,p.R)(this.value));const t=["480p","360p","540p","720p"];(0,o.Y2)(e.videoTranscodeInfo,"videoTranscodeInfo should not be undefined!");for(const r of t){const t=e.videoTranscodeInfo[r],{url:o,key:n}=null!=t?t:{};if(o){const e=this._getResolutionResourceKey(r);return this._userVideoEncryptedResourceToken=(0,h.MZ)({key:e,url:o,decryptKey:n,shouldAutoDecrypt:Boolean(n),encryptType:Dt.PS.AES_CBC},this._downloadService),this._userVideoEncryptedResourceToken}}(0,o.ss)()}_createEncryptedUserVideoResourceToken(e){(0,o.Y2)((0,p.R)(this.value));const t=["480p","360p","540p","720p"];(0,o.Y2)(e.videoTranscodeInfo,"videoTranscodeInfo should not be undefined!");for(const r of t){const t=e.videoTranscodeInfo[r],{url:o,key:n}=null!=t?t:{};if(o){const e=this._getResolutionResourceKey(r);return this._userVideoEncryptedResourceToken=(0,h.MZ)({key:e,url:o,decryptKey:n,shouldAutoDecrypt:!1,encryptType:Dt.PS.AES_CBC},this._downloadService),this._userVideoEncryptedResourceToken}}(0,o.ss)()}_createUserVideoThumbTokens(e){(0,o.Y2)(e.thumb);const{singleFrameWidth:t,singleFrameHeight:r}=e.thumb.common;return this._userVideoThumbResourceTokens=e.thumb.details.map((e=>{const o=this._getThumbResourceKey(e.url),n={frameCount:e.frameCount,singleFrameWidth:t,singleFrameHeight:r,imageWidth:e.imageWidth,imageHeight:e.imageHeight};return(0,h.MZ)({key:o,url:e.url,decryptKey:e.encryptedKey,shouldAutoDecrypt:Boolean(e.encryptedKey),encryptType:Dt.PS.AES_CBC,...n},this._downloadService)})),this._userVideoThumbResourceTokens}_createPreviewResourceToken(){var e;const t=this.value;(0,o.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.file);const r=`${this.key}_fast_import`,n=URL.createObjectURL(t.uploading.file);return(0,h.MZ)({key:r,url:n},this._downloadService)}_createUserVideoCoverToken(){var e;const t=this.value;(0,o.Y2)(t.cover),this._userVideoCoverResourceToken=(0,h.MZ)({key:this._getCoverResourceKey(),url:t.cover.url,decryptKey:null!==(e=t.cover.key)&&void 0!==e?e:"",shouldAutoDecrypt:Boolean(t.cover.key),encryptType:Dt.PS.AES_CBC},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}_getThumbResourceKey(e){return`${this.key?`${this.key}_`:""}thumb_${e}`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createEncryptedUserVideoResourceToken(e),this._createDecryptedUserVideoResourceToken(e),this._createUserVideoThumbTokens(e)}doFetch(){return new Promise((e=>{(0,o.Y2)(!(0,p.R)(this.value)),this.value.onProgress((e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()})),this.value.onReady((t=>{Object.assign(this.value,t),(0,p.R)(this.value)||((0,p.K)(this.value),this._checkAndMarkResourceToken(),(0,o.Y2)((0,p.R)(this.value)),e(this.value))}))}))}_checkAndMarkResourceToken(){var e,t;const r=this.value;null!==(e=r.uploading)&&void 0!==e&&e.isSupportFastImport&&null!==(t=r.uploading)&&void 0!==t&&t.file&&this._onFastImportDefer.resolve(r.uploading.file),r.thumb&&!this._userVideoThumbResourceTokens&&(this._createUserVideoThumbTokens(r),this._onThumbDefer.resolve()),r.cover&&!this._userVideoCoverResourceToken&&(this._createUserVideoCoverToken(),this._onCoverDefer.resolve())}};Kt=$t([Vt(2,f.tx),Gt("design:paramtypes",[Object,Object,"function"==typeof(Lt=void 0!==f.tx&&f.tx)?Lt:Object])],Kt);var Ht,Yt=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},qt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zt=function(e,t){return function(r,o){t(r,o,e)}};let Zt=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Kt,[e,t]))}};Zt=Yt([zt(0,i.T),qt("design:paramtypes",["function"==typeof(Ht=void 0!==i.T&&i.T)?Ht:Object])],Zt);const Qt=(0,c.yh)("text-motion-data-service");var Jt,Xt,er,tr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},rr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},or=function(e,t){return function(r,o){t(r,o,e)}};let nr=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._textMotionDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._textMotionDataService.batchGetTextMotionsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};nr=tr([or(2,f.tx),or(3,Qt),or(4,te.Ui),rr("design:paramtypes",[Object,Object,"function"==typeof(Jt=void 0!==f.tx&&f.tx)?Jt:Object,"function"==typeof(Xt=void 0!==Qt&&Qt)?Xt:Object,"function"==typeof(er=void 0!==te.Ui&&te.Ui)?er:Object])],nr);var ir,sr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ar=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cr=function(e,t){return function(r,o){t(r,o,e)}};let lr=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(nr,[e,t]))}};lr=sr([cr(0,i.T),ar("design:paramtypes",["function"==typeof(ir=void 0!==i.T&&i.T)?ir:Object])],lr);const ur=(0,c.yh)("video-motion-data-service");var dr,fr,hr,pr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},vr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},gr=function(e,t){return function(r,o){t(r,o,e)}};let yr=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._videoMotionDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._videoMotionDataService.batchGetVideoMotionsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};yr=pr([gr(2,f.tx),gr(3,ur),gr(4,te.Ui),vr("design:paramtypes",[Object,Object,"function"==typeof(dr=void 0!==f.tx&&f.tx)?dr:Object,"function"==typeof(fr=void 0!==ur&&ur)?fr:Object,"function"==typeof(hr=void 0!==te.Ui&&te.Ui)?hr:Object])],yr);var mr,_r=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},br=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Rr=function(e,t){return function(r,o){t(r,o,e)}};let wr=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(yr,[e,t]))}};wr=_r([Rr(0,i.T),br("design:paramtypes",["function"==typeof(mr=void 0!==i.T&&i.T)?mr:Object])],wr);const Sr=(0,c.yh)("sticker-motion-data-service");var kr,Tr,Cr,jr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Pr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Or=function(e,t){return function(r,o){t(r,o,e)}};let Mr=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._stickerMotionDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._stickerMotionDataService.batchGetStickerMotionsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Mr=jr([Or(2,f.tx),Or(3,Sr),Or(4,te.Ui),Pr("design:paramtypes",[Object,Object,"function"==typeof(kr=void 0!==f.tx&&f.tx)?kr:Object,"function"==typeof(Tr=void 0!==Sr&&Sr)?Tr:Object,"function"==typeof(Cr=void 0!==te.Ui&&te.Ui)?Cr:Object])],Mr);var Ir,xr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Er=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Dr=function(e,t){return function(r,o){t(r,o,e)}};let Ar=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Mr,[e,t]))}};Ar=xr([Dr(0,i.T),Er("design:paramtypes",["function"==typeof(Ir=void 0!==i.T&&i.T)?Ir:Object])],Ar);const Br=(0,c.yh)("evercloud-token-data-service");var Ur=r(81358);const Nr=["480p","360p","540p","720p","origin"],Fr=p.R;(0,c.yh)("user-photo-resource-service");var Lr,Wr,$r=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Gr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Vr=function(e,t){return function(r,o){t(r,o,e)}};let Kr=class extends Ft{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._evercloudTokenDataService=o,this._onFastImportDefer=(0,At.PQ)(),this._onCoverDefer=(0,At.PQ)(),this._checkAndMarkResourceToken()}async isSupportFastImport(){var e,t;return await this._onFastImportDefer.promise,null!==(e=null===(t=this.value.uploading)||void 0===t?void 0:t.isSupportFastImport)&&void 0!==e&&e}getPreviewResourceToken(){return this._userPhotoPreviewResourceToken?this._userPhotoPreviewResourceToken:new Wt.R((()=>new Promise((async e=>{await this._onFastImportDefer.promise,this._userPhotoPreviewResourceToken=this._createPreviewResourceToken()}))))}getCoverResourceToken(){var e,t;return this._userPhotoCoverResourceToken?this._userPhotoCoverResourceToken:(null===(e=this.value)||void 0===e||null===(e=e.uploading)||void 0===e||null===(t=e.generateCoverTrigger)||void 0===t||t.call(e),new Wt.R((async()=>(await this._onCoverDefer.promise,this._userPhotoCoverResourceToken))))}getCover(e){(0,o.Y2)(e.cover);const t=e.cover.key;return{url:e.cover.url,decryptKey:t,shouldAutoDecrypt:Boolean(t),encryptType:Dt.PS.AES_CBC}}getUserPhotoResourceToken(){return this.getResolutionResourceTokenByQueue(Nr)}getResolutionResourceTokenByQueue(e){return this._getResourceTokenSync((t=>{(0,o.Y2)(t.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");const r=this._getBestResolution(t,e);return(0,o.Y2)(this._allResolutionResourceTokens),this._allResolutionResourceTokens[r]}),(()=>{if(this.status!==Ur.n.complete)return;(0,o.Y2)(Fr(this.value));const t=this._getBestResolution(this.value,e);return(0,o.Y2)(this._allResolutionResourceTokens),this._allResolutionResourceTokens[t]}),(t=>{(0,o.Y2)(Fr(this.value));const r=this._getBestResolution(this.value,e);(0,o.Y2)(this._allResolutionResourceTokens),this._allResolutionResourceTokens[r]||(this._allResolutionResourceTokens[r]=t)}))}getAllResolutionResourceTokens(){return this._getResourceTokenAsync((()=>this._allResolutionResourceTokens))}_createUserPhotoResourceToken(e){(0,o.Y2)(Fr(this.value)),(0,o.Y2)(e.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");for(const r of Nr){var t;const{url:o,key:n,decryptType:i}=null!==(t=e.imgTranscodeInfo[r])&&void 0!==t?t:{};if(o){const e=this._getResolutionResourceKey(r);return this._userPhotoResourceToken=(0,h.MZ)({key:e,url:o,decryptKey:n,shouldAutoDecrypt:Boolean(n),encryptType:null!=i?i:Dt.PS.AES_CBC},this._downloadService),this._userPhotoResourceToken}}(0,o.ss)()}_createAllResolutionResourceTokens(e){var t;return(0,o.Y2)(e.imgTranscodeInfo),this._allResolutionResourceTokens=Object.keys(e.imgTranscodeInfo).reduce(((t,r)=>{if(t[r])return t;(0,o.Y2)(e.imgTranscodeInfo);const n=e.imgTranscodeInfo[r],{url:i,key:s,decryptType:a}=n,c=this._getResolutionResourceKey(r);return t[r]=(0,h.MZ)({key:c,url:i,decryptKey:s,shouldAutoDecrypt:Boolean(s),encryptType:null!=a?a:Dt.PS.AES_CBC},this._downloadService),t}),null!==(t=this._allResolutionResourceTokens)&&void 0!==t?t:{}),this._allResolutionResourceTokens}_createPreviewResourceToken(){var e;const t=this.value;(0,o.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.file);const r=new Blob([t.uploading.file]),n=`${this.key}_fast_import`,i=URL.createObjectURL(r);return(0,h.MZ)({key:n,url:i},this._downloadService)}_createUserPhotoCoverToken(){var e,t;const r=this.value;(0,o.Y2)(r.cover),this._userPhotoCoverResourceToken=(0,h.MZ)({key:this._getCoverResourceKey(),url:r.cover.url,decryptKey:null!==(e=r.cover.key)&&void 0!==e?e:"",shouldAutoDecrypt:Boolean(r.cover.key),encryptType:null!==(t=r.cover.decryptType)&&void 0!==t?t:Dt.PS.AES_CBC},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createUserPhotoResourceToken(e),this._createAllResolutionResourceTokens(e)}doFetch(){return new Promise((e=>{(0,o.Y2)(!Fr(this.value)),this.value.onProgress((e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()})),this.value.onReady((t=>{Object.assign(this.value,t),Fr(this.value)||((0,p.K)(this.value),this._checkAndMarkResourceToken(),(0,o.Y2)(Fr(this.value)),e(this.value))}))}))}_checkAndMarkResourceToken(){var e,t;const r=this.value;null!==(e=r.uploading)&&void 0!==e&&e.isSupportFastImport&&null!==(t=r.uploading)&&void 0!==t&&t.file&&this._onFastImportDefer.resolve(r.uploading.file),r.cover&&!this._userPhotoCoverResourceToken&&(this._createUserPhotoCoverToken(),this._onCoverDefer.resolve())}_getBestResolution(e,t){(0,o.Y2)(e.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");for(const o of t){var r;const{url:t}=null!==(r=e.imgTranscodeInfo[o])&&void 0!==r?r:{};if(t)return o}(0,o.ss)()}};Kr=$r([Vr(2,f.tx),Vr(3,Br),Gr("design:paramtypes",[Object,Object,"function"==typeof(Lr=void 0!==f.tx&&f.tx)?Lr:Object,"function"==typeof(Wr=void 0!==Br&&Br)?Wr:Object])],Kr);var Hr,Yr=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},qr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zr=function(e,t){return function(r,o){t(r,o,e)}};let Zr=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Kr,[e,t]))}};Zr=Yr([zr(0,i.T),qr("design:paramtypes",["function"==typeof(Hr=void 0!==i.T&&i.T)?Hr:Object])],Zr);const Qr=(0,c.yh)("auto-beauty-data-service");var Jr,Xr,eo,to=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ro=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},oo=function(e,t){return function(r,o){t(r,o,e)}};let no=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],resourceType:s._.AutoBeautyBody})).pair();if(e)throw new Error(`doFetch error ${e.code}`);const r=t.list[0];return{type:this.value.type,...r}}};no=to([oo(2,f.tx),oo(3,Qr),oo(4,te.Ui),ro("design:paramtypes",[Object,Object,"function"==typeof(Jr=void 0!==f.tx&&f.tx)?Jr:Object,"function"==typeof(Xr=void 0!==Qr&&Qr)?Xr:Object,"function"==typeof(eo=void 0!==te.Ui&&te.Ui)?eo:Object])],no);var io,so=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ao=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},co=function(e,t){return function(r,o){t(r,o,e)}};let lo=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(no,[e,t]))}};lo=so([co(0,i.T),ao("design:paramtypes",["function"==typeof(io=void 0!==i.T&&i.T)?io:Object])],lo);var uo,fo,ho,po=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},vo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},go=function(e,t){return function(r,o){t(r,o,e)}};let yo=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],resourceType:s._.AutoBeautyFace})).pair();if(e)throw new Error(`doFetch error ${e.code}`);const r=t.list[0];return{type:this.value.type,...r}}};yo=po([go(2,f.tx),go(3,Qr),go(4,te.Ui),vo("design:paramtypes",[Object,Object,"function"==typeof(uo=void 0!==f.tx&&f.tx)?uo:Object,"function"==typeof(fo=void 0!==Qr&&Qr)?fo:Object,"function"==typeof(ho=void 0!==te.Ui&&te.Ui)?ho:Object])],yo);var mo,_o=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},bo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ro=function(e,t){return function(r,o){t(r,o,e)}};let wo=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(yo,[e,t]))}};wo=_o([Ro(0,i.T),bo("design:paramtypes",["function"==typeof(mo=void 0!==i.T&&i.T)?mo:Object])],wo);var So,ko,To,Co=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},jo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Po=function(e,t){return function(r,o){t(r,o,e)}};let Oo=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],resourceType:s._.AutoBeautyShape})).pair();if(e)throw new Error(`doFetch error ${e.code}`);const r=t.list[0];return{type:this.value.type,...r}}};Oo=Co([Po(2,f.tx),Po(3,Qr),Po(4,te.Ui),jo("design:paramtypes",[Object,Object,"function"==typeof(So=void 0!==f.tx&&f.tx)?So:Object,"function"==typeof(ko=void 0!==Qr&&Qr)?ko:Object,"function"==typeof(To=void 0!==te.Ui&&te.Ui)?To:Object])],Oo);var Mo,Io=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},xo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Eo=function(e,t){return function(r,o){t(r,o,e)}};let Do=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Oo,[e,t]))}};Do=Io([Eo(0,i.T),xo("design:paramtypes",["function"==typeof(Mo=void 0!==i.T&&i.T)?Mo:Object])],Do);var Ao,Bo,Uo,No=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Fo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Lo=function(e,t){return function(r,o){t(r,o,e)}};let Wo=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],resourceType:s._.AutoBeautyMakeup})).pair();if(e)throw new Error(`doFetch error ${e.code}`);const r=t.list[0];return{type:this.value.type,...r}}};Wo=No([Lo(2,f.tx),Lo(3,Qr),Lo(4,te.Ui),Fo("design:paramtypes",[Object,Object,"function"==typeof(Ao=void 0!==f.tx&&f.tx)?Ao:Object,"function"==typeof(Bo=void 0!==Qr&&Qr)?Bo:Object,"function"==typeof(Uo=void 0!==te.Ui&&te.Ui)?Uo:Object])],Wo);var $o,Go=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Vo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ko=function(e,t){return function(r,o){t(r,o,e)}};let Ho=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Wo,[e,t]))}};Ho=Go([Ko(0,i.T),Vo("design:paramtypes",["function"==typeof($o=void 0!==i.T&&i.T)?$o:Object])],Ho);const Yo=(0,c.yh)("font-data-service");var qo,zo,Zo,Qo=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Jo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xo=function(e,t){return function(r,o){t(r,o,e)}};let en=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._fontDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._fontDataService.batchGetFontsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};en=Qo([Xo(2,f.tx),Xo(3,Yo),Xo(4,te.Ui),Jo("design:paramtypes",[Object,Object,"function"==typeof(qo=void 0!==f.tx&&f.tx)?qo:Object,"function"==typeof(zo=void 0!==Yo&&Yo)?zo:Object,"function"==typeof(Zo=void 0!==te.Ui&&te.Ui)?Zo:Object])],en);var tn,rn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},on=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},nn=function(e,t){return function(r,o){t(r,o,e)}};let sn=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(en,[e,t]))}};sn=rn([nn(0,i.T),on("design:paramtypes",["function"==typeof(tn=void 0!==i.T&&i.T)?tn:Object])],sn);const an=(0,c.yh)("sticker-data-service");var cn,ln,un,dn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},fn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},hn=function(e,t){return function(r,o){t(r,o,e)}};let pn=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._stickerDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._stickerDataService.batchGetStickersByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};pn=dn([hn(2,f.tx),hn(3,an),hn(4,te.Ui),fn("design:paramtypes",[Object,Object,"function"==typeof(cn=void 0!==f.tx&&f.tx)?cn:Object,"function"==typeof(ln=void 0!==an&&an)?ln:Object,"function"==typeof(un=void 0!==te.Ui&&te.Ui)?un:Object])],pn);var vn,gn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},yn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mn=function(e,t){return function(r,o){t(r,o,e)}};let _n=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(pn,[e,t]))}};_n=gn([mn(0,i.T),yn("design:paramtypes",["function"==typeof(vn=void 0!==i.T&&i.T)?vn:Object])],_n);var bn=r(23843);const Rn=p.R;(0,c.yh)("user-file-resource-service");var wn,Sn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},kn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Tn=function(e,t){return function(r,o){t(r,o,e)}};let Cn=class extends Ie.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),(()=>this._contentResourceToken),(e=>this._contentResourceToken=e))}_createContentToken(e){const t=this._getFileResourceKey(),r=this.getContentUrl(e);return(0,h.rW)({key:t,url:r},this._downloadService)}_getFileResourceKey(){return`${this.key}_file`}doGenerateResourceTokens(e){this._contentResourceToken=this._createContentToken(e)}};Cn=Sn([Tn(2,f.tx),kn("design:paramtypes",[Object,void 0,"function"==typeof(wn=void 0!==f.tx&&f.tx)?wn:Object])],Cn);var jn,Pn,On=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Mn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},In=function(e,t){return function(r,o){t(r,o,e)}};let xn=class extends Cn{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._evercloudTokenDataService=o}getFileUniqueId(){return(0,o.Y2)((0,p.R)(this.value),"resource is not ready yet! please ensure resource is ready before call this function."),this.value.sourceType===bn.ov.EverCloud?this.value.assetId:this.value.vid}getContentUrl(e){return(0,o.ZB)(e.url,"un expect fullResource url"),e.url}_createContentToken(e){const t=this._getFileResourceKey(),r=this.getContentUrl(e),{decryptKey:o}=e;return o?(0,h.rW)({key:t,url:r,encryptType:Dt.PS.AES_CBC,shouldAutoDecrypt:!0,decryptKey:o},this._downloadService,this.downloadConfig):(0,h.rW)({key:t,url:r},this._downloadService,this.downloadConfig)}async _doResourceReady(e){if((0,o.Y2)(Rn(this.value)),this._isOriginUserFile(this.value.url)){const[e,t]=(await this._evercloudTokenDataService.getEvercloudToken()).pair();e||(this._liveRequestToken=t.token)}super._doResourceReady(e)}doFetch(){return new Promise((e=>{(0,o.Y2)(!(0,p.R)(this.value)),this.value.onProgress((e=>{Object.assign(this.value,e)})),this.value.onReady((t=>{Object.assign(this.value,t),(0,p.K)(this.value),(0,o.Y2)(Rn(this.value)),e(this.value)}))}))}get downloadConfig(){if(this._liveRequestToken)return{headers:{"x-everphoto-global-session-token":this._liveRequestToken,"x-everphoto-token":this._liveRequestToken}}}_isOriginUserFile(e){return(0,o.Y2)(Rn(this.value)),!!e&&!!e.match(/origin/)}};xn=On([In(2,f.tx),In(3,Br),Mn("design:paramtypes",[Object,Object,"function"==typeof(jn=void 0!==f.tx&&f.tx)?jn:Object,"function"==typeof(Pn=void 0!==Br&&Br)?Pn:Object])],xn);var En,Dn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},An=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bn=function(e,t){return function(r,o){t(r,o,e)}};let Un=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(xn,[e,t]))}};Un=Dn([Bn(0,i.T),An("design:paramtypes",["function"==typeof(En=void 0!==i.T&&i.T)?En:Object])],Un);var Nn,Fn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ln=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wn=function(e,t){return function(r,o){t(r,o,e)}};let $n=class extends Ie.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r,this._onFastImportDefer=(0,At.PQ)(),this._checkAndMarkResourceToken()}async isSupportFastImport(){var e,t;return await this._onFastImportDefer.promise,null!==(e=null===(t=this.value.uploading)||void 0===t?void 0:t.isSupportFastImport)&&void 0!==e&&e}getPreviewResourceToken(){return this._previewResourceToken?this._previewResourceToken:new Wt.R((()=>new Promise((async e=>{await this._onFastImportDefer.promise,this._previewResourceToken=this._createPreviewResourceToken()}))))}getUserAudioResourceToken(){return this._getResourceTokenSync(this._createUserAudioResourceToken.bind(this),(()=>this._userAudioResourceToken),(e=>this._userAudioResourceToken=e))}_createUserAudioResourceToken(e){(0,o.Y2)((0,p.R)(this.value));const t=["128kb"];(0,o.Y2)(e.audioTranscodeInfo,"audioTranscodeInfo should not be undefined!");for(const r of t){const t=e.audioTranscodeInfo[r],{url:o,key:n}=t;if(o){const e=this._getResolutionResourceKey(r);return this._userAudioResourceToken=(0,h.MZ)({key:e,url:o,decryptKey:n,shouldAutoDecrypt:!1,encryptType:Dt.PS.AES_CBC},this._downloadService),this._userAudioResourceToken}}(0,o.ss)()}_createPreviewResourceToken(){var e;const t=this.value;(0,o.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.file);const r=new Blob([t.uploading.file]),n=`${this.key}_fast_import`,i=URL.createObjectURL(r);return(0,h.MZ)({key:n,url:i},this._downloadService)}_getResolutionResourceKey(e){return`${this.key}_resolution_${e}`}doGenerateResourceTokens(e){this._createUserAudioResourceToken(e)}doFetch(){return new Promise((e=>{(0,o.Y2)(!(0,p.R)(this.value)),this.value.onProgress((e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()})),this.value.onReady((t=>{Object.assign(this.value,t),(0,p.R)(this.value)||((0,p.K)(this.value),this._checkAndMarkResourceToken(),(0,o.Y2)((0,p.R)(this.value)),e(this.value))}))}))}_checkAndMarkResourceToken(){var e,t;const r=this.value;null!==(e=r.uploading)&&void 0!==e&&e.isSupportFastImport&&null!==(t=r.uploading)&&void 0!==t&&t.file&&this._onFastImportDefer.resolve(r.uploading.file)}};$n=Fn([Wn(2,f.tx),Ln("design:paramtypes",[Object,Object,"function"==typeof(Nn=void 0!==f.tx&&f.tx)?Nn:Object])],$n);var Gn,Vn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Kn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Hn=function(e,t){return function(r,o){t(r,o,e)}};let Yn=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M($n,[e,t]))}};Yn=Vn([Hn(0,i.T),Kn("design:paramtypes",["function"==typeof(Gn=void 0!==i.T&&i.T)?Gn:Object])],Yn);const qn=(0,c.yh)("video-template-data-service");var zn,Zn,Qn=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Jn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xn=function(e,t){return function(r,o){t(r,o,e)}};let ei=class extends v.B{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoTemplateDataService=o}getThumbResourceTokens(){return this._getResourceTokenAsync((()=>this._thumbResourceTokens))}getBuiltinResourceTokens(){return this._getResourceTokenAsync((()=>this._builtinResourceTokens))}getCover(e){return e.cover.url}_createThumbResourceTokens(e){this._thumbResourceTokens=e.encryptedSprites.map((e=>{const{count:t,url:r}=e,o={frameCount:e.count,singleFrameWidth:e.width/e.x,singleFrameHeight:e.height/e.y,imageWidth:e.width,imageHeight:e.height},n=`${this.key}_thumb_${t}`;return(0,h.MZ)({key:n,url:r,...o},this._downloadService)}))}_createBuiltinResourceTokens(e){this._builtinResourceTokens=e.preload.builtIns.map((e=>{const{md5:t,url:r,aes:o,key:n}=e;return n?(0,h.MZ)({key:`${t}_${n.slice(0,6)}`,url:r,decryptKey:n,shouldAutoDecrypt:o,encryptType:Dt.PS.AES_GCM},this._downloadService):(0,h.MZ)({key:t,url:r},this._downloadService)}))}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e),this._createThumbResourceTokens(e),this._createBuiltinResourceTokens(e)}async doFetch(){var e;if(!this._jsonpTemplate){const[e,t]=(await this._videoTemplateDataService.getVideoTemplatesByJsonp()).pair(),r=null==t?void 0:t.list[0];!e&&r&&(this._jsonpTemplate=r)}if((null===(e=this._jsonpTemplate)||void 0===e?void 0:e.id)===this.value.id)return{type:this.value.type,...this._jsonpTemplate};const[t,r]=(await this._videoTemplateDataService.batchGetVideoTemplatesByIds({ids:[this.value.id],enterFrom:"template_editor"})).pair();if(t)throw new Error(`doFetch error ${t.code}`);return{type:this.value.type,...r.list[0]}}};ei=Qn([Xn(2,f.tx),Xn(3,qn),Jn("design:paramtypes",[Object,Object,"function"==typeof(zn=void 0!==f.tx&&f.tx)?zn:Object,"function"==typeof(Zn=void 0!==qn&&qn)?Zn:Object])],ei);var ti,ri=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},oi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ni=function(e,t){return function(r,o){t(r,o,e)}};let ii=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(ei,[e,t]))}};ii=ri([ni(0,i.T),oi("design:paramtypes",["function"==typeof(ti=void 0!==i.T&&i.T)?ti:Object])],ii);var si,ai=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ci=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},li=function(e,t){return function(r,o){t(r,o,e)}};let ui=class extends Ie.i{constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),(()=>this._contentResourceToken),(e=>this._contentResourceToken=e))}_createContentToken(e){const t=this._getContentResourceKey(),r=this.getContentUrl(e);return(0,h.MZ)({key:t,url:r},this._downloadService)}_getContentResourceKey(){return`${this.key}_content`}doGenerateResourceTokens(e){this._contentResourceToken=this._createContentToken(e)}getContentUrl(e){return e.package.urlList[0]}doFetch(){(0,o.ss)("not support do fetch single model")}};ui=ai([li(2,f.tx),ci("design:paramtypes",[Object,Object,"function"==typeof(si=void 0!==f.tx&&f.tx)?si:Object])],ui);var di,fi=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},hi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},pi=function(e,t){return function(r,o){t(r,o,e)}};let vi=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(ui,[e,t]))}};vi=fi([pi(0,i.T),hi("design:paramtypes",["function"==typeof(di=void 0!==i.T&&i.T)?di:Object])],vi);const gi=(0,c.yh)("effect-data-service");var yi,mi,_i,bi=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ri=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wi=function(e,t){return function(r,o){t(r,o,e)}};let Si=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._effectDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._effectDataService.batchGetEffectsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId],effectResourceType:this.value.type})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Si=bi([wi(2,f.tx),wi(3,gi),wi(4,te.Ui),Ri("design:paramtypes",[Object,Object,"function"==typeof(yi=void 0!==f.tx&&f.tx)?yi:Object,"function"==typeof(mi=void 0!==gi&&gi)?mi:Object,"function"==typeof(_i=void 0!==te.Ui&&te.Ui)?_i:Object])],Si);var ki,Ti=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ci=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ji=function(e,t){return function(r,o){t(r,o,e)}};let Pi=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Si,[e,t]))}};Pi=Ti([ji(0,i.T),Ci("design:paramtypes",["function"==typeof(ki=void 0!==i.T&&i.T)?ki:Object])],Pi);const Oi=(0,c.yh)("tone-data-service");var Mi,Ii,xi,Ei=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Di=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ai=function(e,t){return function(r,o){t(r,o,e)}};let Bi=class extends ee.R{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._toneDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._toneDataService.batchGetTonesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Bi=Ei([Ai(2,f.tx),Ai(3,Oi),Ai(4,te.Ui),Di("design:paramtypes",[Object,Object,"function"==typeof(Mi=void 0!==f.tx&&f.tx)?Mi:Object,"function"==typeof(Ii=void 0!==Oi&&Oi)?Ii:Object,"function"==typeof(xi=void 0!==te.Ui&&te.Ui)?xi:Object])],Bi);var Ui,Ni=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Fi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Li=function(e,t){return function(r,o){t(r,o,e)}};let Wi=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Bi,[e,t]))}};Wi=Ni([Li(0,i.T),Fi("design:paramtypes",["function"==typeof(Ui=void 0!==i.T&&i.T)?Ui:Object])],Wi);const $i=(0,c.yh)("filter-data-service");var Gi,Vi,Ki,Hi=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Yi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},qi=function(e,t){return function(r,o){t(r,o,e)}};let zi=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._filterDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._filterDataService.batchGetFiltersByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};zi=Hi([qi(2,f.tx),qi(3,$i),qi(4,te.Ui),Yi("design:paramtypes",[Object,Object,"function"==typeof(Gi=void 0!==f.tx&&f.tx)?Gi:Object,"function"==typeof(Vi=void 0!==$i&&$i)?Vi:Object,"function"==typeof(Ki=void 0!==te.Ui&&te.Ui)?Ki:Object])],zi);var Zi,Qi=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ji=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xi=function(e,t){return function(r,o){t(r,o,e)}};let es=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(zi,[e,t]))}};es=Qi([Xi(0,i.T),Ji("design:paramtypes",["function"==typeof(Zi=void 0!==i.T&&i.T)?Zi:Object])],es);const ts=(0,c.yh)("curve-speed-data-service");var rs,os,ns,is=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ss=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},as=function(e,t){return function(r,o){t(r,o,e)}};let cs=class extends ee.R{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._curveSpeedDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._curveSpeedDataService.batchGetCurveSpeedsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};cs=is([as(2,f.tx),as(3,ts),as(4,te.Ui),ss("design:paramtypes",[Object,Object,"function"==typeof(rs=void 0!==f.tx&&f.tx)?rs:Object,"function"==typeof(os=void 0!==ts&&ts)?os:Object,"function"==typeof(ns=void 0!==te.Ui&&te.Ui)?ns:Object])],cs);var ls,us=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ds=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fs=function(e,t){return function(r,o){t(r,o,e)}};let hs=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(cs,[e,t]))}};hs=us([fs(0,i.T),ds("design:paramtypes",["function"==typeof(ls=void 0!==i.T&&i.T)?ls:Object])],hs);const ps=(0,c.yh)("mix-data-service");var vs,gs,ys,ms=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},_s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},bs=function(e,t){return function(r,o){t(r,o,e)}};let Rs=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._mixDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileMix(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._mixDataService.batchGetMixsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Rs=ms([bs(2,f.tx),bs(3,ps),bs(4,te.Ui),_s("design:paramtypes",[Object,Object,"function"==typeof(vs=void 0!==f.tx&&f.tx)?vs:Object,"function"==typeof(gs=void 0!==ps&&ps)?gs:Object,"function"==typeof(ys=void 0!==te.Ui&&te.Ui)?ys:Object])],Rs);var ws,Ss=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ks=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ts=function(e,t){return function(r,o){t(r,o,e)}};let Cs=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Rs,[e,t]))}};Cs=Ss([Ts(0,i.T),ks("design:paramtypes",["function"==typeof(ws=void 0!==i.T&&i.T)?ws:Object])],Cs);const js=(0,c.yh)("text-preset-service");var Ps,Os,Ms,Is=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},xs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Es=function(e,t){return function(r,o){t(r,o,e)}};let Ds=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._textPresetDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value)),(0,o.Y2)(this.value.resourceId,"text preset should have an resource id");const[e,t]=(await this._textPresetDataService.getTextByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Ds=Is([Es(2,f.tx),Es(3,js),Es(4,te.Ui),xs("design:paramtypes",[Object,Object,"function"==typeof(Ps=void 0!==f.tx&&f.tx)?Ps:Object,"function"==typeof(Os=void 0!==js&&js)?Os:Object,"function"==typeof(Ms=void 0!==te.Ui&&te.Ui)?Ms:Object])],Ds);var As,Bs=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Us=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ns=function(e,t){return function(r,o){t(r,o,e)}};let Fs=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Ds,[e,t]))}};Fs=Bs([Ns(0,i.T),Us("design:paramtypes",["function"==typeof(As=void 0!==i.T&&i.T)?As:Object])],Fs);const Ls=(0,c.yh)("text-template-service"),Ws=(0,c.yh)("text-motion-resource-service"),$s=(0,c.yh)("video-motion-resource-service"),Gs=(0,c.yh)("sticker-motion-resource-service"),Vs=(0,c.yh)("font-resource-service"),Ks=(0,c.yh)("sticker-resource-service"),Hs=(0,c.yh)("text-preset-resource-service"),Ys=(0,c.yh)("shape-animation-resource-service");function qs(e,t){const r=Object.keys(t);for(const o of r)if(t[o]===e)return o;(0,o.ss)(`no match resource type for panel ${e}`)}var zs,Zs,Qs,Js,Xs,ea,ta,ra,oa,na,ia=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},sa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},aa=function(e,t){return function(r,o){t(r,o,e)}};let ca=class extends ve{constructor(e,t,r,o,n,i,s,a,c,l,u,d){super(e,t,l),this.key=e,this._fontResourceService=r,this._stickerResourceService=o,this._textPresetResourceService=n,this._textMotionResourceService=i,this._videoMotionResourceService=s,this._stickerMotionResourceService=a,this._shapeAnimationResourceService=c,this._downloadService=l,this._textTemplateDataService=u,this._configurationService=d}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._textTemplateDataService.getTextByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}doGenerateResourceTokens(e){super.doGenerateResourceTokens(e)}_getResourceKey(e){return`${e.type}_${e.key}`}_doResourceReady(e){super._doResourceReady(e),this.parseAndInitChildResources()}parseAndInitChildResources(){for(const e of this.dependencyResources)switch(e.type){case s._.Font:this._fontResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case s._.TextMotion:this._textMotionResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case s._.StickerMotion:this._stickerMotionResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});case s._.Sticker:this._stickerResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});case s._.TextPreset:this._textPresetResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case s._.ShapeAnimation:this._shapeAnimationResourceService.add(this._getResourceKey(e),{...e,key:this._getResourceKey(e),resourceId:e.key});break;case s._.SystemFonts:break;default:(0,o.ss)("unsupported child resource type in text template resource!")}}get dependencyResources(){(0,o.Y2)((0,p.R)(this.value),"resource is not ready yet! please call this function after resource ready.");return this.value.dependentResources.map((e=>((0,o.Y2)(e.resourceId,"dependency resource should have a resource id"),{type:qs(e.type,this._configurationService.resourcePanel),key:e.resourceId})))}};ca=ia([aa(9,f.tx),aa(10,Ls),aa(11,te.Ui),sa("design:paramtypes",[Object,Object,"function"==typeof(zs=void 0!==Vs&&Vs)?zs:Object,"function"==typeof(Zs=void 0!==Ks&&Ks)?Zs:Object,"function"==typeof(Qs=void 0!==Hs&&Hs)?Qs:Object,"function"==typeof(Js=void 0!==Ws&&Ws)?Js:Object,"function"==typeof(Xs=void 0!==$s&&$s)?Xs:Object,"function"==typeof(ea=void 0!==Gs&&Gs)?ea:Object,"function"==typeof(ta=void 0!==Ys&&Ys)?ta:Object,"function"==typeof(ra=void 0!==f.tx&&f.tx)?ra:Object,"function"==typeof(oa=void 0!==Ls&&Ls)?oa:Object,"function"==typeof(na=void 0!==te.Ui&&te.Ui)?na:Object])],ca);var la,ua,da,fa,ha,pa,va,ga=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ya=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ma=function(e,t){return function(r,o){t(r,o,e)}};let _a=class extends a.e{constructor(e,t,r,o,n,i,s,a){super(a),this._fontResourceService=e,this._stickerResourceService=t,this._textPresetResourceService=r,this._textMotionResourceService=o,this._videoMotionResourceService=n,this._stickerMotionResourceService=i,this._shapeAnimationResourceService=s,this._instantiationService=a}createResource(e,t){return this._instantiationService.createInstance(new n.M(ca,[e,t,this._fontResourceService,this._stickerResourceService,this._textPresetResourceService,this._textMotionResourceService,this._videoMotionResourceService,this._stickerMotionResourceService,this._shapeAnimationResourceService]))}};_a=ga([ma(7,i.T),ya("design:paramtypes",["function"==typeof(la=void 0!==Vs&&Vs)?la:Object,"function"==typeof(ua=void 0!==Ks&&Ks)?ua:Object,"function"==typeof(da=void 0!==Hs&&Hs)?da:Object,"function"==typeof(fa=void 0!==Ws&&Ws)?fa:Object,"function"==typeof(ha=void 0!==$s&&$s)?ha:Object,"function"==typeof(pa=void 0!==Gs&&Gs)?pa:Object,Object,"function"==typeof(va=void 0!==i.T&&i.T)?va:Object])],_a);const ba=(0,c.yh)("gif-data-service");var Ra,wa,Sa=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ka=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ta=function(e,t){return function(r,o){t(r,o,e)}};let Ca=class extends v.B{constructor(e,t,r,o){super(e,t,r),this.key=e,this._downloadService=r,this._gifDataService=o}getCover(e){return e.coverUrl}getGifResourceToken(){return this._getResourceTokenSync(this._createGifResourceToken.bind(this),(()=>this._gifResourceToken),(e=>this._gifResourceToken=e))}_createGifResourceToken(e){const{animatedUrl:t,key:r}=e;return(0,h.MZ)({key:r,url:t},this._downloadService)}async doFetch(){const[e,t]=(await this._gifDataService.getGifsByIds({ids:[this.value.key]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Ca=Sa([Ta(2,f.tx),Ta(3,ba),ka("design:paramtypes",[Object,Object,"function"==typeof(Ra=void 0!==f.tx&&f.tx)?Ra:Object,"function"==typeof(wa=void 0!==ba&&ba)?wa:Object])],Ca);var ja,Pa=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Oa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ma=function(e,t){return function(r,o){t(r,o,e)}};let Ia=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Ca,[e,t]))}};Ia=Pa([Ma(0,i.T),Oa("design:paramtypes",["function"==typeof(ja=void 0!==i.T&&i.T)?ja:Object])],Ia);const xa=(0,c.yh)("bubble-data-service");var Ea,Da,Aa,Ba=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Ua=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Na=function(e,t){return function(r,o){t(r,o,e)}};let Fa=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._bubbleDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileBubble(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._bubbleDataService.batchGetBubblesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Fa=Ba([Na(2,f.tx),Na(3,xa),Na(4,te.Ui),Ua("design:paramtypes",[Object,Object,"function"==typeof(Ea=void 0!==f.tx&&f.tx)?Ea:Object,"function"==typeof(Da=void 0!==xa&&xa)?Da:Object,"function"==typeof(Aa=void 0!==te.Ui&&te.Ui)?Aa:Object])],Fa);var La,Wa=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},$a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ga=function(e,t){return function(r,o){t(r,o,e)}};let Va=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Fa,[e,t]))}};Va=Wa([Ga(0,i.T),$a("design:paramtypes",["function"==typeof(La=void 0!==i.T&&i.T)?La:Object])],Va);const Ka=(0,c.yh)("shape-animation-data-service");var Ha,Ya,qa,za=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Za=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Qa=function(e,t){return function(r,o){t(r,o,e)}};let Ja=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._shapeAnimationDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileShapeAnimation(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._shapeAnimationDataService.batchGetShapeAnimationsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};Ja=za([Qa(2,f.tx),Qa(3,Ka),Qa(4,te.Ui),Za("design:paramtypes",[Object,Object,"function"==typeof(Ha=void 0!==f.tx&&f.tx)?Ha:Object,"function"==typeof(Ya=void 0!==Ka&&Ka)?Ya:Object,"function"==typeof(qa=void 0!==te.Ui&&te.Ui)?qa:Object])],Ja);var Xa,ec=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},tc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},rc=function(e,t){return function(r,o){t(r,o,e)}};let oc=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(Ja,[e,t]))}};oc=ec([rc(0,i.T),tc("design:paramtypes",["function"==typeof(Xa=void 0!==i.T&&i.T)?Xa:Object])],oc);const nc=(0,c.yh)("graffiti-data-service");var ic,sc,ac,cc=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},lc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},uc=function(e,t){return function(r,o){t(r,o,e)}};let dc=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._graffitiDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._graffitiDataService.batchGetGraffitisByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};dc=cc([uc(2,f.tx),uc(3,nc),uc(4,te.Ui),lc("design:paramtypes",[Object,Object,"function"==typeof(ic=void 0!==f.tx&&f.tx)?ic:Object,"function"==typeof(sc=void 0!==nc&&nc)?sc:Object,"function"==typeof(ac=void 0!==te.Ui&&te.Ui)?ac:Object])],dc);var fc,hc=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},pc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},vc=function(e,t){return function(r,o){t(r,o,e)}};let gc=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(dc,[e,t]))}};gc=hc([vc(0,i.T),pc("design:paramtypes",["function"==typeof(fc=void 0!==i.T&&i.T)?fc:Object])],gc);const yc=(0,c.yh)("path-animation-data-service");var mc,_c,bc,Rc=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},wc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Sc=function(e,t){return function(r,o){t(r,o,e)}};let kc=class extends ve{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._pathAnimationDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFilePathAnimation(){return e=>e.endsWith(".json")}async doFetch(){(0,o.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._pathAnimationDataService.batchGetPathAnimationsByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};kc=Rc([Sc(2,f.tx),Sc(3,yc),Sc(4,te.Ui),wc("design:paramtypes",[Object,Object,"function"==typeof(mc=void 0!==f.tx&&f.tx)?mc:Object,"function"==typeof(_c=void 0!==yc&&yc)?_c:Object,"function"==typeof(bc=void 0!==te.Ui&&te.Ui)?bc:Object])],kc);var Tc,Cc=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},jc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pc=function(e,t){return function(r,o){t(r,o,e)}};let Oc=class extends a.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new n.M(kc,[e,t]))}};Oc=Cc([Pc(0,i.T),jc("design:paramtypes",["function"==typeof(Tc=void 0!==i.T&&i.T)?Tc:Object])],Oc);var Mc,Ic=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},xc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ec=function(e,t){return function(r,o){t(r,o,e)}};let Dc=class{constructor(e){this._childResourceServiceCreator=new Map,this._childResourceServices=new Map,this._instantiationService=e,this._childResourceServiceCreator.set(s._.TextTemplate,this._buildTextTemplateResourceServiceSyncDescriptorCreator()),this._childResourceServiceCreator.set(s._.Font,[sn]),this._childResourceServiceCreator.set(s._.Video,[k]),this._childResourceServiceCreator.set(s._.Shape,[T.I]),this._childResourceServiceCreator.set(s._.Photo,[z]),this._childResourceServiceCreator.set(s._.Audio,[U]),this._childResourceServiceCreator.set(s._.Mask,[Ye]),this._childResourceServiceCreator.set(s._.Sticker,[_n]),this._childResourceServiceCreator.set(s._.VideoTemplate,[ii]),this._childResourceServiceCreator.set(s._.AutoBeautyBody,[lo]),this._childResourceServiceCreator.set(s._.AutoBeautyFace,[wo]),this._childResourceServiceCreator.set(s._.AutoBeautyShape,[Do]),this._childResourceServiceCreator.set(s._.AutoBeautyMakeup,[Ho]),this._childResourceServiceCreator.set(s._.Bubble,[Va]),this._childResourceServiceCreator.set(s._.VideoBackground,[xt]),this._childResourceServiceCreator.set(s._.UserVideo,[Zt]),this._childResourceServiceCreator.set(s._.UserPhoto,[Zr]),this._childResourceServiceCreator.set(s._.UserAudio,[Yn]),this._childResourceServiceCreator.set(s._.UserFile,[Un]),this._childResourceServiceCreator.set(s._.Transition,[st]),this._childResourceServiceCreator.set(s._.TextMotion,[lr]),this._childResourceServiceCreator.set(s._.VideoMotion,[wr]),this._childResourceServiceCreator.set(s._.StickerMotion,[Ar]),this._childResourceServiceCreator.set(s._.ArithmeticModel,[vi]),this._childResourceServiceCreator.set(s._.Effects,[Pi]),this._childResourceServiceCreator.set(s._.FaceProp,[Pi]),this._childResourceServiceCreator.set(s._.Filter,[es]),this._childResourceServiceCreator.set(s._.CurveSpeed,[hs]),this._childResourceServiceCreator.set(s._.Mix,[Cs]),this._childResourceServiceCreator.set(s._.TextPreset,[Fs]),this._childResourceServiceCreator.set(s._.Tone,[Wi]),this._childResourceServiceCreator.set(s._.VoiceChange,[_t]),this._childResourceServiceCreator.set(s._.CurvePreset,[ue]),this._childResourceServiceCreator.set(s._.Integration,[Pe]),this._childResourceServiceCreator.set(s._.Gif,[Ia]),this._childResourceServiceCreator.set(s._.ShapeAnimation,[oc]),this._childResourceServiceCreator.set(s._.Graffiti,[gc]),this._childResourceServiceCreator.set(s._.PathAnimation,[Oc])}add(e,t){this._getChildResourceService(t.type).add(e,t)}get(e,t){return this._getChildResourceService(t).get(e)}_getChildResourceService(e){let t=this._childResourceServices.get(e);if(!t){const r=this._childResourceServiceCreator.get(e);if((0,o.Y2)(r,`${e} ResourceService has not register yet. please register it at the resource service constructor!`),r instanceof Function){const e=r();t=this._instantiationService.createInstance(e)}else t=this._instantiationService.createInstance(...r);this._childResourceServices.set(e,t)}return t}_buildTextTemplateResourceServiceSyncDescriptorCreator(){return()=>{const e=[s._.Font,s._.Sticker,s._.TextPreset,s._.TextMotion,s._.VideoMotion,s._.StickerMotion,s._.ShapeAnimation].map((e=>this._getChildResourceService(e)));return new n.M(_a,e)}}};Dc=Ic([Ec(0,i.T),xc("design:paramtypes",["function"==typeof(Mc=void 0!==i.T&&i.T)?Mc:Object])],Dc)},35188:(e,t,r)=>{r.d(t,{O:()=>j,I:()=>C});var o,n,i,s=r(47849),a=r(81666),c=r(2897),l=r(82552),u=r(48018),d=r(42058),f=r(34639),h=r(26957),p=r(1467),v=r(53945),g=r(69412),y=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e,t){return function(r,o){t(r,o,e)}};let b=class extends v.R{constructor(e,t,r,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._shapeDataService=o,this._configurationService=n}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".svg")}async doFetch(){(0,d.Y2)(!(0,p.R)(this.value));const[e,t]=(await this._shapeDataService.batchGetShapesByIds({enterFrom:this._configurationService.editorCategory,ids:[this.value.resourceId]})).pair();if(e)throw new Error(`doFetch error ${e.code}`);return{type:this.value.type,...t.list[0]}}};b=y([_(2,h.tx),_(3,f.K),_(4,g.Ui),m("design:paramtypes",[Object,Object,"function"==typeof(o=void 0!==h.tx&&h.tx)?o:Object,"function"==typeof(n=void 0!==f.K&&f.K)?n:Object,"function"==typeof(i=void 0!==g.Ui&&g.Ui)?i:Object])],b);var R,w,S=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},T=function(e,t){return function(r,o){t(r,o,e)}};let C=class extends s.e{constructor(e){super(e),this._instantiationService=e}createResource(e,t){return this._instantiationService.createInstance(new c.M(b,[e,t]))}};C=S([T(0,l.T),k("design:paramtypes",["function"==typeof(R=void 0!==l.T&&l.T)?R:Object])],C);let j=class{constructor(e){this.environmentService=e,this.initAwaitLock=new u.G}async load(){this.environmentService.isProd?this._svgResource=await Promise.all([r.e(592),r.e(444),r.e(425),r.e(29),r.e(542),r.e(430),r.e(294),r.e(922),r.e(377),r.e(52),r.e(435),r.e(774),r.e(54),r.e(880),r.e(375),r.e(933),r.e(188),r.e(408),r.e(611),r.e(429),r.e(634),r.e(458),r.e(550),r.e(873)]).then(r.t.bind(r,28672,19)):this._svgResource=await Promise.all([r.e(592),r.e(444),r.e(425),r.e(29),r.e(542),r.e(430),r.e(294),r.e(922),r.e(377),r.e(52),r.e(435),r.e(774),r.e(54),r.e(880),r.e(375),r.e(933),r.e(188),r.e(408),r.e(611),r.e(429),r.e(634),r.e(458),r.e(550),r.e(873)]).then(r.t.bind(r,16972,19)),this.initAwaitLock.initDone()}get(e){(0,d.ZB)(this._svgResource);const t=this._svgResource.svgMap.find((t=>t.id===e));return null==t?void 0:t.svg}getAll(){return this._svgResource}};j=S([T(0,a.Y),k("design:paramtypes",["function"==typeof(w=void 0!==a.Y&&a.Y)?w:Object])],j)},50601:(e,t,r)=>{r.d(t,{_:()=>n});var o=r(67126);(0,o.yh)("shape-resource-service");const n=(0,o.yh)("shape-json-resource-service")},1467:(e,t,r)=>{function o(e){e._fullResourceBrand||Object.defineProperty(e,"_fullResourceBrand",{value:()=>!0,enumerable:!1,writable:!1})}function n(e){return void 0!==e._fullResourceBrand}r.d(t,{K:()=>o,R:()=>n})},46862:(e,t,r)=>{r.d(t,{L:()=>i,T:()=>o});var o,n=r(67126);!function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(o||(o={}));const i=(0,n.yh)("slardar-adapter")},28620:(e,t,r)=>{r.d(t,{U:()=>o});const o=(0,r(67126).yh)("Storage")},28628:(e,t,r)=>{r.d(t,{w:()=>o});const o=(0,r(67126).yh)("tea-adapter")},11042:(e,t,r)=>{r.d(t,{WL:()=>c});var o,n,i,s,a=r(67126);!function(e){e.owner="owner",e.admin="admin",e.collaborator="collaborator",e.visitor="visitor"}(o||(o={})),function(e){e.US="US",e.BR="BR",e.SG="SG",e.KR="KR",e.ID="ID"}(n||(n={})),function(e){e[e.VA=0]="VA",e[e.GCP=1]="GCP"}(i||(i={})),function(e){e[e.SelfCreate=0]="SelfCreate",e[e.AppTransition=1]="AppTransition",e[e.WebTransition=2]="WebTransition"}(s||(s={}));const c=(0,a.yh)("workspace")},11537:(e,t,r)=>{r.d(t,{A:()=>p});var o,n,i=r(80941),s=r(35545),a=r(77685),c=r(42058),l=r(58201),u=r(26690),d=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,t){return function(r,o){t(r,o,e)}};let p=class extends s.JT{constructor(e,t){super(),this._userService=e,this._accountService=t,this._workspaceList=[],this._available=!1,this._onDidWorkspaceChange=this._store.add(new a.Q),this.onDidWorkspaceChange=this._onDidWorkspaceChange.event,this._onDidWorkspaceExpandInfoMapChange=this._store.add(new a.Q),this.onDidWorkspaceExpandInfoMapChange=this._onDidWorkspaceExpandInfoMapChange.event,this._userService.registerTransition((e=>{var t,r,o;if(!e)return;this._workspaceExpandInfoMap=null===(t=e.context)||void 0===t?void 0:t.workspaceExpandInfoMap;const n=null===(r=e.context)||void 0===r?void 0:r.workspaceList,i=null===(o=e.context)||void 0===o?void 0:o.workspaceExpandInfoMap;var s;((0,l.Z)(this._workspaceList,n)||null!=n&&n.length&&(this._workspaceList=n,this._available=!0,this._onDidWorkspaceChange.fire(n)),(0,l.Z)(this._workspaceExpandInfoMap,i))||(this._workspaceExpandInfoMap=null===(s=e.context)||void 0===s?void 0:s.workspaceExpandInfoMap,this._onDidWorkspaceExpandInfoMapChange.fire())}))}get available(){return this._available}get workspaceList(){return(0,c.Y2)(this._accountService.hasLogin,"workspace list is undefined"),this._workspaceList}initialize(){return new Promise((e=>{this._available&&e();try{if("undefined"!=typeof window){var t,r;if(this._workspaceList=null===(t=JSON.parse(window.__userWorkspaces))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.workspace_infos,null===(r=this._workspaceList)||void 0===r||!r.length)throw new Error("invalid value");this._available=!0,this._onDidWorkspaceChange.fire(this._workspaceList)}e()}catch(o){this._userService.onDidWorkspaceChange((t=>{if(null==t||!t.length)throw new Error("invalid value");this._workspaceList=t,this._available=!0,this._onDidWorkspaceChange.fire(this._workspaceList),e()}))}}))}get workspaceExpandInfoMap(){return this._workspaceExpandInfoMap}getWorkspace(e){return this.workspaceList.find((t=>t.workspace_id===e))}triggerWorkspaceListChange(e){this._userService.dangerUsedUserMachineService.send({type:"NOTIFY_WORKSPACE_CHANGE",notifyData:e})}refreshWorkspaceList(){this._userService.dangerUsedUserMachineService.send("REFRESH_WORKSPACE_LIST")}refreshUserSpace(){this._userService.dangerUsedUserMachineService.send("REFRESH_USER_SPACE")}};p=d([h(0,i.S),h(1,u.D),f("design:paramtypes",["function"==typeof(o=void 0!==i.S&&i.S)?o:Object,"function"==typeof(n=void 0!==u.D&&u.D)?n:Object])],p)},93343:(e,t,r)=>{r.d(t,{NG:()=>n});var o=r(98141);function n(){return function(e=!0){return(t,r)=>{var n;const i=(0,o.yH)(t,r)||{writable:!0,configurable:!0};return i.enumerable=e,Object.defineProperty(null!==(n=null==t?void 0:t.prototype)&&void 0!==n?n:t,r,i),i}}(!1)}},46796:(e,t,r)=>{r.d(t,{t:()=>s});var o=r(9541),n=r(98141),i=r(14567);function s(e){return function(t,r,s){if("number"!=typeof s){if(void 0===s&&(s=(0,n.yH)(t,r)),void 0===s)return e&&o.S.setType(t,r,e),{get:()=>i.A.invokeGetter(t,r)};const a=s.value;return s.value=function(e=new Map){return e instanceof Map||(e=new Map),i.A.invokeMethod(a.bind(this),{target:t,methodName:r,locals:e})},s.value.$injected=!0,s}if(e){const n=o.S.getParamTypes(t,r);n[s]=e,o.S.setParamTypes(t,r,n)}}}},14567:(e,t,r)=>{r.d(t,{A:()=>f});var o=r(20528),n=r(98141),i=r(9541),s=r(26569),a=r(16890);class c extends a.z{setCallback(e,t){this.get(e)||this.set(e,[]);const r=this.get(e);null==r||r.push(t)}}const l=new c;var u;const d="No matching bindings found for target, Did you forget @inject for interface?";class f extends o.mB{static has(e){var t,r;const n=null!==(t=this.aliases.get(e))&&void 0!==t?t:e;return(null===(r=this.container)||void 0===r?void 0:r.has(n))||o.ll.has(n)}static alias(e,t){this.aliases.set(e,(0,n.ll)(t));const r=o.ll.get((0,n.ll)(t));r?this.container&&this.container.set(e,r):console.error("cannot find alias's corresponding provider in ProviderRegistry")}static construct(e){var t;const r=null!==(t=this.aliases.get(e))&&void 0!==t?t:e,n=o.ll.get(r);return this.invoke(n.useClass)}static override(e,t){var r;const n=null!==(r=this.aliases.get(e))&&void 0!==r?r:e,i=o.ll.get(n);i?i.overridable?(i.useClass=t,i.instance=void 0):console.warn("Original class cannot be overrided"):console.error("Original class has not been registered")}static hasClass(e){var t;const r=null!==(t=this.aliases.get(e))&&void 0!==t?t:e;return!!o.ll.get(r)}static getClass(e){var t;const r=null!==(t=this.aliases.get(e))&&void 0!==t?t:e;return o.ll.get(r).useClass}static invokable(e){this.container&&this.container.invokable(e)}static emit(e,...t){const r=[];return o.ll.forEach((o=>{if(!o.instance)return;const n=f.get(o.provide);if(n&&e in n)try{r.push(n[e](...t))}catch(i){console.error(i)}})),Promise.all(r)}static emitOn(e,t,...r){const n=[];let i=o.ll,a=e=>!0;return t instanceof s.B?i=t:a=t,i.forEach(((t,o)=>{if(!a(t))return;if(!t.instance)return;const i=f.get(o);if(i instanceof t.useClass&&i&&e in i)try{n.push(i[e](...r))}catch(s){console.error(s)}})),Promise.all(n)}static emitAt(e,t,...r){const o=f.get(t);if(o&&e in o)try{return new Promise((t=>{t(o[e](...r))}))}catch(n){console.error(n)}return Promise.resolve(null)}static buildRegistry(e,t=(e=>void 0===e.instance)){return e.forEach((e=>{t(e)&&(e.instance=f.invoke(e.useClass),this.container&&this.container.set(e.provide,e))})),e}static service(...e){const t=e[e.length-1],r=e[e.length-2];let o=r;3===e.length&&([o]=e),f.set({overridable:!1,...t,singleton:!0,provide:o,useClass:r})}static bind(e,t){const r=o.ll.get(t);if(!r)throw new Error("target should be injectable");if(r.instance)throw new Error("target has been instantiated");let n=o.ll.get(e);if(n||(f.set({provide:e,useClass:t,overridable:!0}),n=o.ll.get(e)||o.ll.get(t)),n.instance)throw new Error("token's target has been instantiated");if(!n.overridable&&this.container)throw new Error("containerized requires provider be overridable in order to bind");return n.useClass=t,this.container&&this.container.set(e,n),this}static addPostConstructor(e,t){}static invoke(e,t=new Map,r){r||(r=i.S.getParamTypes(e));return new e(...this.getServices(t,r,e))}static invokeMethod(e,t){let r,o,n,s=new Map;if(t instanceof Array?r=t:(r=t.designParamTypes,o=t.target,n=t.methodName,t.locals&&(s=t.locals)),s instanceof Map||(s=new Map),e.$injected)return e.call(o,s);r||(r=i.S.getParamTypes(o,n));return e(...this.getServices(s,r))}static invokeGetter(e,t){const r=i.S.getType(e,t);if(this.has(r))return this.get(r)}static set(e,t){let r;void 0===e.provide?(r=e,e={provide:r,useClass:r,instance:t}):r=e.provide;const n=e.useClass;return o.ll.merge(n,e),this.container&&this.container.set(n,e),n&&r!==n&&this.alias(r,n),f}static get(e){var t;const r=null!==(t=this.aliases.get(e))&&void 0!==t?t:e,n=o.ll.get(r);if(!this.has(e))throw new Error(`${d}:${String(e)}`);let i=null==n?void 0:n.instance;return i||(this.container?(i=this.container.get(r),n&&(n.instance=i),i):n?(n.instance=f.invoke(n.useClass),f.runPostConstructors(e,n),i=n.instance,i):i)}static getServices(e,t,r){return t.map(((t,o)=>{const i="function"==typeof t?(0,n.FM)(t):t;if(e.has(i))return e.get(i);if(e.has(t))return e.get(t);if(this.has(t))return this.get(t);if(r)throw new Error(`${d}, the ${o} param requested by${String(r)} `)}))}static runPostConstructors(e,t){const r=l.get(e);r&&r.forEach((r=>{try{r(t.instance)}catch(s){console.error((o=t.useClass,n=e,i=s.message,`postConstruct error in class ${o.name}, with key ${String(n)}:${i} `)),console.error(s)}var o,n,i}))}invoke(e,t=new Map,r){return f.invoke(e,t,r)}invokeMethod(e,t){return f.invokeMethod(e,t)}invokeGetter(e,t){return f.invokeGetter(e,t)}get(e){return f.get(e)}set(e,t){return f.set(t),this}has(e){return f.has(e)}construct(e){return f.construct(e)}override(e,t){f.override(e,t)}emit(e,...t){return f.emit(e,...t)}emitOn(e,t,...r){return f.emitOn(e,t,...r)}emitAt(e,t,...r){return f.emitAt(e,t,...r)}}(u=f).container=null,u.aliases=new Map,u.factory=(e,t)=>u.set({provide:e,useClass:(0,n.ll)(t),instance:t,singleton:!0}),f.factory(f,new f)},13250:(e,t,r)=>{r.d(t,{L:()=>i});var o=r(42058),n=r(14567);class i{constructor(){this.outerContainer=null}invoke(e){if(!this.outerContainer)throw new Error("It's not set outerContainer before invoke services, please check your logic");return this.outerContainer.createInstance(e)}setOuterInstantiationService(e){this.outerContainer=e}invokeFunction(e,...t){(0,o.Y2)(this.outerContainer,"It's not set outerContainer before invoke services, please check your logic"),this.outerContainer.invokeFunction(e,...t)}}n.A.factory(i,new i)},9541:(e,t,r)=>{r.d(t,{S:()=>a,h:()=>n});var o,n,i=r(98141);!function(e){e.WORKBENCH_SETTINGS="workbench:settings",e.DESIGN_PARAM_TYPES="design:paramtypes",e.DESIGN_TYPE="design:type",e.DESIGN_RETURN_TYPE="design:returntype"}(n||(n={}));const s=new Map;class a{static set(e,t,r,o){const n=s.has(e)?s.get(e):[],a=(0,i.ll)(r);-1===n.indexOf(a)&&(n.push(a),s.set(e,n)),Reflect.defineMetadata(e,t,(0,i.ll)(r),o)}static getParamTypes(e,t){var r;return null!==(r=Reflect.getMetadata(n.DESIGN_PARAM_TYPES,e,t))&&void 0!==r?r:[]}static setParamTypes(e,t,r){return this.set(n.DESIGN_PARAM_TYPES,r,(0,i.ll)(e).prototype,t)}static getOwn(e,t,r){return Reflect.getOwnMetadata(e,(0,i.ll)(t),r)}static hasOwn(e,t,r){return Reflect.hasOwnMetadata(e,(0,i.ll)(t),r)}}(o=a).get=(e,t,r)=>Reflect.getMetadata(e,(0,i.ll)(t),r),o.getType=(e,t)=>Reflect.getMetadata(n.DESIGN_TYPE,e,t),o.setType=(e,t,r)=>Reflect.defineMetadata(n.DESIGN_TYPE,r,e,t),o.getReturnType=(e,t)=>Reflect.getMetadata(n.DESIGN_RETURN_TYPE,e,t),o.has=(e,t,r)=>Reflect.hasMetadata(e,(0,i.ll)(t),r),o.getTargetsFromPropertyKey=e=>s.has(e)?s.get(e):[]},16890:(e,t,r)=>{r.d(t,{z:()=>o});class o{constructor(){this.map=new Map}get size(){return this.map.size}get(e){return this.map.get(e)}has(e){return this.map.has(e)}set(e,t){return this.map.set(e,t),this}delete(e){return this.map.delete(e)}forEach(e,t){return this.map.forEach(e)}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}clear(){return this.map.clear()}}},47570:(e,t,r)=>{r.d(t,{b:()=>o});class o{constructor(e){this.registry=e,this.forEach=(e,t)=>this.registry.forEach(e,t)}get size(){return this.registry.size}get(e){return this.registry.get(e)}set(e,t){return this.registry.merge(e,t),this}has(e){return this.registry.has(e)}}},26569:(e,t,r)=>{r.d(t,{B:()=>i});var o=r(98141),n=r(16890);class i extends n.z{constructor(e){super(),this.klass=(0,o.ll)(e)}createIfNotExists(e){if(!this.has(e)){const t=new this.klass(e);this.set(e,t)}return this.get(e)}merge(e,t){const r=this.createIfNotExists(e);Object.keys(t).forEach((e=>{r[e]=t[e]})),this.set(e,r)}get(e){return this.map.get((0,o.Ue)(e))}has(e){return this.map.has((0,o.Ue)(e))}set(e,t){return this.map.set((0,o.Ue)(e),t),this}delete(e){return this.map.delete((0,o.Ue)(e))}}},27046:(e,t,r)=>{r.d(t,{w:()=>y});var o,n,i=r(93343),s=r(9541),a=r(70429),c=r(44122),l=r(98141),u=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class f{constructor(e,t,r){this.rawTarget=e,this.rawPropertyKey=t,"number"==typeof r&&(this.paramIndex=r),this.target=e}get index(){return this.paramIndex}get target(){return(0,l.ll)(this.rawTarget)}set target(e){this.setTarget(e)}get targetName(){return(0,l.FM)(this.target)}get propertyKey(){return this.rawPropertyKey}get typeName(){return(0,l.FM)(this.rawType)}get type(){return this.rawType}set type(e){this.rawType=e}get collectionName(){return this.collectionType?(0,l.FM)(this.collectionType):""}setTarget(e){let t;this.rawTarget=e,t="number"==typeof this.paramIndex?s.S.getParamTypes(this.rawTarget,this.rawPropertyKey)[this.paramIndex]:s.S.getType(this.rawTarget,this.rawPropertyKey),(0,c.uZ)(t)?(this.collectionType=t,this.rawType=Object):this.rawType=t,this.name=(0,l.FM)(this.rawPropertyKey)}}u([(0,i.NG)(),d("design:type","function"==typeof(o=void 0!==a.f&&a.f)?o:Object)],f.prototype,"collectionType",void 0),u([(0,i.NG)(),d("design:type",String)],f.prototype,"name",void 0),u([(0,i.NG)(),d("design:type","function"==typeof(n=void 0!==a.f&&a.f)?n:Object)],f.prototype,"rawType",void 0),u([(0,i.NG)(),d("design:type",Number)],f.prototype,"paramIndex",void 0);var h,p=r(65827),v=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class y extends f{constructor(e,t,r){super(e,t,r),this.store=new p.yh([e,t,r])}}v([(0,i.NG)(),g("design:type","function"==typeof(h=void 0!==p.yh&&p.yh)?h:Object)],y.prototype,"store",void 0)},65827:(e,t,r)=>{r.d(t,{yh:()=>a});var o=r(42058),n=r(9541),i=r(98141),s=r(67245);class a{constructor(e){const[t,r,n]=e;this.map=(()=>{switch((0,s.Y)(e)){case"parameter":{const e=this.storeGet("workbench:param:store",t,r);return e.has(`${n}`)||e.set(`${n}`,new Map),e.get(`${n}`)}case"property":return this.storeGet("workbench:property:store",t,r);case"method":return this.storeGet("workbench:method:store",t,r);case"class":return this.storeGet("workbench:class:store",t);default:(0,o.ss)()}})()}static from(...e){return new a(e)}static decorate(e){return(...t)=>{const r=a.from(...t),o=e(r,t);return"function"==typeof o&&o(...t),t[2]}}set(e,t){return this.map.set((0,i.FM)(e),t),this}get(e){return this.map.get((0,i.FM)(e))}clear(){return this.map.clear()}storeGet(e,...t){const r=n.S;return r.has(e,...t)||r.set(e,new Map,...t),r.get(e,...t)}}},60991:(e,t,r)=>{r.d(t,{r:()=>o});const o=new class{debug(e){var t;null===(t=this.use)||void 0===t||t.debug(e),this.write("DEBUG",e)}info(e){var t;null===(t=this.use)||void 0===t||t.info(e),this.write("INFO",e)}warn(e){var t;null===(t=this.use)||void 0===t||t.warn(e),this.write("WARN",e)}error(e){var t;null===(t=this.use)||void 0===t||t.error(e),this.write("ERROR",e)}fatal(e){var t;null===(t=this.use)||void 0===t||t.fatal(e),this.write("FATAL",e)}dateFormat(e){return`${e.getFullYear()}/${`${e.getMonth()+1}`.padStart(2,"0")}/${`${e.getDate()}`.padStart(2,"0")} ${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}:${`${e.getSeconds()}`.padStart(2,"0")}`}write(e,t){if(!this.use){const r=`[${this.dateFormat(new Date)}] [${e}] [Workbench] - ${t}`;switch(e){case"FATAL":case"ERROR":console.error(r);break;case"WARN":console.warn(r);break;default:console.log(r)}}}}},49868:(e,t,r)=>{r.d(t,{K:()=>i});var o=r(65827),n=r(20528);class i extends n.zt{constructor(e){super(e),this._store=o.yh.from(e)}get store(){return this._store}get useClass(){return this._useClass||this.provide}set useClass(e){this._store=o.yh.from(e),this._useClass=e}}},20528:(e,t,r)=>{r.d(t,{ll:()=>f,mB:()=>h,zt:()=>d});var o,n=r(70429),i=r(26569),s=r(47570),a=r(98141),c=r(93343),l=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class d{constructor(e){this.provide=e,this._useClass=(0,a.ll)(e),this.overridable=!1}get className(){return(0,a.FM)(this.provide)}get useClass(){return this._useClass}set useClass(e){this._useClass=e}}l([(0,c.NG)(),u("design:type",Object)],d.prototype,"provide",void 0),l([(0,c.NG)(),u("design:type",Object)],d.prototype,"instance",void 0),l([(0,c.NG)(),u("design:type",String)],d.prototype,"type",void 0),l([(0,c.NG)(),u("design:type",Boolean)],d.prototype,"singleton",void 0),l([(0,c.NG)(),u("design:type",Boolean)],d.prototype,"supportDeferInvoke",void 0),l([(0,c.NG)(),u("design:type",Boolean)],d.prototype,"overridable",void 0),l([(0,c.NG)(),u("design:type","function"==typeof(o=void 0!==n.f&&n.f)?o:Object)],d.prototype,"_useClass",void 0);const f=new i.B(d);class h extends s.b{constructor(){super(f)}}},70429:(e,t,r)=>{r.d(t,{f:()=>o});const o=Function},44122:(e,t,r)=>{function o(e){return e===Array||Array.isArray(e)}function n(e){return o(e)||e===Map||e instanceof Map||e===Set||e instanceof Set||e===WeakMap||e instanceof WeakMap||e===WeakSet||e instanceof WeakSet}function i(e){return function(e){return"string"==typeof e||e instanceof String||e===String}(e)||function(e){return"number"==typeof e||e instanceof Number||e===Number}(e)||function(e){return"boolean"==typeof e||e instanceof Boolean||e===Boolean}(e)}r.d(t,{Lc:()=>o,Qz:()=>i,uZ:()=>n})},98141:(e,t,r)=>{r.d(t,{FM:()=>a,Ue:()=>i,ll:()=>n,o0:()=>l,tr:()=>s,yH:()=>c});var o=r(44122);function n(e){return e.prototype?e:e.constructor}function i(e){return"symbol"==typeof e?e:n(e)}const s=e=>{var t;return"function"==typeof e?null!==(t=e.displayName)&&void 0!==t?t:e.name:s(e.constructor)},a=e=>{switch(typeof e){default:return`${e}`;case"symbol":return e.toString().replace("Symbol(","").replace(")","");case"function":return s(e)}};function c(e,t){var r;return Object.getOwnPropertyDescriptor(null!==(r=null==e?void 0:e.prototype)&&void 0!==r?r:e,t)}function l(e,t,r={}){if(null==t)return t;if((0,o.Qz)(t)||"symbol"==typeof t||"function"==typeof t)return t;e=(0,o.Lc)(t)?e||[]:e||{};const n=r.default?r.default:(e,t)=>(e.push(t),e),i=(r,n)=>{(0,o.Lc)(t)?e.push(n):e[r]=n};return Object.keys(t).forEach((s=>{let a=t[s];if(null!=a&&(""!==a||""===e[s])){if(!(0,o.Qz)(a)&&"function"!=typeof a)return(0,o.Lc)(a)?(a=a.map((e=>l(void 0,e))),void i(s,[].concat(e[s]||[],a).reduce(((e,t)=>r[s]?r[s](e,t):n(e,a)),[]))):void((0,o.Lc)(t)?i(s,l(void 0,a,r)):i(s,l(e[s],a,r)));i(s,a)}})),(0,o.Lc)(e)&&e.reduce(((e,t)=>n(e,t)),[]),e}},67245:(e,t,r)=>{function o(e){const[,t,r]=e;return"number"==typeof r?"parameter":t&&void 0===r||r&&(r.get||r.set)?"property":null!=r&&r.value?"method":"class"}r.d(t,{Y:()=>o})},23439:(e,t,r)=>{r.d(t,{k:()=>o});class o{constructor(){this._initialLeft=0,this._initialTop=0,this._width=0,this._height=0,this._translateX=0,this._translateY=0}get initialLeft(){return this._initialLeft}get initialTop(){return this._initialTop}get left(){return this._initialLeft+this.translateX}get top(){return this._initialTop+this.translateY}get width(){return this._width}get height(){return this._height}get initialRight(){return window.innerWidth-this._initialLeft-this._width}get initialBottom(){return window.innerHeight-this._initialTop-this._height}get translateX(){return this._translateX}get translateY(){return this._translateY}reset(){this._initialLeft=0,this._initialTop=0,this._width=0,this._height=0,this._translateX=0,this._translateY=0}setPosition(e,t){this._initialLeft=e,this._initialTop=t}setSize(e,t){this._width=e,this._height=t}setTranslate(e,t){this._translateX=e,this._translateY=t}}},59699:(e,t,r)=>{r.d(t,{AH:()=>i,Bn:()=>d,KR:()=>a,Ue:()=>c,ZT:()=>l,dd:()=>s,ex:()=>n,jt:()=>u,qk:()=>o});const o=76,n=56,i=8,s=6,a=8,c=8,l=10,u=window.innerWidth>1440?268:242,d=48},55360:(e,t,r)=>{r.d(t,{q:()=>v});var o=r(18571),n=r(95291),i=r(12404),s=r.n(i);class a{constructor(e,t){this.options=t,this._rect=e}get left(){var e,t;return-1*this._rect.initialLeft+(null!==(e=null===(t=this.options)||void 0===t?void 0:t.left)&&void 0!==e?e:0)}get right(){return window.innerWidth-(this._rect.initialLeft+this._rect.width/2)}get top(){var e,t;return-1*this._rect.initialTop+(null!==(e=null===(t=this.options)||void 0===t?void 0:t.top)&&void 0!==e?e:0)}get bottom(){var e,t;return window.innerHeight-(this._rect.initialTop+(null!==(e=null===(t=this.options)||void 0===t?void 0:t.bottom)&&void 0!==e?e:0))}}var c=r(71037),l=r(59699),u=r(23439),d=r(22169);var f=r(72322);const h=e=>{const{children:t}=e;return(0,n.createPortal)(t,e.containerRef.current)};function p(e){if(!e)return 0;return e.getBoundingClientRect().x}const v=(0,o.memo)((e=>{var t,n,i,v;const{uniqueId:g,content:y,draggerHandlerSelection:m,containerRef:_,popupContainerRef:b,boundOffset:R,defaultPosition:w,isPinned:S=!1,onClose:k,onDragEnd:T}=e,C=(0,o.useRef)(null!==(t=null==b?void 0:b.current)&&void 0!==t?t:r.g.document.body),j=(0,o.useRef)(null),P=(({panelBoxRef:e})=>{const t=(0,o.useRef)(new u.k);return(0,o.useEffect)((()=>{if(!e.current)return;const r=e.current.getBoundingClientRect();t.current.setSize(r.width,r.height),t.current.setPosition(r.left,r.top)}),[]),(0,o.useEffect)((()=>{const r=e.current;if(!r)return;const o=new ResizeObserver((0,d.debounce)((()=>{const e=r.getBoundingClientRect();t.current.setSize(e.width,e.height)}),100));return o.observe(r),()=>{o.disconnect()}}),[]),t.current})({panelBoxRef:j}),O=(0,o.useRef)(new a(P,R)),M=(0,o.useRef)(!1),I=(0,o.useReducer)((e=>!e),!0)[1],x=(0,o.useCallback)((()=>{let e=!1;if(M.current)P.left+P.width/2>window.innerWidth&&(P.setTranslate(window.innerWidth-P.initialLeft-P.width/2,P.translateY),e=!0);else{var t;const r=null!==(t=null==w?void 0:w.right)&&void 0!==t?t:0,o=window.innerWidth-r;P.left!==o&&(P.setTranslate(window.innerWidth-P.initialLeft-r,P.translateY),e=!0)}P.top+l.ZT>window.innerHeight&&(P.setTranslate(P.translateX,window.innerHeight-P.initialTop-l.ZT),e=!0),e&&I()}),[]);(0,o.useEffect)((()=>{if(!S)return j.current?(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}):()=>{}}),[x,S]);const E=(0,o.useCallback)(((e,t)=>{M.current=!0}),[]);return(0,c.Z)(C,(()=>{null==k||k()})),(0,o.useEffect)((()=>{}),[g]),(0,f.jsx)(h,{containerRef:C,children:S?(0,f.jsx)("div",{ref:j,className:"panel-portal-container",style:{left:l.ex+l.AH+l.dd+p(_.current),top:null!==(n=null==w?void 0:w.top)&&void 0!==n?n:0},children:y}):(0,f.jsx)(s(),{bounds:O.current,onStart:E,onStop:(e,t)=>{P.setTranslate(t.x,t.y),I(),null==T||T()},position:{x:P.translateX,y:P.translateY},handle:m,children:(0,f.jsx)("div",{ref:j,className:"panel-portal-container",style:{left:null!==(i=null==w?void 0:w.left)&&void 0!==i?i:0,top:null!==(v=null==w?void 0:w.top)&&void 0!==v?v:0},children:y})})})}))},71037:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(18571);const n=["mousedown","touchstart"],i=(e,t,r=n)=>{const i=(0,o.useRef)(t);(0,o.useEffect)((()=>{i.current=t}),[t]),(0,o.useEffect)((()=>{if(!e)return;const t=t=>{const{current:r}=e;r&&!r.contains(t.target)&&i.current(t)};for(const e of r)document.addEventListener(e,t);return()=>{for(const e of r)document.removeEventListener(e,t)}}),[r,e])}},54549:(e,t,r)=>{r.d(t,{Y:()=>i});var o=r(18571),n=r(18823);function i(e){const t=(0,o.useContext)(n.FN);if(t.injectorService)return t.injectorService.get(e)}},19127:(e,t,r)=>{r.d(t,{a:()=>l});r(18571);var o=r(5789),n=r.n(o),i=r(23224),s=r(22169),a=r(11071),c=(r(15950),r(72322));const l=({data:e})=>{var t;const r=(0,a.k)(null==e?void 0:e.isActive,!1),o=(0,a.k)(null==e?void 0:e.isDisable,!1);let l;"function"==typeof(null==e?void 0:e.tooltips)?l=(0,a.k)(null==e?void 0:e.tooltips(),void 0):"object"==typeof(null==e?void 0:e.tooltips)&&(l=(0,c.jsxs)("div",{className:"wb-icon-btn-tooltips-content",children:[(0,c.jsx)("span",{children:e.tooltips.content()}),e.tooltips.subContent?(0,c.jsx)("span",{className:"content-tips",children:e.tooltips.subContent()}):null]}));const u=(0,s.merge)({className:"wb-icon-btn-tooltips",position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:l},null!==(t=e.tooltipProps)&&void 0!==t?t:{}),d=(0,c.jsx)("div",{className:n()("title-bar-icon-btn",{active:r,disable:o}),onClick:()=>{var t;return null===(t=e.onClick)||void 0===t?void 0:t.call(e)},children:r?e.activeIcon:e.icon});return l?(0,c.jsx)(i.Z,{...u,children:d}):d}},35518:(e,t,r)=>{r.d(t,{_:()=>$,u:()=>K});var o,n,i,s,a,c,l=r(18571),u=r(5789),d=r.n(u),f=r(92643),h=r(35805),p=r(23439),v=r(11071),g=r(35408),y=r(54549),m=r(41308),_=r(14906),b=r(55360),R=r(59699),w=r(13520),S=r(27175),k=r(77349);function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},T.apply(this,arguments)}const C=e=>l.createElement("svg",T({xmlns:"http://www.w3.org/2000/svg",width:106,height:79,fill:"none",viewBox:"0 0 106 79"},e),o||(o=l.createElement("rect",{width:106,height:20,fill:"#E5ECFF",fillOpacity:.14,rx:4})),n||(n=l.createElement("path",{fill:"url(#placeholder-dark_svg__a)",fillOpacity:.2,stroke:"#00CAE0",d:"M.5 30A3.5 3.5 0 0 1 4 26.5h58.545a3.5 3.5 0 0 1 3.5 3.5v20a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 50V30Z"})),i||(i=l.createElement("path",{fill:"#E5ECFF",fillOpacity:.14,d:"M72.545 30a4 4 0 0 1 4-4h25.217a4 4 0 0 1 4 4v20a4 4 0 0 1-4 4H76.545a4 4 0 0 1-4-4V30Z"})),s||(s=l.createElement("rect",{width:106,height:20,y:59,fill:"#E5ECFF",fillOpacity:.14,rx:4})),a||(a=l.createElement("path",{fill:"#327B83",stroke:"#00CAE0",strokeWidth:2,d:"M50.888 46.418c-.521-1.564.966-3.051 2.53-2.53l23.415 7.805c1.704.568 1.853 2.92.235 3.7l-8.645 4.162a4 4 0 0 0-1.868 1.868l-4.163 8.645c-.779 1.618-3.131 1.469-3.7-.235l-7.804-23.415Z"})),c||(c=l.createElement("defs",null,l.createElement("radialGradient",{id:"placeholder-dark_svg__a",cx:0,cy:0,r:1,gradientTransform:"matrix(-51.54165 -17.982 42.7364 -122.49502 51.542 43.982)",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#48DAEA",stopOpacity:.69}),l.createElement("stop",{offset:.417,stopColor:"#00CAE0"})))));var j,P,O,M,I,x;function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},E.apply(this,arguments)}const D=e=>l.createElement("svg",E({xmlns:"http://www.w3.org/2000/svg",width:106,height:79,fill:"none",viewBox:"0 0 106 79"},e),j||(j=l.createElement("rect",{width:106,height:20,fill:"#456C80",fillOpacity:.12,rx:4})),P||(P=l.createElement("path",{fill:"url(#placeholder-light_svg__a)",fillOpacity:.2,stroke:"#00CAE0",d:"M.5 30A3.5 3.5 0 0 1 4 26.5h58.545a3.5 3.5 0 0 1 3.5 3.5v20a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 50V30Z"})),O||(O=l.createElement("path",{fill:"#456C80",fillOpacity:.12,d:"M72.545 30a4 4 0 0 1 4-4h25.217a4 4 0 0 1 4 4v20a4 4 0 0 1-4 4H76.545a4 4 0 0 1-4-4V30Z"})),M||(M=l.createElement("rect",{width:106,height:20,y:59,fill:"#456C80",fillOpacity:.12,rx:4})),I||(I=l.createElement("path",{fill:"#86D7E0",stroke:"#00CAE0",strokeWidth:2,d:"M50.888 46.418c-.521-1.564.966-3.051 2.53-2.53l23.415 7.805c1.704.568 1.853 2.92.235 3.7l-8.645 4.162a4 4 0 0 0-1.868 1.868l-4.163 8.645c-.779 1.618-3.131 1.469-3.7-.235l-7.804-23.415Z"})),x||(x=l.createElement("defs",null,l.createElement("radialGradient",{id:"placeholder-light_svg__a",cx:0,cy:0,r:1,gradientTransform:"matrix(-51.54165 -17.982 42.7364 -122.49502 51.542 43.982)",gradientUnits:"userSpaceOnUse"},l.createElement("stop",{stopColor:"#48DAEA",stopOpacity:.69}),l.createElement("stop",{offset:.417,stopColor:"#00CAE0"})))));var A=r(72322);const B=[{fakeIcon:(0,A.jsx)(w.eIr,{fontSize:20}),titleI18nKey:"basic_web",get title(){return S.oc.t("basic_web",{},"\u57fa\u7840")}},{fakeIcon:(0,A.jsx)(w.tjt,{fontSize:20}),titleI18nKey:"background_web",get title(){return S.oc.t("background_web",{},"Background")}},{fakeIcon:(0,A.jsx)(m.dk,{fontSize:20}),titleI18nKey:"web_retouch_text_smart_tools",get title(){return S.oc.t("web_retouch_text_smart_tools",{},"Smart tools")}},{fakeIcon:(0,A.jsx)(w.GCV,{fontSize:20}),titleI18nKey:"audio_web",get title(){return S.oc.t("audio_web",{},"Audio")}},{fakeIcon:(0,A.jsx)(w._SE,{fontSize:20}),titleI18nKey:"web_materialSearch_text_motion",get title(){return S.oc.t("web_materialSearch_text_motion",{},"Motion")}},{fakeIcon:(0,A.jsx)(w.fDY,{fontSize:20}),titleI18nKey:"speed_web",get title(){return S.oc.t("speed_web",{},"Speed")}}];function U({onClose:e}){const[t]=(0,k.Fg)(),r="dark"===t;return(0,A.jsxs)("div",{className:"attribute-view-fixed-panel attribute-view-fixed-panel-empty",children:[(0,A.jsx)("div",{className:"attribute-panel-header",children:(0,A.jsx)("div",{className:"attribute-panel-header-close",onMouseDown:e=>{e.stopPropagation()},onClick:e,children:(0,A.jsx)(w.x8P,{fontSize:16})})}),(0,A.jsxs)("div",{className:"content",children:[r?(0,A.jsx)(C,{}):(0,A.jsx)(D,{}),(0,A.jsx)("div",{className:"text","data-ssr-i18n-key":"web_attribution_panel_text_select_item","data-ssr-i18n-value":S.oc.t("web_attribution_panel_text_select_item",{},"Select an item to adjust attribution here"),children:S.oc.t("web_attribution_panel_text_select_item",{},"Select an item to adjust attribution here")})]})]})}const N=({type:e,data:t,titleBarHeight:r,boundingBox:o,containerRef:n,isFixedMode:i,disabled:s=!1})=>{const a=(0,y.Y)(g.Mp.ToolBar),c="tool-bar-panel-title",u=(0,v.k)(t.title,null),f=(0,l.useMemo)((()=>{const e=document.createElement("div");return e.className="attribute-panel-wrapper",e.id="attribute-panel-wrapper",document.body.appendChild(e),e}),[]),h=(0,l.useRef)(f);(0,l.useEffect)((()=>()=>{f.remove()}),[]);const p=()=>{"unpin"===e&&o.reset(),null==a||a.unActiveToolBarByName(t.name)};(0,l.useEffect)((()=>{const e=document.getElementById("editor-content-center");let t=null;return e&&i&&(t=new ResizeObserver((()=>{e.getBoundingClientRect()})),t.observe(e)),()=>{var e;null===(e=t)||void 0===e||e.disconnect()}}),[i]);const w=(0,l.useRef)({left:window.innerWidth-R.ex-R.jt-R.AH-R.dd,top:R.Ue+r,right:R.jt+R.ex+R.AH+R.dd}),S=()=>(0,A.jsxs)("div",{className:d()("tool-bar-panel-container",{draggable:t.draggable}),children:[null!==u?(0,A.jsxs)("div",{className:d()(c),children:[(0,A.jsx)("div",{className:"title-left",children:(0,v.k)(t.title,null)}),t.draggable&&(0,A.jsx)(_.zsX,{size:20,className:"tool-bar-panel-draggable-icon"}),(0,A.jsx)("div",{className:"tool-bar-panel-header-close",onMouseDown:e=>{e.stopPropagation()},onClick:p,children:(0,A.jsx)(m.bMz,{fontSize:16})})]}):null,(0,v.k)(t.content,null)]});return(0,A.jsx)(A.Fragment,{children:i?(0,A.jsx)("div",{className:"attribute-view-fixed-panel",children:s?(0,A.jsx)(U,{}):S()}):(0,A.jsx)(b.q,{uniqueId:t.name,draggerHandlerSelection:`.${c}`,containerRef:n,popupContainerRef:h,isPinned:"pin"===e,onClose:"pin"===e?p:void 0,content:S(),onDragEnd:t.onDragEnd,defaultPosition:w.current,boundOffset:{left:R.qk,top:R.KR+r,bottom:R.Bn}})})};var F=r(23224);const L=e=>{const t=e.querySelector(".tool-bar-title");return!!t&&Boolean(t&&t.scrollWidth>t.clientWidth)},W=({active:e,data:t})=>{var r,o,n;const i=(0,y.Y)(g.Mp.ToolBar),s=(0,v.k)(t.tooltips,void 0),a=(0,v.k)(t.content,void 0);return(0,A.jsx)(F.Z,{position:"bottom",content:null!==(r=null!=s?s:null===(o=t.title)||void 0===o?void 0:o.call(t))&&void 0!==r?r:"",checkOverflow:!s&&L,triggerProps:{mouseEnterDelay:300},children:(0,A.jsx)("div",{className:d()(["workbench-tool-bar","pin-tool-bar",(0,v.k)(t.className,""),{active:e}]),onMouseDown:e=>{e.stopPropagation()},onClick:r=>{var o;null===(o=t.onClick)||void 0===o||o.call(t),e?null==i||i.unActiveToolBarByName(t.name):null==i||i.activeToolBarByName(t.name)},children:a||(0,A.jsxs)(A.Fragment,{children:[t.icon&&(0,A.jsxs)("div",{className:"tool-bar-icon",children:[(null===(n=t.dot)||void 0===n?void 0:n.call(t))&&(0,A.jsx)("div",{className:"tool-bar-dot"}),t.icon()]}),t.title&&(0,A.jsx)("p",{className:"tool-bar-title",children:t.title()})]})},t.name)},t.name)};var $,G=r(63439),V=r(77411);!function(e){e.FIXED="fixed",e.FLOAT="float"}($||($={}));const K=(0,f.x)([G.R.TitleBar,h.j.WorkbenchToolBar,h.j.WorkbenchToolBarPanel,G.R.ToolBar])((({containerRef:e,...t})=>{var r;const o=t[h.j.WorkbenchToolBar],n=t[G.R.TitleBar],i=t[h.j.WorkbenchToolBarPanel],s=(0,l.useRef)([]),{enableFixedMode:a,panelMode:c}=null!==(r=t[G.R.ToolBar])&&void 0!==r?r:{},u=c===$.FIXED,[f,m]=(0,l.useState)(!1),_=(0,y.Y)(g.Mp.ToolBar),b=(0,l.useRef)(new p.k),R=!o.showUnPinToolBar,{isManualOpenPanel:w}=o,S=(0,l.useMemo)((()=>{if(!i)return;const e=[...o.pin,...o.unpin],{activePanels:t,panelItems:r}=i;return null==t?void 0:t.map((t=>({type:e.find((e=>e.name===t)).type,panel:r.get(t)})))}),[i]),k=(null==S?void 0:S.length)&&u,T=R&&w&&u;(0,l.useLayoutEffect)((()=>{null!=S&&S.find((e=>"unpin"===e.type))||b.current.reset(),null!=S&&S.length&&m(!0)}),[S]);const C=e=>{const t=o.activePinBarName===e.name,r=o.activeUnPinBarName===e.name;return t||r||(0,v.k)(e.isActive,!1)};(0,l.useEffect)((()=>{o.showUnPinToolBar&&(s.current=o.unpin)}),[o]);const j=o.showUnPinToolBar?o.unpin:s.current,P=e=>e.map((e=>(0,A.jsxs)(l.Fragment,{children:[e.appendDividerBefore?(0,A.jsx)("div",{className:"tool-bar-divider"}):null,(0,A.jsx)(W,{active:C(e),data:e},e.name)]},e.name))),O=(0,l.useMemo)((()=>null!=S&&S.length?S.map((({type:t,panel:r})=>(0,A.jsx)(N,{titleBarHeight:n.containerHeight,type:t,data:r,boundingBox:b.current,containerRef:e,isFixedMode:u,disabled:R},t))):null),[S,u]);return(0,A.jsxs)("div",{className:d()("workbench-tool-bar-container",{"workbench-tool-bar-container-fix-mode":u}),children:[(0,A.jsx)("div",{className:"workbench-tool-bars-container workbench-pin-tool-container",children:o.pin.length?(0,A.jsx)("div",{className:"workbench-tool-bars",children:P(o.pin)}):null}),(0,A.jsx)("div",{className:d()("workbench-tool-bars-container","workbench-unpin-tool-container",{active:o.showUnPinToolBar}),children:u?(0,A.jsxs)("div",{className:d()("attribute-view-fixed",{"attribute-view-fixed-hidden":!u,"attribute-view-fixed-show-panel":!f||k||T,"attribute-view-disabled":R}),children:[null!=O?O:(0,A.jsx)(U,{onClose:()=>{m(!0),null==_||_.unActiveToolbarPlaceholder()}}),(0,A.jsx)("div",{className:"attribute-view-fixed-menus",children:!R&&j.length?P(j):B.map((e=>(e=>{var t;return(0,A.jsxs)("button",{className:"attribute-view-item attribute-view-item--default",children:[(0,A.jsx)(V.Z,{children:(0,A.jsx)("div",{className:"attribute-item-icon",children:null!==(t=e.fakeIcon)&&void 0!==t?t:null})}),(0,A.jsx)(F.Z,{position:"bottom",content:e.title,checkOverflow:e=>e.scrollWidth>e.clientWidth,className:"attribute-item-tooltip",children:(0,A.jsx)("div",{"data-ssr-i18n-key":e.titleI18nKey,"data-ssr-i18n-value":e.title,className:"attribute-item-text attribute-fontsize-10",children:e.title})})]},e.title)})(e)))})]}):(0,A.jsx)("div",{className:"workbench-tool-bars",children:P(j)})}),!u&&O]})}))},18823:(e,t,r)=>{r.d(t,{FN:()=>p,x9:()=>d});var o=r(18571),n=r(14567);var i,s=r(46796),a=r(91513),c=r(42550),l=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{get store(){return n.A.get(a.O)}get injectorService(){return n.A}controllerInfo(e){const t=e.from+e.name;return{configController:this.trackControllerService.getConfigController(t),callBackController:this.trackControllerService.getConfigController(t)}}};var f;l([(0,s.t)(),u("design:type","function"==typeof(i=void 0!==c.r&&c.r)?i:Object)],d.prototype,"trackControllerService",void 0),d=l([function(e){return n.A.set({provide:e,...f,useClass:e}),e}],d);const h=new d,p=o.createContext(h)},76373:(e,t,r)=>{r.d(t,{t:()=>n});var o=r(14567);function n(e={}){return t=>{const{provide:r,name:n,...i}=e;return n&&(t.displayName=n),r?o.A.service(r,t,{...i,type:"service"}):o.A.service(t,{...i,type:"service"}),o.A.invokable(t),t}}},63568:(e,t,r)=>{r.d(t,{B:()=>o});const o=Symbol("service:start-up")},42944:(e,t,r)=>{r.d(t,{g:()=>Ce});var o,n=r(48018),i=r(14567),s=r(46796),a=r(60991),c=r(43110),l=r(97560),u=r(42520),d=r(21565),f=r(91513),h=r(63439),p=r(76373),v=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let y=class{constructor(e){this.store=e,this.serviceSettingsChange=new d.t,this.store.register(h.e.Services,[]).subscribe(this.serviceSettingsChange)}subscribeToSettingServicesChange(){this.serviceSettingsChange.subscribe((e=>{null==e||e.forEach((e=>i.A.get(e)))}))}};y=v([(0,p.t)(),g("design:paramtypes",["function"==typeof(o=void 0!==f.O&&f.O)?o:Object])],y);var m=r(63568),_=r(62740);const b=Symbol("actionPointInfo"),R=(Symbol("editor"),Symbol("stopAction"));Symbol("uiConfig"),Symbol("workbenchCustomMetadata"),Symbol("actionPointParam"),Symbol("actionPointValue");var w=r(59625),S=r(47900);S.A.set(b,(({context:e,runner:t})=>({...e.controllerInfo(t.point),...t.point}))),S.A.set(R,(({runner:e})=>e.stop.bind(e)));var k=r(22096);var T,C=r(35805),j=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},P=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let O=class{constructor(e){this.store=e}isDisabled(e){var t,r;const o=e.from,n=this.store.getValue(C.j.UIServiceSwitchStatus);return null!==(t=null==n||null===(r=n.get(o))||void 0===r?void 0:r.has(e.name))&&void 0!==t&&t}};O=j([(0,p.t)(),P("design:paramtypes",["function"==typeof(T=void 0!==f.O&&f.O)?T:Object])],O);var M,I=r(84647),x=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let D=class{constructor(e){this.store=e}isDisabled(e){var t,r,o,n;const i=this.store.getValue(C.j.ScopeSwitchStatus);let s=!1;const a=e.configController,c=e.callBackController,l=null!==(t=null===(r=a&&I.p.get(a))||void 0===r?void 0:r.customScope)&&void 0!==t?t:[],u=null!==(o=null===(n=c&&I.p.get(c))||void 0===n?void 0:n.customScope)&&void 0!==o?o:[],d=l.concat(u);return null==d||d.forEach((e=>{null!=i&&i.has(e)&&(s=!0)})),s}};D=x([(0,p.t)(),E("design:paramtypes",["function"==typeof(M=void 0!==f.O&&f.O)?M:Object])],D);class A{constructor(e){this.info=e,this.toggles=[]}registerToggle(e){this.toggles.push(e)}get isOn(){let e=!0;return this.toggles.forEach((t=>{const r=t.isDisabled(this.info);e=e&&!r})),e}}var B,U=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let F=class{constructor(e){this.store=e}isDisabled(e){const t=this.isDisabledByConfigController(e),r=this.isDisabledByCallbackConfigController(e);return t||r}isDisabledByConfigController(e){var t,r,o;const n=e.configController,i=n&&(null===(t=I.p.get(n))||void 0===t?void 0:t.name);return null!==(r=i&&(null===(o=this.store.getValue(C.j.ControllerSwitchStatus))||void 0===o?void 0:o.has(i)))&&void 0!==r&&r}isDisabledByCallbackConfigController(e){var t,r,o,n;const i=e.callBackController,s=i&&((null===(t=I.p.get(i))||void 0===t?void 0:t.name)||(null===(r=I.p.get(i))||void 0===r||null===(r=r.provide)||void 0===r?void 0:r.name));return null!==(o=s&&(null===(n=this.store.getValue(C.j.ControllerSwitchStatus))||void 0===n?void 0:n.has(s)))&&void 0!==o&&o}};F=U([(0,p.t)(),N("design:paramtypes",["function"==typeof(B=void 0!==f.O&&f.O)?B:Object])],F);var L,W,$,G=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},V=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},K=function(e,t){return function(r,o){t(r,o,e)}};let H=class{constructor(e,t,r){this.uiConfigToggle=e,this.scopeToggle=t,this.controllerToggle=r}use(e,t){const r=new A(e);r.registerToggle(this.uiConfigToggle),r.registerToggle(this.scopeToggle),r.registerToggle(this.controllerToggle);const{isOn:o}=r;if(!o&&(t(),"shouldHide"===e.trigger||"shouldDisabled"===e.trigger))return!0}};G([K(0,w.d.decorate(b)),K(1,w.d.decorate(R)),V("design:type",Function),V("design:paramtypes",[Object,Object]),V("design:returntype",void 0)],H.prototype,"use",null),H=G([function(e={}){return function(t){return k.Q.merge(t,e),t}}(),V("design:paramtypes",["function"==typeof(L=void 0!==O&&O)?L:Object,"function"==typeof(W=void 0!==D&&D)?W:Object,"function"==typeof($=void 0!==F&&F)?$:Object])],H);var Y,q,z=r(81860),Z=r(35408),Q=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=class{constructor(e,t){this.serviceCollection=e,this.store=t,this.disabledController=new Set,this.store.register(C.j.ControllerSwitchStatus,this.disabledController)}disableController(e){this.disabledController.add(e),this.store.update(C.j.ControllerSwitchStatus,this.disabledController),this.updateUIService(e)}enableController(e){this.disabledController.delete(e),this.store.update(C.j.ControllerSwitchStatus,this.disabledController),this.updateUIService(e)}updateUIService(e){this.getUIServiceToBeUpdate(e).forEach((e=>{const t=this.serviceCollection.getControllerRelatedUIServices().get(e);t instanceof _.Z&&t.update()}))}getUIServiceToBeUpdate(e){const t=I.p.values();let r=t.next();const o=[];for(;!r.done;){if(r.value.name===e||r.value.provide.name===e){Object.keys(r.value).forEach((e=>{const t=Z.hX[e];o.push(t)}));break}r=t.next()}return o}};X=Q([(0,p.t)({overridable:!0}),J("design:paramtypes",["function"==typeof(Y=void 0!==z.Z&&z.Z)?Y:Object,"function"==typeof(q=void 0!==f.O&&f.O)?q:Object])],X);var ee,te=r(98141),re=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ne=class{constructor(e){this.store=e,this.toggleMap=new Map}toggleUIService(e,t,r){let o=this.toggleMap.get((0,te.tr)(e));o||(o=new Set,this.toggleMap.set((0,te.tr)(e),o)),r?o.delete(t):o.add(t),this.store.has(C.j.UIServiceSwitchStatus)||this.store.register(C.j.UIServiceSwitchStatus,this.toggleMap),this.store.update(C.j.UIServiceSwitchStatus,this.toggleMap),e instanceof _.Z&&e.update()}};ne=re([(0,p.t)({overridable:!0}),oe("design:paramtypes",["function"==typeof(ee=void 0!==f.O&&f.O)?ee:Object])],ne);var ie,se,ae=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let le=class{constructor(e,t){this.serviceCollection=e,this.store=t,this.disabledScopes=new Set,this.store.register(C.j.ScopeSwitchStatus,this.disabledScopes)}disableByScope(e){this.disabledScopes.add(e),this.store.update(C.j.ScopeSwitchStatus,this.disabledScopes),this.updateUIService(e)}enableByScope(e){this.disabledScopes.delete(e),this.store.update(C.j.ScopeSwitchStatus,this.disabledScopes),this.updateUIService(e)}updateUIService(e){this.getUIServiceToBeUpdate(e).forEach((e=>{const t=this.serviceCollection.getControllerRelatedUIServices().get(e);t instanceof _.Z&&t.$forceUpdate()}))}getUIServiceToBeUpdate(e){const t=I.p.values();let r=t.next();const o=new Set;let n;for(;!r.done;){var i,s;n=r.value,null!==(i=n)&&void 0!==i&&i.customScope&&-1!==(null===(s=n)||void 0===s?void 0:s.customScope.indexOf(e))&&this.checkNeedToUpdate(n,o),r=t.next()}return o}checkNeedToUpdate(e,t){return Object.keys(e).forEach((r=>{const o=Z.hX[r];o&&Array.isArray(e[r])&&e[r].length>0&&t.add(o)})),t}};le=ae([(0,p.t)({overridable:!0}),ce("design:paramtypes",["function"==typeof(ie=void 0!==z.Z&&z.Z)?ie:Object,"function"==typeof(se=void 0!==f.O&&f.O)?se:Object])],le);var ue,de,fe,he,pe,ve=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ye=class{constructor(e,t,r,o,n){this.uiServiceCollection=e,this.configControllerService=t,this.middlewareService=r,this.configUIService=o,this.configScopeService=n,this.uiServiceCollection.getControllerRelatedUIServices().forEach(((e,t)=>{e instanceof _.Z&&this.middlewareService.use(H,{on:t,callbackNames:["shouldHide"]}),this.middlewareService.use(H,{on:t,callbackNames:["shouldDisabled"]})}))}turnOffConfig(e,t){this.toggleService(e,t,!1)}turnOnConfig(e,t){this.toggleService(e,t,!0)}turnOffController(e){this.configControllerService.disableController(e)}turnOnController(e){this.configControllerService.enableController(e)}turnOnByScope(e){this.configScopeService.enableByScope(e)}turnOffByScope(e){this.configScopeService.disableByScope(e)}toggleService(e,t,r){const o=this.uiServiceCollection.getControllerRelatedUIServices().get(e);o&&this.configUIService.toggleUIService(o,t,r)}};function me(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function _e(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,be(e,t,"set"),r),r}function be(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}ye=ve([(0,p.t)({overridable:!0}),ge("design:paramtypes",["function"==typeof(ue=void 0!==z.Z&&z.Z)?ue:Object,"function"==typeof(de=void 0!==X&&X)?de:Object,"function"==typeof(fe=void 0!==l.K&&l.K)?fe:Object,"function"==typeof(he=void 0!==ne&&ne)?he:Object,"function"==typeof(pe=void 0!==le&&le)?pe:Object])],ye);var Re,we,Se=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},ke=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Te=new WeakMap;class Ce{constructor(){me(this,Te,{writable:!0,value:void 0}),this.version="0.0.0-PLACEHOLDER",_e(this,Te,new n.G);const e=u.I.getMetadata(this);e&&this.settings.set(e)}callHook(e,...t){var r;const{extensions:o=[]}=null!==(r=this.settings.mount)&&void 0!==r?r:{};return o.forEach((r=>{const o=i.A.get(r);o[e]&&o[e](...t)})),e in this?this[e](...t):"not implemented"}async start(){try{await this.callHook("$onInit"),this.initServices(),this.initMiddlewares(),await this.callHook("$onMount"),await this.mount(),await this.callHook("$afterControllersInit"),this.attach().then((()=>{this.callHook("$onReady")}))}catch(e){if("not implemented"===this.callHook("$onWorkbenchInitError",e))throw e}}getComponent(){return this.startUpService.getComponent()}awaitForRenderDone(){return(e=this,t=Te,function(e,t){return t.get?t.get.call(e):t.value}(e,be(e,t,"get"))).awaitForInit();var e,t}initServices(){var e;this.startUpService.initServices(this.settings),i.A.get(c.H),i.A.get(ye),this.settings.useLogger&&this.settings.useLogger!==a.r&&(a.r.use=this.settings.useLogger),this.settings.useLogger?a.r.info(`workbenchVersion:${this.version}`):console.info(`workbenchVersion:${this.version}`),null===(e=this.settings.mount.services)||void 0===e||e.forEach((e=>i.A.get(e)))}initMiddlewares(){const e=i.A.get(l.K);this.startUpService.initMiddlewares(e),e.$onInit()}async attach(){await this.startUpService.attach(this.settings.container)}mount(){return new Promise((e=>{setTimeout((()=>{i.A.get(c.H).subscribeToControllerChange();i.A.get(y).subscribeToSettingServicesChange(),this.settings.addMountSettings(this.settings.mount),e()}),0)}))}}Se([(0,s.t)(u.I),ke("design:type","function"==typeof(Re=void 0!==u.I&&u.I)?Re:Object)],Ce.prototype,"settings",void 0),Se([(0,s.t)(m.B),ke("design:type","function"==typeof(we=void 0!==m.B&&m.B)?we:Object)],Ce.prototype,"startUpService",void 0)},16400:(e,t,r)=>{r.d(t,{P:()=>u});var o=r(9541),n=r(93343),i=r(27046),s=r(65827),a=r(98141),c=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class u extends i.w{constructor(e,t){super(e,t,Object.getOwnPropertyDescriptor(e,t)),this.methodClassName=t,this.beforeMiddlewares=[],this.middlewares=[],this.afterMiddlewares=[],this.type=o.S.getReturnType(this.rawTarget,this.methodName)}get methodName(){return this.methodClassName}merge(e){const t=e.filter((e=>"string"!=typeof e&&Boolean(e)));return this.middlewares=this.middlewares.concat(t),this}get(e){const t=s.yh.from(this.target).get(e);let r=(0,a.o0)(void 0,t);const o=this.store.get(e);return void 0!==o&&(r=(0,a.o0)(r,o)),r}before(e){return this.beforeMiddlewares=this.beforeMiddlewares.concat(e),this}after(e){return this.afterMiddlewares=this.afterMiddlewares.concat(e),this}}c([(0,n.NG)(),l("design:type",Array)],u.prototype,"beforeMiddlewares",void 0),c([(0,n.NG)(),l("design:type",Array)],u.prototype,"middlewares",void 0),c([(0,n.NG)(),l("design:type",Array)],u.prototype,"afterMiddlewares",void 0)},49620:(e,t,r)=>{r.d(t,{_:()=>a,r:()=>c});var o=r(14567),n=r(91513),i=r(63439);const s={success:"#2e7d32",stop:"#bf360c",error:"#d32f2f",skip:"#757575"};function a(e){return Boolean("function"==typeof e&&e.point&&e.context&&e.hasNext&&e.stop)}class c extends Function{constructor(e,t,r={}){super(),this.middlewares=e,this.rawArguments=[],this.debug=!1,this.debugInfo=[],this.runningHandlerInfo={},this.index=0,this.hasCalled=!1;const o=(...e)=>o.run(...e);return o.middlewares=e,o.context={metadata:r},o.point=null!=t?t:{name:"",from:"",trigger:"",path:[]},Object.setPrototypeOf(o,new.target.prototype)}getNext(e=!1){let t=()=>{};if(t.hasCalled=this.hasCalled,this.hasNext()){this.index+=1;const r=this.middlewares[this.index];t=()=>(t.hasCalled=!0,r(this,e)),t.hasCalled=this.hasCalled}return this.hasCalled=!1,t}merge(e){const t=new c(e.concat(this.middlewares),this.point,this.context.metadata);return t.debug=this.debug,t}setOnCall(e){this.onCall=e}setContext(e){Object.assign(this.context,e)}hasNext(){return this.index<this.middlewares.length-1}get next(){return this.getNext()}get skip(){return this.getNext(!0)}get data(){return this.result}run(...e){this.rawArguments=e,this.index=-1,this.debugInfo=[],this.runningHandlerInfo={},this.onCall&&this.onCall(),this.next(),(this.debug||o.A.get(n.O).getValue(i.R.DebugMode))&&this.printDebugInfo();const{data:t}=this;return this.cleanResult(),t}cleanResult(){this.result=void 0}traceStart(e,t){const r=Date.now();this.runningHandlerInfo[e]={start:r,type:t}}traceEnd(e,t){const r=Date.now(),o=this.runningHandlerInfo[e];o&&this.debugInfo.push([e,o.type,t,r-o.start])}storeData(e){this.result=e}stop(){this.hasCalled=!0}getArguments(){return this.rawArguments}printDebugInfo(){console.group(`%c@${this.point.from}(${this.point.name}, ${this.point.trigger})`,["font-family: Consolas, monospace","display: inline-block","padding: 2px","border: 1px solid #ffa000","background-color: #ffd14933"].join(";")),this.debugInfo.forEach((([e,t,r,o])=>{console.log(`${`%c${r}%c`.padEnd(14," ")} [%c${t}%c]: ${o}ms --\x3e ${e}`,`color: white; background-color: ${s[r]};`,"color: unset","color: "+("controller"===t?"#66bb6a":"#42a5f5"),"color: unset")})),console.groupEnd()}}},14548:(e,t,r)=>{r.d(t,{d:()=>l,m:()=>u});var o=r(98141),n=r(93343),i=r(49868),s=r(12287),a=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class l extends i.K{get middlewares(){return this.controllerMiddleware}set middlewares(e){Object.keys(e).forEach((t=>{this.controllerMiddleware[t]=this.controllerMiddleware[t].concat(e[t])}))}get actionPoints(){return s.q.getActionPoints((0,o.ll)(this.provide))}constructor(e){super(e),this.name="",this.controllerMiddleware={useBefore:[],use:[],useAfter:[]},this.siderMenu=[],this.siderMenuPanel=[],this.titleBar=[],this.toolBar=[],this.toolBarPanel=[],this.editors=[],this.operateDetailPage=[],this.operateDetailPagePanel=[],this.type="controller"}}a([(0,n.NG)(),c("design:type",Object)],l.prototype,"name",void 0),a([(0,n.NG)(),c("design:type",Object)],l.prototype,"controllerMiddleware",void 0),a([(0,n.NG)(),c("design:type",Object),c("design:paramtypes",[Object])],l.prototype,"middlewares",null),a([(0,n.NG)(),c("design:type",Array),c("design:paramtypes",[])],l.prototype,"actionPoints",null);class u{}},41468:(e,t,r)=>{r.d(t,{g:()=>w});var o=r(14567),n=r(13250),i=r(98141),s=r(60991),a=r(47900),c=r(84647),l=r(22096),u=r(93343),d=r(59625),f=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class p{constructor(e,t){this.handler=e,this.methodKey=t,this.handlerType="function",this.injectable=!1,this.nextFunction=!1,this.resolve()}resolve(){let e=this.handler;if(l.Q.has(this.handler)){const t=l.Q.get(this.handler);this.handlerType="middleware",this.methodKey="use",e=t.useClass}else c.p.has(this.handler)&&(this.handlerType="controller");this.methodKey&&(this.injectable=d.d.isInjectable(e,this.methodKey))}get type(){return this.handlerType}get methodName(){return this.methodKey}get hasNextFunction(){return this.nextFunction}get target(){return this.handler}get services(){return this.injectable?d.d.getParams(this.target,this.methodName):[]}}f([(0,u.NG)(),h("design:type",String)],p.prototype,"handlerType",void 0),f([(0,u.NG)(),h("design:type",Object)],p.prototype,"injectable",void 0),f([(0,u.NG)(),h("design:type",Object)],p.prototype,"nextFunction",void 0);var v,g=r(16400),y=r(18823),m=r(76373),_=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class{constructor(e){this.workbenchContext=e}get context(){return this.workbenchContext}inject(e,t){if(e in y.x9.prototype)return void s.r.error(`Duplicate injection for key: ${e}`);let r=()=>t;"function"==typeof t&&(r=t),Object.defineProperty(y.x9.prototype,e,{get:r})}};R=_([(0,m.t)(),b("design:paramtypes",["function"==typeof(v=void 0!==y.x9&&y.x9)?v:Object])],R);class w{constructor(e){this.handlerMetadata=e}static from(e){return e instanceof g.P?new w(new p(e.target,e.methodName)):new w(new p(e))}build(){return(e,t)=>this.invoke(e,t)}middlewareHandler(){const e=l.Q.get(this.handlerMetadata.target);if(!e)throw new Error(`${(0,i.FM)(this.handlerMetadata.target)} middleware component not found in the MiddlewareRegistry`);let{instance:t}=e;return t||(t=o.A.get(n.L).invoke(e.useClass)),(...e)=>(t.use.bind(t),t.use(...e))}controlHandler(){const e=c.p.get(this.handlerMetadata.target);if(!e)throw new Error("Controller component not found in the ControllerRegistry");const t=e.useClass;return void 0===e.instance&&(e.instance=o.A.get(n.L).invoke(t)),e.instance[this.handlerMetadata.methodName].bind(e.instance)}getHandler(){if(this.handler)return this.handler;switch(this.handlerMetadata.type){default:case"function":this.handler=this.handlerMetadata.target;break;case"middleware":this.handler=this.middlewareHandler();break;case"controller":this.handler=this.controlHandler()}return this.handler}invoke(e,t=!1){try{const{target:i,methodName:s,type:a}=this.handlerMetadata;var r;if(e.traceStart(`${i.name} # ${s}`,a),t)return e.traceEnd(`${i.name} # ${s}`,"skip"),void(null===(r=e.skip)||void 0===r||r.call(e));let c,l=this.runPreHandlers(e);if("controller"===a){const t=l.findIndex((e=>void 0!==e)),r=e.getArguments();if(t<0)l=r;else for(let e=t-1,o=0;e>=0;e-=1,o+=1)l[e]=r[o]}if("middleware"===a||"controller"===a){c=this.getHandler()(...l)}var o,n;if(void 0!==c&&"function"!==a&&e.storeData(c),e.hasCalled)e.traceEnd(`${i.name} # ${s}`,"stop"),null===(o=e.skip)||void 0===o||o.call(e);else e.traceEnd(`${i.name} # ${s}`,"success"),null===(n=e.next)||void 0===n||n.call(e)}catch(c){var i,a;const{target:t,methodName:r}=this.handlerMetadata;s.r.error(null!==(i=c.stack)&&void 0!==i?i:`Error occured at ${t.name} # ${r}: ${c}`),e.traceEnd(`${t.name} # ${r}`,"error"),null===(a=e.skip)||void 0===a||a.call(e)}}runPreHandlers(e){const{context:t}=o.A.get(R);return this.handlerMetadata.services.map((r=>{var o;return null===(o=a.A.get(r.service))||void 0===o?void 0:o({context:t,runner:e,param:r})}))}}},12287:(e,t,r)=>{r.d(t,{q:()=>s});var o=r(9541),n=r(65827),i=r(16400);class s{static getActionPoints(e){return this.hasActionPoints(e)||o.S.set(s.name,[],e),o.S.getOwn(s.name,e)}static hasActionPoints(e){return o.S.hasOwn(s.name,e)}static get(e,t){if(!this.has(e,t)){const r=new i.P(e,t);s.getActionPoints(e).push(r),o.S.set(s.name,r,e,t)}return o.S.getOwn(s.name,e,t)}static has(e,t){return o.S.hasOwn(s.name,e,t)}static useBefore(e,t,r){return this.get(e,t).before(r),this}static use(e,t,r){return this.get(e,t).merge(r),this}static useAfter(e,t,r){return this.get(e,t).after(r),this}static store(e,t){return n.yh.from(e,t,Object.getOwnPropertyDescriptor(e,t))}static setMetadata(e,t,r,o){return s.store(r,o).set(e,t),s}static getMetadata(e,t,r){return s.store(t,r).get(e)}}},84647:(e,t,r)=>{r.d(t,{p:()=>i});var o=r(26569),n=r(14548);const i=new o.B(n.d)},22096:(e,t,r)=>{r.d(t,{Q:()=>s});var o=r(26569),n=r(49868);class i extends n.K{}const s=new o.B(i)},59625:(e,t,r)=>{r.d(t,{d:()=>f});var o,n=r(9541),i=r(93343),s=r(98141),a=r(27046),c=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class u extends a.w{get service(){return this.rawService}set service(e){this.rawService=e,this.name=(0,s.FM)(e)}toJSON(){return{service:(0,s.FM)(this.rawService),name:this.name,use:this.typeName,expression:this.expression}}}c([(0,i.NG)(),l("design:type",Object)],u.prototype,"rawService",void 0);const d="workbench:params:metadata";class f{static get(e,t,r){const o=this.getParams(e,t);return o[r]=o[r]||new u(e,t,r),o[r]}static set(e,t,r,o){const i=n.S.has(d,e,t)?n.S.get(d,e,t):[];i[r]=o,n.S.set(d,i,e,t)}static usePreHandler(e,t){const r=f.get(t.target,t.propertyKey,t.parameterIndex);return r.service=e,t.expression&&(r.expression=t.expression),t.useFunction&&(r.converter=t.useFunction),f.set(t.target,t.propertyKey,t.parameterIndex,r),this}static decorate(e,t={}){return(r,o,n)=>{if("number"==typeof n){const i=Object.assign({target:r,propertyKey:o,parameterIndex:n},t);"symbol"==typeof e&&f.usePreHandler(e,i)}}}}(o=f).getParams=(e,t)=>n.S.has(d,e,t)?n.S.get(d,e,t):[],o.isInjectable=(e,t)=>{var r;return(null!==(r=n.S.get(d,e,t))&&void 0!==r?r:[]).length>0}},47900:(e,t,r)=>{r.d(t,{A:()=>o});const o=new Map},43110:(e,t,r)=>{r.d(t,{H:()=>M});var o=r(21565),n=r(69009),i=r(76330),s=r(14567),a=r(13250),c=r(98141),l=r(47570),u=r(60991),d=r(76373),f=r(91513),h=r(81860);const p=Symbol("service:controller");var v=r(46796),g=r(49620);class y{constructor(e,t,r){this.actionPoint=e,this.point=t,this.middlewares=r}buildActionPointRunner(){var e;const t=null===(e=this.actionPoint.get(`${(0,c.tr)(this.point.from)}.${this.point.trigger}`))||void 0===e?void 0:e[this.point.name],r=new g.r(this.middlewares,this.point,t);return r.debug=this.actionPoint.get("debug"),r}}var m=r(41468);var _,b=r(42550),R=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class S{constructor(e,t,r){this.provider=e,this.uiServiceCollection=t,this.postDepsConstructorCallback=r,this.affectedUIService=new Set,this.serviceToItems=new Map,this.uiServiceCollection.getControllerRelatedUIServices().forEach(((e,t)=>{var r;const o=this.uiServiceCollection.getItemName(t);this.serviceToItems.set(t,null!==(r=this.provider[o])&&void 0!==r?r:[])}))}build(e=!1){return this.buildEntries(),this.buildCallbacks(),e&&this.updateAffectedUIService(),this}getAffectedUIServices(){return this.affectedUIService}buildCallbacks(){this.provider.actionPoints.forEach((e=>{const t=function(e,t){return[].concat(e.useBefore).concat(e.use).concat(t.beforeMiddlewares).concat(t.middlewares).concat([t]).concat(t.afterMiddlewares).concat(e.useAfter).filter((e=>Boolean(e))).map((e=>m.g.from(e).build()))}(this.provider.middlewares,e);e.get("points").forEach((r=>{this.buildByPoints(r,t,e)}))}))}buildByPoints(e,t,r){if(this.uiServiceCollection.getControllerRelatedUIServices().has(e.from)){const o=s.A.get(e.from),n=new y(r,e,t).buildActionPointRunner();o.bind(e.name,e.trigger,n),this.trackControllerService.setCallbackController(e.from+e.name,this.provider.useClass),this.affectedUIService.add(e.from)}}buildEntries(){this.uiServiceCollection.getControllerRelatedUIServices().forEach((e=>{const t=(0,c.tr)(e),r=this.getProviderItemsByName(t);r&&r.forEach((r=>{e.register({...r},!1),this.trackControllerService.setConfigController(t+r.name,this.provider.useClass),this.affectedUIService.add(t)}))}))}updateAffectedUIService(){this.uiServiceCollection.updateUIStateByServiceName(this.affectedUIService)}getProviderItemsByName(e){return this.serviceToItems.get(e)}}R([(0,v.t)(b.r),w("design:type","function"==typeof(_=void 0!==b.r&&b.r)?_:Object)],S.prototype,"trackControllerService",void 0);var k,T,C=r(84647),j=r(63439),P=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let M=class extends l.b{constructor(e,t){super(C.p),this.uiServiceCollection=e,this.store=t,this.controllerSettingChange=new o.t,this.postConstructorSubject=new n.x,this.affectedUIService=new Set,this.store.register(j.e.Controllers,[]).subscribe(this.controllerSettingChange),this.postConstructorSubject.asObservable().pipe((0,i.p)(20,void 0,{leading:!1,trailing:!0})).subscribe((()=>{this.updateAffectedUIService()})),this.postDepsConstructorCallback=()=>{this.postConstructorSubject.next()}}subscribeToControllerChange(){0===this.controllerSettingChange.observers.length&&this.controllerSettingChange.subscribe((e=>{this.buildControllers(e,!0)}))}buildControllers(e,t=!0){e?e.forEach((e=>{this.buildController(e,!1)})):C.p.forEach((e=>{this.buildControllerByProvider(e,!1)})),t&&this.uiServiceCollection.getControllerRelatedUIServices().forEach(((e,t)=>{this.affectedUIService.has(t)&&e.updateState()}))}buildController(e,t=!0){const r=C.p.get(e);if(!r)throw new ReferenceError(`Controller ${(0,c.FM)(e)} is not loaded, make sure target is decorated as Controller`);if("controller"!==r.type)throw new TypeError(`Provider ${(0,c.FM)(e)} is not a controller.`);this.buildControllerByProvider(r,t)}invoke(e){return s.A.get(a.L).invoke(e)}buildControllerByProvider(e,t){const r=new S(e,this.uiServiceCollection,this.postDepsConstructorCallback).build(t);if(void 0===e.instance)try{e.instance=this.invoke(e.useClass)}catch(n){return void u.r.error(`Failed to construct controller ${e.className}, ${n}`)}const o=r.getAffectedUIServices();for(const i of o)this.affectedUIService.add(i)}updateAffectedUIService(){this.uiServiceCollection.updateUIStateByServiceName(this.affectedUIService)}};M=P([(0,d.t)({overridable:!0,provide:p}),O("design:paramtypes",["function"==typeof(k=void 0!==h.Z&&h.Z)?k:Object,"function"==typeof(T=void 0!==f.O&&f.O)?T:Object])],M)},42550:(e,t,r)=>{r.d(t,{r:()=>i});var o=r(76373),n=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};let i=class{constructor(){this.configControllers=new Map,this.callbackControllers=new Map}getConfigController(e){return this.configControllers.get(e)}getCallbackController(e){return this.callbackControllers.get(e)}setConfigController(e,t){this.configControllers.set(e,t)}setCallbackController(e,t){this.callbackControllers.set(e,t)}};i=n([(0,o.t)({overridable:!0})],i)},97560:(e,t,r)=>{r.d(t,{K:()=>l});var o=r(47570),n=r(14567),i=r(76373),s=r(22096),a=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let l=class extends o.b{constructor(){super(s.Q)}$onInit(){n.A.buildRegistry(s.Q)}invoke(e){return n.A.invoke(e)}use(e,t){const r=n.A.get(t.on);t.callbackNames.forEach((t=>{r.use(e,t)}))}};l=a([(0,i.t)(),c("design:paramtypes",[])],l)},35408:(e,t,r)=>{var o,n;r.d(t,{Mp:()=>o,eo:()=>s,hX:()=>i}),function(e){e.SiderMenu="sider_menu",e.SiderMenuPanel="sider_menu_panel",e.TitleBar="title_bar",e.ToolBar="tool_bar",e.ToolBarPanel="tool_bar_panel",e.EditorContainer="editor_container",e.OperateDetailsPage="operate_details_page",e.OperateDetailsPagePanel="operate_details_page_panel"}(o||(o={})),function(e){e.SiderMenu="siderMenu",e.SiderMenuPanel="siderMenuPanel",e.TitleBar="titleBar",e.ToolBar="toolBar",e.ToolBarPanel="toolBarPanel",e.EditorContainer="editors",e.OperateDetailsPage="operateDetailPage",e.OperateDetailsPagePanel="operateDetailPagePanel"}(n||(n={}));const i={[n.SiderMenu]:o.SiderMenu,[n.SiderMenuPanel]:o.SiderMenuPanel,[n.TitleBar]:o.TitleBar,[n.ToolBar]:o.ToolBar,[n.ToolBarPanel]:o.ToolBarPanel,[n.EditorContainer]:o.EditorContainer,[n.OperateDetailsPage]:o.OperateDetailsPage,[n.OperateDetailsPagePanel]:o.OperateDetailsPagePanel},s={[o.SiderMenu]:n.SiderMenu,[o.SiderMenuPanel]:n.SiderMenuPanel,[o.TitleBar]:n.TitleBar,[o.ToolBar]:n.ToolBar,[o.ToolBarPanel]:n.ToolBarPanel,[o.EditorContainer]:n.EditorContainer,[o.OperateDetailsPage]:n.OperateDetailsPage,[o.OperateDetailsPagePanel]:n.OperateDetailsPagePanel}},62740:(e,t,r)=>{r.d(t,{C:()=>i,Z:()=>i});var o=r(49620),n=r(13555);class i extends n.V{constructor(){super(...arguments),this.pathMap=new Map,this.reversedPathMap=new Map}getPathByConfig(e){var t;return null!==(t=this.pathMap.get(e))&&void 0!==t?t:[]}getConfigByPath(e){return Array.isArray(e)?this.reversedPathMap.get(e.join("/")):this.reversedPathMap.get(e)}setPathToActionInfoInConfig(e,t){const r=[];t&&r.push(...t),r.push(e.name),this.pathMap.set(e,r),this.reversedPathMap.set(r.join("/"),e),Object.entries(e).forEach((([t,r])=>{if(r instanceof o.r){const o=r.merge([]),n=this.getPathByConfig(e);o.point={...r.point,path:n,name:e.name},e[t]=o}}))}onUpdate(){this.pathMap.clear(),this.reversedPathMap.clear()}forceUpdateWithStore(e,t){const r=e.getValue(t);null!==r?Array.isArray(r)?e.get(t).next(r.slice()):"object"!=typeof r?e.get(t).next(r):e.get(t).next({...r}):this.onUpdate()}}},81860:(e,t,r)=>{r.d(t,{Z:()=>u});var o,n=r(98141),i=r(76373),s=r(13555),a=r(35408),c=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let u=class{constructor(...e){this.serviceMap=new Map,this.serviceOptions=new Map;for(const t of e)t instanceof s.V&&this.serviceMap.set((0,n.tr)(t),t)}get services(){return[...this.serviceMap.values()]}getControllerRelatedUIServices(){return this.serviceMap}has(e){return this.serviceMap.has((0,n.tr)(e))}add(e,t){const r=(0,n.tr)(e);this.serviceMap.set(r,e),t&&this.serviceOptions.set(r,t)}get(e){return this.serviceMap.get(e)}getItemName(e){var t,r;return null!==(t=null===(r=this.serviceOptions.get(e))||void 0===r?void 0:r.itemName)&&void 0!==t?t:a.eo[e]}updateUIStateByServiceName(e){this.getControllerRelatedUIServices().forEach(((t,r)=>{e.has(r)&&t.updateState()}))}};u=c([(0,i.t)(),l("design:paramtypes",["function"==typeof(o=void 0!==s.V&&s.V)?o:Object])],u)},13555:(e,t,r)=>{r.d(t,{V:()=>v});var o=r(7797),n=r(49489),i=r(98141),s=r(60991),a=r(49620),c=r(41468);function l(e){return!!e.includes(":")}var u=r(58119),d=r.n(u);class f{constructor(){this.getMemorizedMatchPoint=d()(this.getMatchPoint,this.matchPointMemoizedCacheKey),this.namedPlaceholders=[]}addMatchPoint(e){l(e)&&!this.namedPlaceholders.includes(e)&&this.namedPlaceholders.push(e)}getMatchPoint(e){const t=this.namedPlaceholders.filter((t=>function(e,t){const r=`^${e.replace(/:\w+/g,"\\w+")}$`;return new RegExp(r).test(t)}(t,e)));if(t.length>1)throw new Error(`Ambiguous match points found for key ${e}, match points ${t}`);return t[0]}matchPointMemoizedCacheKey(...e){return this.namedPlaceholders.length+e[0]}}class h{constructor(){this.configs=new Map,this.namedPlaceHolder=new f}set(e,t){this.configs.set(e,t),l(e)&&this.namedPlaceHolder.addMatchPoint(e)}remove(e){this.configs.has(e)?this.configs.delete(e):s.r.warn(`The config "${e}" does not exist, thus ignored.`)}has(e){let t=this.configs.has(e);if(t)return t;return this.namedPlaceHolder.getMatchPoint(e)&&(t=!0),t}get(e){let t=this.configs.get(e);if(t)return t;const r=this.namedPlaceHolder.getMatchPoint(e);if(r){const o=this.configs.get(r);o&&(t={...o,name:e})}return t}getAllKeys(){const e=[];for(const t of this.configs.keys())e.push(t);return e}}class p{constructor(){this.callbacks=new Map,this.namedPlaceHolder=new f}getAll(e){var t,r;const o=new Map,n=this.namedPlaceHolder.getMemorizedMatchPoint(e);return null===(t=this.callbacks.get(null!=n?n:""))||void 0===t||t.forEach(((e,t)=>o.set(t,e))),null===(r=this.callbacks.get(e))||void 0===r||r.forEach(((e,t)=>o.set(t,e))),o}get(e){return this.callbacks.get(e)}set(e,t){this.callbacks.set(e,t),l(e)&&this.namedPlaceHolder.addMatchPoint(e)}getMatchPoint(e){return this.namedPlaceHolder.getMatchPoint(e)}}class v{constructor(){this.configs=new h,this.callbacks=new p,this.middlewares=new Map,this.subject=new o.X(new Map),this.subject.asObservable().pipe((0,n.T)(1)).subscribe((e=>this.onUpdate(e)))}register(e,t=!1){this.hasConfig(e.name),this.configs.set(e.name,e),t&&this.updateState()}remove(e){this.configs.remove(e)}hasConfig(e){return this.configs.has(e)}onUpdate(e){}getMergedConfig(e){if(this.hasConfig(e)){const t=this.getUIConfig(e),r=this.callbacks.getAll(e),o={};r.forEach(((e,t)=>{o[t]=e})),this.middlewares.forEach(((e,t)=>{o[t]?o[t]=o[t].merge(e):o[t]=new a.r(e)}));const n={...t,...o};return this.updateActionPoint(n),n}}updateActionPoint(e){const t=this.callbacks.getMatchPoint(e.name);for(const[r,o]of Object.entries(e))(0,a._)(o)&&(o.point={...o.point,from:(0,i.tr)(this.constructor),name:e.name,trigger:r,matchPoint:t})}get(e,t){const r=this.getMergedConfig(e);return r||t}getUIConfig(e){return this.configs.get(e)}getConfigs(){const e=new Map;return this.configs.getAllKeys().forEach((t=>{const r=this.getMergedConfig(t);r&&e.set(t,r)})),e}updateState(){const e=this.getConfigs();this.subject.next(e)}update(e=!1){e?this.$forceUpdate():this.updateState()}bind(e,t,r,o=!1){let n=this.callbacks.get(e);n||(n=new Map,this.callbacks.set(e,n));const i=n.get(t);i&&s.r.warn(`There is already a "${String(t)}" action point for config "${e}" and will be override by duplicate declaration. Search "@${i.point.from}('${e}', '${String(t)}')" in your codebase to find it.`),n.set(t,r),o&&this.updateState()}use(e,t){const r=c.g.from(e).build();let o=this.middlewares.get(t);o?o.unshift(r):o=[r],this.middlewares.set(t,o),this.update()}getCallbackConfig(e){return this.callbacks.get(e)}}},63439:(e,t,r)=>{r.d(t,{R:()=>o,e:()=>n});const o={Namespace:"namespace",DebugMode:"debugMode",WorkbenchMode:"workbenchMode",SiderMenu:"siderMenu",TitleBar:"titleBar",ToolBar:"toolBar",HideLogo:"hideLogo",Visible:"visible",BackLogoConfirguation:"backLogoConfirguation",HideSiderMenu:"hideSiderMenu"},n={Controllers:"controllers",Services:"services"}},42520:(e,t,r)=>{r.d(t,{I:()=>_});var o=r(46796),n=r(76373),i=r(9541);var s=r(91513),a=r(63439),c=r(22169),l=r(77685),u=r(1504);const d="lvve_toolbar_panel_mode";var f,h,p,v=r(35518),g=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(e,t){return function(r,o){t(r,o,e)}};let _=f=class{constructor(e,t,r,o){this.store=e,this.map=new Map,this._onSiderMenPanelWidthChange=new l.Q,this.onSiderMenPanelWidthChange=this._onSiderMenPanelWidthChange.event,this.namespace="workbench",this.platform=r,this.debugMode=!1,this.container=t,this.mount={controllers:[],services:[]},this.visible=!0,this.titleBar={...null!=o?o:{},containerHeight:56,containerPaddingX:[16,16],centerBoxPaddingX:16,iconBtnWidth:32},this.siderMenu={isPreRenderPanelWhenIdle:!0,disableFloatMode:!1,menuSize:{width:76},panelSize:{min:240,default:280,max:700,current:280}},this.toolBar={panelMode:v._.FLOAT,enableFixedMode:!0}}static getMetadata(e){return i.S.getOwn(i.h.WORKBENCH_SETTINGS,e)}forEach(e,t){return this.map.forEach(e,t)}set(e,t){"string"==typeof e?(!function(e,t,r,o="."){const n=e.split(o);for(;i=n.shift(),n.length?("function"==typeof r.set?(r.has(i)||r.set(i,{}),r=r.get(i)):r=r[i]||{},1):("function"==typeof r.set?r.set(i,t):r[i]=t,0););var i}(e,t,this.map),Object.values(a.R).includes(e)&&this.store.upsert(e,t)):(Object.keys(e).forEach((t=>{Object.getOwnPropertyDescriptor(f.prototype,t)&&-1===["set","map","forEach","shallow"].indexOf(t)?this[t]=e[t]:this.set(t,e[t])})),this.forEach(((e,t)=>{["useLogger","container"].includes(t)?this[t]=e:this.map.set(t,this.resolve(e))})))}get(e){return function(e,t,r,o="."){const n=e.split(o);for(;i=n.shift(),(t="function"==typeof t.get?t.get(i):t[i])&&n.length;);var i;return void 0===t?r:t}(e,this.map)}resolve(e){return"object"==typeof e&&Object.keys(e).forEach((t=>{e[t]=this.resolve(e[t])})),e}addMountSettings(e){const t=Object.values(a.e);Object.entries(e).forEach((e=>{const r=e[0],o=e[1];t.includes(r)&&(this.store.upsert(r,o),Array.isArray(this.mount[r])&&Array.isArray(o)&&this.mount[r].concat(o))}))}get platform(){var e;return null!==(e=this.map.get("platform"))&&void 0!==e?e:"pc"}set platform(e){this.map.set("platform",e)}get container(){return this.map.get("container")}set container(e){this.map.set("container",e)}set useLogger(e){this.map.set("useLogger",e)}get useLogger(){return this.map.get("useLogger")}set mount(e){this.shallow("mount",e)}get mount(){return this.map.get("mount")}set namespace(e){this.map.set("namespace",e)}get namespace(){return this.map.get("namespace")}set debugMode(e){this.map.set("debugMode",e)}get debugMode(){return this.map.get("debugMode")}get titleBar(){return this.map.get("titleBar")}set titleBar(e){this.set("titleBar",e)}get toolBar(){return this.map.get("toolBar")}set toolBar(e){void 0!==(null==e?void 0:e.panelMode)&&u.Z.set(d,e.panelMode,{expires:365}),this.set("toolBar",e)}get siderMenu(){return this.map.get("siderMenu")}set siderMenu(e){const t=this.siderMenu;this.set("siderMenu",(0,c.merge)({},t,e))}updateSiderMenu(e){var t,r;const o=this.siderMenu;this.siderMenu=e,(null==o||null===(t=o.panelSize)||void 0===t?void 0:t.current)!==(null==e||null===(r=e.panelSize)||void 0===r?void 0:r.current)&&this._onSiderMenPanelWidthChange.fire()}get visible(){return this.map.get("visible")}set visible(e){this.set("visible",e)}get workbenchMode(){return this.map.get("workbenchMode")}set workbenchMode(e){this.set("workbenchMode",e)}get hideLogo(){return this.map.get("hideLogo")}set hideLogo(e){this.set("hideLogo",e)}get backLogoConfirguation(){return this.map.get("backLogoConfirguation")}set backLogoConfirguation(e){this.set("backLogoConfirguation",e)}get hideSiderMenu(){return this.map.get("hideSiderMenu")}set hideSiderMenu(e){this.set("hideSiderMenu",e)}shallow(e,t){Object.keys(t).forEach((r=>{this.set(`${e}.${r}`,t[r])}))}};_=f=g([(0,n.t)(),m(1,(0,o.t)("container")),m(2,(0,o.t)("platform")),m(3,(0,o.t)("titleBar")),y("design:paramtypes",["function"==typeof(h=void 0!==s.O&&s.O)?h:Object,"function"==typeof(p="undefined"!=typeof HTMLElement&&HTMLElement)?p:Object,Object,Object])],_)},53767:(e,t,r)=>{var o;r.d(t,{w:()=>o}),function(e){e[e.readonly=1]="readonly",e[e.editable=2]="editable"}(o||(o={}))},35805:(e,t,r)=>{var o;r.d(t,{j:()=>o}),function(e){e.UIServiceSwitchStatus="UIServiceSwitchStatus",e.ControllerSwitchStatus="ControllerSwitchStatus",e.ScopeSwitchStatus="ScopeSwitchStatus",e.DisableExceptionScopes="DisableExceptionScopes",e.DisableAll="DisableAll",e.WorkbenchSiderMenu="WorkbenchSiderMenu",e.WorkbenchSiderMenuPanel="WorkbenchSiderMenuPanel",e.WorkbenchTitleBar="WorkbenchTitleBar",e.WorkbenchToolBar="WorkbenchToolBar",e.WorkbenchToolBarPanel="WorkbenchToolBarPanel",e.WorkbenchEditorContainer="WorkbenchEditorContainer",e.WorkbenchOperateDetailsPage="WorkbenchOperateDetailsPage",e.WorkbenchOperateDetailsPagePanel="WorkbenchOperateDetailsPagePanel"}(o||(o={}))},91513:(e,t,r)=>{r.d(t,{O:()=>a});var o=r(7797),n=r(60991),i=r(76373),s=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};let a=class{constructor(){this.state=new Map}register(e,t){return this.state.has(e)?n.r.warn("This key has already been registered, thus ignored."):this.state.set(e,new o.X(t)),this.get(e)}has(e){return this.state.has(e)}get(e){return this.state.get(e)}getValue(e){if(this.state.has(e)){return this.get(e).getValue()}return null}update(e,t){this.state.has(e)?this.get(e).next(t):n.r.warn(`Key "${e}" is not exists. Update ignored.`)}upsert(e,t){this.state.has(e)?this.get(e).next(t):this.register(e,t)}clear(e){this.state.delete(e)}};a=s([(0,i.t)({overridable:!0})],a)},92643:(e,t,r)=>{r.d(t,{x:()=>u});var o=r(18571),n=r(43590),i=r(76330),s=r(69511),a=r(14567),c=r(91513),l=r(72322);function u(e,t=!1,r=10,u){return d=>{var f,h,p;return(f=class extends o.Component{constructor(t){super(t),this.observables={},this.store=a.A.get(c.O),this.state=e.reduce(((e,t)=>(e[t]=this.getObservable(t).getValue(),e)),{})}componentDidMount(){const o={leading:!1,trailing:!0},s=(0,n.a)(...Object.values(this.observables));e.length>1&&!t?this.subscription=s.pipe((0,i.p)(r,u,o)).subscribe((e=>{const t=e.reduce(((e,t)=>({...e,...t})),{});this.setState(t)})):this.subscription=s.subscribe((e=>{const t=e.reduce(((e,t)=>({...e,...t})),{});this.setState(t)}))}componentWillUnmount(){var e;null===(e=this.subscription)||void 0===e||e.unsubscribe()}render(){return(0,l.jsx)(d,{...this.props,...this.state})}getObservable(e){this.store.has(e)||this.store.register(e,null);const t=this.store.get(e);return this.observables[e]=t.pipe((0,s.U)((t=>({[e]:t})))),t}}).displayName=null!==(h=null!==(p=d.displayName)&&void 0!==p?p:d.name)&&void 0!==h?h:"WithStateComponent",f}}},11071:(e,t,r)=>{function o(e,t,...r){var o;return"function"==typeof e?null!==(o=e(...r))&&void 0!==o?o:t:null!=e?e:t}r.d(t,{k:()=>o})},91326:(e,t,r)=>{var o;function n({list:e,filter:t=(e=>e)}){return e.sort(((e,t)=>{const r={high:2,default:1,low:0},{orderLevel:o="default",order:n=0}=e,{orderLevel:i="default",order:s=0}=t;return o!==i?r[i]-r[o]:s-n})).map(t)}r.d(t,{l:()=>n,r:()=>o}),function(e){e.high="high",e.default="default",e.low="low"}(o||(o={}))},34412:(e,t,r)=>{r.d(t,{M:()=>$t});const o="undefined"==typeof window||window.WorkbenchSSR;void 0!==r.g&&r.g.Math===Math?r.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")();var n,i=r(14567),s=r(42520),a=r(35545),c=r(77685),l=r(42058),u=r(18571),d=r(70126),f=r(84240),h=r(76373),p=r(63568),v=r(81860),g=r(35408),y=r(1923),m=r(42398),_=r(91513),b=r(35805),R=r(62740),w=r(91326);!function(e){e[e.collapsed=0]="collapsed",e[e.expanded=1]="expanded",e[e.shrinking=2]="shrinking",e[e.growing=3]="growing"}(n||(n={}));var S,k=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class extends R.C{get activeSiderMenu(){return this._activeSiderMenu}get activeSiderMenuMode(){return this._activeSiderMode}get isSidebarCollapsed(){return this._isSidebarCollapsed}get siderTransitionState(){return this._siderTransitionState}get activeExtraParams(){return this._activeExtraParams}constructor(e){super(),this.store=e,this._activeSiderMenu=void 0,this._activeSiderMode=void 0,this._isSidebarCollapsed=!1,this._siderTransitionState=n.expanded,this._activeExtraParams=void 0,this._onSiderMenuExpandedChange=new c.Q,this.onSiderMenuExpandedChange=this._onSiderMenuExpandedChange.event,this.store.register(b.j.WorkbenchSiderMenu,{activeTarget:void 0,activeMode:void 0,top:[],bottom:[],siderTransitionState:this._siderTransitionState})}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchSiderMenu)}onUpdate(){super.onUpdate();const e=this.getConfigs(),t=[],r=[];e.forEach((e=>{"top"===e.position?t.push(e):r.push(e)})),this.updateActionInfoInConfig();const o={activeTarget:this._activeSiderMenu,activeMode:this._activeSiderMode,top:(0,w.l)({list:t}),bottom:(0,w.l)({list:r}),siderTransitionState:this._siderTransitionState};this.store.get(b.j.WorkbenchSiderMenu).next(o)}register(e,t=!0){super.register(e,t)}get(e){return super.get(e,{name:"none",title:()=>"",icon:()=>u.createElement("div"),position:"top",orderLevel:w.r.default,order:1})}activeMenuByName(e,t,r){var o,i;if(e===(null===(o=this._activeSiderMenu)||void 0===o?void 0:o.name)&&(null==r?void 0:r.extraParams)===this._activeExtraParams)return;this._activeExtraParams=null==r?void 0:r.extraParams;const s=this.get(e);(0,l.Y2)(Boolean(s),"not found target menu, please check logic");this.store.get(b.j.WorkbenchSiderMenuPanel).getValue().panelItems.has(e)&&(this._lastActiveSiderName=null===(i=this._activeSiderMenu)||void 0===i?void 0:i.name,this._activeSiderMenu=s,this._activeSiderMode=t,this._siderTransitionState=n.expanded,this.onUpdate())}unActiveMenu(){var e;this._activeSiderMenu&&(this._lastActiveSiderName=null===(e=this._activeSiderMenu)||void 0===e?void 0:e.name,this._activeSiderMenu=void 0,this._activeSiderMode=void 0,this._activeExtraParams=void 0,this._siderTransitionState=n.collapsed,this.onUpdate())}toggleMenuPanelByName(e){var t,r;let o;const n=!(null!==(t=this._activeSiderMenu)&&void 0!==t&&t.name);return(null===(r=this._activeSiderMenu)||void 0===r?void 0:r.name)===e?(o=!0,this.unActiveMenu()):(this.activeMenuByName(e,"manual"),o=!1),n!==o&&this._onSiderMenuExpandedChange.fire({mode:"manual",actionType:"click_tab",visible:!o}),o}toggleMenuPanel(e){let t;return this._activeSiderMenu?(this.unActiveMenu(),t=!1):(this.activeMenuByName(this._lastActiveSiderName,"manual"),t=!0),this._onSiderMenuExpandedChange.fire({mode:e.mode,actionType:e.actionType,visible:t}),t}setSiderTransitionState(e){this._siderTransitionState=e,this.onUpdate()}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}};C=k([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.SiderMenu}),T("design:paramtypes",["function"==typeof(S=void 0!==_.O&&_.O)?S:Object])],C);var j,P,O,M,I=r(13250),x=r(80998),E=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let A=class extends R.C{get activeTarget(){return this._activeTarget}constructor(e,t,r,o){super(),this.store=e,this.workbenchSiderMenuService=t,this.outerInjectedService=r,this.workbenchSettingsService=o,this._panelRenderTags=new Map,this.store.register(b.j.WorkbenchSiderMenuPanel,{activeTarget:void 0,panelItems:new Map,panelRenderTags:this._panelRenderTags});const n=e.get(b.j.WorkbenchSiderMenu).subscribe((()=>{this.onUpdate()}));this._subscribe=n}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchSiderMenuPanel)}onUpdate(){var e;super.onUpdate();const t=this.store.get(b.j.WorkbenchSiderMenuPanel),r=null===(e=this.workbenchSiderMenuService.activeSiderMenu)||void 0===e?void 0:e.name;this._updatePanelRenderTags(r);const o={activeTarget:r,panelItems:this.getConfigs(),panelRenderTags:this._panelRenderTags,extraParams:this.workbenchSiderMenuService.activeExtraParams};if(t.value.activeTarget!==o.activeTarget){var n,i,s,a;if(t.value.activeTarget)null===(n=t.value.panelItems.get(t.value.activeTarget))||void 0===n||null===(i=n.onActiveChange)||void 0===i||i.call(n,{active:!1});if(o.activeTarget)null===(s=o.panelItems.get(o.activeTarget))||void 0===s||null===(a=s.onActiveChange)||void 0===a||a.call(s,{active:!0,activeMode:this.workbenchSiderMenuService.activeSiderMenuMode,extraParams:o.extraParams}),this._activeTarget=o.activeTarget}this.updateActionInfoInConfig(),t.next(o)}register(e,t=!0){var r;super.register(e,t),this._panelRenderTags.set(e.name,{hasRendered:!1,needPreRender:!1,name:e.name}),null!==(r=this.workbenchSettingsService.siderMenu)&&void 0!==r&&r.isPreRenderPanelWhenIdle&&this._preRenderMenuPanel(e.name)}get(e){return super.get(e,{name:"none"})}dispose(){var e;null===(e=this._subscribe)||void 0===e||e.unsubscribe()}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}_updatePanelRenderTags(e){const t=this._panelRenderTags.get(e);if(!t)return;const r={...t,hasRendered:!0};this._panelRenderTags.set(e,r)}_preRenderMenuPanel(e){const t=this._panelRenderTags.get(e);(0,l.ZB)(t),null!=t&&t.needPreRender||this.outerInjectedService.invokeFunction((r=>{r.get(x.hR).register({run:()=>{this._panelRenderTags.set(e,{...t,needPreRender:!0}),this.onUpdate()}})}))}};A=E([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.SiderMenuPanel}),D("design:paramtypes",["function"==typeof(j=void 0!==_.O&&_.O)?j:Object,"function"==typeof(P=void 0!==C&&C)?P:Object,"function"==typeof(O=void 0!==I.L&&I.L)?O:Object,"function"==typeof(M=void 0!==s.I&&s.I)?M:Object])],A);var B=r(18823);const U="IconBtn",N="Btn",F="Custom";var L,W=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let G=class extends R.C{constructor(e){super(),this.store=e,this._moreMenuConfig={menuStatus:"none",menuNumber:0},this.store.register(b.j.WorkbenchTitleBar,{left:[],center:[],right:[],moreMenuConfig:{menuStatus:this._moreMenuConfig.menuStatus,menuNumber:this._moreMenuConfig.menuNumber}})}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchTitleBar)}onUpdate(){super.onUpdate();const e=this.getConfigs(),t=[],r=[],o=[];e.forEach((e=>{switch(e.position){case"left":t.push(e);break;case"center":r.push(e);break;case"right":o.push(e);break;default:(0,l.ss)("title bar invalid position")}})),this.updateActionInfoInConfig();const n={left:(0,w.l)({list:t}),center:(0,w.l)({list:r}),right:(0,w.l)({list:o}),moreMenuConfig:{menuStatus:this._moreMenuConfig.menuStatus,menuNumber:this._moreMenuConfig.menuNumber}};this.store.get(b.j.WorkbenchTitleBar).next(n)}register(e,t=!0){super.register(e,t)}get(e){return super.get(e,{name:"none",type:U,icon:u.createElement("div"),activeIcon:u.createElement("div"),position:"left",orderLevel:w.r.default,order:1})}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}setMenuConfig(e){let t=!1;(void 0!==e.menuNumber&&e.menuNumber!==this._moreMenuConfig.menuNumber||void 0!==e.menuStatus||e.menuStatus!==this._moreMenuConfig.menuStatus)&&(t=!0),this._moreMenuConfig={...this._moreMenuConfig,...null!=e?e:{}},t&&this.onUpdate()}};G=W([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.TitleBar}),$("design:paramtypes",["function"==typeof(L=void 0!==_.O&&_.O)?L:Object])],G);var V,K=r(10323);!function(e){e[e.ClickTrack=0]="ClickTrack",e[e.DbClickTrack=1]="DbClickTrack",e[e.ClickCanvas=2]="ClickCanvas",e[e.DbClickCanvas=3]="DbClickCanvas",e[e.Direct=4]="Direct"}(V||(V={}));var H,Y=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let z=class extends R.C{get activePinToolBar(){return this._activePinToolBar}get activeUnPinToolBar(){return this._activeUnPinToolBar}get sourceActionType(){return this._sourceActionType}get isManualOpenPanel(){return this._isManualOpenPanel}get unPinSelectionUid(){var e;const t=this._toolBarViewMode;return null!=t&&null!==(e=t.selectionIds)&&void 0!==e&&e.length?this._toolBarViewMode.selectionIds.sort().join(""):""}constructor(e){super(),this.store=e,this._activePinToolBar=void 0,this._activeUnPinToolBar=void 0,this._unPinActiveCache=new K.z(100),this._isManualOpenPanel=!1,this._defaultActiveGroupMap=new Map,this.store.register(b.j.WorkbenchToolBar,{showUnPinToolBar:!1,activePinBarName:void 0,activeUnPinBarName:void 0,isManualOpenPanel:!1,pin:[],unpin:[]})}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchToolBar)}onUpdate(){var e,t;super.onUpdate();const r=this.getConfigs(),o=[],n=[];r.forEach((e=>{"pin"===e.type?o.push(e):n.push(e)})),this.updateActionInfoInConfig();const i=(0,w.l)({list:this.getShowUnPinToolBarByViewMode(n)});this.resetActiveUnPinBar(i);const s={showUnPinToolBar:Boolean(i.length),activePinBarName:null===(e=this._activePinToolBar)||void 0===e?void 0:e.name,activeUnPinBarName:null===(t=this._activeUnPinToolBar)||void 0===t?void 0:t.name,pin:(0,w.l)({list:o}),unpin:i,isManualOpenPanel:this._isManualOpenPanel};this.store.get(b.j.WorkbenchToolBar).next(s)}register(e,t=!0){super.register(e,t)}get(e){return super.get(e,{name:"none",title:()=>"",icon:()=>u.createElement("div"),type:"pin"})}getActiveToolbarName(){var e,t,r,o;return null!==(e=null!==(t=null===(r=this._activePinToolBar)||void 0===r?void 0:r.name)&&void 0!==t?t:null===(o=this._activeUnPinToolBar)||void 0===o?void 0:o.name)&&void 0!==e?e:null}activeToolBarByName(e){var t;const r=this.get(e);(0,l.Y2)(Boolean(r),"not found target toolBar, please check logic");const o="pin"===r.type?"_activePinToolBar":"_activeUnPinToolBar";e!==(null===(t=this[o])||void 0===t?void 0:t.name)&&this._isPanelCanSwitch(e)&&("unpin"===r.type&&(this._isManualOpenPanel=!0,this._unPinActiveCache.put(this.unPinSelectionUid,r.name)),this._sourceActionType=V.Direct,this[o]=r,this.onUpdate())}unActiveToolBarByName(e){var t;const r=this.get(e);(0,l.Y2)(Boolean(r),"not found target toolBar, please check logic");const o="pin"===r.type?"_activePinToolBar":"_activeUnPinToolBar";(null===(t=this[o])||void 0===t?void 0:t.name)===e&&("unpin"===r.type&&(this._isManualOpenPanel=!1),this[o]=void 0,this.onUpdate())}activeDefaultToolbar(){var e;const t=null===(e=this._toolBarViewMode)||void 0===e?void 0:e.showGroup;if(!t)return;const r=this._defaultActiveGroupMap.get(t);r&&this.activeToolBarByName(r)}registerDefaultActiveGroup(e,t){e.forEach((e=>{this._defaultActiveGroupMap.set(e,t)}))}unActiveToolbarPlaceholder(){this._isManualOpenPanel=!1,this.onUpdate()}updateToolBarViewMode(e){this._toolBarViewMode=e,e.activePanelName&&this._isPanelCanSwitch(e.activePanelName)&&this._unPinActiveCache.put(this.unPinSelectionUid,e.activePanelName),e.forceActivePanel&&(this._isManualOpenPanel=!0),this._sourceActionType=e.sourceActionType,this.onUpdate()}_isPanelCanSwitch(e){return this.store.get(b.j.WorkbenchToolBarPanel).value.panelItems.has(e)}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}getShowUnPinToolBarByViewMode(e){var t;const{showGroup:r}=null!==(t=this._toolBarViewMode)&&void 0!==t?t:{};return e.filter((e=>{var t,o;return!e.groups||e.groups.includes(null!=r?r:"")&&!(null!==(t=null==e||null===(o=e.shouldHidden)||void 0===o?void 0:o.call(e))&&void 0!==t&&t)}))}resetActiveUnPinBar(e){if(!this._isManualOpenPanel)return;const t=this._unPinActiveCache.get(this.unPinSelectionUid);if(t){const r=e.find((e=>e.name===t));if(r)return void(this._activeUnPinToolBar=r)}this._isManualOpenPanel&&e.length?this._activeUnPinToolBar=null==e?void 0:e[0]:this._activeUnPinToolBar=void 0}};z=Y([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.ToolBar}),q("design:paramtypes",["function"==typeof(H=void 0!==_.O&&_.O)?H:Object])],z);var Z,Q,J=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ee=class extends R.C{constructor(e,t){super(),this.store=e,this.workbenchToolBarService=t,this.store.register(b.j.WorkbenchToolBarPanel,{activePanels:void 0,panelItems:new Map});const r=e.get(b.j.WorkbenchToolBar).subscribe((()=>{this.onUpdate()}));this._subscribe=r}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchToolBarPanel)}onUpdate(){super.onUpdate();const e=this.store.get(b.j.WorkbenchToolBarPanel),t=this.getConfigs(),r=new Map,o=[],{activePinToolBar:n,activeUnPinToolBar:i,sourceActionType:s}=this.workbenchToolBarService;t.forEach((e=>{r.set(e.name,e),(null==n?void 0:n.name)!==e.name&&(null==i?void 0:i.name)!==e.name||o.push(e.name)}));const a={activePanels:o,panelItems:r},c=e=>{var t;return null===(t=e.activePanels)||void 0===t?void 0:t.join(".")};if(c(e.value)!==c(a)){var l,u,d,f,h,p;const t=(null!==(l=null===(u=e.value.activePanels)||void 0===u?void 0:u.length)&&void 0!==l?l:0)>0&&(null!==(d=null===(f=a.activePanels)||void 0===f?void 0:f.length)&&void 0!==d?d:0)>0;null===(h=e.value.activePanels)||void 0===h||h.forEach((e=>{var r,o,n;null!==(r=a.activePanels)&&void 0!==r&&r.includes(e)||(null===(o=a.panelItems.get(e))||void 0===o||null===(n=o.onActiveChange)||void 0===n||n.call(o,{active:!1,isSwitch:t}))})),null===(p=a.activePanels)||void 0===p||p.forEach((r=>{var o,n,i;null!==(o=e.value.activePanels)&&void 0!==o&&o.includes(r)||(null===(n=a.panelItems.get(r))||void 0===n||null===(i=n.onActiveChange)||void 0===i||i.call(n,{active:!0,isSwitch:t,sourceActionType:s}))}))}this.updateActionInfoInConfig(),this.store.get(b.j.WorkbenchToolBarPanel).next(a)}register(e,t=!0){super.register(e,t)}get(e){return super.get(e,{name:"none",title:()=>""})}dispose(){var e;null===(e=this._subscribe)||void 0===e||e.unsubscribe()}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}};ee=J([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.ToolBarPanel}),X("design:paramtypes",["function"==typeof(Z=void 0!==_.O&&_.O)?Z:Object,"function"==typeof(Q=void 0!==z&&z)?Q:Object])],ee);var te,re=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ne=class extends R.C{constructor(e){super(),this.store=e,this.store.register(b.j.WorkbenchEditorContainer,{editors:[]})}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchEditorContainer)}onUpdate(){super.onUpdate();const e=this.store.get(b.j.WorkbenchEditorContainer),t=this.getConfigs(),r=[];t.forEach((e=>{r.push(e)}));const o={editors:r};this.updateActionInfoInConfig(),e.next(o)}register(e,t=!0){super.register(e,t)}get(e){return super.get(e,{name:"none"})}dispose(){}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}};ne=re([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.EditorContainer}),oe("design:paramtypes",["function"==typeof(te=void 0!==_.O&&_.O)?te:Object])],ne);var ie,se,ae=r(41800),ce=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ue=class extends R.C{constructor(e,t){super(),this.store=e,this.outerInjectedService=t,this.store.register(b.j.WorkbenchOperateDetailsPage,{activeTarget:void 0,pages:new Map})}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchOperateDetailsPage)}onUpdate(){var e;super.onUpdate();const t=this.store.get(b.j.WorkbenchOperateDetailsPage),r={activeTarget:null===(e=this._currentActivePage)||void 0===e?void 0:e.name,pages:this.getConfigs()};var o,n,i,s;t.value.activeTarget&&(null===(o=t.value.pages.get(t.value.activeTarget))||void 0===o||null===(n=o.onActiveChange)||void 0===n||n.call(o,{active:!1}));r.activeTarget&&(null===(i=r.pages.get(r.activeTarget))||void 0===i||null===(s=i.onActiveChange)||void 0===s||s.call(i,{active:!0,extraParams:this._activeExtraParams}));this.updateActionInfoInConfig(),t.next(r)}get(e){return super.get(e,{name:"none"})}dispose(){var e;null===(e=this._subscribe)||void 0===e||e.unsubscribe()}openOperateDetailPage(e,t){var r;if(e===(null===(r=this._currentActivePage)||void 0===r?void 0:r.name))return;const o=this.get(e);(0,l.Y2)(Boolean(o),"not found target menu, please check logic"),this._currentActivePage=o,this._activeExtraParams=t,this.outerInjectedService.invokeFunction((e=>{e.get(ae.e).internalFireOperateDetailPageStatus("open")})),this.onUpdate()}closeOperateDetailsPage(){this._currentActivePage=void 0,this.outerInjectedService.invokeFunction((e=>{e.get(ae.e).internalFireOperateDetailPageStatus("close")})),this.onUpdate()}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}};ue=ce([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.OperateDetailsPage}),le("design:paramtypes",["function"==typeof(ie=void 0!==_.O&&_.O)?ie:Object,"function"==typeof(se=void 0!==I.L&&I.L)?se:Object])],ue);var de,fe,he=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},pe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ve=class extends R.C{constructor(e,t){super(),this.store=e,this.outerInjectedService=t,this.store.register(b.j.WorkbenchOperateDetailsPagePanel,{activeGroup:void 0,panels:new Map});const r=e.get(b.j.WorkbenchOperateDetailsPage).subscribe((()=>{this.onUpdate()}));this._subscribe=r}$forceUpdate(){this.forceUpdateWithStore(this.store,b.j.WorkbenchOperateDetailsPagePanel)}onUpdate(){super.onUpdate();const e=this.store.get(b.j.WorkbenchOperateDetailsPagePanel),t=this.store.get(b.j.WorkbenchOperateDetailsPage),r={activeGroup:null==t?void 0:t.value.activeTarget,panels:this.getConfigs()};this.updateActionInfoInConfig(),e.next(r)}get(e){return super.get(e,{name:"none",group:""})}dispose(){var e;null===(e=this._subscribe)||void 0===e||e.unsubscribe()}updateActionInfoInConfig(){this.getConfigs().forEach((e=>{this.setPathToActionInfoInConfig(e,[])}))}};ve=he([(0,h.t)({overridable:!0,scope:"ui:service",name:g.Mp.OperateDetailsPagePanel}),pe("design:paramtypes",["function"==typeof(de=void 0!==_.O&&_.O)?de:Object,"function"==typeof(fe=void 0!==I.L&&I.L)?fe:Object])],ve);var ge=r(63439),ye=r(53767),me=r(22169),_e=r(14552),be=r(71037),Re=r(54549),we=r(92643),Se=r(5789),ke=r.n(Se),Te=r(14906),Ce=r(23224),je=r(58895),Pe=r(11071),Oe=r(72322);const Me=({data:e})=>{var t;const r=(0,Pe.k)(e.tooltips,""),o=(0,me.merge)({className:"wb-icon-btn-tooltips",position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:r},null!==(t=e.tooltipProps)&&void 0!==t?t:{}),n=(0,Oe.jsxs)("div",{className:"sider-menu-action",onClick:()=>{var t;return null===(t=e.onClick)||void 0===t?void 0:t.call(e)},children:[(0,Pe.k)(e.icon,null),e.title?(0,Oe.jsx)("span",{className:"workbench-action-item-title",children:e.title()}):null]});return r?(0,Oe.jsx)(Ce.Z,{...o,children:n}):n},Ie=({data:e,active:t,onClick:r})=>{var o;const n=null===(o=e.title)||void 0===o?void 0:o.call(e);return(0,Oe.jsx)(je.Z.Item,{id:(0,Pe.k)(e.id,void 0),className:ke()("workbench-menu-item",{disabled:(0,Pe.k)(e.shouldDisabled,!1),active:t},`${e.name}-menu`),onClick:()=>{(0,Pe.k)(e.shouldDisabled,!1)||r(e)},children:(0,Oe.jsxs)(Oe.Fragment,{children:[(0,Oe.jsxs)("div",{className:"menu-inner-box",children:[(0,Pe.k)(e.icon,null),n?(0,Oe.jsx)(Ce.Z,{checkOverflow:!0,content:n,position:"right",getPopupContainer:()=>{var e;return null!==(e=document.querySelector(".menu-list"))&&void 0!==e?e:document.body},children:(0,Oe.jsx)("span",{className:"workbench-menu-item-title",children:n})}):null]}),(0,Oe.jsx)("div",{className:"bg-box"})]})},e.name)},xe=(0,u.memo)((e=>{const[t,r]=(0,u.useState)({initializing:!0,menuPanelConfig:void 0});(0,u.useEffect)((()=>{const t=()=>{const{activeTarget:t}=e,{panelItems:r}=e[b.j.WorkbenchSiderMenuPanel];return t&&r.has(t)?r.get(t):void 0};r({initializing:!0,menuPanelConfig:t()});const o=t();if(null!=o&&o.lazyLoadSource){var n;const e=null===(n=o.lazyLoadSource)||void 0===n?void 0:n.call(o);e instanceof Promise?e.then((()=>{r((e=>({...e,initializing:!1})))})):r((e=>({...e,initializing:!1})))}else null!=o&&o.content&&r((e=>({...e,initializing:!1})))}),[e[b.j.WorkbenchSiderMenuPanel]]);const{initializing:o,menuPanelConfig:n}=t,i=(0,Pe.k)(null==n?void 0:n.skeleton,null);return(0,Oe.jsx)("div",{id:null==n?void 0:n.id,className:ke()("workbench-sider-menu-panel-container",(0,Pe.k)(null==n?void 0:n.className,"")),children:o?i:(0,Pe.k)(null==n?void 0:n.content,null,{extraParams:e.extraParams})})})),Ee=(0,we.x)([b.j.WorkbenchSiderMenuPanel])(xe);var De=r(27175);const Ae=({updateSidebarWidth:e,isSiderCollapsed:t})=>{const r=(0,u.useRef)(!1),[o,n]=(0,u.useState)(!1),i=(0,u.useRef)(null),s=(0,Re.Y)(g.Mp.SiderMenu),a=(0,u.useCallback)((t=>{if(r.current)return;if(i.current&&(t.target===i.current||i.current.contains(t.target)))return;n(!0),r.current=!0;const o=t=>{if(!r.current)return;const o=t.clientX;t.stopImmediatePropagation(),e(o)},s=()=>{r.current=!1,n(!1),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",s)};window.addEventListener("mouseup",s),window.addEventListener("mousemove",o)}),[e]);return(0,Oe.jsx)(Oe.Fragment,{children:(0,Oe.jsxs)("div",{className:ke()("resize-bar-container",o?"active":void 0,{"is-collapsed":t}),children:[(0,Oe.jsx)("div",{className:ke()("resize-bar"),onMouseDown:a}),(0,Oe.jsx)(Ce.Z,{className:"resize-bar-tooltips-container",position:"right",triggerProps:{trigger:"hover",autoFitPosition:!1},content:(0,Oe.jsxs)(Oe.Fragment,{children:[(0,Oe.jsx)("span",{children:De.ZP.t("web_keyboard_text_Show_hide_panel",{},"Show or hide panel")}),(0,Oe.jsx)("span",{className:"tooltip-shortcut-tips",children:" \u2318/ "})]}),children:(0,Oe.jsx)("span",{className:"resize-handler-btn",ref:i,onClick:()=>{null==s||s.toggleMenuPanel({mode:"manual",actionType:"click"})},children:t?(0,Oe.jsx)(Te.WFs,{size:12,className:"arrow"}):(0,Oe.jsx)(Te.GBr,{size:12,className:"arrow"})})})]})})},Be=(0,we.x)([b.j.WorkbenchSiderMenu,b.j.WorkbenchSiderMenuPanel,ge.R.HideLogo,ge.R.BackLogoConfirguation])((({className:e,style:t,onSiderFadeInLeft:r,isSiderCollapsed:o,displayMode:n,updateSidebarWidth:i,forwardedRef:s,...a})=>{var c;const l=(0,Re.Y)(g.Mp.SiderMenu),d=(0,u.useMemo)((()=>{var e,t;const r=a[b.j.WorkbenchSiderMenu];return{...r,top:null===(e=r.top)||void 0===e?void 0:e.filter((e=>{var t;return!(null!==(t=e.shouldHide)&&void 0!==t&&t.call(e))})),bottom:null===(t=r.bottom)||void 0===t?void 0:t.filter((e=>{var t;return!(null!==(t=e.shouldHide)&&void 0!==t&&t.call(e))}))}}),[a[b.j.WorkbenchSiderMenu]]),f=a[b.j.WorkbenchSiderMenuPanel],h=a[ge.R.HideLogo],p=a[ge.R.BackLogoConfirguation],v=(0,u.useRef)(null),y=(0,u.useCallback)((e=>{var t;null===(t=e.onClick)||void 0===t||t.call(e);const o=null==l?void 0:l.toggleMenuPanelByName(e.name);r(Boolean(o))}),[r,l]);return(0,u.useEffect)((()=>{const e=new ResizeObserver((e=>{for(const t of e){const e=t.target,r=e.clientHeight;e.scrollHeight>r?e.classList.add("scrollbar-visible"):e.classList.remove("scrollbar-visible")}})),t=()=>{const e=v.current;e.scrollTop+e.clientHeight>=e.scrollHeight?e.classList.remove("scrollbar-visible"):e.classList.add("scrollbar-visible")};return v.current&&(e.observe(v.current),v.current.addEventListener("scroll",t)),()=>{v.current&&(e.unobserve(v.current),v.current.removeEventListener("scroll",t))}}),[v]),(0,Oe.jsxs)("div",{className:ke()("workbench-layout-sider",e,{"is-collapsed":o}),style:t,ref:s,children:[(0,Oe.jsxs)("div",{className:"menu-list","lv-theme-version":"2.0","data-lv-theme-force":"dark",children:[(0,Oe.jsx)("div",{className:"menu-list-head",children:!h&&(0,Oe.jsx)(Ce.Z,{disabled:!(null!=p&&p.showToolTip),content:De.ZP.t("web_back_to_top",{},"Home"),children:(0,Oe.jsx)("div",{className:ke()("logo",{cursor:!(null!=p&&p.disableBackCursor)}),onClick:()=>{var e;null!=p&&null!==(e=p.disableLogoRedirect)&&void 0!==e&&e.call(p)||(window.location.href=`${window.location.origin}/my-edit`)},children:(0,Oe.jsx)(Te.RqY,{width:25.46,height:20})})})}),(0,Oe.jsxs)("div",{ref:v,className:ke()("workbench-layout-sider-scroll"),children:[(0,Oe.jsx)(je.Z,{className:"menu-item-container",tooltipProps:{disabled:!0},children:null===(c=d.top)||void 0===c?void 0:c.map((e=>{var t;return(0,Oe.jsxs)(u.Fragment,{children:[e.appendDividerBefore?(0,Oe.jsx)("div",{className:"sider-menu-divider"}):null,(0,Oe.jsx)(Ie,{active:e.name===(null===(t=d.activeTarget)||void 0===t?void 0:t.name),data:e,onClick:y},e.name),e.appendDividerAfter?(0,Oe.jsx)("div",{className:"sider-menu-divider"}):null]},e.name)}))}),(0,Oe.jsx)("div",{className:ke()("menu-list-foot","sider-menu-actions"),children:d.bottom.map((e=>(0,Oe.jsx)(Me,{data:e},e.name)))})]})]}),(0,Oe.jsx)("div",{className:ke()("layout-container","lv-theme-force_dark",{}),"lv-theme-version":"2.0","data-lv-theme-force":"dark",children:(()=>{const e=[];for(const o of f.panelRenderTags.values()){var t,r;e.push((o.hasRendered||o.needPreRender)&&(0,Oe.jsx)("div",{className:"menu-panel-list-wrapper",style:{display:(null===(t=d.activeTarget)||void 0===t?void 0:t.name)===o.name?"block":"none"},children:(0,Oe.jsx)(Ee,{activeTarget:o.name,extraParams:(null===(r=d.activeTarget)||void 0===r?void 0:r.name)===o.name?f.extraParams:void 0})},o.name))}return e})()}),(0,Oe.jsx)(Ae,{isSiderCollapsed:o,updateSidebarWidth:i})]})})),Ue=(0,u.forwardRef)(((e,t)=>(0,Oe.jsx)(Be,{...e,forwardedRef:t})));var Ne=r(41790),Fe=r(80887),Le=r(41308);const We=({menuItems:e,moreMenuConfig:t})=>{const r=(0,u.useMemo)((()=>{const t={};for(const a of e){var r,o,n,i,s;const e=null!==(r=null===(o=a.showInMenu)||void 0===o?void 0:o.group)&&void 0!==r?r:"none";t[e]||(t[e]=[]),null===(n=t[e])||void 0===n||null===(i=(s=n).push)||void 0===i||i.call(s,a)}return t}),[e]),o=(0,u.useMemo)((()=>Object.keys(r)),[r]);return(0,Oe.jsx)(Ne.Z,{trigger:"hover",unmountOnExit:!1,popupAlign:{bottom:[0,10]},droplist:(0,Oe.jsx)(je.Z,{className:"title-bar-more-menu",children:o.map(((e,t)=>(0,Oe.jsxs)(u.Fragment,{children:[r[e].length&&(0,Oe.jsx)(je.Z.ItemGroup,{title:Je(e),children:r[e].map((e=>{var t,r,o;return null!=e&&null!==(t=e.showInMenu)&&void 0!==t&&t.withMenu?(0,Oe.jsx)(je.Z.Item,{children:null===(r=e.menuRender)||void 0===r?void 0:r.call(e)},e.name):(0,Oe.jsxs)(u.Fragment,{children:[" ",null===(o=e.menuRender)||void 0===o?void 0:o.call(e)," "]},e.name)}))},e),t<Object.keys(o).length-1&&(0,Oe.jsx)(Fe.Z,{className:"more-menu-divider"})]},e)))}),position:"br",children:(0,Oe.jsxs)("div",{className:"title-bar-more-menu-btn",children:[(0,Oe.jsx)(Le.PI0,{fontSize:18}),("fail"===t.menuStatus||t.menuNumber)&&(0,Oe.jsx)("div",{className:"red-point-tip",children:"fail"===t.menuStatus?"!":t.menuNumber})||null]})})},$e=({data:e,headerLayoutWidth:t})=>{const r="function"==typeof e.content?e.content():e.content||null,o=u.Children.toArray(r).map(((e,r)=>u.isValidElement(e)?u.cloneElement(e,{headerlayoutwidth:t,key:r}):e));return(0,Oe.jsx)(Oe.Fragment,{children:o})};var Ge=r(19127),Ve=r(24451);const Ke="btn-eFPASu";r(15950);const He=({data:e})=>{var t;const r=(0,Pe.k)(null==e?void 0:e.isDisable,!1);let o;"function"==typeof(null==e?void 0:e.tooltips)&&(o=(0,Pe.k)(null==e?void 0:e.tooltips(),void 0));const n=(0,me.merge)({className:"wb-btn-tooltips",position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:o},null!==(t=e.tooltipProps)&&void 0!==t?t:{}),{btnProps:i}=e,s=(0,Oe.jsx)(Ve.Z,{...i,className:ke()("title-bar-btn",Ke,(0,Pe.k)(e.className,""),{disable:r}),disabled:r,loading:(0,Pe.k)(e.isLoading,!1),onClick:()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)},children:(0,Pe.k)(e.text,"")});return o?(0,Oe.jsx)(Ce.Z,{...n,children:s}):s},Ye=({data:e,headerLayoutWidth:t})=>{switch(e.type){case U:return(0,Oe.jsx)(Ge.a,{data:e});case F:return(0,Oe.jsx)($e,{data:e,headerLayoutWidth:t});case N:return(0,Oe.jsx)(He,{data:e});default:return null}},qe=200,ze=302,Ze=200;function Qe(e,t,r,o){var n,i;switch(e.position){case"left":var s,a;t.totalWidth-=null!==(s=null===(a=t[e.name])||void 0===a?void 0:a.width)&&void 0!==s?s:0;break;case"right":var c,u;o.totalWidth-=null!==(c=null===(u=o[e.name])||void 0===u?void 0:u.width)&&void 0!==c?c:0;break;case"center":r.totalWidth-=null!==(n=null===(i=r[e.name])||void 0===i?void 0:i.width)&&void 0!==n?n:0;break;default:(0,l.ss)()}}const Je=e=>{var t;return null!==(t={help:De.ZP.t("workspace_feedbackwe",{},"Help"),options:"Options",none:""}[e])&&void 0!==t?t:""},Xe=e=>"function"==typeof e.style?e.style():e.style,et=(e,t,r)=>((e,t)=>(0,Pe.k)(e.shouldHidden,!1)||t===ye.w.readonly&&e.onlyShowedWhenEditable)(e,r)?null:(0,Oe.jsxs)(u.Fragment,{children:[e.appendDividerBefore?(0,Oe.jsx)("div",{className:"title-bar-divider"}):null,(0,Oe.jsx)("div",{"data-id":e.name,style:Xe(e),children:(0,Oe.jsx)(Ye,{data:e,headerLayoutWidth:t})}),e.appendDividerAfter?(0,Oe.jsx)("div",{className:"title-bar-divider"}):null]},e.name);var tt=r(71380);const rt=e=>`fake-render-title-bar-${e}`,ot=(0,me.throttle)((({renderMenus:e,setHeaderIconSizeMap:t,selector:r})=>{const o={left:{totalWidth:0},center:{totalWidth:0},right:{totalWidth:0}};for(let i=0;i<e.length;i++){const t=e[i],n=window.document.querySelector(`#${r(i)}`);if(null!==n){const e=n.getBoundingClientRect();o[t.position][t.name]={width:e.width,height:e.height},o[t.position].totalWidth+=e.width}}var n;((n=o).left.totalWidth||n.right.totalWidth||n.center.totalWidth)&&t(o)}),300);const nt=(0,u.memo)((({group:e,...t})=>{var r,o,n,i,s;const{className:a,containerPaddingX:c,centerBoxPaddingX:l,iconBtnWidth:d,renderMenuConfig:f}=t[ge.R.TitleBar],h=t[ge.R.WorkbenchMode],p=(0,u.useMemo)((()=>{const r=t[b.j.WorkbenchTitleBar]||{left:[],center:[],right:[],moreMenuConfig:{menuStatus:"none",menuNumber:0}},o=t=>t.filter((t=>e?(t.group===e||"all"===t.group)&&!(0,Pe.k)(t.shouldHidden,!1):!(t.group&&"all"!==t.group||(0,Pe.k)(t.shouldHidden,!1))));return{left:o(r.left),center:o(r.center),right:o(r.right),moreMenuConfig:{menuStatus:r.moreMenuConfig.menuStatus,menuNumber:r.moreMenuConfig.menuNumber}}}),[t[b.j.WorkbenchTitleBar]]),v=(0,u.useMemo)((()=>function(e){const t=[];return Object.values(e).forEach((e=>{e instanceof Array&&e.forEach((e=>{e.menuRender&&t.push(e)}))})),t.sort(((e,t)=>{var r,o,n,i;return(null!==(r=null==t||null===(o=t.showInMenu)||void 0===o?void 0:o.priority)&&void 0!==r?r:0)-(null!==(n=null==e||null===(i=e.showInMenu)||void 0===i?void 0:i.priority)&&void 0!==n?n:0)}))}(p)),[p]),g=(0,u.useRef)(null),y=(e=>{const[t,r]=(0,u.useState)();return(0,u.useEffect)((()=>{if(e.current){const t=new ResizeObserver((e=>{for(const t of e){const{offsetWidth:e,offsetHeight:o}=t.target;r({width:e,height:o})}}));return t.observe(e.current,{box:"border-box"}),()=>{t.disconnect()}}}),[e.current]),t})(g),[m,_]=(0,u.useState)(!0),{headerIconSizeMap:R,renderedComponents:S}=function(e){const t=(0,u.useMemo)((()=>{const{headers:t}=e;return t?[...t.left,...t.center,...t.right]:[]}),[e.headers]),[r,o]=(0,u.useState)();return(0,u.useLayoutEffect)((()=>ot({renderMenus:t,selector:rt,setHeaderIconSizeMap:o})),[t]),{headerIconSizeMap:r,renderedComponents:(0,u.useMemo)((()=>t.map(((e,t)=>{try{return tt.renderToString((0,Oe.jsx)("div",{className:"fake-render-title-bar-node",id:rt(t),children:et(e)}))}catch(r){return""}}))),[t])}}({headers:p});(0,u.useEffect)((()=>{R&&_(!1)}),[R]);const[k,T]=(0,u.useState)(void 0),[C,j]=(0,u.useState)(void 0),[P,O]=(0,u.useState)(Ze),[M,I]=(0,u.useState)({left:[],center:[],right:[]});(0,u.useEffect)((()=>{var e,t;if(m||!R)return;const r=(0,Pe.k)(null==f?void 0:f.style,{marginRight:"8px"}),o=function(e){const{containerDom:t,storeIconSize:r,allowShowInMenu:o,containerBoxRect:n}=e,i=function(e){const{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}}(t),s=(0,me.cloneDeep)(r.left);s.totalWidth+=n.leftBoxPadding;const a=(0,me.cloneDeep)(r.center);a.totalWidth+=2*n.centerBoxPadding,a.totalWidth=Math.max(a.totalWidth,ze);const c=(0,me.cloneDeep)(r.right);c.totalWidth+=n.rightBoxPadding;const l=()=>i.width;let u=!1;const d=new Set,f=l();for(const g of o){var h;((null==g||!g.content)&&null!=g&&g.menuRender||null!=g&&null!==(h=g.shouldRenderInMenu)&&void 0!==h&&h.call(g,f))&&(Qe(g,s,a,c),d.add(g),!u&&null!=g&&g.menuRender&&(u=!0,c.totalWidth+=n.iconBtnSize))}let p=0;for(;p<o.length&&!(i.width/2-a.totalWidth/2>=c.totalWidth);){const e=o[p];if(p++,d.has(e))continue;d.add(e),Qe(e,s,a,c);const t=null==e?void 0:e.menuRender;!u&&t&&(u=!0,c.totalWidth+=n.iconBtnSize)}const v=i.width/2-a.totalWidth/2;return{showInMenu:Array.from(d).sort(((e,t)=>{var r,o,n,i;return(null!==(r=null==t||null===(o=t.showInMenu)||void 0===o?void 0:o.priority)&&void 0!==r?r:0)-(null!==(n=null==e||null===(i=e.showInMenu)||void 0===i?void 0:i.priority)&&void 0!==n?n:0)})),aroundWidth:v,headerBarWidth:l(),rightContainerMinWidth:c.totalWidth>v?c.totalWidth:Ze}}({containerDom:g.current,allowShowInMenu:null!=v?v:[],storeIconSize:R,containerBoxRect:{leftBoxPadding:"number"==typeof c?c:c[0],rightBoxPadding:"number"==typeof c?c:c[1],iconBtnSize:d+(parseFloat(`${null!==(e=null==r?void 0:r.marginRight)&&void 0!==e?e:"0"}`)||0)+(parseFloat(`${null!==(t=null==r?void 0:r.marginLeft)&&void 0!==t?t:"0"}`)||0),centerBoxPadding:l}});T(o.aroundWidth),j(o.headerBarWidth),O(o.rightContainerMinWidth);const n=o.showInMenu.filter((e=>Boolean(null==e?void 0:e.menuRender)));I(function(e,t,r){var o,n,i;if(!t.length)return{left:e.left,center:e.center,right:e.right};const s=(0,me.cloneDeep)(e),a={type:"Custom",name:"titleBarMoreMenu",position:null!==(o=null==r?void 0:r.position)&&void 0!==o?o:"right",order:null!==(n=null==r?void 0:r.order)&&void 0!==n?n:0,orderLevel:null!==(i=null==r?void 0:r.orderLevel)&&void 0!==i?i:w.r.low,style:null==r?void 0:r.style,content:()=>(0,Oe.jsx)(We,{menuItems:t,moreMenuConfig:s.moreMenuConfig})},c=s[a.position].findIndex((e=>e.name===a.name));-1===c?s[a.position].push(a):s[a.position][c]=a;const l=t.map((e=>e.name));return{left:(0,w.l)({list:s.left.filter((e=>!l.includes(e.name)))}),center:(0,w.l)({list:s.center.filter((e=>!l.includes(e.name)))}),right:(0,w.l)({list:s.right.filter((e=>!l.includes(e.name)))})}}(p,n,f))}),[null==y?void 0:y.width,R,m,v,p,c,d,l,f]);const x=e=>null==M?void 0:M[e];return(0,Oe.jsxs)("div",{className:ke()("workbench-layout-header-container",a),ref:g,children:[(0,Oe.jsx)("div",{className:"header-left",style:{minWidth:qe,width:k,paddingLeft:null!==(r=null==c?void 0:c[0])&&void 0!==r?r:c},children:null===(o=x("left"))||void 0===o?void 0:o.map((e=>et(e,C,h)))}),(0,Oe.jsx)("div",{className:"header-center",style:{minWidth:ze,paddingLeft:l,paddingRight:l},children:null===(n=x("center"))||void 0===n?void 0:n.map((e=>et(e,C,h)))}),(0,Oe.jsx)("div",{className:ke()("header-right"),style:{minWidth:P,width:k,paddingRight:null!==(i=null==c?void 0:c[1])&&void 0!==i?i:c},children:null===(s=x("right"))||void 0===s?void 0:s.map((e=>et(e,C,h)))}),(0,Oe.jsx)("div",{className:"temp-header-for-calc",dangerouslySetInnerHTML:{__html:S.join("")}})]})})),it=(0,we.x)([b.j.WorkbenchTitleBar,ge.R.TitleBar,ge.R.WorkbenchMode])(nt);var st=r(35518);const at=(0,we.x)([b.j.WorkbenchEditorContainer])((e=>{var t;const r=(0,u.useRef)(null),o=e[b.j.WorkbenchEditorContainer];return(0,Oe.jsxs)("div",{id:"workbench-editor-container",className:"workbench-editor-container",ref:r,children:[null===(t=o.editors)||void 0===t?void 0:t.map((e=>(0,Oe.jsx)(u.Fragment,{children:(0,Pe.k)(e.content,null)},e.name))),(0,Oe.jsx)(st.u,{containerRef:r})]})}));var ct=r(95291);const lt="container-ugYaai",ut="active-t5s8CQ",dt="content-O0t6bx",ft="action-container-O7MSXb";var ht=r(23439),pt=r(55360),vt=r(59699);const gt=({data:e,titleBarHeight:t,boundingBox:r,containerRef:o})=>{var n,i;const s="operate-panel-title",a=(0,Pe.k)(e.title,null),c=(()=>{const t=(0,Pe.k)(e.titleActions,[]);return t?t instanceof Array?t.map((e=>{var t;const r=(0,me.merge)({className:"wb-icon-btn-tooltips",position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:e.tooltips},null!==(t=e.tooltipProps)&&void 0!==t?t:{});return(0,Oe.jsx)(Ce.Z,{...r,children:(0,Oe.jsx)(Ve.Z,{className:ke()("wb-operate-panel-action-btn",{active:null==e?void 0:e.active}),type:"text",disabled:e.disable,icon:e.icon,onClick:e.onClick})})})):t:null})(),l=(0,u.useMemo)((()=>{var e;const t=document.createElement("div");return t.className="operate-panel-wrapper",null===(e=o.current)||void 0===e||e.appendChild(t),t}),[]),d=(0,u.useRef)(l),f=(0,u.useRef)({left:window.innerWidth-vt.jt-vt.AH-vt.dd,top:vt.KR,right:vt.jt+vt.AH+vt.dd});return(0,u.useEffect)((()=>()=>{r.reset(),l.remove()}),[e]),(0,Oe.jsx)(pt.q,{uniqueId:e.name,draggerHandlerSelection:`.${s}`,popupContainerRef:d,isPinned:!1,onClose:void 0,content:(0,Oe.jsxs)("div",{id:e.id,className:ke()("operate-panel-container",(0,Pe.k)(e.className,""),{draggable:null===(n=e.draggable)||void 0===n||n}),children:[null!==a?(0,Oe.jsxs)("div",{className:ke()(s),children:[(0,Oe.jsx)(Ce.Z,{position:"bottom",content:(0,Pe.k)(e.title,null),checkOverflow:e=>Boolean(e.scrollWidth>e.clientWidth),triggerProps:{mouseEnterDelay:300},children:(0,Oe.jsx)("div",{className:"title-left",children:(0,Pe.k)(e.title,null)})}),(null===(i=e.draggable)||void 0===i||i)&&(0,Oe.jsx)(Te.zsX,{size:24,className:"operate-panel-draggable-icon"}),(0,Oe.jsx)("div",{className:"title-actions",children:c})]}):null,(0,Pe.k)(e.content,null)]}),defaultPosition:f.current,boundOffset:{left:0,top:vt.KR+t,bottom:vt.Bn}})},yt=(0,we.x)([ge.R.TitleBar,b.j.WorkbenchOperateDetailsPagePanel])((e=>{const t=e[ge.R.TitleBar],r=(0,u.useMemo)((()=>{const t=[],{activeGroup:r,panels:o}=e[b.j.WorkbenchOperateDetailsPagePanel];for(const e of o.values())e.group===r&&t.push(e);return t}),[e[b.j.WorkbenchOperateDetailsPagePanel]]),o=(0,u.useRef)(new ht.k);return(0,Oe.jsx)(Oe.Fragment,{children:null==r?void 0:r.map((r=>(0,Oe.jsx)(gt,{data:r,titleBarHeight:t.containerHeight,boundingBox:o.current,containerRef:e.containerRef},r.name)))})})),mt=(0,we.x)([b.j.WorkbenchOperateDetailsPage])((e=>{const{activeTarget:t,pages:r}=e[b.j.WorkbenchOperateDetailsPage],o=t?r.get(t):void 0,n=(0,u.useRef)(null),i=(0,u.useMemo)((()=>{const e=document.createElement("div");return e.className="operate-details-page-container",document.body.appendChild(e),e}),[]),s=(0,u.useRef)(i);return ct.createPortal((0,Oe.jsx)("div",{ref:n,className:ke()(lt,{[ut]:Boolean(o)}),children:o?(0,Oe.jsxs)(Oe.Fragment,{children:[(0,Oe.jsx)(it,{group:o.name}),(0,Oe.jsxs)("div",{className:dt,children:[(0,Oe.jsx)("div",{className:ke()("workbench-operate-tool",ft),children:(0,Oe.jsx)(yt,{containerRef:n})}),(0,Pe.k)(o.content,null)]})]}):null}),s.current)}));var _t;!function(e){e[e.Fixed=0]="Fixed",e[e.Float=1]="Float"}(_t||(_t={}));const bt=724,Rt=408,wt=(e,t)=>window.innerWidth-parseInt(e,10)-t,St=(0,we.x)([ge.R.SiderMenu,ge.R.TitleBar,ge.R.Visible,ge.R.HideSiderMenu,b.j.WorkbenchSiderMenu])((e=>{var t;const{[ge.R.SiderMenu]:r,[ge.R.TitleBar]:o,[ge.R.HideSiderMenu]:i,[ge.R.Visible]:a}=e,{width:c}=r.menuSize,l=null!=c?c:76,{min:d,max:f,default:h,current:p}=r.panelSize,v=null!=d?d:240,y=null!=f?f:700,m=null!=h?h:280,_=null!=p?p:m,b=724+v+l,R=(0,Re.Y)(g.Mp.SiderMenu),w=(0,Re.Y)(s.I),S=window.innerWidth<b?_t.Float:_t.Fixed,[k,T]=(0,u.useState)(null!=r&&r.disableFloatMode?_t.Fixed:S),C=(0,u.useMemo)((()=>k===_t.Float),[k]),j=null!==(t=null==R?void 0:R.siderTransitionState)&&void 0!==t?t:n.expanded;(0,u.useEffect)((()=>{null==R||R.setSiderTransitionState(window.innerWidth<1080?n.collapsed:n.expanded)}),[R]);const P=(0,u.useMemo)((()=>j===n.collapsed),[j]),O=(0,u.useMemo)((()=>[n.shrinking,n.growing].includes(j)),[j]),[M,I]=(0,u.useState)();(0,u.useEffect)((()=>{I(P?l:_+l)}),[P,_]);const x=(0,u.useRef)(null),E=(0,u.useRef)(null),D=(0,u.useRef)(!1),A=(0,u.useRef)(P),B=(0,u.useRef)(null),[U,N]=(0,u.useState)("");(0,u.useLayoutEffect)((()=>{document.body.setAttribute("lv-theme-version","2.0")}),[]);const F=(0,u.useCallback)((e=>{const t=null!=e?e:!P;if(A.current=Boolean(t),t!==P&&!O)return new Promise(C?e=>{null==R||R.setSiderTransitionState(t?n.collapsed:n.expanded),e(null)}:e=>{x.current?(null==R||R.setSiderTransitionState(t?n.collapsed:n.expanded),I(l+(t?0:_)),e(null)):e(null)})}),[P,O,C,R,_]);(0,u.useEffect)((()=>{const e=j===n.collapsed;e!==A.current&&F(e)}),[j]),(0,u.useEffect)((()=>{P&&(null==R||R.unActiveMenu())}),[P,R]);const L=(0,u.useCallback)((e=>{F(e),D.current=!0}),[F]),W=(0,u.useMemo)((()=>{if(C||P)return`${l}px`;return M?`${Math.max(M,l)}px`:void 0}),[C,P,M]);(0,u.useEffect)((()=>{if(!x.current||void 0===W)return;const e=wt(W,bt);N(e>0?`calc(100vw - ${W})`:"724px")}),[W,x]),(0,u.useEffect)((()=>{if(null!=r&&r.disableFloatMode)return;let e=window.innerWidth;const t=(0,me.throttle)((()=>{if(!x.current||!W)return;const t=wt(W,bt),r=wt(W,1600),o=window.innerWidth-1956,n=window.innerWidth-2056;N(t>0?`calc(100vw - ${W})`:"724px");const i=window.innerWidth;if(i<e){if(n<0&&o>0)return null==w||w.updateSiderMenu({panelSize:{current:_+n}}),void I(_+n+l);if(o<0&&t>0)return null==w||w.updateSiderMenu({panelSize:{current:280}}),void I(280+l);if(t<0){const e=M-(_-v);_+t<v&&((async()=>{await F(!0)})(),T(_t.Float)),null==w||w.updateSiderMenu({panelSize:{current:Math.max(v,_+t)}}),I(Math.max(e,M+t))}}else{if(t>0&&T(_t.Fixed),P&&window.innerWidth>b)return null==w||w.updateSiderMenu({panelSize:{current:v}}),I(v+l),void(null==R||R.toggleMenuPanel({mode:"auto"}));_<(r>0?Rt:m)&&(null==w||w.updateSiderMenu({panelSize:{current:_+10}}),I(_+10+l)),window.innerWidth>=2056&&(null==w||w.updateSiderMenu({panelSize:{current:Rt}}),I(Rt+l))}e=i}),20);return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[null==r?void 0:r.disableFloatMode,W,_,P]);const $=(0,u.useCallback)((e=>{D.current=!0;const t=Math.min(Math.max(e-l,v),y);null==w||w.updateSiderMenu({panelSize:{current:t}})}),[]);return(0,be.Z)(E,(()=>{C&&F(!0)})),(0,u.useEffect)((()=>{document.body.setAttribute("style",`--workbench-title-bar-height:${null==o?void 0:o.containerHeight}px`)}),[null==o?void 0:o.containerHeight]),(0,u.useEffect)((()=>{var e;const t=e=>{e.ctrlKey&&e.preventDefault()};return null===(e=B.current)||void 0===e||e.addEventListener("wheel",t,{passive:!1}),()=>{var e;return null===(e=B.current)||void 0===e?void 0:e.removeEventListener("wheel",t)}}),[]),(0,u.useEffect)((()=>{window.innerWidth>1956?null==w||w.updateSiderMenu({panelSize:{current:Rt}}):window.innerWidth>1080&&(null==w||w.updateSiderMenu({panelSize:{current:280}}))}),[w]),(0,Oe.jsxs)(_e.Z,{id:"workbench",className:ke()("workbench-container",{hidden:!a}),style:{"--sider-width":i?"0px":null!=W?W:`${m+l}px`,"--editor-container":U,"--sider-expanded-width":`${m}px`,"--workbench-title-bar-height":`${null==o?void 0:o.containerHeight}px`},ref:B,children:[(0,Oe.jsx)(_e.Z.Sider,{className:ke()(O&&"sider-slide"),ref:x,collapsed:P,collapsedWidth:l,style:{transform:`translateX(${i?"-1000px":"0px"})`,zIndex:C?999:100,"--sider-expanded-width":M?`${P?l:_}px`:void 0},trigger:null,theme:"dark",children:(0,Oe.jsx)(Ue,{ref:E,onSiderFadeInLeft:L,isSiderCollapsed:P,displayMode:k,updateSidebarWidth:$})}),(0,Oe.jsxs)(_e.Z.Content,{style:{zIndex:99},children:[(0,Oe.jsx)(it,{}),(0,Oe.jsx)(at,{})]}),(0,Oe.jsx)(mt,{})]})})),kt=()=>((0,u.useLayoutEffect)((()=>{document.body.setAttribute("lv-theme-version","2.0")}),[]),(0,Oe.jsxs)(_e.Z,{id:"workbench",className:"workbench-container workbench-readonly",children:[(0,Oe.jsx)(it,{}),(0,Oe.jsx)(at,{width:"100vw"})]})),Tt=(0,we.x)([ge.R.WorkbenchMode])((e=>e[ge.R.WorkbenchMode]===ye.w.editable?(0,Oe.jsx)(St,{}):(0,Oe.jsx)(kt,{})));var Ct=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};let jt=class{initServices(e){i.A.alias(g.Mp.SiderMenu,C),i.A.alias(g.Mp.SiderMenuPanel,A),i.A.alias(g.Mp.TitleBar,G),i.A.alias(g.Mp.ToolBar,z),i.A.alias(g.Mp.ToolBarPanel,ee),i.A.alias(g.Mp.EditorContainer,ne),i.A.alias(g.Mp.OperateDetailsPage,ue),i.A.alias(g.Mp.OperateDetailsPagePanel,ve),this.initServiceCollection()}updateServices(){this.collection.getControllerRelatedUIServices().forEach((e=>{e.updateState()}))}initMiddlewares(e){}getComponent(){const e=new B.x9;return i.A.factory(B.x9,e),new Promise(((t,r)=>{i.A.get(I.L).invokeFunction((async r=>{const o=r.get(f.S);await o.allowToRender(),t((0,Oe.jsx)(B.FN.Provider,{value:e,children:(0,Oe.jsx)(y.W,{backend:m.PD,children:(0,Oe.jsx)(Tt,{})})}))}))}))}attach(e){return new Promise((async t=>{this.collection.services.forEach((e=>{e.$forceUpdate()})),d.createRoot(e).render(await this.getComponent()),setTimeout((()=>{t()}))}))}initServiceCollection(){const e=[C,A,G,z,ee,ne,ue,ve];this.collection=i.A.invoke(v.Z,void 0,e),i.A.factory(v.Z,this.collection)}};jt=Ct([(0,h.t)()],jt);class Pt{static async load(e,t,r){const o=i.A.invoke(s.I,new Map([["container",t],["platform","pc"],["titleBar",r]]));i.A.factory(s.I,o),i.A.factory(p.B,new jt);const n=i.A.invoke(e);return await n.start(),n}}var Ot=r(97560),Mt=r(9541),It=r(43110),xt=r(14548),Et=r(84647);const Dt="logoReadonly-ISp9Bi",At=()=>(0,Oe.jsx)(Ce.Z,{content:De.oc.t("web_sharereview_button_back_to_space",{},"Back to Space"),children:(0,Oe.jsx)("div",{className:Dt,onClick:()=>{window.location.href=`${window.location.origin}/my-edit`},children:(0,Oe.jsx)(Te.RqY,{width:28,height:20})})});var Bt,Ut=r(32085),Nt=r(68099),Ft=function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},Lt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Wt=function(e,t){return function(r,o){t(r,o,e)}};let $t=class extends a.JT{get onSiderMenuPanelWidthChange(){return i.A.get(s.I).onSiderMenPanelWidthChange}get onSiderMenuExpandedChange(){return i.A.get(C).onSiderMenuExpandedChange}constructor(e,t){super(),this._keybindingService=t,this._contributions=[],this._onVisibleChange=this._store.add(new c.Q),this.onVisibleChange=this._onVisibleChange.event,this._onOperateDetailPageOpen=this._store.add(new c.Q),this.onOperateDetailPageOpen=this._onOperateDetailPageOpen.event,this._onOperateDetailPageClose=this._store.add(new c.Q),this.onOperateDetailPageClose=this._onOperateDetailPageClose.event,this._options=e;const{loader:r,titleBar:o,...n}=e;Mt.S.set(Mt.h.WORKBENCH_SETTINGS,n,r),this._bindingKeyboardActions()}get visible(){return i.A.get(s.I).visible}get options(){return this._options}get container(){return this.options.container}async bootstrap(){const{container:e,loader:t,titleBar:r,visible:o}=this._options;await Pt.load(t,e,r);i.A.get(s.I).visible=null==o||o}show(){const e=i.A.get(s.I);e.visible||(this._options.container.classList.add("batch-editor-graphic-show"),e.visible=!0,this._onVisibleChange.fire(!0))}hidden(){const e=i.A.get(s.I);e.visible&&(this._options.container.classList.remove("batch-editor-graphic-show"),e.visible=!1,this._onVisibleChange.fire(!1))}getWorkbenchSize(){const e=i.A.get(s.I),{container:t}=e,r=t.getBoundingClientRect();return{width:r.width,height:r.height}}getSiderBarWidth(){return i.A.get(s.I).siderMenu.menuSize.width}getSiderBarPanelWidth(){return i.A.get(s.I).siderMenu.panelSize.current}getTitleBarHeight(){return i.A.get(s.I).titleBar.containerHeight}getActiveSiderMenuPanelId(){return i.A.get(A).activeTarget}getActiveSiderMenuDelta(){const e=i.A.get(C);return(0,l.Y2)(e.activeSiderMenu,"unexpected logic"),{mode:e.activeSiderMenuMode,extraParams:e.activeExtraParams}}getToolbarIsfixedPanel(){var e;const t=i.A.get(s.I);return Boolean((null===(e=t.toolBar)||void 0===e?void 0:e.panelMode)===st._.FIXED)}setToolbarPanelMode(e){var t;const r=i.A.get(s.I),o=null===(t=r.toolBar)||void 0===t?void 0:t.panelMode;r.toolBar={...r.toolBar,panelMode:e};const n=i.A.get(g.Mp.ToolBar),a=n.getActiveToolbarName();"float"!==o||o===e||a||n.activeDefaultToolbar()}setWorkbenchMode(e){i.A.get(s.I).workbenchMode=e,e===ye.w.readonly&&this.updateUIConfig({titleBar:[{name:"logo-readonly",type:"Custom",position:"left",appendDividerAfter:!0,style:{marginRight:14},content:()=>(0,Oe.jsx)(At,{})}]})}hideLogo(e){i.A.get(s.I).hideLogo=e}hideSiderMenu(e){i.A.get(s.I).hideSiderMenu=e}registerBackLogoConfirguation(e){i.A.get(s.I).backLogoConfirguation=e}setInstantiationService(e){this._instantiationService=e,i.A.get(I.L).setOuterInstantiationService(e)}updateUIConfig(e){Et.p.merge(xt.m,e);i.A.get(It.H).buildController(xt.m,!0);const{toolBar:t}=e;t&&this._registerDefaultActiveGroup(t)}registerContribution(e){this._contributions.push(e),i.A.get(s.I).addMountSettings({controllers:[e.controller]})}unregisterContribution(e){this._contributions.length=0}registerMiddleware(e,t){i.A.get(Ot.K).use(e,t)}refreshRender(e){e?i.A.get(e).$forceUpdate():Object.keys(g.Mp).forEach((e=>{i.A.get(e).$forceUpdate()}))}activeSiderMenuByName(e,t,r){i.A.get(g.Mp.SiderMenu).activeMenuByName(e,t,r)}getActiveSideMenConfig(){return i.A.get(g.Mp.SiderMenu).activeSiderMenu}unActiveSidebarMenu(){i.A.get(g.Mp.SiderMenu).unActiveMenu()}onSiderMenuActiveChange(e){let t;return i.A.get(_.O).get(b.j.WorkbenchSiderMenu).subscribe((r=>{r.activeTarget!==t&&(t=r.activeTarget,e(t))}))}updateToolBarViewMode(e){i.A.get(g.Mp.ToolBar).updateToolBarViewMode(e)}openOperateDetailsPage(e,t){i.A.get(g.Mp.OperateDetailsPage).openOperateDetailPage(e,t)}closeOperateDetailsPage(){i.A.get(g.Mp.OperateDetailsPage).closeOperateDetailsPage()}internalFireOperateDetailPageStatus(e){"open"===e?this._onOperateDetailPageOpen.fire():this._onOperateDetailPageClose.fire()}_bindingKeyboardActions(){if(o)return;this._keybindingService.getOrCreateContext(r.g.document.body).register({keyBindings:{win:[Ut.N9.CTRL_WIN+Ut.VD.SLASH],mac:[Ut.N9.COMMAND+Ut.VD.SLASH]},handler:()=>{i.A.get(g.Mp.SiderMenu).toggleMenuPanel({mode:"manual",actionType:"shortkey"})},when:()=>!0})}_registerDefaultActiveGroup(e){const t=i.A.get(g.Mp.ToolBar);e.forEach((({defaultActiveGroupList:e,name:r})=>{e&&r&&t.registerDefaultActiveGroup(e,r)}))}setTitleBarMenuConfig(e){i.A.get(g.Mp.TitleBar).setMenuConfig(e)}};$t=Ft([Wt(1,Nt.d),Lt("design:paramtypes",[Object,"function"==typeof(Bt=void 0!==Nt.d&&Nt.d)?Bt:Object])],$t)},41800:(e,t,r)=>{r.d(t,{e:()=>o});const o=(0,r(67126).yh)("workbench")},74964:()=>{},99655:()=>{},51117:()=>{},15950:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[234,633,236,163,484,105,472,23,476,222,186,276,915,40,967,647,870,528,412,164,205,447],(()=>(t(4934),t(13670),t(56215))));e.O()}]);