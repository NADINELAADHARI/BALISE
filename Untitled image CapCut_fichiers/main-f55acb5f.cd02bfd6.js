"use strict";(globalThis.webpackChunkgraphic=globalThis.webpackChunkgraphic||[]).push([[205],{66094:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(18571),n=i(5789),a=i.n(n),o=i(72322);const s=(0,r.forwardRef)((({className:e,style:t,children:i},r)=>(0,o.jsx)("div",{className:a()("custom-skeleton-container",e),style:t,ref:r,children:i})));s.Title=({className:e,style:t})=>(0,o.jsx)("div",{className:a()("skeleton-element","skeleton-title",e),style:t}),s.SquareItem=({className:e,style:t})=>(0,o.jsx)("div",{className:a()("skeleton-element","skeleton-square-item",e),style:t}),s.Image=({className:e,style:t})=>(0,o.jsx)("div",{className:a()("skeleton-element","skeleton-image-item",e),style:t}),s.Button=({className:e,style:t})=>(0,o.jsx)("div",{className:a()("skeleton-element","skeleton-button-item",e),style:t}),s.Input=({className:e,style:t})=>(0,o.jsx)("div",{className:a()("skeleton-element","skeleton-input-item",e),style:t});const l=s},51312:(e,t,i)=>{i.d(t,{Z:()=>c});i(18571);var r=i(5789),n=i.n(r),a=i(66094);const o="container-PGfxhF";var s=i(2131),l=i(72322);const c=({header:e,isShowTitle:t=!0,searchHeader:i=!1,txtHeader:r=!1,column:c=2,maxColumn:d=4,size:u=120,className:h,active:g})=>{const{column:p,columnWidth:m,eleRef:_}=(0,s.e)({minColumn:c,maxColumn:d,gap:8,minWidth:u,active:g});return(0,l.jsx)(a.Z,{className:n()(o,h),ref:_,children:(0,l.jsxs)("div",{className:n()({"skeleton-whole-box":r||i||e}),children:[r?(0,l.jsxs)("div",{className:"skeleton-txt-header",children:[(0,l.jsx)(a.Z.Title,{className:"title"}),(0,l.jsx)(a.Z.Button,{className:"btn"}),(0,l.jsx)(a.Z.Button,{className:"btn"}),(0,l.jsx)(a.Z.Button,{className:"btn"})]}):null,i?(0,l.jsx)("div",{className:"skeleton-search-header",children:(0,l.jsx)(a.Z.Input,{className:"input"})}):null,t?(0,l.jsx)(a.Z.Title,{className:"title"}):null,(0,l.jsx)("div",{className:"skeleton-normal-list",style:{gridTemplateColumns:`repeat(${p}, 1fr)`,gridAutoRows:`${m}px`},children:new Array(13).fill(1).map(((e,t)=>(0,l.jsx)(a.Z.Image,{className:"cover"},t)))})]})})}},81907:(e,t,i)=>{i.d(t,{h:()=>m});var r=i(72135),n=i(98996),a=i(4547),o=i(10454),s=i(82440),l=i(8757),c=i(67986),d=i(76326),u=i(54643),h=i(9561),g=i(70126),p=i(72322);const m=new class{constructor(){this._container=document.createElement("div"),this._isCancel=!1,this._uploadFile=async e=>{var t;if(this._isCancel)return void(this._isCancel=!1);const i=Date.now(),r=await this._props.projectMaterialManager.uploadMaterial({file:e.file,onProgress:e.onProgress}),[n,o]=r.pair();if(this._importMaterialReport({actionType:a.lJ.CLICK_ADD,position:a.Rz.UPLOAD_IMAGE,material:o,currentPage:"picture_edit",uploadStartTime:i,...n?{status:a.Kp.FAIL,failReason:n.msg}:void 0}),this._id=null===(t=this._props.projectMaterialManager.materials)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.id,r.ok)return this._report(e.file),void this._applyImage(o);throw c.t.error("upload failed",r.msg),new Error(r.msg)},this._cancelUpload=()=>{var e;"success"!==(null===(e=this._props.projectMaterialManager.materials)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.status)&&(this._isCancel=!0,this._id&&this._props.projectMaterialManager.cancelUpload(this._id))},this._applyImage=e=>{var t,i,r,n,a;const{renderSDK:o,graphicSDK:c}=this._props,{width:h,height:g}=e;if(!h||!g)return;if(this._isCancel)return void(this._isCancel=!1);s.fc.getInstance().parser.everCloud.fetchData({id:e.md5,resourceId:e.md5,type:l.xP.EverCloud,fileUrl:{md5:e.md5,url:e.url},aesKey:e.coverKey,transcode:e.transcodeInfo});let p=Boolean(null===(t=this._props)||void 0===t?void 0:t.isCreateNewPage),m=o.getActivePageId();const _=o.getActivePageIndex(),v=c.document.getPageById(m);((null!==(i=null==v?void 0:v.getLayersByFilter(!0,(()=>!0)))&&void 0!==i?i:[]).length>0||null!=v&&null!==(r=v.background)&&void 0!==r&&r.image)&&(p=!0);const f=(0,d.F)(h,g);if(c.api.transaction.begin(),p){const e=c.api.page.add(_+1,{dimension:f});e.ok&&(m=e.pair()[1],c.api.page.updateBackgroundColor(m,[255,255,255,0]))}else c.api.page.updateBackgroundColor(m,[255,255,255,0]),c.api.page.updateDimension(m,f);c.api.image.add(m,{id:e.md5,md5:e.md5,resourceId:e.md5,type:l.lJ.CloudImageSticker},{rotation:0,opacity:1,scale:{x:1,y:1},...(0,u.SY)(f,{width:h,height:g})}),c.api.transaction.commit(),o.accessors.page.fitToWindow(),null===(n=this._props)||void 0===n||null===(a=n.onUploaded)||void 0===a||a.call(n)},this._report=e=>{var t;if(null===(t=this._props)||void 0===t||!t.isCreateNewPage)return;let{type:i}=e;if(i.startsWith("image/")){const t=e.name.split(".").pop();i=null!=t?t:e.type}(0,n.d)({format:i,size:e.size,currentPage:"picture_edit",position:"picture_edit"})},document.body.append(this._container)}show(e){this._props=e;const{onConfirm:t,onClose:i,onStatusChange:n,showUpload:a=!0,accept:s=h.NF.image.accept}=e;(0,r.y)({action:"show",position:"picture_edit"}),g.createRoot(this._container).render((0,p.jsx)(o.d,{onConfirm:t,onClose:e=>{i(e),e&&this._cancelUpload()},onStatusChange:(e,t)=>{null==n||n(e,t),"click"===e&&(this._isCancel=!0),"upload"===e&&(this._isCancel=!1)},fixedUnit:l.fb.PX,upload:{showUpload:a,accept:s,uploadFile:this._uploadFile,cancelUpload:this._cancelUpload}}))}_importMaterialReport({materialId:e,uploadStartTime:t,...i}){var r,n,o;e&&(i.material=null===(o=this._props)||void 0===o?void 0:o.projectMaterialManager.materials.find((t=>t.id===e)));t&&(i.importTime=Date.now()-t),null!==(r=this._props)&&void 0!==r&&r.isLogin&&null!==(n=this._props)&&void 0!==n&&n.draftWorkspaceInfo&&new a.JG({spaceId:this._props.draftWorkspaceInfo.space_id,spaceType:this._props.draftWorkspaceInfo.space_type,rawSpaceType:this._props.draftWorkspaceInfo.raw_space_type,spaceUserCnt:this._props.draftWorkspaceInfo.member_cnt,...i}).report()}}},11619:(e,t,i)=>{i.d(t,{U:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("web_graphic_browser_no_support_title",{},"Browser not supported"),content:r.ZP.t("web_graphic_browser_no_support_content",{},"Use Google Chrome to access CapCut Web and get the best of the web."),btnText:r.ZP.t("web_graphic_browser_no_support_download_chrome_btn",{},"Download Chrome"),onClick:()=>{"undefined"!=typeof window&&window.open("https://www.google.cn/intl/zh-cn/chrome/")},renderSvgIcon:()=>(0,o.jsx)(a.awq,{width:420,height:300})})}},55120:(e,t,i)=>{i.d(t,{u:()=>l});i(18571);var r=i(36702),n=i(24451),a=i(14906),o=i(48607),s=i(72322);const l=({title:e,content:t,btnText:i,showBtn:l=!0,onClick:c,renderSvgIcon:d})=>{r.Z.info({className:"graphic-error-full-page",icon:null,title:null,closable:!1,escToExit:!1,maskClosable:!1,footer:null,wrapStyle:{zIndex:o.tV},content:(0,s.jsxs)("div",{className:"graphic-error-page_container",children:[(0,s.jsx)("div",{className:"header",children:(0,s.jsx)(a.qMT,{size:106})}),(0,s.jsxs)("div",{className:"content-wrapper",children:[(0,s.jsxs)("div",{className:"main-content",children:[(0,s.jsx)("h2",{className:"title",children:e}),(0,s.jsx)("p",{className:"desc",children:t}),l?(0,s.jsx)(n.Z,{size:"large",type:"primary",onClick:c,children:i}):null]}),(0,s.jsx)("div",{className:"image-wrapper",children:d()})]})]})})}},42463:(e,t,i)=>{i.d(t,{G:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("could_not_open_web",{},"The current page cannot be opened"),content:r.ZP.t("web_ccwebeditor_text_error_raised",{},"You can\u2019t open this page because your browser blocks the cookies. Allow cookies in your browser and try again."),showBtn:!1,renderSvgIcon:()=>(0,o.jsx)(a.awq,{width:420,height:300})})}},52992:(e,t,i)=>{i.d(t,{W:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("web_graphic_device_no_support_title",{},"Device not supported "),content:r.ZP.t("web_graphic_device_no_support_content",{},"CapCut is not available on your device yet, Give it a try on other device instead."),showBtn:!1,renderSvgIcon:()=>(0,o.jsx)(a.OLo,{width:420,height:300})})}},799:(e,t,i)=>{i.d(t,{i:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=(e=!0)=>{(0,n.u)({title:r.ZP.t("web_graphic_package_broken_title",{},"Draft is broken"),content:r.ZP.t("web_graphic_package_broken_content",{},"This draft is broken, send us a feedback to help developers to troubleshoot issues for you."),showBtn:e,btnText:r.ZP.t("web_graphic_go_to_platform_btn",{},"Go to workspace"),onClick:()=>{window.location.href=`${window.location.protocol}//${window.location.host}/my-edit`},renderSvgIcon:()=>(0,o.jsx)(a.n$4,{width:420,height:300})})}},69148:(e,t,i)=>{i.d(t,{H:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("web_graphic_package_no_permission_title",{},"You don\u2019t have permission"),content:r.ZP.t("web_graphic_package_no_permission_content",{},"You don\u2019t have permission to view, pleases contact the owner of this project."),btnText:r.ZP.t("web_graphic_go_to_platform_btn",{},"Go to workspace"),onClick:()=>{window.location.href=`${window.location.protocol}//${window.location.host}/my-edit`},renderSvgIcon:()=>(0,o.jsx)(a.nnn,{width:420,height:300})})}},96056:(e,t,i)=>{i.d(t,{_:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("web_graphic_link_invalid_title",{},"The link is invalid"),content:r.ZP.t("web_current_link_no_longer_available",{},"The link is invalid, please return to the workbench to open the draft"),btnText:r.ZP.t("web_graphic_go_to_platform_btn",{},"Go to workspace"),onClick:()=>{window.location.href="/my-edit"},renderSvgIcon:()=>(0,o.jsx)(a.n$4,{width:420,height:300})})}},8905:(e,t,i)=>{i.d(t,{v:()=>a});var r=i(70126),n=i(72322);const a=()=>{const e=document.createElement("div");document.body.appendChild(e);const t=(0,r.createRoot)(e);Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,15667)).then((({Compatibility:e})=>{t.render((0,n.jsx)(e,{}))}))}},67163:(e,t,i)=>{i.d(t,{D:()=>s});var r=i(27175),n=i(55120),a=i(14906),o=i(72322);const s=()=>{(0,n.u)({title:r.ZP.t("web_graphic_package_not_existed_title",{},"The project doesn't exist"),content:r.ZP.t("web_graphic_package_not_existed_content",{},"The draft you are viewing doesn\u2019t exist, please go to the workspace and choose another project"),btnText:r.ZP.t("web_graphic_go_to_platform_btn",{},"Go to workspace"),onClick:()=>{window.location.href=`${window.location.protocol}//${window.location.host}/my-edit`},renderSvgIcon:()=>(0,o.jsx)(a.tOA,{width:420,height:300})})}},96967:(e,t,i)=>{i.d(t,{D:()=>l});var r=i(66094);const n="item-vvjDjE",a="img-U8LVVP",o="title-FRtwrT";var s=i(72322);const l=()=>(0,s.jsx)(s.Fragment,{children:Array(12).fill(0).map(((e,t)=>(0,s.jsxs)("div",{className:n,children:[(0,s.jsx)(r.Z.Image,{className:a}),(0,s.jsx)(r.Z.Title,{className:o})]},t)))})},5985:(e,t,i)=>{i.d(t,{O:()=>c});var r=i(66094),n=i(96967);const a="root-ABh9Ea",o="list-DvypoB",s="album-rd7vZ5";var l=i(72322);const c=()=>(0,l.jsx)(r.Z,{className:a,children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Z.Title,{}),(0,l.jsx)("div",{className:o,children:Array(3).fill(0).map(((e,t)=>(0,l.jsx)(r.Z.Image,{},t)))}),(0,l.jsx)(r.Z.Title,{}),(0,l.jsx)("div",{className:o,children:Array(3).fill(0).map(((e,t)=>(0,l.jsx)(r.Z.Image,{},t)))}),(0,l.jsx)(r.Z.Title,{}),(0,l.jsx)("div",{className:s,children:(0,l.jsx)(n.D,{})})]})})},85018:(e,t,i)=>{i.d(t,{c:()=>y,Z:()=>b});var r=i(18571),n=i(5789),a=i.n(n),o=i(27175),s=i(14906),l=i(23224),c=i(39),d=i(58895),u=i(9339),h=i(80887),g=i(41790),p=i(72322);const m=({onLanguageChange:e,getCurrentLocale:t,getSupportLocales:i})=>{var r,n;return(0,p.jsx)(d.Z,{className:"user-menu-container",selectedKeys:[t()],children:null==i||null===(r=i())||void 0===r||null===(n=r.map)||void 0===n?void 0:n.call(r,(i=>(0,p.jsxs)(d.Z.Item,{onClick:()=>e(i.locale,i.text),children:[i.text,i.locale===t()?(0,p.jsx)(s.EgK,{size:20}):null]},i.locale)))})};var _=i(8757);const v=({selectedThemeMode:e,setSelectedThemeMode:t,onThemeModeChange:i})=>{var r;const n={[_.hY.Dark]:o.ZP.t("web_graphic_dark_theme",{},"Dark Theme"),[_.hY.Light]:o.ZP.t("web_graphic_light_theme",{},"Light Theme")};return(0,p.jsx)(d.Z,{className:"locale-menu-container",selectedKeys:[null!=e?e:_.hY.Light],children:null===(r=Object.keys(n))||void 0===r?void 0:r.map((r=>(0,p.jsxs)(d.Z.Item,{onClick:()=>{i(r),null==t||t(r)},children:[n[r],r===e?(0,p.jsx)(s.EgK,{size:20}):null]},r)))})};var f=i(77349);const y=({trigger:e=!1,avatarUrl:t,isSigned:i})=>(0,p.jsx)(l.Z,{position:"bottom",trigger:"hover",content:o.ZP.t("web_log_in_to_save",{},"Sign in"),disabled:i,children:(0,p.jsx)(c.Z,{size:28,triggerIcon:e?"":(0,p.jsx)("div",{}),triggerType:"mask",children:i?(0,p.jsx)("img",{alt:"avatar",src:t,crossOrigin:"anonymous"}):t})}),b=e=>{const{name:t,isSigned:i,email:n,avatar:l,className:c,themeMode:_,isWorkspaceIdReady:b,accountService:x,listenExpandInstance:w,projectMaterialManagerService:S,getCurrentLocale:P,getSupportLocales:I,onLanguageChange:C,onThemeModeChange:E,loginAndSavePackage:D}=e,[A,L]=(0,r.useState)(_),k=null!=l?l:(0,p.jsx)(s.I8f,{size:58}),[R,M]=(0,r.useState)();(0,r.useEffect)((()=>{i&&b&&w((e=>{M(e)}))}),[i,b]);const T=(0,p.jsxs)(d.Z,{selectable:!1,children:[(0,p.jsxs)(d.Z.Item,{className:"menu-item-user-tab",children:[(0,p.jsx)(y,{trigger:!0,avatarUrl:k,isSigned:i}),(0,p.jsxs)("div",{className:"graphic-user-info",children:[(0,p.jsx)(u.default.Text,{className:"detail-item nickname",ellipsis:{cssEllipsis:!0,showTooltip:!0,rows:1},children:t}),n&&(0,p.jsx)(u.default.Text,{className:"detail-item email",ellipsis:{cssEllipsis:!0,showTooltip:!0,rows:1},children:n})]})]},"1"),(0,p.jsx)("div",{className:"graphic-user-vip-info",children:R&&(0,p.jsx)(f.O4,{expandModalInstance:R})}),(0,p.jsx)(d.Z.Item,{className:"menu-item-divider",children:(0,p.jsx)(h.Z,{className:"graphic-divider"})},"2"),(0,p.jsx)(d.Z.SubMenu,{className:"language-menu",triggerProps:{className:"locale-dropdown"},title:(0,p.jsxs)("div",{className:"menu-submenu-locale",children:[(0,p.jsx)(s.P_r,{size:20}),(0,p.jsx)("span",{className:"menu-title",children:o.ZP.t("web_language",{},"Language")})]}),children:(0,p.jsx)(m,{getCurrentLocale:P,getSupportLocales:I,onLanguageChange:C})},"3"),(0,p.jsx)(d.Z.SubMenu,{className:"theme-menu",triggerProps:{className:"locale-dropdown"},title:(0,p.jsxs)("div",{className:"menu-submenu-locale",children:[(0,p.jsx)(s.lTF,{size:20}),(0,p.jsx)("span",{className:"menu-title",children:o.ZP.t("web_graphic_theme",{},"Theme")})]}),children:(0,p.jsx)(v,{onThemeModeChange:E,selectedThemeMode:A,setSelectedThemeMode:L})},"4")]}),j=(0,p.jsxs)(d.Z,{selectable:!1,children:[(0,p.jsx)(d.Z.Item,{className:"menu-item-user-tab",children:(0,p.jsxs)("div",{className:"menu-item-sign-in-btn",onClick:()=>D(),children:[(0,p.jsx)(s.PSW,{size:20}),(0,p.jsx)("span",{className:"menu-item-sign-in-text",children:o.ZP.t("web_log_in_to_save",{},"Sign in")})]})},"1"),(0,p.jsx)(d.Z.Item,{className:"menu-item-divider",children:(0,p.jsx)(h.Z,{className:"graphic-divider"})},"2"),(0,p.jsx)(d.Z.SubMenu,{className:"language-menu",triggerProps:{className:"locale-dropdown"},title:(0,p.jsxs)("div",{className:"menu-submenu-locale",children:[(0,p.jsx)(s.P_r,{size:20}),(0,p.jsx)("span",{className:"menu-title",children:o.ZP.t("web_language",{},"Language")})]}),children:(0,p.jsx)(m,{getCurrentLocale:P,getSupportLocales:I,onLanguageChange:C})},"3"),(0,p.jsx)(d.Z.SubMenu,{className:"theme-menu",triggerProps:{className:"locale-dropdown"},title:(0,p.jsxs)("div",{className:"menu-submenu-locale",children:[(0,p.jsx)(s.lTF,{size:20}),(0,p.jsx)("span",{className:"menu-title",children:o.ZP.t("web_graphic_theme",{},"Theme")})]}),children:(0,p.jsx)(v,{onThemeModeChange:E,selectedThemeMode:A,setSelectedThemeMode:L})},"4")]});return(0,r.useEffect)((()=>{function e(e){e.preventDefault(),e.returnValue=""}return i||window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}}),[i]),(0,p.jsx)("div",{className:a()("header-avatar-container",c),children:(0,p.jsx)(g.Z,{triggerProps:{className:"header-avatar-dropdown",trigger:"click",popupAlign:{bottom:i?20:10}},droplist:i?T:j,position:"bl",unmountOnExit:!1,children:y({trigger:!1,avatarUrl:k,isSigned:i})})})}},30250:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="CutoutDetail",n={CutoutPageTitle:"Cutout-PageTitle",CutoutEntry:"Cutout-Entry",CutoutCursorMode:"Cutout-CursorMode",CutoutCanvasZoomSize:"Cutout-CanvasZoomSize",CutoutDraftUndo:"Cutout-DraftUndo",CutoutDraftRedo:"Cutout-DraftRedo",CutoutPageActionCancel:"Cutout-PageActionCancel",CutoutPageActionConfirm:"Cutout-PageActionConfirm",CutoutOperateDetailPage:"Cutout-Detail-Page",CutoutOperateDetailPagePanel:"Cutout-Detail-Page-Panel"}},16391:(e,t,i)=>{i.d(t,{l:()=>c});var r=i(27175);const n="draftNameReadonly-Lvu9XE",a="titleWrapper-kRdTnI",o="title-_OtGKx",s="viewonlyTag-GLe8WI";var l=i(72322);const c=({graphicSDKApi:e})=>{const t=e.document.getTitle();return(0,l.jsxs)("div",{className:n,children:[(0,l.jsx)("div",{className:a,children:(0,l.jsx)("span",{className:o,children:t})}),(0,l.jsx)("span",{className:s,children:r.ZP.t("web_onlyread_text_view_only",{},"View only")})]})}},75701:(e,t,i)=>{i.d(t,{L:()=>m});var r=i(18571),n=i(17083),a=i(41790),o=i(58895),s=i(27175),l=i(91123),c=i(8757),d=i(58294),u=i(14906),h=i(37180),g=i(72322);function p(e){i.g.document&&(i.g.document.title=s.ZP.t("web_graphic_tdk_title",{placeholder0:e},"{placeholder0} | CapCut"))}const m=({graphicSDKApi:e,showMoveModal:t,hasLogin:i,onDidLogin:m})=>{var _;const[v,f]=(0,r.useState)(),[y,b]=(0,r.useState)(e.document.getTitle()),[x,w]=(0,r.useState)(i),[S,P]=(0,r.useState)(!1),I=()=>{null==v||v.dom.select(),P(!0)};(0,r.useEffect)((()=>m((()=>{w(!0)})).dispose),[m]),(0,r.useEffect)((()=>{p(y),l.default.events.interact.onModelInitFinish.event((()=>{requestAnimationFrame((()=>{const t=e.document.getTitle();b(t),p(t)}))})),l.default.events.action.onModelChange.event((t=>{if(t.actionType!==c.Us.UpdateDocumentAction)return;const i=e.document.getTitle();b(i),p(i)}))}),[]),(0,r.useEffect)((()=>{if(!v)return;const e=()=>{b(v.dom.value)};return v.dom.addEventListener("compositionupdate",e),()=>{v.dom.removeEventListener("compositionupdate",e)}}),[v]);return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)("div",{className:"draft-rename-container",children:[(0,g.jsxs)("div",{className:"draft-input-block",children:[(0,g.jsx)("span",{className:"draft-input-placeholder",children:null==y||null===(_=y.slice)||void 0===_?void 0:_.call(y,0,50)}),(0,g.jsx)(n.default,{name:"test",className:"draft-input",ref:e=>{e&&f(e)},type:"text",onPressEnter:()=>{null==v||v.blur()},maxLength:50,value:y,onChange:e=>{b(e)},onBlur:()=>{P(!1);const t=e.document.getTitle();y?(y!==t&&(e.document.updateTitle(y),p(y)),new d.I(y).report()):b(t)},onFocus:I})]}),(0,g.jsx)(a.Z,{onVisibleChange:e=>{e&&new h.b5("show").report()},triggerProps:{className:"draft-rename-dropdown"},position:"bottom",popupAlign:{bottom:16},droplist:(0,g.jsxs)(o.Z,{children:[(0,g.jsxs)(o.Z.Item,{className:"draft-dropdown-item",onClick:()=>{I(),new h.b5("rename").report()},children:[(0,g.jsx)(u.fVt,{size:20}),(0,g.jsx)("span",{children:s.ZP.t("space_files_menu_rename",{},"Rename")})]},"rename"),x&&(0,g.jsxs)(o.Z.Item,{className:"draft-dropdown-item",onClick:()=>{t(),new h.b5("change_space").report(),(new h.mh).report()},children:[(0,g.jsx)(u.w00,{size:20}),s.ZP.t("space_files_menu_move",{},"Move to")]},"move")]}),children:S?null:(0,g.jsx)(u.MQ,{className:"draft-dropdown-icon",size:12})})]})})}},16135:(e,t,i)=>{i.d(t,{W:()=>d});i(18571);var r=i(27175),n=i(14906),a=i(5789),o=i.n(a),s=i(8757),l=i(23224),c=i(72322);const d=({cursorMode:e,onCursorChange:t})=>{const i={[s.Ll.Mouse]:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{children:r.ZP.t("web_graphic_header_dropdown_move",{},"Move")}),(0,c.jsx)("span",{className:"cursor-menu-tooltip-shortcut",children:" V"})]}),[s.Ll.Hand]:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{children:r.ZP.t("web_graphic_header_dropdown_hand_tool",{},"Hand tool")}),(0,c.jsx)("span",{className:"cursor-menu-tooltip-shortcut",children:" H"})]})};return(0,c.jsx)("div",{className:"graphic-cursor-more-menu",children:[s.Ll.Mouse,s.Ll.Hand].map((r=>{return(0,c.jsx)(l.Z,{position:"bottom",triggerProps:{trigger:"hover",popupAlign:{bottom:5}},content:i[r],children:(0,c.jsx)("div",{className:o()("cursor-menu-content",{active:r===e}),onClick:()=>{return e=r,void(null==t||t(e));var e},children:(0,c.jsx)("div",{className:"cursor-menu-item",children:(0,c.jsx)("span",{className:"menu-left-just",children:(a=r,a===s.Ll.Mouse?(0,c.jsx)(n.CNV,{size:"20"}):a===s.Ll.Hand?(0,c.jsx)(n.g9w,{size:"20"}):void 0)})})})},r);var a}))})}},67606:(e,t,i)=>{i.d(t,{E:()=>p});var r=i(18571),n=i(58895),a=i(41790),o=i(23224),s=i(27175),l=i(14906),c=i(5789),d=i.n(c),u=i(20990),h=i(56185),g=i(72322);const p=e=>{var t;const{showLayersPanel:i,hideLayersPanel:c,isLayersPanelOpen:p,isRulerVisible:m,setRulerVisible:_,isPageBleedVisible:v,showPageMargin:f,hidePageMargin:y,isPageMarginVisible:b,showPageBleed:x,hidePageBleed:w}=e,[S,P]=(0,r.useState)(!1),I=(0,g.jsxs)(n.Z,{className:"view-setting-menu-container",children:[(0,g.jsxs)(n.Z.Item,{className:"show-layer-panel",onClick:()=>{p?null==c||c():null==i||i()},children:[p?(0,g.jsx)(l.EgK,{className:"check-icon",size:20}):null,(0,g.jsx)("span",{className:"menu-text",children:s.ZP.t("web_layer_button_show_layer_panel",{},"Show layer panel")})]},"show-layer-panel"),(0,g.jsx)("div",{className:"view-setting-split-line"}),(0,g.jsxs)(n.Z.Item,{className:"show-ruler-menu",onClick:_,children:[m?(0,g.jsx)(l.EgK,{className:"check-icon",size:20}):null,(0,g.jsx)("span",{className:"menu-text",children:s.ZP.t("web_ruler_right_button_show_ruler",{},"Show rulers and guides")}),(0,g.jsx)("span",{className:"key-icon",children:null===(t=(0,u.a)(h.b.ShowOrHideRulers))||void 0===t?void 0:t.render()})]},"show-ruler-menu"),(0,g.jsxs)(n.Z.Item,{onClick:()=>{b?null==y||y():null==f||f()},children:[b?(0,g.jsx)(l.EgK,{className:"check-icon",size:20}):null,(0,g.jsx)("span",{className:"menu-text",children:s.ZP.t("web_ruler_button_show_margin",{},"Show margin")})]},"show-margin"),(0,g.jsxs)(n.Z.Item,{onClick:()=>{v?null==w||w():null==x||x()},children:[v&&(0,g.jsx)(l.EgK,{className:"check-icon",size:20}),(0,g.jsx)("span",{className:"menu-text",children:s.ZP.t("web_ruler_button_show_bleed",{},"Show Print bleed")})]},"show-print-bleed")]});return(0,g.jsx)(a.Z,{droplist:(0,g.jsx)("div",{className:"graphic-view-setting-dropdown-container",children:I}),trigger:"click",popupVisible:S,position:"bottom",onVisibleChange:P,children:(0,g.jsx)(o.Z,{content:s.ZP.t("web_layer_hover_view",{},"View"),children:(0,g.jsxs)("div",{className:d()("view-setting-btn",{"view-setting-btn-active":S}),children:[(0,g.jsx)(l.cml,{size:20}),S?(0,g.jsx)(l.CYX,{size:12}):(0,g.jsx)(l.MQ,{size:12})]})})})}},3166:(e,t,i)=>{i.d(t,{u:()=>a});i(18571);var r=i(14906),n=i(72322);const a=({percent:e,active:t=!1})=>(0,n.jsxs)("div",{className:"header-percent-container header-content-bg",children:[(0,n.jsx)("div",{className:"header-percent-text",children:`${e}%`}),t?(0,n.jsx)(r.CYX,{size:12,className:"header-icon-down"}):(0,n.jsx)(r.MQ,{size:12,className:"header-icon-down"})]})},10502:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="EditorActions",n={CursorMode:"CursorMode",ViewSetting:"ViewSetting",CanvasZoomSize:"CanvasZoomSize",DraftUndo:"DraftUndo",DraftRedo:"DraftRedo"}},7093:(e,t,i)=>{i.d(t,{P:()=>h});var r=i(14906),n=i(8757),a=i(10502),o=i(16135),s=i(3166),l=i(20990),c=i(56185),d=i(67606),u=i(72322);const h={titleBar:[{name:a.j.CursorMode,type:"Custom",position:"center",content:()=>(0,u.jsx)(o.W,{cursorMode:n.Ll.Mouse})},{name:a.j.ViewSetting,type:"Custom",position:"center",content:()=>(0,u.jsx)(d.E,{})},{name:a.j.CanvasZoomSize,type:"Custom",position:"center",content:()=>(0,u.jsx)(s.u,{percent:100})},{name:a.j.DraftUndo,type:"IconBtn",position:"center",icon:(0,u.jsx)(r.NO0,{}),isDisable:()=>!0,onlyShowedWhenEditable:!0,appendDividerBefore:!0,tooltips:{content:()=>{var e;return null===(e=(0,l.a)(c.b.Undo))||void 0===e?void 0:e.actionText},subContent:()=>{var e;return null===(e=(0,l.a)(c.b.Undo))||void 0===e?void 0:e.render()}}},{name:a.j.DraftRedo,type:"IconBtn",position:"center",icon:(0,u.jsx)(r.c5m,{}),isDisable:()=>!0,onlyShowedWhenEditable:!0,tooltips:{content:()=>{var e;return null===(e=(0,l.a)(c.b.Redo))||void 0===e?void 0:e.actionText},subContent:()=>{var e;return null===(e=(0,l.a)(c.b.Redo))||void 0===e?void 0:e.render()}}}]}},57574:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="KeyListModal",n={KeyListModal:"KeyListModal"}},88103:(e,t,i)=>{i.d(t,{O:()=>R,Q:()=>k});var r=i(36702),n=i(24451),a=i(23224),o=i(27175),s=i(56002),l=i.n(s),c=i(18571);const d="key-list-modal-O1Ci5u",u="content-P79nSx",h="archer-head-JRCB8G",g="key-list-a7jLbb",p="list-section-ocWclT",m="last-section-gDXckn",_="keyboard-button-iqo6hA",v="keyboard-tooltip-rlGcDP",f="menu-text-V2HHnk",y="key-icon-text-Z5ziXm";var b=i(5789),x=i.n(b),w=i(14906),S=i(23926),P=i(92204),I=i(20990),C=i(56185),E=i(25629),D=i(74532);var A=i(25222),L=i(72322);const k=(0,c.forwardRef)(((e,t)=>{const[i,a]=(0,c.useState)(!1),[s,_]=(0,c.useState)(""),[v,b]=(0,c.useState)(0),w=(0,c.useRef)(null),k=(0,c.useRef)(!1),{clickInfinite:R}=function(){const e=(0,c.useRef)(0);return(0,c.useEffect)((()=>{const t=setInterval((()=>{e.current=0}),3e3);return()=>{clearInterval(t)}}),[]),{clickInfinite:()=>{e.current++,10===e.current&&(D.Z.success(`lvweb_version: ${window.LVWEB_VERSION}`),e.current=0)}}}(),M=()=>{(0,S.H)(P.W0.WithDraw,P.l5.Click),a(!1)};(0,c.useImperativeHandle)(t,(()=>({openModal:()=>{(0,S.H)(P.W0.Enter,P.l5.Click),a(!0)},closeModal:()=>{M()}}))),(0,c.useEffect)((()=>{const e=E.Z.appLayer.onGlobalHotKeyEvent.event((e=>{e===C.b.ViewShortcutList&&((0,S.H)(i?P.W0.WithDraw:P.W0.Enter,P.l5.ShortKey),a(!i))}));return()=>{e()}}),[i]);const T=e=>{const t=getComputedStyle(e);return parseFloat(t.paddingTop)},j=e=>{var t;const i=null===(t=w.current)||void 0===t?void 0:t.children[e];return i?i.offsetTop:0},N=l()((()=>{if(!w.current||k.current)return;const e=T(w.current),t=Array.from(w.current.children);for(let n=0;n<t.length;n++){var i,r;const t=j(n)-e;(null!==(i=null===(r=w.current)||void 0===r?void 0:r.scrollTop)&&void 0!==i?i:0)>=t-10&&b(n)}}),300,{leading:!1}),B=(0,c.useCallback)((()=>{var e;null===(e=w.current)||void 0===e||e.removeEventListener("scroll",N)}),[N]),Z=(0,c.useCallback)((()=>{if(!w.current)return;B();const e=w.current;e.addEventListener("scroll",N);const t=e.children[e.children.length-1],i=e.clientHeight-t.offsetHeight-T(w.current);_(`${i}px`)}),[N,B]),O=(0,c.useCallback)((e=>{const t=document.querySelector(`.${d}`);t&&(t.contains(e.target)||M())}),[]),K=(0,c.useCallback)((()=>{var e;const t=null===(e=document.querySelector(`.${d}`))||void 0===e?void 0:e.parentNode;null==t||t.removeEventListener("click",O)}),[O]),F=(0,c.useCallback)((()=>{var e;if(!w.current)return;K();const t=null===(e=document.querySelector(`.${d}`))||void 0===e?void 0:e.parentNode;null==t||t.addEventListener("click",O)}),[O,K]),G=e=>{var t;if(!(null===(t=w.current)||void 0===t?void 0:t.children[e]))return;const i=T(w.current),r=j(e)-i;((e,t,i,r,n)=>{const a=e.scrollTop,o=t-a,s=performance.now(),l=t=>{const r=t-s,c=(d=Math.min(r/i,1))*d*d;var d;e.scrollTop=a+o*c,r<i?requestAnimationFrame(l):n()};r(),requestAnimationFrame(l)})(w.current,r,100,(()=>k.current=!0),(()=>k.current=!1))};return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(r.Z,{className:d,title:o.ZP.t("web_keyboard_text_Shortcuts",{},"Shortcuts"),visible:i,onOk:M,onCancel:M,afterOpen:()=>{Z(),F()},afterClose:()=>{B(),K()},autoFocus:!1,focusLock:!0,maskClosable:!1,footer:null,children:(0,L.jsxs)("div",{className:u,onClick:()=>{e.editorType===A.gg.EditorPC&&R()},children:[(0,L.jsx)("div",{className:h,children:(0,L.jsx)("ul",{children:(0,I.x)().map(((e,t)=>(0,L.jsx)("li",{children:(0,L.jsx)(n.Z,{long:!0,type:v===t?"default":"text",onClick:()=>{b(t),G(t)},children:e.title})},t)))})}),(0,L.jsx)("div",{ref:w,className:g,style:{"--padding-bottom":s},children:(0,I.x)().map(((e,t)=>(0,L.jsxs)("div",{className:x()(p,{[m]:t===(0,I.x)().length-1}),children:[(0,L.jsx)("h4",{children:e.title}),(0,L.jsx)("ul",{children:e.keyList.map((([e,t,i],r)=>{const n=[];for(let a=0;a<(i||[]).length;a++)n.push((0,L.jsx)("em",{children:i[a]},a)),a!==i.length-1&&n.push((0,L.jsx)("span",{className:"delimiter"},`line-${a}`));return(0,L.jsxs)("li",{children:[(0,L.jsx)("span",{className:f,children:t}),(0,L.jsx)("span",{className:y,children:n})]},r)}))})]},t)))})]})})})})),R=()=>{var e;return(0,L.jsx)("div",{className:_,children:(0,L.jsx)(a.Z,{className:v,position:"right",trigger:"hover",color:"#fff",content:(0,L.jsxs)(L.Fragment,{children:[o.ZP.t("web_keyboard_text_Shortcuts",{},"Shortcuts"),(0,L.jsx)("span",{className:"key-icon",children:null===(e=(0,I.a)(C.b.ViewShortcutList))||void 0===e?void 0:e.render()})]}),children:(0,L.jsx)(w.c3x,{width:26.46,height:20})})})}},85088:(e,t,i)=>{i.d(t,{P:()=>o});var r=i(57574),n=i(88103),a=i(72322);const o={siderMenu:[{name:r.j.KeyListModal,position:"bottom",icon:()=>(0,a.jsx)(n.O,{})}]}},27607:(e,t,i)=>{i.d(t,{DQ:()=>n,Il:()=>s,bp:()=>l,jR:()=>a,yY:()=>o,zL:()=>c});var r=i(18571);const n="MaterialApps",a={MaterialApps:"MaterialApps"};var o;!function(e){e[e.None=0]="None",e[e.ImageGenerator=1]="ImageGenerator",e[e.AIBackground=2]="AIBackground",e[e.AIModel=3]="AIModel",e[e.TextToDesign=4]="TextToDesign"}(o||(o={}));const s=(0,r.createContext)({}),l=()=>(0,r.useContext)(s),c="customAdjustEntry"},26947:(e,t,i)=>{i.d(t,{P:()=>c,W:()=>l});var r=i(14906),n=i(27175),a=i(27607),o=i(8757),s=i(72322);const l="materials-apps-menu-container",c={siderMenu:[{id:o.s4.MATERIAL_APPS,name:a.jR.MaterialApps,position:"top",appendDividerBefore:!0,icon:()=>(0,s.jsx)(r.Iev,{}),tooltips:()=>n.ZP.t("web_materialSearch_text_shortcuts",{},"Shortcuts"),title:()=>n.ZP.t("web_graphic_menu_apps",{},"Apps")}],siderMenuPanel:[{id:l,name:a.jR.MaterialApps}]}},19549:(e,t,i)=>{i.d(t,{DQ:()=>r,Yj:()=>a,jR:()=>n});const r="MaterialDesign",n={MaterialDesign:"MaterialDesign"},a=11},35988:(e,t,i)=>{i.d(t,{P:()=>m});var r=i(14906),n=i(27175),a=i(19549),o=i(66094),s=i(2131);const l="root-bmdYQC",c="card-KCO68u",d="title-cy0eyJ",u="list-becCC5",h="item-SoaRUr";var g=i(72322);const p=()=>{const{columnWidth:e,eleRef:t}=(0,s.e)({minColumn:2,maxColumn:4,gap:8,minWidth:117});return(0,g.jsx)(o.Z,{className:l,style:{"--panel-column-width":e},ref:t,children:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(o.Z.Title,{className:d}),(0,g.jsx)(o.Z.Image,{className:c}),(0,g.jsx)(o.Z.Title,{className:d}),(0,g.jsx)("div",{className:u,children:Array(4).fill(0).map(((e,t)=>(0,g.jsx)(o.Z.Image,{className:h},t)))}),(0,g.jsx)(o.Z.Title,{className:d}),(0,g.jsx)("div",{className:u,children:Array(4).fill(0).map(((e,t)=>(0,g.jsx)(o.Z.Image,{className:h},t)))})]})})};const m={siderMenu:[{id:i(8757).s4.MATERIAL_DESIGN,name:a.jR.MaterialDesign,position:"top",icon:()=>(0,g.jsx)(r.KV0,{}),title:()=>n.ZP.t("web_autocolor_button_design",{},"Design"),tooltips:()=>n.ZP.t("web_materialSearch_text_shortcuts",{},"Shortcuts")}],siderMenuPanel:[{name:a.jR.MaterialDesign,skeleton:()=>(0,g.jsx)(p,{})}]}},25686:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialDraftSave",n={MaterialDraftSave:"MaterialDraftSave"}},29794:(e,t,i)=>{i.d(t,{P:()=>s});var r=i(25686),n=i(14906),a=i(72322);const o=()=>(0,a.jsx)("div",{className:"draft-save-status-container",children:(0,a.jsx)("span",{className:"draft-save-status-icon",children:(0,a.jsx)(n.o0l,{size:20})})}),s={titleBar:[{name:r.j.MaterialDraftSave,position:"left",type:"Custom",content:()=>(0,a.jsx)(o,{}),onlyShowedWhenEditable:!0}]}},27775:(e,t,i)=>{i.d(t,{DQ:()=>n,Wt:()=>o,jR:()=>a});var r=i(54155);const n="MaterialEvercloud",a={MaterialEverCloud:r.t},o="ever-cloud-menu-container"},56091:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(14906),n=i(27175),a=i(27775),o=i(8757),s=i(65309),l=i(72322);const c={siderMenu:[{id:o.s4.MATERIAL_EVER_CLOUD,name:a.jR.MaterialEverCloud,position:"top",title:()=>n.ZP.t("web_graphic_menu_upload",{},"Upload"),icon:()=>(0,l.jsx)(r.L_4,{}),tooltips:()=>n.ZP.t("web_materialSearch_text_shortcuts",{},"Shortcuts")}],siderMenuPanel:[{id:a.Wt,name:a.jR.MaterialEverCloud,skeleton:()=>(0,l.jsx)(s.Z,{})}]}},46711:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialFrame",n={MaterialFrame:"MaterialFrame"}},98724:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(14906),n=i(27175),a=i(46711),o=i(8757),s=i(5985),l=i(72322);const c={siderMenu:[{id:o.s4.MATERIAL_FRAME,name:a.j.MaterialFrame,position:"top",icon:()=>(0,l.jsx)(r.GXO,{}),tooltips:()=>n.ZP.t("web_graphic_menu_frame",{},"Frame"),title:()=>n.ZP.t("web_graphic_menu_frame",{},"Frame")}],siderMenuPanel:[{name:a.j.MaterialFrame,skeleton:()=>(0,l.jsx)(s.O,{})}]}},22951:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialGrid",n={MaterialGrid:"MaterialGrid"}},12353:(e,t,i)=>{i.d(t,{P:()=>h});var r=i(14906),n=i(27175),a=i(5789),o=i.n(a),s=i(22951),l=i(51312),c=i(8757),d=i(72970),u=i(72322);const h={siderMenu:[{id:c.s4.MATERIAL_GRID,name:s.j.MaterialGrid,position:"top",icon:()=>(0,u.jsx)(r.Z3x,{}),tooltips:()=>n.ZP.t("web_grid_title_grid",{},"Grid"),title:()=>n.ZP.t("web_grid_title_grid",{},"Grid")}],siderMenuPanel:[{name:s.j.MaterialGrid,skeleton:()=>(0,u.jsx)("div",{className:o()(d.Z.root,d.Z.visible),children:(0,u.jsx)(l.Z,{active:!0,column:3,size:77})})}]}},22791:(e,t,i)=>{i.d(t,{y:()=>u});var r=i(66094),n=i(2131),a=i(38720),o=i(5789),s=i.n(o),l=i(18571),c=i(59109),d=i(72322);const u=e=>{const{showHeaderSkeleton:t=!0}=e,{column:i,columnWidth:o,eleRef:u}=(0,n.e)({minColumn:2,maxColumn:4,gap:8,minWidth:120}),h=(0,l.useMemo)((()=>i-2),[i]);return(0,d.jsx)(r.Z,{className:s()("photo-skeleton-container",{"photo-search-skeleton-container":!t}),ref:u,children:(0,d.jsxs)(d.Fragment,{children:[t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"photo-header",children:[(0,d.jsx)(r.Z.Input,{}),(0,d.jsxs)("div",{className:"hot-words",children:[(0,d.jsx)(r.Z.Button,{className:"hot-words_item"},0),(0,d.jsx)(r.Z.Button,{className:"hot-words_item"},1)]})]}),(0,d.jsx)(r.Z.Title,{className:"photo-header_title"})]}):null,(0,d.jsx)("div",{className:"photo-image-skeleton-container",children:c.rD[h].map(((e,t)=>(0,d.jsx)("div",{className:"photo-image-skeleton-column",children:e.map(((e,i)=>(0,d.jsx)(r.Z.Image,{className:"photo-image-skeleton",style:{width:o,height:(0,a.P)(o,e)}},`photo_${t}_${i}`)))},`photo_${t}`)))})]})})}},59109:(e,t,i)=>{i.d(t,{Cx:()=>o,DQ:()=>v,Sb:()=>l,jR:()=>f,m$:()=>a,m6:()=>r,nz:()=>s,rD:()=>_,wI:()=>n});const r=50,n=50,a=20,o={large_image_formats:[{width:640,height:640},{width:1280,height:1280}]},s=10,l=5,c=[4,3],d=[3,4],u=[1,1],h=[16,9],g=[9,16],p=[c,d,u,h,g,u,g],m=[g,d,c,h,g,h,u],_=[[p,m],[p,m,p],[p,m,p,m]],v="MaterialPhoto",f={MaterialPhoto:"MaterialPhoto"}},42330:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(14906),n=i(27175),a=i(59109),o=i(22791),s=i(8757),l=i(72322);const c={siderMenu:[{id:s.s4.MATERIAL_PHOTO,name:a.jR.MaterialPhoto,position:"top",icon:()=>(0,l.jsx)(r.h7L,{}),tooltips:()=>n.ZP.t("web_graphic_menu_photo",{},"Photos"),title:()=>n.ZP.t("web_graphic_menu_photo",{},"Photos")}],siderMenuPanel:[{name:a.jR.MaterialPhoto,skeleton:()=>(0,l.jsx)(o.y,{})}]}},77752:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialShape",n={MaterialShape:"MaterialShape"}},59250:(e,t,i)=>{i.d(t,{P:()=>h});var r=i(14906),n=i(27175),a=i(5789),o=i.n(a),s=i(77752),l=i(51312),c=i(8757),d=i(33643),u=i(72322);const h={siderMenu:[{id:c.s4.MATERIAL_SHAPE,name:s.j.MaterialShape,position:"top",icon:()=>(0,u.jsx)(r.PC0,{}),tooltips:()=>n.ZP.t("web_graphic_menu_shapes",{},"Shapes"),title:()=>n.ZP.t("web_graphic_menu_shapes",{},"Shapes")}],siderMenuPanel:[{name:s.j.MaterialShape,skeleton:()=>(0,u.jsx)("div",{className:o()(d.Z.root,d.Z.visible),children:(0,u.jsx)(l.Z,{active:!0,column:3,size:77})})}]}},11689:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialSticker",n={MaterialSticker:"MaterialSticker"}},94287:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(14906),n=i(27175),a=i(11689),o=i(5985),s=i(8757),l=i(72322);const c={siderMenu:[{id:s.s4.MATERIAL_STICKER,name:a.j.MaterialSticker,position:"top",icon:()=>(0,l.jsx)(r.Ph1,{}),title:()=>n.ZP.t("web_graphic_menu_stickers",{},"Stickers")}],siderMenuPanel:[{name:a.j.MaterialSticker,skeleton:()=>(0,l.jsx)(o.O,{})}]}},7558:(e,t,i)=>{i.d(t,{Z:()=>l});i(18571);var r=i(5789),n=i.n(r),a=i(66094),o=i(29867),s=i(72322);const l=({showAllSkeleton:e=!0,ratio:t})=>{const{rowHeight:i,listRef:r,colCount:l}=(0,o.n)(!0,t);return(0,s.jsx)(a.Z,{className:n()("template-skeleton-container",{"feed-skeleton-container":!e}),ref:r,children:(0,s.jsxs)(s.Fragment,{children:[e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"template-header",children:[(0,s.jsx)(a.Z.Input,{}),(0,s.jsxs)("div",{className:"category-list",children:[(0,s.jsx)(a.Z.Button,{className:"category"},0),(0,s.jsx)(a.Z.Button,{className:"category"},1)]})]}),(0,s.jsx)(a.Z.Title,{className:"title"})]}):null,(0,s.jsx)("div",{className:"skeleton-template-list",style:{gridTemplateColumns:`repeat(${l}, 1fr)`,gridAutoRows:`${i}px`},children:new Array(13).fill(1).map(((e,t)=>(0,s.jsx)(a.Z.Image,{},t)))})]})})}},27250:(e,t,i)=>{i.d(t,{DQ:()=>r,FP:()=>l,Nr:()=>d,Qp:()=>o,ae:()=>s,dX:()=>u,jR:()=>n,m5:()=>a,wc:()=>c});const r=i(8757).s4.MATERIAL_TEMPLATES,n={MaterialTemplate:"MaterialTemplate"},a=10020,o=240,s=106,l=129,c=20,d="template",u="video_cover_template"},29867:(e,t,i)=>{i.d(t,{n:()=>s});var r=i(38720),n=i(18571),a=i(22766),o=i(2131);function s(e,t){let i=e?100:64;if(t&&t[0]>t[1]){const e=52,n=(0,r.H)(e,t);i=n>i?n:i}const{column:s,columnWidth:l,eleRef:c}=(0,o.e)({minColumn:e?1:2,maxColumn:e?3:5,gap:8,minWidth:i});return{rowHeight:(0,n.useMemo)((()=>(0,r.P)(l,(0,a.hh)(t))),[t,l]),listRef:c,colCount:s,columnWidth:l}}},22766:(e,t,i)=>{i.d(t,{hh:()=>s,lm:()=>o,pF:()=>n,uy:()=>a});let r=i(61054).p;function n(e){e&&(r=e)}const a=e=>{const[t,i]=e,n=t/i;let a,o=Number.MAX_SAFE_INTEGER;return r.forEach((({size:e,range:t},i)=>{var s,l;const c=e[0]/e[1],d=null!==(s=null==t?void 0:t.min)&&void 0!==s?s:c,u=null!==(l=null==t?void 0:t.max)&&void 0!==l?l:c;if(n>=d&&n<=u){const e=Math.abs(n-c);e<o&&(o=e,a=r[i])}})),a},o=(e,t)=>e/t>4?"4 / 1":`${e} / ${t}`,s=e=>e&&e[0]/e[1]>4?[4,1]:e},40749:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(14906),n=i(27175),a=i(27250),o=i(7558),s=i(72322);const l={siderMenu:[{id:a.DQ,name:a.jR.MaterialTemplate,position:"top",icon:()=>(0,s.jsx)(r.kPh,{}),title:()=>n.ZP.t("web_graphic_menu_template",{},"Template")}],siderMenuPanel:[{name:a.jR.MaterialTemplate,skeleton:()=>(0,s.jsx)(o.Z,{})}]}},32929:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="MaterialText",n={MaterialText:"MaterialText"}},45975:(e,t,i)=>{i.d(t,{P:()=>c});var r=i(14906),n=i(27175),a=i(32929),o=i(51312),s=i(8757),l=i(72322);const c={siderMenu:[{id:s.s4.MATERIAL_TEXT,name:a.j.MaterialText,position:"top",icon:()=>(0,l.jsx)(r.Rn2,{}),tooltips:()=>n.ZP.t("web_materialSearch_text_shortcuts",{},"Shortcuts"),title:()=>n.ZP.t("web_graphic_menu_text",{},"Text")}],siderMenuPanel:[{name:a.j.MaterialText,skeleton:()=>(0,l.jsx)(o.Z,{txtHeader:!0})}]}},1221:(e,t,i)=>{i.d(t,{_:()=>o});i(18571);var r=i(27175);const n="btn-NbaRoC";var a=i(72322);const o=e=>(0,a.jsx)("button",{className:n,type:"button",onClick:e.onClick,children:r.ZP.t("web_graphic_header_export_btn",{},"Export")})},39132:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="ProductActions",n={ExportProduct:"ExportProduct",Publish:"Publish",ProductCopyRight:"ProductCopyRight",ImportPSD:"ImportPSD",Present:"Present"}},63288:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(27175),n=i(39132),a=i(14906),o=i(1221),s=i(72322);const l={titleBar:[{name:n.j.Present,type:"Custom",position:"right",shouldHidden:()=>{const{searchParams:e}=new URL(window.location.href);return!Boolean(e.get("isPresent"))}},{name:n.j.ImportPSD,type:"Custom",position:"right",onlyShowedWhenEditable:!0},{name:n.j.ExportProduct,type:"Custom",position:"right",content:()=>(0,s.jsx)(o._,{}),onlyShowedWhenEditable:!0,appendDividerAfter:!1},{name:n.j.Publish,type:"Custom",position:"right",content:()=>(0,s.jsx)(s.Fragment,{}),onlyShowedWhenEditable:!0},{name:n.j.ProductCopyRight,type:"IconBtn",icon:(0,s.jsx)(a.a5K,{}),activeIcon:(0,s.jsx)(a.a5K,{}),position:"right",onlyShowedWhenEditable:!0,tooltips:()=>r.ZP.t("web_graphic_copyright_support",{},"All materials are royalty-free, you can use them commercially.")}]}},8160:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="ProductCopyRight",n={ProductCopyRight:"ProductCopyRight"}},18651:(e,t,i)=>{i.d(t,{P:()=>s});var r=i(27175),n=i(8160),a=i(14906),o=i(72322);const s={titleBar:[{name:n.j.ProductCopyRight,type:"IconBtn",group:"all",icon:(0,o.jsx)(a.a5K,{}),activeIcon:(0,o.jsx)(a.a5K,{}),position:"right",onlyShowedWhenEditable:!0,tooltips:()=>r.ZP.t("web_graphic_copyright_support",{},"All materials are royalty-free, you can use them commercially.")}]}},24622:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="SubProductActions",n={VideoCoverTitle:"VideoCoverTitle",SaveAsCover:"SaveAsCover",CancelSave:"CancelSave"}},17779:(e,t,i)=>{i.d(t,{P:()=>l});var r=i(24622),n=(i(18571),i(27175));const a="text-KUC4rt";var o=i(72322);const s=()=>(0,o.jsx)("div",{className:a,children:n.ZP.t("web_graphic_cover_title_editing_cover",{},"Edit video cover")}),l={titleBar:[{name:r.j.VideoCoverTitle,type:"Custom",position:"left",content:()=>(0,o.jsx)(s,{})},{name:r.j.CancelSave,type:"Btn",position:"right",text:()=>n.ZP.t("web_cover_download_button_discard",{},"Discard")},{name:r.j.SaveAsCover,type:"Btn",position:"right",btnProps:{type:"primary"},text:()=>n.ZP.t("web_modal_save_btn",{},"Save")}]}},67852:(e,t,i)=>{i.d(t,{D:()=>r,j:()=>n});const r="UserConfiguration",n={UserConfiguration:"UserConfiguration"}},55115:(e,t,i)=>{i.d(t,{P:()=>o});var r=i(85018),n=i(67852),a=i(72322);const o={titleBar:[{name:n.j.UserConfiguration,type:"Custom",position:"right",content:()=>(0,a.jsx)(r.c,{})}]}},32283:(e,t,i)=>{i.d(t,{e1:()=>o});var r=i(93062),n=i(69326),a=i(68967);class o{static parserDraftIdFromUrl(){var e;const t=(0,r.EQ)(a.tP)(i.g.location.pathname);return null==t||null===(e=t.params)||void 0===e?void 0:e.draftId}static parserTemplateIdFromUrl(){return(0,a.gO)().create_id}static parserUseInCN(){return"true"===(0,a.gO)().use_in_cn}constructor(){const e=(0,n.o)(),t=o.parserDraftIdFromUrl(),i=o.parserTemplateIdFromUrl(),{scenario:r,editorType:s,coverId:l,width:c,height:d,unit:u,from_page:h,photoWidth:g,photoHeight:p}=(0,a.gO)(),m=o.parserUseInCN();this.editorType=s,this.hasDimensionInUrl=Boolean(c&&d&&u),this.enterFromPc="pc"===h,this.dimension=e,this.draftId=t,this.scenario=r,this.templateId=i,this.coverId=l,this.useInCN=m,this.photoWidth=Number(g),this.photoHeight=Number(p)}}},18473:(e,t,i)=>{i.d(t,{t:()=>y});var r,n=i(47006),a=i(11042),o=i(68967),s=i(67986),l=i(42058),c=i(13659);function d(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function u(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,g(e,t,"set"),i),i}function h(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,g(e,t,"get"))}function g(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var p,m,_=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e,t){return function(i,r){t(i,r,e)}};let y=(r=new WeakMap,class{constructor(e,t){d(this,r,{writable:!0,value:void 0}),this.accountService=e,this.workspaceService=t}bootstrap(){return this._initDraftWorkspace()}getWorkspaceId(){return(0,l.Y2)(h(this,r),"workspaceInfo is not existed, please bootstrap first"),h(this,r).workspaceId}getWorkspaceInfo(){return(0,l.Y2)(h(this,r),"workspaceInfo is not existed, please bootstrap first"),h(this,r)}_initDraftWorkspace(){const{workspaceId:e}=(0,o.gO)();return e&&"0"!==e&&"undefined"!==e?(s.t.log("[draft-workspace]: found workspaceId from url",e),this._setWorkspaceFromUrl(e)):(s.t.log("[draft-workspace]: not found workspaceId from url"),this._setWorkspaceFromDefault())}_setWorkspaceFromUrl(e){const t=this.workspaceService.workspaceList.find((t=>t.workspace_id===e));return t?(u(this,r,{workspaceId:t.workspace_id,name:t.name}),(0,c.ly)()):(0,c.wf)(-1,"invalid workspace id")}_setWorkspaceFromDefault(){var e,t;const{spaceInfo:i,defaultSpaceInfo:n}=this.accountService.userProfile;return u(this,r,{workspaceId:null!==(e=null==n?void 0:n.workspaceId)&&void 0!==e?e:i.workspaceId,name:null!==(t=null==n?void 0:n.name)&&void 0!==t?t:i.name}),(0,c.ly)()}});y=_([f(0,n.Gw),f(1,a.WL),v("design:paramtypes",["function"==typeof(p=void 0!==n.Gw&&n.Gw)?p:Object,"function"==typeof(m=void 0!==a.WL&&a.WL)?m:Object])],y)},20621:(e,t,i)=>{i.d(t,{V:()=>r});const r=(0,i(67126).yh)("batchEditorWidgetAdapter")},57041:(e,t,i)=>{i.d(t,{c:()=>Mt});var r=i(35545),n=i(9557),a=i(18571),o=i(8757),s=i(9280),l=i(2983),c=i(92356),d=i(73842),u=i(25062),h=i(41308),g=i(27175),p=i(9561);const m="batchUploadContainer-Uw4nR6",_="batchUploadButtonGroup-NgZ1oh",v="localButton-wVW__E",f="dropDownButton-IbGXjW",y="slogan-container-s_UXRZ",b="slogan-background-container-MqKR8k",x="slogan-text-wrapper-thEjzq",w="slogan-text-ACEOKu",S="slogan-left-nRLYgn",P="slogan-right-p9QiVI",I="picture-container-ZsotOv",C="picture-title-Pd8sMS";var E,D,A=i(16073),L=i(52428),k=i(44001),R=i(55971);function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},M.apply(this,arguments)}const T=e=>a.createElement("svg",M({xmlns:"http://www.w3.org/2000/svg",width:84,height:84,fill:"none",viewBox:"0 0 84 84"},e),E||(E=a.createElement("path",{fill:"#00CAE0",fillOpacity:.2,fillRule:"evenodd",d:"M50.2 23.8c-11.598 0-21 9.403-21 21 0 1.107.086 2.193.25 3.252-6.97 1.292-12.25 7.404-12.25 14.749 0 8.284 6.716 15 15 15h36c8.284 0 15-6.716 15-15 0-7.345-5.28-13.457-12.25-14.749.164-1.06.25-2.145.25-3.251 0-11.598-9.402-21-21-21Z",clipRule:"evenodd"})),D||(D=a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"m21.142 41.122-4.503 1.27C12.226 43.639 9 47.7 9 52.5 9 58.299 13.701 63 19.5 63H27l-1.608 6h-5.89C10.386 69 3 61.612 3 52.5c0-7.556 5.079-13.926 12.01-15.882A21.554 21.554 0 0 1 15 36c0-11.598 9.403-21 21-21 11.6 0 21.001 9.402 21.001 21 0 .207-.003.413-.009.618 6.93 1.956 12.01 8.326 12.01 15.882 0 9.112-7.388 16.5-16.5 16.5H46.61l-1.608-6h7.5c5.798 0 10.5-4.701 10.5-10.5 0-4.8-3.226-8.862-7.64-10.107l-4.503-1.271.136-4.677c.004-.148.006-.296.006-.445 0-8.284-6.716-15-15-15-8.285 0-15 6.716-15 15 0 .149.002.297.006.445l.135 4.677Zm12.263-1.364-.494 1.727a11.735 11.735 0 0 1-9.354 8.352l.887 5.326a17.123 17.123 0 0 0 8.857-4.358V66h5.4V50.805a17.123 17.123 0 0 0 8.856 4.358l.888-5.326a11.735 11.735 0 0 1-9.355-8.352l-.493-1.727h-5.192Z",clipRule:"evenodd"}))),j=i.p+"static/image/slogan-bg.6279be51.png";var N,B;function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Z.apply(this,arguments)}const O=e=>a.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",width:115,height:27,fill:"none",viewBox:"0 0 115 27"},e),N||(N=a.createElement("path",{stroke:"url(#slogan-left_svg__a)",strokeWidth:6,d:"M1.62 23.313C19.563 15.453 76.914 2.68 114.453 3.639"})),B||(B=a.createElement("defs",null,a.createElement("linearGradient",{id:"slogan-left_svg__a",x1:.709,x2:56.743,y1:11.348,y2:70.301,gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#6B57FF"}),a.createElement("stop",{offset:.496,stopColor:"#3F62FF"}),a.createElement("stop",{offset:1,stopColor:"#00CAE0"})))));var K,F;function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},G.apply(this,arguments)}const U=e=>a.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",width:145,height:67,fill:"none",viewBox:"0 0 145 67"},e),K||(K=a.createElement("path",{stroke:"url(#slogan-right_svg__a)",strokeWidth:6,d:"M1.889 63.734c83.115-65.907 122.796-32.671 95.759-17.9C63.336 64.577 51.74 21.714 143.84 3.93"})),F||(F=a.createElement("defs",null,a.createElement("linearGradient",{id:"slogan-right_svg__a",x1:20.82,x2:149.832,y1:-22.939,y2:31.044,gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#6B57FF"}),a.createElement("stop",{offset:.496,stopColor:"#3F62FF"}),a.createElement("stop",{offset:1,stopColor:"#00CAE0"})))));var H=i(4547),V=i(72322);const z=e=>{const t=(0,l.G)(A.GV),{uploadService:i,showSlogan:r}=e,n=(0,L.k)(t,(e=>e.autoRemoval)),s=(0,a.useRef)(null),[E,D]=(0,a.useState)();return(0,V.jsxs)("div",{className:m,children:[r&&(0,V.jsxs)("div",{className:y,children:[(0,V.jsx)("div",{className:b,children:(0,V.jsx)("img",{src:j,draggable:"false",crossOrigin:"anonymous"})}),(0,V.jsxs)("div",{className:x,children:[(0,V.jsx)("div",{className:S,children:(0,V.jsx)(O,{})}),(0,V.jsx)("span",{className:w,children:g.ZP.t("web_smart_tools_title_editing_pictio",{},"Edit multiple materials quickly at one time")}),(0,V.jsx)("div",{className:P,children:(0,V.jsx)(U,{})})]})]}),(0,V.jsx)("div",{className:I,children:(0,V.jsx)(T,{})}),(0,V.jsx)("div",{className:C,children:g.ZP.t("web_magicTools_text_drag_file_here",{},"Drag and drop file here")}),(0,V.jsxs)("div",{className:_,children:[(0,V.jsx)(c.Z,{multiple:!0,showUploadList:!1,autoUpload:!1,onChange:(e,t)=>{t.originFile&&(i.batchMaterialType=A.KY.MAIN,i.uploadMaterialInProject({file:t.originFile,meta:{actionType:H.lJ.CLICK_COMPONENT,currentPage:"smart_tool_page",position:H.Rz.COMPONENT,toolType:o.B8.Batch,batchType:o.Ac.MaterialUpload}}))},accept:p.NF.image.accept,limit:{maxCount:k.fJ-t.batchPageList.length},onExceedLimit:()=>{d.Z.error(g.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:k.fJ},"You can edit up to {number0} pages at the same time"))},drag:!1,onDrop:e=>{e.stopPropagation()},children:(0,V.jsx)("div",{className:v,onClick:()=>{(0,R.UM)({action:R.td.SELECT_MATERIAL,isAutoCut:t.autoRemoval?1:0})},onDrag:e=>{e.stopPropagation()},children:g.ZP.t("web_smart_tools_button_select_images",{number0:k.fJ},"Upload")})}),(0,V.jsx)("div",{className:f,onClick:()=>{(()=>{if(E)return E.unmount(),void D(null);const e=e=>{const{type:t,data:i}=e};if(s.current){const r=i.initUploadComponent(s.current,e,{batchMaterialType:A.KY.MAIN,multi:!0,maxCount:k.fJ-t.batchPageList.length,currentPage:"smart_tool_page",toolType:"batch",smartToolPageReport:e=>{(0,R.UM)({action:e,isAutoCut:t.autoRemoval?1:0})},smartToolPageImportReport:e=>{(0,R.UM)({action:R.td.IMPORT,isAutoCut:t.autoRemoval?1:0,importSource:e,importType:R.Lo.CLICK_ADD})},reportParams:{actionType:H.lJ.CLICK_COMPONENT,currentPage:"smart_tool_page",position:H.Rz.COMPONENT,toolType:o.B8.Batch,batchType:o.Ac.MaterialUpload},forceVisible:!0,onHide:()=>{D(null)}});D(r)}})()},ref:s,children:E?(0,V.jsx)(h.ydH,{size:16}):(0,V.jsx)(h.lMd,{size:16})})]}),(0,V.jsx)(u.Z,{size:"small",onChange:e=>t.setAutoRemoval(e),checked:n,children:g.ZP.t("web_smart_tools_text_autocut_after",{},"Remove backgrounds of the uploaded images")})]})},W="batch-page-grid-njbiFk",$="item-container-D8xc48",Y="batch-page-item-NbLujH",X="img-container-s2I5Lr",q="active-RVl2lU",J="highlight-YpGsOn",Q="img-wrapper-Y3vvsU",ee="disabled-hPvDIa",te="loading-b3FILj",ie="mask-layer-YuxKz4",re="not-allowed-BDkEbe",ne="failed-hhdTIJ",ae="hide-img-cx6PY3",oe="fill-width-je2zsd",se="fill-height-ATN0iV",le="hide-C_dd75",ce="indicator-container-aSrEma",de="fade-out-axfrrU",ue="menu-anchor-fwYA3t",he="show-uxFBEf",ge="menu-CUvYU2",pe="menu-group-ygfLMS",me="menu-divider-HZsChq",_e="close-container-WZwIiO",ve="action-layer-wCuYlz",fe="failed-text-khiCAG",ye="retry-button-HjUdal",be="title-container-UP8vvs";var xe=i(53483),we=i(16605),Se=i(5789),Pe=i.n(Se);function Ie(e){const t=`${e+1}`;return"00".substring(t.length)+t}function Ce(e){return e===A.Gy.uploading||e===A.Gy.processing||e===A.Gy.rendering}function Ee(e,t){const[i,r]=(0,a.useState)({pre:e,cur:e});return(0,a.useEffect)((()=>{e!==i.cur&&r({cur:e,pre:i.cur})}),[e,i.cur]),Ce(e)||"loading"===t?{type:"loading"}:Ce(i.pre)&&function(e){return e===A.Gy.upload_success||e===A.Gy.process_success}(e)&&"done"===t?{type:"success"}:{type:"none"}}var De=i(46473),Ae=i(24451),Le=i(41790),ke=i(58895),Re=i(13520);const Me=(0,s.Pi)((e=>{const{src:t,index:i,dimension:r,itemStatus:n,pageStatus:o,onAction:s,globalLoading:l,contentRefFn:c,isReadonly:d}=e,[u,h]=(0,xe.Z)(),[p,m]=(0,a.useState)({src:t,dimension:r,status:"loading"}),_=t!==p.src?"loading":p.status,v=p.dimension.width/p.dimension.height*100+"%",f=p.dimension.height/p.dimension.width*100+"%",y=(0,a.useRef)(null),b=(0,we.Z)(!1),x="active"===n,w="disabled"===n,S=Ce(o)||"loading"===_,P=(null==p?void 0:p.src)&&"error"===(null==p?void 0:p.status),I=function(e){return e===A.Gy.upload_failed||e===A.Gy.process_failed}(o)||P,C=l||d,E=h&&!C&&!x&&!w&&!S&&!I,{type:D}=Ee(o,_),L="success"===D,k=!(null!=p&&p.src)||"done"!==(null==p?void 0:p.status),R=E||b.state,M="upload_failed"===o&&h,T="process_failed"===o&&h,j=()=>{m({...p,status:"done"})},N=()=>{m({...p,status:"error"})},B=()=>{m({src:t,dimension:r,status:"done"})},Z=()=>{m({src:t,dimension:r,status:"error"})},O=()=>{E&&s("select")},K=()=>{P&&s("retry_render"),"upload_failed"===o&&s("retry_upload"),"process_failed"===o&&s("retry_process")};(0,a.useLayoutEffect)((()=>{const e=()=>{const e=u.current,t=y.current;if(!e||!t)return;const i=e.getBoundingClientRect(),r=p.dimension.width/p.dimension.height>=i.width/i.height;t.classList.remove(oe,se),t.classList.add(r?oe:se)};if(e(),!y.current)return;const t=new ResizeObserver(e);return t.observe(y.current),()=>{t.disconnect()}}),[p.dimension.height,p.dimension.width,u]);return(0,V.jsx)("div",{className:Y,children:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{className:Pe()(X,{[q]:x,[ee]:w,[te]:S,[J]:E,[re]:C,[ne]:I,[ae]:k}),style:{"--height-ratio":f},ref:e=>{u.current=e,null==c||c(e)},onClick:O,children:[(0,V.jsxs)("div",{className:Pe()(Q),ref:y,style:{"--width-ratio":v,"--height-ratio":f},children:[(0,V.jsx)("img",{src:p.src,draggable:"false",crossOrigin:"anonymous",onLoad:j,onError:N},p.src),t!==p.src&&(0,V.jsx)("img",{className:le,src:t,draggable:"false",crossOrigin:"anonymous",onLoad:B,onError:Z},t)]}),(0,V.jsx)("div",{className:ie}),(0,V.jsx)("div",{className:ve,children:I?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{className:fe,children:"upload_failed"===o?g.ZP.t("web_smart_tools_text_upload_failed",{},"Upload Failed"):g.ZP.t("web_smart_tools_text_failed",{},"Failed")}),(0,V.jsx)("div",{className:ye,children:(0,V.jsx)(Ae.Z,{type:"secondary",size:"mini",icon:(0,V.jsx)(Re.hYj,{}),onClick:K,children:g.ZP.t("web_smart_tools_button_retry",{},"Retry")})})]}):null}),(0,V.jsx)("div",{className:Pe()(ce,{[de]:L}),children:"loading"===D?(0,V.jsx)(De.Z,{size:20}):"success"===D?(0,V.jsx)(Re.AYc,{style:{fontSize:"28px",color:"var(--lvv-color-secondary-green)"}}):null}),(0,V.jsx)(Le.Z,{popupVisible:b.state,trigger:"click",onVisibleChange:e=>b.toggle(e),triggerProps:{popupAlign:{bottom:4}},droplist:(0,V.jsx)(ke.Z,{className:ge,onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[[{text:g.ZP.t("web_smart_tools_button_duplicate",{},"Duplicate"),action:"duplicate"}],[{text:g.ZP.t("web_smart_tools_button_multiple_size",{},"Multiple Size"),action:"multiple_size"},{text:g.ZP.t("web_smart_tools_button_multiple_presets",{},"Multiple Presets"),action:"multiple_preset"}],[{text:g.ZP.t("web_smart_tools_button_delete",{},"Delete"),action:"delete"}]].map(((e,t)=>(0,V.jsxs)(a.Fragment,{children:[0!==t&&(0,V.jsx)("div",{className:me}),(0,V.jsx)("div",{className:pe,children:e.map((e=>(0,V.jsx)(ke.Z.Item,{onClick:()=>s(e.action),children:e.text},e.text)))})]},e[0].text)))}),children:(0,V.jsx)("div",{className:Pe()(ue,{[he]:R}),onClick:e=>{e.preventDefault(),e.stopPropagation(),b.toggle()},children:(0,V.jsx)(Re.$O0,{size:12})})}),(0,V.jsx)("div",{className:Pe()(_e,{[he]:T}),onClick:e=>{e.preventDefault(),e.stopPropagation(),s("cancel")},children:(0,V.jsx)(Re.x8P,{size:16})}),(0,V.jsx)("div",{className:Pe()(_e,{[he]:M}),onClick:e=>{e.preventDefault(),e.stopPropagation(),s("delete")},children:(0,V.jsx)(Re.rFk,{size:16})})]}),(0,V.jsx)("div",{className:Pe()(be,{[ee]:w}),children:Ie(i)})]})})}));var Te=i(49655),je=i(46974),Ne=i(22169),Be=i(91930);const Ze=(0,s.Pi)((e=>{const{id:t,children:i,className:r,disabled:n,onDragState:o,onDragOverState:s,onDrop:l}=e,c="page-grid-item",[{isDragging:d},u]=(0,Te.c)({item:{id:t},type:c,options:{dropEffect:"move"},canDrag:()=>!n,collect:e=>({isDragging:e.isDragging()})}),[{isDragOver:h},g]=(0,je.L)({accept:c,drop:e=>l(e.id),collect:e=>({isDragOver:e.isOver()})}),p=(0,a.useRef)(),m=(0,Be.Z)((e=>{p.current&&clearTimeout(p.current),p.current=setTimeout((()=>s(e)),100)}));(0,a.useEffect)((()=>{o(d)}),[d,o]),(0,a.useEffect)((()=>{m(h)}),[h,m]);const _=(0,Ne.isFunction)(i);return(0,V.jsx)("div",{className:r,ref:e=>g(_?e:u(e)),children:_?i({dragRefFn:u}):i})}));var Oe=i(1923),Ke=i(42398);const Fe=(0,s.Pi)((e=>{const{pageList:t,activeId:i,onAction:r,globalLoading:n,isReadonly:o,onDragDrop:s}=e,[l,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(""),[h,g]=(0,a.useState)("");return(0,V.jsx)("div",{className:W,ref:e=>{c(e)},children:l&&(0,V.jsx)(Oe.W,{backend:Ke.PD,options:{rootElement:l},children:t.map(((e,t)=>(0,V.jsx)(Ze,{className:$,id:e.id,disabled:n,onDragState:t=>((e,t)=>{t&&e!==d?u(e):t||e!==d||u("")})(e.id,t),onDragOverState:t=>((e,t)=>{t&&e!==h?g(e):t||e!==h||g("")})(e.id,t),onDrop:t=>{return i=t,r=e.id,void(i&&r&&i!==r&&s(i,r));var i,r},children:({dragRefFn:a})=>(0,V.jsx)(Me,{index:t,...e,globalLoading:n,isReadonly:o,itemStatus:i?i===e.id?"active":"disabled":"none",onAction:(...t)=>r(e.id,...t),contentRefFn:a,isDragging:e.id===d,isDragOver:Boolean(d)&&e.id!==d&&e.id===h})},e.id)))})})})),Ge="batchEditorContainer-OhOrIw",Ue="batchEditorContainerOnDrag-bYyN72",He="batch-main-container-T1xnjK";var Ve=i(88494),ze=i(24149),We=i(44773),$e=i(1956),Ye=i(47922),Xe=i(47087),qe=i(25351),Je=i(21100),Qe=i(28683),et=i(26690);const tt="batchHeader-kAucx5",it="display-none-as54Mh",rt="add-image-icon-sf4CeK",nt="rename-container-JFXV2n",at="right-container-Dd9mpD",ot="divider-iMdUiO",st="action-button-dH5Gce",lt="upload-button-UEcMMM",ct="disabled-EK6qnn";var dt=i(75701),ut=i(16391),ht=i(10502),gt=i(20990),pt=i(14906),mt=i(56185),_t=i(41800),vt=i(19127),ft=i(84020);const yt="batchUndoRedo-usqjE3";var bt=i(78379);const xt=(0,s.Pi)((({disabled:e})=>{const t=(0,l.G)(Xe.w),i=(0,l.G)(ze.j),r=(0,l.G)(_t.e),[n,o]=(0,a.useState)(t.graphicSDK.api.undoRedo.canUndo()),[s,c]=(0,a.useState)(t.graphicSDK.api.undoRedo.canRedo()),{draftId:d}=i,u=()=>{o(t.graphicSDK.api.undoRedo.canUndo()),c(t.graphicSDK.api.undoRedo.canRedo())};(0,a.useEffect)((()=>(t.graphicSDK.event.addListener(ft.B.AFTER_MUTATION_RUN,u),r.onVisibleChange(u),()=>{t.graphicSDK.event.removeListener(ft.B.AFTER_MUTATION_RUN,u)})),[]);const h=(0,a.useMemo)((()=>({name:ht.j.DraftUndo,type:"IconBtn",position:"center",icon:(0,V.jsx)(pt.NO0,{}),activeIcon:(0,V.jsx)(pt.NO0,{}),isDisable:()=>e||!n,tooltips:{content:()=>{var e;return null===(e=(0,gt.a)(mt.b.Undo))||void 0===e?void 0:e.actionText},subContent:()=>{var e;return null===(e=(0,gt.a)(mt.b.Undo))||void 0===e?void 0:e.render()}},onClick:()=>{!e&&n&&(t.graphicSDK.api.undoRedo.undo(),(0,bt.G8)({action:bt.CJ.UNDO,draft_id:d}))}})),[n,t,e]),g=(0,a.useMemo)((()=>({name:ht.j.DraftUndo,type:"IconBtn",position:"center",icon:(0,V.jsx)(pt.c5m,{}),activeIcon:(0,V.jsx)(pt.c5m,{}),isDisable:()=>e||!s,tooltips:{content:()=>{var e;return null===(e=(0,gt.a)(mt.b.Redo))||void 0===e?void 0:e.actionText},subContent:()=>{var e;return null===(e=(0,gt.a)(mt.b.Redo))||void 0===e?void 0:e.render()}},onClick:()=>{!e&&s&&(t.graphicSDK.api.undoRedo.redo(),(0,bt.G8)({action:bt.CJ.REDO,draft_id:d}))}})),[s,t,e]);return(0,V.jsxs)("div",{className:yt,children:[(0,V.jsx)(vt.a,{data:h}),(0,V.jsx)(vt.a,{data:g})]})}));var wt=i(23224);const St=(0,s.Pi)((()=>{const e=(0,l.G)(Xe.w),t=(0,l.G)(Je.H),i=(0,l.G)(qe.l),r=(0,l.G)(Ye.T),n=(0,l.G)(et.D),s=(0,l.G)(ze.j),c=(0,l.G)(Ve.ZO),d=(0,l.G)(A.GV),u=(0,a.useRef)(null),{isReadonly:h}=d,p=d.hasPageLoading,m=0===d.batchPageList.length,_=(0,L.k)(d,(e=>e.isReachMaxCount)),v=d.hasPageStatus([A.Gy.uploading,A.Gy.processing]),f=d.hasPageStatus([A.Gy.upload_failed,A.Gy.process_failed]),{draftId:y}=s,b=()=>{(0,R.UM)({action:R.td.ADD_IMAGE,isAutoCut:d.autoRemoval?1:0});const e=e=>{const{type:t,data:i}=e};if(u.current){const{left:t,width:i}=u.current.getBoundingClientRect();c.initUploadComponent(u.current,e,{batchMaterialType:A.KY.MAIN,multi:!0,maxCount:k.fJ-d.batchPageList.length,currentPage:"smart_tool_page",toolType:"batch",smartToolPageReport:e=>{(0,R.UM)({action:e,isAutoCut:d.autoRemoval?1:0})},smartToolPageImportReport:e=>{(0,R.UM)({action:R.td.IMPORT,isAutoCut:d.autoRemoval?1:0,importSource:e,importType:R.Lo.CLICK_ADD})},reportParams:{actionType:H.lJ.CLICK_COMPONENT,currentPage:"smart_tool_page",position:H.Rz.COMPONENT,toolType:o.B8.Batch,batchType:o.Ac.MaterialUpload},style:{left:t-i}})}},x=()=>{const e=_||p||h;return(0,V.jsx)(wt.Z,{content:g.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:k.fJ},"You can edit up to {number0} pages at the same time"),disabled:!_,children:(0,V.jsxs)("div",{ref:u,className:Pe()(lt,{[ct]:e}),onClick:e?void 0:b,children:[(0,V.jsx)(pt.YaL,{size:18,className:rt}),g.ZP.t("web_smart_tools_button_add_image",{},"Upload")]})})};return(0,V.jsxs)("div",{className:Pe()(tt,{[it]:m}),children:[(()=>{const a=t.getDraftPermission();return(0,V.jsx)("div",{className:nt,children:a===Qe.O.editable?(0,V.jsx)(dt.L,{renderSDK:r.renderSDK,graphicSDKApi:e.graphicSDK.api,showMoveModal:i.showModal.bind(s),hasLogin:n.hasLogin,onDidLogin:n.onDidLogin}):(0,V.jsx)(ut.l,{graphicSDKApi:e.graphicSDK.api})})})(),(0,V.jsxs)("div",{className:at,children:[f&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ae.Z,{className:st,type:"text",size:"small",onClick:()=>{const e=[],t=[];d.batchPageList.forEach((i=>{i.status===A.Gy.upload_failed?(d.setPageStatus(A.Gy.uploading,i.id),d.retryUpload(i.id),e.push(i.md5),t.push(i.id)):i.status===A.Gy.process_failed&&(d.setPageStatus(A.Gy.processing,i.id),d.retryOperation(i.id),e.push(i.md5),t.push(i.id))})),(0,bt.G8)({action:bt.CJ.BATCH_RETRY,draft_id:y,batch_picture_id:e.join(","),batch_page_id:t.join(",")})},children:g.ZP.t("web_smart_tools_button_retry",{},"Retry")}),(0,V.jsx)("div",{className:ot})]}),v&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ae.Z,{className:st,type:"text",size:"small",onClick:()=>{d.cancelAll(),(0,bt.G8)({action:bt.CJ.BATCH_CANCEL,draft_id:y})},children:g.ZP.t("web_smart_tools_button_becel",{},"Cancel ")}),(0,V.jsx)("div",{className:ot})]}),(0,V.jsx)(xt,{disabled:p}),(0,V.jsx)("div",{className:ot}),(0,V.jsx)(x,{})]})]})}));var Pt=i(94917);const It=(0,s.Pi)((()=>{const e=(0,l.G)(Ve.ZO),t=(0,l.G)(A.GV),i=(0,l.G)(ze.j),{setBatchSizeTabActive:r}=(0,l.G)(We.j),{setPresetTabActive:n}=(0,l.G)($e.BJ),{observableData:{batchPageList:s,batchMultipleInfo:c},init:u,duplicatePage:h,deletePage:p,selectPage:m,setBatchMultipleInfo:_,hasPageLoading:v,isReadonly:f}=t,[y,b]=(0,Pt.Z)("BATCH_SLOGAN_CACHE_KEY","");(0,a.useEffect)((()=>{u()}),[]),(0,a.useEffect)((()=>{s.length&&!y&&b("done")}),[s.length,b,y]);const[x,w]=(0,a.useState)(!1),S=c.type!==A.Vo.MULTIPLE_IDLE?c.pageId:void 0;return(0,V.jsxs)("div",{className:Pe()(Ge,x?Ue:void 0),onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move"},onDrop:i=>{var r;i.preventDefault(),w(!1);let n=Array.from(null===(r=i.dataTransfer)||void 0===r?void 0:r.files);n.length>k.fJ-s.length&&(d.Z.error({content:g.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:k.fJ},"You can edit up to {number0} pages at the same time")}),n=n.slice(0,k.fJ-s.length)),e.batchMaterialType=A.KY.MAIN,n.forEach((i=>{(0,R.UM)({action:R.td.IMPORT,isAutoCut:t.autoRemoval?1:0,importSource:"my_device",importType:R.Lo.DRAG}),e.uploadMaterialInProject({file:i,meta:{actionType:H.lJ.DRAG_TO_PANEL,currentPage:"smart_tool_page",position:H.Rz.BROWER_OUTSIDE,toolType:o.B8.Batch,batchType:o.Ac.MaterialUpload}}).catch((e=>{d.Z.error({content:e.message,duration:2e3})}))}))},onDragEnter:e=>{w(!0)},onDragLeave:e=>{w(!1)},children:[(0,V.jsx)(St,{}),s.length?(0,V.jsx)("div",{className:He,children:(0,V.jsx)(Fe,{pageList:s.map((e=>({...e,pageStatus:e.status}))),activeId:S,onAction:(e,a)=>{var o;const{draftId:l}=i,c=null===(o=s.find((t=>t.id===e)))||void 0===o?void 0:o.md5;switch(console.debug("debugger handleItemAction",{id:e,type:a}),a){case"select":if(v||f)return;m(e),(0,bt.G8)({action:bt.CJ.CLICK_PICKTURE_EDIT,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"duplicate":if(t.isReachMaxCount)return void d.Z.warning(g.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:k.fJ},"You can edit up to {number0} pages at the same time"));h(e),(0,bt.G8)({action:bt.CJ.DUPLICATE,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"delete":p(e),(0,bt.G8)({action:bt.CJ.DELETE,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"cancel":t.setPageStatus(A.Gy.process_success,e),(0,bt.G8)({action:bt.CJ.DELETE,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"retry_render":t.refreshPageById(e),(0,bt.G8)({action:bt.CJ.RETRY,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"retry_process":t.setPageStatus(A.Gy.processing,e),t.retryOperation(e),(0,bt.G8)({action:bt.CJ.RETRY,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"retry_upload":t.retryUpload(e),(0,bt.G8)({action:bt.CJ.RETRY,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"multiple_preset":n(),_({type:A.Vo.MULTIPLE_PRESETS,pageId:e}),(0,bt.G8)({action:bt.CJ.MULTIPLE_PRESETS,draft_id:l,batch_picture_id:c,batch_page_id:e});break;case"multiple_size":r(),_({type:A.Vo.MULTIPLE_SIZE,pageId:e}),(0,bt.G8)({action:bt.CJ.MULTIPLE_SIZE,draft_id:l,batch_picture_id:c,batch_page_id:e})}},globalLoading:v,isReadonly:f,onDragDrop:(e,t)=>{console.debug("debugger drag drop",{draggedId:e,dropOnId:t})}})}):(0,V.jsx)(z,{uploadService:e,showSlogan:!y})]})})),Ct="batchEditorRender-LBbZQj",Et=()=>(0,V.jsx)("div",{className:Ct,children:(0,V.jsx)(It,{})});var Dt,At=i(84435),Lt=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},kt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Rt=function(e,t){return function(i,r){t(i,r,e)}};let Mt=class extends r.JT{constructor(e){super(),this.batchEditorUIService=e,this.batchEditorUIService.registerContentUI({id:"batch-ui-content",render:this._batchContentRender.bind(this)})}dispose(){super.dispose()}_batchContentRender(){return(0,V.jsx)(n.K,{children:(0,V.jsx)(Et,{})})}};Mt=Lt([Rt(0,At.k),kt("design:paramtypes",["function"==typeof(Dt=void 0!==At.k&&At.k)?Dt:Object])],Mt)},40146:(e,t,i)=>{i.d(t,{I:()=>n,S:()=>a});var r=i(18571);const n=(0,r.createContext)({onClose:()=>{},maxHeight:0,setMaxHeight:()=>{}}),a=(0,r.createContext)(void 0)},317:(e,t,i)=>{i.d(t,{wO:()=>E,Ml:()=>D,ee:()=>M,Md:()=>j,uF:()=>R});var r=i(18571),n=i(5789),a=i.n(n),o=i(47946),s=i(58895),l=i(37918),c=i(32709),d=i(26166),u=i(8757),h=i(25629),g=i(48726);const p=8;function m(e,t,i,r,n,a){const o=a+2*p>i?i-2*p:a,{x:s,y:l}=r,{x:c,y:d}=e,u=i-(l-d)-p>o?l:i-o-p+d,h=t-(s-c)-p>n?s:t-n-p+c;return{x:Math.max(h,p+c),y:Math.max(u,p+d),height:o}}var _=i(79872),v=i(35113),f=i(47612),y=i(14906),b=i(92204),x=i(72322);const w=s.Z.Item,S=(0,r.memo)((e=>{const{className:t,activeSubMenu:i,contextmenuKey:n,editor:o,menuStyle:s,setActiveSubMenu:l,setContextMenuVisible:_,icon:S,text:P,textColor:I,subMenu:C,controller:E,menuDisable:A,followCanvas:L}=e,{layout:k,menuRef:R,menuViewRef:M}=function(e,t,i,n){var a,o;const s=t.getRenderSDK(),l=(0,r.useRef)(null),_=(0,r.useRef)(null),[v,f]=(0,r.useState)(),y=(0,d.w)(),b=(0,g.Z)();(0,c.Z)((()=>h.Z.interact.onPageLayoutChange.event((()=>{b()}))));const x=(0,r.useCallback)(((t,i,r)=>{const{x:n,y:a=0,width:o}=r,s=n-2,l={x:s-e,y:a},c={x:s+(o+4),y:a};return c.x+e+p<=t.x+i?c:l.x-p>=t.x?l:c}),[e]),w=null===(a=l.current)||void 0===a||null===(o=a.getBoundingClientRect)||void 0===o?void 0:o.call(a);return{layout:(0,r.useMemo)((()=>{if(!w||!v)return;const t=s.stage.rect,{width:i,height:r}=y,n=x({x:t.x,y:u.cM},i-t.x,w);return m({x:t.x,y:u.cM},i-t.x,r-u.cM,n,e,v)}),[n,y,i,s,e,x,w,v]),menuRef:e=>{l.current=e},menuViewRef:e=>{e&&f(null==e?void 0:e.getBoundingClientRect().height),_.current=e}}}(D,o,n,i),[T,j]=(0,r.useState)(),N=k?{top:`${k.y}px`,left:`${k.x}px`,maxHeight:k.height?`${k.height}px`:"auto"}:{opacity:0},B=(0,r.useMemo)((()=>C.map((e=>({list:e.menus.map((e=>{var t;const{icon:i,text:r,shortKey:s,data:l,getContent:c,style:d}=e,u=null==E||null===(t=E.shouldSubMenuDisable)||void 0===t?void 0:t.call(E,e);return{onSubMenuClick:t=>{var i;u?t.stopPropagation():((0,v.lr)(o.getRenderSDK(),n,L?b.d.Canvas:b.d.FunctionBar,l),null==E||null===(i=E.onSubMenuClick)||void 0===i||i.call(E,e),null==_||_(!0))},menu:e,isCustomContent:Boolean(c),menuContent:c?c():(0,x.jsxs)(x.Fragment,{children:[i?(0,x.jsx)("div",{className:a()("attribute-menu-icon",{"menu-disable":null==E||null===(h=E.shouldSubMenuDisable)||void 0===h?void 0:h.call(E,e)}),children:i()}):null,r?(0,x.jsx)("div",{className:a()("attribute-menu-text",{"menu-disable":null==E||null===(g=E.shouldSubMenuDisable)||void 0===g?void 0:g.call(E,e)}),children:r()}):null,s?(0,x.jsx)("div",{className:"attribute-menu-shortkey",children:s()}):null]}),menuContentStyle:d};var h,g})),className:e.className})))),[C]),Z=()=>{A||j(n)},O=()=>{A||j(void 0)};return(0,x.jsx)(f.Z,{trigger:"hover",getPopupContainer:()=>document.body,onVisibleChange:e=>l(e?n:void 0),disabled:A,popup:()=>(0,x.jsx)("div",{className:a()(t,"attribute-menu","attribute-sub-contextmenu-view"),style:N,ref:M,onMouseOver:Z,onMouseOut:O,children:B.map(((e,t)=>(0,x.jsx)("div",{className:a()("contextmenu-part",e.className),children:e.list.map(((e,t)=>{var i;const{isCustomContent:r,menu:n,onSubMenuClick:o,menuContent:s,menuContentStyle:l}=e;return(0,x.jsx)(w,{style:l,className:a()(r?"attribute-custom-menu":"attribute-menu","attribute-sub-menu"),onMouseDown:e=>e.stopPropagation(),onClick:o,disabled:null==E||null===(i=E.shouldSubMenuDisable)||void 0===i?void 0:i.call(E,n),children:s},t.toString())}))},t)))}),children:(0,x.jsx)("div",{ref:R,children:(0,x.jsxs)(w,{className:a()("attribute-menu",{"attribute-menu-active":T===n}),style:s,onMouseOver:Z,onMouseOut:O,disabled:A,children:[S&&(0,x.jsx)("div",{className:"attribute-menu-icon",children:S}),(0,x.jsx)("div",{className:"attribute-menu-text",style:{color:I},children:P}),(0,x.jsx)(y.HK9,{size:20})]},n.toString())})})}));var P=i(48607),I=i(58721),C=i(40146);const E=parseFloat(_.Z["attribute-contextmenu-width"]),D=parseFloat(_.Z["attribute-sub-contextmenu-width"]),A=parseFloat(_.Z["attribute-contextmenu-item-height"]),L=parseFloat(_.Z["attribute-contextmenu-padding"]),k=parseFloat(_.Z["attribute-contextmenu-border"]);var R,M;!function(e){e[e.Canvas=0]="Canvas",e[e.Navigator=1]="Navigator",e[e.NavigatorPage=2]="NavigatorPage"}(R||(R={})),function(e){e[e.LeftTop=0]="LeftTop",e[e.RightTop=1]="RightTop",e[e.LeftBottom=2]="LeftBottom",e[e.RightBottom=3]="RightBottom"}(M||(M={}));const T=s.Z.Item,j=(0,r.memo)(r.forwardRef(((e,t)=>{const{editor:i,contextmenuKeys:n,position:c,className:p="",setVisible:_,visible:f,area:y,pageIds:w,anchor:D=M.LeftTop,followCanvas:j}=e,[N,B]=(0,r.useState)(),Z=(0,r.useCallback)((e=>{const t=o.Z.contextmenu.getControllerInstance(e,i),r=o.Z.contextmenu.getConfig(e);if(null==t||t.setContextmenuPos(c),null==t||t.setContextmenuArea(y),!r)return!1;const{layerTypes:n}=r;var a;if(!n||(null==n?void 0:n.length)<=0)return null==t||null===(a=t.shouldHide)||void 0===a?void 0:a.call(t);if(null==t||!t.isSelectedMultiLayer){const e=null==t?void 0:t.selectedLayerType;var s;if(e&&n&&n.includes(e))return null==t||null===(s=t.shouldHide)||void 0===s?void 0:s.call(t)}return!0}),[i,c,y]),O=(0,r.useMemo)((()=>n.map((e=>e.filter((e=>!Z(e))))).filter((e=>e.length>0))),[Z,n]);(0,r.useEffect)((()=>{i.setContextMenuPageIds(null!=w?w:[])}),[w]);const{layout:K}=function(e,t,i,n,a,o,s){const{x:l,y:c}=e,p=n.getRenderSDK(),_=(0,d.w)(),v=(0,g.Z)(),f=(0,r.useCallback)((()=>{const e=p.stage.rect,t=p.getPagePosition(),i=a===R.Canvas;return{x:i?l+t.x+e.x:l,y:i?c+t.y+e.y:c}}),[p,l,c,a]);(0,r.useEffect)((()=>{if(s)return h.Z.interact.onPageLayoutChange.event((()=>{v()}))}),[s]);const y=f();return{layout:(0,r.useMemo)((()=>{const e=p.stage.rect,{width:r,height:n}=_;let{x:a,y:s}=y;switch(o){case M.LeftTop:break;case M.RightTop:a-=i;break;case M.LeftBottom:s-=t;break;case M.RightBottom:a-=i,s-=t}return m({x:e.x,y:u.cM},r-e.x,n-u.cM,{x:a,y:s},i,t)}),[_,y,t,i,p,o])}}(c,(e=>e.reduce(((e,t,i)=>{let r=e;return i>0&&(r+=2*L),r+=t.length*A,r}),2*(L+k)))(O),E,i,y,D,j);(0,l.V)(t,(()=>{null==_||_(!1)})),(0,r.useEffect)((()=>{f||B(void 0)}),[f]);const{x:F,y:G,height:U}=K,H={"--contextmenu-top":`${G}px`,"--contextmenu-left":`${F}px`,"--contextmenu-height":U?`${U}px`:"auto",zIndex:String(P.ly)},V=(0,r.useMemo)((()=>O.map((e=>e.map((e=>{var t,r,n,a,s,l,d,u,h,g,p,m,_;const v=o.Z.contextmenu.getControllerInstance(e,i),f=o.Z.contextmenu.getConfig(e);null==v||v.setContextmenuPos(c);const y=null!==(t=null==v||null===(r=v.getIcon)||void 0===r?void 0:r.call(v))&&void 0!==t?t:null==f||null===(n=f.icon)||void 0===n?void 0:n.call(f),b=null!==(a=null==v||null===(s=v.getText)||void 0===s?void 0:s.call(v))&&void 0!==a?a:null==f||null===(l=f.text)||void 0===l?void 0:l.call(f),x=null!==(d=null==v||null===(u=v.getShortKey)||void 0===u?void 0:u.call(v))&&void 0!==d?d:null==f||null===(h=f.shortKey)||void 0===h?void 0:h.call(f),w=null==f?void 0:f.style,S=null==f?void 0:f.textColor,P=null==v||null===(g=v.shouldMenuDisable)||void 0===g?void 0:g.call(v),I=null==v||null===(p=v.getTooltip)||void 0===p?void 0:p.call(v);return{icon:y,text:b,shortKey:x,menuStyle:w,textColor:S,subMenu:null!==(m=null==v||null===(_=v.getSubMenu)||void 0===_?void 0:_.call(v))&&void 0!==m?m:null==f?void 0:f.subMenu,contextmenuKey:e,controller:v,menuDisable:P,tooltip:I}}))))),[O]),z=(0,r.useCallback)((e=>{e.preventDefault()}),[]),W=f?(0,x.jsx)("div",{className:a()(p),style:H,ref:t,onContextMenu:z,children:(0,x.jsx)(s.Z,{mode:"pop",children:V.map(((e,t)=>(0,x.jsx)("div",{className:"contextmenu-part",children:e.map((e=>{const{icon:t,text:r,shortKey:n,menuStyle:a,textColor:o,subMenu:s,contextmenuKey:l,controller:c,menuDisable:d,tooltip:u}=e;if(!s||s.length<=0){const e=e=>{var t;d?e.stopPropagation():((0,v.lr)(i.getRenderSDK(),l,j?b.d.Canvas:b.d.FunctionBar),null==c||null===(t=c.onClick)||void 0===t||t.call(c,e),null==_||_(!0))},s=(0,x.jsxs)("div",{className:"attribute-menu-item",children:[t&&(0,x.jsx)("div",{className:"attribute-menu-icon",children:t}),(0,x.jsx)("div",{className:"attribute-menu-text",style:{color:o},children:r}),n?(0,x.jsx)("div",{className:"attribute-menu-shortkey",children:n}):null]});return(0,x.jsx)(T,{className:"attribute-menu",style:a,onClick:e,disabled:d,children:u?(0,I.Uy)(s,u,{position:"top"}):s},l.toString())}return(0,x.jsx)(S,{className:p,menuStyle:a,activeSubMenu:N,contextmenuKey:l,editor:i,controller:c,setActiveSubMenu:B,setContextMenuVisible:_,icon:t,text:r,textColor:o,subMenu:s,menuDisable:d,followCanvas:j},l.toString())}))},t)))})}):null;return(0,x.jsx)(C.S.Provider,{value:i,children:W})})))},58721:(e,t,i)=>{i.d(t,{Uy:()=>a,X3:()=>s,k8:()=>o});var r=i(23224),n=i(72322);const a=(e,t,i={})=>{const a={position:"bottom",...i};return(0,n.jsx)(r.Z,{...a,content:t,children:e})};var o;!function(e){e.Mouseout="mouseout"}(o||(o={}));const s=(e,t,i)=>{if(!t)return;const{bubbles:r=!0,cancelable:n=!0}=null!=i?i:{},a=new MouseEvent(e,{view:window,bubbles:r,cancelable:n});t.dispatchEvent(a)}},90889:(e,t,i)=>{i.d(t,{Fk:()=>m,Pv:()=>l,R:()=>o,Uf:()=>c,W2:()=>u,_w:()=>h,az:()=>f,ei:()=>d,f7:()=>v,hU:()=>_,hb:()=>s,k4:()=>n,mr:()=>a,q0:()=>g,tA:()=>p});var r=i(27175);const n=()=>r.ZP.t("web_issues_list_title",{},"Usability issues"),a=()=>r.ZP.t("web_issues_list_type1",{},"Must fix"),o=()=>r.ZP.t("web_issues_list_type2",{},"Suggested fix"),s=()=>r.ZP.t("web_issues_list_check",{},"Check again"),l=()=>r.ZP.t("web_graphic_publish_as_template",{},"Publish as template"),c=(e,t)=>r.ZP.t("web_issues_list_checked_pages",{num:e,string0:t},"Checked page {string0}"),d=()=>r.ZP.t("web_issues_list_text1",{},"You have fixed all usability issues!"),u=()=>r.ZP.t("web_issues_list_text2",{},"You have fixed all must to be fixed issues, you can publish template now. Or you can fix other issues that be suggested to fix first."),h=e=>r.ZP.t("web_issues_list_cnt",{num:e},"issues"),g=()=>r.ZP.t("web_issues_layer_frame",{},"Frame"),p=()=>r.ZP.t("web_issues_layer_grid",{},"Grid"),m=()=>r.ZP.t("web_issues_layer_photo",{},"Photo"),_=()=>r.ZP.t("web_issues_layer_shape",{},"Shape"),v=()=>r.ZP.t("web_issues_layer_sticker",{},"Sticker"),f=()=>r.ZP.t("web_issues_layer_text",{},"Text")},69757:(e,t,i)=>{i.d(t,{J_:()=>l,NM:()=>o,_q:()=>s});var r=i(8757),n=i(90889),a=i(21204);const o=(e,t)=>Object.keys(e).reduce(((i,r)=>i+e[r].filter((e=>e.checkType===t)).length),0),s=(e,t)=>{const i=Object.keys(e);return Array.from(new Set(i.reduce(((i,r)=>[...i,...e[r].filter((e=>e.layerId===t)).map((e=>e.id))]),[])))},l={[r.F5.TEXT]:n.az,[r.F5.IMAGE]:e=>e&&(0,a.U0)(e)?(0,n.f7)():(0,n.Fk)(),[r.F5.SVG_IMAGE]:n.f7,[r.F5.IMAGE_CONTAINER]:n.q0,[r.F5.LINE]:n.hU,[r.F5.SHAPE]:n.hU,[r.F5.GRID]:n.tA}},47495:(e,t,i)=>{i.d(t,{V:()=>R});var r=i(71230),n=i.n(r),a=i(18571),o=i(5789),s=i.n(o),l=i(32709),c=i(57710),d=i(25629),u=i(48726),h=i(8757),g=i(43382);const p=new g.S;var m=i(84020),_=i(48607),v=i(91123),f=i(17083);const y="pageTitleView-HLBmdA",b="pageTitleInput-z3qvfe",x="active-yU3Kg6",w="pageTitleNo-qJRF6I",S="pageTitleDivider-td0DdN",P="pageTitleEdit-K4ILY1",I="pageTitleInputDefault-ku_VpL",C="pageTitleInputPlaceholder-ghl63S",E="preventEvents-Bx39Ua",D="hide-U_Czrv";var A=i(27175),L=i(25222),k=i(72322);const R=e=>{const{className:t,visible:i,editor:r}=e,o=r.getRenderSDK(),R=r.getGraphicSDK(),{editorType:M}=r.getDependence(),{ref:T,position:j}=function(e){const[t,i]=(0,a.useState)(0),r=(0,u.Z)(),n=e.getRenderSDK().accessors.page.getActivePageClientRectRelativeToStage();(0,l.Z)((()=>{p.add(d.Z.interact.onPageLayoutChange.event(r)),p.add(d.Z.interact.onPageZoomChange.event(r)),p.add(e.getRenderSDK().onActivePageSwitched(r));const t=e.getPageBleedView();return t&&p.add(t.onOpenStatusChange(r)),()=>{p.clear()}}));const[,o]=(0,c.Z)((e=>{e&&e.offsetHeight!==t&&i(e.offsetHeight)}),[t]);return{ref:o,position:n?{x:n.x,y:n.y-h.cM-t-8}:void 0}}(r),[N,B]=(0,a.useState)(0),[Z,O]=(0,a.useState)(""),[K,F]=(0,a.useState)(0),[G,U]=(0,a.useState)(!1),[H,V]=(0,a.useState)(!1),[z,W]=(0,a.useState)(!1),$=(0,a.useRef)(null),Y=(0,a.useMemo)((()=>o.accessors.page.getPageIdByIndex(N)),[N]),X=(0,a.useRef)(!1);(0,a.useLayoutEffect)((()=>{const e=o.accessors.page.getTitle(Y);O(null!=e?e:"")}),[N,Y]),(0,a.useEffect)((()=>{const e=n()((()=>{W(!1)}),100);return v.default.events.interact.onPageLayoutChange.event((()=>{W(!0),e()}))}),[W]),(0,l.Z)((()=>{const e=r.getDependence().getLastPageId();if(F(o.getAllPages().length),!e)return;const[t]=o.accessors.page.getPageIndexesByIdList([e]);B(t)})),(0,a.useEffect)((()=>{const e=()=>{F(o.getAllPages().length),B(o.getActivePageIndex())};R.event.addListener(m.B.AFTER_MUTATION_RUN,e);const t=new g.S;t.add((()=>R.event.removeListener(m.B.AFTER_MUTATION_RUN,e))),t.add(o.onActivePageSwitched((()=>{B(o.getActivePageIndex()),O("")})));return t.add(v.default.events.interact.onMaterialSelect.event((e=>{const{selectedList:t}=e;1===t.length&&o.accessors.page.isPage(t[0].id)?U(!0):U(!1)}))),t.add(o.onPagePositionUpdated((()=>{B(o.getActivePageIndex())}))),()=>{t.clear()}}),[R,o]);const q=(0,a.useCallback)((e=>{var t,i;"Enter"===(null==e?void 0:e.code)&&(null===(t=$.current)||void 0===t||null===(i=t.blur)||void 0===i||i.call(t))}),[]),J=(0,a.useCallback)((e=>{O(e)}),[]),Q=(0,a.useCallback)((e=>{X.current=!0;e.target.select()}),[]),ee=(0,a.useCallback)((()=>{X.current=!1;const e=r.getSuspendToolView(),t=Boolean(r.getSelectedMaterials().find((e=>e.id===Y)));null!=e&&e.isShow()||!t||null==e||e.show();o.accessors.page.getTitle(Y)!==Z&&R.api.page.updateTitle(Y,Z)}),[Z,Y]),te=H||Z||G,ie=(0,a.useMemo)((()=>(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:w,children:`Page ${N+1}`}),(0,k.jsx)("div",{className:s()(S,!te&&D),children:"-"}),(0,k.jsxs)("div",{className:s()(P,!te&&D),children:[(0,k.jsx)("span",{className:C,children:Z||A.ZP.t("web_typesetting_button_add_page_title",{},"Enter title")}),(0,k.jsx)(f.default,{className:s()(b,!Z&&I),ref:$,type:"text",onPressEnter:()=>{var e;null===(e=$.current)||void 0===e||e.blur()},placeholder:A.ZP.t("web_typesetting_button_add_page_title",{},"Enter title"),onFocus:Q,maxLength:255,value:Z,onChange:J,onKeyDown:q,onBlur:ee})]})]})),[te,Z,ee,q,J,N]),re=(0,a.useCallback)((()=>{var e;(o.accessors.selection.triggerMaterialsSelection([o.getActivePageId()]),X.current)&&(null===(e=r.getSuspendToolView())||void 0===e||e.hide())}),[]),ne=(0,a.useCallback)((()=>{V(!0)}),[]),ae=(0,a.useCallback)((()=>{V(!1)}),[]);if(!i||!j||M!==L.gg.Main)return null;const oe={"--page-title-left":`${j.x}px`,"--page-title-top":`${j.y}px`,zIndex:String(_.C3)};return(0,k.jsx)("div",{ref:T,style:oe,className:s()(y,G&&x,z&&E),onClick:re,onMouseEnter:ne,onMouseLeave:ae,children:ie})}},70327:(e,t,i)=>{i.d(t,{DS:()=>s,Fx:()=>o,Iv:()=>h,K6:()=>l,PE:()=>w,Q:()=>r,Su:()=>m,TC:()=>v,TT:()=>n,bt:()=>y,d9:()=>a,db:()=>f,lF:()=>u,m$:()=>_,mi:()=>b,p9:()=>c,tx:()=>p,w4:()=>x,wQ:()=>d,xw:()=>g});const r="__editor_container_id__",n="__editor_edit_tool_container_id__",a="__editor_edit_tool_bar_id__",o="__editor_edit_canvas_tool_bar_id__",s="__editor_edit_suspend_tool_bar_id__",l="__editor_edit_contextmenu_id__",c="__editor_edit_navigator_contextmenu_id__",d="__editor_edit_page_suspend_id__",u="__editor_edit_page_text_box_id__",h="PAGE_NAVIGATION",g="__editor_edit_page_layers_id__",p="__editor_edit_page_rulers_id__",m="__editor_edit_page_margin_id__",_="__editor_edit_page_bleed_id__",v=[{className:"graphic-edit-page-suspend",id:d},{className:"graphic-edit-suspend-bar",id:s},{className:"graphic-edit-tool-bar",id:a},{className:"graphic-edit-canvas-tool-bar",id:o},{className:"graphic-edit-contextmenu-bar",id:l},{className:"graphic-edit-navigator-context-menu-bar",id:c},{className:"graphic-edit-text-edit-area",id:u}],f="text-editor-area",y={template_version:"1.0.0",features:["element.background","layer.base"],platform:[]},b="navigator_placeholder",x="navigator_page_list",w="navigator_add_page"},6857:(e,t,i)=>{i.d(t,{B:()=>n});var r=i(54714);const n={name:"video_cover",quality:1,qualityLabel:"High",pixelRatio:1,mimeType:r.qr[r.Tv.JPEG],transparentBackground:0,compressPNG:0,flattenPDF:0,maxHeight:720}},91275:(e,t,i)=>{i.d(t,{g:()=>r,p:()=>n});const r=Object.freeze({Export:Symbol("Export"),CopyPhotoId:Symbol("CopyPhotoId"),Delete:Symbol("Delete"),Copy:Symbol("Copy"),Paste:Symbol("Paste"),Group:Symbol("Group"),Align:Symbol("Align"),Layer:Symbol("Layer"),ApplyColorTheme:Symbol("ApplyColorTheme"),DetachPhoto:Symbol("DetachPhoto"),Duplicate:Symbol("Duplicate"),SelectLayer:Symbol("SelectLayer"),SetPageBackgroundImage:Symbol("SetPageBackgroundImage"),DetachPageBackgroundImage:Symbol("DetachPageBackgroundImage"),Flip:Symbol("Flip"),Lock:Symbol("Lock"),ShowLayersPanel:Symbol("ShowLayersPanel"),ShowRulers:Symbol("ShowRulers"),Guides:Symbol("Guides")}),n=[[r.Copy,r.Paste,r.Duplicate,r.Delete],[r.Group,r.Align,r.SelectLayer,r.Layer,r.Lock],[r.DetachPhoto,r.SetPageBackgroundImage,r.DetachPageBackgroundImage,r.ApplyColorTheme,r.Flip],[r.ShowLayersPanel,r.ShowRulers,r.Guides,r.Export,r.CopyPhotoId]]},17960:(e,t,i)=>{i.d(t,{C:()=>b,m:()=>f});var r=i(78936),n=i(91275),a=i(27175);const o={name:n.g.SelectLayer,text:()=>a.ZP.t("web_bgimage_button_select_layer",{},"Select layer")};var s=i(20152),l=i(8757),c=i(14906),d=i(32709),u=i(5789),h=i.n(u),g=i(18571),p=i(72322);const m=e=>{const{icon:t,getSrc:i,isActive:r,isLocked:n,onMouseOver:a,onMouseOut:o}=e,[s,l]=(0,g.useState)();return(0,d.Z)((()=>{i().then(l)})),(0,p.jsxs)("div",{className:h()("select-item",{"select-item-active":r}),onMouseOver:a,onMouseOut:o,children:[(0,p.jsx)("div",{className:"select-item-icon",children:t}),s?(0,p.jsx)("img",{src:s,className:"select-item-content"}):null,n?(0,p.jsx)(c.zzm,{className:"select-item-lock-icon",size:16}):null]})};var _=i(21204),v=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};const f="show all layers",y={[l.F5.TEXT]:()=>(0,p.jsx)(c.FzQ,{size:16}),[l.F5.GROUP_LAYER]:()=>(0,p.jsx)(c.P_h,{size:16}),[l.F5.IMAGE]:e=>e&&(0,_.U0)(e)?(0,p.jsx)(c.zfE,{size:16}):(0,p.jsx)(c.KIJ,{size:16}),[l.F5.SVG_IMAGE]:()=>(0,p.jsx)(c.zfE,{size:16}),[l.F5.IMAGE_CONTAINER]:()=>(0,p.jsx)(c.KYn,{size:16}),[l.F5.LINE]:()=>(0,p.jsx)(c.uJc,{size:16}),[l.F5.SHAPE]:()=>(0,p.jsx)(c.uJc,{size:16}),[l.F5.GRID]:()=>(0,p.jsx)(c.Z3x,{size:16})};let b=class extends s.L{getSubMenu(){const e=[this._getLayerSubMenuPart()],t=this._getShowLayersSubMenuPart();return t&&e.push(t),e}onSubMenuClick(e){if(!e)return;const{accessors:t}=this;t.selection.triggerMaterialsSelection([e.data])}shouldHide(){if(this._getSelectLayer().length<=1)return!0;const e=this._editor.getContextmenuView();return null==e||!e.followCanvas}_getShowLayersSubMenuPart(){if(this._isPageLayersViewOpen())return;const e=()=>{const e=this._editor.getPageLayersView();null==e||e.show()};return{menus:[{getContent:()=>(0,p.jsx)("div",{className:"show-all-layers",onClick:e,children:(0,p.jsx)("div",{className:"btn",children:a.ZP.t("web_layer_button_show_layers",{},"Show all layers")})}),data:f}],className:"show-layers-part"}}_getLayerSubMenuPart(){const{accessors:e,selectedId:t,isSelectedMultiLayer:i}=this;return{menus:this._getSelectLayer().map((r=>{const{type:n,id:a}=r,o=()=>e.stage.exportLayerImage(a);if(n===l.Cb.KONVA_LAYER||n===l.Cb.KONVA_STAGE||n===l.Cb.PAGE||n===l.Cb.PAGE_CONTAINER||n===l.Cb.RULER_LINE||n===l.F5.PAGE)return null;const s=y[n],c=e.layer.getLayerById(a);if(!c||!s)return null;const d=s(c),u=Boolean(!i&&t&&a===t),h=e.layer.isLocked([a]);return{getContent:()=>(0,p.jsx)(m,{icon:d,isActive:u,isLocked:h,getSrc:o,onMouseOver:()=>{u||e.selection.hover(a)},onMouseOut:()=>{u||e.selection.unHover(a)}}),data:r.id}})).filter((e=>e)),className:"select-layers-part"}}_getSelectLayer(){const{accessors:e,contextmenuPos:t}=this;if(!t)return[];return e.page.getPointerIntersectLayers(t).filter((e=>e.type!==l.F5.PAGE)).reverse()}_isPageLayersViewOpen(){var e;return null===(e=this._editor.getPageLayersView())||void 0===e?void 0:e.isOpen()}};b=v([(0,r.Q)({contextmenu:o})],b)},45464:(e,t,i)=>{i.d(t,{L:()=>s,p:()=>l});var r=i(57123),n=i(43825),a=i(54714);const o=r.EY.tool,s=()=>({[a.hx.Background]:{color:null,opacity:100,radius:0},[a.hx.Outline]:[{color:null,width:o.outlineWidth(n.q2),opacity:100}],[a.hx.Shadow]:[{color:null,angle:n.du,distance:n.pn,blur:n.cW,opacity:100}],[a.hx.Glow]:{color:null,intensity:o.glowIntensity(n.f$),range:o.glowIntensity(n.DI)},[a.hx.Curve]:{angle:null},reset:!0}),l={[a.hx.Background]:{background:{color:{rgb:{r:255,g:255,b:255,a:1}}}},[a.hx.Outline]:{outline:{color:{rgb:{r:255,g:255,b:255,a:1}}}},[a.hx.Shadow]:{shadow:{color:{rgb:{r:255,g:255,b:255,a:1}}}},[a.hx.Glow]:{glow:{color:{rgb:{r:255,g:255,b:255,a:1}}}},[a.hx.Curve]:{curve:{angle:o.curveAngle(n.r9)}}}},47922:(e,t,i)=>{i.d(t,{T:()=>r});const r=(0,i(67126).yh)("editorWidgetAdapter")},27457:(e,t,i)=>{i.d(t,{Z:()=>Ie});var r=i(18571),n=i(35545),a=i(48018),o=i(42058),s=i(82552),l=i(35408),c=i(41800),d=i(84020),u=i(91123),h=i(14764),g=i(8757),p=i(24149),m=i(19833),_=i(54714);class v{constructor(e){this._plugin=e}attachEditor(){return this._plugin.createEditor()}}var f=i(9557),y=i(9586),b=i(26690),x=i(50601),w=i(28628),S=i(11042),P=i(7647),I=i(67986),C=i(91372),E=i(70327),D=i(82440),A=i(64525),L=i(24253),k=i(51825),R=i(47087),M=i(30250),T=i(28683),j=i(21100),N=i(27319),B=i(3765),Z=i(93891),O=i(44260),K=i(28525),F=i(33690),G=i(20484);class U{constructor(e){this._editor=e}get renderSdk(){return this._editor.getRenderSDK()}get api(){return this._editor.getGraphicSDK().api}addPage(e,t){if(void 0===t){t=this.renderSdk.accessors.page.getActivePage().dimension}const i=e+1;this.api.page.add(i,{dimension:(0,G.Sw)(t)})}delPage(){const e=this.renderSdk.accessors.page.getActivePageId();this.api.page.delete([e])}copyPage(){const e=this.renderSdk.accessors.page.getActivePageId();this.api.page.copyPage(e)}prePage(){const e=this.renderSdk.accessors.page,t=e.getPreviousPageId();t&&e.switchPage(t)}nextPage(){const e=this.renderSdk.accessors.page,t=e.getNextPageId();t&&e.switchPage(t)}switchPage(e){this.renderSdk.accessors.page.switchPage(e)}getActivePageIndex(){return this.renderSdk.accessors.page.getActivePageIndex()}getPageCount(){return this.renderSdk.accessors.page.getPageCount()}movePage(e,t){this.api.page.move(e,t)}}var H=i(54155),V=i(25222),z=i(6857),W=i(88233),$=i(6343),Y=i(11467),X=i(49384),q=i(77290);class J{constructor(e){this._plugin=e}open(e){return this._adapter=new e(this._plugin),this._adapter.attachEditor()}}var Q,ee,te,ie,re,ne,ae,oe,se,le,ce,de,ue,he,ge,pe,me,_e,ve,fe,ye=i(7081),be=i(85441),xe=i(72322),we=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},Se=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Pe=function(e,t){return function(i,r){t(i,r,e)}};let Ie=(Q=class extends n.JT{constructor(e,t,i,n,s,c,h,g,p,m,v,f,y,b,x,w,S,P,C,E){super(),this.configurationService=e,this.environmentService=t,this.documentModelService=i,this.graphicConfigurationService=n,this.instantiationService=s,this.workbenchService=c,this.draftManagerService=h,this.accountService=g,this.projectMaterialManagerService=p,this.svgJsonResource=m,this.permissionService=v,this.storageService=f,this.imageXUploadService=y,this.exportService=b,this.themeService=x,this._textEditService=w,this._imageEffectService=S,this._teaAdapterService=P,this._workspaceService=C,this.containerService=E,this._initAwaitLocker=new a.G,this._templateList={},this._ref=(0,r.createRef)(),this._dependence={},this._editPanelReadyCallback=[],this.onEditorStatus=(e,t)=>{var i,r;e===_.I9.firstPainted&&(null===(i=this._editor)||void 0===i||i.setRenderSDK(t),null===(r=this._editor)||void 0===r||r.setPlugin(this))},this.getPageThumbnailCovers=(e,t=.8)=>new Promise((i=>{setTimeout((async()=>{const r=e.map((e=>({id:e}))),n=await this.exportService.createCovers({pages:r,maxHeight:400,quality:t,fast:!0});i(n)}),0)})),this.getPageCover=(e,t=.5,i=.8,r,n,a)=>this.exportService.createCover({page:e,scale:t,quality:i,isTransparent:null!=n?n:this.configurationService.renderConfig.transparentBackground,type:r,useGrid:a}),this.setTemplateList=e=>{var t;e.forEach((e=>{this._templateList[e.id]=e.optimized_cover_url.cover_url_small})),null===(t=this._ref.current)||void 0===t||t.updateTemplateList(this._templateList)},this.openExportPanel=e=>{this._dependence.showExportPanel(e)},this.addNodeToPage=e=>{const t={documentService:this.documentModelService,storageService:this.storageService,renderSDK:this._renderSDK,graphicSDK:this.documentModelService.graphicSDK,environmentService:this.environmentService,...e};(0,Y.n)(t)},this.setPageDisplayMode=e=>{var t;null===(t=this._ref.current)||void 0===t||t.setPageDisplayMode(e)},this._handleDefaultText=e=>{this._handleDefaultTextCallback=e},this._onLoadMaterialClick=e=>{this._onLoadMaterialClickCallback=e},this._onHeaderBarClick=e=>{this.workbenchService.refreshRender(l.Mp.TitleBar)},this._initEditPanelReady=()=>{this._editPanelReadyCallback.forEach((e=>e())),this._editPanelReadyCallback=[]},this._getLastPageId=()=>{const e=this.storageService.keyValue.query(ee.PAGE_ID);var t;if(!e.ok||!e.value)return null===(t=this._editor)||void 0===t?void 0:t.getGraphicSDK().document.pages[0].id;(0,o.ZB)(e.value);try{return JSON.parse(e.value)[this.draftManagerService.draftId]}catch(i){I.t.error("get last opened pageId failed",i)}},this.onActivePageSwitched=e=>{const t={[this.draftManagerService.draftId]:e.to};this.storageService.keyValue.set(ee.PAGE_ID,JSON.stringify(t))},b.setDependence(this),w.setDependence(this),S.setDependence(this),c.updateUIConfig({editors:[{name:"graphic-editor",content:this._contentRender.bind(this)}]}),u.default.events.interact.onModelInitFinish.event((()=>{(0,W.d9)(W.$I.RenderSDK),(0,W.Bz)(i.graphicSDK.api.common.getLayersByFilter(!0,(()=>!0))),this.workbenchService.onOperateDetailPageOpen((()=>{this.keyEditorUnRegister()})),this.workbenchService.onOperateDetailPageClose((()=>{this.keyEditorRegister()}))})),h.setDependence("getCanvasCover",(async e=>{const i=e.map((e=>{var t;return null===(t=this._renderSDK.model.pages[e])||void 0===t?void 0:t.id}));if([V.gg.EditorPC,V.gg.EditorWeb].includes(t.editorType)){return await this.exportService.createCovers({pages:i.map((e=>({id:e,name:z.B.name,type:$.t.JPG}))),quality:z.B.quality,maxHeight:z.B.maxHeight})}return this.getPageCovers(i)})),i.graphicSDK.event.addListener(d.B.AFTER_MUTATION_RUN,(e=>{this.handleSidebarCollapse(e)}))}getPageCovers(e){return new Promise((t=>{setTimeout((async()=>{const i=e.map((e=>{const t=this.documentModelService.graphicSDK.document.getPageById(e);return(0,C.aX)(null==t?void 0:t.background.color)?{id:e,type:$.t.PNG}:{id:e,type:$.t.JPG}})),r=await this.exportService.createCovers({pages:i,maxHeight:400,quality:.8,fast:!0});t(r)}))}))}async bootstrap(){await this._initAwaitLocker.awaitForInit()}dispose(){var e;null===(e=this._onActivePageSwitchedDispose)||void 0===e||e.call(this),super.dispose()}registerEditPanelReadyCallback(e){this._editPanelReadyCallback.push(e)}get renderSDK(){return(0,o.Y2)(this._renderSDK,"renderSDK is not defined"),this._renderSDK}get editor(){return(0,o.Y2)(this._editor,"editor is not defined"),this._editor}isTextEditing(){var e;return Boolean(null===(e=this._editor)||void 0===e?void 0:e.isTextEditing())}getUserInfo(){return this.accountService.userProfile}createEditor(){return new m.M(this._renderSDK,this.documentModelService.graphicSDK,{editorType:this.environmentService.editorType,permission:this.permissionService.getDraftPermission(),uploadMaterialInProject:this.projectMaterialManagerService.uploadMaterial.bind(this.projectMaterialManagerService),getUserInfo:()=>this.getUserInfo(),getUserUploadImages:()=>this.documentModelService.getAllEverFiles(),awaitGetUserUploadImages:()=>Promise.resolve(this.projectMaterialManagerService.materials),getWorkspaceId:()=>this.draftManagerService.workspaceId,defaultFontSetting:this.graphicConfigurationService.defaultText,resourceLokiPanel:this.graphicConfigurationService.resourcePanel,savePageAsNewDraft:(e,t,i)=>{const r=this.documentModelService.graphicSDK.api.document.createNewDocumentWithPages([t]);return this.draftManagerService.saveAsNewDraft({document:r,overwrite:{id:e,coverList:[i]}})},getSvgByMd5:this.svgJsonResource.get.bind(this.svgJsonResource),getHasLogin:()=>this.accountService.hasLogin,getLastPageId:this._getLastPageId,activeEverCloudSiderMenu:()=>this.workbenchService.activeSiderMenuByName(H.t,"auto"),selectMaterialFromVideo:()=>this.projectMaterialManagerService.selectFromVideo(),uploadImageToImageX:e=>this.imageXUploadService.uploadImage({file:e}),getPCFileMetadataWithMd5:e=>{var t,i;return null===(t=(i=this.projectMaterialManagerService).getPCFileMetadataWithMd5)||void 0===t?void 0:t.call(i,e)},updatePCExtraInfoWithMd5:(e,t)=>{var i,r;return null===(i=(r=this.projectMaterialManagerService).updatePCExtraInfoWithMd5)||void 0===i?void 0:i.call(r,e,t)},storageQuery:e=>this.storageService.keyValue.query(e),storageSet:(e,t)=>this.storageService.keyValue.set(e,t),onThemeEvent:this.themeService.onDidThemeChange,textEditService:this._textEditService,imageEffectService:this._imageEffectService,getAbTestVar:this._teaAdapterService.getABTestVar,storageService:this.storageService})}getPixel(){return this._renderSDK.accessors.page.getPixel()}onLoadMaterialClick(e,t){var i;null===(i=this._onLoadMaterialClickCallback)||void 0===i||i.call(this,e,t)}handleDefaultText(e){var t;return null===(t=this._handleDefaultTextCallback)||void 0===t?void 0:t.call(this,e)}loadTemplateMaterialResource(e){return(0,A.s)(this.documentModelService.graphicSDK,e)}cutoutDetailClick(e){this.workbenchService.openOperateDetailsPage(M.j.CutoutOperateDetailPage,e)}keyEditorUnRegister(){var e;(0,o.Y2)(this._editor,"editor widget is not ready"),null===(e=this._editor.getKeyEditor())||void 0===e||e.unRegister()}keyEditorRegister(){var e;(0,o.Y2)(this._editor,"editor widget is not ready"),null===(e=this._editor.getKeyEditor())||void 0===e||e.register()}getLayerBySelectedId(e){return this._renderSDK.accessors.layer.getLayerById(e)}getSelectedMaterialIds(){return this._renderSDK.accessors.selection.getSelectedMaterials()}setDependence(e,t){this._dependence[e]=t}_contentRender(){var e;return(0,xe.jsx)(be.$U,{instantiationService:this.containerService,children:(0,xe.jsx)(f.K,{children:(0,xe.jsx)(q.Z,{handleDefaultText:this._handleDefaultText,documentService:this.documentModelService,environmentService:this.environmentService,storageService:this.storageService,graphicSDK:this.documentModelService.graphicSDK,renderSDK:this._renderSDK,onDomReady:this._initDomReady.bind(this),onEditPanelReady:this._initEditPanelReady,onLoadMaterialClick:this._onLoadMaterialClick,onHeaderBarClick:this._onHeaderBarClick,uploadMaterialInProject:this.projectMaterialManagerService.uploadMaterial.bind(this.projectMaterialManagerService),getUserInfo:async()=>(await this.accountService.initialize(),this.accountService.userProfile),editor:this._editor,disableDraftSaveNextTime:this.draftManagerService.disableDraftSaveNextTime.bind(this.draftManagerService),draftPermission:this.permissionService.getDraftPermission(),getPageThumbnailCover:this.getPageThumbnailCovers,ref:this._ref,projectMaterialManager:this.projectMaterialManagerService,isLogin:this.accountService.hasLogin,draftWorkspaceInfo:this.accountService.hasLogin?null===(e=this._workspaceService.workspaceList)||void 0===e?void 0:e.find((e=>e.workspace_id===this.draftManagerService.workspaceId)):void 0})})})}_initDomReady(){if(this._initAwaitLocker.hasBeenDone)return;(0,W.T0)(W.$I.RenderSDK),this._renderSDK=new u.default({stage:{container:E.Q},model:this.documentModelService.graphicSDK.document,modelEvent:this.documentModelService.graphicSDK.event,modelInitFinish:this.documentModelService.graphicSDK.modelInitFinish,globalVars:{document,devicePixelRatio:window.devicePixelRatio,localStorage:window.localStorage},currentPageId:this._getLastPageId(),editorFeatureType:this._getEditorFeatureType(this.environmentService.editorType),renderConfig:this.configurationService.renderConfig});this.permissionService.getDraftPermission()===T.O.editable?this._renderSDK.switchEditorMode(h.je.editable):this._renderSDK.switchEditorMode(h.je.readonly),(0,y.r)()&&(i.g.__debugger={renderSDK:this._renderSDK,renderTree:this._renderSDK.stage.container,graphicSDK:this.documentModelService.graphicSDK,model:this.documentModelService.graphicSDK.document,undoRedo:this.documentModelService.graphicSDK.behavior.undoRedoStack,resourceManage:D.fc.getInstance(),widgetTree:()=>this._renderSDK.getWidgetTree()});const e=new J(this);this._editor=e.open(v),this.onEditorStatus(_.I9.firstPainted,this._renderSDK),this._pageManager=new U(this._editor),this._editor.setPageManager(this._pageManager),this._editor.setOpenExportPanelCallback(this.openExportPanel),this._initAwaitLocker.initDone(),this._onActivePageSwitchedDispose=this._renderSDK.onActivePageSwitched(this.onActivePageSwitched)}handleSidebarCollapse(e){e.actionType===g.Us.AddLayerAction&&window.innerWidth<=1080&&this.workbenchService.unActiveSidebarMenu()}_getEditorFeatureType(e){if(this.graphicConfigurationService.editorDisplayMode===V.J9.Batch)return g.ot.BatchEditor;switch(e){case V.gg.Main:return g.ot.Main;case V.gg.EditorPC:return g.ot.CoverEditorPC;case V.gg.EditorWeb:return g.ot.CoverEditorWeb;default:return g.ot.Main}}},ee=Q,Q.PAGE_ID="PAGE_ID",Q);Ie=ee=we([Pe(0,L.r),Pe(1,F.j),Pe(2,R.w),Pe(3,L.r),Pe(4,s.T),Pe(5,c.e),Pe(6,p.j),Pe(7,b.D),Pe(8,k.X),Pe(9,x._),Pe(10,j.H),Pe(11,N.d),Pe(12,B.B),Pe(13,$.A),Pe(14,Z.X),Pe(15,X.W),Pe(16,ye.L),Pe(17,w.w),Pe(18,S.WL),Pe(19,P.t),Se("design:paramtypes",["function"==typeof(te=void 0!==L.r&&L.r)?te:Object,"function"==typeof(ie=void 0!==F.j&&F.j)?ie:Object,"function"==typeof(re=void 0!==R.w&&R.w)?re:Object,"function"==typeof(ne=void 0!==L.r&&L.r)?ne:Object,"function"==typeof(ae=void 0!==s.T&&s.T)?ae:Object,"function"==typeof(oe=void 0!==c.e&&c.e)?oe:Object,"function"==typeof(se=void 0!==p.j&&p.j)?se:Object,"function"==typeof(le=void 0!==b.D&&b.D)?le:Object,"function"==typeof(ce=void 0!==k.X&&k.X)?ce:Object,"function"==typeof(de=void 0!==x._&&x._)?de:Object,"function"==typeof(ue=void 0!==j.H&&j.H)?ue:Object,"function"==typeof(he=void 0!==O.z&&O.z)?he:Object,"function"==typeof(ge=void 0!==B.B&&B.B)?ge:Object,"function"==typeof(pe=void 0!==$.A&&$.A)?pe:Object,"function"==typeof(me=void 0!==K.f&&K.f)?me:Object,"function"==typeof(_e=void 0!==X.W&&X.W)?_e:Object,"function"==typeof(ve=void 0!==ye.L&&ye.L)?ve:Object,Object,Object,"function"==typeof(fe=void 0!==P.t&&P.t)?fe:Object])],Ie)},77290:(e,t,i)=>{i.d(t,{h:()=>dn,Z:()=>un});var r=i(18571),n=i(54714),a=i(70327),o=i(14906),s=i(5789),l=i.n(s),c=i(23224),d=i(41790),u=i(58895),h=i(27175),g=i(22231),p=i(56185),m=i(7737),_=i(25629),v=i(92204),f=i(72322);const y=e=>h.ZP.t(e?"web_keyboard_text_show_page":"web_keyboard_text_hide_page",{},e?"Show page panel":"Hide page panel"),b=g.t.MacOS?"\u2318.":"Ctrl+.",x=g.t.MacOS?"\u2318D":"Ctrl+D",w=()=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:h.ZP.t("web_typesetting_button_copy_page",{},"Duplicate")}),(0,f.jsx)("span",{className:"collapse-short-key",children:x})]}),S=()=>(0,f.jsxs)("div",{className:"page-navigation-header-shortkey-tooltip",children:[(0,f.jsx)("span",{children:h.ZP.t("web_typesetting_button_delete_page",{},"Delete")}),g.t.MacOS?(0,f.jsx)(o.hRw,{style:{color:"var(--lvweb-new-text-tertiary-1)"},width:24,height:24},p.b.Delete):(0,f.jsx)("span",{className:"collapse-short-key",children:h.ZP.t("web_keyboard_text_Backspace_windows",{},"Backspace")})]}),P=e=>(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{children:y(e)}),(0,f.jsx)("span",{className:"collapse-short-key",children:b})]}),I=e=>{const{count:t,activePageIndex:i,onPrev:r,onNext:n}=e,a=i+1,s=a-1<0,d=a+1>t;return(0,f.jsxs)("div",{className:"page-navigation-header-btn-container",children:[(0,f.jsx)(c.Z,{content:h.ZP.t("web_typesetting_button_previous_page",{},"Previous"),children:(0,f.jsx)(o.D$t,{className:l()("page-navigation-header-rotate",{"page-navigation-header-disable":s}),size:16,onClick:r})}),(0,f.jsxs)("div",{className:"page-info",children:[(0,f.jsx)("span",{className:"page-num",children:a}),(0,f.jsx)("span",{className:"page-split",children:"/"}),(0,f.jsx)("span",{className:"page-count",children:t})]}),(0,f.jsx)(c.Z,{content:h.ZP.t("web_typesetting_button_next_page",{},"Next"),children:(0,f.jsx)(o.D$t,{className:l()({"page-navigation-header-disable":d}),size:16,onClick:n})})]})},C=e=>{const{setPopupVisible:t,onClickAdd:i,onClickCustomAdd:r,popupVisible:n,isDisableADD:a}=e;return(0,f.jsx)(d.Z,{droplist:(0,f.jsx)("div",{className:l()("page-size-attribute-contextmenu-view"),children:(0,f.jsx)(u.Z,{mode:"vertical",tooltipProps:{position:"top"},children:(0,f.jsxs)("div",{className:"contextmenu-part",children:[(0,f.jsx)(u.Z.Item,{className:"page-size-attribute-menu",disabled:!1,onClick:()=>{t(!1),i()},children:(0,f.jsx)("div",{className:"page-size-attribute-menu-item",children:(0,f.jsx)("div",{className:"attribute-menu-text",children:h.ZP.t("web_image_optimize_button_same_size",{},"Same size")})})},"SameSizeAdd"),(0,f.jsx)(u.Z.Item,{className:"page-size-attribute-menu",disabled:!1,onClick:()=>{t(!1),r()},children:(0,f.jsx)("div",{className:"page-size-attribute-menu-item",children:(0,f.jsx)("div",{className:"attribute-menu-text",children:h.ZP.t("web_image_optimize_button_custom_size",{},"Custom size")})})},"CustomSizeAdd")]})})}),trigger:"click",position:"tl",popupAlign:{top:92},popupVisible:n,onVisibleChange:t,children:(0,f.jsxs)("div",{className:l()("page-navigation-header-btn","page-navigation-header-add-page",{"page-navigation-header-disable":a,"page-size-attribute-btn-active":n}),children:[(0,f.jsx)(o.mUv,{size:20}),h.ZP.t("web_typesetting_button_add_page",{},"Add page")]})})},E=()=>(0,f.jsx)("div",{className:"page-navigation-split"}),D=e=>{const{isReadonly:t,isCollapse:i,isFocus:n,onDuplicate:a,onDelete:s,onAdd:d,onCustomSizeAdd:u,onCollapseChange:h,activePageIndex:g=0,count:y=1,onNextPage:b,onPrevPage:x,renderSDK:D}=e,A=y>=m.P,L=(0,r.useRef)(!0),[k,R]=(0,r.useState)(!1),M=(0,r.useCallback)((e=>{A||(null==a||a(e),L.current&&(null==h||h(!1)),L.current=!1)}),[A,a,h]),T=(0,r.useCallback)((e=>{y<=1||null==s||s(e)}),[y,s]);return(0,r.useEffect)((()=>_.Z.appLayer.onGlobalHotKeyEvent.event((e=>{e===p.b.ShowOrHidePagePanel?null==h||h(!i):e===p.b.DuplicatePage&&n?M(!0):e===p.b.DeletePage&&n?T(!0):e===p.b.PreviousPage&&0===D.accessors.selection.getSelectedMaterials().length?null==x||x(!0):e===p.b.NextPage&&0===D.accessors.selection.getSelectedMaterials().length&&(null==b||b(!0))}))),[i,D,n,h,M,T,b,x]),(0,f.jsxs)("div",{className:"page-navigation-header",children:[t?(0,f.jsx)("i",{}):(0,f.jsxs)("div",{className:"page-navigation-header-left-menu",children:[(0,f.jsx)(c.Z,{position:"tl",content:w(),children:(0,f.jsx)(o.Doy,{className:l()("page-navigation-header-btn",{"page-navigation-header-disable":A}),size:20,onClick:()=>M(!1)})}),(0,f.jsx)(c.Z,{content:S(),children:(0,f.jsx)(o.fjI,{className:l()("page-navigation-header-btn",{"page-navigation-header-disable":y<=1}),size:20,onClick:()=>T(!1)})}),(0,f.jsx)(E,{}),(0,f.jsx)(C,{setPopupVisible:R,onClickAdd:()=>{var e;e=g,A||(null==d||d(e,v.d.FunctionBar),L.current&&(null==h||h(!1)),L.current=!1)},onClickCustomAdd:()=>{var e;e=g,A||null==u||u(e,v.d.FunctionBar,(()=>{L.current&&(null==h||h(!1)),L.current=!1}))},popupVisible:k,isDisableADD:A})]}),(0,f.jsxs)("div",{className:"page-navigation-header-right-menu",children:[(0,f.jsx)(I,{activePageIndex:g,count:y,onNext:()=>null==b?void 0:b(!1),onPrev:()=>null==x?void 0:x(!1)}),(0,f.jsx)(E,{}),(0,f.jsx)(c.Z,{position:"tr",content:P(Boolean(i)),children:(0,f.jsx)(o.Lai,{className:l()("page-navigation-header-btn",{"page-navigation-header-rotate":i}),size:20,onClick:()=>{null==h||h(!i)}})})]})]})},A={"thumbnail-min-width":"43px",thumbnailMinWidth:"43px","thumbnail-max-width":"400px",thumbnailMaxWidth:"400px","thumbnail-height":"76px",thumbnailHeight:"76px",container:"container-D7ATjo",isCollapse:"isCollapse-X7MgaV",smooth:"smooth-NT3IqC",list:"list-SMutqA","item-container":"item-container-bYZcAp",itemContainer:"item-container-bYZcAp",preview:"preview-azWtl5",beforeItem:"beforeItem-tHFBif",add:"add-EwV6ED",beforeItemAdd:"beforeItemAdd-N9zyDA",item:"item-Sqf3Pz","item-tip":"item-tip-FSIdNK",itemTip:"item-tip-FSIdNK",thumbnail:"thumbnail-q7_ZN8",backgroundWhite:"backgroundWhite-QbYoDh",menu:"menu-QI6cfc","thumbnail-active":"thumbnail-active-cI2vam",thumbnailActive:"thumbnail-active-cI2vam","thumbnail-focus":"thumbnail-focus-WL_OS_",thumbnailFocus:"thumbnail-focus-WL_OS_","fill-with-h":"fill-with-h-ATS5u9",fillWithH:"fill-with-h-ATS5u9","fill-with-w":"fill-with-w-oeb9nv",fillWithW:"fill-with-w-oeb9nv",num:"num-ZK66w3",mark:"mark-LnWOd8",image:"image-ong71q",grid:"grid-l2BHo5"};var L,k=i(91930),R=i(62162),M=i(36580),T=i(46974),j=i(49655);!function(e){e.PagePreviewItem="PagePreviewItem",e.LayerPreviewItem="LayerPreviewItem"}(L||(L={}));var N=i(14211);var B=i(57710),Z=i(317);const O=400/76,K=e=>{const{data:t,isActive:i,isFocus:r}=e;return{className:l()(A.thumbnail,{[A["thumbnail-active"]]:i,[A["thumbnail-focus"]]:i&&r}),style:{aspectRatio:""+t.dimension.width/t.dimension.height}}},F=e=>{const{children:t}=e;return(0,f.jsx)("div",{...K(e),children:t})},G=(0,r.memo)((e=>{const{data:t,children:i}=e,{dimension:r,src:n}=t,a=r.width/r.height;return(0,f.jsxs)("div",{...K(e),children:[(0,f.jsx)("img",{className:l()(A.image,a>O?A["fill-with-w"]:A["fill-with-h"]),src:n,draggable:"false",crossOrigin:"anonymous"}),(0,f.jsx)("div",{className:l()(a>O?A["fill-with-w"]:A["fill-with-h"],n?A.grid:A.backgroundWhite)}),i]})})),U=(0,r.memo)((e=>{const{pageIndex:t=0,isReadonly:i,...r}=e;return(0,f.jsxs)(G,{...r,children:[!i&&(0,f.jsx)("div",{className:A.menu,onClick:t=>{var i;null===(i=e.contextMenuView)||void 0===i||i.show({position:{x:t.clientX,y:t.clientY},area:Z.uF.NavigatorPage,pageIds:[r.data.id]})},children:(0,f.jsx)(o.npH,{size:12})}),(0,f.jsx)("div",{className:A.num,children:t+1})]})})),H=(0,r.memo)((e=>(0,f.jsx)("div",{...K(e),children:(0,f.jsx)("div",{className:A.mark})}))),V=(0,r.memo)((e=>{const{pageIndex:t,isPreview:i,...r}=e;return i?r.data.src?(0,f.jsx)(G,{...r}):(0,f.jsx)(F,{...r}):(0,f.jsx)(U,{...r,pageIndex:t})})),z=(0,r.memo)((({onActivePage:e,data:t,isReadonly:i,pageIndex:n,isFocus:s,activePageIndex:d,someDragging:u,updateDragging:g,onAdd:p,pageCount:_,contextMenuView:y,showAddPageIndex:b,setShowAddPageIndex:x})=>{const[w,S]=(0,r.useState)(!1),P=(0,r.useRef)(null),I=(0,r.useRef)(null),C=(0,r.useRef)(null),E=(0,r.useRef)(null),{isDragging:D,drag:R,preview:M}=function(e){const{getItem:t}=e,[i,n]=(0,r.useState)(!1),[{originIsDragging:a},o,s]=(0,j.c)({type:L.PagePreviewItem,item:()=>{const e=t();return e.customDragLayerConfig&&(e.customDragLayerConfig.onDropAnimationEnd=()=>{n(!1)}),e},collect:e=>({originIsDragging:e.isDragging()})});(0,r.useEffect)((()=>{const e=t();a&&e.customDragLayerConfig&&n(!0)}),[a]);const l=(0,r.useMemo)((()=>a||i),[a,i]);return(0,r.useEffect)((()=>{t().customDragLayerConfig&&s((0,N.r)(),{captureDraggingState:!0})}),[]),{isDragging:l,drag:o,preview:s}}({getItem:()=>({id:t.id,index:n,ref:P})});(0,r.useEffect)((()=>(M(C.current),()=>{M(null)}))),(0,r.useEffect)((()=>{g(t.id,D)}),[D]),(0,r.useEffect)((()=>{u&&S(!1)}),[u]),i||R(P),(0,r.useEffect)((()=>{D&&d!==n&&(null==e||e(t.id))}),[D]);const T=(0,r.useMemo)((()=>{let e=h.ZP.t("web_graphic_multi_page_tooltip",{number0:n+1},"Page {number0}");return t.title&&(e+=` - ${t.title}`),e}),[t,n]),O=`${t.dimension.width}x${t.dimension.height}`,K=(0,k.Z)((()=>{var e;if(!I.current)return;const t=null===(e=I.current.parentElement)||void 0===e?void 0:e.parentElement;if(!t)return;const i=t.getBoundingClientRect();return{left:i.left,right:i.left+i.width}})),[,F]=(0,B.Z)((e=>{var t,i;if(!e)return;const r=null==e||null===(t=e.parentElement)||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement;if(!r)return;const n=null===(i=I.current)||void 0===i?void 0:i.getBoundingClientRect();if(!n)return;const a=K();if(!a)return;const o={x:n.x-(r.offsetWidth-n.width)/2,y:n.y-r.offsetHeight-3};o.x=Math.max(a.left,o.x),o.x=Math.min(a.right-r.offsetWidth,o.x),r.style.left=`${o.x}px`,r.style.top=`${o.y}px`}),[]),G=t.id===a.mi,U=(0,r.useCallback)(((t,i)=>{null==e||e(i),t.preventDefault(),t.stopPropagation();const{pageX:r,pageY:n}=t;null==y||y.show({position:{x:r,y:n},area:Z.uF.NavigatorPage,pageIds:[i]})}),[y]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:l()(A.beforeItem,b===n&&A.beforeItemAdd),onMouseEnter:()=>{u||_>=m.P||(E.current=setTimeout((()=>{x(n)}),100))},onMouseLeave:()=>{x(-1),_>=m.P||E.current&&clearTimeout(E.current)},"data-page-hidden":n,children:!G&&(0,f.jsx)("div",{className:l()(A.add,{[A["add-active"]]:!u}),onClick:()=>{_>=m.P||p(n-1,v.d.NavigationBar)},children:(0,f.jsx)(o.TUy,{size:13})})}),(0,f.jsx)(c.Z,{popupHoverStay:!1,popupVisible:w,style:{left:0,top:0},content:(0,f.jsxs)("div",{ref:F,className:A["item-tip"],children:[(0,f.jsx)("span",{className:"page-num",children:T}),(0,f.jsx)("span",{className:"page-size",children:O})]}),children:(0,f.jsxs)("div",{ref:I,className:l()(A["item-container"]),onContextMenu:e=>U(e,t.id),"data-page-index":G?void 0:n,children:[(0,f.jsx)("div",{ref:P,className:A.item,onMouseMove:()=>{u||w||S(!0)},onMouseLeave:()=>{S(!1)},onClick:()=>null==e?void 0:e(t.id),children:D||G?(0,f.jsx)(H,{data:t}):(0,f.jsx)(V,{data:t,isReadonly:i,pageIndex:n,isActive:n===d,isFocus:s,contextMenuView:y})}),(0,f.jsx)("div",{ref:C,className:A.preview,children:(0,f.jsx)(V,{data:t,isReadonly:i,isActive:!1,isPreview:!0})})]})})]})})),W=Object.freeze({Export:Symbol("Export"),Delete:Symbol("Delete"),Duplicate:Symbol("Duplicate"),AddPage:Symbol("AddPage"),AddPageBefore:Symbol("AddPageBefore"),AddPageAfter:Symbol("AddPageAfter"),TogglePanel:Symbol("TogglePanel"),Resize:Symbol("Resize")}),$=[[W.Duplicate,W.Delete],[W.AddPageBefore,W.AddPageAfter,W.Resize],[W.Export],[W.AddPage],[W.TogglePanel]];var Y=i(78936);const X={name:W.Delete,text:()=>h.ZP.t("web_keyboard_text_Delete",{},p.b.Delete)};var q=i(20152),J=i(35113),Q=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let ee=class extends q.L{onClick(){const e=this._editor.getContextMenuPageIds();if(!e)return;const t=this.renderSDK.accessors.page.getPageIndexesByIdList(e);this.graphicApi.page.delete(e),(0,J.c_)([],v.B$.DELETE,v.l5.RightClick,t[0],v.d.NavigationBar)}shouldHide(){const e=this._editor.getRenderSDK();return this.contextmenuArea!==Z.uF.NavigatorPage||e.getAllPages().length<=1}};ee=Q([(0,Y.Q)({contextmenu:X})],ee);const te={name:W.Export,text:()=>h.ZP.t("web_graphic_header_export_btn",{},"Export")};var ie=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let re=class extends q.L{onClick(){const e=this._editor.getContextMenuPageIds();e&&this._editor.openExportPanel(e)}shouldHide(){return this.contextmenuArea!==Z.uF.NavigatorPage||!this._editor.getDependence().getHasLogin()}};re=ie([(0,Y.Q)({contextmenu:te})],re);const ne={name:W.AddPage,text:()=>h.ZP.t("web_keyboard_text_add_page",{},"Add page")};var ae=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let oe=class extends q.L{onClick(){const e=this.renderSDK.accessors.page.getActivePage(),t=this.renderSDK.getAllPages().length;this.graphicApi.page.add(t,{dimension:{...e.dimension}}),(0,J.c_)([],v.B$.ADD,v.l5.RightClick,t,v.d.NavigationBar)}shouldHide(){const e=this.renderSDK.getAllPages().length>=m.P;return this.contextmenuArea!==Z.uF.Navigator||e}};oe=ae([(0,Y.Q)({contextmenu:ne})],oe);const se={name:W.AddPageBefore,text:()=>h.ZP.t("web_keyboard_button_add_page_before",{},"Add page before")};var le=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let ce=class extends q.L{onClick(){const e=this.renderSDK.accessors.page,t=e.getActivePage(),i=e.getActivePageIndex();this.graphicApi.page.add(i,{dimension:{...t.dimension}}),(0,J.c_)([],v.B$.ADD,v.l5.RightClick,i,v.d.NavigationBar)}shouldHide(){const e=this.renderSDK.getAllPages().length>=m.P;return this.contextmenuArea!==Z.uF.NavigatorPage||e}};ce=le([(0,Y.Q)({contextmenu:se})],ce);const de={name:W.AddPageAfter,text:()=>h.ZP.t("web_keyboard_button_add_page_after",{},"Add page after")};var ue=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let he=class extends q.L{onClick(){const e=this.renderSDK.accessors.page,t=e.getActivePage(),i=e.getActivePageIndex()+1;this.graphicApi.page.add(i,{dimension:{...t.dimension}}),(0,J.c_)([],v.B$.ADD,v.l5.RightClick,i,v.d.NavigationBar)}shouldHide(){const e=this.renderSDK.getAllPages().length>=m.P;return this.contextmenuArea!==Z.uF.NavigatorPage||e}};he=ue([(0,Y.Q)({contextmenu:de})],he);const ge={name:W.Duplicate,text:()=>h.ZP.t("web_rightclick_button_duplicate",{},"Duplicate")};var pe=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let me=class extends q.L{onClick(){const e=this.renderSDK.accessors.page.getActivePageId();this.graphicApi.page.copyPage(e);const t=this.renderSDK.accessors.page.getPageIndexesByIdList([e]);(0,J.c_)([],v.B$.DUPLICATE,v.l5.RightClick,t[0]+1,v.d.NavigationBar)}shouldHide(){const e=this.renderSDK.getAllPages().length>=m.P;return this.contextmenuArea!==Z.uF.NavigatorPage||e}};me=pe([(0,Y.Q)({contextmenu:ge})],me);const _e={name:W.TogglePanel,text:()=>h.ZP.t("web_keyboard_text_show_page",{},"Show page panel")};var ve=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let fe=class extends q.L{onClick(){this._editor.toggleCollapse()}shouldHide(){return this.contextmenuArea!==Z.uF.Navigator}getText(){return this._editor.getCollapse()?h.ZP.t("web_keyboard_text_show_page",{},"Show page panel"):h.ZP.t("web_keyboard_text_hide_page",{},"Hide page panel")}};fe=ve([(0,Y.Q)({contextmenu:_e})],fe);const ye={name:W.Resize,text:()=>h.ZP.t("web_image_optimize_button_resize_current",{},"Resize current page")};var be=i(47946),xe=i(41926),we=i(77449),Se=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o};let Pe=class extends q.L{onClick(){const e=be.Z.toolbar.getControllerInstance(xe.C.Resize,this._editor);null==e||e.showResizeDialog({onClose:()=>{}}),(0,we.n)({action:v.bU.ENTRANCE_CLICK,action_type:v.Q6.RIGHT_CLICK})}shouldHide(){return this.contextmenuArea!==Z.uF.NavigatorPage}};Pe=Se([(0,Y.Q)({contextmenu:ye})],Pe);const Ie={contextmenu:{schema:$},mount:{controllers:[ee,re,oe,ce,he,me,fe,Pe]}};var Ce=i(22898);i(3163);class Ee extends Ce.v{constructor(){super(...arguments),this._ref=(0,r.createRef)()}get ref(){return this._ref}show(e){var t;this._props={...e,editor:this._editor,contextmenuKeys:Ie.contextmenu.schema,className:l()("attribute-contextmenu-view","lv-theme-force_light"),setVisible:this.hide.bind(this),visible:!0,anchor:Z.ee.LeftBottom,followCanvas:!1},this.render((0,f.jsx)(Z.Md,{...this._props,ref:this._ref})),null===(t=this.keyEditor)||void 0===t||t.unRegister()}hide(){var e;this._props&&(this._props.pageIds=[],this.render((0,f.jsx)(Z.Md,{...this._props,visible:!1,ref:this._ref})),null===(e=this.keyEditor)||void 0===e||e.register())}}var De=i(70126);const Ae=e=>{const t=(0,r.useRef)();return(0,r.useEffect)((()=>{if(e.isReadonly)return;const i=document.querySelector(`#${a.p9}`),r=(0,De.createRoot)(i);t.current=new Ee(e,r)}),[]),t.current};var Le=i(71230),ke=i.n(Le);const Re=16,Me=(0,r.memo)((0,r.forwardRef)(((e,t)=>{const{isReadonly:i,list:n,activePageIndex:s=0,isFocus:c,onActivePage:d,onAdd:u,isCollapse:h,movePageTemporary:g,pageCount:p,movePage:m,editor:_,setShowAddPageIndex:y,showAddPageIndex:b}=e,x=p<=49&&!i,{containerItemsRef:w,containerRef:S,containerWidth:P,offset:I,updateOffset:C,updateOffsetDelta:E}=function(e){const{itemGap:t}=e,i=(0,r.useRef)(),[n,{width:a}]=(0,R.Z)(void 0,{dimension:"width"}),[o]=(0,R.Z)(void 0,{dimension:"width"}),s=(0,k.Z)((()=>o.current?o.current.offsetWidth:0)),[l,c]=(0,r.useState)(0),d=(0,k.Z)((e=>{let t=e;const i=s()-a;return t=Math.min(i||0,t),t=Math.max(t,0),t})),u=(0,k.Z)(((e,t)=>{const r=d(e);r!==l?(i.current=performance.now(),null==t||t(),c(r)):Math.abs((i.current||0)-performance.now())<500&&(null==t||t())})),h=(0,k.Z)((e=>{c((t=>d(t+e)))}));return(0,M.v)({align:"left",direction:"horizontal",isScrollable:!0,containerRef:n,currentOffset:l,onScroll:(e,t)=>{u(e,t)}}),{containerItemsRef:o,containerRef:n,containerWidth:a,updateOffset:u,updateOffsetDelta:h,offset:l}}({itemGap:Re}),D=Ae(_),[j,N]=(0,r.useState)(!1),B=(0,k.Z)((e=>{var t,i;const r=null===(t=w.current)||void 0===t?void 0:t.childNodes;if(!r||r.length<=0)return;const n=Array.from(r),o=n.filter((e=>e.id!==a.PE&&!e.classList.contains(A.beforeItem))),s=n.find((e=>e.id===a.PE)),l=o[e],c=null==l||null===(i=l.parentElement)||void 0===i?void 0:i.parentElement;if(!l||!c)return;const d=l.getBoundingClientRect(),u=c.getBoundingClientRect(),h=d.left-u.left;if(h<=0)return l.offsetLeft-Re;const g=s&&s.offsetLeft+s.offsetWidth+Re-P,p=l.offsetLeft+l.offsetWidth+Re-P;return e===o.length-1&&g?g:h+d.width+Re>=u.width?p:void 0})),Z=(0,k.Z)((()=>{var e;const t=null===(e=w.current)||void 0===e?void 0:e.childNodes;if(!t||t.length<=0)return[];return Array.from(t).filter((e=>e.id!==a.PE&&!e.classList.contains(A.beforeItem))).map((e=>{const{left:t,width:i}=e.getBoundingClientRect();return t+i/2}))})),{dragRecordRef:O}=function(e){const{containerRef:t,updateOffsetDelta:i,getItemsMiddleX:n,itemGap:a,movePageTemporary:o,movePage:s,useCustomDragLayer:l}=e,c=(0,r.useRef)({}),d=(0,k.Z)(((e,r)=>{if(!t.current)return;const n=t.current.getBoundingClientRect();return n.left+a>r?(i(-20),void(c.current.isDirectionRight=!1)):n.right-a<e?(i(20),void(c.current.isDirectionRight=!0)):void 0})),[,u]=(0,T.L)({accept:L.PagePreviewItem,drop(){c.current.initIndex=void 0;const{dragItem:e}=c.current;void 0!==e&&s([e.id],e.index)},hover(e,i){if(!t.current||!e.ref.current)return;if(c.current.isOutOfDropArea)return;const r=e.index;c.current.dragItem=e;const a=i.getInitialClientOffset(),s=i.getClientOffset();if(!s)return;if(c.current.lastClientPos){const e=s.x-c.current.lastClientPos.x;e>0?c.current.isDirectionRight=!0:e<0&&(c.current.isDirectionRight=!1)}if(c.current.lastClientPos=s,void 0===c.current.isDirectionRight)return;const l=i.getInitialSourceClientOffset();if(!a||!l)return;const u=s.x-a.x,h=e.ref.current.getBoundingClientRect(),g=l.x+h.width+u,p=l.x+u;d(g,p);const{isDirectionRight:m}=c.current,_=n();let v=m?0:_.length-1;for(let t=0;t<_.length;t++){const e=_[t];if(m)e<g&&(v=t);else if(e>p){v=t;break}}const f=r<v&&!m||r>v&&m;r===v||v<0||c.current.isOutOfDropArea||f||(o(r,v),e.index=v)}});return(0,r.useEffect)((()=>(u(l?document.body:t),()=>{u(null)})),[]),{dragRecordRef:c}}({itemGap:Re,containerItemsRef:w,containerRef:S,updateOffsetDelta:E,getItemsMiddleX:Z,movePageTemporary:g,movePage:m}),K=(0,k.Z)((()=>{var e;const{dragItem:t}=O.current;if(!t)return null;const i=null===(e=w.current)||void 0===e?void 0:e.childNodes;let r=Array.from(i);r=r.filter((e=>!e.classList.contains(A.beforeItem)));const n=r[t.index];if(!n)return null;const a=n.getBoundingClientRect();return a?{x:a.x,y:a.y}:null})),[F,G]=(0,r.useState)({}),U=Object.keys(F).some((e=>F[e])),H=(0,k.Z)(((e,t)=>{t&&(O.current.initIndex=n.findIndex((t=>t.id===e))),G((i=>{const r={...i};return r[e]=t,r}))})),V=(0,k.Z)(((e,t)=>{const i=S.current.getBoundingClientRect();return 0===e&&0===t||i.y>=t||i.x+2>=e}));(0,r.useEffect)((()=>{const e=B(s);P&&(C(null!=e?e:I),N(!0))}),[s,P,n.length]),(0,r.useEffect)((()=>{S.current&&(S.current.scrollLeft=I)}),[I]),(0,r.useEffect)((()=>{if(!S.current)return;const e=ke()((()=>{N(!1)}),500);S.current.addEventListener("scroll",e)}),[S]);return(0,r.useImperativeHandle)(t,(()=>({getListDom(){var e;return null===(e=w.current)||void 0===e?void 0:e.querySelectorAll("[data-page-index]")},getAddDom(){var e;return null===(e=w.current)||void 0===e?void 0:e.querySelector(`#${a.PE}`)}}))),(0,f.jsx)("div",{className:l()(A.container,h?A.isCollapse:null,j&&A.smooth),id:a.w4,ref:S,onDragLeave:e=>{const{dragItem:t,initIndex:i}=O.current,{clientX:r,clientY:n}=e;void 0!==t&&void 0!==i&&V(r,n)&&(O.current.isOutOfDropArea=!0,g(t.index,i),t.index=i)},onDragEnter:()=>{O.current.isOutOfDropArea=!1},children:(0,f.jsxs)("div",{ref:w,className:A.list,children:[n.map(((e,t)=>(0,f.jsx)(z,{data:e,isReadonly:i,pageIndex:t,onActivePage:d,isFocus:c,activePageIndex:s,someDragging:U,updateDragging:H,getDropPos:K,contextMenuView:D,onAdd:u,pageCount:n.length,showAddPageIndex:b,setShowAddPageIndex:y},e.id))),x?(0,f.jsx)("div",{id:a.PE,className:l()(A.add,{[A["add-active"]]:!U}),onClick:()=>{var e;(e=p-1)>=49||u(e,v.d.NavigationBar)},children:(0,f.jsx)(o.TUy,{size:24})}):null]})})})));var Te=i(84020),je=i(32709),Ne=i(8757),Be=i(43382),Ze=i(54643),Oe=i(48607),Ke=i(28683);const Fe="400px",Ge="76px",Ue=parseFloat("43px"),He=parseFloat(Fe),Ve=parseFloat(Ge),ze=e=>{var t,i;const{listRef:r,command:n,renderSDK:a,navigationDataList:o,setNavigationDataList:s,revalidateThumbnailList:l,showAddPageIndex:c,setShowAddPageIndex:d}=e,u=He/Ve,h=Ue/Ve,g=null===(t=r.current)||void 0===t?void 0:t.getListDom(),p=null===(i=r.current)||void 0===i?void 0:i.getAddDom();if(!g)return;const m=(e,t)=>{g.forEach(((i,r)=>{r>e&&Object.assign(i.style,t)})),p&&Object.assign(p.style,t)},_=200;n.actionType===Ne.Us.AddPageAction&&n.mutations.forEach((e=>{if(e.type===Ne.x1.ADD_PAGE){const{pageId:t}=e.getMutationSideEffect(),i=c>-1,r=a.accessors.page.getPageIndexesByIdList([t])[0];if(r<0)return;const n=(0,Ze.Ln)(a.accessors.page.getDimensionById(t)),g=Math.max(h,Math.min(u,n.width/n.height)),p=Ve*g,v=[...o];return v.splice(r,0,{title:"",id:t,src:"",dimension:n}),s(v),m(i?r-1:r,{willChange:"transform",transform:`translate3D(${-p}px, 0, 0)`,transition:""}),requestAnimationFrame((()=>{i&&d(c),m(i?r-1:r,{transform:"translate3D(0, 0, 0)",transition:"all 0.2s ease-out"}),setTimeout((()=>{l([t])}),_)})),!0}})),n.actionType===Ne.Us.RemovePageAction&&n.mutations.forEach((e=>{if(e.type===Ne.x1.REMOVE_PAGE){const{pageId:t}=e.getMutationSideEffect(),i=o.findIndex((e=>e.id===t));if(i<0)return;const r=(0,Ze.Ln)(o[i].dimension),n=Math.max(h,Math.min(u,r.width/r.height)),a=Ve*n,c=[...o];return c.splice(i,1),Object.assign(g[i].style,{display:"none"}),m(i,{willChange:"transform",transform:`translate3D(${a}px, 0, 0)`,transition:""}),s(c),requestAnimationFrame((()=>{m(i,{transform:"translate3D(0, 0, 0)",transition:"all 0.2s ease-out"}),setTimeout((()=>{l([])}),_)})),!0}}))};var We=i(37918),$e=i(61269),Ye=i(36702),Xe=i(24451),qe=i(44029),Je=i(95411),Qe=i(10078),et=i(41308),tt=i(93947),it=i(81907),rt=i(72135);const nt=new Je.Z,at=$e.default.Item,ot="lv-new-image-draft-setting",st=5e3,lt=Number((0,Ze.$S)(60).toFixed(3)),ct=Number((0,Ze.$S)(st).toFixed(3)),dt=e=>{const{onSubmit:t,onCancel:i,fixedUnit:n}=e;let a,o;n===Ne.fb.PX?(a=1080,o=1080):(a=28.575,o=28.575);const[s,d]=(0,r.useState)(e),[u,g]=(0,r.useState)(!0),[p,m]=(0,r.useState)(!0),[_]=$e.default.useForm(),v={width:a,height:o,unit:n},y=(0,r.useRef)(a),b=(0,r.useRef)(o),x=(0,r.useRef)(n===Ne.fb.PX?60:lt),w=(0,r.useRef)(n===Ne.fb.PX?st:ct),S=(0,r.useRef)(null),[P,I]=(0,r.useState)(v),[C,E]=(0,r.useState)(!1),[D,A,L]=(0,Qe.Z)(!1),[k,R]=(0,r.useState)(null);(0,r.useEffect)((()=>{const e=e=>{d(e),g(!0)};return nt.on("update",e),()=>{nt.off("update",e)}}),[]);const M=()=>{_.resetFields(),I(v),m(!0),R(""),y.current=a,b.current=o,E(!1),A(!1)},T=e=>{if(!Number.isNaN(e))return e},j=(e,t)=>{let i="60px",r="5000px";_.getFieldValue("unit")===Ne.fb.CM&&(i=`${lt}cm`,r=`${ct}cm`);const n=h.oc.t("web_graphic_canvas_size_limit_err",{placeholder0:i,placeholder1:r},"Dimensions must be at least {placeholder0} and no more than {placeholder1}");return void 0!==e&&(e<x.current||e>w.current)&&t(n),t()};(0,r.useEffect)((()=>{void 0!==P.width&&void 0!==P.height?E(!1):E(!0)}),[P]);const N=e=>{e.target.select()},B=e=>e===Ne.fb.CM?3:0;return(0,f.jsxs)(Ye.Z,{className:`${ot}-modal`,title:h.oc.t("web_toolsIntergration_custom_size",{},"Custom size"),style:{width:"480px",height:"244px"},closable:!1,footer:(0,f.jsxs)("div",{children:[(0,f.jsx)(Xe.Z,{type:"default",onClick:()=>{g(!1),M(),null==i||i()},children:h.oc.t("web_graphic_customize_canvas_cancel",{},"Cancel")}),(0,f.jsx)(Xe.Z,{type:"primary",onClick:()=>{g(!1),M(),null==t||t({...P,scenario:"custom",scale:`${P.width}*${P.height}${P.unit}`})},disabled:!p,style:{marginLeft:"12px"},children:h.oc.t("web_graphic_customize_canvas_create",{},"Create")})]}),visible:u,children:[(0,f.jsxs)($e.default,{form:_,layout:"vertical",className:`${ot}-content`,style:{display:"flex",flexDirection:"row",margin:"16px 0"},initialValues:v,autoComplete:"off",onChange:(e,t)=>{let i=(e=>{const t={...e};if(t.unit!==P.unit){let i,r;t.unit===Ne.fb.PX?(i=(0,Ze.BE)(y.current),r=(0,Ze.BE)(b.current),x.current=60,w.current=st):(i=(0,Ze.$S)(y.current),r=(0,Ze.$S)(b.current),x.current=lt,w.current=ct),t.width=T(Number(i.toFixed(B(e.unit)))),t.height=T(Number(r.toFixed(B(e.unit)))),y.current=i,b.current=r}else y.current=e.width,b.current=e.height;return t})(t);i=(e=>{const t=L();return["width","height"].forEach((i=>{if((!e[i]||e[i]!==P[i])&&void 0!==e[i]&&(e[i]=Number(e[i].toFixed(B(e.unit))),t&&S.current))if("width"===i){const t=e[i]/S.current;e.height=T(Number(t.toFixed(B(e.unit)))),b.current=t}else{const t=e[i]*S.current;e.width=T(Number(t.toFixed(B(e.unit)))),y.current=t}})),e})(i),I(i),_.setFieldsValue(i),(async()=>{try{await _.validate(),m(!0),R("")}catch(e){const{errors:t}=e;t&&Object.values(t).forEach((e=>{e.requiredError||R(e.message)})),m(!1)}})()},children:[(0,f.jsx)(at,{label:h.oc.t("web_graphic_customize_canvas_width",{},"width"),field:"width",className:`${ot}-item`,rules:[{required:!0},{validator:j}],children:(0,f.jsx)(qe.Z,{onFocus:N})}),(0,f.jsx)(c.Z,{className:`${ot}-tooltip`,content:h.oc.t("web_graphic_lock_aspect_ratio",{},"lock aspect ratio"),children:(0,f.jsx)("div",{className:`${ot}-icon-wrapper`,children:D?(0,f.jsx)(et.vdo,{size:"16",className:`${ot}-icon-lock`,onClick:()=>{A(!1),S.current=null}}):(0,f.jsx)(et.NN2,{size:"16",className:l()(`${ot}-icon-unlock`,{disabled:C}),onClick:()=>{C||(A(!0),S.current=y.current/b.current)}})})}),(0,f.jsx)(at,{label:h.oc.t("web_graphic_customize_canvas_height",{},"height"),field:"height",className:`${ot}-item ${ot}-width-item`,rules:[{required:!0},{validator:j}],children:(0,f.jsx)(qe.Z,{onFocus:N})}),(0,f.jsx)("div",{className:`${ot}-fixedUnit ${ot}-unit-item`,children:n})]}),(0,f.jsx)(c.Z,{content:k,checkOverflow:!0,children:(0,f.jsx)("div",{className:`${ot}-err-msg`,children:k})})]})},ut=(e,t,i,r,n)=>{e.getPageManager().addPage(t,{width:n.width,height:n.height,unit:n.unit}),(0,tt.r2)(tt.Dl.CREATE,n.scenario,n.scale),r()},ht=(e,t,i,r,n,a,o)=>{e.getRenderSDK().getActivePage().getAttrs().dimension.unit===Ne.fb.PX?((e,t,i,r,n,a,o)=>{it.h.show({isLogin:a,draftWorkspaceInfo:o,onClose:()=>{},onConfirm:i=>{ut(e,t,0,r,i)},onUploaded:r,onStatusChange:(e,t)=>{"upload"===e?(0,rt.y)({...null!=t?t:{},action:"click",position:"picture_edit_addpage",scenario:"upload_image",scale:"upload_image"}):(0,rt.y)({...null!=t?t:{},action:e,position:"picture_edit_addpage"})},projectMaterialManager:n,renderSDK:e.getRenderSDK(),graphicSDK:e.getGraphicSDK(),isCreateNewPage:!0})})(e,t,0,r,n,a,o):((e,t,i,r)=>{const n=document.createElement("div");document.body.append(n),De.createRoot(n).render((0,f.jsx)(dt,{onSubmit:i=>{ut(e,t,0,r,i)},fixedUnit:Ne.fb.CM}))})(e,t,0,r)};var gt;!function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.None=2]="None"}(gt||(gt={}));const pt=(0,r.forwardRef)(((e,t)=>{const{getPageThumbnailCover:i,editor:n,draftPermission:o,templateList:s,projectMaterialManager:c,isLogin:d,draftWorkspaceInfo:u}=e,h=n.getGraphicSDK(),g=n.getRenderSDK(),p=(0,r.useRef)(null),[m,y]=(0,r.useState)(!0),[b,x]=(0,r.useState)([]),[w,S]=(0,r.useState)(-1),[P,I]=(0,r.useState)(-1),[C,E]=(0,r.useState)(!0),A=(0,r.useRef)(null),L=o===Ke.O.readonly,k=Ae(n),R=(0,r.useCallback)(((e,t)=>{x((i=>{const r=i.findIndex((t=>t.id===e)),n=i[r];return n.src===t?i:[...i.slice(0,r),{...n,src:t},...i.slice(r+1)]}))}),[]),M=(0,r.useCallback)((e=>{const t=h.document.pages;x((e=>{const i=t=>{var i;const r=e.find((e=>e.id===t));return null!==(i=null==r?void 0:r.src)&&void 0!==i?i:""},r=t.map((e=>{var t;return{src:i(e.id),dimension:e.dimension,title:null!==(t=e.title)&&void 0!==t?t:"",id:e.id}}));return r})),e.forEach(((t,r)=>{const n=e[r];i([n]).then((([e])=>{h.document.pages.find((e=>e.id===n))&&R(n,e)}))}))}),[i]),[T,j]=(e=>{const{editor:t,listRef:i,navigationDataList:n,setNavigationDataList:a,revalidateThumbnailList:o,templateList:s,activePageIndex:l,setActivePageIndex:c,setShowAddPageIndex:d,showAddPageIndex:u}=e,h=t.getGraphicSDK(),g=t.getRenderSDK(),[p,m]=(0,r.useState)(t.getRenderSDK().getAllPages().length),_=(0,r.useCallback)((e=>{if(m(g.getAllPages().length),[Ne.Us.AddPageAction,Ne.Us.RemovePageAction].includes(e.actionType)&&e.commandType!==Ne.wI.UNDO&&e.commandType!==Ne.wI.REDO)return void ze({renderSDK:g,listRef:i,navigationDataList:n,setNavigationDataList:a,revalidateThumbnailList:o,command:e,setShowAddPageIndex:d,showAddPageIndex:u});const t=e.mutations.map((e=>{const{pageId:t}=e.getMutationSideEffect();return t})).filter((e=>h.document.pages.find((t=>t.id===e))));if(e.actionType!==Ne.Us.ApplyTemplateAction)return o(t);const r=e.mutations.find((e=>e.type===Ne.x1.ADD_LAYER));if(!r)return o(t);const{templateId:c}=r.getMutationSideEffect(),p=s[c];if(!p)return o(t);const _=[...n];_[l]={..._[l],src:p},a(_)}),[o,n,l,m,u]);return(0,r.useEffect)((()=>{const e=new Be.S;return h.event.addListener(Te.B.AFTER_MUTATION_RUN,_),e.add((()=>h.event.removeListener(Te.B.AFTER_MUTATION_RUN,_))),e.add(g.onActivePageSwitched((()=>{c(g.getActivePageIndex()),m(g.getAllPages().length)}))),e.add(g.onPagePositionUpdated((()=>{c(g.getActivePageIndex())}))),()=>{e.clear()}}),[h,o,g,_]),[p,m]})({editor:n,navigationDataList:b,setNavigationDataList:x,activePageIndex:w,setActivePageIndex:S,templateList:s,listRef:A,revalidateThumbnailList:M,setShowAddPageIndex:I,showAddPageIndex:P});(0,r.useEffect)((()=>{n.setCollapse(m),n.setCollapseCallback(y)}),[m,y]),(0,je.Z)((()=>{const e=n.getDependence().getLastPageId();if(!e)return;const[t]=g.accessors.page.getPageIndexesByIdList([e]);S(t>=0?t:0),E(!0)})),(0,r.useEffect)((()=>{M(g.getAllPages().map((e=>e.id)))}),[M]),(0,r.useEffect)((()=>{const e=g.getAllPages();y(e.length<=1)}),[]),(0,r.useEffect)((()=>{j(g.getAllPages().length)}),[]),(0,r.useImperativeHandle)(t,(()=>({showPlaceholderWhenDrag(e){const t=b.findIndex((e=>e.id===a.mi));t>=0&&(b.splice(t,1),x([...b])),e<0||x((t=>{const i=t.slice(0,e),r=t.slice(e,t.length),n=g.accessors.page.getDimensionById(g.getActivePageId());return[...i,{dimension:(0,Ze.Ln)(n),id:a.mi,title:""},...r]}))}})),[b]);const N=(0,r.useCallback)(((e,t)=>{(0,J.c_)([],v.B$.ADD,v.l5.Click,e+1,t),(0,J.c_)([],v.B$.ADD_SAME_SIZE,v.l5.Click,e+1,t),n.getPageManager().addPage(e)}),[n]),B=(0,r.useCallback)(((e,t,i)=>{(0,J.c_)([],v.B$.ADD,v.l5.Click,e+1,t),(0,J.c_)([],v.B$.ADD_CUSTOM_SIZE,v.l5.Click,e+1,t),ht(n,e,0,i,c,d,u)}),[n]),O=(0,r.useCallback)((e=>{E(!0),n.getPageManager().switchPage(e)}),[n]);(0,r.useEffect)((()=>_.Z.interact.onMaterialSelect.event((e=>{(Boolean(e.e)||e.selectedList.length>0)&&E(!1)}))),[]),(0,r.useEffect)((()=>g.pageManager.onActivePageSwitched((function({to:e}){g.accessors.selection.hover(e)}))),[g]);const K=(0,r.useCallback)(((e,t)=>{e.forEach((e=>{(0,J.c_)([],v.B$.CHANGE_RANK,v.l5.Click,g.accessors.page.getPageIndexesByIdList([e])[0],v.d.NavigationBar)})),n.getPageManager().movePage(e,t)}),[n]),F=(0,r.useCallback)(((e,t)=>{const{length:i}=b;e===t||e<0||e>=i||t<0||t>=i||x((i=>{const r=[...i],n=r[e];return r.splice(e,1),S(t),[...r.slice(0,t),n,...r.slice(t)]}))}),[b,x]);return(0,r.useEffect)((()=>{var e;const t=e=>e.preventDefault();return null===(e=p.current)||void 0===e||e.addEventListener("wheel",t,{passive:!1}),()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.removeEventListener("wheel",t)}}),[]),(0,We.V)(p,(()=>{window.innerHeight<=500&&y(!0)})),(0,r.useEffect)((()=>{if(!p.current)return;const e=document.getElementById(dn);if(!e)return;let t=e.getBoundingClientRect().height;const i=new ResizeObserver((()=>{const i=e.getBoundingClientRect();i.height<t&&i.height<=500&&y(!0),t=i.height}));return i.observe(e),()=>{i.disconnect()}}),[p]),(0,f.jsxs)("div",{className:l()("page-navigation"),id:a.Iv,style:{zIndex:String(Oe.mg)},onContextMenu:e=>{if(L)return;e.preventDefault();const{clientX:t,clientY:i}=e;null==k||k.show({position:{x:t,y:i},area:Z.uF.Navigator})},ref:p,children:[(0,f.jsx)(D,{isReadonly:L,isCollapse:m,onCollapseChange:y,onAdd:N,onCustomSizeAdd:B,onDelete:e=>{(0,J.c_)([],v.B$.DELETE,e?v.l5.ShortKey:v.l5.Click,g.getActivePageIndex(),v.d.FunctionBar),n.getPageManager().delPage()},onDuplicate:e=>{(0,J.c_)([],v.B$.DUPLICATE,e?v.l5.ShortKey:v.l5.Click,g.getActivePageIndex(),v.d.FunctionBar),n.getPageManager().copyPage()},onNextPage:e=>{(0,J.c_)([],v.B$.NEXT,e?v.l5.ShortKey:v.l5.Click,g.getActivePageIndex(),v.d.FunctionBar),n.getPageManager().nextPage()},onPrevPage:e=>{(0,J.c_)([],v.B$.PREVIOUS,e?v.l5.ShortKey:v.l5.Click,g.getActivePageIndex(),v.d.FunctionBar),n.getPageManager().prePage()},isFocus:C,count:T,activePageIndex:w,renderSDK:g}),(0,f.jsx)(Me,{isReadonly:L,activePageIndex:w,onActivePage:O,onAdd:N,isFocus:C,isCollapse:m,movePageTemporary:F,list:b,pageCount:T,movePage:K,editor:n,ref:A,showAddPageIndex:P,setShowAddPageIndex:I})]})}));function mt(e){const{editor:t}=e,i=t.getGraphicSDK(),n=t.getRenderSDK(),[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),c=(0,r.useCallback)((e=>{var t;const{id:i,type:r,isLocked:n}=e,o=a.find((e=>e.id===i));return{id:i,src:null==o?void 0:o.src,isLocked:n,type:r,isDirty:null===(t=null==o?void 0:o.isDirty)||void 0===t||t}}),[n,a]),d=(0,r.useCallback)(((e=[])=>{const t=n.getActivePageId(),r=i.api.document.getLayersByFilter(!1,((e,i)=>i.id===t)).reverse(),a=i.document.getPageById(t),s=(a?[...r,a]:r).map(c).map((t=>e.includes(t.id)?{...t,isDirty:!0}:t));o(s)}),[n,a]),u=(0,r.useCallback)((async(e,t)=>{const i=await(t===Ne.F5.PAGE?n.accessors.stage.exportPageBgImage(e):n.accessors.stage.exportLayerImage(e));o((t=>{const r=[...t],n=r.find((t=>t.id===e));return n?(n.src=i,n.isDirty=!1,r):t}))}),[n]);(0,je.Z)((()=>{d()}));const h=e=>{const t=e.mutations.filter((e=>e.type===Ne.x1.UPDATE_LAYER)).map((e=>e.getMutationSideEffect().layerId)),r=t.map((e=>{var t;return null!==(t=(e=>{const t=i.document.getPageByChildLayerId(e);if(!t)return;const r=t.getLayerAccessRoad(e);return r.length>2?r[r.length-2]:void 0})(e))&&void 0!==t?t:e}));l(r);const n=e.mutations.filter((e=>e.type===Ne.x1.UPDATE_PAGE)).map((e=>e.getMutationSideEffect().pageId));d([...r,...n])},g=()=>{d()};(0,r.useEffect)((()=>{const e=new Be.S;return i.event.addListener(Te.B.AFTER_MUTATION_RUN,h),e.add((()=>i.event.removeListener(Te.B.AFTER_MUTATION_RUN,h))),e.add(n.onActivePageSwitched(g)),()=>{e.clear()}}),[i,n,h]);const p=(0,r.useCallback)(((e,t)=>{t?n.accessors.selection.hover(e):n.accessors.selection.unHover(e)}),[n]),m=(e,t,i,r)=>{const n=t.sort(((t,i)=>e.findIndex((e=>e===t))-e.findIndex((e=>e===i))));if(!n.includes(i))return;const a=e.findIndex((e=>e===r)),o=e.findIndex((e=>e===i));if(-1===a||-1===o)return;const s=n.map((t=>e.findIndex((e=>e===t))));return{firstSelectLayerIndex:s[0],lastSelectLayerIndex:s[s.length-1],hoverLayerIndex:a,dragLayerIndex:o,sortedSelectLayerIndexList:s}},_=(0,r.useCallback)(((e,t,i,r)=>{o((n=>{const a=m(n.map((e=>e.id)),e,t,i);if(!a)return r(!1),n;const{firstSelectLayerIndex:o,lastSelectLayerIndex:s,hoverLayerIndex:l,dragLayerIndex:c,sortedSelectLayerIndexList:d}=a,u=()=>{const e=d.map((e=>n[e])),t=n.filter((t=>!e.includes(t))),a=t.findIndex((e=>e.id===i));return r(!0),[...t.slice(0,a),...e,...t.slice(a)]},h=()=>{const e=d.map((e=>n[e])),t=n.filter((t=>!e.includes(t))),a=t.findIndex((e=>e.id===i))+1;return r(!0),[...t.slice(0,a),...e,...t.slice(a)]};if(l<o)return u();if(l>s)return h();if(d.includes(l)){if(d.length-1==s-o)return r(!1),n;let e=l;for(;d.includes(e);)e++;const t=n[e].id,i=d.map((e=>n[e])),a=n.filter((e=>!i.includes(e))),c=a.findIndex((e=>e.id===t));return r(!0),[...a.slice(0,c),...i,...a.slice(c)]}return c>l?u():c<l?h():(r(!1),n)}))}),[o]),v=(0,r.useCallback)(((e,t,r,n)=>{const a=i.document.getPageByChildLayerId(t);if(!a)return;const o=i.document.getLayerIdsByFilter(!1,((e,t)=>t.id===a.id)).reverse(),s=m(o,e,t,r);if(!s)return;const{firstSelectLayerIndex:l,lastSelectLayerIndex:c,hoverLayerIndex:d,sortedSelectLayerIndexList:u}=s,h=i.api,g=(e,t,i,r)=>{if(h.transaction.begin(),-1!==t){let i=t;e.reverse().forEach((e=>{let t=i-o.findIndex((t=>e===t));for(;t--;)h.common.updatePosition(Ne.l7.SEND_BACKWARD,e);i--}))}if(-1!==r){let e=r;i.forEach((t=>{let i=o.findIndex((e=>t===e))-e;for(;i--;)h.common.updatePosition(Ne.l7.BRING_FORWARD,t);e++}))}h.transaction.commit()},p=u.filter((e=>e<d)).map((e=>o[e])),_=u.filter((e=>e>d)).map((e=>o[e]));if(d<l){g([],-1,_,"top"===n?d:d+1)}else if(d>c){g(p,"bottom"===n?d:d-1,[],-1)}else u.includes(d)?g(p,d-1,_,d+1):"top"!==n?"bottom"!==n||g(p,d,_,d+1):g(p,d-1,_,d)}),[i]);return{dirtyLayerIds:s,layerDataList:a,updateLayerDataSrc:u,setLayerDataList:o,setLayerHover:p,moveLayersTemporary:_,moveLayers:v}}const _t={"navigator-bar-size":"56px",navigatorBarSize:"56px","tab-header-size":"76px",tabHeaderSize:"76px","attribute-view-width":"56px",attributeViewWidth:"56px","attribute-view-top-position":"8px",attributeViewTopPosition:"8px","attribute-view-right-position":"8px",attributeViewRightPosition:"8px","attribute-panel-width":"268px",attributePanelWidth:"268px","attribute-panel-header-height":"48px",attributePanelHeaderHeight:"48px","attribute-panel-horizontal-padding":"16px",attributePanelHorizontalPadding:"16px","attribute-panel-vertical-margin":"16px",attributePanelVerticalMargin:"16px","attribute-contextmenu-width":"260px",attributeContextmenuWidth:"260px","attribute-contextmenu-item-height":"36px",attributeContextmenuItemHeight:"36px","attribute-contextmenu-padding":"8px",attributeContextmenuPadding:"8px","attribute-contextmenu-border":"1px",attributeContextmenuBorder:"1px","attribute-sub-contextmenu-width":"279px",attributeSubContextmenuWidth:"279px","page-layers-width":"98px",pageLayersWidth:"98px",layers:"layers-OvUpcp","layers-open":"layers-open-aJecpG",layersOpen:"layers-open-aJecpG",title:"title-g6gKoi",list:"list-Y8cMPd","item-container":"item-container-krh8jQ",itemContainer:"item-container-krh8jQ","drag-bar":"drag-bar-Ca3Omz",dragBar:"drag-bar-Ca3Omz",hide:"hide-GwcsKX",mark:"mark-Exop4S","mark-active":"mark-active-_ieia5",markActive:"mark-active-_ieia5",item:"item-qDHlSK","item-container-dragging":"item-container-dragging-PWQQ6C",itemContainerDragging:"item-container-dragging-PWQQ6C","item-active":"item-active-Gynyd0",itemActive:"item-active-Gynyd0","item-preview":"item-preview-PzWyFP",itemPreview:"item-preview-PzWyFP","item-preview-multi-transition":"item-preview-multi-transition-UnnBD0",itemPreviewMultiTransition:"item-preview-multi-transition-UnnBD0","item-preview-multi":"item-preview-multi-fEEgAq",itemPreviewMulti:"item-preview-multi-fEEgAq","item-follow":"item-follow-ClaLmv",itemFollow:"item-follow-ClaLmv","item-preview-transition":"item-preview-transition-Z8sIND",itemPreviewTransition:"item-preview-transition-Z8sIND","item-follow-transition":"item-follow-transition-wdYV6O",itemFollowTransition:"item-follow-transition-wdYV6O"};var vt=i(46473),ft=i(14667);const yt=r.createContext({selectItemMap:{}}),bt=r.createContext({});function xt(e){const{ref:t,canDrag:i,id:n}=e,a=(0,r.useRef)(),o=(0,r.useRef)(),s=(0,r.useRef)(!1),{isDragging:l,handleDrag:c,endDrag:d}=function(e){const{id:t,dragRef:i}=e,[n,a]=(0,r.useState)(!1),o=(0,r.useRef)(),s=(0,r.useRef)({}),l=(0,r.useContext)(yt),c=(0,r.useCallback)(((e,t)=>{n||a(!0);const i=o.current;if(!i)return;const{element:r}=i;r.style.transform=`translate3d(${e}px, ${t}px, 0)`;const l=s.current;Object.keys(l).forEach((e=>{const t=l[e],{originRect:i,element:n}=t,a=r.getBoundingClientRect(),o=a.x-i.left,s=a.y-i.top;n.style.transform=`translate3d(${o}px, ${s}px, 0)`}))}),[n]);return(0,r.useEffect)((()=>{var e;if(!n)return null===(e=o.current)||void 0===e||e.element.remove(),o.current=void 0,Object.keys(s.current).forEach((e=>{s.current[e].element.remove(),l.selectItemMap[e].element.classList.remove(_t.hide)})),void(s.current={});const r=i.current;if(r){var a;const e=r.cloneNode(!0),i=null!==(a=r.getBoundingClientRect())&&void 0!==a?a:{};o.current={element:e,originRect:i},l.dragItem={id:t,element:e},o.current.element.classList.add(_t["item-preview"],_t["item-preview-multi-transition"]),o.current.element.style.top=`${i.y}px`,o.current.element.style.left=`${i.x}px`,document.body.appendChild(o.current.element);const n=Object.keys(l.selectItemMap).map((e=>l.selectItemMap[e]));if(!n.find((e=>e.id===t)))return;const c=n.filter((e=>e.id!==t)).map((e=>{var t;const i=e.element.cloneNode(!0);i.classList.add(_t["item-preview"],_t["item-follow"],_t["item-follow-transition"]);const r=null!==(t=e.element.getBoundingClientRect())&&void 0!==t?t:{};return i.style.top=`${r.y}px`,i.style.left=`${r.x}px`,e.element.classList.add(_t.hide),s.current[e.id]={element:i,originRect:r},new Promise((e=>i.ontransitionend=()=>{e(),i.classList.remove(_t["item-follow-transition"])}))}));if(c.length<=0)return;Promise.all(c).then((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.element.classList.add(_t["item-preview-multi"])}));const d=Object.keys(s.current).map((e=>s.current[e]));if(d.length>0){const e=document.createDocumentFragment();e.append(...d.map((e=>e.element))),document.body.append(e)}}}),[n]),{isDragging:n,handleDrag:c,endDrag:()=>{var e,t;const r=o.current,n=null===(e=l.dropRef)||void 0===e?void 0:e.current;if(!r||!n)return;const{element:c,originRect:d}=r,u=null===(t=i.current)||void 0===t?void 0:t.getBoundingClientRect(),h=c.style.transform;c.classList.add(_t["item-preview-transition"]),c.classList.remove(_t["item-preview-multi-transition"],_t["item-preview-multi"]),c.style.transform=u&&d?`translate3d(0, ${u.y-d.y}px, 0)`:"";const g=()=>{a(!1)};h===c.style.transform?g():(c.ontransitioncancel=e=>{"transform"===e.propertyName&&g()},c.ontransitionend=e=>{"transform"===e.propertyName&&g()});const p=s.current;Object.keys(p).forEach((e=>{var t;const i=p[e],r=l.selectItemMap[e],{element:n,originRect:a}=i;n.classList.add(_t["item-preview-transition"]);const o=null==r||null===(t=r.element)||void 0===t?void 0:t.getBoundingClientRect();n.style.transform=o&&a?`translate3d(0, ${o.y-a.y}px, 0)`:""}))}}}({id:n,dragRef:t}),u=(0,r.useCallback)((e=>{if(!s.current)return;const i={x:e.clientX,y:e.clientY};o.current=i;const r=t.current,n=a.current,d=o.current;if(!r||!n||!d)return;const u=d.x-n.x,h=d.y-n.y;!l&&Math.abs(u)<10&&Math.abs(h)<10||c(u,h)}),[l]),h=(0,r.useCallback)((()=>{s.current=!1,d()}),[]),g=(0,r.useCallback)((e=>{const r={x:e.clientX,y:e.clientY};(e=>{var i;const r=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();if(!r)return!1;const{left:n,right:a,top:o,bottom:s}=r;return e.x>=n&&e.y>=o&&e.x<=a&&e.y<=s})(r)&&null!=i&&i()&&(a.current=r,s.current=!0)}),[i]);return(0,r.useEffect)((()=>{var e;return null===(e=t.current)||void 0===e||e.addEventListener("mousedown",g),()=>{var e;null===(e=t.current)||void 0===e||e.removeEventListener("mousedown",g)}}),[g]),(0,r.useEffect)((()=>(window.addEventListener("mouseup",h),()=>{window.removeEventListener("mouseup",h)})),[h]),(0,r.useEffect)((()=>(window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)})),[u]),{isDragging:l}}const wt=e=>{const{type:t,isLocked:i}=e;return t===Ne.F5.PAGE||i},St=({data:e,updateSrc:t,setLayerHover:i,isSelected:n,className:a,onContextMenu:s,onClick:d,onDraggingChange:u,hideMarkIcon:g})=>{const{id:p,src:m,isLocked:_,type:v,isDirty:y}=e,[b,x]=(0,ft.Z)(),w=(0,r.useContext)(yt),S=(0,r.useContext)(bt),{disableFeatures:P}=S,I=(0,r.useCallback)((()=>!(wt(e)||null!=P&&P.includes(Dt.draggable))),[e,P]),C=v===Ne.F5.PAGE,E=v===Ne.F5.GROUP_LAYER,{isDragging:D}=xt({ref:b,canDrag:I,id:p});(0,r.useEffect)((()=>{null==u||u(D)}),[D]),(0,r.useEffect)((()=>{n?w.selectItemMap[p]={id:p,element:b.current}:delete w.selectItemMap[p]}),[n]),(0,r.useEffect)((()=>{x&&y&&t(e.id,e.type)}),[x,y]);const A=(0,r.useMemo)((()=>g?null:_?(0,f.jsx)("div",{className:"mark-btn",children:(0,f.jsx)(c.Z,{content:h.ZP.t("web_layer_hover_lock_layer",{},"Lock"),children:(0,f.jsx)(o.zzm,{size:16})})}):E?(0,f.jsx)("div",{className:"mark-btn",children:(0,f.jsx)(c.Z,{content:h.ZP.t("web_layer_hover_group",{},"Group"),children:(0,f.jsx)(o.Ass,{size:16})})}):C?(0,f.jsx)("div",{className:"mark-btn",children:(0,f.jsx)(c.Z,{content:h.ZP.t("web_layer_hover_background",{},"Background"),children:(0,f.jsx)(o.sMM,{size:16})})}):null),[_,v,g]),L=(0,r.useMemo)((()=>m?(0,f.jsx)("div",{className:l()("thumbnail",{"thumbnail-page":C}),children:(0,f.jsx)("img",{src:m,draggable:!1})}):(0,f.jsx)(vt.Z,{spinColor:"white"})),[m,C]),k=(0,r.useRef)(null),R=I()&&!D;return(0,f.jsx)("div",{className:l()(_t.mark,{[_t["mark-active"]]:n}),style:{overflowAnchor:"none"},"data-layer-id":p,children:(0,f.jsxs)("div",{className:l()(_t["item-container"],{[_t["item-container-dragging"]]:D}),ref:b,onMouseMove:e=>{if(!k.current)return;(Math.abs(k.current.x-e.clientX)>10||Math.abs(k.current.y-e.clientY)>10)&&(k.current=null)},onMouseDown:e=>{k.current={x:e.clientX,y:e.clientY}},onMouseUp:e=>{k.current&&(null==d||d(e))},onMouseOver:()=>{w.dragItem||null==i||i(p,!0)},onMouseOut:()=>{w.dragItem||null==i||i(p,!1)},onContextMenu:e=>{e.preventDefault(),null==s||s(e)},children:[(0,f.jsx)(o.tOy,{className:l()(_t["drag-bar"],{[_t.hide]:!R}),size:16,onContextMenu:e=>{e.stopPropagation()}}),(0,f.jsxs)("div",{className:l()(_t.item,{[_t["item-active"]]:n},a),children:[(0,f.jsx)("div",{className:"item-bg"}),L,A]})]})})};var Pt=i(91123);const It=e=>{const{editor:t}=e,i=(0,r.useRef)(null),{layerDataList:n,dirtyLayerIds:a,setLayerDataList:o,updateLayerDataSrc:s,setLayerHover:l,moveLayersTemporary:c,moveLayers:d}=mt({editor:t}),{selectIds:u,appendSelectIds:h,ctrlSelect:g,commonSelect:p,shiftSelect:m}=function(e){const{editor:t,layerDataList:i}=e,n=t.getRenderSDK(),[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)([]),c=(0,r.useRef)(),d=(0,r.useRef)([]),u=(0,r.useCallback)((e=>{c.current=e.id}),[]),h=(0,r.useCallback)((()=>c.current=void 0),[]),g=e=>{o((t=>{const{selectedList:i,emitType:r}=e,n=i.map((e=>e.id));return r!==Ne.YM.LayerListSelect&&(c.current=n[n.length-1],d.current=n.slice(0,n.length-1)),l(n.filter((e=>!t.includes(e)))),n}))};(0,r.useEffect)((()=>{const e=n.accessors.selection.getTopSelectedMaterials();o(e)}),[n]),(0,r.useEffect)((()=>{const e=new Be.S;return e.add(Pt.default.events.interact.onMaterialSelect.event(g)),()=>{e.clear()}}),[n]);const p=(0,r.useCallback)((e=>{n.accessors.selection.triggerMaterialsSelection(e,{emitType:Ne.YM.LayerListSelect})}),[n]),m=(0,r.useCallback)((e=>e.filter((e=>{const t=i.find((t=>t.id===e));return t&&!wt(t)}))),[i]),_=(0,r.useCallback)((e=>{const{id:t}=e,i=a.indexOf(t),r=[...a];if(i>=0)return r.splice(i,1),p(r),void h();wt(e)?(p([t]),h()):(d.current=a,r.push(t),p(m(r)),u(e))}),[a,m]),v=(0,r.useCallback)((e=>{const{id:t}=e,r=i.findIndex((e=>e.id===t));if(-1===r)return;const n=i.findIndex((e=>e.id===c.current));if(-1===n)return d.current=[],p([t]),void u(e);if(wt(e))return p([t]),void h();const a=Math.min(r,n),o=Math.max(r,n),s=new Set([...d.current,...i.slice(a,o+1).map((e=>e.id))]);p(m(Array.from(s)))}),[c,i,a,m]),f=(0,r.useCallback)((e=>{const{id:t}=e;wt(e)?h():(d.current=[],u(e)),p([t])}),[a]);return{selectLayers:p,selectIds:a,appendSelectIds:s,commonSelect:f,ctrlSelect:_,shiftSelect:v}}({editor:t,layerDataList:n}),_=(0,r.useContext)(yt);(0,r.useEffect)((()=>{Object.keys(_.selectItemMap).forEach((e=>{u.includes(e)||delete _.selectItemMap[e]}))}),[u]);const v=(0,r.useCallback)((e=>{const t=i.current;if(!e||!t)return;const r=n.findIndex((t=>t.id===e)),a=t.childNodes[r],o=t.getBoundingClientRect(),s=a.getBoundingClientRect();(s.top<o.top||s.bottom>o.bottom)&&(null==a||a.scrollIntoView({behavior:"smooth",block:"nearest"}))}),[n]);(0,r.useEffect)((()=>{const e=h[h.length-1];v(e)}),[h]),(0,r.useEffect)((()=>{const e=u.filter((e=>a.includes(e))),t=e[e.length-1];requestIdleCallback((()=>v(t)))}),[a,u]);const y=(0,r.useMemo)((()=>n.map((e=>{const{id:i}=e;return(0,f.jsx)(St,{isSelected:u.includes(i),data:e,updateSrc:s,setLayerHover:l,onClick:t=>{t.shiftKey?m(e):t.ctrlKey||t.metaKey?g(e):p(e)},onContextMenu:i=>{u.includes(e.id)||p(e);const{clientX:r,clientY:n}=i;((e,i)=>{var r;null===(r=t.getContextmenuView())||void 0===r||r.show(e,i)})({x:r-Z.wO,y:n},{absolute:!0,followCanvas:!1})},onDraggingChange:t=>{t&&(_.originLayerDataList=[...n],u.includes(i)||p(e))}},i)}))),[n,u]),b=(0,r.useCallback)((()=>{_.originLayerDataList&&o(_.originLayerDataList)}),[_.originLayerDataList,o]);return function(e){const{moveLayersTemporary:t,resetLayers:i,moveLayers:n,ref:a,onAfterDrop:o}=e,s=(0,r.useContext)(yt),l=(0,r.useRef)(),c=(0,r.useRef)(),d=(0,r.useRef)();(0,r.useEffect)((()=>{s.dropRef=a}),[s]);const u=(0,k.Z)((()=>{var e;const t=null===(e=a.current)||void 0===e?void 0:e.childNodes;if(!t||t.length<=0)return[];const i=Array.from(t);return i.slice(0,i.length-1)})),h=(0,k.Z)((()=>u().map((e=>{const{top:t,height:i}=e.getBoundingClientRect();return t+i/2})))),g=(0,k.Z)((()=>{l.current&&cancelAnimationFrame(l.current);const e=()=>requestAnimationFrame((()=>{if(!a.current||!s.dragItem)return;const t=s.dragItem.element.getBoundingClientRect(),i=a.current.getBoundingClientRect();return t.top-20<i.top?(a.current.scrollBy({top:t.top-20-i.top}),c.current="top",void(l.current=e())):t.bottom+20>i.bottom?(a.current.scrollBy({top:t.bottom+20-i.bottom}),c.current="bottom",void(l.current=e())):void 0}));l.current=e()})),p=(0,r.useCallback)((e=>{const{clientX:r,clientY:o}=e;void 0!==d.current&&(o-d.current>0?c.current="bottom":o-d.current<0&&(c.current="top")),d.current=o;const{dragItem:l}=s;if(void 0===c.current||!a.current||!l)return;g();const{top:p,left:m,bottom:_,right:v}=a.current.getBoundingClientRect();if(r<m||r>v||o<p||o>_)return s.isOverDropZone=!1,void i();s.isOverDropZone=!0;const f=u(),y=h(),b=l.element.getBoundingClientRect();let x="bottom"===c.current?0:y.length-1;for(let t=0;t<y.length;t++){const e=y[t];if("bottom"===c.current)e<b.bottom&&(x=t);else if(e>b.top){x=t;break}}const w=f[x].getAttribute("data-layer-id"),S=l.id,P=Object.keys(s.selectItemMap).map((e=>s.selectItemMap[e])).map((e=>e.id));if(!w||!S)return;const I=((e,t)=>{let i;return e===t&&(i=void 0),e>t&&(i="top"),e<t&&(i="bottom"),i})(f.findIndex((e=>e.getAttribute("data-layer-id")===S)),x);t(P,S,w,(e=>{e&&(s.dropEffect=()=>{n(P,S,w,I)})}))}),[i,t,n]),m=e=>{const{isOverDropZone:t,dropEffect:i}=s,r=Object.keys(s.selectItemMap).map((e=>s.selectItemMap[e])).map((e=>e.id));t&&i&&(i(),null==o||o(r)),s.isOverDropZone=!1,s.dragItem=void 0,s.originLayerDataList=void 0};(0,r.useEffect)((()=>(window.addEventListener("mousemove",p),()=>{window.removeEventListener("mousemove",p)})),[p]),(0,r.useEffect)((()=>(window.addEventListener("mouseup",m),()=>{window.removeEventListener("mouseup",m)})),[m])}({ref:i,resetLayers:b,moveLayersTemporary:c,moveLayers:d,onAfterDrop:e=>{const i=t.getRenderSDK().accessors.page.getActivePageIndex();(0,J.M4)(e,i)}}),(0,f.jsx)("div",{className:_t.list,ref:i,children:y})},Ct=e=>{const{editor:t,isOpen:i,disableFeatures:n}=e,[a,o]=(0,r.useState)(!1);(0,r.useEffect)((()=>{i&&o(!0)}),[i]);return(0,f.jsx)(bt.Provider,{value:{disableFeatures:n},children:(0,f.jsx)(yt.Provider,{value:{selectItemMap:{}},children:(0,f.jsxs)("div",{className:l()(_t.layers,{[_t["layers-open"]]:i}),onTransitionEnd:()=>{i||o(!1)},children:[(0,f.jsx)("div",{className:_t.title,children:h.ZP.t("web_layer_title_layers",{},"Layers")}),a?(0,f.jsx)(It,{editor:t}):null]})})})};var Et,Dt,At=i(42058),Lt=i(55900),kt=i(67986);!function(e){e.normal="normal",e.readonly="readonly"}(Et||(Et={})),function(e){e.draggable="draggable"}(Dt||(Dt={}));const Rt={[Et.normal]:[],[Et.readonly]:[Dt.draggable]};class Mt extends Ce.v{constructor(e,t){super(e,t),this._onOpenStatusChange=new Lt.j,this._getOpenStatus=()=>{const e=this._editor.getDependence().storageQuery(Mt.PageLayersViewId);if(!e.ok||!e.value)return!1;(0,At.ZB)(e.value);try{return JSON.parse(e.value).isOpen}catch(t){kt.t.error("get last page layers open status",t)}return!1},this._setOpenStatus=()=>{const e={isOpen:Boolean(this.isOpen())};this._onOpenStatusChange.fire(e.isOpen),this._editor.getDependence().storageSet(Mt.PageLayersViewId,JSON.stringify(e))},e.setPageLayersView(this)}isOpen(){var e;return null===(e=this._props)||void 0===e?void 0:e.isOpen}onOpenStatusChange(e){return this._onOpenStatusChange.event(e)}mount(e){const t=null==e?void 0:e.permissionStatus,i=t&&Rt[t];this._props={editor:this._editor,setOpen:this.hide.bind(this),isOpen:this._getOpenStatus(),disableFeatures:i},this._setOpenStatus(),this.render((0,f.jsx)(Ct,{...this._props}))}show(){this._props.isOpen=!0,this._setOpenStatus(),this.render((0,f.jsx)(Ct,{...this._props}))}hide(){this._props&&(this._props.isOpen=!1,this._setOpenStatus(),this.render((0,f.jsx)(Ct,{...this._props})))}}Mt.PageLayersViewId="PAGE_LAYERS_VIEW_ID";var Tt=i(42547);var jt=i(22169),Nt=(i(75302),i(9557));const Bt="__get_props__";function Zt(e){let t=Object.getPrototypeOf(e);const i=[];for(;null!==t;)i.push(t),t=Object.getPrototypeOf(t);return i.reduce(((t,i)=>{const r=Object.getOwnPropertyNames(i).filter((e=>(0,jt.isFunction)(i[e])&&"constructor"!==e));return t.concat(r.map((e=>{const t=i[e];return{component:Reflect.getMetadata(Bt,t),fn:t}})).filter((e=>{const{component:i}=e,r=t.find((e=>e.component===i));return e.component&&!r})).map((t=>({component:t.component,getProps:t.fn.bind(e)}))))}),[])}const Ot="__root_edit_components_deps__";class Kt{constructor(e){this._effectDisposeStore=new Be.S;const{editRoot:t,editor:i}=e;if(!t)throw new Error("Edit tool root container not exist.");this._root=t,this._graphicSDKApi=i.getGraphicSDK().api,this._renderSDK=i.getRenderSDK(),this._editor=i,this._state=e.state,this._dispatch=e.dispatch}mount(){kt.t.debug("Edit mount");const e=Zt(this).map((e=>({...e,props:e.getProps()})));!function(e,t){var i;if((null===(i=e[Ot])||void 0===i?void 0:i.length)>0){const i=e[Ot],r=[];i.forEach((e=>{t.find((t=>t.component===e.component))||r.push(e)})),r.push(...t),e[Ot]=r}else e[Ot]=t}(this._root,e),this._renderRoot(),this.onMount(),this._effectDisposeStore.add(this.onEffect())}effect(){this._renderRoot((e=>(e.props={...e.getProps()},e.props))),this._effectDisposeStore.clear(),this._effectDisposeStore.add(this.onEffect())}updateContext(e,t){kt.t.debug("Edit updateContext"),this._root&&(this._state=e,this._dispatch=t,this._renderRoot())}updateComponent(e,t){kt.t.debug("Edit updateComponent"),this._root&&this._renderRoot((i=>{let r={...i.props};return e===i.component&&(r={...r,...t},i.props={...r}),r}))}unmount(){kt.t.debug("Edit unmount"),function(e,t){if(!(e[Ot]instanceof Array))return;const i=e[Ot],r=[];i.forEach((e=>{t.find((t=>t.component===e.component))||r.push(e)})),e[Ot]=r}(this._root,Zt(this)),this._renderRoot(),this.onUnmount(),this._effectDisposeStore.clear()}onMount(){}onUnmount(){}onEffect(){return Be.G}_renderRoot(e){const t=[],i=null!=e?e:e=>e.props;var n,a;(n=this._root,null!==(a=n[Ot])&&void 0!==a?a:[]).forEach(((e,n)=>{const a=i(e);t.push((0,r.createElement)(e.component,{...a,key:String(n)}))}));const o=(0,r.createElement)(r.Fragment,{children:t});this._root.render((0,r.createElement)(Nt.z,{state:this._state,dispatch:this._dispatch},o))}}const Ft=async(e,t,i,r)=>{var n,a,o;const{layerId:s,layout:l}=e,c={layout:l},d=i.getNodeLayer(s);if(!d)return;const u=null!==(n=null===(a=l.scale)||void 0===a?void 0:a.x)&&void 0!==n?n:1,{extendBuffer:h={x:0,y:0}}=i.getNodeAttrs(s,["extendBuffer"]),g=d.lineMaxWidth&&-1!==d.lineMaxWidth,p=d.layout.width!==l.width,m=(null===(o=d.layout.scale)||void 0===o?void 0:o.x)!==u;if((0,jt.set)(c,"extra.textOuterRect",{width:l.width+h.x,height:l.height+h.y}),(p||g&&m)&&Object.assign(c,{lineMaxWidth:1}),r.id===s&&r.isEditing){const e=await i.getRichJson(s,{component:!0,selection:!1});e&&Object.assign(c,{richText:JSON.stringify(e)}),Object.assign(c,{text:r.text})}t.updateProperties(s,c)};var Gt=i(56333),Ut=i(82440);function Ht(e){return e.map((e=>e)).join("|")}class Vt extends Kt{constructor(e){super(e),this._enableDblClick=!0,this._disposableStore=new Be.S,this.revalidateLayerLayout=(e,t)=>{const i=t.filter((e=>this.idList.find((t=>t===e.id)))),r=i.map((e=>{const{x:t,y:i,width:r,height:n,rotation:a,scale:{x:o,y:s},clipRect:l}=e;let c;return o&&s&&(c={x:o,y:s}),{layerId:e.id,type:e.layerType,layout:{x:t,y:i,width:r,height:n,rotation:a,scale:c,clipRect:l}}}));return r},this.updateLayerLayout=async e=>{const{transaction:t}=this._graphicSDKApi;e.length<=0||(t.begin(),await Promise.all(e.map((e=>{(async(e,t,i,r)=>{const{type:n,...a}=e;n===Ne.Wq.TEXT?await Ft(a,t.text,i.text,r):t.common.updateLayout(a)})(e,this._graphicSDKApi,this._renderSDK.accessors,this._editor.getTextEditView().textEditor)}))),t.commit())},this.getLayerDisabledLevelOptions=()=>{const e=[];e.push(...this._idList);const t=new Array(e.length),i=new Array(e.length),r=[];return e.forEach(((r,n)=>{const a=this._renderSDK.accessors.page.findMaterialLevelById(null!=r?r:this._id);if(!a)return;const{topLevel:o,level:s}=a,l=[1,e.length],c=[o-e.length+1,o],d=s>=l[0]&&s<=l[1],u=s>=c[0]&&s<=c[1];t[n]=d,i[n]=u})),t.every(Boolean)&&r.push(Ne.l7.SEND_BACKWARD,Ne.l7.SEND_TO_BACK),i.every(Boolean)&&r.push(Ne.l7.BRING_FORWARD,Ne.l7.BRING_TO_FRONT),r},this.onUpdateMultiLayerPosition=e=>{this._graphicSDKApi.transaction.begin();this._sortLayersLevel(this._idList,e).forEach(((t,i)=>{this._verifyBeforeMoveForMulti(t,i,e)&&this._graphicSDKApi.common.updatePosition(e,t.id)})),this._graphicSDKApi.transaction.commit()},this._onGroupChange=e=>{if(this._groupId&&!e){var t;const e=this._renderSDK.accessors.layer.getLayerById(this._groupId);return null!=e&&null!==(t=e.extra)&&void 0!==t&&t.resourceId&&Ut.fc.removePreviewUrl(e.extra.resourceId),(0,Gt.r4)([this._groupId],Gt.$6.Ungroup,v.l5.Click,this._getActivePageIndex()),void this._graphicSDKApi.group.unGroup(this._groupId)}if(!(1===this.idList.length)&&e){const e=this.idList.map((e=>e)),t=this._renderSDK.accessors.layer.getMaterialsSelectRectForModel(e);(0,Gt.r4)(this.idList,Gt.$6.Group,v.l5.Click,this._getActivePageIndex()),this._graphicSDKApi.group.group(e,t)}},this._verifyBeforeMoveForMulti=(e,t,i)=>{const{level:r,topLevel:n}=e;return i===Ne.l7.SEND_BACKWARD?r-t>1:i!==Ne.l7.BRING_FORWARD||r+t<n};const{id:t,idList:i,layerToolsProps:r,groupId:n}=e;this._id=null!=t?t:Ht(i),this._idList=i,this._groupId=n,this._layerToolsProps=r,this._enableDblClick=!n}get id(){return this._id}get idList(){return this._idList}onEffect(){const e=this._renderSDK.accessors.layer,t=new Be.S;return t.add(e.onDragStart(this.idList.map((e=>e)),this.onDragStart.bind(this))),t.add(e.onDragEnd(this.idList.map((e=>e)),this.onDragEnd.bind(this))),t.add(e.onTransformStart(this.idList.map((e=>e)),this.onTransformStart.bind(this))),t.add(e.onTransformEnd(this.idList.map((e=>e)),this.onTransformEnd.bind(this))),t.add(e.onTransform(this.idList.map((e=>e)),this.onTransform.bind(this))),t.add(e.onDblClick(this.idList.map((e=>e)),this.onDblClick.bind(this))),t.add(e.onClick(this.idList.map((e=>e)),this.onClick.bind(this))),t.add(e.onMouseDown(this.idList.map((e=>e)),this.onMouseDown.bind(this))),t.add(e.onMouseMove(this.idList.map((e=>e)),this.onMouseMove.bind(this))),t.add(e.onMouseUp(this.idList.map((e=>e)),this.onMouseUp.bind(this))),t.add(e.onMouseEnter(this.idList.map((e=>e)),this.onMouseEnter.bind(this))),t.add(e.onMouseOut(this.idList.map((e=>e)),this.onMouseOut.bind(this))),t.add(e.onLayoutBatchUpdate(this.idList.map((e=>e)),this.onLayoutBatchUpdate.bind(this))),()=>{t.clear()}}onMount(){this._disposableStore.add(_.Z.interact.onPageLayoutChange.event(this.onPageLayoutChange.bind(this))),this._onRotaterShowDetect()}onUnmount(){this._disposableStore.clear()}onPageLayoutChange(){this._onRotaterShowDetect()}onDragStart(){var e;null===(e=this._editor.getSuspendToolView())||void 0===e||e.hide()}onDragEnd(){var e;this._onRotaterShowDetect(),null===(e=this._editor.getSuspendToolView())||void 0===e||e.show()}onTransformStart(){var e;null===(e=this._editor.getSuspendToolView())||void 0===e||e.hide()}onTransformEnd(){var e;this._onRotaterShowDetect(),null===(e=this._editor.getSuspendToolView())||void 0===e||e.show()}onTransform(){}onDblClick(e){}onClick(e){}onMouseDown(e){this._enableDblClick=!0}onMouseMove(e){}onMouseEnter(e){}onMouseOut(e){}onMouseUp(e){}onLayoutBatchUpdate(e,t,i){const r=this.revalidateLayerLayout(e,t);this.updateLayerLayout(r),(0,J.oM)(this.id,e,t,v.l5.Click,i,this._renderSDK.accessors.page.getActivePageIndex())}getGroupSuspendToolsVisible(){return this.idList.length>1}_sortLayersLevel(e,t){return e.map((e=>{const t=this._renderSDK.accessors.page.findMaterialLevelById(e);if(!t)return;const{level:i,topLevel:r}=t;return{id:e,level:i,topLevel:r}})).filter((e=>Boolean(e))).sort(((e,i)=>[Ne.l7.SEND_BACKWARD,Ne.l7.BRING_TO_FRONT].includes(t)?e.level-i.level:i.level-e.level))}_onRotaterShowDetect(){this._renderSDK.accessors.layer.rotaterShowDetect(this.idList.map((e=>e)))}_getActivePageIndex(){return this._renderSDK.accessors.page.getActivePageIndex()}}class zt extends Vt{constructor(e){super(e),this._disposeStore=new Be.S,this._isFirstCreated=!1,this._editorState=()=>this._editor.getTextEditView().textEditor,this.updateLayerLayout=async e=>{const{transaction:t,text:i}=this._graphicSDKApi,r=this._renderSDK.accessors.text;e.length<=0||(t.begin(),await Promise.all(e.map((async e=>{await Ft(e,i,r,this._editorState())}))),t.commit())},this.triggerTextParamsChange=(e,t,i,r)=>this._onTextParamsChange(e,t,i,r),this._onTextParamsChange=(e,t,i,r,n)=>{if(t&&!n&&!e.preset){const t=this._editorState().selectionStart<this._editorState().selectionEnd;(0,Gt.y5)(e,{isHotkeys:r,pageIndex:this._renderSDK.accessors.page.getActivePageIndex(),range:t})}this._editor.getDependence().textEditService.update({data:e,shouldUpdateLayer:t,immediate:i})},this._isFirstCreated=Boolean(e.isFirstCreated)}onMount(){super.onMount(),this._isFirstCreated&&(this._isFirstCreated=!1)}onUnmount(){super.onUnmount(),this._disposeStore.clear()}getTextModel(){return this._editor.getDependence().textEditService.getTextToolModel()}}class Wt extends Kt{constructor(e){super(e),this._disposableStore=new Be.S,this._enableDblClick=!0,this.getLayerDisabledLevelOptions=e=>{const t=this._renderSDK.accessors.page.findMaterialLevelById(null!=e?e:this._id);if(!t)return[];const{level:i,topLevel:r}=t,n=[];return i===r&&n.push(Ne.l7.BRING_FORWARD,Ne.l7.BRING_TO_FRONT),1===i&&n.push(Ne.l7.SEND_BACKWARD,Ne.l7.SEND_TO_BACK),n},this._onGroupChange=e=>{if(this._groupId&&!e){var t;const e=this._renderSDK.accessors.layer.getLayerById(this._groupId);null!=e&&null!==(t=e.extra)&&void 0!==t&&t.resourceId&&Ut.fc.removePreviewUrl(e.extra.resourceId),(0,Gt.r4)([this._groupId],Gt.$6.Ungroup,v.l5.Click,this._renderSDK.accessors.page.getActivePageIndex()),this._graphicSDKApi.group.unGroup(this._groupId)}};const{id:t,layerToolsProps:i,useRotaterShowDetect:r,groupId:n}=e;this._id=t,this._groupId=n,this._layerToolsProps=i,this._useRotaterShowDetect=void 0===r||r,this._enableDblClick=!n}get id(){return this._id}onMount(){this._disposableStore.add(_.Z.interact.onPageLayoutChange.event(this.onPageLayoutChange.bind(this))),this._onRotaterShowDetect()}onUnmount(){this._disposableStore.clear()}onEffect(){const e=this._renderSDK.accessors.layer,t=new Be.S,i=[this.id];return t.add(e.onDragStart(i,this.onDragStart.bind(this))),t.add(e.onDragEnd(i,this.onDragEnd.bind(this))),t.add(e.onDragMove(i,this.onDragMove.bind(this))),t.add(e.onTransformStart(i,this.onTransformStart.bind(this))),t.add(e.onTransform(i,this.onTransform.bind(this))),t.add(e.onTransformEnd(i,this.onTransformEnd.bind(this))),t.add(e.onDblClick(i,this.onDblClick.bind(this))),t.add(e.onClick(i,this.onClick.bind(this))),t.add(e.onMouseDown(i,this.onMouseDown.bind(this))),t.add(e.onMouseMove(i,this.onMouseMove.bind(this))),t.add(e.onMouseEnter(i,this.onMouseEnter.bind(this))),t.add(e.onMouseOut(i,this.onMouseOut.bind(this))),t.add(e.onMouseUp(i,this.onMouseUp.bind(this))),t.add(e.onLayoutUpdate(this.id,this.onLayoutUpdate.bind(this))),()=>{t.clear()}}onPageLayoutChange(){this._onRotaterShowDetect()}onLayoutUpdate(e,t,i){(0,J.oM)(this.id,[e],[t],v.l5.Click,i,this._renderSDK.accessors.page.getActivePageIndex());const{x:r,y:n,width:a,height:o,rotation:s,scale:{x:l,y:c},clipRect:d}=t;let u;l&&c&&(u={x:l,y:c}),this._graphicSDKApi.common.updateLayout({layerId:this.id,layout:{x:r,y:n,width:a,height:o,rotation:s,scale:u,clipRect:d}})}onDragStart(){var e;null===(e=this._editor.getSuspendToolView())||void 0===e||e.hide()}onDragEnd(){var e;this._onRotaterShowDetect(),null===(e=this._editor.getSuspendToolView())||void 0===e||e.show()}onDragMove(){}onTransformStart(){var e;null===(e=this._editor.getSuspendToolView())||void 0===e||e.hide()}onTransform(){}onTransformEnd(){var e;this._onRotaterShowDetect(),null===(e=this._editor.getSuspendToolView())||void 0===e||e.show()}onDblClick(e){}onClick(e){}onMouseDown(e){this._enableDblClick=!0}onMouseMove(e){}onMouseUp(e){}onMouseEnter(e){}onMouseOut(e){}layerOutsideViewRect(){var e;const{width:t,height:i}=this._renderSDK.stage,r=0,n=0,a=t,o=i,{x:s=0,y:l=0,width:c=0,height:d=0}=null!==(e=this._renderSDK.accessors.imageContainer.getClientRectRelativeToStage(this.id))&&void 0!==e?e:{};return s+c<r||s>a||l+d<n||l>o}_onRotaterShowDetect(){if(!this._useRotaterShowDetect)return;this._renderSDK.accessors.layer.rotaterShowDetect(this.id)}}class $t extends Wt{constructor(e){super(e);const{factory:t,subMaterial:i}=e;this._factory=t,this._subMaterial=i,this._groupId=this.id}get subId(){var e;return null===(e=this._subMaterial)||void 0===e?void 0:e.id}get subType(){var e;return null===(e=this._subMaterial)||void 0===e?void 0:e.type}get subEdit(){return this._subEdit}updateContext(e,t){var i;super.updateContext(e,t),null===(i=this._subEdit)||void 0===i||i.updateContext(e,t)}onMount(){super.onMount(),this.subId&&this._createSubEdit()}onUnmount(){super.onUnmount(),this._clearSubEdit()}onEffect(){var e;const t=super.onEffect();return null===(e=this._subEdit)||void 0===e||e.effect(),t}onLayoutUpdate(e,t,i){this._subEdit||super.onLayoutUpdate(e,t,i)}_clearSubEdit(){var e;null===(e=this._subEdit)||void 0===e||e.unmount(),delete this._subEdit}_createSubEdit(){var e;if(this.subType===Ne.Wq.GROUP_LAYER)throw new Error("GroupEdit: subEdit can not be GroupEdit");this.subId&&this.subType&&(this._subEdit=this._factory.createSubEdit(this.subId,this.subType,{onGroupChange:this._onGroupChange,groupId:this.id}),null===(e=this._subEdit)||void 0===e||e.mount())}}class Yt extends Wt{onDblClick(e){const{button:t}=e,{accessors:i}=this._renderSDK,r=i.page.getActivePageId(),n=i.layer.isLocked([r]);if(0!==t||!this._enableDblClick||n)return;const a=i.page.hasBackgroundImage(r),o=this._editor.getSuspendToolView();!a||null!=o&&o.isCropping()||null!=o&&o.isReplacing()||null==o||o.openCrop()}}var Xt=i(96442);class qt extends Wt{constructor(){super(...arguments),this._hoverImageContainer={target:void 0,layout:void 0},this._hoverGrid={target:void 0,layout:void 0}}onDragEnd(){super.onDragEnd();if(this._handleDropImageContainter())return;this._handleDropGrid()}onDragMove(){this._handleHoverImageContainter(),this._handleHoverGrid()}onDblClick(e){const{button:t}=e,{accessors:i}=this._renderSDK,r=i.layer.materialLoadingChecker(this.id),n=i.layer.isLocked([this.id]);if(0!==t||!this._enableDblClick||r||n)return;const a=this._editor.getSuspendToolView();var o;null!=a&&a.isReplacing()||(null===(o=this._editor.getSuspendToolView())||void 0===o||o.openCrop())}_isCanFillImageContainer(){const e=this._renderSDK.accessors.layer.getLayerById(this.id);return(null==e?void 0:e.replaceable)||!1}_isCanFillGrid(){const e=this._renderSDK.accessors.layer.getLayerById(this.id);return(null==e?void 0:e.replaceable)||!1}_isImageLoading(){return this._renderSDK.accessors.image.getLoading(this.id)}_isImageContainerLocked(e){return this._renderSDK.accessors.layer.isLocked([e])}_isBatchEditorMainImage(e,t){const i=this._renderSDK.accessors.layer.getBatchEditorMainLayerInfoByLayerId(e);return!(null==i||!i.isMainLayer||(null==i?void 0:i.position)!==t)}_isImageContainerLoading(e){return this._renderSDK.accessors.imageContainer.getLoading(e)}_handleDropImageContainter(){if(!this._isCanFillImageContainer()||this._isImageLoading())return!1;const e=this._renderSDK.accessors.layer.getStagePointerPosition(),{target:t,layout:i}=this._hoverImageContainer;if(!e||!t||!i||this._isImageContainerLoading(t.id)||this._isImageContainerLocked(t.id))return!1;const r=!this._renderSDK.accessors.imageContainer.getIsSingle(t.id);return(0,Xt.lU)(r),this._graphicSDKApi.imageContainer.fillContainerItemWithLayerId(t.id,t.index,this.id,i),!0}_handleHoverImageContainter(){var e;if(!this._isCanFillImageContainer()||this._isImageLoading())return;const t=this._renderSDK.accessors.layer,i=this._renderSDK.accessors.imageContainer,r=t.getStagePointerPosition();if(!r)return;const n=null!==(e=window.event)&&void 0!==e?e:{},a=(g.t.MacOS?n.metaKey:n.ctrlKey)||n.altKey?void 0:i.isPointInImageContainerItem(r);if(a&&this._isImageContainerLocked(a.id))return;if(a&&this._isBatchEditorMainImage(a.id,a.index))return;const o=(e,t)=>{this._hoverImageContainer.target=a,this._hoverImageContainer.layout=i.renderHoverImageLayer(e,t,this.id)},s=(e,t)=>{i.removeHoverImage(e,t),this._hoverImageContainer.target=void 0,this._hoverImageContainer.layout=void 0},{target:l}=this._hoverImageContainer;if(!a)return void(l&&(s(l.id,l.index),i.resetImageLayerOpacity(this.id)));const{id:c,index:d}=a;if(!l)return o(c,d),void i.setImageLayerOpacity(this.id,.3);l.id===c&&l.index===d||(s(l.id,l.index),o(c,d))}_isGridLocked(e){return this._renderSDK.accessors.layer.isLocked([e])}_isGridLoading(e){return this._renderSDK.accessors.imageContainer.getLoading(e)}_handleDropGrid(){if(!this._isCanFillGrid()||this._isImageLoading())return!1;const e=this._renderSDK.accessors.layer.getStagePointerPosition(),{target:t,layout:i}=this._hoverGrid;return!(!(e&&t&&i)||this._isGridLoading(t.id)||this._isGridLocked(t.id))&&((0,Xt.zW)(),this._graphicSDKApi.grid.updateGridFillWithLayerId(t.id,t.areaId,this.id,i),!0)}_handleHoverGrid(){var e;if(!this._isCanFillGrid()||this._isImageLoading())return;const t=this._renderSDK.accessors.layer,i=this._renderSDK.accessors.grid,r=t.getStagePointerPosition();if(!r)return;const n=null!==(e=window.event)&&void 0!==e?e:{},a=(g.t.MacOS?n.metaKey:n.ctrlKey)||n.altKey?void 0:i.getGridByPoint(r);if(a&&this._isImageContainerLocked(a.id))return;if(a&&this._isBatchEditorMainImage(a.id,a.index))return;const o=(e,t)=>{this._hoverGrid.target=a,this._hoverGrid.layout=i.renderHoverImageLayer(e,t,this.id)},s=(e,t)=>{i.removeHoverImage(e,t),this._hoverGrid.target=void 0,this._hoverGrid.layout=void 0},{target:l}=this._hoverGrid;if(!a)return void(l&&(s(l.id,l.areaId),i.resetImageLayerOpacity(this.id)));const{id:c,index:d}=a;if(!l)return o(c,d),void i.setImageLayerOpacity(this.id,.3);l.id===c&&l.index===d||(s(l.id,l.index),o(c,d))}}class Jt extends Wt{constructor(e){var t;super(e),this._selectIndex=null!==(t=e.selectIndex)&&void 0!==t?t:0}onDblClick(e){const{button:t}=e,{accessors:i}=this._renderSDK,r=i.layer.materialLoadingChecker(this.id),n=i.layer.isLocked([this.id]);if(0!==t||!this._enableDblClick||r||n)return;const a=i.imageContainer.getImageContainerWidget(this.id);if(!a)return;const o=a.getSelectIndex(),s=Boolean(i.imageContainer.getSelectImage(this.id,o)),l=this._editor.getSuspendToolView();!s||null!=l&&l.isReplacing()||((0,Gt._s)({layerId:this.id,action:Gt.yw.DoubleClickCrop,type:v.l5.Click,pageIndex:i.page.getActivePageIndex()}),null==l||l.openCrop())}onLayoutUpdate(e,t,i,r){const{imageContainer:n}=this._graphicSDKApi,a=this._renderSDK.accessors.imageContainer,{scale:o,width:s,height:l,x:c,y:d}=t,u=a.calNonUniformScaling(this.id,{width:s*o.x,height:l*o.y},r);if(u){const{layout:e,items:t}=u;n.nonUniformScaling(this.id,{...e,x:c,y:d},t)}else super.onLayoutUpdate(e,t,i)}}class Qt extends Wt{constructor(e){var t;super(e),this._selectIndex=null!==(t=e.selectIndex)&&void 0!==t?t:0}onDblClick(e){const{button:t}=e,{accessors:i}=this._renderSDK,r=i.layer.materialLoadingChecker(this.id),n=i.layer.isLocked([this.id]);if(0!==t||!this._enableDblClick||r||n)return;const a=i.grid.getGridWidget(this.id);if(!a)return;const o=a.getSelectedAreaIndex(),s=Boolean(i.grid.getSelectImageByIndex(this.id,o)),l=this._editor.getSuspendToolView();!s||null!=l&&l.isReplacing()||((0,Gt._s)({layerId:this.id,action:Gt.yw.DoubleClickCrop,type:v.l5.Click,pageIndex:i.page.getActivePageIndex()}),null==l||l.openCrop())}onLayoutUpdate(e,t,i,r){const{grid:n}=this._graphicSDKApi,a=this._renderSDK.accessors.grid,{x:o,y:s,rotation:l}=t,c=a.calScaling(this.id,r);if(!c)return;const{layout:d,items:u}=c;n.transformLayout(this.id,{...d,x:o,y:s,rotation:l},null!=u?u:[])}}class ei extends Wt{constructor(e,t){super(t),this._getPathAttrs=()=>{if(this._category===Ne.Wq.LINE){const e=this._renderSDK.accessors.line.getLineLayer(this.id);return{...e.attr,source:e.source}}{const e=this._renderSDK.accessors.shape.getShapePaths(this.id),t=e[0].attr,{radius:i,source:r}=e[0];return{...t,radius:i,source:r}}},this._category=e}onLayoutUpdate(e,t,i){const{width:r,height:n,x:a,y:o,rotation:s,scale:{x:l,y:c}}=t;if(this._category===Ne.Wq.LINE){(0,J.pM)([e],[t],this._renderSDK.accessors.page.getActivePageIndex());const i=Math.floor(r*l),d=this._renderSDK.accessors.layer.getLayerById(this.id),u=Math.floor(d.layout.width*d.layout.scale.x),h=d.attr.viewBox,{width:g}=h,p=g/u;this._graphicSDKApi.line.updateAttribute(this.id,{viewBox:{...h,width:Math.floor(i*p)}},{x:a,y:o,width:r,height:n,rotation:s,scale:{x:l,y:c}})}else super.onLayoutUpdate(e,t,i)}}class ti{constructor(e){const{editor:t,state:i,dispatch:r,editRoot:n}=e;this._root=n,this._editor=t,this._state=i,this._dispatch=r}createEdit(e,t,i){const{subMaterial:r,isFirstCreated:n,selectIndex:a,groupId:o}=null!=i?i:{},s={groupId:o,id:e},l={id:e,subMaterial:r},c={id:e,groupId:o,selectIndex:a},d={id:e,groupId:o,selectIndex:a};switch(t){case Ne.Wq.IMAGE:case Ne.Wq.SVG_IMAGE:return this._createImageEdit(s);case Ne.Wq.IMAGE_CONTAINER:return this._createImageContainerEdit(c);case Ne.Wq.GRID:return this._createGridEdit(d);case Ne.Wq.TEXT:return this.createMultiTextEdit({...s,isFirstCreated:n,idList:[e]});case Ne.Wq.LINE:return this._createLineShapeEdit(s);case Ne.Wq.SHAPE:return this._createPolyShapeEdit(s);case Ne.Wq.GROUP_LAYER:return this._createGroupEdit(l);case Ne.Wq.PAGE:return this._createPageEdit(s)}}createSubEdit(e,t,i){const r=[{id:e,groupId:null==i?void 0:i.groupId},i];switch(t){case Ne.Wq.IMAGE:return this._createSubImageEdit(...r);case Ne.Wq.IMAGE_CONTAINER:return this._createSubImageContainerEdit(...r);case Ne.Wq.GRID:return this._createSubGridEdit(...r);case Ne.Wq.TEXT:return this.createSubMultiTextEdit({idList:[e],groupId:null==i?void 0:i.groupId},i);case Ne.Wq.LINE:return this._createSubLineShapeEdit(...r);case Ne.Wq.SHAPE:return this._createSubPolyShapeEdit(...r)}}createMultiEdit(e){return new Vt({...this._getCommonConfig(),...e})}createMultiTextEdit(e){return new zt({...this._getCommonConfig(),...e})}createSubMultiTextEdit(e,t){const{onGroupChange:i}=null!=t?t:{};return new zt({...this._getCommonConfig(),...e,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createPageEdit(e){return new Yt({...this._getCommonConfig(),...e})}_createGroupEdit(e){return new $t({...this._getCommonConfig(),...e,factory:this})}_createImageEdit(e){return new qt({...this._getCommonConfig(),...e,useRotaterShowDetect:!1})}_createSubImageContainerEdit(e,t){const{onGroupChange:i,selectIndex:r}=null!=t?t:{};return new Jt({...this._getCommonConfig(),...e,selectIndex:r,useRotaterShowDetect:!1,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createSubGridEdit(e,t){const{onGroupChange:i,selectIndex:r}=null!=t?t:{};return new Qt({...this._getCommonConfig(),...e,selectIndex:r,useRotaterShowDetect:!1,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createSubLineShapeEdit(e,t){const{onGroupChange:i}=null!=t?t:{};return new ei(Ne.Wq.LINE,{...this._getCommonConfig(),...e,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createSubPolyShapeEdit(e,t){const{onGroupChange:i}=null!=t?t:{};return new ei(Ne.Wq.SHAPE,{...this._getCommonConfig(),...e,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createSubImageEdit(e,t){const{onGroupChange:i}=null!=t?t:{};return new qt({...this._getCommonConfig(),...e,useRotaterShowDetect:!1,layerToolsProps:{onCopyChange:void 0,onGroupChange:i,isGrouped:!0}})}_createImageContainerEdit(e){return new Jt({...this._getCommonConfig(),...e,useRotaterShowDetect:!1})}_createGridEdit(e){return new Qt({...this._getCommonConfig(),...e,useRotaterShowDetect:!1})}_createLineShapeEdit(e){return new ei(Ne.Wq.LINE,{...this._getCommonConfig(),...e})}_createPolyShapeEdit(e){return new ei(Ne.Wq.SHAPE,{...this._getCommonConfig(),...e})}_getCommonConfig(){return{editRoot:this._root,containerId:this._containerId,editor:this._editor,state:this._state,dispatch:this._dispatch}}}var ii=i(52034),ri=i(37722),ni=i(68967),ai=i(41684),oi=i(59483),si=i(14283);const li={_toolbarView:{getView:()=>Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,11613)),containerId:a.d9},_contextmenuView:{getView:()=>Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,49752)),containerId:a.K6},_suspendToolView:{getView:()=>Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,47187)),containerId:a.DS},_pageTitleView:{getView:()=>Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,72872)),containerId:a.wQ},_textEditView:{getView:()=>Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,41120)),containerId:a.lF}};class ci extends ii.J{constructor(e){super(),this._firstRenderReady=!1,this._stashNeedLayoutChangeList=[],this._isDistanceMeasuring=!1,this._isViewReady=!1,this._selectQueue=[],this.onPageScrollChange=()=>{var e;null===(e=this._contextmenuView)||void 0===e||e.hide()},this.onPageZoomChange=()=>{var e;null===(e=this._contextmenuView)||void 0===e||e.hide()},this.onFirstRenderReady=()=>{this._firstRenderReady=!0,this._stashNeedLayoutChangeList.length&&(this._stashNeedLayoutChangeList.forEach((e=>{this.onNeedLayoutChange(e)})),this._stashNeedLayoutChangeList=[])},this.onNeedLayoutChange=async e=>{if(!this._firstRenderReady)return this._stashNeedLayoutChangeList.push(e),await this.renderSDK.waitRenderReady(),void this.onFirstRenderReady();const t=this._editor.getGraphicSDK().api.common,{id:i,height:r,offsetY:n}=e,a=this.renderSDK.accessors.layer.getLayerById(i);if(this.renderSDK.accessors.layer.getLayerAbsoluteScale(i)&&Math.round(a.layout.height)!==Math.round(r)){this._isBatch||this._disableDraftSaveNextTime();const e=(0,ai._E)({...a.layout},{rotation:0,width:a.layout.width,height:r,x:0,y:-n,scale:{x:1,y:1}});t.updateLayout({layerId:i,layout:{x:e.x,y:e.y,width:e.width,height:e.height},canUndoRedo:!1})}},this.onDistanceMeasureStart=e=>{var t,i;this._isDistanceMeasuring=!0,null===(t=this._suspendToolView)||void 0===t||t.hide();const r=this._editor.getPlugin();(0,oi.m)({draftId:(null==r||null===(i=r.draftManagerService)||void 0===i?void 0:i.draftId)||"",...e})},this.onDistanceMeasureEnd=()=>{var e;this._isDistanceMeasuring=!1,null===(e=this._suspendToolView)||void 0===e||e.show()},this.handleContextmenu=e=>{var t;e.type===Ne.bM.Contextmenu&&((0,J.VO)(this._editor.getRenderSDK().accessors.page.getActivePageIndex(),v.d.Canvas),null===(t=this._contextmenuView)||void 0===t||t.show(e.position))},this.handleSelectChange=e=>{const{selectedList:t}=e,i=this._editor.getGraphicSDK().document;kt.t.debug("%c current select layer, %o","font-size:20px;color:green;",t.map((e=>e.type===Ne.F5.PAGE?i.getPageById(e.id):i.getLayerById(e.id))))},this.onDeleteOutsideLayer=e=>{const t=this._editor.getGraphicSDK().api;if(null!=e&&e.length)return(0,J.c_)(e,v.B$.DELETE,v.l5.Click,this.renderSDK.accessors.page.getActivePageIndex()),void t.common.remove(...e);const i=this.renderSDK.accessors.page.findAllMaterialsWithoutPage(),r=[];i.forEach((({id:e,node:t})=>{this.renderSDK.accessors.page.isNodeIntersectPage(t)||r.push(e)})),null!=r&&r.length&&((0,J.c_)(r,v.B$.DELETE,v.l5.Click,this.renderSDK.accessors.page.getActivePageIndex()),t.common.remove(...r))},this.handleSelect=e=>{var t,i,r,n;if(!this._isViewReady)return void this._selectQueue.push((()=>this.handleSelect(e)));const{selectedList:a}=e;var o;(this._pageEditContextInit(a),this._editor.setSelectedMaterials(a),null===(t=this._toolbarView)||void 0===t||t.mountNormalTools(e),null===(i=this._suspendToolView)||void 0===i||i.reset(),this._isDistanceMeasuring)||(null===(o=this._suspendToolView)||void 0===o||o.show());if(a.length<=0)return void this.clearCurrentEdit();const{type:s,id:l,subMaterial:c,source:d,selectIndex:u}=a[0];var h;if(a.length>1)this._handleMultiSelect(e);else if(this._currentEdit instanceof $t&&this._currentEdit.subId===(null==c?void 0:c.id)&&this._currentEdit.id===l)this._currentEdit.effect(),(null==c?void 0:c.type)===Ne.Wq.TEXT&&(null===(h=this._textEditView)||void 0===h||h.show());else if(!(this._currentEdit instanceof Wt)||this._currentEdit instanceof $t||this._currentEdit.id!==l){var g,p;if(this._currentEdit instanceof zt&&(null===(r=this._currentEdit)||void 0===r?void 0:r.id)===l)return this._currentEdit.effect(),void(null===(g=this._textEditView)||void 0===g||g.show());if(this.clearCurrentEdit(),this._currentEdit=this._factory.createEdit(l,s,{subMaterial:c,selectIndex:u,isFirstCreated:d===Ne.xx.init}),this._editor.setEditInstance(this._currentEdit),null===(n=this._currentEdit)||void 0===n||n.mount(),(c?c.type:s)===Ne.Wq.TEXT)null===(p=this._textEditView)||void 0===p||p.show()}else this._currentEdit.effect()},this.onFullScreenChange=e=>{var t,i;e.isFullScreen?null===(t=this._toolbarView)||void 0===t||t.hide():null===(i=this._toolbarView)||void 0===i||i.show()},this.onDragCopyEvent=({startPosition:e,endPosition:t})=>{const i=this._editor.getGraphicSDK(),{renderSDK:r}=this,n=i.api,a=this._editor.getSelectedMaterials(),o=this._editor.getSelectedMaterials().map((e=>e.id));n.transaction.begin();const s=(0,si.ZB)(o,i,r),l=o.map((e=>({layerId:e,position:s[e]})));n.common.copy(...l);const c=this.renderSDK.getMainRenderer().getActivePageWidget(),d=n.document.getLayersByFilter(!1,((e,t)=>t.id===(null==c?void 0:c.getId()))).slice(-o.length);a.forEach(((i,r)=>{n.common.updateLayout({layerId:i.id,layout:{x:e[r].x,y:e[r].y}}),n.common.updateLayout({layerId:d[r].id,layout:{x:t[r].x,y:t[r].y}})})),n.transaction.commit()},this._onModelInitFinish=()=>{var e;null===(e=this._pageTitleView)||void 0===e||e.show()},this._createEditReportContext=()=>{ri.I.getInstance().createContext(Ne.pI)},this._getEditReportContext=()=>ri.I.getInstance().getContext(Ne.pI),this._pageEditContextInit=e=>{const t=this._getEditReportContext();t&&(t.layerIds=e.map((e=>e.id)))};const{containerRef:t,editor:i,state:r,dispatch:n,disableDraftSaveNextTime:a}=e;if(this._state=r,this._dispatch=n,this._editor=i,this._isBatch="editor-batch"===(0,ni.Cm)()||void 0,this._disableDraftSaveNextTime=a,!t.current)throw new Error("EditManager root container not exist.");this._createView(),this._factory=new ti({editRoot:this._editRoot,editor:i,state:this._state,dispatch:this._dispatch}),this.registerEvents(),this._createEditReportContext()}get currentEdit(){return this._currentEdit}get dispatch(){return this._dispatch}get state(){return this._state}get renderSDK(){return this._editor.getRenderSDK()}registerEvents(){const{events:e}=Pt.default;this._register(e.interact.onMaterialSelect.event(this.handleSelect)),this._register(e.interact.onMaterialSelectChange.event(this.handleSelectChange)),this._register(e.interact.onDeleteOutsideLayer.event(this.onDeleteOutsideLayer)),this._register(e.interact.onContextMenu.event(this.handleContextmenu)),this._register(e.interact.onPageScrollChange.event(this.onPageScrollChange)),this._register(e.interact.onPageZoomChange.event(this.onPageZoomChange)),this._register(e.textLayer.onNeedLayoutChange.event(this.onNeedLayoutChange)),this._register(e.interact.onDistanceMeasureStart.event(this.onDistanceMeasureStart)),this._register(e.interact.onDistanceMeasureEnd.event(this.onDistanceMeasureEnd)),this._register(e.stage.onFirstRenderReady.event(this.onFirstRenderReady)),this._register(e.appLayer.onDragCopyEvent.event(this.onDragCopyEvent)),this._register(this.renderSDK.onFullScreenChanged(this.onFullScreenChange))}unregisterEvents(){super.destroy()}destroy(){var e;this.unregisterEvents(),this.clearCurrentEdit(),this._editRoot.unmount(),null===(e=this._contextmenuView)||void 0===e||e.destroy()}updateEditorContext(e,t){var i;this._state=e,this._dispatch=t,null===(i=this._currentEdit)||void 0===i||i.updateContext(e,t)}clearCurrentEdit(){var e,t;null===(e=this._textEditView)||void 0===e||e.hide(),null===(t=this._currentEdit)||void 0===t||t.unmount(),delete this._currentEdit}_handleMultiSelect(e){var t,i;const{selectedList:r}=e;if(null===(t=this._toolbarView)||void 0===t||t.mountNormalTools(e),r.length<=1)return;const n=r.map((e=>e.id));if(this._currentEdit instanceof Vt&&(null===(i=this._currentEdit)||void 0===i?void 0:i.id)===Ht(n))return void this._currentEdit.effect();this.clearCurrentEdit();const a={idList:n};r.every((e=>e.type===Ne.Wq.TEXT))?this._currentEdit=this._factory.createMultiTextEdit(a):this._currentEdit=this._factory.createMultiEdit(a),this._editor.setEditInstance(this._currentEdit),this._currentEdit.mount()}async _createView(){const{events:e}=Pt.default;this._editRoot=(0,De.createRoot)(document.querySelector(`#${a.Fx}`)),await Promise.all(Object.keys(li).map((async e=>{const{getView:t,containerId:i}=li[e],r=(0,De.createRoot)(document.querySelector(`#${i}`)),n=(await t()).default;this[e]=new n(this._editor,r)}))),this._isViewReady=!0,this._selectQueue.forEach((e=>e())),this._selectQueue=[],this._editor.getGraphicSDK().modelInitFinish?this._onModelInitFinish():this._register(e.interact.onModelInitFinish.event(this._onModelInitFinish))}}const di=ci;var ui=i(28161),hi=i(83469),gi=i.n(hi);class pi{constructor(){this._hackHandlers=new Set,this.setScope(Ne.IB.Default)}unbindAll(){ui.Z.unbind()}unbind(e,t){ui.Z.unbind(e,t)}bind(e,t,i={}){const r=gi()(e)?e.toString():e,n=(...e)=>{[...this._hackHandlers].some((e=>!e(r)))||t(...e)};return(0,ui.Z)(r,{scope:Ne.IB.Default,...i},n),()=>{this.unbind(r,n)}}setScope(e){ui.Z.setScope(e)}getScope(){return ui.Z.getScope()}addHackHandler(e){this._hackHandlers.add(e)}deleteHackHandler(e){this._hackHandlers.delete(e)}clearHackHandler(){this._hackHandlers.clear()}}var mi=i(15770),_i=i(4547),vi=i(25222),fi=i(73842),yi=i(9561),bi=i(92202),xi=i(71942);class wi{constructor(e){this._keyEditor=e}get keyEditor(){return this._keyEditor}get editManager(){return this._keyEditor.editManager}get editor(){return this._keyEditor.editor}get renderSDK(){return this._keyEditor.renderSDK}get graphicSDK(){return this._keyEditor.graphicSDK}get rendererAccessors(){return this.renderSDK.accessors}existEditorEditMode(){const e=this.editor.getSuspendToolView();null!=e&&e.isCropping()&&(null==e||e.confirmCrop()),null!=e&&e.isReplacing()&&(null==e||e.closeReplace())}getSelectedIds(){return this.rendererAccessors.selection.getSelectedMaterials()}getPageIndex(){return this._keyEditor.editor.getRenderSDK().accessors.page.getActivePageIndex()}isPage(e){return this.rendererAccessors.page.isPage(e)}}var Si=i(61619);const Pi=e=>{const{layerData:t,offset:i,clickPos:r,page:n,renderSDK:a}=e;if(r){const e=t.reduce(((e,t)=>{const{x:i,y:r}=t.layout;return{x:Math.min(e.x,i),y:Math.min(e.y,r)}}),{x:Number.MAX_SAFE_INTEGER,y:Number.MAX_SAFE_INTEGER}),i={x:r.x-e.x,y:r.y-e.y};return{positions:t.map((e=>{const{x:t,y:r}=e.layout;return{x:t+i.x,y:r+i.y}})),offset:i}}if(!n||!a)return;let o=i;const{width:s,height:l}=(0,Ze.Ln)(n.dimension),c=a.accessors.page.getPageVisibleRect(),{x:d,y:u,width:h,height:g}=c;let p=!1;const m=[],_=[];return t.forEach(((e,t)=>{const{layout:r}=e,n={x:r.x+i.x,y:r.y+i.y},v=.02*s,f=.02*l,y={x:d+h/2-r.width*r.scale.x/2+v*t,y:u+g/2-r.height*r.scale.y/2+f*t};if(m.push(n),_.push(y),!p){const e=(0,Si.i)({...r,...n},{width:s,height:l});(0,si.US)({...r,...n},a,c)&&e||(p=!0,o={x:y.x-r.x,y:y.y-r.y})}})),{positions:p?_:m,offset:o}};var Ii=i(5821),Ci=i(47552),Ei=i(11467);class Di extends wi{constructor(e){super(e),this._disposeAppEventStore=new Be.S,this._offsetMap={},this._copyUUID="__capcut_copy_uuid_6f02fdb__",this.write=()=>{this._clearAllOffset();const e=this.editor.getSelectedMaterials().map((e=>e.id)),t=this._getPageIdByCopyLayerId(e[0]);this._clearOffset(t);const i=this.graphicSDK.api.document.getLayersByFilter(!1,(t=>e.includes(t.id))),r=(0,jt.cloneDeep)(i);this._generatorClipboardData({layerData:r})},this.read=async()=>{try{const e=await navigator.clipboard.read(),t=null==e?void 0:e[0],i=[];await Promise.all(null==t?void 0:t.types.map((async e=>{const r=await t.getType(e),n=await r.text();i.push([e,n])}))),this._processClipboardData(i)}catch(e){throw kt.t.error(e),new Error(e)}},this._getPageIdByCopyLayerId=e=>{var t;return null===(t=this.graphicSDK.document.getPageByChildLayerId(e))||void 0===t?void 0:t.id},this._clearOffset=e=>{e&&(this._offsetMap[e]={x:0,y:0})},this._clearAllOffset=()=>{Object.keys(this._offsetMap).forEach((e=>this._clearOffset(e)))},this._addOffset=e=>{var t,i,r,n;if(!e)return;const a=this.graphicSDK.document.pages.find((t=>t.id===e));if(!a)return;const o=(0,Ei.X)(a.dimension,1);this._offsetMap[e]={x:(null!==(t=null===(i=this._offsetMap[e])||void 0===i?void 0:i.x)&&void 0!==t?t:0)+o.xOffset,y:(null!==(r=null===(n=this._offsetMap[e])||void 0===n?void 0:n.y)&&void 0!==r?r:0)+o.yOffset}},this._subOffset=e=>{var t,i,r,n;if(!e)return;const a=this.graphicSDK.document.pages.find((t=>t.id===e));if(!a)return;const o=(0,Ei.X)(a.dimension,1);this._offsetMap[e]={x:(null!==(t=null===(i=this._offsetMap[e])||void 0===i?void 0:i.x)&&void 0!==t?t:0)-o.xOffset,y:(null!==(r=null===(n=this._offsetMap[e])||void 0===n?void 0:n.y)&&void 0!==r?r:0)-o.yOffset}},this._getActivePageLayers=()=>this.graphicSDK.api.common.getLayersByFilter(!1,((e,t)=>t.id===this.renderSDK.getActivePageId())),this._generatorClipboardData=async({layerData:e})=>{try{const{version:t}=this.graphicSDK.api.document.getDocumentMeta(),i=JSON.stringify(null!=e?e:[]),r=btoa(unescape(encodeURIComponent(i))),n=`\n          <div id=${mi.aE}>\n            <span ${mi.Bj.MetaVersion}=${t}></span>\n            <span ${mi.Bj.ClipboardVersion}=${mi.rh}></span>\n            <span ${mi.Bj.LayerData}=${r}></span>\n          </div>\n        `;if(void 0!==navigator.clipboard.write){const e=new Blob([n],{type:mi.EB.HTMLType});await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}else await navigator.clipboard.writeText(this._copyUUID+n)}catch(t){throw kt.t.error(t),new Error(t)}},this._cutHandler=(e,t)=>{const i=this.graphicSDK.document.pages[this.renderSDK.getActivePageIndex()],r=(e,t)=>{e.type===Ne.F5.SHAPE?this.graphicSDK.api.shape.add(i.id,e.paths,{...e,layout:{...e.layout,...t},id:void 0}):this.graphicSDK.api.line.add(i.id,{source:e.source},e.attr,{...e.layout,...t},e.title,{...e.extra,id:void 0})},n=(e,t)=>{const{layout:r}=e;this.graphicSDK.api.shape.add(i.id,e.text,{...e,layout:{...r,...t},id:void 0})},a=(e,t)=>{const r={...e.layout,...t};this.graphicSDK.api.image.add(i.id,e.src,r,{...e,layout:r,id:void 0})},o=(e,t)=>{const r={...e.layout,...t},{effectFilters:n,extra:a,filter:o}=e;this.graphicSDK.api.svgImage.add(i.id,e.src,e.colors,r,{effectFilters:n,extra:a,filter:o})},s=(e,t)=>{this.graphicSDK.api.imageContainer.add(i.id,{...e,layout:{...e.layout,...t},id:void 0})},l=(e,t)=>{this.graphicSDK.api.grid.add(i.id,{...e},{layout:{...e.layout,...t},id:void 0})},c=(e,t)=>{e.children.forEach((e=>{this._cutHandler([e],[{x:e.layout.x+this._offsetMap[i.id].x,y:e.layout.y+this._offsetMap[i.id].y}])}));const r=this._getActivePageLayers().slice(-e.children.length).map((e=>e.id));this.graphicSDK.api.group.group(r);const n=this._getActivePageLayers().slice(-1).map((e=>e.id))[0];this.graphicSDK.api.common.updateLayout({layerId:n,layout:{...t,scale:e.layout.scale,rotation:e.layout.rotation,opacity:e.layout.opacity}})};e.forEach(((e,i)=>{switch(e.type){case Ne.F5.SHAPE:case Ne.F5.LINE:r(e,t[i]);break;case Ne.F5.TEXT:n(e,t[i]);break;case Ne.F5.IMAGE:a(e,t[i]);break;case Ne.F5.SVG_IMAGE:o(e,t[i]);break;case Ne.F5.IMAGE_CONTAINER:s(e,t[i]);break;case Ne.F5.GRID:l(e,t[i]);break;case Ne.F5.GROUP_LAYER:c(e,t[i])}}))},this._pasteEventHandler=e=>{const{editorType:t}=this.editor.getDependence();if(t===vi.gg.EditorPC)return void fi.Z.warning(h.ZP.t("web_graphic_cover_toast_right_duplicate",void 0,"Shortcuts are currently unavailable. Right click to duplicate."));const{clipboardData:i}=e;if(!i)return;const r=e.target;if(r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement)return;const n=[],a=[];for(const o of i.items)if(o.kind===mi.EB.File){const e=o.getAsFile();a.push([mi.EB.File,e])}else{const e=new Promise((e=>{const t=["",null];t[0]=o.type,o.getAsString((i=>{i.startsWith(this._copyUUID)?(t[0]=mi.EB.HTMLType,t[1]=i.slice(this._copyUUID.length)):t[1]=i,a.push(t),e()}))}));n.push(e)}Promise.all(n).then((()=>{this._processClipboardData(a,mi.zn.ShortKey)}))},this._handleHTMLType=async(e,t)=>{var i;const{layerData:r,metaVersion:n,clipboardVersion:a}=this._getLayerIdByClipboard(e);if(n!==this.graphicSDK.api.document.getDocumentMeta().version)return;if(a!==mi.rh)return;if(null!=r&&r.length){await this._preloadResources(r),this.graphicSDK.api.transaction.begin();const e=this.graphicSDK.document.pages[this.renderSDK.getActivePageIndex()];this._addOffset(e.id);let i=[];if(t===mi.zn.ShortKey){const t=Pi({layerData:r,offset:this._offsetMap[e.id],page:e,renderSDK:this.renderSDK});t&&(i=[...t.positions],this._offsetMap[e.id]=t.offset)}else{var o,s;const t=Pi({layerData:r,offset:this._offsetMap[e.id],clickPos:null!==(o=null===(s=this._keyEditor.editor.getContextmenuView())||void 0===s?void 0:s.position)&&void 0!==o?o:{x:0,y:0}});t&&(i=[...t.positions],this._offsetMap[e.id]=t.offset)}this._cutHandler(r,i),this.graphicSDK.api.transaction.commit()}const l=null!==(i=null==r?void 0:r.map((e=>e.id)))&&void 0!==i?i:[];t===mi.zn.ShortKey&&(0,J.c_)(l,v.B$.PASTE,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex())},this._handleTextType=(e,t)=>{if(!e||/^[ \t\r\n]*$/.test(e))return;const i=(0,Ii.Gu)(this.renderSDK.accessors.page.getDimension()).find((e=>e.textKey===vi._d.headline_3));i.text=e;const{defaultFontSetting:r}=this.editor.getDependence(),a={type:xi.P.Text,data:{...i,...r,color:[0,0,0,1],lineMaxWidth:1}},o=this._getSelectedLayerTypes();1===o.length&&o[0]===Ne.F5.TEXT||this.rendererAccessors.text.getLayoutInfoByText(a.data).then((e=>{if(!e)return;const{innerBoundWidth:t,innerBoundHeight:i,outerBoundWidth:r,outerBoundHeight:o}=e;Object.assign(a.data,{defaultHeight:i,textOuterRect:{width:a.data.defaultWidth+r-t,height:o}}),this.editor.getPlugin().onLoadMaterialClick(a,{triggerType:n.$u.OuterPaste,extraParams:{isFromCapcut:!1}})}))},this._handleFilesType=e=>{const{editor:t}=this,i=this._addImageToPage;(0,yi.l_)({files:[e],accepted(r){t.getUploadMaterialInProject()({file:e,isSwitchToUploadPanel:!0,meta:{actionType:_i.lJ.PASTE,position:_i.Rz.MATERIAL}}).then((e=>{e.ok&&i(e.pair()[1])}))},rejected(e){fi.Z.error(h.ZP.t("file_types_not_supported_by_{placeholder0}",{placeholder0:e.name},"{placeholder0} \u4e0d\u652f\u6301\u7684\u6587\u4ef6\u7c7b\u578b"))}})},this._addImageToPage=async e=>{try{const{buffer:t,contentType:i}=await(0,bi.V)({url:e.cover,key:e.coverKey}),r=new Blob([t],{type:i||"image/*"}),a=window.URL.createObjectURL(r),o=Ut.fc.getInstance().parser.everCloud.fetchData({id:e.md5,resourceId:e.md5,type:Ne.xP.EverCloud,previewUrl:a,fileUrl:{md5:e.md5,url:e.url},aesKey:e.coverKey,transcode:e.transcode}),s=(await o).content,l={type:xi.P.EverImage,sourceRect:{width:e.width,height:e.height},data:{id:e.md5,md5:e.md5,name:e.name,resContent:s,resourceId:e.md5,sourceFrom:"project",width:e.width,height:e.height}};this.editor.getPlugin().onLoadMaterialClick(l,{triggerType:n.$u.ShortKey,extraParams:{isFromCapcut:!1,triggerType:n.$u.OuterPaste}})}catch(t){throw kt.t.error(t),t}},this._isExecCommandAvailable=Boolean(document.queryCommandSupported("copy"))}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,window.addEventListener("paste",this._pasteEventHandler),this._disposeAppEventStore.add((()=>window.removeEventListener("paste",this._pasteEventHandler))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.CtrlD,(e=>{e.preventDefault(),this._clearAllOffset();const t=this._getSelectedLayerIds(),i=(0,si.ZB)(t,this.graphicSDK,this.renderSDK),r=t.map((e=>({layerId:e,position:i[e]})));this.graphicSDK.api.common.copy(...r)}))),this._disposeAppEventStore.add(this.keyEditor.bind([mi.xs.CtrlX,mi.xs.CtrlC],(e=>{e.preventDefault();const{editorType:t}=this.editor.getDependence();if(t===vi.gg.EditorPC)return void fi.Z.warning(h.ZP.t("web_graphic_cover_toast_right_duplicate",void 0,"Shortcuts are currently unavailable. Right click to duplicate."));const i=this.editor.getSelectedMaterials().map((e=>e.id)),r=i.filter((e=>{var t;return!(null!==(t=this.rendererAccessors.layer.getBatchEditorMainLayerInfoByLayerId(e))&&void 0!==t&&t.isMainLayer)}));if(r.length!==i.length)return void fi.Z.info({id:"batch-cut",content:h.ZP.t("web_smart_tools_text_current_replace_failure",{},"Can\u2019t delete or replace image currently")});this._clearAllOffset(),(0,J.c_)(this._getSelectedLayerIds(),v.B$.COPY,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex());const n=this.graphicSDK.api.document.getLayersByFilter(!1,(e=>i.includes(e.id))),a=(0,jt.cloneDeep)(n),o=this._getPageIdByCopyLayerId(i[0]);this._clearOffset(o),"x"===e.key&&(this.graphicSDK.api.common.remove(...r),this._subOffset(o)),this._generatorClipboardData({layerData:a})}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}_getSelectedLayerIds(){return this.rendererAccessors.selection.getSelectedMaterials().filter((e=>this.rendererAccessors.layer.getLayerById(e)))}_getSelectedLayerTypes(){return this.rendererAccessors.selection.getSelectedMaterials().map((e=>{var t;return null===(t=this.rendererAccessors.layer.getLayerById(e))||void 0===t?void 0:t.type})).filter((e=>e))}_getLayerIdByClipboard(e){var t,i,r,n,a,o;const s=(new DOMParser).parseFromString(e,mi.EB.HTMLType).getElementById(mi.aE),l=null!==(t=null==s||null===(i=s.querySelector(`span[${mi.Bj.MetaVersion}]`))||void 0===i?void 0:i.getAttribute(mi.Bj.MetaVersion))&&void 0!==t?t:"",c=null!==(r=null==s||null===(n=s.querySelector(`span[${mi.Bj.ClipboardVersion}]`))||void 0===n?void 0:n.getAttribute(mi.Bj.ClipboardVersion))&&void 0!==r?r:"",d=null!==(a=null==s||null===(o=s.querySelector(`span[${mi.Bj.LayerData}]`))||void 0===o?void 0:o.getAttribute(mi.Bj.LayerData))&&void 0!==a?a:"[]",u=decodeURIComponent(escape(atob(d)));return{clipboardVersion:c,metaVersion:l,layerData:JSON.parse(u)}}async _preloadResources(e){let t=!1;e.forEach((e=>{var i;e.type===Ne.F5.TEXT&&(null!==(i=e.glow)&&void 0!==i&&i.enable&&(t=!0))})),t&&await(0,Ci.d)()}_processClipboardData(e,t){var i;if(!(null===(i=this._getActivePageLayers())||void 0===i?void 0:i.length)){const e=this.renderSDK.getActivePageId();this._clearOffset(e)}for(const[r,n]of e)switch(r){case mi.EB.HTMLType:this._handleHTMLType(n,t);break;case mi.EB.TextType:this._handleTextType(n,t);break;case mi.EB.File:this._handleFilesType(n)}}}Di.controllerName="copy";var Ai=i(91372),Li=i(60110);class ki extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Delete,(()=>{this.deleteBySelected()}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}deleteBySelected(){const e=this.rendererAccessors.selection.getSelectedMaterials();if(1===e.length&&this.isPage(e[0]))return this._handleDeletePage(e[0]);const t=[];e.forEach((e=>{const i=this.rendererAccessors.layer.getLayerById(e);if(i)switch(i.type){case Ne.F5.IMAGE:case Ne.F5.SVG_IMAGE:case Ne.F5.SHAPE:case Ne.F5.LINE:case Ne.F5.IMAGE_CONTAINER:case Ne.F5.GRID:case Ne.F5.TEXT:case Ne.F5.GROUP_LAYER:t.push(e)}})),e.length>0&&(0,J.c_)(e,v.B$.DELETE,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex());const i=t.filter((e=>{var t;return!(null!==(t=this.rendererAccessors.layer.getBatchEditorMainLayerInfoByLayerId(e))&&void 0!==t&&t.isMainLayer)}));i.length===t.length?this._beforeDoMultiDelete(...t)||this._doMultiDelete(...i):fi.Z.info({id:"batch-replace",content:h.ZP.t("web_smart_tools_text_current_replace_failure",{},"Can\u2019t delete or replace image currently")})}_handleDeletePage(e){const t=this.rendererAccessors.page.hasBackgroundImage(e),i=this.rendererAccessors.page.getBackgroundColor(e),r=i&&(0,Ai.aj)(i,Li.GL)&&(0,Ai.aj)(i,Li.QR);t?this.graphicSDK.api.page.removeBackgroundImage(e):r?this.graphicSDK.api.page.updateBackgroundColor(e,Li.GL):this.renderSDK.getAllPages().length>1&&this.graphicSDK.api.page.delete([e])}_doMultiDelete(...e){this.graphicSDK.api.common.remove(...e)}_beforeDoMultiDelete(...e){return!!this._beforeDoMultiDeleteToImageContainer(...e)}_beforeDoMultiDeleteToImageContainer(...e){if(1!==e.length)return!1;const t=e[0],i=this.rendererAccessors.layer.getLayerById(t);if(!i)return!1;if(i.type===Ne.F5.IMAGE_CONTAINER){const e=this.rendererAccessors.imageContainer,i=e.getImageContainerWidget(t);if(!i)return!1;const r=i.getSelectIndex();if(r===Ne.ch)return!1;if(e.hasFillImage(t,r))return this.graphicSDK.api.imageContainer.clearFillImage(t,r),!0}if(i.type===Ne.F5.GRID){const e=this.rendererAccessors.grid,i=e.getGridWidget(t);if(!i)return!1;const r=i.getSelectedAreaIndex();if(r===Ne.q6)return!1;if(e.getSelectImageByIndex(t,r)){const i=e.getGridAreaIdByIndex(t,r);return void 0!==i&&(this.graphicSDK.api.grid.clearGridFill(t,i),!0)}}return!1}}ki.controllerName="delete";class Ri extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Esc,(e=>{this.existEditorEditMode()}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Ri.controllerName="esc";class Mi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}get _activePageIndex(){return this.rendererAccessors.page.getActivePageIndex()}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Group,(e=>{var t;e.preventDefault();const i=null!==(t=this.editManager.currentEdit)&&void 0!==t?t:{};if(!(i instanceof $t)){const e=i.idList.map((e=>e)),t=this.renderSDK.accessors.layer.getMaterialsSelectRectForModel(e);(0,Gt.r4)(e,Gt.$6.Group,v.l5.ShortKey,this._activePageIndex),this.graphicSDK.api.group.group(e,t)}}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.UnGroup,(e=>{var t;e.preventDefault();const i=null!==(t=this.editManager.currentEdit)&&void 0!==t?t:{};if(i instanceof $t){var r;const e=this.renderSDK.accessors.layer.getLayerById(i.id);null!=e&&null!==(r=e.extra)&&void 0!==r&&r.resourceId&&Ut.fc.removePreviewUrl(e.extra.resourceId),(0,Gt.r4)([i.id],Gt.$6.Ungroup,v.l5.ShortKey,this._activePageIndex),this.graphicSDK.api.group.unGroup(i.id)}}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Mi.controllerName="group";const Ti=(e,t,i)=>t.every((e=>ui.Z[e]))&&e.code===i;class ji extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S,this._layerMoveHandler=e=>{var t,i,r;const n=null!==(t=this.keyEditor.editManager.currentEdit)&&void 0!==t?t:{};if(n instanceof $t){var a,o,s;const t=null!==(a=n.subId)&&void 0!==a?a:n.id;if((null!==(o=null===(s=n.getLayerDisabledLevelOptions)||void 0===s?void 0:s.call(n,t))&&void 0!==o?o:[]).includes(e))return;return this.graphicSDK.api.common.updatePosition(e,t),void(0,J.B$)(t,e,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex())}(null!==(i=null===(r=n.getLayerDisabledLevelOptions)||void 0===r?void 0:r.call(n))&&void 0!==i?i:[]).includes(e)||(n instanceof Wt?(this.graphicSDK.api.common.updatePosition(e,n.id),(0,J.B$)(n.id,e,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex())):n instanceof Vt&&(null==n||n.onUpdateMultiLayerPosition(e)))}}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.SendBackward,(e=>{e.preventDefault(),this._layerMoveHandler(Ne.l7.SEND_BACKWARD)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.BringForward,(e=>{e.preventDefault(),this._layerMoveHandler(Ne.l7.BRING_FORWARD)}))),this._disposeAppEventStore.add(this.keyEditor.bind("*",(e=>{Ti(e,["option",g.t.MacOS?"command":"ctrl"],"BracketLeft")&&(e.preventDefault(),this._layerMoveHandler(Ne.l7.SEND_TO_BACK)),Ti(e,["option",g.t.MacOS?"command":"ctrl"],"BracketRight")&&(e.preventDefault(),this._layerMoveHandler(Ne.l7.BRING_TO_FRONT))}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}ji.controllerName="levelMove";class Ni extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind([mi.xs.Up,mi.xs.Down,mi.xs.Left,mi.xs.Right,mi.xs.ShiftUp,mi.xs.ShiftDown,mi.xs.ShiftLeft,mi.xs.ShiftRight,mi.xs.AltUp,mi.xs.AltDown,mi.xs.AltLeft,mi.xs.AltRight,mi.xs.AltShiftUp,mi.xs.AltShiftDown,mi.xs.AltShiftLeft,mi.xs.AltShiftRight],((e,t)=>{e.preventDefault(),this._updateMaterialPosition(t.key),this._handleGuideLineDraw()}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}_handleGuideLineDraw(){this._guideLineShowTimer&&(clearTimeout(this._guideLineShowTimer),this._guideLineShowTimer=void 0);this.rendererAccessors.page.drawGuideLine([Ne.ul.VERTICAL_LINE,Ne.ul.HORIZONTAL_LINE,Ne.ul.PAGE_MARGIN_LINE,Ne.ul.RULER_LINE,Ne.ul.HORIZONTAL_ISOMETRIC_LINE,Ne.ul.VERTICAL_ISOMETRIC_LINE],.5)&&(this._guideLineShowTimer=window.setTimeout((()=>{this.rendererAccessors.page.removeGuideLines()}),500))}_updateMaterialPosition(e){const t=e.includes("shift")?10:1,i=this.rendererAccessors.selection.getSelectedMaterials();if(null==i||!i.length)return;(0,J.oT)(i,v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex());const r=(e,t)=>{this.rendererAccessors.layer.moveLayers(i.filter((e=>!this.isPage(e))).map((i=>({id:i,["x"===e?"offsetX":"offsetY"]:t}))))};switch(e){case mi.xs.Up:case mi.xs.AltUp:case mi.xs.ShiftUp:case mi.xs.AltShiftUp:r("y",-t);break;case mi.xs.Down:case mi.xs.AltDown:case mi.xs.ShiftDown:case mi.xs.AltShiftDown:r("y",t);break;case mi.xs.Left:case mi.xs.AltLeft:case mi.xs.ShiftLeft:case mi.xs.AltShiftLeft:r("x",-t);break;case mi.xs.Right:case mi.xs.AltRight:case mi.xs.ShiftRight:case mi.xs.AltShiftRight:r("x",t)}this.graphicSDK.api.common.updateLayout()}}Ni.controllerName="moveLayer";class Bi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.Move],(()=>_.Z.interact.onMoveModeChange.fire(Ne.Ll.Mouse)))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.HandTool],(()=>_.Z.interact.onMoveModeChange.fire(Ne.Ll.Hand)))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Bi.controllerName="pageMove";class Zi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.CtrlA,(e=>{e.preventDefault(),this.rendererAccessors.selection.triggerSelectionAll()}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Zi.controllerName="select";class Oi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Space,(e=>{e.preventDefault();const t=this.renderSDK.accessors.page.getPageDragEnable();"keydown"===e.type?t||_.Z.interact.onMoveModeChange.fire(Ne.Ll.Hand):t&&_.Z.interact.onMoveModeChange.fire(Ne.Ll.Mouse)}),{keydown:!0,keyup:!0})))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Oi.controllerName="space";var Ki=i(59669);class Fi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.CtrlZ,(e=>{e.preventDefault(),this.graphicSDK.api.undoRedo.canUndo()&&((0,Ki.WX)(Ki.fu.Undo,v.l5.ShortKey,this.getPageIndex()),this.graphicSDK.api.undoRedo.undo(),this.existEditorEditMode())}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.CtrlY,(e=>{e.preventDefault(),this.graphicSDK.api.undoRedo.canRedo()&&((0,Ki.WX)(Ki.fu.Redo,v.l5.ShortKey,this.getPageIndex()),this.graphicSDK.api.undoRedo.redo(),this.existEditorEditMode())}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Fi.controllerName="undoRedo";var Gi=i(21399);class Ui extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){if(this._isBindAppEvent)return;this._isBindAppEvent=!0;const e=100*Ne.Qf.MIN,t=100*Ne.Qf.MAX,i=()=>{const{x:t}=this.renderSDK.accessors.page.getZoom(),i=Math.max(e,Math.round(100*t)-10);this.renderSDK.accessors.page.setZoom({scale:i,isFit:!1}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex()),(0,Gi.hf)(v.fK.SHORTKEY_ZOOMOUT,i)},r=()=>{const{x:e}=this.renderSDK.accessors.page.getZoom(),i=Math.min(t,Math.round(100*e)+10);this.renderSDK.accessors.page.setZoom({scale:i,isFit:!1}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex()),(0,Gi.hf)(v.fK.SHORTKEY_ZOOMIN,i)};this._disposeAppEventStore.add(this.keyEditor.bind("*",(e=>{const t=g.t.MacOS?e.metaKey:e.ctrlKey;(e.shiftKey||t)&&"Minus"===e.code&&i(),(e.shiftKey||t)&&"Equal"===e.code&&r()}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.ZoomToFit,(e=>{e.preventDefault(),this.renderSDK.accessors.page.setZoom({isFit:!0}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex());const t=this.renderSDK.accessors.page.getZoom().x;(0,Gi.hf)(v.fK.SHORTKEY_FIT,t)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.ZoomTo50,(e=>{e.preventDefault(),this.renderSDK.accessors.page.setZoom({isFit:!1,scale:50}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex()),(0,Gi.hf)(v.fK.SHORTKEY_50,50)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.ZoomTo100,(e=>{e.preventDefault(),this.renderSDK.accessors.page.setZoom({isFit:!1,scale:100}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex()),(0,Gi.hf)(v.fK.SHORTKEY_100,100)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.ZoomTo200,(e=>{e.preventDefault(),this.renderSDK.accessors.page.setZoom({isFit:!1,scale:200}),(0,Ki.WX)(Ki.fu.Zoom,v.l5.ShortKey,this.getPageIndex()),(0,Gi.hf)(v.fK.SHORTKEY_200,200)})))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}Ui.controllerName="zoom";var Hi=i(90200);class Vi extends wi{constructor(e){super(e),this.bind=()=>{const e=document.getElementById(dn);null==e||e.addEventListener("wheel",this._wheelScrollHandler,{passive:!1})},this.unBind=()=>{const e=document.getElementById(dn);null==e||e.removeEventListener("wheel",this._wheelZoomHandler)},this._wheelZoomHandler=e=>{if(e.target instanceof HTMLCanvasElement)return;const t=this.renderSDK.stage.dom.getBoundingClientRect(),i=e.clientX,r=e.clientY;if(i>=t.left&&i<=t.right&&r>=t.top&&r<=t.bottom){const t=(0,Hi.Qg)(e);[Hi.Ib.Inside,Hi.Ib.Outside].includes(t)&&_.Z.canvas.wheel.fire({evt:e})}(e.deltaX>20||e.deltaX<-20)&&e.preventDefault()},this._wheelScrollHandler=e=>{if(e.target instanceof HTMLCanvasElement)return;if(e.target.closest(".is-scroll-y"))return;const t=this.renderSDK.stage.dom.getBoundingClientRect(),i=e.clientX,r=e.clientY;i>=t.left&&i<=t.right&&r>=t.top&&r<=t.bottom&&_.Z.canvas.wheel.fire({evt:e})},window.addEventListener("wheel",this._wheelZoomHandler,{passive:!1})}}Vi.controllerName="wheel";var zi=i(15190),Wi=i(98585);class $i extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._alignBindHandler())}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}_alignBindHandler(){const e=()=>{const e=this.getSelectedIds();return e.length>=1?e:void 0},t=t=>{const i=e(),{userOperationManager:r}=this.editor;i&&r.add(t(i))},i=[{shortKey:mi.xs.AlignLeft,getOperation:e=>e.length>1?new zi.Ni(e):new zi.wg(e)},{shortKey:mi.xs.AlignCenter,getOperation:e=>e.length>1?new zi.Un(e):new zi.fh(e)},{shortKey:mi.xs.AlignRight,getOperation:e=>e.length>1?new zi.EL(e):new zi.kb(e)},{shortKey:mi.xs.AlignTop,getOperation:e=>e.length>1?new zi.vI(e):new zi.Jj(e)},{shortKey:mi.xs.AlignMiddle,getOperation:e=>e.length>1?new zi.EM(e):new zi.t_(e)},{shortKey:mi.xs.AlignBottom,getOperation:e=>e.length>1?new zi.pq(e):new zi.mC(e)},{shortKey:mi.xs.AlignDistributeHorizontal,getOperation:e=>new Wi.s(e)},{shortKey:mi.xs.AlignDistributeVertical,getOperation:e=>new Wi.D(e)}],r={[mi.xs.AlignLeft]:v.B$.ALIGN_LEFT,[mi.xs.AlignCenter]:v.B$.ALIGN_CENTER,[mi.xs.AlignRight]:v.B$.ALIGN_RIGHT,[mi.xs.AlignTop]:v.B$.ALIGN_TOP,[mi.xs.AlignMiddle]:v.B$.ALIGN_MIDDLE,[mi.xs.AlignBottom]:v.B$.ALIGN_BOTTOM,[mi.xs.AlignDistributeHorizontal]:v.B$.ALIGN_DISTRIBUTE_HORIZONTAL,[mi.xs.AlignDistributeVertical]:v.B$.ALIGN_DISTRIBUTE_VERTICAL};i.forEach((e=>this._disposeAppEventStore.add(this.keyEditor.bind(e.shortKey,(()=>{(0,J.nl)(r[e.shortKey],v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex()),t(e.getOperation)})))))}}$i.controllerName="align";class Yi extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._flipBindHandler())}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}_getSelectedId(){const e=this.rendererAccessors.selection.getSelectedMaterials();if(1===e.length)return e[0]}_flipBindHandler(){const e=[{shortKey:mi.xs.ShiftFlipHorizontal,operation:e=>{this.renderSDK.accessors.page.isPage(e)?this.graphicSDK.api.page.bgImageFlipHorizontal(this.renderSDK.accessors.page.getActivePageId()):this.graphicSDK.api.common.flipHorizontal(e)}},{shortKey:mi.xs.ShiftFlipVertical,operation:e=>{this.renderSDK.accessors.page.isPage(e)?this.graphicSDK.api.page.bgImageFlipVertical(this.renderSDK.accessors.page.getActivePageId()):this.graphicSDK.api.common.flipVertical(e)}}],t={[mi.xs.ShiftFlipHorizontal]:v.B$.FLIP_HORIZONTAL,[mi.xs.ShiftFlipVertical]:v.B$.FLIP_VERTICAL};e.forEach((e=>this._disposeAppEventStore.add(this.keyEditor.bind(e.shortKey,(()=>{const i=this._getSelectedId();i&&((0,J.If)(t[e.shortKey],v.l5.ShortKey,this.rendererAccessors.page.getActivePageIndex()),e.operation(i))})))))}}Yi.controllerName="flip";var Xi=i(9011),qi=i(30816),Ji=i(41074),Qi=i(75834);class er extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S,this._isBindAppEvent=!1,this._init=()=>(this._isBindAppEvent=!0,()=>this._isBindAppEvent=!1),this._addText=()=>{const e=(0,Ii.Gu)(this.rendererAccessors.page.getDimension()).find((e=>e.textKey===vi._d.headline_3)),{defaultFontSetting:t}=this.editor.getDependence(),i={type:xi.P.Text,data:{...e,...t,text:h.ZP.t("web_graphic_text_material_regular_text",{},"Add body text")}};this.editor.getPlugin().onLoadMaterialClick(i,{triggerType:n.$u.ShortKey})},this._addRectangle=()=>{(0,Ei.n)({graphicSDK:this.graphicSDK,environmentService:this.editor.getDependence().environmentService,storageService:this.editor.getDependence().storageService,renderSDK:this.renderSDK,sourceData:this._fillSvgContent(Xi.X),sourceType:xi.P.Shape,triggerType:n.$u.ShortKey})},this._addLine=()=>{(0,Ei.n)({graphicSDK:this.graphicSDK,environmentService:this.editor.getDependence().environmentService,storageService:this.editor.getDependence().storageService,renderSDK:this.renderSDK,sourceData:this._fillSvgContent(qi.X),sourceType:xi.P.Line,triggerType:n.$u.ShortKey})},this._addCircle=()=>{(0,Ei.n)({graphicSDK:this.graphicSDK,environmentService:this.editor.getDependence().environmentService,storageService:this.editor.getDependence().storageService,renderSDK:this.renderSDK,sourceData:this._fillSvgContent(Ji.A),sourceType:xi.P.Line,triggerType:n.$u.ShortKey})},this._addArrow=()=>{(0,Ei.n)({graphicSDK:this.graphicSDK,environmentService:this.editor.getDependence().environmentService,storageService:this.editor.getDependence().storageService,renderSDK:this.renderSDK,sourceData:this._fillSvgContent(Qi.J),sourceType:xi.P.Line,triggerType:n.$u.ShortKey})}}bind(){this._isBindAppEvent||(this._disposeAppEventStore.add(this._init()),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.ShowOrHidePanel],(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.ShowOrHidePanel)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.ViewShortcutList],(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.ViewShortcutList)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.ShowOrHidePagePanel],(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.ShowOrHidePagePanel)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.CtrlD,(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.DuplicatePage)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Delete,(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.DeletePage)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Left,(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.PreviousPage)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.Right,(()=>{_.Z.appLayer.onGlobalHotKeyEvent.fire(p.b.NextPage)}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.InsertText],(()=>{this._addText()}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.InsertRectangle],(()=>{this._addRectangle()}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.InsertCircle],(()=>{this._addCircle()}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.InsertLine],(()=>{this._addLine()}))),this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs[p.b.InsertArrow],(()=>{this._addArrow()}))))}unBind(){this._disposeAppEventStore.clear()}_fillSvgContent(e){const{md5:t}=e.data,i=this.editor.getDependence().getSvgByMd5(t);return e.data.svgContent=null!=i?i:"",e}}er.controllerName="globalKey";var tr=i(24657);class ir extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S,this._isBindAppEvent=!1,this._init=()=>(this._isBindAppEvent=!0,()=>this._isBindAppEvent=!1),this._handler=async e=>{const t=this.editManager.currentEdit;if(!t)return;const i=await t.getTextModel(),r=g.t.MacOS?e.metaKey:e.ctrlKey,n=e.key.toLowerCase(),a={b:{bold:!i.bold},i:{italic:!i.italic},u:{underline:!i.underline}};(n in a&&r||n in a&&e.shiftKey&&r)&&(t.triggerTextParamsChange(a[n],!0,!1,!0),e.preventDefault());const o={l:tr.Z.left,e:tr.Z.center,r:tr.Z.right};n in o&&e.shiftKey&&r&&(t.triggerTextParamsChange({align:o[n]},!0,!1,!0),e.preventDefault())}}bind(){this.editManager.currentEdit instanceof zt&&!this._isBindAppEvent&&(this._disposeAppEventStore.add(this._init()),window.addEventListener("keydown",this._handler,!0),this._disposeAppEventStore.add((()=>window.removeEventListener("keydown",this._handler,!0))))}unBind(){this._disposeAppEventStore.clear()}}ir.controllerName="text";class rr extends wi{constructor(){super(...arguments),this._disposeAppEventStore=new Be.S}bind(){this._isBindAppEvent||(this._isBindAppEvent=!0,this._disposeAppEventStore.add(this.keyEditor.bind(mi.xs.ShowRulers,(e=>{var t;e.preventDefault();const i=!this.renderSDK.accessors.page.getRulerFeature().getVisible();null===(t=this.editor.getRulerView())||void 0===t||t.setRulerVisible(i);const r=this.getPageIndex();(0,Ki.WX)(i?Ki.fu.ShowRulers:Ki.fu.HideRulers,v.l5.ShortKey,r)}))))}unBind(){this._isBindAppEvent=!1,this._disposeAppEventStore.clear()}}rr.controllerName="rpm";const nr=[Di,ki,Ri,Mi,ji,Ni,Bi,Zi,Oi,Fi,Ui,Vi,$i,Yi,er,ir,rr];const ar=new class extends pi{constructor(){super(),this.register=()=>{this._controllerStore.forEach((e=>e.controller.bind()))},this.unRegister=()=>{this._controllerStore.forEach((e=>e.controller.unBind()))},this._preventDefaultKeys=()=>{this.bind(mi.xs.ZoomIn,(function(e){e.preventDefault()})),this.bind(mi.xs.ZoomOut,(function(e){e.preventDefault()})),this.bind(mi.xs.CtrlA,(function(e){e.preventDefault()})),this.bind(mi.xs.SendBackward,(function(e){e.preventDefault()})),this.bind(mi.xs.BringForward,(function(e){e.preventDefault()}))},this._preventDefaultKeys(),super.addHackHandler(this._moveModeIdentify.bind(this)),super.addHackHandler(this._selectedLayerLockedIdentify.bind(this))}get renderSDK(){return this._editor.getRenderSDK()}get graphicSDK(){return this._editor.getGraphicSDK()}get editManager(){return this._editManager}get editor(){return this._editor}init(e){let t;e.editManager?(this._editManager=e.editManager,t=nr):t=[Ui,Bi,rr],this._editor=e.editor,this._editor.setKeyEditor(this),this._controllerStore=t.map((e=>({name:e.controllerName,controller:new e(this)}))),this.register()}getCopyController(){var e;return null===(e=this._controllerStore.find((e=>e.name===Di.controllerName)))||void 0===e?void 0:e.controller}getTextController(){var e;return null===(e=this._controllerStore.find((e=>e.name===ir.controllerName)))||void 0===e?void 0:e.controller}_selectedLayerLockedIdentify(e){const t=this.renderSDK.accessors.selection.getSelectedMaterials();if(this.renderSDK.accessors.layer.isLocked(t)){const t=[mi.xs.CtrlX,mi.xs.CtrlC].join(","),i=[mi.xs.Up,mi.xs.Down,mi.xs.Left,mi.xs.Right,mi.xs.ShiftUp,mi.xs.ShiftDown,mi.xs.ShiftLeft,mi.xs.ShiftRight,mi.xs.AltUp,mi.xs.AltDown,mi.xs.AltLeft,mi.xs.AltRight,mi.xs.AltShiftUp,mi.xs.AltShiftDown,mi.xs.AltShiftLeft,mi.xs.AltShiftRight].join(",");if([t,mi.xs.CtrlD,mi.xs.SendBackward,mi.xs.SendToBack,mi.xs.BringForward,mi.xs.BringToFront,i,mi.xs.ShiftFlipHorizontal,mi.xs.ShiftFlipVertical,mi.xs.Delete,mi.xs.Group,mi.xs.UnGroup,mi.xs.AlignLeft,mi.xs.AlignCenter,mi.xs.AlignRight,mi.xs.AlignTop,mi.xs.AlignMiddle,mi.xs.AlignBottom,mi.xs.AlignDistributeHorizontal,mi.xs.AlignDistributeVertical].includes(e))return!1}return!0}_moveModeIdentify(e){if(this.renderSDK.accessors.page.getPageDragEnable()){if(![mi.xs[p.b.Move],mi.xs[p.b.HandTool],mi.xs.ShowRulers,mi.xs.Space].includes(e))return!1}return!0}};var or=i(59126),sr=i(22821);const lr=({onClose:e})=>(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("span",{children:(0,f.jsx)(Xe.Z,{className:"confirm-btn",size:"small",onClick:()=>e(),children:h.ZP.t("web_guide_button_got_it",{},"Got it")})})});var cr;!function(e){e[e.GUIDE_ONE=0]="GUIDE_ONE",e[e.GROUP=1]="GROUP",e[e.LAYER_LEVEL=2]="LAYER_LEVEL"}(cr||(cr={}));const dr={[cr.GROUP]:"guide_editor_graphic_space_action_group",[cr.LAYER_LEVEL]:"guide_editor_graphic_space_action_level"};function ur(){return Boolean(window.localStorage)}class hr{constructor(){this._id="notify_guider_id",this._position="bottomRight",this._waiting=!1,this._tasks=[],this._handleSelectEvent=e=>{const{selectedList:t}=e;if(t.length<=0)return;if(t.length>1)return;const i=t[0],{id:r}=i;if(i.type===Ne.F5.PAGE)return;const n=this._renderSDK.accessors.page.findAllMaterialsWithoutPage().filter((e=>e.id!==r)).map((e=>e.id));this._renderSDK.accessors.page.isNodeIntersect(r,n)&&this.show({title:h.ZP.t("web_guide_title_change_elements_layer",{},"Changing element layers"),content:h.ZP.t("web_guide_text_change_elements_layer",{},'If the element is obscured, you can right click and select "Layer order" to bring to  front.'),priority:cr.LAYER_LEVEL})},this._nextTick=e=>{Promise.resolve().then(e)},this._flushQueue=()=>{this._waiting=!1;let e=this._tasks[0];for(let t=1;t<this._tasks.length;t++){const i=this._tasks[t];i.priority<e.priority&&(e=i)}this._findGuideBeginner()?(this._setMemoryRecord(dr[e.priority]),(0,or.PI)(v.WA.SHOW,e.priority===cr.GROUP?v.kx.UNGROUPED:v.kx.layers),this._showNotify({...e.getParams(),priority:e.priority}),this._clearTask()):this._clearTask()},this._findGuideBeginner=()=>{if(!ur())return!1;const e=localStorage.getItem(`${Ne.oI}${this._userId}`);return Boolean(e)},this._clearTask=()=>{this._tasks.length=0},this._getMemoryRecord=e=>function(e){return!ur()||!!localStorage.getItem(e)}(e),this._setMemoryRecord=e=>{const t=`${e}_${this._userId}`;ur()&&localStorage.setItem(t,"true")},this._showNotify=e=>{sr.Z.info({id:this._id,className:"notify-guider-class",duration:0,showIcon:!1,title:e.title,content:e.content,position:e.position,btn:lr({onClose:()=>{(0,or.PI)(v.WA.GET,e.priority===cr.GROUP?v.kx.UNGROUPED:v.kx.layers),this.hide()}})})}}static getInstance(){return hr._instance||(hr._instance=new hr,hr._instance._tasks.length=0),hr._instance}init(e){(async()=>{const t=await e.getUserInfo();this._userId=t.uid,this._renderSDK=e.editor.getRenderSDK(),_.Z.interact.onMaterialSelect.event(this._handleSelectEvent)})()}show({title:e,content:t,priority:i,position:r=this._position}){this._userId&&(this._getMemoryRecord(`${dr[i]}_${this._userId}`)||(this._tasks.push({priority:i,getParams:()=>({title:e,content:t,position:r})}),this._waiting||(this._waiting=!0,this._nextTick(this._flushQueue))))}hide(){sr.Z.remove(this._id)}}const gr=e=>{const{editor:t,getUserInfo:i,disableDraftSaveNextTime:n,onReady:o}=e,s=(0,r.useRef)({manager:null}),l=(0,r.useRef)(null),c=(0,r.useContext)(Tt.qI),d=(0,r.useContext)(Tt.zT);return(0,je.Z)((()=>{const e=new di({containerRef:l,editor:t,state:c,dispatch:d,disableDraftSaveNextTime:n});return ar.init({editor:t,editManager:e}),o(),hr.getInstance().init({editor:t,getUserInfo:i,disableDraftSaveNextTime:void 0}),s.current.manager=e,()=>{null==e||e.destroy()}})),(0,r.useEffect)((()=>{var e;c&&d&&(null===(e=s.current.manager)||void 0===e||e.updateEditorContext(c,d))}),[c,d]),(0,f.jsx)("div",{className:"graphic-edit-tool-container",id:a.TT,ref:l,children:a.TC.map((e=>(0,f.jsx)("div",{className:e.className,id:e.id},e.id)))})};var pr=i(20990);const mr="ruler-kM6Ni5",_r="options-lMF1Sq",vr="item-_oZEyx",fr="key-icon-QX5WsP",yr=e=>{const{visible:t=!0,className:i,position:n,area:a,setVisible:o,setRulerVisible:s,removeAllRulerLine:c,removeRulerLine:d,rulerLine:u,setRulerLineInfoDisable:g,editor:m}=e,_=(0,r.useRef)(null);(0,We.V)(_,(()=>{o(!1)})),(0,r.useEffect)((()=>{void 0!==u&&g(!!t)}),[t,g,u]);const y=(0,r.useCallback)((()=>m.getRenderSDK().getActivePageIndex()),[m]),b=(0,r.useCallback)((e=>{switch(e){case Ne.ii.horizontal:(0,Ki.WX)(Ki.fu.RemoveHorizontalGuide,v.l5.FunctionRightClick,y());break;case Ne.ii.vertical:(0,Ki.WX)(Ki.fu.RemoveVerticalGuide,v.l5.FunctionRightClick,y());break;case Ne.ii.all:(0,Ki.WX)(Ki.fu.RemoveAllGuides,v.l5.FunctionRightClick,y())}}),[y]),x=(0,r.useCallback)((()=>void 0!==u?(d(u.id),b(u.direction===Ne.wb.HORIZONTAL?Ne.ii.horizontal:Ne.ii.vertical),void o(!1)):void 0!==a?(c(a),b(a),void o(!1)):void 0),[o,c,d,a,u,b]),w=(0,r.useCallback)((()=>{s(!1),(0,Ki.WX)(Ki.fu.HideRulers,v.l5.FunctionRightClick,y())}),[s,y]),S=(0,r.useCallback)((()=>{const e=m.getGraphicSDK().document.guideLine.lines;let t=!1;e.length>0&&a===Ne.ii.all&&(t=!0);const i=e.filter((e=>e.direction===Ne.wb.HORIZONTAL));i.length>0&&a===Ne.ii.horizontal&&(t=!0);const r=e.filter((e=>e.direction===Ne.wb.VERTICAL));return r.length>0&&a===Ne.ii.vertical&&(t=!0),t}),[a,m]);return t?(0,f.jsx)("div",{ref:_,className:l()(mr,i),style:{"--ruler-menu-left":`${n.x}px`,"--ruler-menu-top":`${n.y}px`,zIndex:Oe.ly},children:(0,f.jsx)("div",{className:_r,children:[void 0!==u?null:(0,f.jsxs)("div",{className:l()(vr),onClick:w,children:[(0,f.jsx)("span",{className:"text",children:h.ZP.t("web_ruler_right_button_hide_ruler",{},"Hide rulers and guides")}),(0,f.jsx)("span",{className:fr,children:null===(P=(0,pr.a)(p.b.ShowOrHideRulers))||void 0===P?void 0:P.render()})]},"show-ruler-menu"),(()=>{const e=e=>(0,f.jsx)("div",{className:l()(vr),onClick:x,children:(0,f.jsx)("span",{className:"text",children:e})},"clear-guides-menu");if(void 0!==u)return e(h.ZP.t("web_ruler_right_button_remove_guide",{},"Remove guide"));if(!S())return null;switch(a){case Ne.ii.vertical:return e(h.ZP.t("web_ruler_right_button_remove_vertical",{},"Remove all vertical guides"));case Ne.ii.horizontal:return e(h.ZP.t("web_ruler_right_button_remove_horizontal",{},"Remove all horizontal guides"));default:return e(h.ZP.t("web_ruler_right_button_clear_guide",{},"Clear all guides"))}})()]})}):null;var P};var br=i(3549);class xr extends Ce.v{constructor(e,t){super(e,t),this._isShowRuler=!1,this._disposeStore=new Be.S,this._ref=(0,r.createRef)(),this._onOpenStatusChange=new Lt.j,this.setRulerVisible=e=>{this._rulerFeature.setRulerVisible(e),this._isShowRuler=e,this._setOpenStatus(e),e||this.hideContextmenu()},this.setRulerLineInfoDisable=e=>{this._rulerFeature.setRulerLineInfoDisable(e)},this.addHorizontalGuide=(e,t)=>{this._rulerFeature.addHorizontalRulerLine(e,t),this.documentApi.addGuideLine((0,br.V)(),Ne.wb.HORIZONTAL,e)},this.addVerticalGuide=(e,t)=>{this._rulerFeature.addHorizontalRulerLine(e,t),this.documentApi.addGuideLine((0,br.V)(),Ne.wb.VERTICAL,e)},this.removeAllGuides=e=>{var t;const i=this._rulerFeature.getRulerLineIds(e);this._rulerFeature.removeAllRulerLine(e);const r=null!==(t=this._rulerFeature.getRulerLineIds())&&void 0!==t?t:[];null!=i&&i.length&&(this.graphicApi.transaction.begin(),i.forEach((e=>this.documentApi.deleteGuideLine(e))),r.length<=0&&this._rulerFeature.isAllRulerLineLocked()&&this.documentApi.unlockGuideLine(),this.graphicApi.transaction.commit())},this.removeGuide=e=>{this._rulerFeature.removeRulerLine(e),this.documentApi.deleteGuideLine(e)},this.isAllRulerLineLocked=()=>this._rulerFeature.isAllRulerLineLocked(),this.lockAllGuides=()=>{this._rulerFeature.lockAllRulerLine(),this.documentApi.lockGuideLine()},this.unlockAllGuides=()=>{this._rulerFeature.unlockAllRulerLine(),this.documentApi.unlockGuideLine()},this._setOpenStatus=async e=>{this._onOpenStatusChange.fire(e);const t=await this._editor.getDependence().getUserInfo();this._editor.getDependence().storageSet(`${xr.RulerLocalKey}_${t.uid}`,JSON.stringify(e))},this._handleRulerContextMenu=e=>{e.type!==Ne.bM.RulerMenu&&e.type!==Ne.bM.RulerLineMenu||this.showContextmenu(e.position,null==e?void 0:e.extInfo)},this._onRulerLineAdd=e=>{const{line:t,isCopy:i}=e;this.documentApi.addGuideLine(t.id,t.direction,t.position);const r=t.direction===Ne.wb.HORIZONTAL?Ki.fu.AddHorizontalGuide:Ki.fu.AddVerticalGuide,n=i?v.l5.Drag:v.l5.FunctionRightClick;(0,Ki.WX)(r,n,this._getPageIndex())},this._onRulerLineDelete=e=>{const{id:t,direction:i}=e;this.documentApi.deleteGuideLine(t);const r=i===Ne.wb.HORIZONTAL?Ki.fu.RemoveHorizontalGuide:Ki.fu.RemoveVerticalGuide;(0,Ki.WX)(r,v.l5.Drag,this._getPageIndex())},this._onRulerLineUpdate=e=>{this.documentApi.updateGuideLinePosition(e.id,e.position)},this._onThemeChange=e=>{this.editor.getRenderSDK().accessors.stage.setTheme(e)},e.setRulerView(this),this._initRulerFeature(),this._initEventListener()}get isShowRuler(){return this._isShowRuler}get ref(){return this._ref}get documentApi(){return this._editor.getGraphicSDK().api.document}get graphicApi(){return this._editor.getGraphicSDK().api}get _rulerFeature(){return this._editor.getRenderSDK().accessors.page.getRulerFeature()}destroy(){super.destroy(),this._removeEventListener()}showContextmenu(e,t){this._rulerMenuProps={position:e,editor:this._editor,className:l()("attribute-ruler-menu-view","lv-theme-force_light"),setVisible:this.hideContextmenu.bind(this),setRulerVisible:this.setRulerVisible.bind(this),removeAllRulerLine:this.removeAllGuides.bind(this),unLockAllRulerLine:this.unlockAllGuides.bind(this),removeRulerLine:this.removeGuide.bind(this),setRulerLineInfoDisable:this.setRulerLineInfoDisable.bind(this),visible:!0,area:null==t?void 0:t.area,rulerLine:null==t?void 0:t.rulerLine},this.render((0,f.jsx)(yr,{...this._rulerMenuProps}))}hideContextmenu(){this._rulerMenuProps&&this.render((0,f.jsx)(yr,{...this._rulerMenuProps,visible:!1}))}show(){this.setRulerVisible(!0)}hide(){this.setRulerVisible(!1)}onOpenStatusChange(e){return this._onOpenStatusChange.event(e)}async isRulerShowFromLocal(){const e=await this._editor.getDependence().getUserInfo(),t=this._editor.getDependence().storageQuery(`${xr.RulerLocalKey}_${e.uid}`);return"true"===(null==t?void 0:t.value)}async _initRulerFeature(){this._rulerFeature.setDragCopyTip(h.ZP.t("web_ruler_tooltip_add_guide",{},"Drag to add guide")),this.editor.getDependence().onThemeEvent(this._onThemeChange);const e=await this.isRulerShowFromLocal();this.setRulerVisible(e)}_initEventListener(){this._disposeStore.add(Pt.default.events.interact.onContextMenu.event(this._handleRulerContextMenu)),this._disposeStore.add(this._rulerFeature.onRulerLineAdd(this._onRulerLineAdd)),this._disposeStore.add(this._rulerFeature.onRulerLineDelete(this._onRulerLineDelete)),this._disposeStore.add(this._rulerFeature.onRulerLineUpdate(this._onRulerLineUpdate))}_removeEventListener(){this._disposeStore.clear()}_getPageIndex(){return this._editor.getRenderSDK().getActivePageIndex()}}xr.RulerLocalKey="graphic-ruler-visible";class wr extends Ce.v{constructor(e,t){super(e,t),this._isShow=!1,this._onOpenStatusChange=new Lt.j,this._setOpenStatus=async e=>{this._onOpenStatusChange.fire(e);const t=await this._editor.getDependence().getUserInfo();this._editor.getDependence().storageSet(`${wr.PageBleedLocalKey}_${t.uid}`,JSON.stringify(e))},e.setPageBleedView(this)}get isShow(){return this._isShow}show(){this._editor.getRenderSDK().accessors.page.getPageBleedFeature().show(),this._setOpenStatus(!0)}hide(){this._editor.getRenderSDK().accessors.page.getPageBleedFeature().hide(),this._setOpenStatus(!1)}onOpenStatusChange(e){return this._onOpenStatusChange.event(e)}async isPageBleedShowFromLocal(){const e=await this._editor.getDependence().getUserInfo(),t=this._editor.getDependence().storageQuery(`${wr.PageBleedLocalKey}_${e.uid}`);return"true"===(null==t?void 0:t.value)}}wr.PageBleedLocalKey="graphic-page-bleed-visible";class Sr extends Ce.v{constructor(e,t){super(e,t),this._isShow=!1,this._onOpenStatusChange=new Lt.j,this._setOpenStatus=async e=>{this._onOpenStatusChange.fire(e);const t=await this._editor.getDependence().getUserInfo();this._editor.getDependence().storageSet(`${Sr.PageMarginLocalKey}_${t.uid}`,JSON.stringify(e))},e.setPageMarginView(this)}get isShow(){return this._isShow}show(){this._editor.getRenderSDK().accessors.page.getPageMarginFeature().show(),this._setOpenStatus(!0)}hide(){this._editor.getRenderSDK().accessors.page.getPageMarginFeature().hide(),this._setOpenStatus(!1)}onOpenStatusChange(e){return this._onOpenStatusChange.event(e)}async isPageMarginShowFromLocal(){const e=await this._editor.getDependence().getUserInfo(),t=this._editor.getDependence().storageQuery(`${Sr.PageMarginLocalKey}_${e.uid}`);return"true"===(null==t?void 0:t.value)}}Sr.PageMarginLocalKey="graphic-page-margin-visible";const Pr=[{className:"graphic-edit-page-layers",id:a.xw},{className:"graphic-edit-page-rulers",id:a.tx},{className:"graphic-edit-page-margin",id:a.Su},{className:"graphic-edit-page-bleed",id:a.m$}],Ir={pageLayersView:{View:Mt,containerId:a.xw},rulerView:{View:xr,containerId:a.tx},pageMarginView:{View:Sr,containerId:a.Su},pageBleedLineView:{View:wr,containerId:a.m$}};const Cr=(0,r.memo)((0,r.forwardRef)(((e,t)=>{const{editor:i,draftPermission:n,getPageThumbnailCover:o,onDomReady:s,onEditPanelReady:l,templateList:c,getUserInfo:d,disableDraftSaveNextTime:u,pageDisplayMode:h,projectMaterialManager:g,isLogin:p,draftWorkspaceInfo:_}=e;(0,je.Z)(s);const v=i&&n===Ke.O.editable,y=(0,r.useRef)(null),b=(0,r.useCallback)((()=>{var e;null===(e=y.current)||void 0===e||e.pageLayersView.mount({permissionStatus:v?Et.normal:Et.readonly})}),[v]);(0,r.useEffect)((()=>{if(!i)return;if(function(e,t){e.current={},Object.keys(Ir).forEach((i=>{const{View:r,containerId:n}=Ir[i],a=(0,De.createRoot)(document.querySelector(`#${n}`));e.current[i]=new r(t,a)}))}(y,i),!y.current)return;const{pageLayersView:e,pageBleedView:t,pageMarginView:r,rulerView:n}=y.current;let a=Be.G;return i.getGraphicSDK().modelInitFinish?b():a=Pt.default.events.interact.onModelInitFinish.event(b),()=>{a(),e.destroy(),t.destroy(),r.destroy(),n.destroy()}}),[i,b]);const x=(null==i?void 0:i.getRenderSDK().isEditorFeatureType())&&h===m.L.Multi;return(0,f.jsxs)("div",{className:"graphic-edit-container",children:[(0,f.jsxs)("div",{className:"graphic-edit-container_content",children:[(0,f.jsx)("div",{id:a.Q,className:"graphic-edit-container_canvas",children:v?(0,f.jsx)(gr,{editor:i,getUserInfo:d,disableDraftSaveNextTime:u,onReady:l}):null}),Pr.map((e=>(0,f.jsx)("div",{className:e.className,id:e.id},e.id)))]}),x?(0,f.jsx)(pt,{editor:i,draftPermission:n,getPageThumbnailCover:o,templateList:c,ref:t,projectMaterialManager:g,isLogin:p,draftWorkspaceInfo:_}):null]})})));var Er=i(87705),Dr=i(71713),Ar=i(83433);const Lr=e=>{const{accept:t,children:i,onHoverChange:n,handleDrop:a,canDrop:o,startDrag:s,endDrag:l}=e,c=(0,Er.N)(),d=(0,r.useRef)(),u=(0,r.useRef)(!1);function h(e){const{previewType:t}=e.getItem(),i=function(e){const{getInitialPreviewLayout:t}=e.getItem(),i=t(),r=(0,Ar.V3)(e),n=e.getClientOffset();return{x:n.x-r.x+i.offsetX,y:n.y-r.y+i.offsetY}}(e);if(t===Dr.q.element)return i;const r=function(e,t){var i;const{hoverRef:r,getInitialPreviewLayout:n}=e.getItem(),a=n(),o=(0,Ar.c3)(e,a),s=null===(i=r.current)||void 0===i?void 0:i.hoverRect;if(!s)return t;const l=o.x/a.width*s.width-o.x,c=t.x-l,d=o.y/a.height*s.height-o.y;return{x:c,y:t.y-d}}(e,i);return r}async function g(e,t){const i=h(t),r=t.getClientOffset(),n=await a({dragObjectOffset:i,clientOffset:r,dragObject:e,monitor:t});e.didDropCallback&&n&&"function"==typeof e.didDropCallback&&e.didDropCallback(t)}const[{isOver:p},m]=(0,T.L)((()=>({accept:t,drop:g,canDrop:(e,t)=>{var i;const r=t.getClientOffset();return null===(i=null==o?void 0:o(r))||void 0===i||i},collect:e=>({isOver:e.isOver()})})),[a,n,o]),_=()=>{var e,t;const i=null===(e=d.current)||void 0===e?void 0:e.getItem(),r=null===(t=d.current)||void 0===t?void 0:t.didDrop();if(null!=i&&i.hoverCallback&&!r&&u.current){var a;const e=null===(a=d.current)||void 0===a?void 0:a.getClientOffset();null==n||n(i,e,p,i.hoverCallback)}};return(0,r.useEffect)((()=>{d.current||(d.current=c.getMonitor());const e=d.current.subscribeToOffsetChange(_),t=d.current.subscribeToStateChange((()=>{var e,t;const i=null===(e=d.current)||void 0===e?void 0:e.isDragging(),r=null===(t=d.current)||void 0===t?void 0:t.getItemType();i&&"item"===r?u.current||(u.current=!0,null==s||s()):u.current&&(u.current=!1,null==l||l())}));return()=>{"function"==typeof e&&(e(),t())}}),[c,n,p,l]),(0,f.jsx)("div",{className:"graphic-droppable-wrapper",children:(0,f.jsx)("div",{className:"graphic-droppable-inner",ref:m,children:i})})};var kr=i(888),Rr=i(77383),Mr=i(69578);const Tr={[xi.P.YkImage]:Ne.lJ.YkImage,[xi.P.EverImage]:Ne.lJ.CloudImageSticker},jr=(e,t)=>{const{resourceId:i,id:r,md5:n,source:a}=t;return e===xi.P.EverImage?{id:r,resourceId:i,md5:n,type:Tr[e]}:{id:i,resourceId:i,type:Tr[e],source:a}},Nr=(e,t,i,r,n,a,o,s,l)=>{var c;if(![xi.P.EverImage,xi.P.YkImage].includes(e))return!1;if(!i.info||!i.layout)return!1;if(n.accessors.layer.isLocked([i.info.id]))return!1;new Rr.Vt(t,a).report();const d=i.layout,{id:u,index:h}=i.info;return l.status=Xt.V6.Success,l.setSource(t.sourceFrom),ri.I.getInstance().reportEvent(l),r.api.imageContainer.fillContainerItemWithImage(u,h,jr(e,t),d),null===(c=s.getSuspendToolView())||void 0===c||c.closeReplace(),new kr.hK(t,a,!0,o,n.getActivePageIndex()+1).report(),!0},Br=(e,t,i,r,n,a,o,s,l)=>{var c;if(![xi.P.EverImage,xi.P.YkImage].includes(e))return!1;if(!i.info||!i.layout)return!1;if(n.accessors.layer.isLocked([i.info.id]))return!1;new Rr.Vt(t,a).report();const d=i.layout,{id:u,areaId:h}=i.info;return l.status=Xt.V6.Success,l.setSource(t.sourceFrom),ri.I.getInstance().reportEvent(l),r.api.grid.updateGridFillWithImage(u,h,jr(e,t),d),null===(c=s.getSuspendToolView())||void 0===c||c.closeReplace(),new kr.hK(t,a,!0,o,n.getActivePageIndex()+1).report(),!0},Zr=(e,t)=>{const{resourceId:i,id:r,md5:n,source:a}=t;return e===xi.P.EverImage?{id:r,resourceId:i,md5:n,type:Tr[e],source:void 0}:{id:i,resourceId:i,md5:void 0,type:Tr[e],source:a}},Or=(e,t,i,r,n,a,o,s,l)=>{var c;if(![xi.P.EverImage,xi.P.YkImage].includes(e))return!1;if(!i.id||!i.clipRect)return!1;if(n.accessors.layer.isLocked([i.id]))return!1;new Rr.Vt(t,a).report();const{id:d,clipRect:u}=i;return l.status=Xt.V6.Success,l.setSource(t.sourceFrom),ri.I.getInstance().reportEvent(l),null==r||r.api.image.replace(d,{src:Zr(e,t),clipRect:u}),null===(c=s.getSuspendToolView())||void 0===c||c.closeReplace(),new kr.hK(t,a,!0,o,n.getActivePageIndex()+1).report(),!0},Kr=(e,t,i,r,n,a,o,s,l)=>{var c;if(![xi.P.EverImage,xi.P.YkImage].includes(e))return!1;if(!i.id||!i.layout)return!1;new Rr.Vt(t,a).report();const{id:d,layout:u}=i;return l.status=Xt.V6.Success,l.setSource(t.sourceFrom),ri.I.getInstance().reportEvent(l),null==r||r.api.page.setBackgroundImageWithResource(d,Zr(e,t),u),null===(c=s.getSuspendToolView())||void 0===c||c.closeReplace(),new kr.hK(t,a,!0,o,n.getActivePageIndex()+1,void 0,Mr.zf.SET_BACKGROUND).report(),!0},Fr=(e,t,i,r,a,o)=>{var s;const l=r.getSuspendToolView(),c=null==l?void 0:l.replaceLayerId(),d=null==l?void 0:l.replaceGridIndex(),u=null==l?void 0:l.isGridReplacing();if(!c||!u||!i||void 0===d||d===Ne.q6)return!1;const{width:h,height:g}=i,p=d,m={x:0,y:0,width:h,height:g,scale:{x:1,y:1},rotation:0},_=null===(s=o.accessors.grid.getSelectAreaByIndex(c,p))||void 0===s?void 0:s.id;if(void 0===_)return!1;const f=o.accessors.grid.calImageLayoutForFill(c,_,m,!0);if(!f)return!1;const y={info:{id:c,index:p,areaId:_},layout:f},b=new Xt.NX(Xt.Jm.Grid);return b.actionType=v.H8.Click,Br(e,t,y,a,o,n.$u.ClickEvent,o.accessors.stage.getPagePixel(),r,b)},Gr=(e,t,i,r,a,o)=>{const s=r.getSuspendToolView(),l=null==s?void 0:s.replaceLayerId(),c=null==s?void 0:s.isImageReplacing();if(!l||!c||!i)return!1;const{width:d,height:u}=i,h=o.accessors.image.getClipRect(l,d,u);if(!h)return!1;const g={id:l,clipRect:h},p=new Xt.NX(Xt.Jm.Picture);return p.actionType=v.H8.Click,Or(e,t,g,a,o,n.$u.ClickEvent,o.accessors.stage.getPagePixel(),r,p)},Ur=(e,t,i,r,a,o)=>{const s=r.getSuspendToolView(),l=null==s?void 0:s.replaceLayerId(),c=null==s?void 0:s.replaceImageContainerIndex(),d=null==s?void 0:s.isImageContainerReplacing();if(!l||!d||!i||void 0===c||c===Ne.ch)return!1;const{width:u,height:h}=i,g=c,p={x:0,y:0,width:u,height:h,scale:{x:1,y:1},rotation:0},m=o.accessors.imageContainer.calImageLayoutForFill(l,g,p,!0);if(!m)return!1;const _={info:{id:l,index:g},layout:m},f=!o.accessors.imageContainer.getIsSingle(l),y=new Xt.NX(f?Xt.Jm.MutilFrame:Xt.Jm.Frame);return y.actionType=v.H8.Click,Nr(e,t,_,a,o,n.$u.ClickEvent,o.accessors.stage.getPagePixel(),r,y)},Hr=(e,t,i,r,a,o)=>{const s=r.getSuspendToolView(),l=null==s?void 0:s.replaceLayerId(),c=null==s?void 0:s.isPageBgImageReplacing();if(!l||!c||!i)return!1;const{width:d,height:u}=i,h={id:l,layout:o.accessors.page.calBgImageLayout(l,{width:d,height:u})},g=new Xt.NX(Xt.Jm.Page);return g.actionType=v.H8.Click,Kr(e,t,h,a,o,n.$u.ClickEvent,o.accessors.stage.getPagePixel(),r,g)};class Vr{constructor(){this.clickAddToImage=Gr,this.clickAddToImageContainer=Ur,this.clickAddToPageBgImage=Hr,this.clickAddToGrid=Fr}}const zr=e=>{const t=document.querySelector(`#${a.Iv}`);if(!t)return!1;const i=t.getBoundingClientRect();return i.x<=e.x&&i.x+i.width>e.x&&i.y<=e.y&&i.y+i.height>e.y},Wr=(e,t,i,r)=>{var n,a,o;const s=null===(n=t.current)||void 0===n?void 0:n.getBoundingClientRect(),l={x:e.x-(null!==(a=null==s?void 0:s.x)&&void 0!==a?a:0),y:e.y-(null!==(o=null==s?void 0:s.y)&&void 0!==o?o:0)},c=i.accessors.page,{x:d,y:u}=l;return(r?c.isOverByLayerId(d,u,r):c.isOverPage(d,u))||zr(e)},$r=(e,t,i,r,a,o,s)=>{r.accessors.image.removeHoverBorder(void 0,i.current.id,o);const l=new Xt.NX(Xt.Jm.Picture);l.actionType=v.H8.Drag;return!!Or(e,t,i.current,a,r,n.$u.DragEvent,r.accessors.stage.getPagePixel(),s,l)&&(i.current.id=void 0,i.current.clipRect=void 0,!0)},Yr=(e,t,i,r,a,o,s)=>{var l;r.accessors.imageContainer.removeHoverBorder(void 0,i.current.info,o);const c=!(null===(l=i.current)||void 0===l||null===(l=l.info)||void 0===l||!l.id)&&!r.accessors.imageContainer.getIsSingle(i.current.info.id),d=new Xt.NX(c?Xt.Jm.MutilFrame:Xt.Jm.Frame);d.actionType=v.H8.Drag;return!!Nr(e,t,i.current,a,r,n.$u.DragEvent,r.accessors.stage.getPagePixel(),s,d)&&(i.current.info=void 0,i.current.layout=void 0,!0)};var Xr=i(64525);const qr=async(e,t,i,r,a,o)=>{if(void 0===r.renderSDK||void 0===r.graphicSDK)return kt.t.error("[handleDrop]drop failed"),!1;if(!Wr(i,r.container,r.renderSDK))return!1;const s=zr(i),{renderSDK:l,graphicSDK:c,imageContainerHoverRef:d,gridHoverRef:u,imageHoverRef:h,pageBgImageRef:g,container:p}=r,{dragSourceDataRef:m,sourceType:_}=e,f=await m.current.getMaterialSourceDataWhenDrop();if(!f)return!1;const y=l.accessors.page,{type:b}=f,x=p.current.getBoundingClientRect(),w={x:t.x-x.x,y:t.y-x.y},S=y.getStagePositionRelativeToPage(w.x,w.y),P={...f,dropPosition:S},I=a.getSuspendToolView(),C=null==I?void 0:I.isImageReplacing(),E=null==I?void 0:I.isImageContainerReplacing(),D=null==I?void 0:I.isGridReplacing();if(s)return((e,t,i,r,n,a,o,s)=>{(s.current||0===s.current)&&(0,Xr.U)(e,t,i,r,a,n,o,{insertPosition:s.current})})(r.documentService,r.environmentService,r.storageService,l,r.graphicSDK,P,n.$u.DragEvent,r.pageNavigationPlaceholderRef),!0;const A=((e,t,i,r,a,o)=>{const s=new Xt.NX(Xt.Jm.Picture);return s.actionType=v.H8.Drag,!!Kr(e,t,i.current,a,r,n.$u.DragEvent,r.accessors.stage.getPagePixel(),o,s)&&(i.current.id=void 0,i.current.layout=void 0,!0)})(_,f.data,g,l,c,a);if(A)return!0;if($r(_,f.data,h,l,c,Boolean(C),a))return!0;if(Yr(_,f.data,d,l,c,Boolean(E),a))return!0;const L=((e,t,i,r,a,o,s)=>{const l=new Xt.NX(Xt.Jm.Grid);return l.actionType=v.H8.Drag,!!Br(e,t,i.current,a,r,n.$u.DragEvent,r.accessors.stage.getPagePixel(),s,l)&&(i.current.info=void 0,i.current.layout=void 0,!0)})(_,f.data,u,l,c,Boolean(D),a);return L||(0,Ei.n)({documentService:r.documentService,environmentService:r.environmentService,storageService:r.storageService,graphicSDK:r.graphicSDK,renderSDK:l,sourceData:P,sourceType:b,triggerType:n.$u.DragEvent,extraParams:o}),!0};class Jr{constructor(){this.handleDrop=qr,this.dropOnImage=$r,this.dropOnImageContainer=Yr}}var Qr=i(69792);const en=(e,t,i,r,n,a)=>{if(!t)return;if(![xi.P.EverImage,xi.P.YkImage].includes(i))return;const o=t.accessors.imageContainer.isPointInImageContainerItem(e,a),s=null==o?void 0:o.id;if(s){const e=t.accessors.layer.getBatchEditorMainLayerInfoByLayerId(s);if(null!=e&&e.isMainLayer&&(null==e?void 0:e.position)===(null==o?void 0:o.index))return}if(s&&t.accessors.layer.isLocked([s]))return;const l=()=>{var e,i;if(null===(e=r.current)||void 0===e||!e.info)return;const{id:n,index:o}=null===(i=r.current)||void 0===i?void 0:i.info;r.current.info=void 0,r.current.layout=void 0,t.accessors.imageContainer.removeHoverImage(n,o,a)};o?(()=>{var e,i,s,c;if(!o)return;const{id:d,index:u}=o;null!==(e=r.current)&&void 0!==e&&e.info?null===(i=r.current)||void 0===i||!i.info||(null===(s=r.current)||void 0===s?void 0:s.info.id)===d&&(null===(c=r.current)||void 0===c?void 0:c.info.index)===u||(l(),r.current.info=o,r.current.layout=t.accessors.imageContainer.renderHoverImageResource(d,u,n,a)):(r.current.info=o,r.current.layout=t.accessors.imageContainer.renderHoverImageResource(d,u,n,a))})():l()},tn=(e,t,i,r,n,a)=>{var o,s;if(!t)return;if(![xi.P.EverImage,xi.P.YkImage].includes(i))return;const l=t.accessors.image.isPointInImage(e,a);if(l&&(t.accessors.layer.isLocked([l])||null!==(o=t.accessors.layer.getBatchEditorMainLayerInfoByLayerId(l))&&void 0!==o&&o.isMainLayer))return;const c=()=>{var e,i;if(null===(e=r.current)||void 0===e||!e.id)return;const n=null===(i=r.current)||void 0===i?void 0:i.id;r.current.id=void 0,r.current.clipRect=void 0,t.accessors.image.removeHoverImage(n,a)};if(!l)return void c();if(null!==(s=t.accessors.image.getMaterialWidgetById(l))&&void 0!==s&&s.waitingState)return void c();const d=t.accessors.layer.getLayerById(l),{replaceable:u}=null!=d?d:{};u?(()=>{var e,i,o;if(l)null!==(e=r.current)&&void 0!==e&&e.id?null!==(i=r.current)&&void 0!==i&&i.id&&(null===(o=r.current)||void 0===o?void 0:o.id)!==l&&(c(),r.current.id=l,r.current.clipRect=t.accessors.image.renderHoverImageResource(l,n,a)):(r.current.id=l,r.current.clipRect=t.accessors.image.renderHoverImageResource(l,n,a))})():c()},rn=(e,t,i,r,n,a,o)=>{if(!i)return;if(![xi.P.EverImage,xi.P.YkImage].includes(r))return;const s=i.accessors.page.isPointInPageBgImg(e,o),l=()=>{var e,t;if(null===(e=n.current)||void 0===e||!e.id)return;const r=null===(t=n.current)||void 0===t?void 0:t.id;n.current.id=void 0,n.current.layout=void 0,i.accessors.page.removeHoverImage(r,o)};s?(()=>{var e,r,c;const d=t<.2;if(!s)return;const u=()=>{n.current.id=s,n.current.layout=i.accessors.page.renderHoverImageResource(s,a,o)};if(null!==(e=n.current)&&void 0!==e&&e.id)return null!==(r=n.current)&&void 0!==r&&r.id&&(null===(c=n.current)||void 0===c?void 0:c.id)!==s?(l(),void(d&&u())):void 0;d&&u()})():l()},nn=(e,t,i,r,n,a)=>{if(!t)return;if(![xi.P.EverImage,xi.P.YkImage].includes(i))return;const o=t.accessors.grid.getGridByPoint(e,a),s=null==o?void 0:o.id;if(s){const e=t.accessors.layer.getBatchEditorMainLayerInfoByLayerId(s);if(null!=e&&e.isMainLayer&&(null==e?void 0:e.position)===(null==o?void 0:o.areaId))return}if(s&&t.accessors.layer.isLocked([s]))return;const l=()=>{var e,i;if(null===(e=r.current)||void 0===e||!e.info)return;const{id:n,areaId:o}=null===(i=r.current)||void 0===i?void 0:i.info;r.current.info=void 0,r.current.layout=void 0,t.accessors.grid.removeHoverImage(n,o,a)};o?(()=>{var e,i,s,c;if(!o)return;const{id:d,areaId:u}=o;null!==(e=r.current)&&void 0!==e&&e.info?null===(i=r.current)||void 0===i||!i.info||(null===(s=r.current)||void 0===s?void 0:s.info.id)===d&&(null===(c=r.current)||void 0===c?void 0:c.info.areaId)===u||(l(),r.current.info=o,r.current.layout=t.accessors.grid.renderHoverImageResource(d,u,n,a)):(r.current.info=o,r.current.layout=t.accessors.grid.renderHoverImageResource(d,u,n,a))})():l()},an=(e,t,i,r,o,s,l)=>{var c,d,u,h,g;if(!s.renderSDK)return;const p=l.getSuspendToolView(),_=null==p?void 0:p.replaceLayerId(),v=null==p?void 0:p.isImageReplacing(),f=null==p?void 0:p.isImageContainerReplacing(),y=null==p?void 0:p.isPageBgImageReplacing(),b=null==p?void 0:p.isGridReplacing(),x=null==p?void 0:p.isCropping(),{renderSDK:w,imageContainerHoverRef:S,imageHoverRef:P,pageBgImageRef:I,stageBorderStyleRef:C,gridHoverRef:E}=s,{sourceType:D,previewRect:A,previewUrl:L}=e,k=Wr(t,s.container,s.renderSDK,_)&&r,R=w.accessors.layer,M=zr(t),T=k?n.US.solid:n.US.dashed;f||v||y||b||C.current===T||(C.current=T,T===n.US.dashed?R.showBorderHighlight("dashed"):R.showBorderHighlight("solid"));const j=(0,Ze.Ln)(s.renderSDK.accessors.page.getDimension());let N=s.renderSDK.accessors.page.getZoom();const B=null!==(c=e.previewRect)&&void 0!==c?c:{width:1,height:1};let Z;Z=D===xi.P.Text?{width:0,height:0}:(0,Qr.SE)(D,j,B);const O=(0,Qr.M$)(w);M&&D===xi.P.Template&&O&&(Z={width:O.width,height:O.height},N={x:1,y:1});if(o({isOverDropZone:k,hoverRect:{width:Z.width*N.x,height:Z.height*N.y},zoom:N.x,isPageNavigator:M}),!(k||null!==(d=S.current)&&void 0!==d&&d.info||null!==(u=E.current)&&void 0!==u&&u.info||null!==(h=P.current)&&void 0!==h&&h.id||null!==(g=I.current)&&void 0!==g&&g.id))return;const K=((e,t)=>{var i,r,n;const a=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();return{x:e.x-(null!==(r=null==a?void 0:a.x)&&void 0!==r?r:0),y:e.y-(null!==(n=null==a?void 0:a.y)&&void 0!==n?n:0)}})(t,s.container);M&&((e,t,i,r,n,o)=>{if(t.accessors.layer.clearBorderHighlight(),(()=>{var e,r;if(null===(e=i.current)||void 0===e||!e.id)return;const a=null===(r=i.current)||void 0===r?void 0:r.id;i.current.id=void 0,i.current.layout=void 0,t.accessors.page.removeHoverImage(a,n)})(),t.getAllPages().length>=m.P)return;const s=document.querySelector(`#${a.w4}`),l=null==s?void 0:s.getBoundingClientRect();if(!l)return;var c;if(!(l.x<=e.x&&l.x+l.width>e.x&&l.y<=e.y&&l.y+l.height>e.y))return void(null===(c=r.current)||void 0===c||c.showPlaceholderWhenDrag(-1));const d=document.querySelectorAll("[data-page-index]");var u;if(!d)return void(null===(u=r.current)||void 0===u||u.showPlaceholderWhenDrag(-1));let h=0;for(let a=0;a<d.length;a++){var g;const t=d[a],i=d[a+1],r=t.getBoundingClientRect(),n=null==i||null===(g=i.getBoundingClientRect)||void 0===g?void 0:g.call(i);if(!r)continue;const o=r.x+r.width/2;if(!i&&e.x>=o){h=a+1;break}const s=n.x+n.width/2;if(0===a&&e.x<=o){h=0;break}if(e.x>=o&&e.x<=s){h=a+1;break}}var p;if(h<0)return void(null===(p=r.current)||void 0===p||p.showPlaceholderWhenDrag(-1));const _=o.current;var v;o.current=h,h!==_&&(null===(v=r.current)||void 0===v||v.showPlaceholderWhenDrag(h))})(t,w,I,s.pageNavigationRef,Boolean(y),s.pageNavigationPlaceholderRef),x||f||b||y||tn(K,w,D,P,{url:L,type:Ne.lJ.CloudImageSticker,...A},Boolean(v)),x||v||y||b||en(K,w,D,S,{url:L,type:Ne.lJ.CloudImageSticker,...A},Boolean(f)),x||v||y||f||nn(K,w,D,E,{url:L,type:Ne.lJ.CloudImageSticker,...A},Boolean(b)),x||v||f||b||rn(K,i,w,D,I,{url:L,type:Ne.lJ.CloudImageSticker,...A},Boolean(y))};class on{constructor(){this.handleHoverChange=an,this.handleImageHover=tn,this.handleImageContainerHover=en,this.handlePageHotspotHover=rn}}const sn=new class{constructor(){this.click=new Vr,this.hover=new on,this.drop=new Jr,this.addToPage=Ei.n}};var ln=i(47495);const cn=({editor:e})=>{const[t,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{e.getGraphicSDK().modelInitFinish?i(!0):_.Z.interact.onModelInitFinish.event((()=>{i(!0)}))})),(0,f.jsx)("div",{className:"page-title-readonly-container",children:(0,f.jsx)(ln.V,{editor:e,className:"page-title-view",visible:t})})},dn="graphic-editor-render",un=(0,r.forwardRef)(((e,t)=>{const{documentService:i,environmentService:a,storageService:o,renderSDK:s,graphicSDK:l,onDomReady:c,onEditPanelReady:d,onLoadMaterialClick:u,onHeaderBarClick:h,uploadMaterialInProject:g,handleDefaultText:p,getUserInfo:_,editor:v,disableDraftSaveNextTime:y,draftPermission:b,getPageThumbnailCover:x,projectMaterialManager:w,isLogin:S,draftWorkspaceInfo:P}=e,I=(0,r.useRef)(null),C=(0,r.useRef)({info:void 0,layout:void 0}),E=(0,r.useRef)({info:void 0,layout:void 0}),D=(0,r.useRef)({id:void 0,clipRect:void 0}),A=(0,r.useRef)({id:void 0,layout:void 0}),L=(0,r.useRef)(null),k=(0,r.useRef)(n.US.empty),R=(0,r.useRef)(-1),M=(0,r.useRef)({pos:void 0,time:void 0}),[T,j]=(0,r.useState)({}),[N,B]=(0,r.useState)(m.L.Multi);(0,r.useImperativeHandle)(t,(()=>({updateTemplateList(e){j(e)},setPageDisplayMode(e){B(e)}}))),(0,r.useEffect)((()=>{u(((e,t)=>{if(!s||!v)return;const r=(null==t?void 0:t.triggerType)||n.$u.ClickEvent,c=e.type;if(sn.click.clickAddToPageBgImage(c,e.data,e.sourceRect,v,l,s))return;if(sn.click.clickAddToImage(c,e.data,e.sourceRect,v,l,s))return;if(sn.click.clickAddToImageContainer(c,e.data,e.sourceRect,v,l,s))return;sn.click.clickAddToGrid(c,e.data,e.sourceRect,v,l,s)||sn.addToPage({documentService:i,environmentService:a,storageService:o,graphicSDK:l,renderSDK:s,sourceData:e,sourceType:c,triggerType:r,extraParams:t})})),p((e=>{if(s)return s.accessors.text.getEffectTextRatioByResourceId(e)})),h((()=>{const e=null==v?void 0:v.getSuspendToolView();null!=e&&e.isCropping()&&(null==e||e.closeCrop()),null!=e&&e.isReplacing()&&(null==e||e.closeReplace())}))}),[s,p]),(0,r.useEffect)((()=>{g&&(null==v||v.setUploadMaterialInProject(g))}),[g,v]),(0,r.useEffect)((()=>{s&&v&&b===Ke.O.readonly&&ar.init({editor:v})}),[b,s,v]);const Z=(0,jt.throttle)(((e,t,i,r)=>{let n=1;if(M.current.pos&&M.current.time){const{pos:e,time:i}=M.current,r=(new Date).getTime()-i.getTime();n=Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))/r,M.current={pos:{...t},time:new Date}}else M.current={pos:{...t},time:new Date};sn.hover.handleHoverChange(e,t,n,i,r,{renderSDK:s,container:I,imageContainerHoverRef:C,gridHoverRef:E,imageHoverRef:D,pageBgImageRef:A,stageBorderStyleRef:k,pageNavigationRef:L,pageNavigationPlaceholderRef:R},v)}),50);return(0,f.jsx)("div",{className:"graphic-editor-render",id:dn,ref:I,children:b===Ke.O.editable?(0,f.jsx)(Lr,{accept:"item",handleDrop:({dragObjectOffset:e,clientOffset:t,dragObject:r})=>sn.drop.handleDrop(r,e,t,{documentService:i,environmentService:a,storageService:o,renderSDK:s,graphicSDK:l,container:I,imageContainerHoverRef:C,gridHoverRef:E,imageHoverRef:D,pageBgImageRef:A,pageNavigationPlaceholderRef:R},v,r.extraParams),onHoverChange:Z,startDrag:()=>(({renderSDK:e,editor:t})=>{if(!e||!t)return;e.accessors.layer.addBorderHighlight();const i=t.getSuspendToolView(),r=null==i?void 0:i.isImageReplacing(),n=null==i?void 0:i.isImageContainerReplacing(),a=null==i?void 0:i.isGridReplacing(),o=null==i?void 0:i.isPageBgImageReplacing();r||n||o||a||e.accessors.selection.triggerMaterialsSelection([])})({renderSDK:s,editor:v}),endDrag:()=>{var e;M.current={pos:void 0,time:void 0},(e={renderSDK:s,stageBorderStyleRef:k}).renderSDK&&(e.renderSDK.accessors.layer.clearBorderHighlight(),e.stageBorderStyleRef.current=n.US.empty)},children:(0,f.jsx)(Cr,{ref:L,editor:v,draftPermission:b,onDomReady:c,getPageThumbnailCover:x,templateList:T,getUserInfo:_,disableDraftSaveNextTime:y,pageDisplayMode:N,projectMaterialManager:w,onEditPanelReady:d,isLogin:S,draftWorkspaceInfo:P})}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(Cr,{editor:v,draftPermission:b,onDomReady:c,getPageThumbnailCover:x,templateList:T,ref:L,getUserInfo:_,disableDraftSaveNextTime:y,pageDisplayMode:N,projectMaterialManager:w,onEditPanelReady:d,isLogin:S,draftWorkspaceInfo:P}),v&&(0,f.jsx)(cn,{editor:v})]})})}))},57710:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(18571);function n(e,t){const i=(0,r.useRef)(),n=(0,r.useCallback)(e,t);return[i,e=>{i.current=e,n(e)}]}},20990:(e,t,i)=>{i.d(t,{a:()=>g,x:()=>d});var r=i(56185),n=i(22231),a=i(27175),o=i(14906),s=i(72322);let l,c;const d=()=>{l||(l=[{title:a.ZP.t("web_keyboard_text_Global",{},"Global"),keyList:[[r.b.SelectAll,a.ZP.t("web_keyboard_text_Select_all",{},r.b.SelectAll),["\u2318 A"]],[r.b.Copy,a.ZP.t("web_keyboard_button_Copy",{},r.b.Copy),["\u2318 C"]],[r.b.Cut,a.ZP.t("web_keyboard_button_Cut",{},r.b.Cut),["\u2318 X"]],[r.b.Paste,a.ZP.t("web_keyboard_button_Paste",{},r.b.Paste),["\u2318 V"]],[r.b.Undo,a.ZP.t("web_keyboard_button_Undo",{},r.b.Undo),["\u2318 Z"]],[r.b.Redo,a.ZP.t("web_keyboard_button_Redo",{},r.b.Redo),["\u2318 Y","\u2318 \u21e7 Z"]],[r.b.ShowOrHidePanel,a.ZP.t("web_keyboard_text_Show_hide_panel",{},r.b.ShowOrHidePanel),["\u2318 /"]],[r.b.ShowOrHidePagePanel,a.ZP.t("web_keyboard_text_Show_hide_panel_navigator",{},r.b.ShowOrHidePagePanel),["\u2318 ."]],[r.b.ShowOrHideRulers,a.ZP.t("web_ruler_shortcut_show_hide_rulers",{},r.b.ShowOrHideRulers),["\u21e7 R"]],[r.b.PreviousPage,a.ZP.t("web_typesetting_button_previous_page",{},r.b.PreviousPage),["\u2190"]],[r.b.NextPage,a.ZP.t("web_typesetting_button_next_page",{},r.b.NextPage),["\u2192"]],[r.b.DuplicatePage,a.ZP.t("web_typesetting_button_copy_page",{},r.b.DuplicatePage),["\u2318 D"]],[r.b.DeletePage,a.ZP.t("web_typesetting_button_delete_page",{},r.b.DeletePage),[(0,s.jsx)(o.hRw,{style:{color:"var(--lvv-color-text-primary)"},width:24,height:24},r.b.Delete)]],[r.b.ViewShortcutList,a.ZP.t("web_keyboard_text_View_shortcut_list",{},r.b.ViewShortcutList),["\u21e7 Q"]]]},{title:a.ZP.t("web_keyboard_text_Canvas",{},"Canvas"),keyList:[[r.b.ZoomIn,a.ZP.t("web_keyboard_text_Zoom_in",{},r.b.ZoomIn),["\u21e7 +","\u2318 +"]],[r.b.ZoomOut,a.ZP.t("web_keyboard_text_Zoom_out",{},r.b.ZoomOut),["\u21e7 -","\u2318 -"]],[r.b.ZoomToFit,a.ZP.t("web_keyboard_text_Zoom_to_fit",{},r.b.ZoomToFit),["\u21e7 F"]],[r.b.ZoomTo50Percent,a.ZP.t("web_keyboard_text_Zoom_to_fifty",{},r.b.ZoomTo50Percent),["\u21e7 0"]],[r.b.ZoomTo100Percent,a.ZP.t("web_keyboard_text_Zoom_to_hundred",{},r.b.ZoomTo100Percent),["\u21e7 1"]],[r.b.ZoomTo200Percent,a.ZP.t("web_keyboard_text_Zoom_two_hundred",{},r.b.ZoomTo200Percent),["\u21e7 2"]],[r.b.ScrollToZoom,a.ZP.t("web_keyboard_text_Scroll_to_zoom",{},r.b.ScrollToZoom),[a.ZP.t("web_keyboard_text_scroll_one",{},"^ Scroll"),a.ZP.t("web_keyboard_text_scroll_two",{},"\u2318 Scroll")]],[r.b.ScrollLeftOrRight,a.ZP.t("web_keyboard_text_Shift_Scroll_left_right",{},r.b.ScrollLeftOrRight),[a.ZP.t("web_keyboard_text_scroll_three",{},"\u21e7 Scroll")]],[r.b.Move,a.ZP.t("web_keyboard_text_Move",{},r.b.Move),["V"]],[r.b.HandTool,a.ZP.t("web_keyboard_text_Hand_tool",{},r.b.HandTool),["H"]]]},{title:a.ZP.t("web_keyboard_text_Materials",{},"Materials"),keyList:[[r.b.SelectOrInvertSelection,a.ZP.t("web_keyboard_text_Select_invert_selecion",{},r.b.SelectOrInvertSelection),[a.ZP.t("web_keyboard_text_left_click_two",{},"\u21e7 Left-Click")]],[r.b.DeepSelect,a.ZP.t("web_keyboard_text_deep_select",{},r.b.DeepSelect),[a.ZP.t("web_keyboard_text_left_click_one",{},"\u2318 Left-click")]],[r.b.DragToCopy,a.ZP.t("web_keyboard_text_Drag_to_copy",{},r.b.DragToCopy),[a.ZP.t("web_keyboard_text_Draweb_keyboard_text_drag_threeg_to_copy",{},"\u2325 Drag")]],[r.b.Delete,a.ZP.t("web_keyboard_text_Delete",{},r.b.Delete),[(0,s.jsx)(o.hRw,{style:{color:"var(--lvv-color-text-primary)"},width:24,height:24},r.b.Delete)]],[r.b.BringForward,a.ZP.t("web_keyboard_text_Bring_forward",{},r.b.BringForward),["\u2318 ]"]],[r.b.BringToFront,a.ZP.t("web_keyboard_text_Bring_to_front",{},r.b.BringToFront),["\u2318 \u2325 ]"]],[r.b.SendBackward,a.ZP.t("web_keyboard_text_Send_backward",{},r.b.SendBackward),["\u2318 ["]],[r.b.SendToBack,a.ZP.t("web_keyboard_text_Send_to_back",{},r.b.SendToBack),["\u2318 \u2325 ["]],[r.b.MoveUp1px,a.ZP.t("web_keyboard_text_Move_up",{},r.b.MoveUp1px),["\u2191"]],[r.b.MoveDown1px,a.ZP.t("web_keyboard_text_Move_down",{},r.b.MoveDown1px),["\u2193"]],[r.b.MoveLeft1px,a.ZP.t("web_keyboard_text_Move_left",{},r.b.MoveLeft1px),["\u2190"]],[r.b.MoveRight1px,a.ZP.t("web_keyboard_text_Move_right",{},r.b.MoveRight1px),["\u2192"]],[r.b.MoveUp10px,a.ZP.t("web_keyboard_text_Move_up_ten",{},r.b.MoveUp10px),["\u21e7 \u2191"]],[r.b.MoveDown10px,a.ZP.t("web_keyboard_text_Move_down_ten",{},r.b.MoveDown10px),["\u21e7 \u2193"]],[r.b.MoveLeft10px,a.ZP.t("web_keyboard_text_Move_left_ten",{},r.b.MoveLeft10px),["\u21e7 \u2190"]],[r.b.MoveRight10px,a.ZP.t("web_keyboard_text_Move_right_ten",{},r.b.MoveRight10px),["\u21e7 \u2192"]],[r.b.Group,a.ZP.t("web_keyboard_text_Group",{},r.b.Group),["\u2318 G"]],[r.b.Ungroup,a.ZP.t("web_keyboard_text_Ungroup",{},r.b.Ungroup),["\u2318 \u21e7 G"]],[r.b.DragAndHideSmartGuides,a.ZP.t("web_keyboard_text_Show_smart_guides",{},r.b.DragAndHideSmartGuides),[a.ZP.t("web_keyboard_text_drag_one",{},"\u2318 Drag")]],[r.b.MoveHorizontallyOrVertically,a.ZP.t("web_keyboard_text_move_horizontally_vertically",{},r.b.MoveHorizontallyOrVertically),[a.ZP.t("web_keyboard_text_drag_two",{},"\u21e7 Drag")]],[r.b.FlipHorizontal,a.ZP.t("web_graphic_flip_horizontal",{},r.b.FlipHorizontal),["\u21e7 H"]],[r.b.FlipVertical,a.ZP.t("web_graphic_flip_vertical",{},r.b.FlipVertical),["\u21e7 V"]],[r.b.Distance,a.ZP.t("web_distance_text_distance_another_layer",{},r.b.Distance),[a.ZP.t("web_distance_text_hover_over",{},"\u2325 + hover over another layer")]],[r.b.AlignLeft,a.ZP.t("web_keyboard_text_Align_left",{},r.b.AlignLeft),["\u2325 A"]],[r.b.AlignCenter,a.ZP.t("web_keyboard_text_Align_center",{},r.b.AlignCenter),["\u2325 H"]],[r.b.AlignRight,a.ZP.t("web_keyboard_text_Align_right",{},r.b.AlignRight),["\u2325 D"]],[r.b.AlignTop,a.ZP.t("web_keyboard_text_Align_top",{},r.b.AlignTop),["\u2325 W"]],[r.b.AlignMiddle,a.ZP.t("web_keyboard_text_Align_center_vertically",{},r.b.AlignMiddle),["\u2325 V"]],[r.b.AlignBottom,a.ZP.t("web_keyboard_text_Align_bottom",{},r.b.AlignBottom),["\u2325 S"]],[r.b.EvenSpacingHorizontally,a.ZP.t("web_keyboard_text_Even_spacing_horizontally",{},r.b.EvenSpacingHorizontally),["^ \u2325 H"]],[r.b.EvenSpacingVertically,a.ZP.t("web_keyboard_text_Even_spacing_vertically",{},r.b.EvenSpacingVertically),["^ \u2325 V"]]]},{title:a.ZP.t("web_keyboard_text_Text",{},"Text"),keyList:[[r.b.Bold,a.ZP.t("web_keyboard_text_Bold",{},r.b.Bold),["\u2318 B","\u2318 \u21e7 B"]],[r.b.Italics,a.ZP.t("web_keyboard_text_Italics",{},r.b.Italics),["\u2318 I","\u2318 \u21e7 I"]],[r.b.Underline,a.ZP.t("web_keyboard_text_Underline",{},r.b.Underline),["\u2318 U","\u2318 \u21e7 U"]],[r.b.AlignCenter,a.ZP.t("web_keyboard_text_Text_align_center",{},r.b.AlignCenter),["\u2318 \u21e7 E"]],[r.b.AlignLeft,a.ZP.t("web_keyboard_text_Text_align_left",{},r.b.AlignLeft),["\u2318 \u21e7 L"]],[r.b.AlignRight,a.ZP.t("web_keyboard_text_Text_align_right",{},r.b.AlignRight),["\u2318 \u21e7 R"]],[r.b.InsertText,a.ZP.t("web_keyboard_text_Insert_text",{},r.b.InsertText),["T"]]]},{title:a.ZP.t("web_keyboard_text_Shapes",{},"Shapes"),keyList:[[r.b.InsertRectangle,a.ZP.t("web_keyboard_text_Insert_rectangle",{},r.b.InsertRectangle),["R"]],[r.b.InsertCircle,a.ZP.t("web_keyboard_text_Insert_circle",{},r.b.InsertCircle),["C"]],[r.b.InsertLine,a.ZP.t("web_keyboard_text_Insert_line",{},r.b.InsertLine),["L"]],[r.b.InsertArrow,a.ZP.t("web_keyboard_text_Insert_arrow",{},r.b.InsertArrow),["\u21e7 L"]]]}]),c||(c=[{title:a.ZP.t("web_keyboard_text_Global",{},"Global"),keyList:[[r.b.SelectAll,a.ZP.t("web_keyboard_text_Select_all",{},r.b.SelectAll),[a.ZP.t("web_keyboard_text_Command_A_windows",{},"Ctrl + A")]],[r.b.Copy,a.ZP.t("web_keyboard_button_Copy",{},r.b.Copy),[a.ZP.t("web_keyboard_text_Command_C_windows",{},"Ctrl + C")]],[r.b.Paste,a.ZP.t("web_keyboard_button_Paste",{},r.b.Paste),[a.ZP.t("web_keyboard_text_Command_V_windows",{},"Ctrl + V")]],[r.b.Cut,a.ZP.t("web_keyboard_button_Cut",{},r.b.Cut),[a.ZP.t("web_keyboard_text_Command_X_windows",{},"Ctrl + X")]],[r.b.Undo,a.ZP.t("web_keyboard_button_Undo",{},r.b.Undo),[a.ZP.t("web_keyboard_text_Command_Z_windows",{},"Ctrl + Z")]],[r.b.Redo,a.ZP.t("web_keyboard_button_Redo",{},r.b.Redo),[a.ZP.t("web_keyboard_text_Y_or_Z_windows",{},"Ctrl + Y or Ctrl + Shift + Z")]],[r.b.ShowOrHidePanel,a.ZP.t("web_keyboard_text_Show_hide_panel",{},r.b.ShowOrHidePanel),[a.ZP.t("web_keyboard_text_Command_or_windows",{},"Ctrl + /")]],[r.b.ShowOrHidePagePanel,a.ZP.t("web_keyboard_text_Show_hide_panel_navigator",{},r.b.ShowOrHidePagePanel),["Ctrl + ."]],[r.b.ShowOrHideRulers,a.ZP.t("web_ruler_shortcut_show_hide_rulers",{},r.b.ShowOrHideRulers),[a.ZP.t("web_ruler_shortcut_show_hide_ruler",{},"Shift + R")]],[r.b.PreviousPage,a.ZP.t("web_typesetting_button_previous_page",{},r.b.PreviousPage),[a.ZP.t("web_keyboard_text_left_windows",{},"\u2190")]],[r.b.NextPage,a.ZP.t("web_typesetting_button_next_page",{},r.b.NextPage),[a.ZP.t("web_keyboard_text_right_windows",{},"\u2192")]],[r.b.DuplicatePage,a.ZP.t("web_typesetting_button_copy_page",{},r.b.DuplicatePage),["Ctrl + D"]],[r.b.DeletePage,a.ZP.t("web_typesetting_button_delete_page",{},r.b.DeletePage),[a.ZP.t("web_keyboard_text_Backspace_windows",{},"Backspace")]],[r.b.ViewShortcutList,a.ZP.t("web_keyboard_text_View_shortcut_list",{},r.b.ViewShortcutList),[a.ZP.t("web_keyboard_text_Shift_Q_windows",{},"Shift + Q")]]]},{title:a.ZP.t("web_keyboard_text_Canvas",{},"Canvas"),keyList:[[r.b.ZoomIn,a.ZP.t("web_keyboard_text_Zoom_in",{},r.b.ZoomIn),[a.ZP.t("web_keyboard_text_Shift_Command_plus_windows",{},"Shift + + or Ctrl + +")]],[r.b.ZoomOut,a.ZP.t("web_keyboard_text_Zoom_out",{},r.b.ZoomOut),[a.ZP.t("web_keyboard_text_Shift_Command_minus_windows",{},"Shift + - or ctrl + -")]],[r.b.ZoomToFit,a.ZP.t("web_keyboard_text_Zoom_to_fit",{},r.b.ZoomToFit),[a.ZP.t("web_keyboard_text_Shift_F_windows",{},"Shift + F")]],[r.b.ZoomTo50Percent,a.ZP.t("web_keyboard_text_Zoom_to_fifty",{},r.b.ZoomTo50Percent),[a.ZP.t("web_keyboard_text_Shift_zero_windows",{},"Shift + 0")]],[r.b.ZoomTo100Percent,a.ZP.t("web_keyboard_text_Zoom_to_hundred",{},r.b.ZoomTo100Percent),[a.ZP.t("web_keyboard_text_Shift_one_windows",{},"Shift + 1")]],[r.b.ZoomTo200Percent,a.ZP.t("web_keyboard_text_Zoom_two_hundred",{},r.b.ZoomTo200Percent),[a.ZP.t("web_keyboard_text_Shift_two_windows",{},"Shift + 2")]],[r.b.ScrollToZoom,a.ZP.t("web_keyboard_text_Scroll_to_zoom",{},r.b.ScrollToZoom),[a.ZP.t("web_keyboard_text_Command_Scroll_windows",{},"Ctrl + Scroll")]],[r.b.ScrollLeftOrRight,a.ZP.t("web_keyboard_text_Shift_Scroll_left_right",{},r.b.ScrollLeftOrRight),[a.ZP.t("web_keyboard_text_Shift_Scroll_windows",{},"Shift + Scroll")]],[r.b.Move,a.ZP.t("web_keyboard_text_Move",{},r.b.Move),[a.ZP.t("web_keyboard_text_V_windows",{},"V")]],[r.b.HandTool,a.ZP.t("web_keyboard_text_Hand_tool",{},r.b.HandTool),[a.ZP.t("web_keyboard_text_H_windows",{},"H")]]]},{title:a.ZP.t("web_keyboard_text_Materials",{},"Materials"),keyList:[[r.b.SelectOrInvertSelection,a.ZP.t("web_keyboard_text_Select_invert_selecion",{},r.b.SelectOrInvertSelection),[a.ZP.t("web_keyboard_text_Shift_left_click_windows",{},"Shift + Left-Click")]],[r.b.DeepSelect,a.ZP.t("web_keyboard_text_deep_select",{},r.b.DeepSelect),[a.ZP.t("web_keyboard_text_Control_left_click_windows",{},"Ctrl + Left-click ")]],[r.b.DragToCopy,a.ZP.t("web_keyboard_text_Drag_to_copy",{},r.b.DragToCopy),[a.ZP.t("web_keyboard_text_Option_Drag_windows",{},"Alt + Drag")]],[r.b.Delete,a.ZP.t("web_keyboard_text_Delete",{},r.b.Delete),[a.ZP.t("web_keyboard_text_Backspace_windows",{},"Backspace")]],[r.b.SendBackward,a.ZP.t("web_keyboard_text_Send_backward",{},r.b.SendBackward),[a.ZP.t("web_keyboard_text_Command_left_bracket_windows",{},"Ctrl + [")]],[r.b.SendToBack,a.ZP.t("web_keyboard_text_Send_to_back",{},r.b.SendToBack),[a.ZP.t("web_keyboard_text_Command_Alt_bracket_left_windows",{},"Ctrl + Alt + [")]],[r.b.BringForward,a.ZP.t("web_keyboard_text_Bring_forward",{},r.b.BringForward),[a.ZP.t("web_keyboard_text_Command_right_bracket_windows",{},"Ctrl + ] ")]],[r.b.BringToFront,a.ZP.t("web_keyboard_text_Bring_to_front",{},r.b.BringToFront),[a.ZP.t("web_keyboard_text_Command_Alt_bracket_right_windows",{},"Ctrl + Alt + ]")]],[r.b.MoveUp1px,a.ZP.t("web_keyboard_text_Move_up",{},r.b.MoveUp1px),[a.ZP.t("web_keyboard_text_up_windows",{},"\u2191")]],[r.b.MoveDown1px,a.ZP.t("web_keyboard_text_Move_down",{},r.b.MoveDown1px),[a.ZP.t("web_keyboard_text_down_windows",{},"\u2193")]],[r.b.MoveLeft1px,a.ZP.t("web_keyboard_text_Move_left",{},r.b.MoveLeft1px),[a.ZP.t("web_keyboard_text_left_windows",{},"\u2190")]],[r.b.MoveRight1px,a.ZP.t("web_keyboard_text_Move_right",{},r.b.MoveRight1px),[a.ZP.t("web_keyboard_text_right_windows",{},"\u2192")]],[r.b.MoveUp10px,a.ZP.t("web_keyboard_text_Move_up_ten",{},r.b.MoveUp10px),[a.ZP.t("web_keyboard_text_Shift_up_windows",{},"Shift + \u2191")]],[r.b.MoveDown10px,a.ZP.t("web_keyboard_text_Move_down_ten",{},r.b.MoveDown10px),[a.ZP.t("web_keyboard_text_Shift_down_windows",{},"Shift + \u2193")]],[r.b.MoveLeft10px,a.ZP.t("web_keyboard_text_Move_left_ten",{},r.b.MoveLeft10px),[a.ZP.t("web_keyboard_text_Shift_left_windows",{},"Shift + \u2190")]],[r.b.MoveRight10px,a.ZP.t("web_keyboard_text_Move_right_ten",{},r.b.MoveRight10px),[a.ZP.t("web_keyboard_text_Shift_right_windows",{},"Shift + \u2192")]],[r.b.Group,a.ZP.t("web_keyboard_text_Group",{},r.b.Group),[a.ZP.t("web_keyboard_text_Command_G_windows",{},"Ctrl + G")]],[r.b.Ungroup,a.ZP.t("web_keyboard_text_Ungroup",{},r.b.Ungroup),[a.ZP.t("web_keyboard_text_Command_Shift_G_windows",{},"Ctrl + Shift + G")]],[r.b.DragAndHideSmartGuides,a.ZP.t("web_keyboard_text_Show_smart_guides",{},r.b.DragAndHideSmartGuides),[a.ZP.t("web_keyboard_text_Command_Drag_windows",{},"Ctrl + Drag")]],[r.b.MoveHorizontallyOrVertically,a.ZP.t("web_keyboard_text_move_horizontally_vertically",{},r.b.MoveHorizontallyOrVertically),[a.ZP.t("web_keyboard_text_shift_Drag_windows",{},"Shift + Drag")]],[r.b.FlipHorizontal,a.ZP.t("web_graphic_flip_horizontal",{},r.b.FlipHorizontal),["Shift + H"]],[r.b.FlipVertical,a.ZP.t("web_graphic_flip_vertical",{},r.b.FlipVertical),["Shift + V"]],[r.b.Distance,a.ZP.t("web_distance_text_distance_another_layer",{},r.b.Distance),[a.ZP.t("web_distance_text_alt_hover",{},"Alt + hover over another layer")]],[r.b.AlignLeft,a.ZP.t("web_keyboard_text_Align_left",{},r.b.AlignLeft),[a.ZP.t("web_keyboard_text_Option_A_windows",{},"Alt + A")]],[r.b.AlignCenter,a.ZP.t("web_keyboard_text_Align_center",{},r.b.AlignCenter),[a.ZP.t("web_keyboard_text_Option_H_windows",{},"Alt + H")]],[r.b.AlignRight,a.ZP.t("web_keyboard_text_Align_right",{},r.b.AlignRight),[a.ZP.t("web_keyboard_text_Option_D_windows",{},"Alt + D")]],[r.b.AlignTop,a.ZP.t("web_keyboard_text_Align_top",{},r.b.AlignTop),[a.ZP.t("web_keyboard_text_Option_W_windows",{},"Alt + W")]],[r.b.AlignMiddle,a.ZP.t("web_keyboard_text_Align_center_vertically",{},r.b.AlignMiddle),[a.ZP.t("web_keyboard_text_Option_V_windows",{},"Alt + V")]],[r.b.AlignBottom,a.ZP.t("web_keyboard_text_Align_bottom",{},r.b.AlignBottom),[a.ZP.t("web_keyboard_text_Option_S_windows",{},"Alt + S")]],[r.b.EvenSpacingHorizontally,a.ZP.t("web_keyboard_text_Even_spacing_horizontally",{},r.b.EvenSpacingHorizontally),[a.ZP.t("web_keyboard_text_Command_Option_H_windows",{},"Ctrl + Alt + H")]],[r.b.EvenSpacingVertically,a.ZP.t("web_keyboard_text_Even_spacing_vertically",{},r.b.EvenSpacingVertically),[a.ZP.t("web_keyboard_text_Command_Option_V_windows",{},"Ctrl + Alt + V")]]]},{title:a.ZP.t("web_keyboard_text_Text",{},"Text"),keyList:[[r.b.Bold,a.ZP.t("web_keyboard_text_Bold",{},r.b.Bold),[a.ZP.t("web_keyboard_text_B_or_Shift_windows",{},"Ctrl + B or Ctrl + Shift + B")]],[r.b.Italics,a.ZP.t("web_keyboard_text_Italics",{},r.b.Italics),[a.ZP.t("web_keyboard_text_I_or_Shift_windows",{},"Ctrl + I or Ctrl + Shift + I")]],[r.b.Underline,a.ZP.t("web_keyboard_text_Underline",{},r.b.Underline),[a.ZP.t("web_keyboard_text_U_or_Shift_windows",{},"Ctrl + U or Ctrl + Shift + U")]],[r.b.AlignCenter,a.ZP.t("web_keyboard_text_Text_align_center",{},r.b.AlignCenter),[a.ZP.t("web_keyboard_text_Comman_Shift_E_windows",{},"Ctrl + Shift + E")]],[r.b.AlignLeft,a.ZP.t("web_keyboard_text_Text_align_left",{},r.b.AlignLeft),[a.ZP.t("web_keyboard_text_Comman_Shift_L_windows",{},"Ctrl + Shift + L")]],[r.b.AlignRight,a.ZP.t("web_keyboard_text_Text_align_right",{},r.b.AlignRight),[a.ZP.t("web_keyboard_text_Comman_Shift_R_windows",{},"Ctrl + Shift + R")]],[r.b.InsertText,a.ZP.t("web_keyboard_text_Insert_text",{},r.b.InsertText),[a.ZP.t("web_keyboard_text_T_windows",{},"T")]]]},{title:a.ZP.t("web_keyboard_text_Shapes",{},"Shapes"),keyList:[[r.b.InsertRectangle,a.ZP.t("web_keyboard_text_Insert_rectangle",{},r.b.InsertRectangle),[a.ZP.t("web_keyboard_text_R_windows",{},"R")]],[r.b.InsertCircle,a.ZP.t("web_keyboard_text_Insert_circle",{},r.b.InsertCircle),[a.ZP.t("web_keyboard_text_C_windows",{},"C")]],[r.b.InsertLine,a.ZP.t("web_keyboard_text_Insert_line",{},r.b.InsertLine),[a.ZP.t("web_keyboard_text_L_windows",{},"L")]],[r.b.InsertArrow,a.ZP.t("web_keyboard_text_Insert_arrow",{},r.b.InsertArrow),[a.ZP.t("web_keyboard_text_Shif_L_windows",{},"Shift + L")]]]}]);return n.t.MacOS?l:c};let u;const h=new Map,g=e=>{const t=(u||(u=d().flatMap((e=>e.keyList))),u);if(!h.has(e)){const i=t.find((t=>t[0]===e));h.set(e,i)}const[i,r,n]=h.get(e),a=n.reduce(((e,t,i)=>"string"==typeof t?`${e} ${i>0?" | ":""} ${t}`:e),"");return{actionText:r,iconText:a,render:()=>(0,s.jsx)("em",{style:{fontFamily:"system-ui",fontStyle:"normal"},children:a})}}},15770:(e,t,i)=>{i.d(t,{Bj:()=>l,EB:()=>o,aE:()=>a,rh:()=>c,xs:()=>u,zn:()=>s});var r=i(22231),n=i(56185);const a="graphicCopyScope";var o;!function(e){e.HTMLType="text/html",e.TextType="text/plain",e.File="file",e.Image="image",e.Other="other"}(o||(o={}));var s,l;!function(e){e.ShortKey="shortkey",e.Click="click"}(s||(s={})),function(e){e.MetaVersion="data-meta-version",e.LayerData="data-layer-data",e.ClipboardVersion="data-clipboard-version"}(l||(l={}));const c="1.0.0",d=(e,t)=>r.t.MacOS?e:t,u={ZoomIn:d("command+=, shift+=","ctrl+=, shift+="),ZoomOut:d("command+-, shift+-","ctrl+-, shift+-"),ZoomToFit:`shift+f, ${d("command+0","ctrl+0")}`,ZoomTo50:"shift+0",ZoomTo100:"shift+1",ZoomTo200:"shift+2",CtrlA:d("command+a","ctrl+a"),CtrlC:d("command+c","ctrl+c"),CtrlD:d("command+d","ctrl+d"),CtrlX:d("command+x","ctrl+x"),CtrlV:d("command+v","ctrl+v"),CtrlS:d("command+s","ctrl+s"),CtrlZ:d("command+z","ctrl+z"),CtrlY:`${d("command+y","ctrl+y")}, ${d("shift+command+z","shift+ctrl+z")}`,Up:"up",Down:"down",Left:"left",Right:"right",AltUp:"alt+up",AltDown:"alt+down",AltLeft:"alt+left",AltRight:"alt+right",ShiftUp:"shift+up",ShiftDown:"shift+down",ShiftLeft:"shift+left",ShiftRight:"shift+right",CtrlUp:d("command+up","ctrl+up"),CtrlDown:d("command+down","ctrl+down"),CtrlLeft:d("command+left","ctrl+left"),CtrlRight:d("command+right","ctrl+right"),CtrlShiftUp:d("command+shift+up","ctrl+shift+up"),CtrlShiftDown:d("command+shift+down","ctrl+shift+down"),CtrlShiftLeft:d("command+shift+left","ctrl+shift+left"),CtrlShiftRight:d("command+shift+right","ctrl+shift+right"),AltShiftUp:"alt+shift+up",AltShiftDown:"alt+shift+down",AltShiftLeft:"alt+shift+left",AltShiftRight:"alt+shift+right",ShiftFlipHorizontal:"shift+h",ShiftFlipVertical:"shift+v",ShowRulers:"shift+r",[n.b.LockOrUnLockLayer]:d("shift+command+l","shift+ctrl+l"),AlignLeft:"alt+a",AlignCenter:"alt+h",AlignRight:"alt+d",AlignTop:"alt+w",AlignMiddle:"alt+v",AlignBottom:"alt+s",AlignDistributeHorizontal:"ctrl+alt+h",AlignDistributeVertical:"ctrl+alt+v",Delete:"backspace, Delete",BackspaceText:"backspace",DeleteText:"Delete",CtrlBackspaceText:d("option+backspace","ctrl+backspace"),CtrlDeleteText:d("option+Delete","ctrl+Delete"),CMDBackspace:"command+backspace",CMDDelete:"command+Delete",Group:d("command+g","ctrl+g"),UnGroup:d("command+shift+g","ctrl+shift+g"),SendBackward:d("command+[","ctrl+["),SendToBack:d("command+alt+[","alt+ctrl+["),BringForward:d("command+]","ctrl+]"),BringToFront:d("command+alt+]","alt+ctrl+]"),[n.b.Move]:"v",[n.b.HandTool]:"h",Esc:"esc",Space:"space",[n.b.ShowOrHidePanel]:d("command+/","ctrl+/"),[n.b.ViewShortcutList]:d("shift+q","shift+q"),[n.b.InsertText]:"t",[n.b.InsertRectangle]:"r",[n.b.InsertCircle]:"c",[n.b.InsertLine]:"l",[n.b.InsertArrow]:"shift+l",[n.b.ShowOrHidePagePanel]:d("command+.","ctrl+.")}},79612:(e,t,i)=>{i.d(t,{Rf:()=>l,dl:()=>s,jU:()=>o});var r=i(7290),n=i(26950),a=i(24191);const o=a.hm.SalesFilter,s=a.hm.SalesImageEffect,l="POST_PROCESS_EFFECT_LOADER",c=r.u.getInstance().buildLoader(o,[new n.BF(o),new n.uo(o)]),d=r.u.getInstance().buildLoader(s,[new n.BF(s),new n.uo(s)]),u=r.u.getInstance().buildLoader(l,[new n.BF(l),new n.uo(l)]);r.u.getInstance().register(o,c),r.u.getInstance().register(s,d),r.u.getInstance().register(l,u)},15190:(e,t,i)=>{i.d(t,{EL:()=>g,EM:()=>_,Jj:()=>l,Ni:()=>u,Un:()=>h,fh:()=>o,kb:()=>s,mC:()=>c,pq:()=>m,t_:()=>d,vI:()=>p,wg:()=>a});var r=i(79227);class n{constructor(e){this._layerIds=[],this._layerIds=e}get layerIds(){return this._layerIds}getLayersCornerAABB(e,t=!1){const{accessors:i}=e.renderSDK;return i.page.getLayersRectCorners(this.layerIds,t).map((e=>(0,r.x)(e)))}getPageCornerAABB(e){const{accessors:t}=e.renderSDK;return t.page.getPageRectCorners()}getAbsoluteScale(e){const{accessors:t}=e.renderSDK;return this.layerIds.map((e=>t.layer.getAbsoluteScale(e)))}getLayersAlignLeftX(e,t=!1){return this.getLayersCornerAABB(e,t).flat().reduce(((e,t)=>Math.min(t.x,e)),1/0)}getLayersAlignRightX(e,t=!1){return this.getLayersCornerAABB(e,t).flat().reduce(((e,t)=>Math.max(t.x,e)),-1/0)}getLayersAlignCenterX(e,t=!1){const i=this.getLayersAlignLeftX(e,t);return i+(this.getLayersAlignRightX(e)-i)/2}getLayersAlignTopY(e,t=!1){return this.getLayersCornerAABB(e,t).flat().reduce(((e,t)=>Math.min(t.y,e)),1/0)}getLayersAlignBottomY(e,t=!1){return this.getLayersCornerAABB(e,t).flat().reduce(((e,t)=>Math.max(t.y,e)),-1/0)}getLayersAlignMiddleY(e,t=!1){const i=this.getLayersAlignTopY(e,t);return i+(this.getLayersAlignBottomY(e)-i)/2}getPageAlignLeftX(e){return this.getPageCornerAABB(e).flat().reduce(((e,t)=>Math.min(t.x,e)),1/0)}getPageAlignRightX(e){return this.getPageCornerAABB(e).flat().reduce(((e,t)=>Math.max(t.x,e)),-1/0)}getPageAlignCenterX(e){const t=this.getPageAlignLeftX(e);return t+(this.getPageAlignRightX(e)-t)/2}getPageAlignTopY(e){return this.getPageCornerAABB(e).flat().reduce(((e,t)=>Math.min(t.y,e)),1/0)}getPageAlignBottomY(e){return this.getPageCornerAABB(e).flat().reduce(((e,t)=>Math.max(t.y,e)),-1/0)}getPageAlignMiddleY(e){const t=this.getPageAlignTopY(e);return t+(this.getPageAlignBottomY(e)-t)/2}}class a extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignLeftX(e),r=this.getAbsoluteScale(e),n=t.map((([e])=>i-e.x)),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetX:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.x)&&void 0!==i?i:1)}})))}}class o extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignCenterX(e),r=this.getAbsoluteScale(e),n=t.map((([e,t])=>i-(e.x+(t.x-e.x)/2))),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetX:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.x)&&void 0!==i?i:1)}})))}}class s extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignRightX(e),r=this.getAbsoluteScale(e),n=t.map((([e,t])=>i-t.x)),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetX:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.x)&&void 0!==i?i:1)}})))}}class l extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignTopY(e),r=this.getAbsoluteScale(e),n=t.map((([e])=>i-e.y)),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetY:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.y)&&void 0!==i?i:1)}})))}}class c extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignBottomY(e),r=this.getAbsoluteScale(e),n=t.map((([e,t,r])=>i-r.y)),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetY:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.y)&&void 0!==i?i:1)}})))}}class d extends n{execute(e){const t=this.getLayersCornerAABB(e,!0),i=this.getPageAlignMiddleY(e),r=this.getAbsoluteScale(e),n=t.map((([e,t,r])=>i-(e.y+(r.y-e.y)/2))),{accessors:a}=e.renderSDK;a.layer.moveLayers(this.layerIds.map(((e,t)=>{var i,a;return{id:e,offsetY:n[t]/(null!==(i=null===(a=r[t])||void 0===a?void 0:a.y)&&void 0!==i?i:1)}})))}}class u extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignLeftX(e),r=t.map((([e])=>i-e.x)),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetX:r[t]}))))}}class h extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignCenterX(e),r=t.map((([e,t])=>i-(e.x+(t.x-e.x)/2))),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetX:r[t]}))))}}class g extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignRightX(e),r=t.map((([e,t])=>i-t.x)),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetX:r[t]}))))}}class p extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignTopY(e),r=t.map((([e])=>i-e.y)),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetY:r[t]}))))}}class m extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignBottomY(e),r=t.map((([e,t,r])=>i-r.y)),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetY:r[t]}))))}}class _ extends n{execute(e){const t=this.getLayersCornerAABB(e),i=this.getLayersAlignMiddleY(e),r=t.map((([e,t,r])=>i-(e.y+(r.y-e.y)/2))),{accessors:n}=e.renderSDK;n.layer.moveLayers(this.layerIds.map(((e,t)=>({id:e,offsetY:r[t]}))))}}},39361:(e,t,i)=>{i.d(t,{CX:()=>c,Eo:()=>l,_z:()=>d,hW:()=>s,lU:()=>u});var r=i(54714),n=i(15190),a=i(98585),o=i(92204);const s={[r.MR.Left]:n.Ni,[r.MR.Right]:n.EL,[r.MR.Center]:n.Un,[r.MR.Top]:n.vI,[r.MR.Middle]:n.EM,[r.MR.Bottom]:n.pq,[r.MR.Vertical]:a.D,[r.MR.Horizontal]:a.s},l={[r.MR.Left]:n.wg,[r.MR.Right]:n.kb,[r.MR.Center]:n.fh,[r.MR.Top]:n.Jj,[r.MR.Middle]:n.t_,[r.MR.Bottom]:n.mC,[r.MR.Vertical]:a.D,[r.MR.Horizontal]:a.s},c={[r.MR.Left]:o.B$.ALIGN_LEFT,[r.MR.Right]:o.B$.ALIGN_RIGHT,[r.MR.Center]:o.B$.ALIGN_CENTER,[r.MR.Top]:o.B$.ALIGN_TOP,[r.MR.Middle]:o.B$.ALIGN_MIDDLE,[r.MR.Bottom]:o.B$.ALIGN_BOTTOM,[r.MR.Vertical]:o.B$.ALIGN_DISTRIBUTE_VERTICAL,[r.MR.Horizontal]:o.B$.ALIGN_DISTRIBUTE_HORIZONTAL},d={[r.MR.Left]:o.B$.ALIGN_LEFT_TO_PAGE,[r.MR.Right]:o.B$.ALIGN_RIGHT_TO_PAGE,[r.MR.Center]:o.B$.ALIGN_CENTER_TO_PAGE,[r.MR.Top]:o.B$.ALIGN_TOP_TO_PAGE,[r.MR.Middle]:o.B$.ALIGN_MIDDLE_TO_PAGE,[r.MR.Bottom]:o.B$.ALIGN_BOTTOM_TO_PAGE,[r.MR.Vertical]:o.B$.ALIGN_DISTRIBUTE_VERTICAL,[r.MR.Horizontal]:o.B$.ALIGN_DISTRIBUTE_HORIZONTAL};class u{constructor(e){this._operations=[],this._editor=e}get renderSDK(){return this._editor.getRenderSDK()}get graphicApi(){return this._editor.getGraphicSDK().api}add(e){this._operations.push(e),this._processOperations()}_processOperations(){if(this._operations.length<=0)return;const e=this._operations.shift();null==e||e.execute(this),this._processOperations()}}},98585:(e,t,i)=>{i.d(t,{D:()=>a,s:()=>o});var r=i(79227);class n{constructor(e){this._layerIds=[],this._layerIds=e}get layerIds(){return this._layerIds}getLayersCornerAABB(e){const{accessors:t}=e.renderSDK;return t.page.getLayersRectCorners(this.layerIds).map((e=>(0,r.x)(e))).map(((e,t)=>({id:this.layerIds[t],aabb:e})))}getLayerHorizontalBounds(e){const t=this.getLayersCornerAABB(e).sort((({aabb:[e]},{aabb:[t]})=>e.x-t.x)).map((({id:e,aabb:[t,i]})=>({id:e,min:t.x,max:i.x})));let i=0;const r=t.reduce(((e,t,r)=>e.max<t.max?(i=r,t):e));return t.splice(i,1),t.push(r),t}getLayerVerticalBounds(e){const t=this.getLayersCornerAABB(e).sort((({aabb:[e]},{aabb:[t]})=>e.y-t.y)).map((({id:e,aabb:[t,i,r]})=>({id:e,min:t.y,max:r.y})));let i=0;const r=t.reduce(((e,t,r)=>e.max<t.max?(i=r,t):e));return t.splice(i,1),t.push(r),t}getSpaceEvenlyContainerHeight(e){const t=e[0];return e[e.length-1].max-t.min}getSpaceEvenlyContainerWidth(e){const t=e[0];return e[e.length-1].max-t.min}getLayersVerticalGap(e){return(this.getSpaceEvenlyContainerHeight(e)-e.map((({min:e,max:t})=>t-e)).reduce(((e,t)=>e+t),0))/(e.length-1)}getLayersHorizontalGap(e){return(this.getSpaceEvenlyContainerWidth(e)-e.map((({min:e,max:t})=>t-e)).reduce(((e,t)=>e+t),0))/(e.length-1)}}class a extends n{execute(e){const t=this.getLayerVerticalBounds(e),i=this.getLayersVerticalGap(t),r=[];t.forEach((({id:e,min:n,max:a},o)=>{if(0===o||o===t.length-1)return void r.push({id:e,min:n,max:a});const s=a-n,l=r[o-1].max+i;r[o]={id:e,min:l,max:l+s}}));const{accessors:n}=e.renderSDK,a={};r.map((({id:e,min:i},r)=>a[e]=i-t[r].min)),n.layer.moveLayers(this.layerIds.map((e=>({id:e,offsetY:a[e]}))))}}class o extends n{execute(e){const t=this.getLayerHorizontalBounds(e),i=this.getLayersHorizontalGap(t),r=[];t.forEach((({id:e,min:n,max:a},o)=>{if(0===o||o===t.length-1)return void r.push({id:e,min:n,max:a});const s=a-n,l=r[o-1].max+i;r[o]={id:e,min:l,max:l+s}}));const{accessors:n}=e.renderSDK,a={};r.map((({id:e,min:i},r)=>a[e]=i-t[r].min)),n.layer.moveLayers(this.layerIds.map((e=>({id:e,offsetX:a[e]}))))}}},11467:(e,t,i)=>{i.d(t,{n:()=>D,X:()=>E});var r=i(54714),n=i(71942),a=i(8757),o=i(888),s=i(92204),l=i(77383),c=i(56268),d=i(14283);const u=(e,t,i,r,u,h)=>{const{data:{id:g,resourceId:p,name:m,sourceFrom:_,albumName:v,albumId:f}}=t,y=new c.y(c.x.STICKER);y.markStartTime();const{id:b}=e,x=(0,d.G0)({type:n.P.Image,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:h,renderSDK:r,graphicSDK:i});i.api.image.add(b,{resourceId:p,id:g,type:a.lJ.Sticker},x,{replaceable:!1,title:m,extra:{resourceId:p,category:{name:null!=v?v:_,id:null!=f?f:s.Ic}}}),new o.Ys(s.c8.STICKER,t.data,u,!0,i.document.getPagePositionById(b)+1).report(),new l.uV(s.c8.STICKER,t.data,u).report(),y.markModelApplyEnd(),r.waitRenderReady().then((()=>y.markEndTimeAndReport()))};var h=i(67986),g=i(56537),p=i(54643),m=i(69792);var _=i(64525);var v=i(82440),f=i(78947);const y=(e,t,i,r,l,u,h)=>{var g;const p=Date.now(),m=new c.y(c.x.EVER_IMAGE);m.markStartTime();const{data:{id:_,resourceId:v,md5:f,name:y,sourceFrom:b},sourceRect:x,position:w}=t,{id:S}=e,P=x&&w?{...x,...w}:(0,d.G0)({type:n.P.EverImage,page:e,sourceData:t,triggerType:l,equalAssetWithLastAdd:u,renderSDK:r,graphicSDK:i});i.api.image.add(S,{resourceId:v,id:_,md5:f,type:a.lJ.CloudImageSticker},P,{extra:{resourceId:v,sourceInfo:null==h?void 0:h.sourceInfo,effectId:null==h?void 0:h.effectId,imageGeneratorType:null==h?void 0:h.imageGeneratorType,category:{name:b,id:s.Ic}},title:y}),new o.hK({...t.data,index:null!==(g=t.data.index)&&void 0!==g?g:null==h?void 0:h.rank},l,!0,r.accessors.stage.getPixel(),r.getActivePageIndex()+1,null==h?void 0:h.addFrom,void 0,Boolean(null==h?void 0:h.isFromCapcut),null==h?void 0:h.materialCategory,null==h?void 0:h.materialSubCategory,null==h?void 0:h.materialThirdCategory,null==h?void 0:h.toolType).report(),m.markModelApplyEnd(),r.waitRenderReady().then((()=>{var e;m.markEndTimeAndReport(),null==h||null===(e=h.onRenderReady)||void 0===e||e.call(h,Date.now()-p)}))};var b=i(47400);const x=(e,t,i,r,u,h,g)=>{const{data:{resourceId:p,source:m,searchId:_,requestId:v}}=t,{id:f}=e,y=new c.y(c.x.PHOTO);y.markStartTime();const x=(0,d.G0)({type:n.P.YkImage,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:h,renderSDK:r,graphicSDK:i});i.api.image.add(f,{resourceId:p,id:p,source:m,type:a.lJ.YkImage},x,{replaceable:!0});const w={materialId:null==g?void 0:g.materialId,materialName:null==g?void 0:g.materialName,searchId:_,searchKeyword:null==g?void 0:g.searchKeyword,keywordSource:null==g?void 0:g.keywordSource,wordPosition:null==g?void 0:g.wordPosition,isSuccess:!0,rank:null==g?void 0:g.rank,optionType:null==g?void 0:g.optionType,actionType:u,thirdCategory:null==g?void 0:g.thirdCategory,pageNo:i.document.getPagePositionById(f)+1};new l._S(w).report(),null!=g&&g.searchId&&(0,b.Gg)({...w,materialCategory:s.c8.PHOTO,requestId:v,isCommercial:g.isCommercial}),new o.nE(w).report(),y.markModelApplyEnd(),r.waitRenderReady().then((()=>y.markEndTimeAndReport()))},w=1e-4;const S=(e,t,i,r,u,h)=>{const{data:{id:g,resourceId:p,name:m,sdkExtra:_}}=t,{color:v}=_,f=new c.y(c.x.STICKER);f.markStartTime();const{id:y}=e,b=(0,d.G0)({type:n.P.SvgSticker,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:h,renderSDK:r,graphicSDK:i}),x=v.map((e=>({origin:e})));i.api.svgImage.add(y,{resourceId:p,id:g,type:a.lJ.Sticker},x,b,{title:m,extra:{resourceId:p,category:t.data.categoryId&&t.data.categoryName?{id:t.data.categoryId,name:t.data.categoryName}:void 0}}),new o.Ys(s.c8.STICKER,t.data,u,!0,i.document.getPagePositionById(y)+1).report(),new l.uV(s.c8.STICKER,t.data,u).report(),f.markModelApplyEnd(),r.waitRenderReady().then((()=>f.markEndTimeAndReport()))};let P,I,C;function E(e,t=1,i=.02){const{width:r,height:n}=(0,p.Ln)(e);return{xOffset:r*t*i,yOffset:n*t*i}}function D(e){const{documentService:t,environmentService:i,storageService:b,renderSDK:E,graphicSDK:D,sourceData:A,sourceType:L,triggerType:k,pageId:R,extraParams:M}=e,{md5:T}=A.data,j=E.accessors.page.getActivePage(),N=R?D.api.page.getPageById(R):void 0,B=null!=N?N:j;let Z=!1;switch([r.$u.ClickEvent,r.$u.ShortKey].includes(k)&&function(e){const t=Date.now();return P===e&&I&&t-I<2e3?(I=t,C++,!0):(P=e,I=t,C=0,!1)}(T)&&(Z=!0),L){case n.P.Shape:case n.P.Line:!function(e,t,i,r,u,_){t.data.svgContent||h.t.error(`Shape svg content is undefined or null, md5: ${t.data.md5}`);const v=new c.y(c.x.SHAPE);v.markStartTime();const f=e.id,{type:y,name:b,sourceFrom:x}=t.data,{data:w}=t,S=g.F.getSvgAttrsByString(y,w.svgContent);if(y===a.Wq.LINE){const a=(0,d.G0)({type:n.P.Line,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:_,renderSDK:r,graphicSDK:i});i.api.line.add(f,{source:w.svgContent},Object.assign({},S,{stroke:[70,70,76,1]}),{...a,scale:{x:1,y:1}},b,{resourceId:w.resourceId,effectId:w.id,category:{name:x,id:s.Ic}})}else{const o=(0,d.G0)({type:n.P.Shape,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:_,renderSDK:r,graphicSDK:i}),{width:s,height:l}=(0,p.Ln)(e.dimension),c=(0,m.SE)(n.P.Shape,{width:s,height:l},t.sourceRect),h=g.F.getSvgAttrsByString(a.Wq.SHAPE,w.svgContent),{viewBox:v}=h;i.api.shape.add(f,[{fixedAreas:w.fixedAreas,source:w.svgContent,attr:Object.assign({},S,{fill:[70,70,76,1]}),radius:g.F.isCornerRect(S.d)?46:0}],{layout:{...o,width:v.width,height:v.height,scale:{x:c.width/v.width,y:c.height/v.height}},title:b,extra:{resourceId:w.resourceId,effectId:w.id}})}new l.uV(s.c8.SHAPE,t.data,u).report(),new o.Ys(s.c8.SHAPE,t.data,u,!0,i.document.getPagePositionById(f)+1).report(),v.markModelApplyEnd(),r.waitRenderReady().then((()=>v.markEndTimeAndReport()))}(B,A,D,E,k,Z);break;case n.P.Text:!async function(e,t,i,r,n,a){const{data:o}=t,{effectId:d,resourceId:u,type:h,uri:g,md5:p,isDefaultFont:m,fontName:_}=o,y=new c.y(c.x.TEXT);y.markStartTime(),new l.uV(s.c8.TEXT,{...t.data,name:t.data.textKey,sourceFrom:"text"},n).report(),await v.fc.getInstance().parser.text.fetchData({id:u,resourceId:u,type:h,fileUrl:{url:g,md5:p},isDefaultFont:m}),v.fO.addEntries([{type:v.Mk.Local,id:d,resourceId:u,name:_,key:u}]),y.markDataDownloadEnd(),(0,f.n)(e,t,i,r,n,a),y.markModelApplyEnd(),r.waitRenderReady().then((()=>y.markEndTimeAndReport()))}(B,A,D,E,k,M);break;case n.P.Image:u(B,A,D,E,k,Z);break;case n.P.EverImage:y(B,A,D,E,k,Z,M);break;case n.P.TextTemplate:!function(e,t,i,r,u,h){var g;const{data:{name:p,md5:m,url:_,dependency:v,effectId:f,contentJSON:y,previewUrl:b,sdkExtra:x}}=t,w=new c.y(c.x.TEXT_TEMPLATE);w.markStartTime();const{id:S}=e;new l.uV(s.c8.TEXT,t.data,i).report();let P=!1;null===(g=r.loaders.textTemplateLoader.fetchData({id:m,resourceId:f,type:a.xP.SalesTextTemplate,fileUrl:{url:_,md5:m},dependency:v,sdkExtra:x,contentJSON:y,previewUrl:b}))||void 0===g||g.then((o=>{w.markDataDownloadEnd();const s=(0,d.G0)({type:n.P.TextTemplate,rsp:o,page:e,sourceData:t,triggerType:i,equalAssetWithLastAdd:h,renderSDK:u,graphicSDK:r});r.api.textTemplate.add(S,s,f,{from:a.yU.TextTemplate,templateId:f,templateName:p,templateEffectFilters:[]}),P=!0,w.markModelApplyEnd()})).finally((()=>{u.waitRenderReady().then((()=>w.markEndTimeAndReport())),new o.Ys(s.c8.TEXT,t.data,i,P,r.document.getPagePositionById(S)+1).report()}))}(B,A,k,D,E,Z);break;case n.P.Template:(0,_.U)(t,i,b,E,A,D,k);break;case n.P.Frame:!function(e,t,i,r,u,h){const{data:g}=t,{containerItems:_,aspect:v,name:f}=g,y=Boolean(_&&_.length&&1!==_.length);new l.vJ({...t.data,isMultilayerFrame:y},u).report();const b=new c.y(c.x.FRAME);b.markStartTime();const x=e.id,w=(0,p.Ln)(e.dimension),S=(0,m.SE)(n.P.Frame,w,{width:v,height:1}),P=_.map((e=>{let{layout:t,fill:i}=e;if(e.layout.normalized){const{x:i,y:r,width:n,height:a}=e.layout;t={width:S.width*n,height:S.height*a,x:S.width*i,y:S.height*(1-(r+a))}}const{originImage:r}=i;if(r){const{x:e=0,y:n=0,width:o=1,height:s=1}=r.layout;i={...i,originImage:{id:"",type:a.F5.IMAGE,src:r.src,layout:{height:t.height*s,opacity:1,scale:{x:1,y:1},width:t.width*o,x:t.width*e,y:t.height*(1-(n+s)),rotation:0}}}}return{...e,layout:t,fill:i}})),I=(0,d.G0)({type:n.P.Frame,page:e,sourceData:t,triggerType:u,equalAssetWithLastAdd:h,renderSDK:r,graphicSDK:i});i.api.imageContainer.add(x,{title:f,extra:{effectId:t.data.id,resourceId:t.data.resourceId,category:{name:g.sourceFrom,id:s.Ic}},items:P,layout:I}),b.markModelApplyEnd(),r.waitRenderReady().then((()=>b.markEndTimeAndReport())),new o.yx({...t.data,isMultilayerFrame:y},u,!0,i.document.getPagePositionById(x)+1).report()}(B,A,D,E,k,Z);break;case n.P.Grid:!function(e,t,i,r){const{data:n}=t,{grid:s,name:c}=n,d=s.areas.length;new l.nu({...t.data,gridCnt:d},r).report();const u=e.id,h=(0,p.Ln)(e.dimension),g={width:h.width,height:h.height,x:0,y:0};i.api.transaction.begin(),i.api.grid.add(u,s,{layout:g,title:c});const{dimension:m,layers:_}=i.api.page.getPageById(u),{width:v,height:f}=(0,p.Ln)(m),{id:y}=_[_.length-1];let b=_.length-1;for(;b>0;){b-=1;const{x:e,y:t,width:r,height:n,scale:{x:o,y:s}}=_[b].layout;if(e<=w&&t<=w&&e+r*o>=v-w&&t+n*s>=f-w)break;i.api.common.updatePosition(a.l7.SEND_BACKWARD,y)}i.api.transaction.commit(),new o.Od({...t.data,gridCnt:d},r,!0,i.document.getPagePositionById(u)+1).report()}(B,A,D,k);break;case n.P.YkImage:x(B,A,D,E,k,Z,M);break;case n.P.SvgSticker:S(B,A,D,E,k,Z)}}},42547:(e,t,i)=>{i.d(t,{ce:()=>s,qI:()=>a,zT:()=>o});var r=i(18571),n=i(56248);const a=(0,r.createContext)(null),o=(0,r.createContext)(null),s={editMode:n.G.none,dependence:{}}},9557:(e,t,i)=>{i.d(t,{K:()=>c,z:()=>d});var r,n=i(18571),a=i(56248);function o(e,t){switch(t.type){case r.OPEN_IMAGE_REPLACE_MODE:var i;return{...e,dropLayerId:null===(i=t.payload)||void 0===i?void 0:i.layerId,editMode:a.G.imageReplace};case r.OPEN_IMAGE_CONTAINER_REPLACE_MODE:var n;return{...e,dropLayerId:null===(n=t.payload)||void 0===n?void 0:n.layerId,editMode:a.G.imageContainerReplace};case r.OPEN_IMAGE_CUT_MODE:return{...e,dropLayerId:"",editMode:a.G.imageCut};case r.OPEN_IMAGE_CONTAINER_CUT_MODE:return{...e,dropLayerId:"",editMode:a.G.imageContainerCut};case r.CLOSE_EDIT_MODE:return{...e,dropLayerId:"",editMode:a.G.none,editModeChangeResolve:t.payload};case r.SET_DEPENDENCE:return{...e,dependence:{...e.dependence,...t.payload}};default:throw new Error(`Unknown editor action: ${t}`)}}!function(e){e.OPEN_IMAGE_REPLACE_MODE="openImageReplaceMode",e.OPEN_IMAGE_CONTAINER_REPLACE_MODE="openImageContainerReplaceMode",e.OPEN_IMAGE_CUT_MODE="openImageCutMode",e.OPEN_IMAGE_CONTAINER_CUT_MODE="openImageContainerCutMode",e.CLOSE_EDIT_MODE="closeEditMode",e.SET_DEPENDENCE="setDependence"}(r||(r={}));var s=i(42547),l=i(72322);function c({children:e}){const[t,i]=(0,n.useReducer)(o,s.ce);return(0,l.jsx)(s.qI.Provider,{value:t,children:(0,l.jsx)(s.zT.Provider,{value:i,children:e})})}function d({children:e,state:t,dispatch:i}){return(0,l.jsx)(s.qI.Provider,{value:t,children:(0,l.jsx)(s.zT.Provider,{value:i,children:e})})}},56248:(e,t,i)=>{var r;i.d(t,{G:()=>r}),function(e){e[e.none=0]="none",e[e.imageCut=1]="imageCut",e[e.imageContainerCut=2]="imageContainerCut",e[e.imageReplace=3]="imageReplace",e[e.imageContainerReplace=4]="imageContainerReplace"}(r||(r={}))},88722:(e,t,i)=>{i.d(t,{Ef:()=>p,Fk:()=>u,HP:()=>h,HX:()=>c,LS:()=>_,Mq:()=>g,mB:()=>m,sI:()=>d});var r=i(92204),n=i(56333),a=i(39113),o=i(8757);const s=a.default.tool.model,l=a.default.model.tool,c={[o.zI.SHADOW]:[{label:"Opacity",key:"opacity",i18n:"web_image_edge_text_shadow_opacity"},{label:"Blur",key:"blur",i18n:"web_image_edge_text_shadow_blur"},{label:"Size",key:"size",i18n:"web_image_edge_text_shadow_size",min:50,max:200,percent:!0},{label:"Distance",key:"distance",i18n:"web_image_edge_text_shadow_distance"},{label:"Angle",key:"angle",i18n:"web_image_edge_text_shadow_angle",min:-180,max:180,center:0,toTool:l.shadowAngle,toModel:s.shadowAngle}],[o.zI.OUTLINE]:[{label:"Opacity",key:"opacity",i18n:"web_image_edge_text_outline_opacity"},{label:"Size",key:"size",i18n:"web_image_edge_text_outline_size"}],[o.zI.GLOW]:[{label:"Opacity",key:"opacity",i18n:"web_image_edge_text_glow_opacity"},{label:"Size",key:"size",i18n:"web_image_edge_text_glow_size"},{label:"Blur",key:"blur",i18n:"web_image_edge_text_glow_blur"}],[o.zI.FEATHER]:[]},d=[{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_shadow_01.png",config:[{type:o.zI.SHADOW,color:[0,0,0,1],blur:.9,size:1.06,distance:0,angle:0}],name:"Shadow 1",key:"internal_shadow_1"},{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_shadow_02.png",config:[{type:o.zI.SHADOW,color:[0,0,0,.93],blur:1,size:1.02,distance:.15,angle:-45}],name:"Shadow 2",key:"internal_shadow_2"},{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_shadow_03.png",config:[{type:o.zI.SHADOW,color:[0,0,0,1],blur:0,size:1,distance:.2,angle:-45}],name:"Stroke",key:"internal_shadow_3"},{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_outline_01.png",config:[{type:o.zI.OUTLINE,color:[0,0,0,1],size:.6}],name:"Outline",key:"internal_outline_1"},{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_glow_01.png",config:[{type:o.zI.GLOW,color:[250,250,167,1],size:1,blur:.7}],name:"Glow",key:"internal_glow"},{previewUrl:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/graphic-post-process-effects/1695629050381/internal_feather_01.png",config:[{type:o.zI.FEATHER,size:.2}],name:"Feather",key:"internal_feather"}],u={[o.zI.OUTLINE]:r.SY.ImageOutline,[o.zI.SHADOW]:r.SY.ImageShadow,[o.zI.FEATHER]:r.SY.ImageFeather,[o.zI.GLOW]:r.SY.ImageGlow},h={[o.zI.OUTLINE]:n.Xk.ClickOutline,[o.zI.SHADOW]:n.Xk.ClickShadow,[o.zI.FEATHER]:n.Xk.ClickFeather,[o.zI.GLOW]:n.Xk.ClickGlow},g={[o.zI.OUTLINE]:n.Xk.CancelOutline,[o.zI.SHADOW]:n.Xk.CancelShadow,[o.zI.FEATHER]:n.Xk.CancelFeather,[o.zI.GLOW]:n.Xk.CancelGlow},p={[o.zI.OUTLINE]:n.Xk.AdjustOutline,[o.zI.SHADOW]:n.Xk.AdjustShadow,[o.zI.FEATHER]:n.Xk.AdjustFeather,[o.zI.GLOW]:n.Xk.AdjustGlow},m={[o.zI.OUTLINE]:n.Xk.EnterOutlineColor,[o.zI.SHADOW]:n.Xk.EnterShadowColor,[o.zI.GLOW]:n.Xk.EnterGlowColor},_={[o.zI.OUTLINE]:n.Xk.EditOutlineColor,[o.zI.SHADOW]:n.Xk.EditShadowColor,[o.zI.GLOW]:n.Xk.EditGlowColor}},41926:(e,t,i)=>{i.d(t,{C:()=>r,V:()=>n});const r=Object.freeze({Basic:Symbol("Basic"),Presets:Symbol("Presets"),Adjust:Symbol("Adjust"),AiTool:Symbol("AiTool"),BorderColor:Symbol("BorderColor"),BorderStyle:Symbol("BorderStyle"),Cutout:Symbol("BorderColor"),ColorFill:Symbol("ColorFill"),Filter:Symbol("Filter"),Effect:Symbol("Effect"),EffectV2:Symbol("EffectV2"),Opacity:Symbol("Opacity"),Background:Symbol("Background"),Resize:Symbol("Resize"),Arrange:Symbol("Arrange"),ColorTheme:Symbol("ColorTheme"),Lock:Symbol("Lock"),GridSetting:Symbol("GridSetting"),MultiColorFill:Symbol("MultiColorFill"),ShapeBasic:Symbol("ShapeBasic")}),n={normal:[r.Basic,r.ShapeBasic,r.Presets,r.ColorFill,r.MultiColorFill,r.BorderColor,r.BorderStyle,r.ColorTheme,r.Filter,r.Effect,r.EffectV2,r.Cutout,r.Adjust,r.AiTool,r.Opacity,r.Background,r.Resize,r.GridSetting,r.Arrange,r.Lock]}},54714:(e,t,i)=>{i.d(t,{$u:()=>h,GW:()=>m,I9:()=>r,MR:()=>x,Tt:()=>v,Tv:()=>n,US:()=>g,W0:()=>a,WO:()=>u,Ye:()=>f,dN:()=>w,g:()=>y,hx:()=>p,i1:()=>l,n7:()=>d,qr:()=>c,sS:()=>b,xA:()=>_});var r,n,a,o=i(92204),s=i(8757);!function(e){e[e.idle=0]="idle",e[e.firstPainted=1]="firstPainted"}(r||(r={})),function(e){e.PNG="PNG",e.JPEG="JPEG",e.PDF="PDF"}(n||(n={})),function(e){e.Success="Success",e.Failed="Failed",e.None="None"}(a||(a={}));const l={Success:"flex",Failed:"flex",None:"none"},c={PNG:s.HY.PNG,JPEG:s.HY.JPEG},d=[{label:"High",value:.9},{label:"Medium",value:.6},{label:"Low",value:.4}],u=[{ratio:.5,maxWidth:50,maxHeight:50,minWidth:50,minHeight:50,resolutionPrefix:"0.5x"},{ratio:1,maxWidth:100,maxHeight:100,minWidth:100,minHeight:100,resolutionPrefix:"1x"},{ratio:1.5,maxWidth:150,maxHeight:150,minWidth:150,minHeight:150,resolutionPrefix:"1.5x"},{ratio:2,maxWidth:200,maxHeight:200,minWidth:200,minHeight:200,resolutionPrefix:"2x"},{ratio:3,maxWidth:300,maxHeight:300,minWidth:300,minHeight:300,resolutionPrefix:"3x"},{ratio:4,maxWidth:400,maxHeight:400,minWidth:400,minHeight:400,resolutionPrefix:"4x"}];var h,g,p,m,_,v;!function(e){e.ClickEvent="click",e.DragEvent="drag",e.ClickWithSelect="click_width_select",e.OuterPaste="outer_paste",e.DragEventWithClick="drag_with_click",e.ShortKey="shortkey",e.AutoColor="auto_color"}(h||(h={})),function(e){e.empty="empty",e.dashed="dashed",e.solid="solid"}(g||(g={})),function(e){e.Background="background",e.Outline="outline",e.Shadow="shadow",e.Glow="glow",e.Curve="curve"}(p||(p={})),function(e){e[e.AddHorizontalGuide=0]="AddHorizontalGuide",e[e.AddVerticalGuide=1]="AddVerticalGuide",e[e.LockAllGuides=2]="LockAllGuides",e[e.UnlockAllGuides=3]="UnlockAllGuides",e[e.RemoveAllGuides=4]="RemoveAllGuides"}(m||(m={})),function(e){e[e.Forward=0]="Forward",e[e.Front=1]="Front",e[e.Backward=2]="Backward",e[e.Back=3]="Back"}(_||(_={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(v||(v={}));const f={[s.l7.BRING_FORWARD]:_.Forward,[s.l7.BRING_TO_FRONT]:_.Front,[s.l7.SEND_BACKWARD]:_.Backward,[s.l7.SEND_TO_BACK]:_.Back},y={[_.Forward]:s.l7.BRING_FORWARD,[_.Front]:s.l7.BRING_TO_FRONT,[_.Backward]:s.l7.SEND_BACKWARD,[_.Back]:s.l7.SEND_TO_BACK},b={[v.Horizontal]:o.B$.FLIP_HORIZONTAL,[v.Vertical]:o.B$.FLIP_VERTICAL};var x;!function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right",e[e.Top=3]="Top",e[e.Middle=4]="Middle",e[e.Bottom=5]="Bottom",e[e.Vertical=6]="Vertical",e[e.Horizontal=7]="Horizontal"}(x||(x={}));const w={[x.Left]:o.B$.ALIGN_LEFT,[x.Right]:o.B$.ALIGN_RIGHT,[x.Center]:o.B$.ALIGN_CENTER,[x.Top]:o.B$.ALIGN_TOP,[x.Middle]:o.B$.ALIGN_MIDDLE,[x.Bottom]:o.B$.ALIGN_BOTTOM,[x.Vertical]:o.B$.ALIGN_DISTRIBUTE_VERTICAL,[x.Horizontal]:o.B$.ALIGN_DISTRIBUTE_HORIZONTAL}},71942:(e,t,i)=>{var r;i.d(t,{P:()=>r}),function(e){e.Text="Text",e.Image="Image",e.Frame="Frame",e.Grid="Grid",e.Shape="Shape",e.Line="Line",e.TextTemplate="TextTemplate",e.Template="Template",e.EverImage="EverImage",e.YkImage="YkImage",e.SvgSticker="SvgSticker"}(r||(r={}))},69792:(e,t,i)=>{i.d(t,{M$:()=>l,SE:()=>s});var r=i(67986),n=i(71942);function a(e,t){const{width:i,height:r}=e,n=i>r?r:i;return{width:i-n*t,height:r-n*t}}function o(e,t,i){const o=function(e,t){switch(e){case n.P.EverImage:case n.P.YkImage:return a(t,.4);case n.P.Image:case n.P.SvgSticker:case n.P.Frame:case n.P.Grid:case n.P.Shape:case n.P.Line:case n.P.TextTemplate:return a(t,.7);case n.P.Template:return{width:.8*t.width,height:.8*t.height};default:return r.t.error(`[getFitRect]type error: ${e} is invalid;`),t}}(e,t),s=i?i.width/i.height:1;return o.width/o.height<s?{width:o.width,height:o.width/s}:{width:o.height*s,height:o.height}}function s(e,t,i){return e===n.P.Line?function(e,t){const i=e.width/e.height;if(null==t||!t.height)return e;const r=t.height;return{height:r,width:r*i}}(o(e,t,i),i):function(e){const t=e.width/e.height,i={...e};return Math.min(i.width,i.height)>=40||(i.width<i.height?(i.width=40,i.height=40/t):(i.width=40*t,i.height=40)),i}(o(e,t,i))}function l(e){const t=document.querySelectorAll("[data-page-index]");if(!t)return;const i=e.getActivePageIndex(),r=Array.from(t).find((e=>Number(e.dataset.pageIndex)===i));return null==r?void 0:r.getBoundingClientRect()}},49047:(e,t,i)=>{i.d(t,{D:()=>a,h:()=>g});var r,n,a,o=i(58714),s=i(25222),l=i(36702),c=i(25062),d=i(24451),u=i(27175),h=i(72322);!function(e){e.ApplyCurrent="applyCurrent",e.ApplyNew="applyNew"}(n||(n={})),function(e){e.Cancel="cancel",e.ApplyCurrent="applyCurrent",e.ApplyNew="applyNew"}(a||(a={}));class g{constructor(e,t){this._storageService=e,this._graphicEnvironmentService=t,this._rememberChoice=!1}_getData(){const e=this._storageService.keyValue.queryAndParse(g.APPLY_TEMPLATE_TO_NEW_PAGE_STORAGE_KEY,JSON.parse);return e.ok&&e.value?e.value:{}}_getChoice(){const e=this._storageService.keyValue.query(g.APPLY_TEMPLATE_CHOICE_STORAGE_KEY);return e.ok&&e.value?e.value:void 0}_setChoice(e){this._storageService.keyValue.set(g.APPLY_TEMPLATE_CHOICE_STORAGE_KEY,e)}_showApplyTemplateToNewPageConfirmModal(){this._rememberChoice=!1;const e=e=>{this._rememberChoice=e};return new Promise((t=>{(0,o.gU)(o.wo.show),l.Z.confirm({icon:null,title:u.ZP.t("web_add_template_new_title",{},"Add template as new page?"),content:(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(c.Z,{onChange:e,children:u.ZP.t("web_remember_my_choice",{},"Remember my choice")})}),onCancel:()=>{t(a.Cancel)},escToExit:!1,maskClosable:!1,footer:()=>(0,h.jsxs)("div",{style:{display:"flex",flexWrap:"wrap-reverse",justifyContent:"flex-end"},children:[(0,h.jsx)(d.Z,{style:{marginLeft:0,marginTop:8},onClick:()=>{this._rememberChoice&&this._setChoice(n.ApplyCurrent),(0,o.gU)(o.wo.replace,this._rememberChoice?o.xq.on:o.xq.off),t(a.ApplyCurrent),l.Z.destroyAll()},children:u.ZP.t("web_replace_current_page",{},"Replace current page")}),(0,h.jsx)(d.Z,{style:{marginLeft:16,marginTop:8},onClick:()=>{this._rememberChoice&&this._setChoice(n.ApplyNew),(0,o.gU)(o.wo.addNew,this._rememberChoice?o.xq.on:o.xq.off),t(a.ApplyNew),l.Z.destroyAll()},type:"primary",children:u.ZP.t("web_add_template_new_confirm",{},"Add as new page")})]}),okButtonProps:{type:"primary"}})}))}isApplyTemplateToNewPage(e,t){if(this._graphicEnvironmentService.editorType!==s.gg.Main)return Promise.resolve(a.ApplyCurrent);const i=this._getData(),r=this._getChoice(),o=Boolean(i[e]);return t<=0?Promise.resolve(a.ApplyCurrent):r?r===n.ApplyNew?Promise.resolve(a.ApplyNew):Promise.resolve(a.ApplyCurrent):o?this._showApplyTemplateToNewPageConfirmModal():Promise.resolve(a.ApplyCurrent)}setPageNotModifyAfterApplyTemplate(e){const t=this._getData();t[e]=!1,this._storageService.keyValue.set(g.APPLY_TEMPLATE_TO_NEW_PAGE_STORAGE_KEY,JSON.stringify(t))}setPageModifyAfterApplyTemplate(e){const t=this._getData();"boolean"!=typeof t[e]||t[e]||(t[e]=!0,this._storageService.keyValue.set(g.APPLY_TEMPLATE_TO_NEW_PAGE_STORAGE_KEY,JSON.stringify(t)))}}(r=g).APPLY_TEMPLATE_TO_NEW_PAGE_STORAGE_KEY="APPLY_TEMPLATE_TO_NEW_PAGE_STORAGE_KEY",r.APPLY_TEMPLATE_CHOICE_STORAGE_KEY="APPLY_TEMPLATE_CHOICE_STORAGE_KEY"},64525:(e,t,i)=>{i.d(t,{U:()=>x,s:()=>f});var r=i(82440),n=i(8757),a=i(17882),o=i(24191),s=i(75924),l=i(68967),c=i(67986),d=i(14415),u=i(10224),h=i(888),g=i(56268),p=i(92204),m=i(25222),_=i(9670),v=i(49047);function f(e,t){if(!t)return[];const{effects:i=[],localImages:a,replaceableImages:l,ykImages:c}=t||{},d=i.map((t=>{const{md5:i,url:a,resourceId:s,name:l,effectId:c,dependency:d}=t;switch(null==t?void 0:t.panel){case o.hm.SalesTextTemplate:var u;return null!==(u=e.loaders.textTemplateLoader.fetchData({id:s,resourceId:s,type:n.xP.SalesTextTemplate,fileUrl:{url:a,md5:i},dependency:d}))&&void 0!==u?u:Promise.resolve({});case o.hm.SalesFont:{const e=r.fc.getInstance().parser.text.fetchData({id:c,name:l,resourceId:s,type:n.xP.SalesFont,fileUrl:{url:a,md5:i}});return r.fO.addEntries([{key:s,id:c,name:l,resourceId:s,type:r.Mk.Local}]),e}case o.hm.SalesSticker:{const{stickerImage:e}=t;return r.fc.getInstance().parser.image.fetchData({id:s,name:l,resourceId:s,type:n.xP.SalesSticker,fileUrl:{url:a,md5:i},extraInfo:{stickerImage:e}})}case o.hm.SalesFilter:case o.hm.SalesImageEffect:return r.fc.getInstance().parser.filter.fetchData({id:c,resourceId:s,type:(null==t?void 0:t.panel)===o.hm.SalesFilter?n.xP.SalesFilter:n.xP.SalesImageEffect,fileUrl:{url:a,md5:i}});case o.hm.SalesFrame:return r.fc.getInstance().parser.frame.load({id:c,resourceId:s,type:n.xP.SalesFrame,fileUrl:{url:a,md5:i},content:t.contentJSON,extra:t.sdkExtra,imageFiles:t.imageFiles});case o.hm.SalesTextGlow:return r.fc.getInstance().parser.textGlow.fetchData({name:t.name,id:s,resourceId:s,resource:c.source,type:n.xP.SalesTextGlow,fileUrl:{url:a,md5:i}});default:return new Promise((e=>e({})))}}));if(null==a||a.forEach((e=>{const{uri:t,path:i,full_url:a}=e;r.fc.setDependency(t,{type:n.xP.ImageInTemplate,localImage:{uri:t,path:i,url:a},transcode:e.transcode,resourceId:t,id:t})})),null==l||l.forEach((e=>{const{uri:t,path:i,full_url:a}=e;r.fc.setDependency(e.uri,{type:n.xP.ImageInTemplate,localImage:{uri:t,path:i,url:a},transcode:e.transcode,resourceId:e.uri,id:e.uri})})),c){const e=c.map((e=>{if(!e)return null;const{resourceId:t,cardUrl:i,previewUrl:r,orderInfo:a,source:o}=(0,s.tv)(e);return{id:t,resourceId:t,type:n.xP.YkImage,fileUrl:{md5:"",url:null!=r?r:i},previewUrl:i,orderInfo:a,resource:o===n.iJ.TuChong?n.UI.TuChong:n.UI.HeyPan}})).filter((e=>Boolean(e)));r.fc.getInstance().parser.ykImage.batchFetchData(e)}return d}async function y(e,t,i){const a=e.length;let o=0;let s,l,h=0;function g(e){if(e.type===n.F5.IMAGE&&e.replaceable){const{layout:t}=e,i=t.width*t.scale.x+t.height*t.scale.y;i>h&&(h=i,s=e)}else if(e.type===n.F5.IMAGE_CONTAINER){const t=e;for(const e of t.items)if(e.fill.fillType===n.lm.IMAGE&&e.fill.canUpdate){const i=e.fill.image,{layout:r}=e,n={width:r.width*t.layout.scale.x,height:r.height*t.layout.scale.y},a=n.width+n.height;a>h&&(h=a,s=i,l=e)}}else if(e.type===n.F5.GROUP_LAYER)for(const t of e.children)g(t)}t.background.image&&(s=t.background.image);try{if(!s)for(const e of t.layers)g(e);if(s){const{src:t,clipRect:c,layout:h}=await async function(t,s){var l;const c=e[o];o++,o>=a&&(o=0);const h={id:c,md5:c,resourceId:c,type:n.lJ.CloudImageSticker},g=null===(l=r.fc.getDependency(c))||void 0===l?void 0:l.content,p=await(0,d.p)(g);if(s)return{src:h,layout:u.U.calImageLayoutToFillContainer({width:s.layout.width,height:s.layout.height,path:s.path},{width:p.width,height:p.height,scale:{x:1,y:1},x:0,y:0})};return{src:h,clipRect:i.accessors.image.transformClipRect({width:p.width,height:p.height},t.layout)}}(s,l);s.src=t,h?s.layout=Object.assign(s.layout,h):c&&(s.layout.clipRect=c)}}catch(p){c.t.error("Failed to replace cover image",p)}}const b=(e,t)=>!t.isApplyNewPage&&e.api.common.switchPreviewMode(t.preview,t.pageId,t.url,t.cancelCallback);async function x(e,t,i,r,s,d,u,f){var x;const{id:w,name:S,category:P,categoryId:I,previewUrl:C,getTemplateDetail:E,sourceFrom:D,extraParams:A}=s.data,L=r.getActivePageId(),k=new v.h(i,t),R=r.accessors.page.getActivePage(),M=await k.isApplyTemplateToNewPage(L,null!==(x=null==R?void 0:R.layers.length)&&void 0!==x?x:0);if(M===v.D.Cancel)return;const T=new g.y(g.x.TEMPLATE),j=Date.now();T.markStartTime();const N=r.getActivePageIndex()+1,B=void 0!==(null==f?void 0:f.insertPosition);let Z=!1;b(d,{preview:!0,pageId:L,url:C,cancelCallback:()=>{Z=!0},isApplyNewPage:B});const O=await E().catch((e=>{throw b(d,{preview:!1,pageId:L,isApplyNewPage:B}),new h.qc(s.data,u,!1,N).report(),e}));if(T.markDataDownloadEnd(),Z||!O)return void b(d,{preview:!1,pageId:L,isApplyNewPage:B});const{templateData:K,materials:F,templateVersion:G,creator:U}=O;let H=!1;if(K&&F){const i=await function(e,t,i,r,n,s,d){Array.isArray(n)||(n=[n]);const u=n.map(((e,t)=>{let r=!1;const{width_v2:n,height_v2:a}=e.canvas,o=d[t],s=i.document.getDimension(o);return n/a!=s.width/s.height&&(r=!0),{needAutoLayout:r,dimension:r?void 0:s}})),{document:h,error:g}=a.m.templateToModel({id:e,creator:t,protoVersion:r,protoTemplate:n,dimensions:u.map((e=>e.dimension)),options:{localImages:s.localImages,replaceableImages:s.replaceableImages}});return g?Promise.resolve(void 0):Promise.all(n.map((async(e,t)=>{const{needAutoLayout:r}=u[t],n=h.pages[t];if(!r)return n;const a=d[t];try{var s;const e=i.aigc.getAutoLayoutDraft(n.id,h),t=(await o.RA.getAiAutoLayoutResult(e,[i.document.getDimension(a)],null!==(s=(0,l.gO)().workspaceId)&&void 0!==s?s:"0"))[0];if(t){const e=i.aigc.getAutoLayoutResult({id:n.id,draftDiff:t,document:h,dimension:i.document.getDimension(a)});if(e)return e}}catch(g){c.t.error("auto transform ratio template fail",g)}return i.page.getAutoLayoutResult(n.id,i.document.getDimension(a),h)})))}(w,U,d.api,G,K,F,[L]);if(!Z&&null!=i&&i.length){const{evercloud:t}=e.materialsInCanvas;if(r.isCoverEditorType()&&1===t.length)for(const e of i)await y(t,e,r);const a={from:n.yU.Template,templateName:S,templateId:w,templateCategory:D,templateCategoryId:p.Ic,templateChannel:null==A?void 0:A.currentTagName,templateEffectFilters:F.effects.reduce(((e,t)=>[o.hm.SalesFilter,o.hm.SalesImageEffect].includes(t.panel)?e.concat(t.resourceId):e),[])};b(d,{preview:!1,pageId:L,isApplyNewPage:B});const s=i.length>1,l=B?null==f?void 0:f.insertPosition:r.getActivePageIndex()+1;if(B||M===v.D.ApplyNew){d.api.transaction.begin(),d.api.page.add(l,{dimension:{...R.dimension}});const e=r.accessors.page.getPageIdByIndex(l);d.api.template.applyTemplate(i,a,e),k.setPageNotModifyAfterApplyTemplate(e),d.api.transaction.commit()}else d.api.template.applyTemplate(i,a,s?void 0:L),k.setPageNotModifyAfterApplyTemplate(L);H=!0,T.markModelApplyEnd()}r.waitRenderReady().then((()=>{if(T.markEndTimeAndReport(),t.editorType===m.gg.EditorPC){const e=Date.now()-j;_.k.getInstance().reportTemplateAddPageTimeCost({time_consumed:e})}}))}H||b(d,{preview:!1,pageId:L,isApplyNewPage:B}),new h.qc(s.data,u,H,N).report()}},47552:(e,t,i)=>{i.d(t,{d:()=>h});var r=i(7290),n=i(24191),a=i(26950);const o=n.hm.SalesTextGlow,s=r.u.getInstance().buildLoader(o,[new a.BF(o),new a.uo(o)]);r.u.getInstance().register(o,s);var l=i(82440),c=i(8757),d=i(67986);let u;async function h(){try{const e=await async function(){if(u)return u;const e={category:n.xZ.All,limit:1,offset:0,sortingPosition:0,panel:n.hm.SalesTextGlow},t=await r.u.getInstance().get(o).fetchCategoryEffectsAll(e);return u=t.list[0],u}();return await l.fc.getInstance().parser.textGlow.fetchData({id:e.resourceId,resourceId:e.resourceId,from:l.yM.USER_USE,fileUrl:{url:e.url,md5:e.md5},type:c.xP.SalesTextGlow}),e.resourceId}catch(e){return d.t.error("Failed to load glow resource"),""}}},78947:(e,t,i)=>{i.d(t,{n:()=>d});var r=i(44362),n=i(91372),a=i(71942),o=i(54714),s=i(92204),l=i(888),c=i(14283);function d(e,t,i,d,u,h){const{data:g}=t,{text:p,fontSize:m,effectId:_,resourceId:v,color:f,boldWidth:y,lineMaxWidth:b=-1,textOuterRect:x}=g,w="text",{defaultWidth:S,defaultHeight:P}=g,{id:I}=e,C=(0,c.G0)({type:a.P.Text,sourceData:t,triggerType:u,renderSDK:d}),E=d.accessors.page.getAverageLuminanceByRange(C);i.api.text.add(I,p,{layout:C,innerPadding:.1,lineMaxWidth:b,richText:JSON.stringify(r.Q.toJSON({text:p,fontSize:m,boldWidth:y,font:{id:_,resourceId:v,fallbackTextInfoList:[]},color:u!==o.$u.OuterPaste?(0,n.Zs)(f,E):f})),fontDependResources:[{id:_,resourceId:v}],fallbackFontResources:[],extra:{textOuterRect:null!=x?x:{width:S,height:P},category:{name:w,id:s.Ic}}});const D=o.$u.ClickEvent===u?o.$u.ClickWithSelect:u;new l.Ys(s.c8.TEXT,{...t.data,name:t.data.textKey,sourceFrom:w},D,!0,i.document.getPagePositionById(I)+1,Boolean(null==h?void 0:h.isFromCapcut)).report()}},14283:(e,t,i)=>{i.d(t,{G0:()=>h,US:()=>d,ZB:()=>g});var r=i(8757),n=i(71942),a=i(69792),o=i(91372),s=i(54643),l=i(61619),c=i(54714);const d=(e,t,i)=>{const r=null!=i?i:t.accessors.page.getPageVisibleRect(),{x:n,y:a,width:o,height:s,scale:l={x:1,y:1}}=e,c=n,d=n+o*l.x,u=a,h=a+s*l.y,g=r.x,p=r.x+r.width,m=r.y,_=r.y+r.height;return!(c>=p||d<=g||u>=_||h<=m)},u=e=>{const{rsp:t,renderSDK:i,page:l,sourceData:u,triggerType:h,equalAssetWithLastAdd:g,graphicSDK:p}=e,{sourceRect:m,dropPosition:_}=u,v=i.accessors.page.getPageVisibleRect(),{x:f,y,width:b,height:x}=v,w=(0,s.Ln)(l.dimension),S=(0,a.SE)(n.P.TextTemplate,w,m),P=f+b/2-S.width/2,I=y+x/2-S.height/2,C=(e=>{let t=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;const a={x:1,y:1};for(const o of e){const{x:e=0,y:s=0,width:l=0,height:c=0,scale:d=a}=o.layout;t=Math.min(e,t),i=Math.min(s,i),r=Math.max(e+l*d.x,r),n=Math.max(s+c*d.y,n)}return{x:t,y:i,width:r-t,height:n-i}})(t),E=S.width/m.width;let D,A;if(h===c.$u.DragEvent)D=_.x-C.x*E,A=_.y-C.y*E;else if(g){var L;const e=null===(L=p.api.common.getLayersByFilter(!1,(()=>!0)).slice(-1))||void 0===L?void 0:L[0],{x:t,y:r}=e.layout,n={x:t+.02*w.width,y:r+.02*w.height,width:S.width,height:S.height};d(n,i,v)?(D=n.x,A=n.y):(D=P-C.x*E,A=I-C.y*E)}else D=P-C.x*E,A=I-C.y*E;const k=t.map((e=>(e.layout.x=(e.layout.x*E||0)+D,e.layout.y=(e.layout.y*E||0)+A,e.layout.scale={x:e.layout.scale.x*E,y:e.layout.scale.y*E},((e,t)=>{const i={x:t.layout.x,y:t.layout.y,width:t.layout.width*t.layout.scale.x,height:t.layout.height*t.layout.scale.y};if(t.type!==r.F5.TEXT)return t;const n=e.accessors.page.getAverageLuminanceByRange(i),a=JSON.parse(t.richText);a.styles.forEach((e=>{var t;if(e.fill&&"gradient"!==(null===(t=e.fill)||void 0===t?void 0:t.content.render_type)){const{color:t,alpha:i=1}=e.fill.content.solid,[r,a,s]=t.map((e=>Math.round(255*e))),l=(0,o.Zs)([r,a,s,i],n);e.fill.content.solid={color:l.slice(0,3).map((e=>e/255)),alpha:l[3]}}})),t.richText=JSON.stringify(a)})(i,e),e)));return k},h=e=>{switch(e.type){case n.P.Shape:case n.P.Line:case n.P.Image:case n.P.EverImage:case n.P.Frame:case n.P.YkImage:case n.P.SvgSticker:return(e=>{var t;const{type:i,page:r,sourceData:o,triggerType:l,equalAssetWithLastAdd:u,renderSDK:h,graphicSDK:g}=e,{sourceRect:p,dropPosition:m,data:_}=o,{width:v,height:f}=(0,s.Ln)(r.dimension);let y;if(i===n.P.Frame){const{aspect:e}=_;y=(0,a.SE)(n.P.Frame,{width:v,height:f},{width:e,height:1})}else y=(0,a.SE)(i,{width:v,height:f},p);if(![c.$u.ClickEvent,c.$u.ShortKey,c.$u.OuterPaste].includes(l))return{...null!=m?m:{x:0,y:0},width:y.width,height:y.height};const b=h.accessors.page.getPageVisibleRect(),{x,y:w,width:S,height:P}=b,I={x:x+S/2-y.width/2,y:w+P/2-y.height/2,width:y.width,height:y.height};if(!u)return I;const C=null===(t=g.api.common.getLayersByFilter(!1,(()=>!0)).slice(-1))||void 0===t?void 0:t[0];if(null==C||!C.layout)return I;const{x:E,y:D}=C.layout,A={x:E+.02*v,y:D+.02*f,width:y.width,height:y.height};return d(A,h,b)?A:I})(e);case n.P.Text:return(e=>{const{sourceData:t,triggerType:i,renderSDK:r}=e,{position:n,data:a}=t,{defaultWidth:o,defaultHeight:s}=a;if(n)return{...n,width:o,height:s};const{dropPosition:l}=t,u=r.accessors.selection.getSelectedMaterials(),h=r.accessors.layer.getLayerById(u[0]),g=h&&[c.$u.ClickEvent,c.$u.OuterPaste,c.$u.ShortKey].includes(i),p=r.accessors.page.getPageVisibleRect(),{x:m,y:_,width:v,height:f}=p,y={x:m+v/2-o/2,y:_+f/2-s/2,width:o,height:s};if(!g)return l?{...l,width:o,height:s}:y;const b={x:h.layout.x,y:h.layout.y+h.layout.height*h.layout.scale.y,width:o,height:s};return d(b,r,p)?b:y})(e);case n.P.TextTemplate:return u(e);default:return}},g=(e,t,i)=>{const r=t.document.getPageByChildLayerId(e[0]);if(!r){return[...e].reduce(((e,t)=>({...e,[t]:{x:0,y:0}})),{})}const n={},{width:a,height:o}=(0,s.Ln)(r.dimension),c=.02*a,u=.02*o,h=i.accessors.page.getPageVisibleRect(),{x:g,y:p,width:m,height:_}=h,v={};let f=!1;return e.forEach(((e,t)=>{const s=r.getLayerAccessRoad(e),y=s.length>2?s[s.length-2]:e,b=r.getLayerById(y),{layout:x}=b,w={x:x.x+c,y:x.y+u},S={x:g+m/2-x.width*x.scale.x/2+c*t,y:p+_/2-x.height*x.scale.y/2+u*t};if(n[e]=w,v[e]=S,!f){const e=(0,l.i)({...x,...w},{width:a,height:o});d({...x,...w},i,h)&&e||(f=!0)}})),f?v:n}},33015:(e,t,i)=>{i.d(t,{x:()=>n});var r=i(8757);i(82440);class n{constructor(e,t){this._editor=e,this._forceUpdate=t}get userOperationManager(){return this._editor.userOperationManager}get selectedLayerType(){var e,t,i;return null!==(e=null===(t=this.selectedMaterial)||void 0===t||null===(t=t.subMaterial)||void 0===t?void 0:t.type)&&void 0!==e?e:null===(i=this.selectedMaterial)||void 0===i?void 0:i.type}get isSelectedMultiLayer(){var e;return(null===(e=this.selectedMaterials)||void 0===e?void 0:e.length)>1}get isSelectedPage(){return 1===this.selectedMaterials.length&&this.selectedMaterials[0].type===r.F5.PAGE}get selectedMaterials(){return this._editor.getSelectedMaterials()}get selectedMaterial(){var e;return null===(e=this.selectedMaterials)||void 0===e?void 0:e[0]}get selectedIds(){var e,t;return null!==(e=null===(t=this.selectedMaterials)||void 0===t?void 0:t.map((e=>{var t,i;return null!==(t=null==e||null===(i=e.subMaterial)||void 0===i?void 0:i.id)&&void 0!==t?t:e.id})))&&void 0!==e?e:[]}get selectedId(){var e,t,i;return null!==(e=null===(t=this.selectedMaterial)||void 0===t||null===(t=t.subMaterial)||void 0===t?void 0:t.id)&&void 0!==e?e:null===(i=this.selectedMaterial)||void 0===i?void 0:i.id}get selectedTopId(){var e;return null===(e=this.selectedMaterial)||void 0===e?void 0:e.id}get selectedTopLayerType(){var e;return null===(e=this.selectedMaterial)||void 0===e?void 0:e.type}get selectIndex(){var e,t,i;return null!==(e=null===(t=this.selectedMaterial)||void 0===t||null===(t=t.subMaterial)||void 0===t?void 0:t.selectIndex)&&void 0!==e?e:null===(i=this.selectedMaterial)||void 0===i?void 0:i.selectIndex}get accessors(){var e;return null===(e=this._editor)||void 0===e||null===(e=e.getRenderSDK())||void 0===e?void 0:e.accessors}get graphicApi(){var e;return null===(e=this._editor)||void 0===e||null===(e=e.getGraphicSDK())||void 0===e?void 0:e.api}isAttachBgImage(){const e=this._editor.getRenderSDK().getActivePageId(),t=this._editor.getRenderSDK().accessors.page.getBackgroundImage(e);return Boolean(t)&&this.isSelectedPage}isSelectedLayerLocked(){const{accessors:e}=this;return this.selectedIds.length>0&&e.layer.isLocked(this.selectedIds)}getBatchEditorMainLayerInfoByLayerId(e){return this.accessors.layer.getBatchEditorMainLayerInfoByLayerId(e)}getLayerById(e){return this._editor.getRenderSDK().model.getLayerById(e)}isImageContainer(e=this.selectedId){const t=this._editor.getRenderSDK().accessors.layer.getLayerById(null!=e?e:this.selectedId);return(null==t?void 0:t.type)===r.F5.IMAGE_CONTAINER}isGrid(e=this.selectedId){const t=this._editor.getRenderSDK().accessors.layer.getLayerById(null!=e?e:this.selectedId);return(null==t?void 0:t.type)===r.F5.GRID}isShowInImageContainer(e){const{id:t=this.selectedId,index:i=this.selectIndex}=null!=e?e:{};return this.accessors.imageContainer.hasFillImage(t,i)}isShowInGrid(e){const{id:t=this.selectedId,index:i=this.selectIndex}=null!=e?e:{};return Boolean(this.accessors.grid.getSelectImageByIndex(t,i))}}},20152:(e,t,i)=>{i.d(t,{L:()=>n});var r=i(33015);class n extends r.x{get renderSDK(){return this._editor.getRenderSDK()}get graphicSDK(){return this._editor.getGraphicSDK()}setContextmenuPos(e){this.contextmenuPos=e}setContextmenuArea(e){this.contextmenuArea=e}}},78936:(e,t,i)=>{i.d(t,{Q:()=>n});var r=i(47946);const n=e=>t=>{const{toolbar:i,contextmenu:n,suspendTool:a}=e;i&&(r.Z.toolbar.registerController(i.name,t),r.Z.toolbar.registerConfig(i.name,i)),n&&(r.Z.contextmenu.registerController(n.name,t),r.Z.contextmenu.registerConfig(n.name,n)),a&&(r.Z.suspendTool.registerController(a.name,t),r.Z.suspendTool.registerConfig(a.name,a))}},19833:(e,t,i)=>{i.d(t,{M:()=>o});var r=i(55900),n=i(39361),a=i(28683);class o{constructor(e,t,i){this._onSelectedMaterialsChange=new r.j,this._onPageLayersViewInit=new r.j,this._onPageRulersInit=new r.j,this._onPageMarginInit=new r.j,this._onPageBleedInit=new r.j,this._selectedMaterials=[],this._isNavigatorCollapse=!0,this._abTestConfig={},this._renderSDK=e,this._graphicSDK=t,this._dependence=i,this._userOperationManager=new n.lU(this)}get userOperationManager(){return this._userOperationManager}get isReadonly(){return this._dependence.permission===a.O.readonly}onSelectedMaterialsChange(e){return this._onSelectedMaterialsChange.event(e)}onPageLayersViewInit(e){if(!this._pageLayersView)return this._onPageLayersViewInit.event(e);e(this._pageLayersView)}onRulesViewInit(e){if(!this._pageRuler)return this._onPageRulersInit.event(e);e(this._pageRuler)}onPageMarginViewInit(e){if(!this._pageMargin)return this._onPageMarginInit.event(e);e(this._pageMargin)}onPageBleedViewInit(e){if(!this._pageBleed)return this._onPageBleedInit.event(e);e(this._pageBleed)}getGraphicSDK(){return this._graphicSDK}setGraphicSDK(e){this._graphicSDK=e}getRenderSDK(){return this._renderSDK}setRenderSDK(e){this._renderSDK=e}getDependence(){return this._dependence}getSelectedMaterials(){return this._selectedMaterials}setSelectedMaterials(e){this._selectedMaterials=e,this._onSelectedMaterialsChange.fire()}setEditInstance(e){this._edit=e}getEditInstance(){return this._edit}isTextEditing(){var e;return Boolean(null===(e=this._textEditView)||void 0===e?void 0:e.isTextEditing)}setPageLayersView(e){this._pageLayersView=e,this._onPageLayersViewInit.fire(e)}getPageLayersView(){return this._pageLayersView}setRulerView(e){this._pageRuler=e,this._onPageRulersInit.fire(e)}getRulerView(){return this._pageRuler}setPageMarginView(e){this._pageMargin=e,this._onPageMarginInit.fire(e)}getPageMarginView(){return this._pageMargin}setPageBleedView(e){this._pageBleed=e,this._onPageBleedInit.fire(e)}getPageBleedView(){return this._pageBleed}setUploadMaterialInProject(e){this._uploadMaterialInProject=e}getUploadMaterialInProject(){return this._uploadMaterialInProject}setSuspendToolView(e){this._suspendToolView=e}getSuspendToolView(){return this._suspendToolView}setContextmenuView(e){this._contextmenuView=e}getContextmenuView(){return this._contextmenuView}setTextEditView(e){this._textEditView=e}getTextEditView(){return this._textEditView}setKeyEditor(e){this._keyEditor=e}getKeyEditor(){return this._keyEditor}setPlugin(e){this._plugin=e}getPlugin(){return this._plugin}setPageManager(e){this._pageManager=e}getPageManager(){return this._pageManager}setContextMenuPageIds(e){this._contextMenuPageIds=e}getContextMenuPageIds(){return this._contextMenuPageIds}setContextMenuArea(e){this._contextMenuArea=e}getContextMenuArea(){return this._contextMenuArea}setCollapse(e){this._isNavigatorCollapse=e}getCollapse(){return this._isNavigatorCollapse}setOpenExportPanelCallback(e){this._openExportPanelCallback=e}openExportPanel(e){var t;null===(t=this._openExportPanelCallback)||void 0===t||t.call(this,e)}setCollapseCallback(e){this._collapseCallback=e}toggleCollapse(){var e;null===(e=this._collapseCallback)||void 0===e||e.call(this,!this._isNavigatorCollapse)}setAbTestConfig(e,t){this._abTestConfig[e]=t}getAbTestConfig(e){return this._abTestConfig[e]}}},47946:(e,t,i)=>{i.d(t,{Z:()=>n});class r{constructor(){this._controllers=new Map,this._instances=new Map,this._configs=new Map}registerController(e,t){this._controllers.set(e,t)}registerConfig(e,t){this._configs.set(e,t)}getConfig(e){return this._configs.get(e)}getControllerClass(e){return this._controllers.get(e)}getControllerInstance(e,...t){const i=this._instances.get(e);if(i)return i;const r=this._controllers.get(e);if(!r)return null;const n=Reflect.construct(r,t);return this._instances.set(e,n),n}getExistControllerInstance(e){var t;return null!==(t=this._instances.get(e))&&void 0!==t?t:null}}const n=new class{constructor(){this.toolbar=new r,this.contextmenu=new r,this.suspendTool=new r}}},22898:(e,t,i)=>{i.d(t,{v:()=>r});class r{constructor(e,t){this._editor=e,this._root=t}get editor(){return this._editor}get renderSDK(){return this._editor.getRenderSDK()}get keyEditor(){return this._editor.getKeyEditor()}destroy(){var e;null===(e=this._root)||void 0===e||e.unmount()}render(e){var t;null===(t=this._root)||void 0===t||t.render(e)}}},32709:(e,t,i)=>{i.d(t,{Z:()=>n});var r=i(18571);function n(e){(0,r.useEffect)((()=>e()),[])}},17846:(e,t,i)=>{i.d(t,{y:()=>n});var r=i(18571);const n=(e,t,i)=>{const n=(0,r.useRef)(null);(0,r.useEffect)((()=>{var r;return e.current?(n.current=new ResizeObserver(t),n.current.observe(e.current,i),()=>{var e;null===(e=n.current)||void 0===e||e.disconnect(),n.current=null}):(null===(r=n.current)||void 0===r||r.disconnect(),void(n.current=null))}),[t,e,i])}},2131:(e,t,i)=>{i.d(t,{e:()=>s});var r=i(61135),n=i(18571),a=i(17846);const o={box:"content-box"},s=e=>{var t;const{active:i}=(0,n.useContext)(r.p),s=null!==(t=null==e?void 0:e.active)&&void 0!==t?t:i,{minColumn:l=1,maxColumn:c,minWidth:d,gap:u}=e,[h,g]=(0,n.useState)(l),p=(0,n.useRef)(null),[m,_]=(0,n.useState)(0),v=(0,n.useMemo)((()=>Math.max(0,Math.floor((m-(h-1)*u)/h))),[h,m,u]),f=(0,n.useCallback)((e=>{if(s)for(const t of e){const{width:e}=t.contentRect;if(!e)return;let i=(e+u)/(d+u);i=Math.max(Math.floor(i),l),void 0!==c&&(i=Math.min(i,c)),_(e),g(i)}}),[l,c,d,u,s]);return(0,a.y)(p,f,o),(0,n.useEffect)((()=>{p.current&&_(p.current.clientWidth)}),[p]),{column:h,eleRef:p,contentWidth:m,columnWidth:v}}},81038:(e,t,i)=>{i.d(t,{w:()=>n});var r=i(82440);class n{constructor(e){this.name=e,this._db=new r.ss("lvweb-editor-graphic-loader-cache-0411")}getDBCacheKey(){return this.name}async getCacheByKey(e){const t=await this._db.get(e);return t?(null==t?void 0:t.expireTimestamp)<Date.now()?(this._db.delete(e),Promise.resolve(void 0)):{...t,isFromCache:!0}:Promise.resolve(void 0)}}},82464:(e,t,i)=>{i.d(t,{UL:()=>o,gA:()=>a,kC:()=>n});var r=i(93053);const n=(e,t)=>{e[(0,r.ro)(t)]=!0},a=(e,t)=>{e[(0,r.l0)(t)]=!0},o=e=>(t,i)=>{t[(0,r.lx)(i)]=e}},26950:(e,t,i)=>{i.d(t,{BF:()=>v,aV:()=>_,uo:()=>f});var r,n,a,o,s=i(82464),l=i(24191),c=i(81038),d=i(93053),u=i(27175),h=function(e,t,i,r){var n,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(o=(a<3?n(o):a>3?n(t,i,o):n(t,i))||o);return a>3&&o&&Object.defineProperty(t,i,o),o},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const p=e=>0===e.offset&&0===e.sortingPosition,m={list:[],cursor:0,hasMore:!1},_=1728e5;class v extends c.w{constructor(){super(...arguments),this.fetchMaterialRecentList=async e=>{const t=await l.zL.fetchMaterialRecentList(e);if(0===e.cursor&&t){const e=`${this.getDBCacheKey()}_recent`,i=await this._db.get(e),r=i?i.list:[],n=(0,d.rk)(r,t.list,"resourceId");this._db.set({key:e,value:{...null!=i?i:{...t,expireTimestamp:Date.now()+_},list:n}})}return Promise.resolve(t)}}async fetchCategoryEffectsAll(e,t){const i=await l.zL.fetchCategoryEffectsAll(e);return p(e)&&this._db.set({key:t?`${t}_category_all`:`loki_category_${e.panel}_${e.category}_${u.ZP.language}`,value:{...i,expireTimestamp:Date.now()+_}}),Promise.resolve(i)}updateRecentList(e){return Promise.resolve()}async fetchLokiCategory(e){const t=await l.zL.fetchLokiCategory(e);return p(e)&&this._db.set({key:`loki_category_${e.panel}_${u.ZP.language}`,value:{...t,expireTimestamp:Date.now()+_}}),Promise.resolve(t)}}h([(0,s.UL)(0),s.gA,g("design:type",Object)],v.prototype,"fetchMaterialRecentList",void 0),h([(0,s.UL)(0),s.gA,g("design:type",Function),g("design:paramtypes",[Object,String]),g("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],v.prototype,"fetchCategoryEffectsAll",null),h([s.kC,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype","function"==typeof(n="undefined"!=typeof Promise&&Promise)?n:Object)],v.prototype,"updateRecentList",null),h([(0,s.UL)(0),s.gA,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype","function"==typeof(a="undefined"!=typeof Promise&&Promise)?a:Object)],v.prototype,"fetchLokiCategory",null);class f extends c.w{constructor(){super(...arguments),this.fetchMaterialRecentList=async e=>{if(0===e.cursor){const e=`${this.getDBCacheKey()}_recent`;return this.getCacheByKey(e)}return Promise.resolve(void 0)},this.updateRecentList=async e=>{var t,i;const r=`${this.getDBCacheKey()}_recent`,n=null!==(t=await this.getCacheByKey(r))&&void 0!==t?t:m,a=null!==(i=n.list)&&void 0!==i?i:[],o=(0,d.rk)(a,[e],"resourceId");this._db.set({key:r,value:{...null!=n?n:{expireTimestamp:Date.now()+_},list:o}})},this.fetchLokiCategory=e=>{if(p(e)){const t=`loki_category_${e.panel}_${u.ZP.language}`;return this.getCacheByKey(t)}return Promise.resolve(void 0)}}async fetchCategoryEffectsAll(e,t){if(p(e)){const i=t?`${t}_category_all`:`loki_category_${e.panel}_${e.category}_${u.ZP.language}`;return this.getCacheByKey(i)}return Promise.resolve(void 0)}}h([(0,s.UL)(1),g("design:type",Object)],f.prototype,"fetchMaterialRecentList",void 0),h([(0,s.UL)(1),g("design:type",Function),g("design:paramtypes",[Object,String]),g("design:returntype","function"==typeof(o="undefined"!=typeof Promise&&Promise)?o:Object)],f.prototype,"fetchCategoryEffectsAll",null),h([(0,s.UL)(1),g("design:type",Object)],f.prototype,"fetchLokiCategory",void 0)},7290:(e,t,i)=>{i.d(t,{u:()=>a});var r=i(93053);class n{constructor(e,t){this.name=e,this.loaders=t}bindProxy(){return new Proxy(this,{get(e,t){const i=e.loaders.sort(((e,i)=>{const n=(0,r.lx)(t);return((null==i?void 0:i[n])||0)-((null==e?void 0:e[n])||0)})).filter((e=>{const i=(0,r.ro)(t);return!(null!=e&&e[i])}));return async(...e)=>{let n,a=0;for(let r=0;r<i.length;r++){const o=i[r];if(n=await o[t](...e),n){a=r;break}}for(const o of i.slice(a+1)){o[(0,r.l0)(t)]&&o[t](...e)}return n}}})}}class a{constructor(){this._loaders=new Map}static getInstance(){return a._instance||(a._instance=new a),a._instance}get(e){return this._loaders.get(e)}buildLoader(e,t){if(0===t.length)throw new Error("loaders can not be empty");return t.length>1?new n(e,t).bindProxy():t[0]}register(e,t){this._loaders.set(e,t)}unRegister(e){this._loaders.delete(e)}}},93053:(e,t,i)=>{i.d(t,{l0:()=>a,lx:()=>n,rk:()=>s,ro:()=>r});const r=e=>`__${e}__disable`,n=e=>`__${e}__priority`,a=e=>`__${e}__default`,o=50;function s(e,t,i){const r=new Map;for(const n of[...e,...t])r.set(n[i],n);return Array.from(r.values()).sort(((e,t)=>t.reportTimestamp-e.reportTimestamp)).slice(0,o)}},72970:(e,t,i)=>{i.d(t,{Z:()=>r});const r={"scroll-container":"scroll-container-yKy1Is",scrollContainer:"scroll-container-yKy1Is",root:"root-CPm1Lh",visible:"visible-dqgNlC"}},33643:(e,t,i)=>{i.d(t,{Z:()=>r});const r={"scroll-container":"scroll-container-Dl9t9i",scrollContainer:"scroll-container-Dl9t9i",root:"root-mbJgV4",visible:"visible-ADir7c"}},3163:()=>{}}]);