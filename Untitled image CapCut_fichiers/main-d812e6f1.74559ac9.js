"use strict";(globalThis.webpackChunkgraphic=globalThis.webpackChunkgraphic||[]).push([[447],{56215:(e,t,i)=>{var a=i(13659),r=i(11042);function s(e){return e.invokeFunction((async e=>{const t=e.get(r.WL);return await t.initialize(),t}))}var o=i(70126),n=i(18571),c=i(72322);const l=(0,n.lazy)((async()=>{const{CookieBanner:e}=await Promise.resolve().then(i.bind(i,14463));return{default:()=>(0,c.jsx)(e,{})}})),d=()=>(0,c.jsx)(n.Suspense,{children:(0,c.jsx)(l,{})});var u=i(84240);var h=i(25222),p=i(68967);const g=["workspaceId","spaceId","use_in_cn","isPresent"];var _=i(67986),f=i(86835);function v(e){e.invokeFunction((e=>{const t=()=>{},i=e.get(f.yR).createLogger("graphic-global-logger");Object.assign(i,{time:t,timeEnd:t,log:t}),_.t.setLogInstance(i)}))}var m,y,I,w=i(2897),S=i(96354),b=i(50155),C=i(80998),E=i(15457),k=i(7647),T=i(25177),P=i(33594),D=i(3936),x=i(80941),A=i(11537),R=i(3260),F=i(47006),M=i(9931),L=i(68099),O=i(39871),U=i(27319),N=i(44260),j=i(93891),B=i(28525),W=i(21100),G=i(34823),z=i(22979),K=i(8534),H=i(3906),Z=i(38294),Y=i(3765),V=i(53003),$=i(8073),q=i(28628),J=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},X=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Q=function(e,t){return function(i,a){t(i,a,e)}};let ee=class extends M.r{constructor(e,t,i,a){super(e,t,a),this._currentPage=e,this.teaReportService=t,this._desktopBridgeService=i}login(e){new Promise((async t=>{const i=await this._desktopBridgeService.login();if(!i.ok)return void t();const{token:a,state:r}=i.value;super.loginWithAuthToken({token:a,state:r}).then((()=>{var t;this._onDidLogin.fire(),null===(t=e.execAfterLogin)||void 0===t||t.call(e)})),t()}))}};ee=J([Q(1,q.w),Q(2,$.n),Q(3,x.S),X("design:paramtypes",[String,"function"==typeof(m=void 0!==q.w&&q.w)?m:Object,"function"==typeof(y=void 0!==$.n&&$.n)?y:Object,"function"==typeof(I=void 0!==x.S&&x.S)?I:Object])],ee);var te=i(4059),ie=i(54714),ae=i(24191),re=i(3549),se=i(37722),oe=i(92110);function ne(e,t,i){const a=(0,p.gO)(),r=new te.G(i,`${(0,re.V)()}`,ie.Tv.JPEG,"pc_cover_edit","edit",a.videoDraftId);return r.setCost(e),t?r.setDownloadFinish():r.setDownloadFail(),ae.RA.serverReport(r.eventName,JSON.stringify(r.getEventParams()),se.I.getInstance().getServerReportCustomString())}function ce(e,t){e.register(S.m,b.r),e.register(L.d,O.J),e.register(C.hR,E.Z),e.register(k.t,T.J),e.register(P.Q,D.b),e.register(x.S,new w.M(x.K,[],!1)),e.register(r.WL,A.A),e.register(U.d,new w.M(N.z,[[]],!1)),e.register(j.X,B.f),e.register(W.H,G.$),e.register(z.lT,K.g),e.register(H.p,Z.z),e.register(Y.B,V.Y),e.register(f.yR,R.g),t===h.gg.EditorPC?(!function(e){e.register($.n,new w.M(oe.z,[{reportExportStatus:ne}],!1))}(e),e.register(F.Gw,new w.M(ee,["picture_edit"],!1))):e.register(F.Gw,new w.M(M.r,["picture_edit"],!1))}var le=i(42058),de=i(47922),ue=i(27457),he=i(20621),pe=i(57041),ge=i(47087),_e=i(35545),fe=i(77685),ve=i(25629),me=i(30680),ye=i(84020),Ie=i(8757);class we extends _e.JT{constructor(){super(),this._allEverFileInfo=[],this._onDidModelInit=this._store.add(new fe.Q),this.onModelDidInit=this._onDidModelInit.event,this._onMaterialInCanvasChange=this._store.add(new fe.Q),this.onMaterialInCanvasChange=this._onMaterialInCanvasChange.event,this._materialMd5InCanvas=[],this._initEverCloudInfoWithModel=()=>{const e=[],{pages:t}=this.graphicSDK.document,i=t=>{for(const r of t){if(r.type===Ie.F5.IMAGE&&this._setEverCloudSrc(r.src,e,r.id),r.type===Ie.F5.IMAGE_CONTAINER)for(const t of r.items){var a;"image"===t.fill.fillType&&null!==(a=t.fill.image)&&void 0!==a&&a.src&&this._setEverCloudSrc(t.fill.image.src,e,r.id)}r.type===Ie.F5.GROUP_LAYER&&i(r.children)}};for(const a of t)i(a.layers);return{add:e,delete:[]}},this._setEverCloudSrc=(e,t,i)=>{null!=e&&e.md5&&t.push({layerId:i,key:e.md5,time:Date.now()})},this._saveAndNotifyEverFileInCanvas=e=>{var t,i;null==e||null===(t=e.delete)||void 0===t||t.forEach((e=>{for(let t=0;t<this._materialMd5InCanvas.length;t++){if(this._materialMd5InCanvas[t].layerId===e.layerId){this._materialMd5InCanvas.splice(t,1);break}}})),null==e||null===(i=e.add)||void 0===i||i.forEach((e=>{this._materialMd5InCanvas.push(e)})),this._onMaterialInCanvasChange.fire()},this._listenEverCloudInfoWithModel=e=>{const t={everCloud:{add:[],delete:[]}},i=[],a=[],r=(e,t)=>{null==e||e.forEach((e=>{this._setEverCloudSrc(e,i,t)}))},s=(e,t)=>{null==e||e.forEach((e=>{this._setEverCloudSrc(e,a,t)}))};return e.mutations.forEach((e=>{if(e.type===Ie.x1.ADD_LAYER){const{addImgsSrc:t,layerId:i}=e.getMutationSideEffect();r(t,i)}if(e.type===Ie.x1.UPDATE_LAYER){const{addImgsSrc:t,delImgsSrc:i,layerId:a}=e.getMutationSideEffect();r(t,a),s(i,a)}if(e.type===Ie.x1.REMOVE_LAYER){const{delImgsSrc:t,layerId:i}=e.getMutationSideEffect();s(t,i)}})),t.everCloud.add=i,t.everCloud.delete=a,t.everCloud},this._graphicSDK=new me.O,this._graphicSDK.event.addListener(ye.B.AFTER_MUTATION_RUN,(()=>{})),ve.Z.interact.onModelInitFinish.event((()=>{const e=this._initEverCloudInfoWithModel();this._saveAndNotifyEverFileInCanvas(e),this._onDidModelInit.fire()})),ve.Z.action.onModelChange.event((e=>{const t=this._listenEverCloudInfoWithModel(e);this._saveAndNotifyEverFileInCanvas(t)}))}get graphicSDK(){return(0,le.Y2)(this._graphicSDK,"graphicSDK is not defined"),this._graphicSDK}get materialsInCanvas(){this._materialMd5InCanvas.sort(((e,t)=>t.time-e.time));const e={},t=[];return this._materialMd5InCanvas.forEach((i=>{e[i.key]||(e[i.key]=1,t.push(i.key))})),{evercloud:t}}isEmptyDocument(){const{document:e}=this.graphicSDK;let t=!0;for(const i of e.pages)if(i.layers.length){t=!1;break}return t}getAllEverFiles(){return this._allEverFileInfo}updateAllEverFiles(e){this._allEverFileInfo=e}}const Se=(0,i(67126).yh)("graphic-ai-tool-service");var be,Ce,Ee,ke,Te=i(67889),Pe=i(69197),De=i(20631),xe=i(73842),Ae=i(27175),Re=i(26690),Fe=i(51825),Me=i(24149),Le=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ue=function(e,t){return function(i,a){t(i,a,e)}};let Ne=class{constructor(e,t,i,a){this.aiToolApplicationService=e,this.everCloudService=t,this.accountService=i,this.draftManagerService=a,this.observableData={selectedTool:void 0,viewOriginMap:{},layerProcessing:{}},(0,De.rC)(this,{observableData:De.LO,selectTool:De.aD.bound,setViewOrigin:De.aD.bound,setLayerProcessing:De.aD.bound}),this.aiToolApplicationService.setDraftId(this.draftManagerService.draftId)}selectTool(e){this.observableData.selectedTool=e,this.aiToolApplicationService.isRiskyToolType(e)&&this.aiToolApplicationService.checkLegalAgreement((()=>{(0,De.z)((()=>{this.observableData.selectedTool=void 0}))}))}setViewOrigin(e,t){this.observableData.viewOriginMap[e]=t}isLayerProcessing(e,t){var i;return Boolean(null===(i=this.observableData.layerProcessing[this._getIdWithIndex(e,t)])||void 0===i?void 0:i.active)}setLayerProcessing(e,t,i){const a=this._getIdWithIndex(e,t);this.observableData.layerProcessing[a]=i}getLayerProcessing(e,t){return this.observableData.layerProcessing[this._getIdWithIndex(e,t)]}getLayerProcessingParams(e,t){const i=this.observableData.layerProcessing[this._getIdWithIndex(e,t)];return null!=i&&i.active?i.params:void 0}handleError(e){switch(e){case Te.AI.ACCESS_TIME_LIMIT:this.accountService.hasLogin?xe.Z.error(Ae.ZP.t("web_smarttools_toast_generation_limit_image",{},"Couldn\u2019t generate. You\u2019ve already generated  {placeholder0} images this month.")):(xe.Z.error(Ae.ZP.t("web_smarttools_toast_sign_in",{},"Sign in to enjoy a full experience")),this.handleLogin());break;case Te.AI.NO_AVATAR:xe.Z.error(Ae.ZP.t("web_smarttools_toast_no_portrait",{},"No face recognized. Try another photo."));break;case Te.AI.UNSUPPORT_FORMAT:xe.Z.error(Ae.ZP.t("web_magicTools_toast_reselect_material",{},"Couldn\u2019t process material. Try another one."));break;case Te.AI.AIGC_SENSITIVE_WORDS:case Te.AI.AIGC_SENSITIVE_IMAGES:xe.Z.error(Ae.ZP.t("web_magicTools_toast_unable_image_text",{},"Inapproperiate words or image recognized. Try other words or image."));break;default:xe.Z.error(Ae.ZP.t("web_magicTools_toast_generate_fail",{},"Couldn\u2019t generate. Try again later."))}}handleLogin(){this.accountService.login({execAfterLogin:async()=>{await this.everCloudService.waitForUnLoginSync()}})}async preload(e,t){const i=await this.getAssetInfo(e);i.ok&&this.aiToolApplicationService.preload({...i.value,aiToolType:t,workspaceId:this.draftManagerService.workspaceId,params:{level:1}})}async getAssetInfo(e){let t,i;switch(e.type){case Ie.lJ.CloudImageSticker:if(!this.accountService.hasLogin){const r=await this.everCloudService.getEverFilesByMD5([e.resourceId]);if(!r.length)return(0,a.wf)(-1,"asset not found");t=r[0].vid,i=Ie.q$.Vcloud;break}const r=await this.everCloudService.getEverFilesByMD5([e.resourceId]);if(!r.length)return(0,a.wf)(-1,"asset not found");t=r[0].id,i=Ie.q$.Evercloud;break;case Ie.lJ.YkImage:if(e.source===Ie.iJ.TuChong){t=e.id,i=Ie.q$.TuChong;break}case Ie.lJ.YkSicker:t=e.id||e.path,i=Ie.q$.Heycan;break;case Ie.lJ.Svg:case Ie.lJ.Cutout:case Ie.lJ.ReplaceableCutout:t=e.id||e.path,i=Ie.q$.ImageX;break;case Ie.lJ.Sticker:case Ie.lJ.Graffiti:(0,le.ss)();default:(0,le.bP)(e.type)}return(0,a.oW)({assetId:t,platform:i})}_getIdWithIndex(e,t){return e+(null!=t?t:"")}};Ne=Le([Ue(0,Pe.m),Ue(1,Fe.X),Ue(2,Re.D),Ue(3,Me.j),Oe("design:paramtypes",["function"==typeof(be=void 0!==Pe.m&&Pe.m)?be:Object,"function"==typeof(Ce=void 0!==Fe.X&&Fe.X)?Ce:Object,"function"==typeof(Ee=void 0!==Re.D&&Re.D)?Ee:Object,"function"==typeof(ke=void 0!==Me.j&&Me.j)?ke:Object])],Ne);var je,Be,We=i(63040),Ge=i(41800),ze=i(22169),Ke=i(24253),He=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ze=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ye=function(e,t){return function(i,a){t(i,a,e)}};let Ve=class extends _e.JT{constructor(e,t){super(),this._workbenchService=e,this.graphicConfigurationService=t,this._menuDragHandlerMap=new Map,this._isDragging=!1,this._onDragOver=(0,ze.throttle)((e=>{this._isBatch||this._isOuterFile(e)&&(e.preventDefault(),e.stopPropagation(),this._changeDragStatus(!0))}),1e3,{trailing:!1}),this._isBatch=!1,this._onDragleave=e=>{this._isBatch||(e.preventDefault(),e.stopPropagation(),this._changeDragStatus(!1))},this._onDrop=e=>{this._isBatch||this._handleDrop(e)},this._registerDocumentListener(),this._isBatch=this.graphicConfigurationService.editorDisplayMode===h.J9.Batch}registerMenuFileDragHandler(e,t,i=!1){this._menuDragHandlerMap.set(e,{name:e,setting:t,isDefault:i})}dispose(){document.removeEventListener("mouseleave",this._onDragleave),document.removeEventListener("dragover",this._onDragOver),document.removeEventListener("drop",this._onDrop),super.dispose()}_isOuterFile(e){var t;return(null===(t=e.dataTransfer)||void 0===t?void 0:t.types.length)&&e.dataTransfer.types.includes("Files")}_registerDocumentListener(){document.addEventListener("mouseleave",this._onDragleave),document.addEventListener("dragover",this._onDragOver),document.addEventListener("drop",this._onDrop)}_handleDrop(e){if(!this._isOuterFile(e))return;e.preventDefault(),e.stopPropagation();let t=this._getDragHandler();if(!t)return;let i=!0;if(!this._checkIsDropInTargetRect(e,t)){i=!1;const e=[...this._menuDragHandlerMap.values()].filter((e=>e.isDefault))[0];if(!e)return;t=e,this._workbenchService.activeSiderMenuByName(t.name,"auto")}this._changeDragStatus(!1);const{files:a}=e.dataTransfer;if(a)for(const r of a){const e=`.${r.name.toLowerCase().split(".").pop()}`;t.setting.isAcceptFile(r.type,e)?t.setting.handleDrop(r,i):xe.Z.error(Ae.ZP.t("file_types_not_supported_by_{placeholder0}",{placeholder0:r.name},"{placeholder0} \u4e0d\u652f\u6301\u7684\u6587\u4ef6\u7c7b\u578b"))}}_checkIsDropInTargetRect(e,t){const{clientX:i,clientY:a}=e,r=document.getElementById(t.setting.menuContainerId);if(!r)return!1;const s=r.getBoundingClientRect(),o=s.left+window.pageXOffset,n=s.top+window.pageYOffset;return i>=o&&i<=o+s.width&&a>=n&&a<=n+s.height}_getDragHandler(){const e=this._workbenchService.getActiveSideMenConfig();return e&&this._menuDragHandlerMap.has(e.name)?this._menuDragHandlerMap.get(e.name):[...this._menuDragHandlerMap.values()].filter((e=>e.isDefault))[0]}_changeDragStatus(e){var t,i;const a=this._getDragHandler();e&&!this._isDragging&&null!=a&&a.isDefault&&this._workbenchService.activeSiderMenuByName(a.name,"auto"),this._isDragging=e,null==a||null===(t=(i=a.setting).dragStatusChangeListener)||void 0===t||t.call(i,e)}};Ve=He([Ye(0,Ge.e),Ye(1,Ke.r),Ze("design:paramtypes",["function"==typeof(je=void 0!==Ge.e&&Ge.e)?je:Object,"function"==typeof(Be=void 0!==Ke.r&&Ke.r)?Be:Object])],Ve);var $e,qe=i(6343),Je=i(18781),Xe=i(16263),Qe=i(54643),et=i(15516),tt=i(97326),it=i(9010),at=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},rt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},st=function(e,t){return function(i,a){t(i,a,e)}};let ot=class extends _e.JT{constructor(e){super(),this.documentModelService=e,this._coverCache={},this._offcanvas=document.createElement("canvas"),this.documentModelService.graphicSDK.event.addListener(ye.B.AFTER_MUTATION_RUN,(e=>{e.mutations.forEach((e=>{const{pageId:t}=e.getMutationSideEffect();t&&(this._coverCache[t]=void 0)}))}))}setDependence(e){this._editorService=e}async exportPNG(e){(0,le.Y2)(e.pages.length>0,"pageIds is empty"),Xe.E.reset();const t={scale:1,transparentBg:!1,png8:!1,...e},i=[];for(const r of t.pages)i.push(this.createCoverFromCache({page:r,type:qe.t.PNG,scale:t.scale,transparentBg:t.transparentBg,png8:t.png8}));const a=await Promise.all(i);return e.download&&this.download(a),a}async exportJPG(e){(0,le.Y2)(e.pages.length>0,"pageIds is empty"),Xe.E.reset();const t={scale:1,quality:.8,...e},i=[];for(const r of t.pages)i.push(this.createCoverFromCache({page:r,scale:t.scale,quality:t.quality}));const a=await Promise.all(i);return e.download&&this.download(a),a}async exportPDF(e){(0,le.Y2)(e.pages.length>0,"pageIds is empty");const{default:t}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,79395)),a=[];let r,s=!0;for(const{id:i}of e.pages){const o=Date.now(),n=this.documentModelService.graphicSDK.document.getPageById(i);if(n){const i=(0,re.V)(),{stage:a,rootWidget:o}=await this._editorService.renderSDK.accessors.stage.createOfflineStage({page:n,scale:1,suffix:i}),c=(0,Qe.Ln)(n.dimension),l=c.width<c.height?"p":"l";r||(r=new t({unit:"px",format:[c.width,c.height],orientation:l}));const d=s?r:r.addPage([c.width,c.height],l);if(s=!1,e.flatten){const e=a.toCanvas({pixelRatio:window.devicePixelRatio});d.addImage(e,"JPEG",0,0,c.width,c.height)}else{const{layers:e}=n,t=[{id:`#${n.id}-${i}-Background`,type:"JPEG"},{id:`#${n.id}-${i}-BackgroundImage`,type:"JPEG"},...e.map((e=>({id:`#${e.id}-${i}`,type:"PNG"})))];for(const i of t){const e=a.findOne(i.id);if(e){const t=e.getClientRect(),a=Math.floor(t.x),r=Math.floor(t.y),s=Math.ceil(t.width)+1,o=Math.ceil(t.height)+1,n=e.toDataURL({pixelRatio:window.devicePixelRatio,x:a,y:r,width:s,height:o});d.addImage(n,i.type,a,r,s,o,void 0,"FAST"),await(0,Je.D)(1)}}}await(0,Je.D)(1),a.destroy(),o.destroy()}const c=Date.now()-o;a.push({duration:c})}const o=this.documentModelService.graphicSDK.document.title;return r&&e.download&&r.save(`${o}.pdf`),a}async createCovers(e){(0,le.Y2)(e.pages.length>0,"pageIds is empty");const t={scale:.5,quality:.8,fast:!1,...e},i=[];for(const r of t.pages){var a;let s=1;if(e.maxHeight&&r.id){const t=this.documentModelService.graphicSDK.api.document.getDimension(r.id),i=t?(0,Qe.Ln)(t):{height:1080};s=e.maxHeight/i.height}i.push(this.createCoverFromCache({page:r,scale:s,type:null!==(a=r.type)&&void 0!==a?a:qe.t.PNG,quality:t.quality,compressedFile:!1,fast:t.fast}))}return(await Promise.all(i)).map((e=>{var t;return null!==(t=e.url)&&void 0!==t?t:""}))}async createCover(e){var t,i,a,r,s;return null!==(s=(await this.createCoverByData({page:e.page,fileName:"",scale:null!==(t=e.scale)&&void 0!==t?t:.5,type:null!==(i=e.type)&&void 0!==i?i:e.isTransparent?qe.t.PNG:qe.t.JPG,quality:null!==(a=e.scale)&&void 0!==a?a:.8,transparentBg:null!==(r=e.isTransparent)&&void 0!==r&&r,png8:!1,compressedFile:!1,useGrid:e.useGrid})).url)&&void 0!==s?s:""}async createCoverFromCache(e){var t,i;const a=null===(t=e.page)||void 0===t?void 0:t.id;if(!a)return{duration:0,url:""};const r={scale:1,type:qe.t.JPG,quality:.8,transparentBg:!1,png8:!1,compressedFile:!0,fast:!1,...e},s=null!==(i=this._coverCache[a])&&void 0!==i?i:{},o=`${r.type}-${r.scale}-${r.quality}-${r.transparentBg}-${r.png8}`,n=s[o];if(n){let e;return n instanceof Promise?(e=await n,s[o]=e):(e=n,e.duration=1),e}const c=this.documentModelService.graphicSDK.document.getPageById(a);if(c){const t=this.createCoverByData({page:c,fileName:r.page.name,scale:r.scale,type:r.type,quality:r.quality,transparentBg:r.transparentBg,png8:r.png8,compressedFile:r.compressedFile,fast:r.fast});return s[o]=t,this._coverCache[a]=s,this.createCoverFromCache(e)}return{duration:0,url:""}}async createCoverByData(e){const{page:t,fileName:i,scale:a,type:r,quality:s,transparentBg:o,png8:n,compressedFile:c,fast:l=!1,useGrid:d=!1}=e,u=Date.now(),h=t,p={duration:0,url:""};if(h){const e=(0,re.V)(),g=r===qe.t.PNG?"image/png":"image/jpeg";if(Xe.E.markStageStart(it.L.CREATE_OFFLINE_STAGE),l&&this._editorService.renderSDK.getActivePageId()===t.id){const e=this._editorService.renderSDK.getMainRenderer().getPageWidgetById(t.id),i=null==e?void 0:e.getElement();if(i){await this._editorService.renderSDK.getMainRenderer().getRenderer().waitRenderReady();const e=i.clone(),t=e.getAbsoluteScale();if(t.x>=.5){if(!d){const t=e.findOne(`#${et.zZ}`);r===qe.t.JPG?null==t||t.fill("#ffffff"):null==t||t.opacity(0)}const{width:i,height:o}=e.getAttrs(),n=e.getAbsolutePosition(),c=e.toCanvas({x:n.x,y:n.y,width:i*t.x,height:o*t.y}),l=(0,Qe.Ln)(h.dimension),_=this._offcanvas;_.width=Math.round(l.width*a),_.height=Math.round(l.height*a);return _.getContext("2d",{willReadFrequently:!0}).drawImage(c,0,0,c.width,c.height,0,0,_.width,_.height),p.url=_.toDataURL(g,s),p.duration=Date.now()-u,p}}}const{stage:_,rootWidget:f}=await this._editorService.renderSDK.accessors.stage.createOfflineStage({page:h,scale:a,suffix:e});Xe.E.markStageEnd(it.L.CREATE_OFFLINE_STAGE),Xe.E.markStageStart(it.L.LOCAL_EXPORT),r===qe.t.PNG&&this._preHandlePng(t,o,_,d),r===qe.t.JPG&&this._preHandleJpg(t,_,a,d);const v=(null!=i?i:"Page")+(r===qe.t.PNG?".png":".jpeg");if(r===qe.t.PNG&&n){const e=_.toCanvas({mimeType:g,quality:c?1:s}),t=await this.exportToPng8(e);p.file=new File([t],v)}else p.url=_.toDataURL({mimeType:g,quality:c?1:s});Xe.E.markStageEnd(it.L.LOCAL_EXPORT),c&&!n&&p.url&&(Xe.E.markStageStart(it.L.COMPRESS),p.file=await(0,tt.t)(p.url,v,s),Xe.E.markStageEnd(it.L.COMPRESS)),_.destroy(),f.destroy()}return await(0,Je.D)(1),p.duration=Date.now()-u,p}_preHandlePng(e,t,i,a){this._isTransparentBackground(e);const r=i.findOne(`.${et.ID}`),s=i.findOne(`#${et._$}`);if(!a){const e=i.findOne(`#${et.zZ}`);null==e||e.opacity(0)}if(t)return r.opacity(0),void(null==s||s.opacity(0))}_preHandleJpg(e,t,i,a){const r=this._isTransparentBackground(e),s=t.findOne(`.${et.ID}`);if(!a){const e=t.findOne(`#${et.zZ}`);null==e||e.fill("#ffffff")}r&&(null==s||s.fill("#ffffff"))}async exportToPng8(e){const{default:t}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,48163)),a=e.getContext("2d").getImageData(0,0,e.width,e.height),r=t.encode([a.data.buffer],a.width,a.height,256);return new Blob([r],{type:"image/png"})}async download(e){Xe.E.markStageStart(it.L.DOWNLOAD);const t=this.documentModelService.graphicSDK.document.title;let i,a="";var r,s;1===e.length?(i=e[0].file,a=null!==(r=null===(s=i)||void 0===s?void 0:s.name.split(".").pop())&&void 0!==r?r:""):e.length>1&&(i=await this.zipFiles(e),a="zip");i&&t&&this.downloadFile(i,`${t}.${a}`),Xe.E.markStageEnd(it.L.DOWNLOAD)}async zipFiles(e){const{default:t}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.t.bind(i,17773,23)),a=new t;return e.forEach((e=>{e.file&&a.file(e.file.name,e.file)})),a.generateAsync({type:"blob"})}downloadFile(e,t){const i=URL.createObjectURL(e),a=document.createElement("a");a.dataset.templateId="123456",a.download=t,a.href=i,document.body.appendChild(a),a.click(),a.remove()}_isTransparentBackground(e){const{background:t}=e;return!!t.color&&(!!Array.isArray(t.color)&&t.color[3]<1)}};ot=at([st(0,ge.w),rt("design:paramtypes",["function"==typeof($e=void 0!==ge.w&&ge.w)?$e:Object])],ot);var nt=i(49384),ct=i(57123),lt=i(24657),dt=i(43825);const ut=ct.w3.layer,ht=ct.EY.render,pt=ct.w3.effect,gt={width:{layout:!0,layerTransform:e=>({layout:{width:e}})},scale:{layerTransform:e=>({layout:{scale:{x:e}}})},text:{layout:!0},richText:{layout:!0},fontSize:{layout:!0,richText:!0},font:{layout:!0,richText:!0},colorPick:{richText:!0,effectTransform:e=>pt.color(e)},bold:{layout:!0,richText:!0},italic:{layout:!0,richText:!0},upperCase:{layout:!0,richText:!0,layerTransform:e=>({upperCase:e})},underline:{richText:!0,layout:!0,effectTransform:e=>({underline:{enable:e}})},align:{defaultValue:lt.Z.center},lineHeight:{layout:!0,layerTransform:e=>({lineSpacing:ut.lineSpacing(e)})},letterSpacing:{layout:!0,layerTransform:e=>({letterSpacing:ut.letterSpacing(e)})},background:{layerTransform:(e,t,i)=>{var a;if(!e||null===(a=i.background)||void 0===a||!a.color)return{background:{enable:!1}};const r={enable:!0,type:Ie.Wv.COLOR};if(void 0!==i.background.color||void 0!==i.background.opacity){var s;const{r:e=0,g:t=0,b:a=0}=i.background.color.rgb;Object.assign(r,{color:[e,t,a,ut.opacity(null!==(s=i.background.opacity)&&void 0!==s?s:100)]})}var o;void 0!==i.background.radius&&Object.assign(r,{cornerRadius:ut.backgroundCornerRadiusScale(null!==(o=i.background.radius)&&void 0!==o?o:0)});return{background:r}}},shadow:{richText:!0,layout:!0,effectTransform:(e,t,i)=>{var a,r;const{shadow:s,operation:o}=i,{mode:n=lt.M.init,index:c=0}=null!=o?o:{};if([lt.M.add,lt.M.edit].includes(n)){return{shadow:{type:n,index:c,payload:s?pt.shadow(s[c]):{}}}}if(n===lt.M.delete)return{shadow:{type:n,index:c,payload:{}}};const l=null==s?void 0:s.filter((e=>null==e?void 0:e.color));return{shadow:{type:"init",prev:null!==(a=null===(r=t.shadow)||void 0===r?void 0:r.length)&&void 0!==a?a:0,current:null==l?void 0:l.map((e=>pt.shadow(e)))}}}},outline:{richText:!0,layout:!0,effectTransform:(e,t,i)=>{var a,r;const{outline:s,operation:o}=i,{mode:n=lt.M.init,index:c=0}=o||{};if([lt.M.add,lt.M.edit].includes(n)){return{outline:{type:n,index:c,payload:s?pt.outline(s[c]):{}}}}if(n===lt.M.delete)return{outline:{type:n,index:c,payload:{}}};const l=null==s?void 0:s.filter((e=>null==e?void 0:e.color));return{outline:{type:"init",prev:null!==(a=null===(r=t.outline)||void 0===r?void 0:r.length)&&void 0!==a?a:0,current:null==l?void 0:l.map((e=>pt.outline(e)))}}}},glow:{layerTransform:(e,t,i)=>{var a,r,s;if(!e||null===(a=i.glow)||void 0===a||!a.color)return{glow:{enable:!1}};const{glow:o}=i,{r:n=0,g:c=0,b:l=0}=null!==(r=null===(s=o.color)||void 0===s?void 0:s.rgb)&&void 0!==r?r:{};return{glow:{enable:!0,color:[n,c,l,1],intensity:void 0===o.intensity?dt.f$:ut.glowIntensity(o.intensity),range:void 0===o.range?dt.DI:ut.glowRange(o.range),resourceId:o.resourceId}}}},preset:{layerTransform:e=>({extra:{textPreset:e}})},curve:{layout:!0,richText:!0,effectTransform:e=>{const t=null==e?void 0:e.angle;if(null!=t)return{underline:{enable:!1,component:!0}}},layerTransform:e=>{const t=null==e?void 0:e.angle;return{curve:null==t?{enable:!1}:{enable:!0,angle:ut.curveAngle(t)}}}}};var _t,ft=i(20484),vt=i(27688),mt=i(82440),yt=i(5821),It=i(45464),wt=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},St=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},bt=function(e,t){return function(i,a){t(i,a,e)}};const Ct=ct.EY.render;let Et=class{constructor(e){this.documentModelService=e,this._pending={mutation:{}},this._layerUpdateOnFlush=!1,this._flushRAF=null,this._autoUpdating=!1,this.getTextLetterCommonStyle=async e=>{const t=await this._accessors.text.getRichJson((null!=e?e:this._idList)[0],{component:!1,selection:!1});return{letterStyle:(0,yt.C3)(t),richJson:t}},this.getTextComponentStyle=e=>function(e,t){var i,a,r,s;if(null==e||!e.length)return{};const o=e[0],n=t.getNodeLayer(o);if(!n)return{};const{text:c,layout:l,align:d,orientation:u,innerPadding:h,glow:p,extra:g}=n;return{width:null==l?void 0:l.width,text:c,scale:null==l?void 0:l.scale.x,opacity:null!==(i=null==l?void 0:l.opacity)&&void 0!==i?i:1,align:ht.align({align:d,orientation:u}),padding:h,preset:g.textPreset,background:null!==(a=n.background)&&void 0!==a&&a.enable?{color:t.getBackgroundColor(o),radius:t.getBackgroundCornerRadiusScale(o),opacity:t.getBackgroundOpacity(o)}:void 0,glow:null!==(r=n.glow)&&void 0!==r&&r.enable?{resourceId:null==p?void 0:p.resourceId,color:t.getGlowColor(o),intensity:t.getGlowIntensity(o),range:t.getGlowRange(o)}:void 0,curve:null!==(s=n.curve)&&void 0!==s&&s.enable?{angle:t.getCurveAngle(o)}:void 0,letterSpacing:t.getLetterSpacing(o),lineHeight:t.getLineHeight(o),upperCase:t.getUpperCase(o)}}(null!=e?e:this._idList,this._accessors.text),this.getTextToolModel=async e=>{const{letterStyle:t}=await this.getTextLetterCommonStyle(e);return{...t,...this.getTextComponentStyle(e)}},this._requestDraw=async()=>{var e;const{transaction:t,text:i}=this.documentModelService.graphicSDK.api,a=this._accessors.text,r=this._accessors.layer,s=[...null!==(e=this._pending.idList)&&void 0!==e?e:this._idList],o=Object.keys(this._pending.mutation),n={},c=s.reduce(((e,t)=>{const i=a.getNode(t);return{...e,[t]:null==i?void 0:i.clone()}}),{}),l=await this.getTextToolModel(this._pending.idList),d=this.merge(l);if(d.preset){const e=Object.keys((0,It.L)());!("preset"in this._pending.mutation)&&Object.keys(this._pending.mutation).some((t=>e.includes(t)))&&(d.preset=null,o.push("preset"))}const u={},h={};let p=!1,g=!1;var f;(o.forEach((e=>{var t;const{layerTransform:i,defaultValue:a,layout:r,richText:s,effectTransform:o}=null!==(t=gt[e])&&void 0!==t?t:{};let n=this._pending.mutation[e];void 0===n&&void 0!==a&&(n=a);let c={[e]:n};"function"==typeof i&&(c=i(n,l,d)),s&&!i||(0,ze.merge)(u,c),r&&(p=!0),s&&(g=!0,Object.assign(h,"function"==typeof o?o(n,l,d):{[e]:n}))})),await Promise.all(s.map((async e=>{var t,i,s,o,l;const f=a.getNodeLayer(e),v=c[e];if(!v)return;const m=(null===(t=this.textEditView)||void 0===t?void 0:t.textEditor.id)===e&&(null===(i=this.textEditView)||void 0===i?void 0:i.textEditor.isEditing);if(!(p||g||m))return;n[e]={lineMaxWidth:1};const y={...h},I=null!==(s=m?this.textEditView.textEditor.text:null==f?void 0:f.text)&&void 0!==s?s:"";if(m||void 0!==y.upperCase){var w;const t=null!==(w=y.upperCase)&&void 0!==w?w:null==f?void 0:f.upperCase;Object.assign(y,{text:t?I.toLocaleUpperCase():I}),Object.assign(n[e],{text:I})}if(void 0!==y.fontSize){var S,b;const t=f.layout.scale.x,i=(null!==(S=null===(b=f.extra.textOuterRect)||void 0===b?void 0:b.width)&&void 0!==S?S:f.layout.width)-f.layout.width,a=y.fontSize/t;Object.assign(y,{fontSize:a});let r=a;try{JSON.parse(f.richText).styles.forEach((e=>{r=Math.max(r,e.size)}))}catch(M){_.t.error("richText","parse error",M)}const s=f.layout.width,o=Ct.fontSize(r)/t;o>s&&(0,ze.merge)(n[e],{layout:{...null==f?void 0:f.layout,width:o},extra:{...null==f?void 0:f.extra,textOuterRect:{...null==f?void 0:f.extra.textOuterRect,width:o+i}}})}if(g&&Object.keys(y).length){const t=await a.updateTextRuntimeLetterStyle(e,y);if(!t)throw new Error;Object.assign(n[e],{richText:JSON.stringify(t.richText)})}await a.updateTextRuntimeComponentStyle(e,{extra:null==f?void 0:f.extra,layout:null==f?void 0:f.layout,...u,...n[e]});const C=await a.getTextRuntimeLayout(e);if(!C)return void _.t.error("_requestDraw getTextRuntimeLayout empty with layerId",e);const{innerBoundHeight:E,innerBoundWidth:k}=C,T={width:null!==(o=null===(l=n[e])||void 0===l||null===(l=l.layout)||void 0===l?void 0:l.width)&&void 0!==o?o:f.layout.width,height:E};if(!this._autoUpdating&&d.curve&&null!==d.curve.angle&&null!=f&&f.layout){var P,D;const e=f.layout.width,t=null!==(P=null===(D=f.layout.scale)||void 0===D?void 0:D.x)&&void 0!==P?P:1;Object.assign(T,{width:k,x:f.layout.x+(e-k)*t*.5})}const x=r.createNodeLayerLayout(v,T),{x:A,y:R,width:F}=x;Object.assign(n[e],{layout:{...n[e].layout,x:A,y:R,width:F,height:E},extra:{textOuterRect:{width:F+C.outerBoundWidth-C.innerBoundWidth,height:C.outerBoundHeight}}})}))),s.forEach((e=>{var t;(e in n||u)&&(n[e]=(0,ze.merge)((0,ft.Sw)(u),null!==(t=n[e])&&void 0!==t?t:{}))})),this._layerUpdateOnFlush)?(t.begin({canUndoRedo:!0,...this._operateId?{operateId:this._operateId}:void 0}),s.forEach((e=>{if(n[e].richText){const t=JSON.parse(n[e].richText).styles.reduce(((e,t)=>{var i,a;const r=null===(i=t.font)||void 0===i?void 0:i.id,s=null===(a=mt.fc.getDependency(r))||void 0===a?void 0:a.id;return s?{...e,[r]:s}:e}),{});n[e].fontDependResources=Object.entries(t).map((([e,t])=>({id:t,resourceId:e})))}i.updateProperties(e,n[e])})),t.commit(),this._layerUpdateOnFlush=!1):(await Promise.all(s.map((e=>a.batchDraw(e,n[e])))),p&&(null===(f=this.textEditView)||void 0===f||f.reflushDom()));this._pending.mutation={},this._pending.idList=void 0,this._pending.model=void 0,this._autoUpdating=!1}}get _accessors(){return this._editorService.renderSDK.accessors}get _idList(){return this._editorService.getSelectedMaterialIds()}get textEditView(){return this._editorService.editor.getTextEditView()}setDependence(e){this._editorService=e}autoUpdate(e){return this._operateId||(this._operateId=(0,vt.g)()),this._autoUpdating=!0,this.update({data:e,shouldUpdateLayer:!0,immediate:!0})}async update(e){const{idList:t,data:i,model:a,shouldUpdateLayer:r,immediate:s,flushBatchOperate:o}=e;var n;((0,ze.merge)(this._pending.mutation,i),a)&&(this._pending.model=(0,ze.merge)(null!==(n=this._pending.model)&&void 0!==n?n:{},a));this._pending.idList=t,this._flushRAF&&cancelAnimationFrame(this._flushRAF),this._layerUpdateOnFlush||(this._layerUpdateOnFlush=Boolean(r)),o&&(this._operateId=void 0),s?await this._requestDraw():this._flushRAF=requestAnimationFrame((()=>{this._flushRAF=null,this._requestDraw()}))}async preview(e){var t;if(e)await this.update({data:e,shouldUpdateLayer:!1,immediate:!0});else{const e=this._accessors.text;this._editorService.getSelectedMaterialIds().forEach((t=>{const i=e.getNodeLayer(t);e.batchDraw(t,i)}))}null===(t=this.textEditView)||void 0===t||t.textEditor.onEffect()}merge(e){return(0,ze.merge)({},(0,ze.omit)(e,"shadow","outline"),this.getMergeData(this._pending.mutation,e))}getMergeData(e,t){if(e.preset||e.reset)return e;const i=(0,ze.omit)(e,"shadow","outline");return Object.keys(e).forEach((a=>{"shadow"!==a&&"outline"!==a||(i[a]=this.processMergeData(e,t,a))})),i}processMergeData(e,t,i){const{operation:a}=e,r=e[i],s=t[i],{mode:o,index:n=0}=null!=a?a:{},c=null!=s?s:[];return o===lt.M.add&&c.push(r),o===lt.M.edit&&(c[n]={...c[n],...r}),o===lt.M.delete&&c.splice(n,1),c}};Et=wt([bt(0,ge.w),St("design:paramtypes",["function"==typeof(_t=void 0!==ge.w&&ge.w)?_t:Object])],Et);var kt,Tt,Pt,Dt=i(7081),xt=i(7290),At=i(79612),Rt=i(98720),Ft=i(26007),Mt=i(56333),Lt=i(88722),Ot=i(21204),Ut=i(55351),Nt=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},jt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Bt=function(e,t){return function(i,a){t(i,a,e)}};const Wt={[Ie.zI.FEATHER]:0,[Ie.zI.OUTLINE]:1,[Ie.zI.GLOW]:2,[Ie.zI.SHADOW]:3};let Gt=class{constructor(e,t,i){this._documentModelService=e,this.aiToolService=t,this._projectMaterialManagerService=i,this._sessions={},this._resourceMap={},this.getEffectFilters=(e,t)=>this._isBgInPage()?this._accessors.page.getEffectFilters():void 0===t?this._accessors.image.getEffectFilters(e):this._accessors.imageContainer.hasFillImage(e,t)?this._accessors.imageContainer.getImageEffectFilters(e,t):this._accessors.grid.getSelectImageByIndex(e,t)?this._accessors.grid.getImageEffectFiltersByIndex(e,t):[],this.updateEffectFilter=e=>{const{id:t,index:i}=e,a=this.getEffectFilters(t,i);return(r,s)=>{const o=(e,t)=>{let i=[];if(null===t)return i;if(i=a.filter((t=>t.type===e&&!(t.resourceId in et.KL))),void 0!==t){const e=i.findIndex((e=>e.resourceId===(null==t?void 0:t.resourceId)));-1===e?i.push(t):i.splice(e,1,t)}return i.length?[i[i.length-1]]:[]},n=o(Ie.Yl.FILTER,r.filter),c=[...o(Ie.Yl.EFFECT,r.effect),...n],l=a.filter((e=>e.resourceId in et.KL)).concat(...c),d=this._isImageContainer(t),u=this._isGrid(t);if(d&&!this._isShowInImageContainer({id:t,index:i})||u&&!this._isShowInGrid({id:t,index:i}))return;if(!s)return void(d?this._accessors.imageContainer.setImageEffectFilters(t,i,c):u?this._accessors.grid.setImageEffectFiltersByIndex(t,i,c):this._accessors.image.setEffectFilters(t,c));const h=()=>{if(d)this._graphicApi.imageContainer.updateFillImage(t,i,{effectFilters:l});else if(u){const e=this._accessors.grid.getGridAreaIdByIndex(t,i);void 0!==e&&this._graphicApi.grid.updateFillImage(t,e,{effectFilters:l})}else this._isBgInPage()?this._graphicApi.page.updateBgImageEffectFilters(this._accessors.page.getActivePageId(),l):this._graphicApi.image.updateEffectFilters(t,l)};e.resetAiTool?(this._graphicApi.transaction.begin(),h(),e.resetAiTool&&(this.resetAiTool(t,i,Ie.no.ImageStyleConversion),this.resetAiTool(t,i,Ie.no.ImageStyleAvatar)),this._graphicApi.transaction.commit()):h()}},this.updateBlendMode=(e,t)=>{void 0!==t&&this._isShowInImageContainer({id:this._selectedId,index:t})&&this._accessors.imageContainer.hasFillImage(this._selectedId,t)?this._graphicApi.imageContainer.updateFillImage(this._selectedId,t,{blendMode:e}):this._graphicApi.common.updateBlendMode(this._selectedId,e)},this.addPostProcessEffect=async e=>{const{id:t,index:i,payload:a}=e;await Promise.all([this.revalidateLumiHubResource(),this.revalidateEffectResource(a.type)]);const r=this._resourceMap[a.type];if(!r)throw new Error;const s=[...this.getPostProcessEffects(t,i)];let o=s.findIndex((e=>Wt[e.type]>Wt[a.type]));if(-1===o&&(o=s.length),s.splice(o,0,{...a,enable:!0,resourceId:r.resourceId,effectId:r.id}),this._isGrid(t))return void this._graphicApi.grid.updateFillImage(t,i,{postProcessEffects:s});if(this._isImageContainer(t))return void this._graphicApi.imageContainer.updateFillImage(t,i,{postProcessEffects:s});if(this._isBgInPage())return void this._graphicApi.page.updateBgImagePostProcessEffects(this._accessors.page.getActivePageId(),{list:s});(this._isSvgImage(t)?this._graphicApi.svgImage:this._graphicApi.image).updatePostProcessEffects(t,{list:s})},this.updatePostProcessEffect=e=>{const{id:t,index:i,position:a,payload:r,intermediate:s}=e,o=[...this.getPostProcessEffects(t,i)];r?o.splice(a,1,r):o.splice(a,1);const n=this._isImageContainer(t),c=this._isGrid(t),l=this._isSvgImage(t),d=this._isBgInPage();if(s)return c?void this._accessors.grid.setImagePostProcessEffects(t,null!=i?i:0,o):n?void this._accessors.imageContainer.setImagePostProcessEffects(t,null!=i?i:0,o):void this._accessors.image.setPostProcessEffects(t,o);const u={postProcessEffects:o};o.length||Object.assign(u,{extra:{postProcessPreset:void 0}}),c?this._graphicApi.grid.updateFillImage(t,i,u):n?this._graphicApi.imageContainer.updateFillImage(t,i,u):l?this._graphicApi.svgImage.updatePostProcessEffects(t,{list:o}):d?this._graphicApi.page.updateBgImagePostProcessEffects(this._accessors.page.getActivePageId(),{list:o}):this._graphicApi.image.updatePostProcessEffects(t,{list:o})},this.updatePostProcessPreset=async e=>{const t=this._editorService.renderSDK.getActivePageIndex(),{id:i,index:a,payload:r}=e;let s=[];var o,n;null!==r&&((0,Mt._i)({action:Mt.Xk.ChooseEdgeStyle,pageIndex:t,materialId:r.key,materialName:r.key}),s=null!==(o=null===(n=Lt.sI.find((e=>e.key===r.key)))||void 0===n?void 0:n.config)&&void 0!==o?o:[],await Promise.all([this.revalidateLumiHubResource(),...s.map((e=>this.revalidateEffectResource(e.type)))]),s=s.reduce(((e,t)=>{const i=this._resourceMap[t.type];return i?[...e,{...t,enable:!0,resourceId:i.resourceId,effectId:i.id}]:e}),[]));if(this._isGrid(i))return void this._graphicApi.grid.updateFillImage(i,a,{postProcessEffects:s,extra:{postProcessPreset:null!=r?r:void 0}});if(this._isImageContainer(i))return void this._graphicApi.imageContainer.updateFillImage(i,a,{postProcessEffects:s,extra:{postProcessPreset:null!=r?r:void 0}});if(this._isBgInPage())return void this._graphicApi.page.updateBgImagePostProcessEffects(this._accessors.page.getActivePageId(),{list:s,preset:null!=r?r:void 0});const c=this._isSvgImage(i)?this._graphicApi.svgImage:this._graphicApi.image;r?c.updatePostProcessEffects(i,{list:s,preset:r}):c.clearPostProcessEffects(i)},this.revalidateLumiHubResource=async()=>{const{resourceId:e}=et.internalEffectResource.lumiHub;if(mt.fc.getDependency(e))return;if(this._sessions.lumiHub)return this._sessions.lumiHub.promise;const t=(0,Rt.PQ)();this._sessions.lumiHub=t;try{const i=(await ae.zL.getEffectsByResourceIds([{ids:[e],type:ae.hm.SalesImageEffect}])).find((t=>t.resourceId===e));if(!i)throw new Error("cannot get lumihub effect resource");await mt.fc.getInstance().parser.filter.fetchData({id:i.effectId,resourceId:e,type:Ie.xP.SalesImageEffect,fileUrl:{url:i.url,md5:i.md5}}),t.resolve()}catch(i){throw t.reject(i),this._sessions.lumiHub=void 0,i}},this.revalidateEffectList=async()=>{if(this._sessions.effectList)return this._sessions.effectList.promise;const e=(0,Rt.PQ)();this._sessions.effectList=e;try{const t={panel:ae.hm.SalesImageEffect,category:ae.xZ.PanelEffectPostProcess,limit:30,offset:0,sortingPosition:0};(await xt.u.getInstance().get(At.Rf).fetchCategoryEffectsAll(t)).list.forEach((e=>{this._resourceMap[e.extra.post_process_type]={id:e.effectId,resourceId:e.resourceId,url:e.url,md5:e.md5}})),e.resolve()}catch(t){throw e.reject(t),this._sessions.effectList=void 0,t}},this.revalidateEffectResource=async e=>{await this.revalidateEffectList();const t=this._resourceMap[e];if(!t)throw new Error(`empty resource for type ${e}`);const{id:i,resourceId:a,url:r,md5:s}=t;mt.fc.getDependency(a)||await mt.fc.getInstance().parser.filter.fetchData({id:i,resourceId:a,type:Ie.xP.SalesImageEffect,fileUrl:{url:r,md5:s}})},this.getPostProcessEffects=(e,t=0)=>this._isGrid(e)?this._accessors.grid.getImagePostProcessEffectsByIndex(e,t):this._isImageContainer(e)?this._accessors.imageContainer.getImagePostProcessEffects(e,t):this._isBgInPage()?this._accessors.page.getPostProcessEffects():this._accessors.image.getPostProcessEffects(e),this.getPostProcessPreset=(e,t)=>{var i,a,r,s;return this._isGrid(e)?null===(a=this._accessors.grid.getSelectImageByIndex(e,t))||void 0===a||null===(a=a.extra)||void 0===a?void 0:a.postProcessPreset:this._isImageContainer(e)?null===(r=this._accessors.imageContainer.getSelectImage(e,t))||void 0===r||null===(r=r.extra)||void 0===r?void 0:r.postProcessPreset:this._isBgInPage()?null===(s=this._accessors.page.getActivePage())||void 0===s||null===(s=s.background.image)||void 0===s||null===(s=s.extra)||void 0===s?void 0:s.postProcessPreset:null===(i=this._accessors.image.getNodeLayer(e))||void 0===i||null===(i=i.extra)||void 0===i?void 0:i.postProcessPreset},this.toggleLoading=({visible:e,id:t,index:i})=>{const a=this._isImageContainer(t),r=this._isGrid(t),s=this._isBgInPage(),o=this._getAccessor(t),n=this._editorService.editor.getSuspendToolView();if(this.aiToolService.setLayerProcessing(t,i,{active:e}),e){const e=Ae.ZP.t("web_autobg_toast_loading",{},"loading...");return a||r?void 0!==i&&o.showLoading(t,e,i):s?o.showLoading(e):o.showLoading(t,e),null!=n&&n.isCropping()&&n.closeCrop(),null!=n&&n.isReplacing()&&(null==n||n.closeReplace()),void(null==n||n.hide())}return null==n||n.show(),a||r?void 0!==i?o.hideLoading(t,i):void 0:o.hideLoading(t)},this.getAiTool=e=>{if(this._isBgInPage()){const e=this._accessors.page.getActivePage();return(null==e?void 0:e.background.image).aiTool}const{id:t,index:i=this._selectedIndex}=e,a=this._accessors.layer.getLayerById(t);var r,s;if(a)return this._isShowInImageContainer({id:a.id,index:i})?null===(r=a.items[i].fill.image)||void 0===r?void 0:r.aiTool:this._isShowInGrid({id:a.id,index:i})?null===(s=a.areas[i].fill.image)||void 0===s?void 0:s.aiTool:a.aiTool},this.getSrc=e=>{const{id:t,index:i=this._selectedIndex}=null!=e?e:{id:this._selectedId,index:this._selectedIndex};if(this._isBgInPage()){var a;const e=this._accessors.page.getActivePage();return null!==(a=(null==e?void 0:e.background.image).src)&&void 0!==a?a:{}}const r=this._accessors.layer.getLayerById(t);if(r){if(this._isShowInImageContainer({id:t,index:i})&&void 0!==i){var s;const{fill:e}=r.items[i];return null===(s=e.image)||void 0===s?void 0:s.src}if(this._isShowInGrid({id:t,index:i})&&void 0!==i){const{fill:e}=r.areas[i];return e.fillType===Ie.kl.IMAGE?e.image.src:void 0}return r.src}},this.setAiToolsEverFiles=(e,t)=>{var i,a;let r=e;if(this._isShowInImageContainer({id:e.id,index:t})){const{image:i}=e.items[t].fill;if(!i)return;r=i}else if(this._isShowInGrid({id:e.id,index:t})){const{image:i}=e.areas[t].fill;if(!i)return;r=i}const{id:s}=r,o=this.getAiTool(r);if(null==o||!o.pipelines.length)return;const n=o.pipelines.filter((({artifact:{md5:e,uriType:t}})=>e&&t===Ie.q$.Evercloud)).map((({artifact:{md5:e}})=>({md5:e,size:0,sourcePath:"",meta:{visible:!1,id:s}})));null===(i=(a=this._projectMaterialManagerService).updateHiddenEverFiles)||void 0===i||i.call(a,s,n)},this.updateAiTool=e=>{const{id:t,position:i=this._selectedIndex,pipeline:a,resetEffect:r,excludes:s}=e;if(this._graphicApi.transaction.begin(),r&&this.updateEffectFilter({id:t,index:i})({effect:null},!0),null==s||s.forEach((e=>{this.resetAiTool(t,i,e)})),this._isImageContainer(t))this._graphicApi.imageContainer.applyAiTool(t,i,a);else if(this._isGrid(t)){const e=this._accessors.grid.getGridAreaIdByIndex(t,i);void 0!==e&&this._graphicApi.grid.applyAiTool(t,e,a)}else this._isBgInPage()?this._graphicApi.page.applyBgImageAiTool(this._accessors.page.getActivePageId(),a):this._graphicApi.image.applyAiTool(t,a);this._graphicApi.transaction.commit()},this.resetAiTool=(e,t=this._selectedIndex,i)=>{if(this._isImageContainer(e))this._graphicApi.imageContainer.resetAiTool(e,t,i);else if(this._isGrid(e)){const a=this._accessors.grid.getGridAreaIdByIndex(e,t);if(void 0===a)return;this._graphicApi.grid.resetAiTool(e,a,i)}else this._isBgInPage()?this._graphicApi.page.resetBgImageAiTool(this._accessors.page.getActivePageId(),i):this._graphicApi.image.resetAiTool(e,i)},this.toggleAiToolViewOrigin=(e,t=this._selectedId,i=this._selectedIndex)=>{var a;const r=this._isBgInPage()?this._accessors.page.getActivePage():this._accessors.layer.getLayerById(t),s=this._getAccessor(t),o=this.getSrc({id:t,index:i}),n=(0,Ot.ow)(r,i),c=(0,Ft.R5)(null!==(a=null==n?void 0:n.pipelines)&&void 0!==a?a:[],(e=>{var t;return(0,Ut.B)(e.toolType,null==n||null===(t=n.pipelines)||void 0===t?void 0:t[0].toolType)})),l=e?{src:o,aiTool:c.length?{...n,pipelines:c}:void 0}:{src:o,aiTool:n};s.switchImage(r.id,l,i),this.aiToolService.setViewOrigin(r.id,e)},this._getAccessor=e=>{const t=this._isImageContainer(e),i=this._isGrid(e),a=this._isBgInPage();let r;return r=t?this._accessors.imageContainer:i?this._accessors.grid:a?this._accessors.page:this._accessors.image,r},this._isImageContainer=(e=this._selectedId)=>{var t;return(null===(t=this._accessors.layer.getLayerById(e))||void 0===t?void 0:t.type)===Ie.F5.IMAGE_CONTAINER},this._isGrid=(e=this._selectedId)=>{var t;return(null===(t=this._accessors.layer.getLayerById(e))||void 0===t?void 0:t.type)===Ie.F5.GRID},this._isSvgImage=(e=this._selectedId)=>{var t;return(null===(t=this._accessors.layer.getLayerById(e))||void 0===t?void 0:t.type)===Ie.F5.SVG_IMAGE},this._isBgInPage=(e=this._selectedId)=>{const t=this._editorService.renderSDK.getActivePageId();return this._accessors.page.getBackgroundImage(t)&&this._accessors.page.isPage(e)}}get _accessors(){return this._editorService.renderSDK.accessors}get _selectedMaterials(){return this._editorService.editor.getSelectedMaterials()}get _selectedId(){var e,t,i;const a=null===(e=this._selectedMaterials)||void 0===e?void 0:e[0];return null!==(t=null==a||null===(i=a.subMaterial)||void 0===i?void 0:i.id)&&void 0!==t?t:null==a?void 0:a.id}get _selectedIndex(){var e,t,i;const a=null===(e=this._selectedMaterials)||void 0===e?void 0:e[0];return null!==(t=null==a||null===(i=a.subMaterial)||void 0===i?void 0:i.selectIndex)&&void 0!==t?t:null==a?void 0:a.selectIndex}get _graphicApi(){return this._documentModelService.graphicSDK.api}setDependence(e){this._editorService=e}updateCutout(e){const{id:t,enable:i,image:a="",position:r,maskImage:s=""}=e;if(this._accessors.imageContainer.hasFillImage(t,r)&&void 0!==r){return void this._graphicApi.imageContainer.updateCutout(t,i,r,a,s)}if(this._isGrid(t)&&void 0!==r){const e=this._accessors.grid.getGridAreaIdByIndex(t,r),o=Boolean(this._accessors.grid.getSelectImageByIndex(t,r));if(void 0!==e&&o){this._graphicApi.grid.updateCutout(t,i,e,a,s)}return}if(this._isBgInPage())return void this._graphicApi.page.updateBgImageCutout(this._editorService.renderSDK.getActivePageId(),i,a,s);this._graphicApi.image.updateCutout(t,i,a,s)}addMaterialResource(e){var t;const{platform:i,md5:a,preview_key:r}=e,s={};null===(t=e.url_list)||void 0===t||t.forEach((e=>{s[`${e.image_width}x${e.image_height}`]={full_url:e.url,width:e.image_width,height:e.image_height}})),i===Ie.q$.Evercloud&&a?mt.fc.getInstance().parser.everCloud.fetchData({id:a,resourceId:a,type:Ie.xP.EverCloud,aesKey:r,fileUrl:{url:e.url,md5:a},transcode:s}):mt.fc.setDependency(e.uri,{type:Ie.xP.ImageInTemplate,localImage:{path:e.url,uri:e.uri},transcode:s,resourceId:e.uri,id:e.uri})}_isShowInImageContainer(e){const{id:t=this._selectedId,index:i}=null!=e?e:{};return void 0!==i&&this._accessors.imageContainer.hasFillImage(t,i)}_isShowInGrid(e){const{id:t=this._selectedId,index:i}=null!=e?e:{};return Boolean(this._accessors.grid.getSelectImageByIndex(t,i))}};Gt=Nt([Bt(0,ge.w),Bt(1,Se),Bt(2,Fe.X),jt("design:paramtypes",["function"==typeof(kt=void 0!==ge.w&&ge.w)?kt:Object,"function"==typeof(Tt=void 0!==Se&&Se)?Tt:Object,"function"==typeof(Pt=void 0!==Fe.X&&Fe.X)?Pt:Object])],Gt);var zt=i(28683),Kt=i(1045),Ht=i(24954),Zt=i(31067),Yt=i(38928),Vt=i(56002),$t=i.n(Vt),qt=i(32283),Jt=i(93062),Xt=i(67163);function Qt(e){e.onSaveDataStateChange((t=>{const{state:a,failReason:r}=t;if(a!==Me.d.SAVING)if(a!==Me.d.SUCCESS)switch(r){case Kt.W.DRAFT_NOT_FOUND:(0,Xt.D)();case Kt.W.DRAFT_VERSION_CONFLICT:}else(function(){const e=qt.e1.parserDraftIdFromUrl();return Boolean(e)})()||(!function(e,t){const a=`${(0,Jt.MY)(p.tP)({category:(0,p.Cm)(),draftId:e})}`,{protocol:r,host:s,search:o}=i.g.location,n=new URLSearchParams(o);n.set("workspaceId",t);const c=`${r}//${s}${a}?${n.toString()}`;i.g.history.replaceState({},"",p.m4.create(c).toString())}(e.draftId,e.workspaceId),ae.RA.reportDraftOpen(e.draftId,e.workspaceId))}))}var ei=i(33690);var ti=i(92204);class ii extends se.C{constructor(e){super(),this.eventName="graphic_editor_draft_save",this.state=e.state,this.failReason=e.failReason}getEventParams(){return{state:this.state,failReason:this.failReason,draftId:(0,p.qM)()}}setResp(e){this.state=e.state,this.failReason=e.failReason}isAllowReportToSlardar(){return!0}}var ai,ri,si,oi,ni,ci,li,di=i(19426),ui=i(6857),hi=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},pi=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},gi=function(e,t){return function(i,a){t(i,a,e)}};const _i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";let fi=class extends _e.JT{constructor(e,t,i,a,r,s,o){super(),this._draftGetDataService=e,this._draftFullSaveService=t,this._documentModelService=i,this._permissionService=a,this._accountService=r,this._environmentService=s,this._userMaterials=o,this._state={isAvailable:!1,isOnline:!0,isSaving:!1},this._onStateChange=this._store.add(new fe.Q),this.onStateChange=this._onStateChange.event,this._onSaveDataStateChange=this._store.add(new fe.Q),this.onSaveDataStateChange=this._onSaveDataStateChange.event,this._onWorkspaceIdChange=this._store.add(new fe.Q),this.onWorkspaceIdChange=this._onWorkspaceIdChange.event,this._dependence={},this._needSaveAgain=!1,this._disableSaveForNextTime=!1,this._serverTicket="0",this._draftOwner="",this._startedAt=0,this._generateCoverTimeout=5e3,this._autoSave=$t()((()=>{(0,le.Y2)(this.isAvailable,"please bootstrap first before save"),this.saveDraft({forceSave:!0})}),3e3,{leading:!0}),this.getDimension=(e,t)=>t.map((t=>{const i=e.pages[t];if(!i)return;const{id:a}=i;return e.getPageById(a).dimension})).filter((e=>Boolean(e))),this._documentModelService.graphicSDK.event.addListener(ye.B.AFTER_MUTATION_RUN,(e=>{e.canSave&&(this.isAvailable?this._autoSave():this._needSaveAgain=!0)})),this._documentModelService.graphicSDK.event.addListener(ye.B.AFTER_NEST_UNDO_REDO_STACK_COMMITTED,(()=>{this.isAvailable?this._autoSave():this._needSaveAgain=!0})),this._draftSaveCollector=new ii({state:Me.d.SUCCESS})}bootstrap(){this._addNetworkConnectListener(),Qt(this),this._state.isAvailable=!0,this._onStateChange.fire(this._state),this._needSaveAgain&&this._autoSave()}resetSaveState(){this._needSaveAgain=!1}saveAsNewDraft(e,t=!1){return this._save(e,t)}disableDraftSaveNextTime(){this._disableSaveForNextTime=!0}setDependence(e,t){this._dependence[e]=t}updateDraftId(e){this._draftId=e}updateWorkspaceInfo(e){this._workspaceInfo=e,this._onWorkspaceIdChange.fire()}isDraftChangeUnSave(){return!this._state.isAvailable||this._state.isSaving||this._needSaveAgain}async readDraft(){var e;(0,le.Y2)(this.draftId,"draftId is empty"),this._environmentService.editorType!==h.gg.EditorPC&&(0,le.Y2)(this.workspaceId,"workspaceId is empty");const t=await this._draftGetDataService.getDraftData(this.draftId,this.workspaceId);if(!t.ok)return(0,a.wf)(-1,t.msg);const i=t.value;return this._draftCreateTime=i.draftCreateTime,this._serverTicket=i.token,this._draftOwner=null!==(e=i.draftOwner)&&void 0!==e?e:"",this._documentModelService.updateAllEverFiles(i.draftAllEverAsserts),t}async saveDraft(e){if(null!=e&&e.forceSave)if(this._disableSaveForNextTime)this._disableSaveForNextTime=!1;else if((0,le.Y2)(this.isAvailable,"please bootstrap first before save"),this._permissionService.getDraftPermission()!==zt.O.readonly)if(this._state.isSaving)this._needSaveAgain=!0;else{if(!this._state.isOnline)return this._onSaveDataStateChange.fire({state:Me.d.FAIL,failReason:Kt.W.NETWORK_ERROR}),void(this._needSaveAgain=!0);this._state.isSaving=!0,this._needSaveAgain=!1,this._onSaveDataStateChange.fire({state:Me.d.SAVING});try{const e=await this._save();this._draftSaveCollector.setResp(e),this._draftSaveCollector.report(),this._state.isSaving=!1,this._onSaveDataStateChange.fire(e)}catch(t){this._state.isSaving=!1,_.t.error("draft save failed",null==t?void 0:t.stack)}this._needSaveAgain&&setTimeout((()=>this._autoSave()))}else _.t.log("draft is readonly");else this._autoSave()}async moveDraft(e){(0,le.Y2)(this.isAvailable,"please bootstrap first before move"),await this._deleteDraft(),this.updateWorkspaceInfo(e),await this.saveAsNewDraft({overwrite:{id:this.draftId}},!0)}async _save(e,t=!1){var i;this._startedAt=Date.now().valueOf(),this._environmentService.editorType!==h.gg.Main&&(0,le.Y2)(this._dependence.getCanvasCover,"Please set getCanvasCover first!");const a=null==e?void 0:e.overwrite.id;let r;try{var s,o;if(this._dependence.getCanvasCover)r=await Promise.race([null===(s=(o=this._dependence).getCanvasCover)||void 0===s?void 0:s.call(o,[0,1,2,3,4]),new Promise((e=>{this._generateCoverTimeout&&setTimeout((()=>{e([_i])}),this._generateCoverTimeout)}))]);else r=[_i]}catch(C){_.t.error(C),r=[_i]}const n=this._documentModelService.graphicSDK,c=null!==(i=null==e?void 0:e.document)&&void 0!==i?i:n.document,l=this._accountService.hasLogin?this.workspaceId:"",d="editor-batch"===(0,p.Cm)()||void 0;var u,g,f,v,m;(void 0===this._data||a)&&(this._data=Object.assign({id:c.meta.draftId,startedAt:this._startedAt,name:c.title,workspaceId:l,cloudAlbumAssert:this._documentModelService.getAllEverFiles(),ticket:a?"0":this._serverTicket,draftData:n.getDataExportConvertor()(c),referencedAssert:null!==(u=(0,Yt.G)(c))&&void 0!==u?u:[],effectsPreloadInfos:null!==(g=mt.fc.getAllDependency())&&void 0!==g?g:[],imagePreloadInfos:null!==(f=mt.fc.getAllFileInfo())&&void 0!==f?f:[],dimension:this.getDimension(c,[0,1,2,3,4]),cover:null,coverList:null!==(v=r)&&void 0!==v?v:[],draftCreateTime:null!==(m=this._draftCreateTime)&&void 0!==m?m:Date.now(),pageCount:c.pageCount,commitId:(0,re.V)(),isBatch:d},null==e?void 0:e.overwrite));const y=function(e){return e.api.common.getLayersByFilter(!0,(()=>!0)).some((e=>{if(e.type===Ie.F5.IMAGE){var t;if(null===(t=e.extra)||void 0===t||!t.sourceInfo)return!1;const{sourceInfo:i}=e.extra;if("template"===i.from)return!0}return!1}))}(n),I=function(e){const t=e.api.common.getLayersByFilter(!0,(()=>!0)),i={templateId:ti.Ic,templateName:ti.Ic,templateCategoryId:ti.Ic,templateCategoryName:ti.Ic};let a=0;return t.forEach((e=>{var t;if(null!==(t=e.extra)&&void 0!==t&&t.sourceInfo){const{sourceInfo:t}=e.extra;var r,s,o,n;"template"===t.from&&(i.templateCategoryName=null!==(r=t.templateCategory)&&void 0!==r?r:ti.Ic,i.templateCategoryId=null!==(s=t.templateCategoryId)&&void 0!==s?s:ti.Ic,i.templateId=null!==(o=t.templateId)&&void 0!==o?o:ti.Ic,i.templateName=null!==(n=t.templateName)&&void 0!==n?n:ti.Ic)}e.type===Ie.F5.TEXT&&a++})),{...i,textCount:a}}(n),[w,S]=(await this._draftFullSaveService.submitDraftData(this._data,{hasTemplateImage:y,useTemplateReportParams:I,reportParams:this._getReportParams(c)})).pair();return w?{state:Me.d.FAIL,failReason:w.code}:(!t&&a||(this._serverTicket=S.packageId),this._startedAt!==(null===(b=this._data)||void 0===b?void 0:b.startedAt)&&setTimeout((()=>{this.saveDraft({forceSave:!0})})),this._data=void 0,{state:Me.d.SUCCESS});var b}get isAvailable(){return this._state.isAvailable}get draftId(){return(0,le.Y2)(this._draftId,"draftId is not existed, please bootstrap first"),this._draftId}get workspaceId(){return this._environmentService.editorType===h.gg.EditorPC?"":((0,le.Y2)(this._workspaceInfo,"workspaceInfo is not existed, please bootstrap first"),this._workspaceInfo.workspaceId)}get workspaceInfo(){return this._environmentService.editorType===h.gg.EditorPC?{workspaceId:"",name:""}:((0,le.Y2)(this._workspaceInfo,"workspaceInfo is not existed, please bootstrap first"),this._workspaceInfo)}get draftOwner(){return this._draftOwner}_addNetworkConnectListener(){i.g.addEventListener("online",(()=>{this._state.isOnline=!0,this._onStateChange.fire(this._state),(void 0!==this._data||this._needSaveAgain)&&this._autoSave()})),i.g.addEventListener("offline",(()=>{this._state.isOnline=!1,this._onStateChange.fire(this._state)}))}_getReportParams(e){var t,i;if(this._environmentService.editorType!==h.gg.EditorWeb)return;const{id:a,dimension:r}=e.pages[0];return new di.Dq(a,(0,re.V)(),e.title,null!==(t=null===(i=ui.B.mimeType.split("/")[1])||void 0===i?void 0:i.toUpperCase())&&void 0!==t?t:"",`${r.width}*${r.height}${r.unit===Ie.fb.PX?"px":"cm"}`,`${ui.B.pixelRatio}x`,ui.B.qualityLabel,ui.B.transparentBackground,ui.B.compressPNG,ui.B.flattenPDF).getEventParams()}async _deleteDraft(){if("0"===this._serverTicket)return;const e=await this._userMaterials.getEvercloudInstance(this.workspaceId);await e.deletePackageById(this._serverTicket)}};fi=hi([gi(0,Ht.H),gi(1,Kt.Y),gi(2,ge.w),gi(3,W.H),gi(4,Re.D),gi(5,ei.j),gi(6,Zt.b),pi("design:paramtypes",["function"==typeof(ai=void 0!==Ht.H&&Ht.H)?ai:Object,"function"==typeof(ri=void 0!==Kt.Y&&Kt.Y)?ri:Object,"function"==typeof(si=void 0!==ge.w&&ge.w)?si:Object,"function"==typeof(oi=void 0!==W.H&&W.H)?oi:Object,"function"==typeof(ni=void 0!==Re.D&&Re.D)?ni:Object,"function"==typeof(ci=void 0!==ei.j&&ei.j)?ci:Object,"function"==typeof(li=void 0!==Zt.b&&Zt.b)?li:Object])],fi);class vi extends fi{constructor(){super(...arguments),this._generateCoverTimeout=void 0,this._autoSave=()=>{this._needSaveAgain=!0},this._disableSaveForNextTime=!1}disableDraftSaveNextTime(){}}var mi=i(71942),yi=i(36461);const Ii=(()=>{const e={file:{acceptType:[],acceptSuffix:[]},video:{acceptType:[],acceptSuffix:[]},audio:{acceptType:[],acceptSuffix:[]},image:{acceptType:["image/jpeg","image/jpg","image/png","image/heif","image/heic","image/avif","image/vnd.adobe.photoshop","image/svg+xml","image/bmp","image/tiff","image/webp","image/x-icon"],acceptSuffix:[".jpeg",".jpg",".png",".heif",".heic",".avif",".psd",".svg",".bmp",".tif",".tiff",".webp",".ico"]}},t=t=>[...e[t].acceptType,...e[t].acceptSuffix].join(",");return{file:{...e.file,accept:t("file")},video:{...e.video,accept:t("video")},audio:{...e.audio,accept:t("audio")},image:{...e.image,accept:t("image")},allAccept:`${t("video")},${t("audio")},${t("image")}`}})();function wi({file:e,accepts:t=["video","audio","image"]}){const i=function({file:e,accepts:t=["audio","video","image"]}){const i=e.name.lastIndexOf(".");let a="";if(-1!==i&&(a=e.name.substr(i)),a)for(const s of t)if(Ii[s].acceptSuffix.includes(a.toLocaleLowerCase()))return s;const r=e.type.toLocaleLowerCase();if(r)for(const s of t)if(Ii[s].acceptType.includes(r))return s}({file:e,accepts:t});return Boolean(i)}function Si(e){return["image/jpeg","image/jpg","image/png","image/svg+xml","image/bmp","image/webp","image/x-icon"].includes(e.type)}var bi=i(48018);class Ci{constructor({data:e,...t}){this._awaitLock=new bi.G,this.observableData=(0,De.LO)(e),this._options=t,"waiting"===e.status&&setTimeout((()=>{this.retryUpload()}),300),"success"===e.status&&this._awaitLock.initDone()}get toJS(){return(0,De.ZN)(this.observableData)}retryUpload(){this._options.onStartUpload&&(0,De.z)((async()=>{var e,t,i,a;const r=await(null===(e=(t=this._options).onStartUpload)||void 0===e?void 0:e.call(t));if(null==r||!r.ok)return this.observableData.status="failure",this._errorMsg="upload failed",void this._awaitLock.initDone();null===(i=(a=this._options).onUploadSuccess)||void 0===i||i.call(a,r.value),Object.assign(this.observableData,r.value),this._awaitLock.initDone()}))}async onDone(){return await this._awaitLock.awaitForInit(),this._errorMsg?(0,a.wf)(-1,this._errorMsg):(0,a.oW)(this.toJS)}}var Ei=i(16172),ki=i(54155),Ti=i(55610);function Pi(e,t){return{mode:t,id:`${ki.I}:${e.name}:${Math.round(1e3*Math.random())}`,name:e.name,everCloudId:void 0,type:(0,Ti.Gt)(e.type),cover:"",uploadBlobCover:Si(e)?(0,Ei.S)(e):"",status:"waiting",progress:0,url:"",md5:"",size:e.size,sourcePath:`${e.name}`}}var Di,xi,Ai=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ri=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Fi=function(e,t){return function(i,a){t(i,a,e)}};let Mi=class extends _e.JT{constructor(e,t){super(),this.desktopBridgeService=e,this.documentModelService=t,this._allEverfilesInfo=[],this._observableData=(0,De.LO)({allEverFileInfos:[]}),this._onMaterialChange=this._store.add(new fe.Q),this.onMaterialChange=this._onMaterialChange.event,this._oReady=this._store.add(new fe.Q),this.onReady=this._oReady.event,this._isReady=!1,this._bootstrap(),this._observeEverFileChange()}getExpandInstance(){return Promise.resolve(void 0)}listenExpandInstance(){}get materials(){return this._observableData.allEverFileInfos.filter((e=>"failure"!==e.observableData.status)).map((e=>e.toJS))}get isReady(){return this._isReady}get supportThirdpartyUpload(){return!1}uploadMaterial(e){const{file:t,isSilence:i=!1}=e;if(!wi({file:t,accepts:["image"]})&&!i)throw new Error(Ae.ZP.t("file_types_not_supported_by_{placeholder0}",{placeholder0:t.name},"{placeholder0} is not supported"));const r=new Ci({data:Pi(e.file,"login"),onStartUpload:async()=>{const t=await this.desktopBridgeService.saveEvercloudFile({file:e.file});if(!t.ok)return(0,a.wf)(t.code,t.msg);const i=this._transformToEverFileInfo(t.value);return(0,a.oW)(i)},onUploadSuccess:e=>{this._checkFileUniqueWhenUploadSuccess(e)}});return this._observableData.allEverFileInfos=[r,...this._observableData.allEverFileInfos],r.onDone()}async deleteMaterial(e){if(!(await this.desktopBridgeService.deleteEvercloudFile(e)).ok)throw new Error;this._observableData.allEverFileInfos=this._observableData.allEverFileInfos.filter((t=>t.observableData.md5!==e))}async getMaterialSourceData({id:e,sourceFrom:t,index:i}){const r=this.materials.find((t=>t.id===e));if(!r)return(0,a.wf)(-1,`material not found: please check: ${e}`);if("success"!==r.status)return(0,a.wf)(-1,"material status not success, please wait");const s=await this.desktopBridgeService.getFileBlobInfoByMd5(e);return s.ok?(mt.fc.setDependency(e,{content:s.value.blobUrl,id:e,resourceId:e,type:Ie.xP.EverCloud,isPreview:!1}),(0,a.oW)({type:mi.P.EverImage,data:{id:r.md5,width:r.width,height:r.height,md5:r.md5,resourceId:r.md5,sourceFrom:t,name:r.name,index:i,resContent:s.value.blobUrl},sourceRect:{width:r.width,height:r.height}})):(0,a.wf)(-1,"desktop bridge get file content failed")}async selectFromVideo(){const e=await this.desktopBridgeService.selectFromVideo();var t;if(!e.ok)return _.t.error(null!==(t=e.msg)&&void 0!==t?t:"selectFromVideo failed"),(0,a.wf)(-1,"selectFromVideo failed");const i=this.materials.find((t=>t.md5===e.value.md5));if(i)return(0,a.oW)(i);const r=this._transformToEverFileInfo(e.value),s=await this.desktopBridgeService.getFileBlobInfoByMd5(r.md5);if(!s.ok)throw new Error("get blob url failed after select cover from video");r.url=s.value.blobUrl;const o=new Ci({data:r});return this._observableData.allEverFileInfos=[o,...this._observableData.allEverFileInfos],mt.fc.setDependency(e.value.md5,{id:e.value.md5,resourceId:e.value.md5,type:Ie.xP.EverCloud,content:r.url}),(0,a.oW)(r)}async copyMaterialFromSpace(e){const{url:t,md5:i,coverKey:r,transcodeInfo:s,name:o}=e;if(-1!==this.materials.findIndex((e=>e.md5===i)))return(0,a.ly)();const n=await mt.fc.getInstance().parser.everCloud.fetchData({id:i,resourceId:i,type:Ie.xP.EverCloud,fileUrl:{md5:i,url:t},aesKey:r,transcode:s}),c=await(0,yi.n)(n.content),l=new File([c],o),d=await this.desktopBridgeService.saveEvercloudFile({file:l,extraInfo:{spaceSourceData:{md5:i,resourceId:i}}});var u;if(!d.ok)return(0,a.wf)(-1,null!==(u=d.msg)&&void 0!==u?u:"copyMaterialFromSpace failed, save file error");const h=this._transformToEverFileInfo(d.value),p=new Ci({data:h});return this._observableData.allEverFileInfos=[p,...this._observableData.allEverFileInfos],(0,a.ly)()}getPCFileMetadataWithMd5(e){return this.desktopBridgeService.getFileMetadataByMd5(e)}updatePCExtraInfoWithMd5(e,t){return this.desktopBridgeService.updateExtraInfoByMd5(e,t)}async updateProjectListFromPC(){const e=await this.desktopBridgeService.getProjectFileList();if(!e.ok)return(0,a.wf)(-1,"project-material-service updateProjectListFromPC getProjectFileList failed");const t=e.value.map((e=>this._transformToEverFileInfo(e))).map((e=>new Ci({data:e})));return this._observableData.allEverFileInfos=t,(0,a.ly)()}canRetryUploadById(e){return!1}retryUpload(e){}cancelUpload(e){}retryTranscode(e){}showThirdpartyUploadModal(e){return Promise.resolve()}showThirdpartyUploadModalWithSpaceChange(e,t){}waitForReady(){return Promise.resolve()}registerThirdpartyUploadStatesCallback(e){}unRegisterThirdpartyUploadStatesCallback(e){}showUserSpaceInsufficient(){}waitForUnLoginSync(){return Promise.resolve()}async _bootstrap(){const{ok:e,msg:t}=await this.updateProjectListFromPC();if(!e)throw new Error(t);this._isReady=!0,this._oReady.fire([])}_notifyEverFilesChange(){this._onMaterialChange.fire(this.materials),this._updateEverfileInfosInModel()}_updateEverfileInfosInModel(){this.documentModelService.updateAllEverFiles(this._observableData.allEverFileInfos.map((e=>e.toJS)).filter((e=>"success"===e.status)).map((e=>{var t,i;return{size:null!==(t=e.size)&&void 0!==t?t:0,md5:e.md5,sourcePath:null!==(i=e.sourcePath)&&void 0!==i?i:""}})))}_observeEverFileChange(){let e=[];(0,De.N7)(this._observableData,(t=>{e.forEach((e=>e())),"allEverFileInfos"===t.name&&(e=t.newValue.map((e=>(0,De.N7)(e.observableData,(()=>{this._notifyEverFilesChange()})))),this._notifyEverFilesChange())}))}_checkFileUniqueWhenUploadSuccess(e){(0,De.z)((()=>{this._observableData.allEverFileInfos=this._observableData.allEverFileInfos.filter((t=>t.observableData.md5!==e.md5))}))}_transformToEverFileInfo(e){const{filename:t,md5:i,fileSize:a,coverUrl:r,width:s,height:o}=e;return{mode:"login",id:i,name:t,everCloudId:void 0,cover:r,width:s,height:o,size:a,md5:i,url:"",status:"success"}}};Mi=Ai([Fi(0,$.n),Fi(1,ge.w),Ri("design:paramtypes",["function"==typeof(Di=void 0!==$.n&&$.n)?Di:Object,"function"==typeof(xi=void 0!==ge.w&&ge.w)?xi:Object])],Mi);var Li,Oi=i(40673),Ui=i(59626),Ni=i(9561),ji=i(8091),Bi=i(14463);function Wi(e){switch(e){case Li.Success:return"transcoding";case Li.Uploading:return"uploading";case Li.Failure:case Li.Insufficient:default:return"failure"}}function Gi(e){var t,i;return{mode:"login",id:e.id,everCloudId:e.fileId,name:e.name,cover:e.coverUrl,status:Wi(e.status),progress:100*e.progress,url:"",md5:null!==(t=null==e||null===(i=e.metadata)||void 0===i?void 0:i.md5)&&void 0!==t?t:e.md5}}!function(e){e[e.Success=0]="Success",e[e.Uploading=1]="Uploading",e[e.Failure=-1]="Failure",e[e.Insufficient=-2]="Insufficient"}(Li||(Li={}));class zi{constructor(e){this._uploadFileList=[],this._onFileUploadStates=[],this.broadcastFileStatus=e=>{this._onFileUploadStates.forEach((t=>{t(e)}))},this._uploadListener=e=>{var t;const i=this._uploadFileList.find((t=>t.id===e.id)),a=(0,ze.get)(null===(t=this._thirdpartyStorageModal)||void 0===t?void 0:t.getService(),"state.context.platform");i?(this.broadcastFileStatus({type:a,data:Gi(e),triggerType:this.uploadTriggerType}),e.status===Li.Success&&(this._uploadFileList=this._uploadFileList.filter((t=>t.id!==e.id))),e.status===Li.Insufficient&&this._showUserSpaceInsufficient({enter_from:"cloud_space_popup"})):(this.broadcastFileStatus({type:a,isNewFile:!0,data:Gi(e),triggerType:this.uploadTriggerType}),this._uploadFileList.unshift(e))},this._options=e,this._initThirdpartySdk(),this._showUserSpaceInsufficient=e.showUserSpaceInsufficient}_initThirdpartySdk(){if(this._thirdpartyInitPromise)return this._thirdpartyInitPromise;const{uid:e,packageId:t,workspaceId:a,reqDomain:r,workspaceList:s,selectWorkSpaceCb:o}=this._options;this._thirdpartyInitPromise=Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,67632)).then((({LvThirdpartyStorageModal:i})=>{this._thirdpartyStorageModal=new i({uid:e,acceptMime:Ii.image.acceptSuffix,isBOE:!1,draftId:t,spaceId:a,reqDomain:r,multiple:!0,desc:Ae.ZP.t("web_graphic_thirdparty_storage_desc",{},"Only photos can be selected"),currentPage:"picture_edit",cookieConsent:Bi.cookieConsent,expandModalInstance:this._thirdpartyStorageExpandModalInstance,workspaceList:s}),this._thirdpartyStorageModal.onUpload(this._uploadListener),o&&this._thirdpartyStorageModal.onSelectWorkspace(o)}))}setThirdpartyStorageExpandModalInstance(e){var t,i;this._thirdpartyStorageExpandModalInstance=e,null===(t=this._thirdpartyStorageModal)||void 0===t||null===(i=t.setExpandModalInstance)||void 0===i||i.call(t,e)}registerOnUploadListener(e){this._onFileUploadStates.push(e)}unRegisterOnUploadListener(e){this._onFileUploadStates=this._onFileUploadStates.filter((t=>t!==e))}async show(e,t="manual"){var i;await this._initThirdpartySdk(),null===(i=this._thirdpartyStorageModal)||void 0===i||i.show(e),this.uploadTriggerType=t}async deleteFile(e){await this._initThirdpartySdk();const t=this._uploadFileList.find((t=>t.id===e));var i;t&&await(null===(i=this._thirdpartyStorageModal)||void 0===i?void 0:i.delete(t))}async retryUpload(e){var t;await this._initThirdpartySdk();const i=this._uploadFileList.find((t=>t.id===e));(0,le.Y2)(i,"upload record not existed"),null===(t=this._thirdpartyStorageModal)||void 0===t||t.retry(i.uniqueId,this._options.workspaceId)}setWorkspaceId(e){var t;this._options={...this._options,workspaceId:e},null===(t=this._thirdpartyStorageModal)||void 0===t||t.setSpaceId(e)}}var Ki=i(36702),Hi=i(24451),Zi=i(39),Yi=i(9339),Vi=i(95326),$i=i(5789),qi=i.n($i),Ji=i(92312);const Xi={workSpaceItemBase:"workSpaceItemBase-qsn8BJ",workSpaceItemBanned:"workSpaceItemBanned-J8hwWI",workSpaceItemSelected:"workSpaceItemSelected-AXnIsO",workSpaceItem:"workSpaceItem-uclrS9",workSpaceNameText:"workSpaceNameText-htmf3e",workSpaceCapacityText:"workSpaceCapacityText-ptLhNs",workSpaceCapacityTextErr:"workSpaceCapacityTextErr-wKpyXZ",workSpaceAvatar:"workSpaceAvatar-jCyWFZ"},Qi=e=>{const{className:t,name:i,avatarColor:a,quota:r,selected:s,onSelect:o,disabled:n=!1,usage:l,isUpgrade:d}=e;let u=r-l;u<0&&(u=0);const h=s&&d?"red":"var(--lvv-color-text-tertiary)";return(0,c.jsx)("div",{className:qi()(Xi["workSpaceItem"+(n?"Banned":s?"Selected":"")],t),onClick:n?void 0:o,children:(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,c.jsxs)("div",{style:{display:"flex"},children:[(0,c.jsx)(Zi.Z,{size:36,shape:"square",className:Xi.workSpaceAvatar,style:{color:"white",backgroundColor:a},children:i[0]}),(0,c.jsxs)("div",{children:[(0,c.jsx)(Yi.default.Text,{className:Xi.workSpaceNameText,ellipsis:{wrapper:"span"},children:i}),(0,c.jsx)("div",{className:Xi.workSpaceCapacityText,style:{color:h},children:Ae.oc.t("space_files_move_storage",{placeholder1:(0,Ji.y)(u)},"{placeholder1} remaining")})]})]}),(0,c.jsx)("div",{style:{display:"flex",flexDirection:"row-reverse",alignItems:"center"},children:(0,c.jsx)(Vi.Z,{disabled:n,checked:s,onChange:o})})]})})},ea="workspace-item-uSlL0E",ta=new Ui.w,ia=e=>{const{currentWorkspaceId:t,workspaceList:i,mode:a,draftName:r}=e,[s,o]=(0,n.useState)(!0),[l,d]=(0,n.useState)(t),[u,h]=(0,n.useState)(!1),p=i.find((e=>e.workspace_id===t)),g=i.length>1?"expand":"error",_="error"===a?"error":g,f=()=>{var t;o(!1),null==e||null===(t=e.onClose)||void 0===t||t.call(e)};return(0,c.jsx)(Ki.Z,{visible:s,wrapClassName:"sync-failure-modal",closable:!1,autoFocus:!1,onCancel:f,style:{borderRadius:12},maskClosable:!1,title:(0,c.jsx)("div",{children:Ae.ZP.t("web_save_draft_to",{placeholder1:r},'Save "{placeholder1}" to')}),footer:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Hi.Z,{onClick:()=>{null==e||e.giveUp(),f()},children:Ae.ZP.t("abandon_draft",{},"Abandon project")}),(0,c.jsx)(Hi.Z,{loading:u,type:"primary",onClick:async()=>{h(!0);try{await(null==e?void 0:e.retry(i.find((e=>e.workspace_id===l)))),h(!1),f()}catch(t){h(!1)}},children:"expand"===_?Ae.ZP.t("editor_save_storageerror_change",{},"Change saving location"):Ae.ZP.t("editor_save_storageerror_retry",{},"Try again")})]}),children:"expand"===_?null==i?void 0:i.map(((e,t)=>{var i,a,r,s;return(0,c.jsx)(Qi,{className:ea,name:null!==(i=e.name)&&void 0!==i?i:"",avatarColor:null!==(a=e.avatar_color)&&void 0!==a?a:"",quota:null!==(r=e.quota)&&void 0!==r?r:0,usage:null!==(s=e.usage)&&void 0!==s?s:0,selected:e.workspace_id===l,onSelect:()=>{d(e.workspace_id)}},t)})):(0,c.jsx)("p",{children:Ae.ZP.t("web_graphic_upload_failure_content",{placeholder1:null==p?void 0:p.name},"{placeholder1} has reached the storage limit. You can delete some of your space files.")})})},aa=.7,ra=20113;var sa=i(39089);function oa({evercloudInstance:e,everFileInfo:t,resolutions:i,onProgress:r}){let s=!1;const o=()=>new Promise((async o=>{const n=await e.getAssetByFileId(t.everCloudId);if((0,sa.Jw)(n))return null==r||r(100),void o((0,a.ly)());if(!n.imageAsyncResize)return void o((0,a.wf)(-1,"transcode failure with old data"));const c=await e.getImagesTranscodeStatus(i.map((e=>({ids:[t.everCloudId],resolution:e})))),l=e=>{const{everCloudId:i}=t;if("success"===e.status){if((0,sa.C0)(i,e.data))return null==r||r(100),s=!0,c.destroy(),o((0,a.ly)()),!0}return!1};c.onProcess=e=>{l(e)},c.done().then((e=>{if(!s){l(e)||(_.t.warn("[ever-cloud-plugin][project]: transcode asset failure"),t.status="failure",o((0,a.wf)(-1,"transcode failure")))}}))}));return Promise.race([o(),new Promise((e=>{setTimeout((async()=>{if(!s){_.t.warn(`${t.everCloudId} get transcode status timeout, retry to fetch.`);const i=await o();e(i)}}),15e3)}))])}var na=i(51728);class ca{constructor(){this._isLocked=!1,this.reset()}get done(){return this._statusPromise}get isLocked(){return this._isLocked}resolve(e){this._isLocked=!1,this._statusPromiseResolve(e)}reject(e){this._isLocked=!1,this._statusPromiseReject(e)}dispose(){this._statusPromiseResolve(),this._statusPromise=void 0}reset(){(0,le.Y2)(!this.isLocked,"current waiter is lock, unsupport reset"),this._isLocked=!0,this._statusPromise=new Promise(((e,t)=>{this._statusPromiseResolve=e,this._statusPromiseReject=t}))}}class la{constructor({data:e,...t}){this._resultWaiter=new ca,this.options=t,this.observableData=(0,De.LO)(e),this._listenerUploadStatusHandler=this._listenThirdpartyUploadStatus.bind(this),t.thirdpartyUploadHelper.registerOnUploadListener(this._listenerUploadStatusHandler)}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get toJS(){return(0,De.ZN)(this.observableData)}get isSuccess(){return"success"===this.observableData.status}async onDone(){return await this._resultWaiter.done,this._errInfo?(0,a.wf)(this._errInfo.code,this._errInfo.message):(0,a.oW)(this.toJS)}dispose(){this.options.thirdpartyUploadHelper.unRegisterOnUploadListener(this._listenerUploadStatusHandler)}canRetryUpload(){return Boolean(this.options.upload)}retryUpload(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),this.options.thirdpartyUploadHelper.retryUpload(this.id))}retryTranscode(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),this.options.evercloudInstance.triggerImageResize({ids:[this.everCloudId]}),(0,De.z)((()=>{this.observableData.status="transcoding"})),this._listenTranscodeResult())}cancelUpload(){this.options.thirdpartyUploadHelper.deleteFile(this.id)}canSync(){return!1}sync(){return Promise.reject(new Error("no need to sync"))}async delete(){await this.options.evercloudInstance.deleteAsset({ids:[this.id]}),this.dispose()}_listenThirdpartyUploadStatus(e){var t,i,a;if(e.data.id===this.observableData.id)switch(e.data.status){case"transcoding":(0,De.z)((()=>{var t;this.observableData.everCloudId=e.data.everCloudId,this.observableData.status="transcoding",this.observableData.progress=(null!==(t=e.data.progress)&&void 0!==t?t:0)*aa,this.observableData.md5=e.data.md5})),null===(t=this.options.upload)||void 0===t||null===(i=t.onUploadSuccess)||void 0===i||i.call(t,this.observableData),this._listenTranscodeResult();break;case"uploading":(0,De.z)((()=>{var t;this.observableData.status="uploading",this.observableData.progress=(null!==(t=e.data.progress)&&void 0!==t?t:0)*aa}));break;case"failure":(0,De.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:-1,message:e.data.status},null===(a=this._resultWaiter)||void 0===a||a.resolve()}}async _listenTranscodeResult(){const{evercloudInstance:e}=this.options;await this.options.waitForEvercloudInit(),await e.forceSyncPullUpdates();const t=await oa({evercloudInstance:e,everFileInfo:(0,De.ZN)(this.observableData),resolutions:[...Ti.bF,"origin"]});if(t.ok){var i,a,r;const t=await e.getAssetByFileId(this.everCloudId);(0,De.z)((()=>{const{id:e,...i}=(0,na.q)(t);Object.assign(this.observableData,i)})),null===(i=this._resultWaiter)||void 0===i||i.resolve(),null===(a=this.options.upload)||void 0===a||null===(r=a.onTranscodeSuccess)||void 0===r||r.call(a,this.observableData)}else{var s;(0,De.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:t.code,message:t.msg},null===(s=this._resultWaiter)||void 0===s||s.resolve()}}resetWaiter(){var e;this._errInfo=void 0,null===(e=this._resultWaiter)||void 0===e||e.reset()}}var da=i(4271);async function ua(e,t,a,r){var s;const o=Boolean(await(null==t||null===(s=t.isSupportExpand)||void 0===s?void 0:s.call(t))),n=Ki.Z.warning({className:"space-not-enough__modal",icon:null,title:Ae.ZP.t("web_graphic_upload_failure_title",{},"Couldn't upload"),closable:!0,content:Ae.ZP.t("delete_or_enlarge",{},"Your cloud space has reached the storage limit. You can delete some of your cloud files or expand your cloud storage."),onCancel:a,footer:()=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Hi.Z,{onClick:()=>{null==e||e(),n.close(),null==a||a()},children:Ae.ZP.t("web_graphic_upload_material_status_retry",{},"Retry")}),(0,c.jsx)(Hi.Z,{type:"primary",onClick:()=>{o?null==t||t.show({type:da.c.CAPACITY_BUY,reporterParams:{pageFrom:da.K1.spaceUpgrade,currentPage:"picture_edit",enterFrom:"upload_fail"}}):i.g.open(`${window.location.protocol}//${window.location.host}/my-cloud?from_page=picture_edit${r?`&enter_from=${r.enter_from}`:""}`),n.close(),null==a||a()},children:o?Ae.ZP.t("web_first_subscribe_text_upgrading",{},"Upgrade"):Ae.ZP.t("web_graphic_space_go_to_delete",{},"Go to delete")})]})});return n}var ha=i(24380),pa=i(48048),ga=i.n(pa);class _a{static factory(){return _a.streamMd5||(_a.streamMd5=new _a),_a.streamMd5}constructor(){this._initAwaitLock=new ha.G,this.sliceSize=5*Math.pow(2,20),this._sdk=new(ga())({entry:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/stream-md5/streaming_md5.js",wasm:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/stream-md5/streaming_md5.wasm"}),this._sdk.init().then((e=>{this.handler=e,this._initAwaitLock.initDone()}))}getFileMd5(e){return new Promise((async(t,i)=>{await this._initAwaitLock.awaitForInit();let a=0;const r=new FileReader;let s=!0;await this.handler.start();const o=()=>{const t=a*this.sliceSize;let i=t+this.sliceSize;i+this.sliceSize>=e.size&&(s=!1,i=e.size),r.readAsArrayBuffer(e.slice(t,i))};r.onload=async e=>{const r=e.target.result;if(await this.handler.update(r),a++,s)o();else{let e;try{e=await this.handler.end()}catch(n){i(e)}t(e)}},r.onerror=e=>{i(e)},o()}))}}var fa=i(19413);class va extends fa._B{constructor(){super(...arguments),this.name="ever-upload-full"}markEverUploadFullEnd(e){this.extraParams=e,this.markEndTimeAndReport()}getExtraInfo(){var e;return null!==(e=this.extraParams)&&void 0!==e?e:{}}}class ma extends fa._B{constructor(){super(...arguments),this.name="ever-upload"}markEverUploadEnd(e){this.extraParams={isLogin:String(e)},this.markEndTimeAndReport()}getExtraInfo(){var e;return null!==(e=this.extraParams)&&void 0!==e?e:{}}}class ya extends fa._B{constructor(){super(...arguments),this.name="ever-transcode"}markEverTranscodeEnd(e){this.extraParams={isLogin:String(e)},this.markEndTimeAndReport()}getExtraInfo(){var e;return null!==(e=this.extraParams)&&void 0!==e?e:{}}}class Ia{constructor({data:e,...t}){this._allowSyncLocker=new bi.G,this.options=t,this.observableData=(0,De.LO)(e),"success"===e.status&&(this._resultWaiter=new ca,this._resultWaiter.resolve()),"waiting"===e.status&&(this._calcFileMd5(),this.retryUpload()),"transcoding"===e.status&&this._listenTranscodeResult()}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get isSuccess(){return"success"===this.observableData.status}get toJS(){return(0,De.ZN)(this.observableData)}async onDone(){return await this._resultWaiter.done,this._errInfo?(0,a.wf)(this._errInfo.code,this._errInfo.message):(0,a.oW)(this.toJS)}dispose(){var e;this._resultWaiter.dispose(),null===(e=this._uploadRequest)||void 0===e||e.destroy()}canRetryUpload(){var e;return Boolean(null===(e=this.options.upload)||void 0===e?void 0:e.file)}retryUpload(){var e;if(null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked)return;this.resetWaiter();const{evercloudInstance:t,upload:i}=this.options;(0,le.Y2)(null==i?void 0:i.file,"not allow to upload file without upload params"),(0,De.z)((()=>{this.observableData.status="waiting",this.observableData.progress=0}));const a=new ma;a.markStartTime(),t.uploadAssetNoLogin({file:i.file,skipDuplicate:!0,fileType:null!=i&&i.isSilence?"file":void 0}).then((e=>{this._uploadRequest=e,e.onIdle=()=>{(0,De.z)((()=>{var e;this.observableData.status="uploading",null===(e=i.onProgress)||void 0===e||e.call(i,0)}))},e.onProgress=e=>{var t;const a=e.done/e.total*100*aa;(0,De.z)((()=>{this.observableData.status="uploading",this.observableData.progress=a})),null===(t=i.onProgress)||void 0===t||t.call(i,a)},e.onFinish=e=>{var t,r;(this._uploadRequest=void 0,"success"===e.status)&&((0,De.z)((()=>{this.observableData.platformId=e.fileId,this.observableData.status="transcoding",this.observableData.progress=70})),null==i||null===(t=i.onProgress)||void 0===t||t.call(i,70),a.markEverUploadEnd(!1),this._listenTranscodeResult());"error"===e.status&&((0,De.z)((()=>{this.observableData.status="failure"})),this._errInfo=e.errInfo,null===(r=this._resultWaiter)||void 0===r||r.resolve())}}))}retryTranscode(){(0,le.Y2)("\u6682\u65f6\u4e0d\u652f\u6301\u89e6\u53d1\u91cd\u65b0\u8f6c\u7801")}cancelUpload(){var e;null===(e=this._uploadRequest)||void 0===e||e.cancel()}delete(){return this.dispose(),Promise.resolve()}canSync(){return"un-login"===this.observableData.mode&&"failure"!==this.observableData.status}async sync(){await this._allowSyncLocker.awaitForInit(),(0,De.z)((()=>{this.observableData.status="syncing"}));try{var e;const t=await this.options.evercloudInstance.syncVideoToEverCloud(this.observableData.vid,{fileSize:null!==(e=this.observableData.size)&&void 0!==e?e:0,resouceType:this.groupTypeToSyncResourceType(this.observableData.type)}),i=await t.done();if(i.errInfo)xe.Z.warning(Ae.ZP.t("{placeholder0}_synchronization_failed",{placeholder0:this.observableData.name},"Couldn\u2019t sync {placeholder0}")),(0,De.z)((()=>{this.observableData.status="failure"}));else{const{assetId:e}=i.data,t=await this.options.evercloudInstance.getAssetByFileId(e);(0,De.z)((()=>{const{id:e,...i}=(0,na.q)(t);Object.assign(this.observableData,i)}))}}catch(s){let e=-1;try{e=JSON.parse(s).code}catch(o){}var t,i,a,r;if((0,De.z)((()=>{this.observableData.status="sync-failure"})),e===ra)null===(t=this.options.upload)||void 0===t||null===(i=t.showSyncFileErrorModal)||void 0===i||i.call(t,"expand");else null===(a=this.options.upload)||void 0===a||null===(r=a.showSyncFileErrorModal)||void 0===r||r.call(a,"error"),xe.Z.warning(Ae.ZP.t("{placeholder0}_synchronization_failed",{placeholder0:this.observableData.name},"Couldn\u2019t sync {placeholder0}"));throw s}}async _listenTranscodeResult(){const{evercloudInstance:e}=this.options;(0,le.Y2)(this.observableData.platformId,"not has platformId could not query");const t=new ya;t.markStartTime();const i=await(await e.getVideoAssetTranscodeStatusNoSign(this.observableData.platformId)).done();if(i.data){var a;const{image:e}=i.data,r=await Promise.all([this._formatTranscodeInfo(await(0,Ei.S)(this.options.upload.file),"origin"),this._formatTranscodeInfo(e.image_360p_url),this._formatTranscodeInfo(e.image_720p_url),this._formatTranscodeInfo(e.image_1080p_url)]);this.options.upload.file=void 0,(0,De.z)((()=>{Object.assign(this.observableData,{status:"success",vid:e.source,cover:e.image_360p_url,url:e.origin,width:r[0].origin.width,height:r[0].origin.height,transcodeInfo:r.reduce(((e,t)=>e={...e,...t}),{})})})),null===(a=this._resultWaiter)||void 0===a||a.resolve(),t.markEverTranscodeEnd(!1),this._allowSyncLocker.initDone()}else if(i.errInfo){var r;(0,De.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:i.errInfo.code,message:i.errInfo.msg},null===(r=this._resultWaiter)||void 0===r||r.resolve()}}async _calcFileMd5(){const e=_a.factory(),t=await e.getFileMd5(this.options.upload.file);(0,De.z)((()=>{this.observableData.md5=t}))}async _formatTranscodeInfo(e,t){const i=await(a=e,new Promise(((e,t)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){e({width:i.width,height:i.height})},i.onerror=function(){t(new Error("could not load img"))},i.src=a})));var a;return{[null!=t?t:`${i.width}x${i.height}`]:{full_url:e,width:i.width,height:i.height}}}groupTypeToSyncResourceType(e){switch(e){case"video":default:return 1;case"audio":return 2;case"image":return 3}}resetWaiter(){this._errInfo=void 0,this._resultWaiter=new ca}}class wa{constructor({data:e,...t}){this.options=t,this.observableData=(0,De.LO)(e),"success"===e.status&&(this._resultWaiter=new ca,this._resultWaiter.resolve()),"waiting"===e.status&&this.retryUpload(),"transcoding"===e.status&&this.retryTranscode()}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get isSuccess(){return"success"===this.observableData.status}get toJS(){return(0,De.ZN)(this.observableData)}async onDone(){return await this._resultWaiter.done,this._errInfo?(0,a.wf)(this._errInfo.code,this._errInfo.message):(0,a.oW)(this.toJS)}dispose(){var e;this._resultWaiter.dispose(),null===(e=this._uploadRequest)||void 0===e||e.destroy()}canRetryUpload(){var e;return Boolean(null===(e=this.options.upload)||void 0===e?void 0:e.file)}retryUpload(){var e,t,i;if(null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked)return;this.resetWaiter();const{evercloudInstance:a,upload:r}=this.options;(0,le.Y2)(null==r?void 0:r.file,"not allow to upload file without upload params"),r.checkAndUpdateUserSpace(r.file.size)||(0,De.z)((()=>{this.observableData.status="failure"})),(0,De.z)((()=>{this.observableData.status="waiting",this.observableData.progress=0})),null===(t=this.options.upload)||void 0===t||null===(i=t.onStartToUpload)||void 0===i||i.call(t);const s=new ma;s.markStartTime(),a.uploadAsset({file:r.file,skipDuplicate:!0,fileType:null!=r&&r.isSilence?"file":void 0}).then((e=>{this._uploadRequest=e,e.onIdle=()=>{(0,De.z)((()=>{var e;this.observableData.status="uploading",null===(e=r.onProgress)||void 0===e||e.call(r,0)}))},e.onProgress=e=>{var t;const i=e.done/e.total*100*aa;(0,De.z)((()=>{this.observableData.progress=i})),null===(t=r.onProgress)||void 0===t||t.call(r,i)},e.onFinish=e=>{var t,i,a;(this._uploadRequest=void 0,"success"===e.status)&&(this.options.upload.file=void 0,(0,De.z)((()=>{this.observableData.everCloudId=e.fileId,this.observableData.md5=e.md5,this.observableData.status="transcoding",this.observableData.progress=70})),null===(t=r.onUploadSuccess)||void 0===t||t.call(r,this.observableData),null==r||null===(i=r.onProgress)||void 0===i||i.call(r,70),s.markEverUploadEnd(!0),this._listenTranscodeResult());"error"===e.status&&((0,De.z)((()=>{this.observableData.status="failure"})),e.errInfo.code===Ti.tN.INSUFFICIENT_SPACE&&this.options.upload.showUserSpaceInsufficient(),this._errInfo=e.errInfo,null===(a=this._resultWaiter)||void 0===a||a.resolve())}}))}retryTranscode(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),(0,De.z)((()=>{this.observableData.status="transcoding"})),this.options.evercloudInstance.triggerImageResize({ids:[this.everCloudId]}),this._listenTranscodeResult())}cancelUpload(){var e;null===(e=this._uploadRequest)||void 0===e||e.cancel()}canSync(){return!1}sync(){return Promise.reject(new Error("no need to sync"))}async delete(){await this.options.evercloudInstance.deleteAsset({ids:[this.everCloudId]}),this.dispose()}async _listenTranscodeResult(){var e;const{evercloudInstance:t}=this.options,i=new ya;i.markStartTime();const a=await oa({evercloudInstance:t,everFileInfo:(0,De.ZN)(this.observableData),resolutions:[...Ti.bF,"origin"],onProgress:null===(e=this.options.upload)||void 0===e?void 0:e.onProgress});if(a.ok){var r;const e=await t.getAssetByFileId(this.everCloudId);(0,De.z)((()=>{const{id:t,...i}=(0,na.q)(e);Object.assign(this.observableData,i)})),null===(r=this._resultWaiter)||void 0===r||r.resolve(),i.markEverTranscodeEnd(!0)}else{var s;(0,De.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:a.code,message:a.msg},null===(s=this._resultWaiter)||void 0===s||s.resolve()}}resetWaiter(){this._errInfo=void 0,this._resultWaiter=new ca}}var Sa,ba,Ca,Ea,ka,Ta,Pa,Da,xa,Aa=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ra=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Fa=function(e,t){return function(i,a){t(i,a,e)}};let Ma=class extends _e.JT{constructor(e,t,i,a,r,s,o,n,c){if(super(),this.accountService=e,this.workspaceService=t,this.draftManagerService=i,this.documentModelService=a,this.workbenchService=r,this.environmentService=s,this.userMaterialsService=o,this.userService=n,this.teaReportService=c,this.observableData=(0,De.LO)({allEverFileInfos:[]}),this.hiddenEverFilesMap={},this._isReady=!1,this._requestSpaceStorageLocker=new Ui.w,this._onMaterialChange=this._store.add(new fe.Q),this.onMaterialChange=this._onMaterialChange.event,this._oReady=this._store.add(new fe.Q),this.onReady=this._oReady.event,this._onInitialExpandInstance=this._store.add(new fe.Q),this.onInitialExpandInstance=this._onInitialExpandInstance.event,this.isSupportPay=!1,this._syncPackageDone=!1,this._spaceResetStorage=void 0,this._currentExpandWorkspaceId="",this._listenExpandInstanceCallbacks=[],this._thirdpartyUploadStatesCallbacks=[],this._isFromGoogleMarket=!1,this.isSigned=e.hasLogin,this._draftEvercloudInstance=this.userMaterialsService.getBaseEvercloud(),this._isFromGoogleMarket=(0,p.td)(),this.isSigned)this._syncPackageDone=!0,this._isFromGoogleMarket?this._initEntryFromThirdparty():this._initEvercloudServiceByLogin();else{this._syncPackageLocker=new bi.G;const e=this.draftManagerService.onStateChange((t=>{t.isAvailable&&(e.dispose(),this.isSigned=!0,this._isFromGoogleMarket?this._initEntryFromThirdparty():this._initEvercloudServiceByLogin(),this._syncAllAssetToPackage())}));this._noSignEverCloudInitPromise=this._initEvercloudServiceByUnLogin()}this._initHiddenEverFiles(),this.initObservableData(),this.draftManagerService.setDependence("uploadCover",(e=>this.uploadMaterial({file:e,saveDraftAfterUpload:!1,isSilence:!0}))),this._autoNotify();[this.accountService.onDidChangeVipInfo,this.workspaceService.onDidWorkspaceExpandInfoMapChange,this.workspaceService.onDidWorkspaceChange,this.draftManagerService.onWorkspaceIdChange].forEach((e=>{e((()=>{this._updateExpandInstanceConfig()}))})),this.draftManagerService.onWorkspaceIdChange((()=>{const e=this.workspaceService.getWorkspace(this.draftManagerService.workspaceId);this._draftEvercloudInstanceChangeSpace(e)})),this.onInitialExpandInstance((e=>{this._listenExpandInstanceCallbacks.forEach((t=>{t(e)})),e.isSupportExpand().then((e=>{this.isSupportPay=e}))}))}get isReady(){return this._isReady}get materials(){return this.observableData.allEverFileInfos.map((e=>e.toJS))}get supportThirdpartyUpload(){return!0}waitForReady(){return this.isReady?Promise.resolve():new Promise((e=>{(0,Oi.V)(this.onReady)((()=>{e()}))}))}cancelUpload(e){const t=this.observableData.allEverFileInfos.find((t=>t.id===e));(0,le.Y2)(t,"file not existed"),t.cancelUpload(),this.observableData.allEverFileInfos=this.observableData.allEverFileInfos.filter((t=>t.id!==e))}retryTranscode(e){this.observableData.allEverFileInfos.find((t=>t.id===e)).retryTranscode()}deleteMaterial(e){const t=this.observableData.allEverFileInfos.find((t=>t.id===e));return(0,le.Y2)(t,"not found target"),t.dispose(),this.observableData.allEverFileInfos=this.observableData.allEverFileInfos.filter((t=>t.id!==e)),this._saveDraftData(),Promise.resolve()}addEverCloudFile(e){const t=(0,na.q)(e),i=new wa({evercloudInstance:this._draftEvercloudInstance,data:t});return this.observableData.allEverFileInfos=this.observableData.allEverFileInfos.concat(i),t}async showThirdpartyUploadModal(e){this._isFromGoogleMarket&&!this.observableData.allEverFileInfos.length&&this._initThirdpartyHelper(),await this._initEverCloudSdk(),this.thirdpartyUploadHelper.show(e)}showThirdpartyUploadModalWithSpaceChange(e,t){this._initThirdpartyHelper({workspaceList:t,selectWorkSpaceCb:async e=>{this.draftManagerService.updateWorkspaceInfo({workspaceId:e.workspace_id,name:e.name}),this.thirdpartyUploadHelper.setWorkspaceId(e.workspace_id),this._draftWorkspaceId=e.workspace_id,this._initEverCloudLocker=new bi.G,await this._initEverCloudSdk(),await this._draftEvercloudInstanceChangeSpace(e),this._initEverCloudLocker.initDone()}}),this.thirdpartyUploadHelper.show(e,"auto")}registerThirdpartyUploadStatesCallback(e){this.thirdpartyUploadHelper?this.thirdpartyUploadHelper.registerOnUploadListener(e):this._thirdpartyUploadStatesCallbacks.push(e)}unRegisterThirdpartyUploadStatesCallback(e){this.thirdpartyUploadHelper.unRegisterOnUploadListener(e)}async copyMaterialFromSpace(e){return await this._initEverCloudSdk(),this.observableData.allEverFileInfos=[new wa({evercloudInstance:this._draftEvercloudInstance,data:e}),...this.observableData.allEverFileInfos],(0,a.ly)()}selectFromVideo(){return Promise.resolve((0,a.wf)(-1,""))}async appendCoverKey(e,t){await this._initEverCloudSdk(),null!=t&&t.forceSync&&await this._draftEvercloudInstance.forceSyncPullUpdates();const i=await this._draftEvercloudInstance.getAssetByMd5(e),a=new wa({evercloudInstance:this._draftEvercloudInstance,data:(0,na.q)(i)});return this.observableData.allEverFileInfos=[a,...this.observableData.allEverFileInfos.filter((e=>e.everCloudId!==a.everCloudId))],a.toJS}retryUpload(e){const t=this.observableData.allEverFileInfos.find((t=>t.id===e));(0,le.Y2)(t,"material not found, could not retry. check logic"),(0,le.Y2)(t.canRetryUpload(),"material can not retry"),t.retryUpload()}canRetryUploadById(e){var t,i;return null!==(t=null===(i=this.observableData.allEverFileInfos.find((t=>t.id===e)))||void 0===i?void 0:i.canRetryUpload())&&void 0!==t&&t}async uploadMaterial(e){const t=new va;t.markStartTime(),await(this.accountService.hasLogin?this._everCloudInitPromise:this._noSignEverCloudInitPromise),e.isSwitchToUploadPanel&&this.workbenchService.activeSiderMenuByName(ki.t,"auto");const{file:i,isSilence:a=!1,onProgress:r,saveDraftAfterUpload:s=!0}=e;if(!(0,Ni.H1)({file:i,accepts:["image"]})&&!a)throw new Error(Ae.ZP.t("file_types_not_supported_by_{placeholder0}",{placeholder0:i.name},"{placeholder0} is not supported"));let o;return o=this.accountService.hasLogin?new wa({evercloudInstance:this._draftEvercloudInstance,upload:{file:i,isSilence:a,onProgress:r,onStartToUpload:()=>{this._spaceResetStorage&&(this._spaceResetStorage.space-=i.size)},onUploadSuccess:e=>{this.checkFileUniqueWhenUploadSuccess(e),s&&this._saveDraftData()},checkAndUpdateUserSpace:async e=>await this._getResetSpaceStorage()<e,showUserSpaceInsufficient:this.showUserSpaceInsufficientStandard.bind(this,[i])},data:Pi(i,"login")}):new Ia({evercloudInstance:this._draftEvercloudInstance,upload:{file:i,isSilence:a,onProgress:r,showSyncFileErrorModal:this._showSyncFailureModal.bind(this)},data:Pi(i,"un-login")}),a||(this.observableData.allEverFileInfos=[o,...this.observableData.allEverFileInfos]),o.onDone().then((e=>(t.markEverUploadFullEnd({isLogin:String(this.accountService.hasLogin),everUploadStatus:o.observableData.status}),e)))}async getMaterialSourceData({id:e,sourceFrom:t,index:i,previewUrl:r,pixel:s}){const o=this.materials.find((t=>t.id===e));if(!o)return(0,a.wf)(-1,`material not found: please check: ${e}`);if("success"!==o.status)return(0,a.wf)(-1,"material status not success, please wait");const{transcodeInfo:n}=o,c=mt.fc.getInstance().parser.everCloud.fetchData({id:o.md5,resourceId:o.md5,type:Ie.xP.EverCloud,previewUrl:r,fileUrl:{md5:o.md5,url:o.url},aesKey:o.coverKey,transcode:n});if(n){const e=(0,ji.I)(n,s),t=`${o.md5}:${e.width}:${e.height}`;mt.fc.getInstance().parser.everCloud.fetchData({id:t,resourceId:t,type:Ie.xP.EverCloud,previewUrl:r,fileUrl:{md5:t,url:e.full_url},aesKey:e.aesKey,transcode:n})}let l;return l=r||(await c).content,(0,a.oW)({type:mi.P.EverImage,data:{id:o.md5,width:o.width,height:o.height,resContent:l,md5:o.md5,resourceId:o.md5,sourceFrom:t,name:o.name,index:i},sourceRect:{width:o.width,height:o.height}})}async getEverFilesByMD5(e){if(!this.accountService.hasLogin){const t=new Set(e);return this.materials.filter((e=>t.has(e.md5)))}await this._initEverCloudSdk();return(await this._draftEvercloudInstance.getAsset({md5s:e})).map((e=>(0,na.q)(e)))}async waitForUnLoginSync(){var e;await(null===(e=this._syncPackageLocker)||void 0===e?void 0:e.awaitForInit())}showUserSpaceInsufficient(e){ua(this._retryAllUploadFailFiles.bind(this),this._expandInstance,(()=>{}),e)}showUserSpaceInsufficientStandard(e){!async function(e,t){const i=await(null==t?void 0:t.isSupportExpand());null==t||t.show({type:da.c.UPLOAD_FULL_SPACE_RESOLVE,uploadFileList:e,isUpgradeEntryVisible:i})}(e,this._expandInstance)}updateHiddenEverFiles(e,t){this.hiddenEverFilesMap[e]=t,this.documentModelService.updateAllEverFiles(this._getFormatAllEverFileInfos())}async initObservableData(){if(this.accountService.hasLogin){await this._initEverCloudSdk();try{const e=this._getAllHiddenEverFiles().map((({md5:e})=>e)),t=(await this._draftEvercloudInstance.getPackageByKey(this._draftPackageId)).assets.map((e=>e.md5)),i=await this._draftEvercloudInstance.getAssetsByMd5(t);this.observableData.allEverFileInfos=i.filter((e=>"image"===e.type&&"image/gif"!==e.mime&&""!==e.name)).filter((({md5:t})=>!e.includes(t))).sort(((e,t)=>t.updatedAt-e.updatedAt)).map((e=>new wa({evercloudInstance:this._draftEvercloudInstance,data:(0,na.q)(e)})))}catch(e){}}this._isReady=!0,this._oReady.fire([])}_initHiddenEverFiles(){this.documentModelService.getAllEverFiles().forEach((e=>{if(!e.meta||e.meta.visible)return;const{meta:t}=e;this.hiddenEverFilesMap[t.id]?this.hiddenEverFilesMap[t.id].push(e):this.hiddenEverFilesMap[t.id]=[e]}))}_initEvercloudServiceByLogin(){this._draftWorkspaceId=this.draftManagerService.workspaceId,this._draftPackageId=this.draftManagerService.draftId,this._everCloudInitPromise=this._initEverCloudSdk(),this._initThirdpartyHelper()}_initEntryFromThirdparty(){this._draftWorkspaceId=this.draftManagerService.workspaceId,this._draftPackageId=this.draftManagerService.draftId,this._everCloudInitPromise=this._initEverCloudSdk()}async _initEvercloudServiceByUnLogin(){await new Promise((e=>{this.userMaterialsService.isReady?e():this.userMaterialsService.onReady((()=>{e()}))})),await this._draftEvercloudInstance.noSignInit()}_initThirdpartyHelper(e){(0,le.Y2)(this.accountService.hasLogin,"user is not sign"),this.thirdpartyUploadHelper=new zi({uid:this.accountService.userProfile.uid,workspaceId:e?e.workspaceId:this._draftWorkspaceId,reqDomain:this.accountService.userProfile.reqDomain,packageId:this._draftPackageId,showUserSpaceInsufficient:e=>{this.thirdpartyUploadHelper.setWorkspaceId(this.draftManagerService.workspaceId),this.showUserSpaceInsufficient(e)},workspaceList:null==e?void 0:e.workspaceList,selectWorkSpaceCb:null==e?void 0:e.selectWorkSpaceCb}),this.listenExpandInstance(this._currentExpandWorkspaceId,(e=>{this.thirdpartyUploadHelper.setThirdpartyStorageExpandModalInstance(e)})),this.thirdpartyUploadHelper.registerOnUploadListener((({type:e,isNewFile:t,data:i})=>{t&&(0,De.z)((()=>{this.observableData.allEverFileInfos=[new la({thirdpartyUploadHelper:this.thirdpartyUploadHelper,evercloudInstance:this._draftEvercloudInstance,upload:{onUploadSuccess:e=>{this.checkFileUniqueWhenUploadSuccess(e),this._saveDraftData()},onTranscodeSuccess:t=>{this.thirdpartyUploadHelper.broadcastFileStatus({type:e,data:t,triggerType:this.thirdpartyUploadHelper.uploadTriggerType})}},data:i,waitForEvercloudInit:async()=>{var e;await(null===(e=this._initEverCloudLocker)||void 0===e?void 0:e.awaitForInit())}}),...this.observableData.allEverFileInfos.filter((e=>e.id!==i.id))]}))})),this._registerThirdpartyUploadStatesCallbacks()}_registerThirdpartyUploadStatesCallbacks(){this._thirdpartyUploadStatesCallbacks.length&&(this._thirdpartyUploadStatesCallbacks.forEach((e=>{this.thirdpartyUploadHelper.registerOnUploadListener(e)})),this._thirdpartyUploadStatesCallbacks=[])}async _initEverCloudSdk(){if(this._everCloudInitPromise)return this._everCloudInitPromise;const e=this.workspaceService.getWorkspace(this.draftManagerService.workspaceId);await new Promise((e=>{this.userMaterialsService.isReady?e():(0,Oi.V)(this.userMaterialsService.onReady)((()=>{e()}))})),this._everCloudInitPromise=await this._draftEvercloudInstanceChangeSpace(e)}_draftEvercloudInstanceChangeSpace(e){return this._draftEvercloudInstance.changeSpace({spaceId:e.space_id,dcName:e.space_idc,netconf:{base:e.space_host,media:e.space_res_host}})}async _getResetSpaceStorage(){if(await this._requestSpaceStorageLocker.acquire(),this._spaceResetStorage&&Date.now()-this._spaceResetStorage.updateTime<=6e4)return this._requestSpaceStorageLocker.release(),this._spaceResetStorage.space;const e=await this._draftEvercloudInstance.resetSpaceStorage(this._draftWorkspaceId);return this._spaceResetStorage={space:e,updateTime:Date.now()},this._requestSpaceStorageLocker.release(),this._spaceResetStorage.space}_retryAllUploadFailFiles(){this._spaceResetStorage=void 0;const e=this.observableData.allEverFileInfos.filter((e=>e.canRetryUpload()));for(const t of e)t.retryUpload()}_notifyChange(){this._onMaterialChange.fire(this.materials),this.documentModelService.updateAllEverFiles(this._getFormatAllEverFileInfos())}_getFormatAllEverFileInfos(){return this.observableData.allEverFileInfos.map((e=>e.toJS)).filter((e=>["success","transcoding"].includes(e.status))).filter((e=>Boolean(e.everCloudId))).map((e=>{var t,i;return{size:null!==(t=e.size)&&void 0!==t?t:0,md5:e.md5,sourcePath:null!==(i=e.sourcePath)&&void 0!==i?i:""}})).concat(this._getAllHiddenEverFiles())}_getAllHiddenEverFiles(){let e=[];return Object.values(this.hiddenEverFilesMap).forEach((t=>{e=e.concat(t)})),e}_saveDraftData(){this.isSigned&&this.draftManagerService.saveDraft()}async _syncAllAssetToPackage(e=!0){try{var t;await this._everCloudInitPromise;const i=this.observableData.allEverFileInfos.filter((e=>"un-login"===e.observableData.mode&&e.canSync()));await Promise.all(i.map((e=>e.sync()))),this.draftManagerService.bootstrap(),!i.length&&this.documentModelService.isEmptyDocument()||!e||this._saveDraftData(),null===(t=this._syncPackageLocker)||void 0===t||t.initDone(),this._syncPackageDone=!0}catch(a){var i;throw null===(i=this._syncPackageLocker)||void 0===i||i.initDone({reject:a}),a}}checkFileUniqueWhenUploadSuccess(e){(0,De.z)((()=>{const{allEverFileInfos:t}=this.observableData,i=t.reduce(((t,i,a)=>(i.everCloudId===e.everCloudId&&t.push(a),t)),[]);i.length>1&&(this.observableData.allEverFileInfos=t.filter(((e,t)=>i[0]===t||!i.includes(t))))}))}_showSyncFailureModal(e){this._syncPackageDone?"expand"===e&&this.showUserSpaceInsufficient():(e=>{if(ta.isLocked)return;ta.acquire();let t=document.getElementById("containerId");t||(t=document.createElement("div"),t.id="sync-draft-failure-modal-container",document.body.appendChild(t)),o.createRoot(t).render((0,c.jsx)(ia,{...e,onClose:()=>{ta.release()}}))})({mode:e,draftName:this.documentModelService.graphicSDK.document.title,currentWorkspaceId:this.draftManagerService.workspaceId,workspaceList:this.workspaceService.workspaceList,retry:async t=>{try{if(this._syncPackageLocker=new bi.G,this._draftWorkspaceId===t.workspace_id)await this._syncAllAssetToPackage();else{const e=!qt.e1.parserDraftIdFromUrl();if(e&&this.draftManagerService.updateWorkspaceInfo({workspaceId:t.workspace_id,name:t.name}),this._draftWorkspaceId=this.draftManagerService.workspaceId,await this._draftEvercloudInstanceChangeSpace(t),await this._syncAllAssetToPackage(e),e)return;await this.draftManagerService.moveDraft({workspaceId:t.workspace_id,name:t.name});const a=p.m4.create(location.href).removeQueryParameter("workspaceId").addQueryParameter("workspaceId",t.workspace_id).toString();i.g.history.replaceState({},"",a)}}catch(a){throw xe.Z.error("expand"===e?Ae.ZP.t("web_project_toast_not_enough_space",{},"This space doesn\u2019t have enough storage. Try another one."):Ae.ZP.t("web_network_error",{},"An error occurred. Try again later.")),a}},giveUp:()=>{i.g.location.href=`${location.origin}/my-cloud/${this.draftManagerService.workspaceId}`}})}_autoNotify(){let e=[];(0,De.N7)(this.observableData,(t=>{e.forEach((e=>e())),"allEverFileInfos"===t.name&&(e=t.newValue.map((e=>(0,De.N7)(e.observableData,(()=>{this._notifyChange()}))))),this._notifyChange()}))}_updateExpandInstanceConfig(){this._initExpandInstance(this._currentExpandWorkspaceId)}async _initExpandInstance(e){var t,a,r,s,o;if(!this.isSigned)return;if(!this.workspaceService.available||!this.draftManagerService.isAvailable)return;const{userProfile:n}=this.accountService,{workspaceExpandInfoMap:c}=this.workspaceService,l=e||this.draftManagerService.workspaceId||this.workspaceService.workspaceList[0],d=this.workspaceService.workspaceList,u=null==n||null===(t=n.spaceInfo)||void 0===t?void 0:t.workspaceId,h=l?null==d?void 0:d.find((e=>e.workspace_id===l)):void 0,p=u&&(null==d?void 0:d.find((e=>e.workspace_id===u))),g=this.teaReportService.getTeaConfig(),{LvStorageExpandModalSingleton:_}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,62356));return this._expandInstance=_({userInfo:{name:null!==(a=null==n?void 0:n.name)&&void 0!==a?a:"",avatar:null!==(r=null==n?void 0:n.avatar)&&void 0!==r?r:"",hasLogined:this.accountService.hasLogin||!1,uid:null==n?void 0:n.uid,email:null==n?void 0:n.email,idc:null==n?void 0:n.idc,region:null!==(s=n.region)&&void 0!==s?s:"",createTime:null==n?void 0:n.create_time,vipInfo:this.accountService.userVipInfo,reqDomain:n.reqDomain},workspaceInfo:h,workspaceList:d,defaultWorkspaceInfo:p,cloudInfo:c&&null!=h&&h.workspace_id?c[h.workspace_id]:void 0,cookieConsent:Bi.cookieConsent,shouldStartFirstPartyAnalytics:!1,getABTestConfig:this.teaReportService.getABTestVar,isBOE:!this.environmentService.isProd||!1,riskInfo:{webid:null==g||null===(o=g.user)||void 0===o?void 0:o.web_id},handleReporterProcessing:(e,t)=>{se.I.getInstance().reportEvent(e,t)},onPayStatusChange:(e,t)=>{var i;const a=this.userService.dangerUsedUserMachineService;if(e===da.lp.SUCCESS)a.send({type:"UPDATE_WORKSPACE",workspaceId:null!=t&&null!==(i=t.productInfo)&&void 0!==i&&i.isCloud?null==h?void 0:h.workspace_id:u}),a.send({type:"UPDATE_VIP_INFO"})}}),this._onInitialExpandInstance.fire(this._expandInstance),this._expandInstance}async getExpandInstance(e){this._currentExpandWorkspaceId=e;return await this._initExpandInstance(e)}listenExpandInstance(e,t){this._currentExpandWorkspaceId=e,this._listenExpandInstanceCallbacks.push(t),this._initExpandInstance(e)}};Ma=Aa([Fa(0,Re.D),Fa(1,r.WL),Fa(2,Me.j),Fa(3,ge.w),Fa(4,Ge.e),Fa(5,ei.j),Fa(6,Zt.b),Fa(7,x.S),Fa(8,q.w),Ra("design:paramtypes",["function"==typeof(Sa=void 0!==F.Gw&&F.Gw)?Sa:Object,"function"==typeof(ba=void 0!==r.WL&&r.WL)?ba:Object,"function"==typeof(Ca=void 0!==Me.j&&Me.j)?Ca:Object,"function"==typeof(Ea=void 0!==ge.w&&ge.w)?Ea:Object,"function"==typeof(ka=void 0!==Ge.e&&Ge.e)?ka:Object,"function"==typeof(Ta=void 0!==ei.j&&ei.j)?Ta:Object,"function"==typeof(Pa=void 0!==Zt.b&&Zt.b)?Pa:Object,"function"==typeof(Da=void 0!==x.S&&x.S)?Da:Object,"function"==typeof(xa=void 0!==q.w&&q.w)?xa:Object])],Ma);var La,Oa,Ua,Na,ja,Ba,Wa,Ga,za,Ka,Ha=i(62917),Za=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Ya=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Va=function(e,t){return function(i,a){t(i,a,e)}};let $a=class extends Ma{constructor(e,t,i,a,r,s,o,n,c,l){super(t,i,a,r,s,o,n,c,l),this.iframeBridgeService=e,this.userService=c,this.teaReportService=l}initObservableData(){return new Promise((e=>{(0,Oi.V)(this.documentModelService.onModelDidInit)((async()=>{const t=this.documentModelService.getAllEverFiles();if(this.accountService.hasLogin&&(await this._initEverCloudSdk(),t.length)){const e=await this._draftEvercloudInstance.getAssetsByMd5(t.map((e=>e.md5)));this.observableData.allEverFileInfos=e.filter((e=>"image"===e.type&&"image/gif"!==e.mime&&""!==e.name)).sort(((e,t)=>t.updatedAt-e.updatedAt)).map((e=>new wa({evercloudInstance:this._draftEvercloudInstance,data:(0,na.q)(e)})))}this._isReady=!0,this._oReady.fire([]),e()}))}))}async selectFromVideo(){const e=await this.iframeBridgeService.selectVideoFrameByMd5();if(!e.ok)return e;await this._draftEvercloudInstance.forceSyncPullUpdates();const t=await this._draftEvercloudInstance.getAssetByMd5(e.value),i=new wa({evercloudInstance:this._draftEvercloudInstance,data:(0,na.q)(t)});this.observableData.allEverFileInfos=[i,...this.observableData.allEverFileInfos.filter((e=>e.everCloudId!==i.everCloudId))];const r=i.toJS;return mt.fc.getInstance().parser.everCloud.fetchData({id:r.md5,resourceId:r.md5,fileUrl:{url:r.url,md5:r.md5},type:Ie.xP.EverCloud,aesKey:r.coverKey,transcode:r.transcodeInfo}),(0,a.oW)(r)}};$a=Za([Va(0,Ha.Z),Va(1,Re.D),Va(2,r.WL),Va(3,Me.j),Va(4,ge.w),Va(5,Ge.e),Va(6,ei.j),Va(7,Zt.b),Va(8,x.S),Va(9,q.w),Ya("design:paramtypes",["function"==typeof(La=void 0!==Ha.Z&&Ha.Z)?La:Object,"function"==typeof(Oa=void 0!==F.Gw&&F.Gw)?Oa:Object,"function"==typeof(Ua=void 0!==r.WL&&r.WL)?Ua:Object,"function"==typeof(Na=void 0!==Me.j&&Me.j)?Na:Object,"function"==typeof(ja=void 0!==ge.w&&ge.w)?ja:Object,"function"==typeof(Ba=void 0!==Ge.e&&Ge.e)?Ba:Object,"function"==typeof(Wa=void 0!==ei.j&&ei.j)?Wa:Object,"function"==typeof(Ga=void 0!==Zt.b&&Zt.b)?Ga:Object,"function"==typeof(za=void 0!==x.S&&x.S)?za:Object,"function"==typeof(Ka=void 0!==q.w&&q.w)?Ka:Object])],$a);var qa=i(88494),Ja=i(67656),Xa=i(25351),Qa=i(23224);const er="container-dhAyq4",tr="title-iZMg1t",ir="radioGroup-o19it3",ar="radio-xhuVB7",rr="normal-XB3Wuc",sr="logo-QsneM3",or="centerCont-ylbmXk",nr="spaceName-m6QEWK",cr="disabled-VfSMYu",lr="remainTip-vxbyXB",dr="upgrade-B2ZQ2n",ur="dot-SbB5UD",hr="checked-DHm2LY";var pr=i(37180);const gr=e=>{const{isSupportPay:t,spaceList:a,defaultSpaceId:r,onMove:s,materials:o,draftTitle:l,hasPermission:d,showExpand:u,onSpaceListChange:h,getExpandInstance:p}=e,g=(0,n.useMemo)((()=>a.find((({workspace_id:e})=>e===r))),[a,r]),_=(0,n.useMemo)((()=>o.reduce(((e,t)=>{var i;return e+(null!==(i=t.size)&&void 0!==i?i:0)}),0)),[o]),[f,v]=(0,n.useState)(!0),[m,y]=(0,n.useState)(!1),[I,w]=(0,n.useState)(a),[S,b]=(0,n.useState)(),[C,E]=(0,n.useState)(!1),[k,T]=(0,n.useState)([]),P=(0,n.useMemo)((()=>{var e;return null!==(e=null==S?void 0:S.workspace_id)&&void 0!==e?e:r}),[S,r]),D=(0,n.useMemo)((()=>P===r),[P,r]),[x]=(0,n.useState)(t);(0,n.useEffect)((()=>{const e=I.map((e=>{var t,i;const a=(null!==(t=e.quota)&&void 0!==t?t:0)-(null!==(i=e.usage)&&void 0!==i?i:0),r=a<_;return{...e,remainSize:a,needUpgrade:r,disabled:r&&!x}}));Promise.all(e).then((e=>{T(e)}))}),[a,_,I,p,x]),(0,n.useEffect)((()=>{g&&((e,t)=>{const i=(null!==(e=g.quota)&&void 0!==e?e:0)-(null!==(t=g.usage)&&void 0!==t?t:0)<_;E(x&&i)})()}),[g,_,p,x]),(0,n.useEffect)((()=>h((e=>{var t,i;w(e);const a=e.find((({workspace_id:e})=>e===P));E((null!==(t=null==a?void 0:a.quota)&&void 0!==t?t:0)-(null!==(i=null==a?void 0:a.usage)&&void 0!==i?i:0)<_)})).dispose),[]);return(0,n.useEffect)((()=>{new pr.EZ("show").report()}),[]),(0,n.useEffect)((()=>{C&&new pr.EZ("upgrade_show").report()}),[C]),(0,c.jsx)(Ki.Z,{visible:f,className:er,title:(0,c.jsx)("span",{className:tr,children:Ae.ZP.t("web_default_space_title_moves",{string0:l},"Move \u201c{string0}\u201d to")}),focusLock:!1,onCancel:()=>{v(!1),new pr.EZ("close").report()},footer:C?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Hi.Z,{size:"large",onClick:()=>{new pr.EZ("clear_space",g,S).report(),i.g.open(`${location.origin}/my-cloud/${null==S?void 0:S.workspace_id}?from_page=picture_edit&enter_from=clear_space`)},children:Ae.ZP.t("web_default_space_button_free_up",{},"Free up")}),(0,c.jsx)(Hi.Z,{size:"large",type:"primary",onClick:()=>{u(P),new pr.EZ("upgrade",g,S).report()},children:Ae.ZP.t("web_editor_storage_expand",{},"Upgrade")})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Hi.Z,{size:"large",onClick:()=>{v(!1),new pr.EZ("cancel").report()},children:Ae.ZP.t("web_cancel",{},"Cancel")}),(0,c.jsx)(Hi.Z,{size:"large",loading:m,onClick:async()=>{if(S){y(!0);try{await s(S),xe.Z.success(Ae.ZP.t("web_default_space_text_move_tos_successfully",{string0:l,string1:S.name},"{string0} moved to {string1}")),v(!1)}catch(e){xe.Z.error(Ae.ZP.t("space_files_move_failed",{},"Couldn\u2019t move"))}finally{new pr.EZ("confirm",g,S).report(),y(!1)}}},type:"primary",disabled:D,children:m?Ae.ZP.t("web_default_space_text_move_one",{},"Moving"):Ae.ZP.t("web_default_space_text_move",{},"Move")})]}),children:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{children:Ae.ZP.t("web_default_space_text_you_can_move",{strong0:e=>(0,c.jsx)("strong",{children:e},`${e}-${Math.random()}`),string0:l},"Select a space you want to move <strong0>{string0}</strong0> to")}),(0,c.jsx)(Vi.Z.Group,{className:ir,value:P,children:k.map((e=>{const t=(0,c.jsx)(Vi.Z,{value:e.workspace_id,className:ar,onChange:t=>((e,t)=>{e&&P!==t.workspace_id&&(E(t.needUpgrade),b(t))})(t,e),disabled:e.disabled||!d,children:({checked:t})=>(0,c.jsxs)("div",{className:qi()(rr,{[hr]:t}),children:[(0,c.jsx)("span",{className:sr,style:{backgroundColor:e.avatar_color},children:e.name.slice(0,1).toLocaleUpperCase()}),(0,c.jsxs)("div",{className:or,children:[(0,c.jsx)(Yi.default.Text,{ellipsis:{cssEllipsis:!0,showTooltip:!0},className:qi()(nr,{[cr]:e.disabled}),children:e.name}),(0,c.jsx)("p",{className:qi()(lr,{[dr]:e.needUpgrade,[cr]:e.disabled}),children:Ae.ZP.t("web_default_space_text_insufficient_storage",{number0:"",string0:(0,Ji.y)(e.remainSize)},"Less than {number0}{string0}")})]}),(0,c.jsx)("span",{className:ur})]})},e.workspace_id);return d?t:(0,c.jsx)(Qa.Z,{content:Ae.ZP.t("web_default_space_text_no_permisson",{},"You don\u2019t have access to this space."),children:t})}))})]})})};var _r,fr,vr,mr,yr,Ir,wr=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},Sr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},br=function(e,t){return function(i,a){t(i,a,e)}};let Cr=class extends _e.JT{constructor(e,t,i,a,r,s){super(),this._workspaceService=e,this._draftManager=t,this._projectMaterials=i,this._userMaterials=a,this._documentModel=r,this._account=s}showModal(){const e=document.createElement("div");document.body.append(e),o.createRoot(e).render((0,c.jsx)(gr,{isSupportPay:this._projectMaterials.isSupportPay,spaceList:this._workspaceService.workspaceList,defaultSpaceId:this._draftManager.workspaceId,onMove:this._moveDraft.bind(this),materials:this._projectMaterials.materials,draftTitle:this._documentModel.graphicSDK.api.document.getTitle(),hasPermission:this._hasPermission,showExpand:this._showExpand.bind(this),onSpaceListChange:this._workspaceService.onDidWorkspaceChange.bind(this),getExpandInstance:this._getExpandInstance.bind(this)}))}async _moveDraft(e){const{workspace_id:t,space_id:i,name:a}=e;!(0,p.qM)()?this._draftManager.updateWorkspaceInfo({workspaceId:t,name:a}):(await this._copyProjectMaterialsToOtherSpace(t),this._draftManager.moveDraft({workspaceId:t,name:a}),this._updateUrl(t,i))}async _copyProjectMaterialsToOtherSpace(e){const t=this._projectMaterials.materials.filter((e=>e.everCloudId)).map((t=>this._userMaterials.copyMaterialToWorkspace({fromWorkspaceId:this._currentWorkspaceId,toWorkspaceId:e,assetId:t.everCloudId,meta:JSON.stringify(t.meta)})));await Promise.all(t)}_updateUrl(e,t){const a=p.m4.create(location.href).removeQueryParameter("workspaceId").removeQueryParameter("spaceId").addQueryParameter("workspaceId",e).addQueryParameter("spaceId",t).toString();i.g.history.replaceState({},"",a)}async _showExpand(e){const t=await this._getExpandInstance(e);null==t||t.show({type:da.c.CAPACITY_BUY,reporterParams:{pageFrom:da.K1.spaceLimitUpgrade,currentPage:"picture_edit",enterFrom:"change_dictionary_window"}})}_getExpandInstance(e){return this._projectMaterials.getExpandInstance(e)}get _currentWorkspaceId(){return this._draftManager.workspaceId}get _hasPermission(){return!this._draftManager.draftOwner||this._draftManager.draftOwner===this._account.userProfile.uid}};Cr=wr([br(0,r.WL),br(1,Me.j),br(2,Fe.X),br(3,Zt.b),br(4,ge.w),br(5,Re.D),Sr("design:paramtypes",["function"==typeof(_r=void 0!==r.WL&&r.WL)?_r:Object,"function"==typeof(fr=void 0!==Me.j&&Me.j)?fr:Object,"function"==typeof(vr=void 0!==Fe.X&&Fe.X)?vr:Object,"function"==typeof(mr=void 0!==Zt.b&&Zt.b)?mr:Object,"function"==typeof(yr=void 0!==ge.w&&ge.w)?yr:Object,"function"==typeof(Ir=void 0!==Re.D&&Re.D)?Ir:Object])],Cr);var Er=i(50246),kr=i(75786),Tr=i(72838),Pr=i(12613),Dr=i(93313),xr=i(18572),Ar=i(47216),Rr=i(44461),Fr=i(82334),Mr=i(43659),Lr=i(44307),Or=i(85175),Ur=i(43214),Nr=i(80473),jr=i(99741),Br=i(26957),Wr=i(45319),Gr=i(34639),zr=i(32651),Kr=i(81551),Hr=i(63048),Zr=i(50601),Yr=i(35188);var Vr=i(91326),$r=i(40749),qr=i(56091),Jr=i(98724),Xr=i(42330),Qr=i(94287),es=i(59250),ts=i(35988),is=i(26947),as=i(45975),rs=i(29794),ss=i(12353),os=i(55115),ns=i(63288),cs=i(7093),ls=i(85088),ds=i(17779),us=i(18651);function hs(e,t){const i={},a=[{data:$r.P},{data:ts.P},{data:qr.P},{data:as.P},{data:es.P},{data:Xr.P,filter:[h.gg.Main,h.gg.EditorWeb]},{data:Qr.P},{data:Jr.P},{data:ss.P},{data:is.P,filter:[h.gg.Main,h.gg.EditorWeb]},{data:rs.P,filter:[h.gg.Main]},{data:ns.P,filter:[h.gg.Main]},{data:us.P,filter:[h.gg.Main]},{data:cs.P},{data:os.P,filter:[h.gg.Main]},{data:ds.P,filter:[h.gg.EditorWeb]},{data:ls.P}];e.invokeFunction((e=>{const t=e.get(ei.j);a.filter((e=>!e.filter||e.filter.includes(t.editorType))).forEach((e=>{Object.keys(e.data).forEach((t=>{((e,t)=>{var a;e in i?((0,le.Y2)(Array.isArray(i[e]),"workbench ui config child must be an array"),null===(a=i[e])||void 0===a||a.push(...t[e])):i[e]=t[e]})(t,e.data)}))}))})),t.updateUIConfig({...i}),function({uiConfigs:e,workbenchService:t}){var i,a,r;const s=null!==(i=null==e||null===(a=e.siderMenuPanel)||void 0===a?void 0:a.map((e=>e.name)))&&void 0!==i?i:[],o=(0,Vr.l)({list:null!==(r=e.siderMenu)&&void 0!==r?r:[]}).filter((e=>s.includes(e.name))).map((e=>e.name)),n=!qt.e1.parserDraftIdFromUrl(),c=$r.P.siderMenu[0].name,l=as.P.siderMenu[0].name;let d;const{activeTab:u,activeAppId:h}=(0,p.gO)();if(o.includes(u))d=u;else if(n)d=o.includes(c)?c:o[0];else{var g;d=null!==(g=sessionStorage.getItem("lastActiveMenuName"))&&void 0!==g?g:l,o.includes(d)||(d=l)}t.onSiderMenuActiveChange((e=>{var t;sessionStorage.setItem("lastActiveMenuName",null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}));const _={defaultActiveAppId:Number(h)};t.activeSiderMenuByName(d,"auto",u&&h?{extraParams:_}:void 0)}({uiConfigs:i,workbenchService:t})}var ps=i(53767);function gs(e){e.invokeFunction((e=>{const t=e.get(W.H),i=e.get(Ge.e);t.setDraftPermission(zt.O.editable),i.setWorkbenchMode(ps.w.editable)}))}var _s=i(28387),fs=i(19566);class vs extends di.Dq{constructor(e,t,i,a,r,s,o,n,c,l,d=!1,u="",h=""){super(e,t,i,a,r,s,o,n,c,l),this.eventName="save_pc_cover",this.isCoverEdit=!1,this.videoTitle="",this.videoId="",this.isCoverEdit=d,this.videoTitle=u,this.videoId=h}getEventParams(){const e=super.getEventParams(),t={edittype:"picture_edit",original_edittype:"edit",is_cover_added:1,video_title:this.videoTitle,video_id:this.videoId};return Object.assign(e,t)}}var ms=i(42468);var ys=i(69148),Is=i(799),ws=i(18473),Ss=i(96056),bs=i(88233),Cs=i(36161),Es=i(45500);function ks(e){const t=e.createInstance(ws.t),i=t.bootstrap();if(!i.ok)return new Es.t(Es.g.PROJECT_NOT_EXIST).report(),(0,Ss._)(),Promise.resolve(i.pair()[0]);const r=new qt.e1,s=!r.draftId,o=s?(0,vt.g)():r.draftId;return new Promise((i=>{e.invokeFunction((async e=>{const n=e.get(ge.w),c=e.get(Me.j),l=e.get(W.H),d=e.get(Ge.e),{newDraftConfig:u}=e.get(Ke.r),{graphicSDK:h}=n;if(c.updateDraftId(o),c.updateWorkspaceInfo(t.getWorkspaceInfo()),s)h.init({isNewDraft:!0,dimension:r.dimension,scenario:r.scenario,useInCN:Boolean(r.useInCN),newDraftConfig:u}),l.setDraftPermission(zt.O.editable),d.setWorkbenchMode(ps.w.editable);else{var p;h.init({isNewDraft:!1,useInCN:Boolean(r.useInCN)});const e=await c.readDraft();if(!e.ok)return function(e){let t;switch(`${e}`){case Ie.lF.ERROR_DRAFT_NOT_FOUND:case Ie.lF.ERROR_DRAFT_ILLEGAL:(0,Xt.D)(),t=Es.g.PROJECT_NOT_EXIST;break;case Ie.lF.ERROR_DRAFT_NOT_PERMISSION:(0,ys.H)(),t=Es.g.NOT_PERMISSION;break;case Ie.lF.ERROR_DRAFT_PARSE_ERROR:(0,Is.i)(),t=Es.g.DRAFT_BROKEN;break;default:(0,Cs.e)(),t=Es.g.SERVICE_EXCEPTION}new Es.t(t).report()}(`${e.code}`),void i(e.pair()[0]);const s=e.pair()[1];bs.y.getInstance().fromJSONP=s.from===Ht.o.JSONP,n.updateAllEverFiles(s.draftAllEverAsserts);null===(p=s.allowToEdit)||void 0===p||p?(l.setDraftPermission(zt.O.editable),d.setWorkbenchMode(ps.w.editable)):(l.setDraftPermission(zt.O.readonly),d.setWorkbenchMode(ps.w.readonly));try{h.buildFromServerData(o,s)}catch(g){(0,Is.i)(),new Es.t(Es.g.DRAFT_BROKEN).report(),i((0,a.wf)(-1,"sdk parser failure"))}ae.RA.reportDraftOpen(o,t.getWorkspaceId())}h.document.updateDocumentMeta({draftId:o}),i((0,a.ly)())}))}))}var Ts=i(61418);const Ps="0";var Ds=i(92043),xs=i(14460),As=i(34702);async function Rs(e){const t=e.get(Re.D),i=e.get(r.WL),a=e.get(Me.j),s=e.get(ge.w),n=e.get(Fe.X),l=null!=t&&t.hasLogin?t.userProfile.uid:"unlogin-local";await e.get(u.S).allowToRender();const{graphicSDK:d}=s,h=(0,p.td)();h&&await new Promise((e=>{n.registerThirdpartyUploadStatesCallback((function t({data:i,triggerType:a}){const{status:r}=i;"auto"===a&&"success"===r&&(e(),n.unRegisterThirdpartyUploadStatesCallback(t))}))})),await function(e){const t=document.createElement("div");return document.body.append(t),new Promise((i=>{o.createRoot(t).render((0,c.jsx)(Ds.Z,{...e,showNextGuide:()=>i()}))}))}({userId:l,graphicSDKApi:d.api,showGoogleDriveGuide:h}),h&&await function(e){const t=document.createElement("div");return document.body.append(t),new Promise((i=>{o.createRoot(t).render((0,c.jsx)(As.z,{...e,showNextGuide:()=>i()}))}))}({userId:l}),t.hasLogin&&await function(e){const t=document.createElement("div");return document.body.append(t),new Promise((()=>{o.createRoot(t).render((0,c.jsx)(xs.t,{...e}))}))}({userId:l,spaceCount:i.workspaceList.length,spaceName:i.getWorkspace(a.workspaceId).name})}function Fs(e){e.invokeFunction((async e=>{e.get(W.H).getDraftPermission()!==zt.O.readonly&&await Rs(e)}))}var Ms=i(64525),Ls=i(17882);var Os,Us=i(12206),Ns=i(86059),js=i(46862),Bs=i(34412);!function(e){e.Main="main",e.EditorPC="pc",e.EditorWeb="web",e.EditorBatch="batch"}(Os||(Os={}));var Ws=i(46251),Gs=i(84434);var zs=i(42406),Ks=i(97385),Hs=i(42944);class Zs extends Hs.g{constructor(){super(),window.wbLoader=this}$onMount(){}async $afterControllersInit(){}async $onReady(){}$onWorkbenchInitError(e){console.log(e)}}var Ys=i(94074),Vs=i(11619),$s=i(8905),qs=i(52992);var Js=i(29204);var Xs=i(72918);var Qs=i(50528),eo=i(30047);var to=i(32082);var io=i(64700);function ao(){const e=document.createElement("div");document.body.append(e);const t=function(){const e=window.jsonpDraft;if(null==e||!e.response)return zt.O.editable;const t=e.response;var i;return"0"===t.ret&&t.data?null===(i=t.data.allow_to_edit)||void 0===i||i?zt.O.editable:zt.O.readonly:zt.O.editable}();return o.createRoot(e).render((0,c.jsx)(io.Z,{readonly:t===zt.O.readonly})),()=>{e.remove()}}var ro=i(25947);var so=i(69412),oo=i(31594);const no={[oo._.Sticker]:"cn-sales-sticker",[oo._.Font]:"cn-fonts",[oo._.TextTemplate]:"cn-sales-text-template",[oo._.Shape]:"svg",[oo._.ImageFrame]:"sales-frame",[oo._.ImageFilter]:"sales-filter",[oo._.ImageEffect]:"sales-image-effect",[oo._.Photo]:"yk-image",[oo._.AiBackground]:"ai_background",[oo._.EffectModel]:"effect_model"},co={[oo._.Sticker]:"sales-sticker",[oo._.Font]:"fonts",[oo._.TextTemplate]:"sales-text-template",[oo._.Shape]:"svg",[oo._.ImageFrame]:"sales-frame",[oo._.ImageFilter]:"sales-filter",[oo._.ImageEffect]:"sales-image-effect",[oo._.Photo]:"yk-image",[oo._.AiBackground]:"ai_background",[oo._.EffectModel]:"effect_model"};class lo extends so.aU{constructor(e){super(),this._options=e,this.disableRequestCache=!1,this._useInCN=e.useInCN,this.editorCategory=e.editorCategory,this.resourcePanel=e.useInCN?{...no}:{...co},this.renderConfig=e.renderConfig,this.isNewDraftWithoutDimension=e.isNewDraftWithoutDimension,this.enterFromPc=e.enterFromPc,this.editorDisplayMode=e.editorDisplayMode,this.newDraftConfig=e.newDraftConfig}get defaultText(){return(0,le.Y2)(this._options,"configuration is not be setting"),this._options.defaultText}set useInCN(e){this._useInCN=e;for(const t of Object.keys(this.resourcePanel))delete this.resourcePanel[t];Object.assign(this.resourcePanel,e?no:co)}get useInCN(){return this._useInCN}set setEditorDisplayMode(e){this.editorDisplayMode=e}get isSupportMultiWorkSpace(){return!0}}let uo=!1;var ho=i(95983);class po extends ho.L{constructor(e){super(e),this.isDev=!0,this.isProd=!1,this.isLog=!1,this.isInternal=!1,this.appVersion="",this.editorType=e.editorType,this.isDev=e.isDev,this.isProd=e.isProd,this.isLog=e.isLog,this.isInternal=e.isInternal,this.appVersion=e.appVersion}}var go=i(42463);var _o=i(45119),fo=i(92848),vo=i(58830),mo=i(50);class yo{constructor(){this._cookieConsent=new vo.C,this._isStart=!1,this._onEnableChange=new fe.Q,this.onEnableChange=this._onEnableChange.event}start(){this._isStart=!0,this._cookieConsent.enable?this._onEnableChange.fire(!0):this._cookieConsent.onEnableChange((e=>{this._onEnableChange.fire(e)}))}get enable(){return this._cookieConsent.enable&&this._isStart}}function Io(e){switch(e){case h.gg.EditorWeb:return new yo;case h.gg.EditorPC:return new mo.e;default:return new vo.C}}const wo={GOOGLE_SEM:"googleadwords_int",AD_PLATFORM_ID:"ad_platform_id",PII_GOOGLE_SEM:"google sem",PII_DIRECT:"direct"};let So=null;function bo(e){So=new fo.X({appId:_o.z.appid,channel:_o.z.channel,disableAutoPv:_o.z.disableAutoReportPv,enableAbTest:_o.z.enableAbTest,abChannelDomain:_o.z.abChannelDomain,webId:""},{appVersion:_o.z.appVersion,stagingFlag:_o.z.isProd?0:1},e),So.setCommonEventParams(_o.z.commonReportParams);const t=(0,p.gO)()[wo.AD_PLATFORM_ID];return So.setCustomParams({url:location.href,lang:Ae.ZP.language,user_is_cloud_subscribed:0,channel:t===wo.GOOGLE_SEM?wo.PII_GOOGLE_SEM:wo.PII_DIRECT,branch:i.g._currentBranch,...(0,p.nk)()}),So}var Co=i(57018),Eo=i(27671),ko=i(12090);class To{get instantiationService(){return(0,le.Y2)(this._containerService,"instantiationService is not init"),this._instantiationService}get containerService(){return(0,le.Y2)(this._containerService,"ContainerService is not init"),this._containerService}get workbenchService(){return(0,le.Y2)(this._workbenchService,"WorkbenchService is not init"),this._workbenchService}get cookieConsentService(){return(0,le.Y2)(this._cookieConsentService,"CookieConsentService is not init"),this._cookieConsentService}async startLifeCycle(){_.t.hideConsole(),("1"===(0,p.gO)().__debug_console__||localStorage.getItem("show_log"))&&_.t.showConsole();const e=Io(this.editorType);this._cookieConsentService=e;const t=bo(e),r=function(){(0,le.Y2)(window.ccWebSlardar);const e=window.ccWebSlardar;return e("init",{bid:"cc_web",release:"graphic-1.0.0.1212",env:"production",pluginPathPrefix:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/slardar-web-sdk/plugins",plugins:{blankScreen:{rootSelector:"#root",autoDetect:!0,threshold:2.5,screenshot:!1},pageview:{routeMode:"history",extractPid:()=>"editor-graphic"}}}),e("start"),new Js.O(e,{},{},{})}();if(function(e,t){se.I.getInstance().setReporter({reportEvent:e.ensureTrack.bind(e),getTeaConfig:e.getTeaConfig.bind(e)}),se.I.getInstance().setSlardarReporter({reportEvent:t.sendEvent.bind(t),getTeaConfig:e.getTeaConfig.bind(e)})}(t,r),function(e,t={}){const i=(0,ms.CD)();i.init({autoReport:t.autoReport}),i.start();const{campaign:a,term:r,channel:s}=i.getParams(),o={campaign_id:a,...s};r&&(o.keywords=r),e.setCustomParams(o)}(t,{autoReport:[h.gg.Main].includes(this.editorType)}),function(){const e=!qt.e1.parserDraftIdFromUrl(),{enter_time:t=""}=(0,p.gO)();Qs.X.getInstance().setReporter((t=>(0,eo.g)(t,e))),(0,bs.DT)(t?Number(t):performance.timing.fetchStart),(0,bs.lA)()}(),!(null!==(s=i.g.navigator)&&void 0!==s&&s.cookieEnabled?(0,a.ly)():((0,go.G)(),new Es.t(Es.g.COOKIES_DISABLED,["Cookies"]).report(),(0,a.wf)(-1,Es.g.COOKIES_DISABLED))).ok)return;var s;const o=ao(),n=function(e){let t;var i;return t=e||(null!==(i=localStorage.getItem(Xs.o))&&void 0!==i?i:Ie.hY.Light),document.body.setAttribute("lv-theme",t),t}(this.theme);if(this.editorType!==h.gg.EditorPC&&!function(){const{unSupported:e}=(0,Ys.Y)();return e.length?e.find((e=>["BrowserVersion","BrowserType"].includes(e)))?((0,Vs.U)(),new Es.t(Es.g.BROWSER_NOT_SUPPORT,e).report(),(0,a.wf)(-1,Es.g.BROWSER_NOT_SUPPORT)):e.find((e=>["Mobile"].includes(e)))?((0,$s.v)(),new Es.t(Es.g.MOBILE_NOT_SUPPORT,e).report(),(0,a.wf)(-1,Es.g.MOBILE_NOT_SUPPORT)):((0,qs.W)(),new Es.t(Es.g.DEVICE_NOT_SUPPORT,e).report(),(0,a.wf)(-1,Es.g.DEVICE_NOT_SUPPORT)):(0,a.ly)()}().ok)return;const c=new Us.o;c.registerInstance(js.L,r),c.registerInstance(Co.n,e),c.registerInstance(q.w,t);const l=new qt.e1;!function(e,t){e.register(so.Ui,new w.M(lo,t))}(c,[{defaultText:Ks.t,useInCN:Boolean(l.useInCN),isNewDraftWithoutDimension:!l.hasDimensionInUrl&&!l.draftId&&!l.templateId,enterFromPc:l.enterFromPc,editorCategory:"image_editor",renderConfig:{transparentBackground:!0},newDraftConfig:{minPageCount:1}}]),ce(c,this.editorType),this.registerI18nService(c),c.register(Ge.e,new w.M(Bs.M,[{platform:"pc",container:document.getElementById("root"),loader:Zs,titleBar:{renderMenuConfig:{position:"right"}}}]));const d=function(e){return new Ws.F((0,Gs.T)(e))}(c);this._instantiationService=d;const g=function(e){return e.invokeFunction((e=>e.get(k.t)))}(d);this._containerService=g;const f=g.makeDisposableServiceRegister();!function(e,t){e.register(ei.j,new w.M(po,t))}(f,[{editorType:this.editorType,isDev:!1,isInternal:!1,isLog:!1,isProd:!0,appVersion:"1.0.0.1212"}]),function(e,t){switch(t.register(de.T,ue.Z),t.register(he.V,pe.c),t.register(ge.w,we),t.register(Br.tx,Wr.V),t.register(Gr.K,zr.b),t.register(Kr.c,Hr.z),t.register(Zr._,Yr.O),t.register(Se,Ne),t.register(Er.r,kr.h),t.register(Tr.BL,Pr.G),t.register(Pe.m,Dr.g),t.register(Zt.b,xr.x),t.register(We.N,Ve),t.register(qe.A,ot),t.register(nt.W,Et),t.register(Dt.L,Gt),t.register(Ar.r,Rr.S),e){case h.gg.EditorPC:t.register(Ht.H,Fr.D),t.register(Me.j,vi),t.register(Kt.Y,Mr.s),t.register(Fe.X,Mi);break;case h.gg.EditorWeb:t.register(Ht.H,Lr.j),t.register(Me.j,vi),t.register(Kt.Y,Or.Y),t.register(Ha.Z,Ur.E),t.register(Fe.X,$a),t.register(qa.ZO,Ja.C);break;case h.gg.EditorBatch:case h.gg.Main:t.register(Ht.H,Nr.w),t.register(Me.j,fi),t.register(Kt.Y,jr.X),t.register(Fe.X,Ma),t.register(qa.ZO,Ja.C),t.register(Xa.l,Cr);break;default:(0,le.Y2)("not target editorType")}}(this.editorType,f),g.registerServices(f);const m=function(e){return e.invokeFunction((e=>e.get(Ge.e)))}(d);m.setInstantiationService(g),this._workbenchService=m,window._workbenchService=m,await m.bootstrap(),m.hideLogo(this.editorType!==h.gg.Main),this.showWebview();const y=function(e){return e.invokeFunction((e=>e.get(P.Q)))}(d);let I=!1;await Promise.all([v(d),hs(g,m),(async()=>{(0,bs.T0)(bs.$I.UserInit),await function(e){return e.invokeFunction((async e=>{const t=e.get(Re.D);return await t.initialize(),t.hasLogin}))}(d),(0,bs.d9)(bs.$I.UserInit),function(e,t){ae.ff.setApiSetting(t),to.yk.setApiSetting(t),e.invokeFunction((async e=>{const i=e.get(F.Gw);await i.initialize(),t.updateRequestSetting(i.regionSettings)}))}(d,zs.U),function(e){e.invokeFunction((t=>{const i=t.get(Re.D),a=()=>{e.invokeFunction((e=>{var t;const i=e.get(js.L),a=null===(t=e.get(Re.D).userProfile)||void 0===t?void 0:t.uid;i.sendLog(js.T.INFO,`graphic-update-userId-${a}`),i.setConfig({userId:a})}))};i.hasLogin?a():(0,Oi.V)(i.onDidLogin)((()=>{a()}))}))}(d),(0,bs.T0)(bs.$I.ModelSDK);if(!(await this.initOrRestoreDraftData()).ok)return void(I=!0);(0,bs.d9)(bs.$I.ModelSDK),function(e){e.invokeFunction((e=>{const t=e.get(ge.w),i=e.get(Me.j),a=e.get(Re.D),r=e.get(W.H),s=e.get(q.w),o=e.get(u.S),n=e.get(de.T),c=se.I.getInstance().createContext(Ie.K6);c.draftId=i.draftId,c.modelApi={common:t.graphicSDK.api.common,document:t.graphicSDK.api.document,aigc:t.graphicSDK.api.aigc,page:t.graphicSDK.api.page},s.setCustomParams({lang:o.currentLocale}),s.setCommonEventParams({draft_id:i.draftId});const l=(e,t)=>{const i=Boolean(e.uid);s.setConfig({userId:e.uid,region:e.region,hasLogin:i}),i&&s.setCustomParams({career:e.career,user_region:e.region,register_channel:e.register_source}),void 0!==(null==t?void 0:t.flag)&&s.setCustomParams({is_vip:t.flag?1:0})};a.hasLogin?l(a.userProfile,a.userVipInfo):((0,Oi.V)(a.onDidLogin)((()=>{l(a.userProfile,a.userVipInfo)})),(0,Oi.V)(a.onDidChangeVipInfo)((()=>{l(a.userProfile,a.userVipInfo)}))),n.bootstrap().then((async()=>{var e,i,a;const s=r.getDraftPermission()===zt.O.editable?"edit":"view",o=new ro.m(s),{editor:c}=n,l=await(null===(e=c.getRulerView())||void 0===e?void 0:e.isRulerShowFromLocal()),d=await(null===(i=c.getPageMarginView())||void 0===i?void 0:i.isPageMarginShowFromLocal()),u=await(null===(a=c.getPageBleedView())||void 0===a?void 0:a.isPageBleedShowFromLocal()),h=t.graphicSDK.document.guideLine.lines.length>0&&l;o.setIsUseRulers(Boolean(l)),o.setIsUseMargin(Boolean(d)),o.setIsUsePrintBleed(Boolean(u)),o.setIsUseGuide(Boolean(h)),o.report()}))}))}(g),this.editorType===h.gg.Main&&t.reportPv(),(async()=>{if(uo)return;uo=!0;const{cookieConsent:e}=await Promise.resolve().then(i.bind(i,14463));e.onChange((e=>{e.GoogleAnalytics&&"function"==typeof window.gtag&&(window.gtag("consent","update",{analytics_storage:"granted"}),window.gtag("event","accept_cookie"),_.t.info("Google sdk has registered."))}))})(),function(e){e.invokeFunction((e=>{e.get(Y.B).bootstrap()}))}(g),(0,bs.T0)(bs.$I.EditorBootstrap);const e=function(e){return e.invokeFunction((e=>e.get(de.T)))}(g);await e.bootstrap(),(0,bs.d9)(bs.$I.EditorBootstrap),(e=>{const t=()=>{var e;const t=new qt.e1,i=null!==(e=mt.fc.getInstance().wasm)&&void 0!==e&&e.isReady()?1:0;t.draftId&&new ko.m({isEffectReady:i,isNewDraft:0}).report()};e.invokeFunction((e=>{const i=e.get(ge.w);i.graphicSDK.modelInitFinish?t():i.graphicSDK.event.addListener(ye.B.MODEL_INIT_FINISH,t)}))})(g),o(),function(e,t){e.invokeFunction((e=>{const i=e.get(de.T),{renderSDK:a}=i;e.get(ge.w).graphicSDK.modelInitFinish?a.accessors.stage.setTheme(t):ve.Z.interact.onModelInitFinish.event((()=>{a.accessors.stage.setTheme(t)}))}))}(g,n),function(e){e.invokeFunction((e=>{e.get(Zr._).load()}))}(g)})()]),I||(!async function(e,t,a){const r=[];t.invokeFunction((t=>{const s=t.get(ei.j);switch(r.push((async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,83378));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,23465));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,49719));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,5615));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,50922));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,69072));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,16648));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,43173));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,29862));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,87120));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,44743));a.register(e,t.contribution)})),s.editorType){case h.gg.EditorWeb:r.push((async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,80461));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,48370));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,61116));a.register(e,t.contribution)}));break;case h.gg.Main:default:r.push((async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,61116));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,80461));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,51057));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,23138));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,30014));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,15773));a.register(e,t.contribution)}),(async()=>{const t=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,25621));a.register(e,t.contribution)}))}}));const s=Promise.all(r.map((e=>e())));await s}((0,Ns.fC)(),g,y),window.LVWEB_VERSION="1.0.0.1212",function(e){e.invokeFunction((e=>{e.get(C.hR).bootstrap()}))}(d),this.execAfterLifecycle())}registerI18nService(e){e.register(u.S,new w.M(Eo.D,[{}],!1))}showWebview(){}}function Po(e){const t=e.createInstance(ws.t);return e.invokeFunction((async e=>{const i=e.get(Re.D),a=e.get(Me.j),s=e.get(r.WL);i.hasLogin?(await s.initialize(),t.bootstrap(),a.updateWorkspaceInfo(t.getWorkspaceInfo()),a.bootstrap()):(0,Oi.V)(i.onDidLogin)((async()=>{await s.initialize(),t.bootstrap(),a.updateWorkspaceInfo(t.getWorkspaceInfo()),a.bootstrap()}))}))}var Do,xo=i(81907),Ao=i(72135);!function(e){e.GOOGLE_DRIVE="GoogleDrive",e.DROPBOX="Dropbox"}(Do||(Do={}));var Ro=i(76326);function Fo(e){return e.invokeFunction((e=>e.get(Re.D).hasLogin?(0,a.ly)():(i.g.location.href=`/login?redirect_url=${encodeURIComponent(i.g.location.href)}`,(0,a.wf)(-1,"no sign"))))}const Mo=(e,t,i,a)=>{t.init({isNewDraft:!0,dimension:i,scenario:a}),t.document.updateDocumentMeta({draftId:e});const r=t.document.pages[0].id;return t.api.transaction.begin({canUndoRedo:!1}),t.api.page.updateBackgroundColor(r,[255,255,255,0]),t.api.transaction.commit(),r},Lo=async({draftId:e,coverId:t,projectMaterialManager:i,graphicSDK:a,urlParser:r,containerService:s})=>{var o;if(!t){var n;const t=(0,Ro.F)(r.photoWidth,r.photoHeight,null===(n=r.dimension)||void 0===n?void 0:n.unit);return void Mo(e,a,t,r.scenario)}const c=await(null===(o=i.appendCoverKey)||void 0===o?void 0:o.call(i,t));(0,le.Y2)(c,"cover file not found"),c&&(({draftId:e,coverFile:t,graphicSDK:i,urlParser:a,containerService:r})=>{var s;let o="";t.transcodeInfo&&(o=Object.keys(t.transcodeInfo).map((e=>t.transcodeInfo[e])).sort(((e,t)=>e.width*e.height-t.width*t.height))[0].full_url);mt.fc.getInstance().parser.everCloud.fetchData({id:t.md5,resourceId:t.md5,type:Ie.xP.EverCloud,previewUrl:o,fileUrl:{md5:t.md5,url:t.url},aesKey:t.coverKey,transcode:t.transcodeInfo});let n=a.photoWidth,c=a.photoHeight;n&&c||(n=t.width,c=t.height);const l=(0,Ro.F)(n,c,null===(s=a.dimension)||void 0===s?void 0:s.unit),d=Mo(e,i,l,a.scenario);if(i.api.transaction.begin({canUndoRedo:!1}),t.name){var u;const e=t.name.split(".");e.splice(e.length-1,1);const a=null!==(u=e.join(""))&&void 0!==u?u:t.name;i.api.document.updateTitle(a)}i.api.image.add(d,{id:t.md5,md5:t.md5,resourceId:t.md5,type:Ie.lJ.CloudImageSticker},{rotation:0,opacity:1,scale:{x:1,y:1},...(0,Qe.SY)(i.document.pages[0].dimension,{width:n,height:c})}),i.api.transaction.commit(),r.invokeFunction((async e=>{var t;const a=e.get(de.T),{id:r}=i.document.pages[0],s=null!==(t=i.document.getLayerIdsByFilter(!0,((e,t)=>t.id===r)))&&void 0!==t?t:[];a.registerEditPanelReadyCallback((()=>a.renderSDK.accessors.selection.triggerMaterialsSelection(s))),await a.bootstrap()}))})({draftId:e,coverFile:c,graphicSDK:a,urlParser:r,containerService:s})};class Oo extends To{constructor(){super(...arguments),this.editorType=h.gg.Main}async initOrRestoreDraftData(){Po(this.containerService);const{instantiationService:e,containerService:t}=this,r=e.invokeFunction((e=>e.get(Re.D).hasLogin));if((0,p.vG)()){const i=await function(e,t){const i=e.invokeFunction((e=>e.get(Re.D).hasLogin));return new Promise((e=>{t.invokeFunction((async t=>{const r=(0,vt.g)(),s=new qt.e1,{templateId:o}=s;if(!o)return void e((0,a.wf)(-1,"template id miss"));const n=t.get(ge.w),c=t.get(Me.j);t.get(W.H).setDraftPermission(zt.O.editable),t.get(Ge.e).setWorkbenchMode(ps.w.editable);const{graphicSDK:l}=n;let d;c.updateDraftId(r);try{d=await ae.RA.getTemplateDetail({templateId:o,needDraft:!0})}catch(m){return(0,Is.i)(),void e((0,a.wf)(-1,"get template detail fail"))}const{draftData:u,materials:h,templateVersion:p,creator:g}=d;if(!u){l.init({isNewDraft:!0,dimension:s.dimension,scenario:s.scenario});const{templateUrl:t}=d,i=await ae.RA.getTemplateDataByUrl(t);(0,Ms.s)(l,d.materials);const n={protoVersion:p,protoTemplate:i,id:o,creator:g,options:{localImages:null==h?void 0:h.localImages,replaceableImages:null==h?void 0:h.replaceableImages}},{document:c,error:u}=Ls.m.templateToModel(n);return u?(_.t.error("init from use-template error",o),void e((0,a.wf)(-1,"init from use-template error"))):(l.document.updateDocumentMeta({draftId:r}),l.api.template.applyTemplate(c.pages,{from:"template",templateId:o,templateName:"",templateEffectFilters:[]}),void e((0,a.ly)()))}const f=JSON.parse(u);(0,Ms.s)(l,h);const v={draftTitle:"Untitled image",draftData:f,materials:{effects:[],images:[],template_file_infos:[]},draftUsedEverAsserts:[]};try{l.buildFromServerData(r,v),l.document.updateDocumentMeta({draftId:r})}catch(y){(0,Is.i)(),new Es.t(Es.g.DRAFT_BROKEN).report(),e((0,a.wf)(-1,"template parser failure"))}i&&ve.Z.interact.onModelInitFinish.once((()=>{c.saveDraft()})),e((0,a.ly)())}))}))}(e,t);return i.ok?(0,a.ly)():i}if((0,p.fw)()){const i=await(async(e,t)=>{const i=Fo(e);if(!i.ok)return Promise.resolve(i);await s(e),gs(t);const r=new qt.e1,o=t.createInstance(ws.t).bootstrap();if(!o.ok)return new Es.t(Es.g.PROJECT_NOT_EXIST).report(),(0,Ss._)(),Promise.resolve(o);const n=!r.draftId,c=n?(0,vt.g)():r.draftId;return await t.invokeFunction((async e=>{const i=e.get(ge.w),a=e.get(Me.j);a.updateDraftId(c);const s=e.get(Fe.X),{graphicSDK:o}=i;n&&(r.coverId&&await s.waitForReady(),await Lo({draftId:c,coverId:r.coverId,graphicSDK:o,projectMaterialManager:s,urlParser:r,containerService:t})),a.resetSaveState()})),Promise.resolve((0,a.ly)())})(e,t);return i.ok?(0,a.ly)():i}if(r){await s(e);const i=await ks(t);if(function(e){const t=new qt.e1,i=Boolean(t.useInCN);e.invokeFunction((e=>{const t=e.get(ge.w),{graphicSDK:a}=t,{useInCN:r}=a.api.document.getDocumentMeta(),s=i||r;s&&ae.zL.switchLokiPanelRegion(i),e.get(Ke.r).useInCN=s}))}(t),!i.ok)return i}else{const e=await function(e){return new Promise((t=>{e.invokeFunction((async e=>{const r=new qt.e1,s=(0,vt.g)();e.get(W.H).setDraftPermission(zt.O.editable),e.get(Ge.e).setWorkbenchMode(ps.w.editable);const{templateId:o,draftId:n}=r;if(n)return i.g.location.href=`/login?redirect_url=${encodeURIComponent(i.g.location.href)}`,(0,a.wf)(-1,"url has draftId, login first");if(o){const i=e.get(ge.w),n=e.get(Me.j),{graphicSDK:l}=i;n.updateDraftId(s);const d=await ae.RA.getTemplateDetail({templateId:o,needDraft:!0}),{draftData:u,materials:h,templateVersion:p,creator:g}=d;if(!u){l.init({isNewDraft:!0,dimension:r.dimension,scenario:r.scenario});const{templateUrl:e}=d,i=await ae.RA.getTemplateDataByUrl(e);(0,Ms.s)(l,d.materials);const n={protoVersion:p,protoTemplate:i,id:o,creator:g,options:{localImages:null==h?void 0:h.localImages,replaceableImages:null==h?void 0:h.replaceableImages}},{document:c,error:u}=Ls.m.templateToModel(n);return u?(_.t.error("init from use-template error",o),void t((0,a.wf)(-1,"init from use-template error"))):(l.api.template.applyTemplate(c.pages,{from:"template",templateId:o,templateName:"",templateEffectFilters:[]}),l.document.updateDocumentMeta({draftId:s}),void t((0,a.ly)()))}const f=JSON.parse(u);(0,Ms.s)(l,h);const v={draftTitle:"Untitled image",draftData:f,materials:{effects:[],images:[],template_file_infos:[]},draftUsedEverAsserts:[]};try{l.buildFromServerData(s,v),l.document.updateDocumentMeta({draftId:s})}catch(c){(0,Is.i)(),new Es.t(Es.g.DRAFT_BROKEN).report(),t((0,a.wf)(-1,"template parser failure"))}}else{const t=e.get(ge.w),i=e.get(Me.j),{graphicSDK:a}=t;i.updateDraftId(s),a.init({isNewDraft:!0,dimension:r.dimension,scenario:r.scenario}),a.document.updateDocumentMeta({draftId:s})}t((0,a.ly)())}))}))}(t);if(!e.ok)return e}return(0,a.ly)()}execAfterLifecycle(){const{instantiationService:e,containerService:t}=this;!function(e){e.invokeFunction((async e=>{const t=e.get(u.S),i=e.get(z.lT),a=e.get(W.H);await t.allowToRender(),a.getDraftPermission()===zt.O.readonly&&i.info(Ae.ZP.t("web_onlyread_text_only_image",{},"You can only view this image. You don\u2019t have the permission to edit it."))}))}(t),function(e){e.invokeFunction((async e=>{const t=e.get(u.S);await t.allowToRender();const i=document.createElement("div");document.body.append(i),o.createRoot(i).render((0,c.jsx)(d,{}))}))}(e),function(){const{err_code:e=Ps,enter_from:t}=(0,p.gO)();e!==Ps&&"use_template"===t&&(0,Ts.R)()}(),function(e){e.invokeFunction((e=>{const t=e.get(F.Gw),i=e.get(Ke.r);(!t.hasLogin&&!i.isNewDraftWithoutDimension||(0,p.td)())&&t.login({reportParams:{pageEnterFrom:F.d.EditorLoginPopup}})}))}(t),function(e){e.invokeFunction((async e=>{if(!(0,p.td)())return;const t=e.get(Re.D),i=e.get(Fe.X),a=e.get(r.WL);t.hasLogin?(await a.initialize(),i.showThirdpartyUploadModalWithSpaceChange(Do.GOOGLE_DRIVE,a.workspaceList)):(0,Oi.V)(t.onDidLogin)((async()=>{const{state:e}=(0,p.gO)();e&&(await a.initialize(),i.showThirdpartyUploadModalWithSpaceChange(Do.GOOGLE_DRIVE,a.workspaceList))}))}))}(t),(0,p.fw)()?Fs(t):function(e){return new Promise((t=>{e.invokeFunction((e=>{const i=e.get(ge.w),a=e.get(de.T),s=e.get(Ke.r),o=e.get(Fe.X),n=e.get(Re.D),c=e.get(r.WL),l=e.get(Me.j);s.isNewDraftWithoutDimension&&!(0,p.td)()?xo.h.show({isLogin:n.hasLogin,draftWorkspaceInfo:n.hasLogin?c.workspaceList.find((e=>e.workspace_id===l.workspaceId)):void 0,onClose:()=>{t()},onConfirm:e=>{const r=a.renderSDK.getActivePageId();i.graphicSDK.api.page.autoLayout(r,{width:e.width,height:e.height,unit:e.unit}),a.renderSDK.accessors.page.setZoom({isFit:!0}),t()},onStatusChange:(e,t)=>{"upload"===e?(0,Ao.y)({...null!=t?t:{},action:"click",position:"picture_edit",scenario:"upload_image",scale:"upload_image"}):(0,Ao.y)({...null!=t?t:{},action:e,position:"picture_edit"})},projectMaterialManager:o,renderSDK:a.renderSDK,graphicSDK:i.graphicSDK}):t()}))}))}(t).then((()=>{Fs(t)}))}}class Uo extends To{constructor(){super(),this.editorType=h.gg.EditorPC,this.theme=Ie.hY.Dark,this._parseQueryFromWebviewUrl()}async initOrRestoreDraftData(){const e=this.instantiationService.invokeFunction((e=>e.get(Re.D).hasLogin));gs(this.containerService),e?await s(this.instantiationService):this.containerService.invokeFunction((e=>{const t=e.get(Re.D),i=e.get(r.WL);t.onDidLogin((()=>{i.available||i.initialize()}))}));const t=await this._initDraft();return t.ok?(0,a.ly)():((0,Is.i)(!1),t)}execAfterLifecycle(){var e,t;e=this.containerService,t=this._dimension,e.invokeFunction((e=>{const i=e.get(ge.w),a=e.get(de.T).renderSDK.getActivePageId(),r=i.graphicSDK.api.document.getDimension(a);r.width===t.width&&r.height===t.height||i.graphicSDK.api.page.autoLayout(a,t)})),function(e,t){e.invokeFunction((async e=>{var i;const a=e.get($.n),r=e.get(Me.j),s=e.get(de.T),o=e.get(ge.w),n=e.get(Fe.X),c=e.get(q.w),{renderSDK:l}=s,d=l.accessors.page.getActivePageId(),u=`${Date.now()}`,{width:h,height:g}=(0,Qe.Ln)(o.graphicSDK.api.document.getDimension(d)),f=`${h}*${g}px`,v=await a.getVideoTitle();if(!v.ok)throw new Error(v.msg);const m=null!==(i=(0,p.gO)().videoDraftId)&&void 0!==i?i:"";let y=!1;a.events.onBtnClick((async e=>{if("save"===e.type)new fs.S({action:"save_cover",cover_draft_id:r.draftId,video_draft_id:m}).report(),new vs(d,u,ui.B.name,ie.Tv.JPEG,f,String(ui.B.pixelRatio),ui.B.qualityLabel,ui.B.transparentBackground,ui.B.compressPNG,ui.B.flattenPDF,!0,v.value,m).report(),r.saveDraft({forceSave:!0});else if("cancel"===e.type){if(y)return;y=!0,new fs.S({action:"discard_cover",video_draft_id:m,cover_draft_id:r.draftId}).report(),await(0,_s.W)({title:Ae.ZP.t("web_graphic_unsave_notify_title",{},"Exit editing?"),content:Ae.ZP.t("web_graphic_unsave_notify_content",{},"Your changes won\u2019t be saved."),okText:Ae.ZP.t("web_modal_cancel_btn",{},"Exit"),cancelText:Ae.ZP.t("web_cancel",{},"Cancel"),onBeforeCancel:()=>(new fs.S({action:"cancel_discard",video_draft_id:m,cover_draft_id:r.draftId}).report(),y=!1,Promise.resolve())}),new fs.S({action:"confirm_discard",video_draft_id:m,cover_draft_id:r.draftId}).report(),a.handleCancelClick()}})),t&&a.events.initCoverImage((async e=>{_.t.info("[cef bridge]trigger init cover event>>>");const{coverPath:t}=e;if(!t)throw _.t.error("cover path is null in initCoverImage event"),new Error("cef bridge event[initCoverImage] get cover path failed");if((0,ms.CD)().reportPvImmediately(),c.reportPv(),t){var i;const e=await a.getFileBlobInfoByPath(t);if(!e.ok)return;null===(i=n.updateProjectListFromPC)||void 0===i||i.call(n);const{blobUrl:r,md5:c,width:l,height:d}=e.value;mt.fc.setDependency(c,{id:c,resourceId:c,content:r,type:Ie.xP.EverCloud,isPreview:!1}),o.graphicSDK.api.image.add(o.graphicSDK.document.pages[0].id,{id:c,md5:c,resourceId:c,type:Ie.lJ.CloudImageSticker},{rotation:0,opacity:1,scale:{x:1,y:1},...(0,Qe.SY)(o.graphicSDK.document.pages[0].dimension,{width:l,height:d})}),s.renderSDK.accessors.selection.triggerMaterialsSelection([])}else(0,ms.CD)().reportPvImmediately(),c.reportPv()}))}))}(this.containerService,!this._draftId),function(e){e.invokeFunction((e=>{e.get($.n).notifyWebComplete()}))}(this.containerService)}registerI18nService(e){e.register(u.S,new w.M(Eo.D,[{specifyLocale:this._capcutLocale}],!1))}showWebview(){this.containerService.invokeFunction((e=>{e.get($.n).notifyShowWebView(Date.now())}))}_parseQueryFromWebviewUrl(){const{draftId:e,coverPath:t,width:i,height:a,language:r}=(0,p.gO)();this._draftId=e,this._coverPath=t,this._dimension={width:Number(null!=i?i:"1080"),height:Number(null!=a?a:"1080"),unit:Ie.fb.PX},this._capcutLocale=r}_initDraft(){return new Promise((e=>{this.containerService.invokeFunction((async t=>{const i=t.get(ge.w),r=t.get(Me.j);r.bootstrap();let s;if(!this._draftId)i.graphicSDK.init({isNewDraft:!0,dimension:this._dimension}),s=(0,vt.g)(),r.updateDraftId(s),i.graphicSDK.document.updateDocumentMeta({draftId:s});else{var o,n,c;i.graphicSDK.init({isNewDraft:!1}),r.updateDraftId(null!==(o=this._draftId)&&void 0!==o?o:"");const t=await r.readDraft();if(!t.ok)return _.t.error(t.msg),(0,Is.i)(!1),void e((0,a.wf)(-1,"data error"));s=null!==(n=null===(c=t.value.draftData)||void 0===c?void 0:c.draft_id)&&void 0!==n?n:"0",r.updateDraftId(s);try{i.graphicSDK.buildFromServerData(s,t.value)}catch(l){(0,Is.i)(!1),new Es.t(Es.g.DRAFT_BROKEN).report(),e((0,a.wf)(-1,"sdk parser failure"))}}e((0,a.ly)())}))}))}}var No=i(91372);class jo extends To{constructor(){super(...arguments),this.editorType=h.gg.EditorWeb}async initOrRestoreDraftData(){Po(this.containerService);const e=Fo(this.instantiationService);if(!e.ok)return Promise.resolve(e);await s(this.instantiationService),gs(this.containerService);const t=new qt.e1,i=this.containerService.createInstance(ws.t).bootstrap();if(!i.ok)return new Es.t(Es.g.PROJECT_NOT_EXIST).report(),(0,Ss._)(),Promise.resolve(i);const r=!t.draftId,o=r?(0,vt.g)():t.draftId;return await this.containerService.invokeFunction((async e=>{const i=e.get(ge.w),a=e.get(Me.j);a.updateDraftId(o);const s=e.get(Fe.X),n=e.get(q.w),{graphicSDK:c}=i;if(r)t.coverId&&await s.waitForReady(),c.init({isNewDraft:!0,dimension:t.dimension,scenario:t.scenario}),await this._setCoverImg({coverId:t.coverId,graphicSDK:c,projectMaterialManager:s});else{var l;const e=await a.readDraft();if(e.ok){c.init({isNewDraft:!1});const t=e.value;i.updateAllEverFiles(t.draftAllEverAsserts),c.buildFromServerData(o,t)}else c.init({isNewDraft:!0,dimension:t.dimension,scenario:t.scenario}),xe.Z.error(Ae.ZP.t("web_graphic_tips_draft_open_failure",{},"Draft is not found or invalid."));null===(l=this.cookieConsentService)||void 0===l||l.start(),(0,ms.CD)().reportPvImmediately(),n.reportPv()}a.resetSaveState(),c.document.updateDocumentMeta({draftId:o})})),Promise.resolve((0,a.ly)())}execAfterLifecycle(){this._listenIframeCallback(),this.containerService.invokeFunction((e=>{e.get(Ha.Z).notifyReady()}))}_listenIframeCallback(){this.containerService.invokeFunction((e=>{const t=e.get(Ha.Z),i=e.get(q.w);t.onInsertCoverToCanvas((({background:e,material:t})=>{this.containerService.invokeFunction((a=>{var r,s;const o=a.get(ge.w),n=a.get(Fe.X),c=a.get(Me.j);if(e){const t=new No.Il(e);o.graphicSDK.api.page.updateBackgroundColor(o.graphicSDK.document.pages[0].id,[t.r,t.g,t.b,t.a],!0)}this._addCoverToCanvas({coverFile:t,graphicSDK:o.graphicSDK}),null===(r=n.appendCoverKey)||void 0===r||r.call(n,t.md5),c.resetSaveState(),null===(s=this.cookieConsentService)||void 0===s||s.start(),(0,ms.CD)().reportPvImmediately(),i.reportPv()}))}))}))}async _setCoverImg({coverId:e,projectMaterialManager:t,graphicSDK:i}){let a;e&&await Promise.race([(async i=>{a=await(null===(i=t.appendCoverKey)||void 0===i?void 0:i.call(t,e)),(0,le.Y2)(a,"cover file not found")})(),new Promise((t=>{this.containerService.invokeFunction((async i=>{try{const r=i.get(Ha.Z),s=await r.getMaterialAsset(e);a=s.ok?s.value:void 0,t()}catch(r){}}))}))]),a&&this._addCoverToCanvas({coverFile:a,graphicSDK:i})}_addCoverToCanvas({coverFile:e,graphicSDK:t}){mt.fc.getInstance().parser.everCloud.fetchData({id:e.md5,resourceId:e.md5,type:Ie.xP.EverCloud,fileUrl:{md5:e.md5,url:e.url},aesKey:e.coverKey,transcode:e.transcodeInfo}),t.api.image.add(t.document.pages[0].id,{id:e.md5,md5:e.md5,resourceId:e.md5,type:Ie.lJ.CloudImageSticker},{rotation:0,opacity:1,scale:{x:1,y:1},...(0,Qe.SY)(t.document.pages[0].dimension,{width:e.width,height:e.height})}),this.containerService.invokeFunction((async e=>{const t=e.get(de.T);await t.bootstrap(),t.renderSDK.accessors.selection.triggerMaterialsSelection([])}))}}i(50460),i(24949),i(51117),i(74964),i(99655);(new class{async start(){!function(){const e=p.m4.create(i.g.location.href);if((0,p.PZ)(e.getAllQueryParameterValues()),e.getQueryParameterValue("editorType")!==h.gg.EditorPC){const t=e.removeAllQueryParameter(g).toString();i.g.history.replaceState({},"",t)}}();const e=new qt.e1;switch(e.editorType){case h.gg.EditorPC:this._flow=new Uo;break;case h.gg.EditorWeb:this._flow=new jo;break;case h.gg.Main:default:this._flow=new Oo}await this._flow.startLifeCycle().catch((e=>{(0,Cs.e)()})),function(e){if(So)return e===h.gg.Main&&So.reportPv(),So;const t=Io(e);So=bo(t),e===h.gg.Main&&So.reportPv()}(e.editorType)}}).start()},58714:(e,t,i)=>{i.d(t,{gU:()=>n,wo:()=>a,xq:()=>r});var a,r,s=i(37722);!function(e){e.show="show",e.replace="replace",e.addNew="add_new"}(a||(a={})),function(e){e[e.on=1]="on",e[e.off=0]="off"}(r||(r={}));class o extends s.C{constructor(e){super(),this.eventName="add_template_popup";const{action:t,isRemember:i}=e;this.action=t,this.isRemember=i}getEventParams(){return{action:this.action,is_remember:this.isRemember}}}function n(e,t){return new o({action:e,isRemember:t}).report()}},78379:(e,t,i)=>{i.d(t,{CJ:()=>a,G8:()=>o});var a,r=i(37722);!function(e){e.BATCH_CANCEL="batch_cancel",e.RETRY="retry",e.BATCH_RETRY="batch_retry",e.DELETE="delete",e.UNDO="undo",e.REDO="redo",e.CLICK_PICKTURE_EDIT="click_picture_edit",e.DUPLICATE="duplicate",e.MULTIPLE_SIZE="multiple_size",e.MULTIPLE_PRESETS="multiple_presets"}(a||(a={}));class s{constructor(e){this.eventName="batch_material_process",this.params=e}getEventParams(){return this.params}}function o(e){const t=new s(e);r.I.getInstance().reportEvent(t)}},55971:(e,t,i)=>{i.d(t,{Lo:()=>r,UM:()=>u,td:()=>s});var a,r,s,o,n=i(68967),c=i(37722),l=i(18250);!function(e){e.DROPBOX="dropbox",e.MY_SPACE="my_space",e.MY_DEVICE="my_device",e.GOOGLE_DRIVE="google_drive"}(a||(a={})),function(e){e.CLICK_ADD="click_add",e.DRAG="drag_to_panel"}(r||(r={})),function(e){e.SHOW="show",e.BACK="back",e.BACK_CONFIRM="back_confirm",e.BACK_CONTINUE="back_continue",e.ADD_IMAGE="add_image",e.SELECT_MATERIAL="select_material",e.MY_SPACE="my_space",e.GOOGLE_DRIVE="google_drive",e.DROPBOX="dropbox",e.IMPORT="import"}(s||(s={})),function(e){e.MAGIC_TOOLS="magic_tools",e.RECENT_DRAFT="recent_draft"}(o||(o={}));class d{constructor(e){this.eventName="smart_tool_page",this.currentPage="smart_tool_page",this.fromPage="work_space",this.toolType="batch";const t=(0,n.gO)(),i=t.from_page||"first_page",a=t.enter_from||"first_page",r=t.open_from_pwa;this.action=e.action,this.enterFrom=e.enterFrom||a||void 0,this.isAutoCut=e.isAutoCut,this.importSource=e.importSource,this.importType=e.importType,this.fromPage=e.fromPage||i||this.fromPage,this.isPwa=(0,l.tc)()?1:0,this.openFromPwa=r?1:0}getEventParams(){return{action:this.action,enter_from:this.enterFrom,current_page:this.currentPage,from_page:this.fromPage,tool_type:this.toolType,is_autocut:this.isAutoCut,import_source:this.importSource,import_type:this.importType,is_pwa:this.isPwa,open_from_pwa:this.openFromPwa}}}function u(e){const t=new d(e);c.I.getInstance().reportEvent(t)}},21399:(e,t,i)=>{i.d(t,{Uq:()=>u,hf:()=>d,tA:()=>h});var a=i(8757),r=i(37722),s=i(10966),o=i(71230),n=i.n(o),c=i(92204);class l{constructor(e,t){this.eventName="click_canvas_display_zoom",this.scale=t,this.action_type=e}getEventParams(){return{action_type:this.action_type,scale:this.scale}}}const d=n()(((e,t)=>{const i=r.I.getInstance();t>a.Qf.MAX&&(t/=100);const s=new l(e,parseFloat(t.toFixed(2)));i.reportEvent(s)}),200),u=(e,t)=>{switch(e){case c.aY.Fit:d(c.fK.SHORTKEY_FIT,null!=t?t:1);break;case c.aY.zoom50:d(c.fK.SHORTKEY_50,Number(e));break;case c.aY.zoom100:d(c.fK.SHORTKEY_100,Number(e));break;case c.aY.zoom200:d(c.fK.SHORTKEY_200,Number(e))}},h=(e,t)=>{e&&t&&((0,s.G3)(e)?d(c.fK.MOUSE_WHEEL,t):d(c.fK.TOUCHPAD,t))}},59669:(e,t,i)=>{i.d(t,{WX:()=>o,fu:()=>a});var a,r=i(37722);!function(e){e.Undo="undo",e.Redo="redo",e.Zoom="zoom",e.ShowRulers="show_rulers",e.HideRulers="hide_rulers",e.AddHorizontalGuide="add_horizontal_guide",e.AddVerticalGuide="add_vertical_guide",e.RemoveHorizontalGuide="remove_horizontal_guide",e.RemoveVerticalGuide="remove_vertical_guide",e.RemoveAllGuides="remove_all_guides",e.LockGuide="lock_guide",e.UnlockGuide="unlock_guide",e.ShowMargin="show_margin",e.HideMargin="hide_margin",e.ShowPrintBleed="show_print_bleed",e.HidePrintBleed="hide_print_bleed"}(a||(a={}));class s{constructor(e,t){this.eventName="click_function",this.functionName=e,this.actionType=t}setPageIndex(e){this.pageNo=e+1}getEventParams(){return{function_name:this.functionName,action_type:this.actionType,page_no:this.pageNo}}}function o(e,t,i){const a=new s(e,t);a.setPageIndex(i),r.I.getInstance().reportEvent(a)}},77383:(e,t,i)=>{i.d(t,{Vt:()=>p,_L:()=>u,_S:()=>g,d5:()=>f,nu:()=>m,uV:()=>h,vJ:()=>v,yV:()=>d});var a=i(69578),r=i(92204),s=i(37722),o=i(68967),n=i(25222),c=i(8757);class l extends s.C{constructor(e){super(),this.eventName="click_material_item",this.materialId="",this.actionType=a.gF.CLICK,this.optionType=a.zf.ADD,this.scene=r.YR.Category,this.rank=0,Object.assign(this,e)}getEventParams(){var e,t,i,a,s,o,n,c,l;const d={material_name:null!==(e=this.materialName)&&void 0!==e?e:r.Ic,material_id:null!==(t=this.materialId)&&void 0!==t?t:r.Ic,action_type:this.actionType,material_category:this.category,material_subcategory:null!==(i=this.subCategory)&&void 0!==i?i:r.Ic,material_thirdcategory:null!==(a=this.thirdCategory)&&void 0!==a?a:r.Ic,material_thirdcategory_id:null!==(s=this.thirdCategoryId)&&void 0!==s?s:r.Ic,material_forthcategory:null!==(o=this.forthCategory)&&void 0!==o?o:r.Ic,material_forthcategory_id:null!==(n=this.forthCategoryId)&&void 0!==n?n:r.Ic,is_multilayer_frame:null!==(c=this.isMultilayerFrame)&&void 0!==c?c:0,option_type:this.optionType,scene:this.scene,grid_cnt:null!==(l=this.gridCnt)&&void 0!==l?l:0,rank:this.rank,sticker_category:this.stickerCategory,tool_type:this.toolType,material_channel:this.materialChannel,theme_type:this.themeType};var u,h,p,g;this.scene===r.YR.Search&&Object.assign(d,{search_id:null!==(u=this.searchId)&&void 0!==u?u:r.Ic,search_keyword:null!==(h=this.searchKeyword)&&void 0!==h?h:r.Ic,keyword_source:null!==(p=this.keywordSource)&&void 0!==p?p:r.Ic,word_position:null!==(g=this.wordPosition)&&void 0!==g?g:r.Ic});return d}}class d extends l{constructor(e,t,i=a.zf.ADD,s){var c;const{sourceFrom:l,item:d,extraParams:u,rank:h,materialChannel:p}=e,g="search"===l;super({category:r.c8.TEMPLATE,thirdCategory:g?void 0:l}),this.materialId=d.id,this.materialName=null!==(c=d.title)&&void 0!==c?c:r.Ic,this.actionType=t,this.optionType=i,this.themeType=s,this.rank=h,this.scene=g?r.YR.Search:r.YR.Category,g&&(this.searchId=d.searchId,this.searchKeyword=null==u?void 0:u.searchKeyword,this.keywordSource=null==u?void 0:u.keywordSource,this.wordPosition=null==u?void 0:u.wordPosition);const _=(0,o.gO)().editorType;[n.gg.EditorPC,n.gg.EditorWeb].includes(_)&&(this.thirdCategory="video_cover_template",this.materialChannel=p)}}class u extends l{constructor(e,t,i=a.zf.ADD){const{sourceFrom:s,item:o,rank:n}=e;super({category:r.c8.Apps,thirdCategory:s}),this.materialId=o.id,this.actionType=t,this.optionType=i,this.rank=o.index+1,this.scene=r.YR.Category,this.toolType=c.B8.TextToDesign}}class h extends l{constructor(e,t,i){var s;(super({category:e,thirdCategory:t.sourceFrom,forthCategory:t.albumName,forthCategoryId:t.albumId}),this.materialId=t.resourceId,this.materialName=t.name,this.actionType=i,"number"==typeof t.index&&(this.rank=t.index),e===r.c8.STICKER)&&((null===(s=t.sdkExtra)||void 0===s?void 0:s.type)===c.zX.SvgSticker?this.stickerCategory=a.ql.Svg:this.stickerCategory=a.ql.Png)}}class p extends l{constructor(e,t,i=a.zf.ADD){var s,o;super({category:r.c8.UPLOAD}),this.materialId=null!==(s=null==e?void 0:e.id)&&void 0!==s?s:r.Ic,this.materialName=null!==(o=null==e?void 0:e.name)&&void 0!==o?o:r.Ic,this.actionType=t,this.subCategory="project"===(null==e?void 0:e.sourceFrom)?r.Hy.PROJECT:r.Hy.CLOUD,this.optionType=i,"number"==typeof(null==e?void 0:e.index)&&(this.rank=null==e?void 0:e.index)}}class g extends l{constructor(e){var t;super({category:r.c8.PHOTO,thirdCategory:e.thirdCategory}),this.searchId=e.searchId,this.searchKeyword=e.searchKeyword,this.keywordSource=e.keywordSource,this.wordPosition=e.wordPosition,this.rank=null!==(t=null==e?void 0:e.rank)&&void 0!==t?t:0,this.scene=e.searchKeyword?r.YR.Search:r.YR.Category,this.optionType=null==e?void 0:e.optionType,this.materialId=e.materialId,this.materialName=e.materialName,this.actionType=e.actionType}}class _ extends l{constructor(e){super({category:r.c8.DESIGN,thirdCategory:e.thirdCategory}),this.materialId=e.materialId,this.materialName=e.materialName,"number"==typeof e.rank&&(this.rank=e.rank)}}function f(e){new _(e).report()}class v extends l{constructor(e,t){super({category:r.c8.FRAME,thirdCategory:e.sourceFrom,forthCategory:e.albumName,forthCategoryId:e.albumId}),this.materialId=e.resourceId,this.materialName=e.name,this.actionType=t,this.isMultilayerFrame=e.isMultilayerFrame?1:0,"number"==typeof e.index&&(this.rank=e.index)}}class m extends l{constructor(e,t){super({category:r.c8.GRID,thirdCategory:e.sourceFrom,forthCategory:e.albumName,forthCategoryId:e.albumId}),this.materialId=e.resourceId,this.materialName=e.name,this.actionType=t,this.forthCategoryId=e.albumId,this.gridCnt=e.gridCnt,"number"==typeof e.index&&(this.rank=e.index)}}},69578:(e,t,i)=>{i.d(t,{AQ:()=>f,Df:()=>_,JL:()=>u,dZ:()=>d,fW:()=>g,gF:()=>a,i7:()=>l,lX:()=>h,ql:()=>s,y5:()=>p,zf:()=>r});var a,r,s,o=i(54714),n=i(888),c=i(96442);function l(e,t,i){new n.hK({...e,sourceFrom:"project"},o.$u.ClickEvent,!0,t,i,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Picture,c.V6.Success)}function d(e,t,i){new n.hK({...e,sourceFrom:"project"},o.$u.ClickEvent,!0,t,i,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Page,c.V6.Success)}function u(e,t,i,a){new n.hK({...e,sourceFrom:"project"},o.$u.ClickEvent,!0,t,i,n.Ds.CANVAS).report(),(0,c.tS)(a?c.Jm.MutilFrame:c.Jm.Frame,c.V6.Success)}function h(e,t,i){new n.hK({...e,sourceFrom:"project"},o.$u.ClickEvent,!0,t,i,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Grid,c.V6.Success)}function p(e){new n.hK(void 0,o.$u.ClickEvent,!1,void 0,e,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Picture,c.V6.Failure)}function g(e){new n.hK(void 0,o.$u.ClickEvent,!1,void 0,e,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Page,c.V6.Failure)}function _(e){new n.hK(void 0,o.$u.ClickEvent,!1,void 0,e,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Frame,c.V6.Failure)}function f(e){new n.hK(void 0,o.$u.ClickEvent,!1,void 0,e,n.Ds.CANVAS).report(),(0,c.tS)(c.Jm.Grid,c.V6.Failure)}!function(e){e.CLICK="click",e.DRAG="drag",e.SHORTKEY="shortkey",e.OUTER_PASTE="outer_paste"}(a||(a={})),function(e){e.ADD="add",e.ENLARGE="enlarge",e.CLICKPREVIEW="clickpreview",e.PREVIEWADD="preview_add",e.SET_BACKGROUND="set_background",e.APPLY_THEME="apply_theme",e.PREVIEW_APPLY="preview_apply",e.APPLY_TO_ALL="apply_to_all"}(r||(r={})),function(e){e.Svg="svg",e.Png="png"}(s||(s={}))},92204:(e,t,i)=>{i.d(t,{B$:()=>d,Bg:()=>g,G_:()=>D,H8:()=>l,Hy:()=>n,Ic:()=>s,N4:()=>b,PR:()=>v,Pc:()=>E,Q6:()=>S,SY:()=>M,W0:()=>F,WA:()=>y,YR:()=>k,_m:()=>h,aC:()=>u,aY:()=>R,bU:()=>w,c8:()=>o,d:()=>p,fK:()=>A,gU:()=>L,iW:()=>m,kx:()=>I,l5:()=>c,lw:()=>P,rg:()=>T,uC:()=>C});var a=i(27607),r=i(8757);const s="none";var o,n,c,l,d;!function(e){e.TEMPLATE="template",e.UPLOAD="upload",e.TEXT="text",e.SHAPE="shapes",e.STICKER="stickers",e.FRAME="frames",e.GRID="grid",e.DESIGN="design",e.PHOTO="photos",e.Apps="apps"}(o||(o={})),function(e){e.PROJECT="project",e.CLOUD="cloud"}(n||(n={})),function(e){e.Click="click",e.ShortKey="shortkey",e.RightClick="right_click",e.FunctionPanelClick="function_panel_click",e.Drag="drag",e.FunctionRightClick="function_rightclick"}(c||(c={})),function(e){e.Click="click",e.Drag="drag"}(l||(l={})),function(e){e.MOVE="move",e.ROTATE="rotate",e.RESIZE="resize",e.ADJUST="transparency_adjust",e.COPY="copy",e.DELETE="delete",e.PASTE="paste",e.DUPLICATE="duplicate",e.GROUP="group",e.UNGROUP="ungroup",e.EXPORT="export",e.SELECT_LAYER="select_layer",e.LAYER="layer",e.SEND_BACKWARD="send_backward",e.SEND_TO_BACK="send_to_back",e.BRING_FORWARD="bring_forward",e.BRING_TO_FRONT="bring_to_front",e.RIGHT_CLICK="right_click",e.FLIP_HORIZONTAL="flip_horizontal",e.FLIP_VERTICAL="flip_vertical",e.ALIGN_LEFT="align_left",e.ALIGN_CENTER="align_center",e.ALIGN_RIGHT="align_right",e.ALIGN_TOP="align_top",e.ALIGN_MIDDLE="align_middle",e.ALIGN_BOTTOM="align_bottom",e.ALIGN_LEFT_TO_PAGE="align_left_to_page",e.ALIGN_CENTER_TO_PAGE="align_center_to_page",e.ALIGN_RIGHT_TO_PAGE="align_right_to_page",e.ALIGN_TOP_TO_PAGE="align_top_to_page",e.ALIGN_MIDDLE_TO_PAGE="align_middle_to_page",e.ALIGN_BOTTOM_TO_PAGE="align_bottom_to_page",e.ALIGN_DISTRIBUTE_HORIZONTAL="align_distribute_horizontal",e.ALIGN_DISTRIBUTE_VERTICAL="align_distribute_vertical",e.SET_BACKGROUND="set_background",e.DELETE_BACKGROUND="delete_background",e.DETACH_BACKGROUND="detach_background",e.CHANGE_RANK="change_rank",e.ADD="add",e.ADD_CUSTOM_SIZE="add_custom_size",e.ADD_SAME_SIZE="add_same_size",e.PREVIOUS="previous",e.NEXT="next",e.LOCK="lock",e.UNLOCK="unlock",e.SORT_LAYERS="sort_layers"}(d||(d={}));const u=1e-6;var h,p,g,_,f,v,m,y,I,w,S,b,C,E,k,T,P,D,x,A,R,F,M;!function(e){e.Template="template",e.Picture="picture",e.Text="text",e.Line="line",e.Polygon="polygon",e.Stickers="stickers",e.Frames="frames",e.MultiFrame="multilayer_frame",e.Group="group",e.Multi="multi",e.Page="page",e.Grid="grid",e.BackgroundPhoto="background_photo"}(h||(h={})),function(e){e.FunctionBar="function_bar",e.NavigationBar="navigation_bar",e.CanvasSide="canvas_side",e.Canvas="canvas"}(p||(p={})),function(e){e.PageHeader="page_header",e.MenuRightClick="menu_right_click"}(g||(g={})),function(e){e.GREEN="green",e.RED="red",e.YELLOW="yellow"}(_||(_={})),function(e){e.SHOW="show",e.HOVER="hover"}(f||(f={})),function(e){e.SHOW="show",e.ENTRANCE_CLICK="entrance_click",e.COLOR_WHEEL_CLICK="color_wheel_click",e.PIPETTE_CLICK="pipette_click",e.RECENT_COLOR_CLICK="recent_color_click",e.PHOTO_COLOR_CLICK="photo_color_click",e.PHOTO_VIEW_ALL_SHOW="photo_view_all_show",e.Document_COLOR="document_color_click",e.DOCUMENT_VIEW_ALL_SHOW="document_view_all_show",e.THEME_SOLID_COLOR_CLICK="theme_solid_color_click",e.THEME_GRADIENT_COLOR_CLICK="theme_gradient_color_click",e.GRADIENT_COLOR_CLICK="gradient_color_click",e.EDIT_COLOR_STOP_CLICK="edit_color_stop_click"}(v||(v={})),function(e){e.AUTO_RESIZE="auto_resize",e.NORMAL_RESIZE="normal_resize",e.NONE="none",e.MANUAL="manual"}(m||(m={})),function(e){e.SHOW="show",e.GET="get",e.NEXT="next",e.SKIP="skip",e.PREVIOUS="previous"}(y||(y={})),function(e){e[e.STEP_1=1]="STEP_1",e[e.STEP_2=2]="STEP_2",e[e.STEP_3=3]="STEP_3",e[e.STEP_4=4]="STEP_4",e.UNGROUPED="ungroup",e.layers="layers"}(I||(I={})),function(e){e.ENTRANCE_CLICK="entrance_click",e.RESIZE_PREVIEW="resize_preview",e.RESET="reset",e.SHOW_MORE="show_more",e.RESIZE_REPLACE="resize_replace",e.RESIZE_ADD_PAGES="resize_add_pages",e.RESIZE_ADD_PROJECT="resize_add_project"}(w||(w={})),function(e){e.CLICK="click",e.SLIDE="slide",e.RIGHT_CLICK="right_click"}(S||(S={})),function(e){e.Show="show",e.Confirm="confirm"}(b||(b={})),function(e){e.Return="return",e.Apply="apply",e.Preview="preview"}(C||(C={})),function(e){e.Success="success",e.Failure="fail"}(E||(E={})),function(e){e.Search="search",e.Category="category"}(k||(k={})),function(e){e.sug="sug",e.searchHistory="search_history",e.input="input",e.hotSearch="hot_search"}(T||(T={})),function(e){e.searchBarInner="search_bar_inner",e.recomSearch="recom_search",e.searchMidPage="search_mid_page"}(P||(P={})),function(e){e.success="success",e.fail="fail",e.noResult="no_result"}(D||(D={})),function(e){e.ONECLICK="oneclick",e.RECENT="recent",e.RECOMMEND="recommend",e.PHOTO="photo"}(x||(x={})),function(e){e.SLIDE="slide",e.INPUT="input",e.CLICK="click",e.TOUCHPAD="touchpad",e.MOUSE_WHEEL="mouse_wheel",e.SHORTKEY_FIT="shortkey_fit",e.SHORTKEY_50="shortkey_50",e.SHORTKEY_100="shortkey_100",e.SHORTKEY_200="shortkey_200",e.SHORTKEY_ZOOMIN="shortkey_zoomin",e.SHORTKEY_ZOOMOUT="shortkey_zoomout"}(A||(A={})),function(e){e.Fit="fit",e.zoom50="50",e.zoom100="100",e.zoom200="200"}(R||(R={})),function(e){e.Enter="enter",e.WithDraw="withdraw"}(F||(F={})),function(e){e.BasicTextColor="basic_text_color",e.TextBackground="text_background",e.TextShadow="text_shadow",e.TextOutline="text_outline",e.TextGlow="text_glow",e.ImageOutline="picture_effect_stroke",e.ImageShadow="picture_effect_shadow",e.ImageFeather="picture_effect_feather",e.ImageGlow="picture_effect_glow",e.StickerFillColor="sticker_fill_color"}(M||(M={}));const L={[a.yY.TextToDesign]:r.B8.TextToDesign,[a.yY.AIBackground]:r.B8.AiBackground,[a.yY.AIModel]:r.B8.AiModel,[a.yY.ImageGenerator]:r.B8.TextToImage,[a.yY.None]:""}},93947:(e,t,i)=>{i.d(t,{Dl:()=>a,r2:()=>o});var a,r=i(37722);!function(e){e.CREATE="create"}(a||(a={}));class s{constructor(){this.eventName="create_new_page",this.action=a.CREATE,this.scenario="custom",this.scale="0*0px"}setAction(e){this.action=e}setScenario(e){this.scenario=e}setScale(e){this.scale=e}getEventParams(){return{action:this.action,scenario:this.scenario,scale:this.scale}}}const o=(e,t,i)=>{const a=r.I.getInstance(),o=new s;o.setAction(e),o.setScenario(t),o.setScale(i),a.reportEvent(o)}},72135:(e,t,i)=>{i.d(t,{y:()=>s});var a=i(37722);class r extends a.C{constructor(e){super(),this.eventName="custom_size_popup",this._projectType="image";const{action:t,scale:i,scenario:a,position:r}=e;this._action=t,this._scale=i,this._scenario=a,this._position=r}getEventParams(){return{action:this._action,project_type:this._projectType,scale:this._scale,scenario:this._scenario,position:this._position}}}const s=e=>{new r(e).report()}},37180:(e,t,i)=>{i.d(t,{EZ:()=>o,No:()=>c,b5:()=>r,mh:()=>s});var a=i(37722);class r extends a.C{constructor(e){super(),this.eventName="change_name_and_space_popup",this._action=e}getEventParams(){return{action:this._action}}}class s extends a.C{constructor(){super(...arguments),this.eventName="click_change_dictionary"}getEventParams(){return{position:"editor_top"}}}class o extends a.C{constructor(e,t,i){super(),this.eventName="change_dictionary_window",this._action=e,this._fromWorkspaceInfo=t,this._toWorkspaceInfo=i}getEventParams(){var e,t,i,a,r,s,o,n,c,l,d,u,h,p;const g=1073741824;return{action:this._action,from_space_id:null===(e=this._fromWorkspaceInfo)||void 0===e?void 0:e.space_id,from_space_type:this._convertSpaceType(null===(t=this._fromWorkspaceInfo)||void 0===t?void 0:t.role),from_space_used:null!==(i=this._fromWorkspaceInfo)&&void 0!==i&&i.usage?this._keepTwoDigits(this._fromWorkspaceInfo.usage/g):void 0,from_space_limit:null!==(a=this._fromWorkspaceInfo)&&void 0!==a&&a.quota?this._keepTwoDigits(this._fromWorkspaceInfo.quota/g):void 0,from_space_user_cnt:null===(r=this._fromWorkspaceInfo)||void 0===r?void 0:r.member_cnt,from_workspace_space_type:null===(s=this._fromWorkspaceInfo)||void 0===s?void 0:s.space_type,from_workspace_raw_space_type:null===(o=this._fromWorkspaceInfo)||void 0===o?void 0:o.raw_space_type,to_space_id:null===(n=this._toWorkspaceInfo)||void 0===n?void 0:n.space_id,to_space_type:this._convertSpaceType(null===(c=this._toWorkspaceInfo)||void 0===c?void 0:c.role),to_space_used:null!==(l=this._toWorkspaceInfo)&&void 0!==l&&l.usage?this._keepTwoDigits(this._toWorkspaceInfo.usage/g):void 0,to_space_limit:null!==(d=this._toWorkspaceInfo)&&void 0!==d&&d.quota?this._keepTwoDigits(this._toWorkspaceInfo.quota/g):void 0,to_space_user_cnt:null===(u=this._toWorkspaceInfo)||void 0===u?void 0:u.member_cnt,to_workspace_space_type:null===(h=this._toWorkspaceInfo)||void 0===h?void 0:h.space_type,to_workspace_raw_space_type:null===(p=this._toWorkspaceInfo)||void 0===p?void 0:p.raw_space_type}}_convertSpaceType(e){if(e)return"owner"===e?"created_team":"joined_team"}_keepTwoDigits(e){return Number(e.toFixed(2))}}class n extends a.C{constructor(e){super(),this.eventName="change_space_new_guide",this._action=e}getEventParams(){return{action:this._action}}}const c=e=>{new n(e).report()}},58294:(e,t,i)=>{i.d(t,{I:()=>r});var a=i(37722);class r extends a.C{constructor(e){super(),this.eventName="change_draft_name",this.draftName=e}getEventParams(){return{name:this.draftName}}}},23926:(e,t,i)=>{i.d(t,{H:()=>s});var a=i(37722);class r{constructor(e,t){this.eventName="edit_shortkey_window",this.option=e,this.action_type=t}getEventParams(){return{option:this.option,action_type:this.action_type}}}const s=(e,t)=>{const i=a.I.getInstance(),s=new r(e,t);i.reportEvent(s)}},19426:(e,t,i)=>{i.d(t,{Dq:()=>m,Ee:()=>b,Hk:()=>C,IC:()=>D,JA:()=>k,Kq:()=>I,U$:()=>x,Wb:()=>v,fV:()=>P,tG:()=>s,ze:()=>E});var a,r,s,o,n=i(37722),c=i(15516),l=i(68967),d=i(67219),u=i(8757),h=i(43777),p=i(21204),g=i(82440),_=i(92204);!function(e){e.Manga="prequel_cartoon",e.HongKongCartoon="hkcartoon",e.OilPaint="cartoon_oilpaintv2_img2img"}(a||(a={})),function(e){e.ThreeDCartoon="tupo_cartoon",e.Pop="bopu_cartoon_abroad_pixsoul",e.Manga="prequel_cartoon",e.ThreeDGame="3dgame_cartoon_abroad",e.HongKongCartoon="hkcartoon"}(r||(r={}));class f{constructor(){this.templateMap=new Map,this.templateMaterial=new Map,this.textTemplate=new Map,this.fonts=new Map,this.customTextCnt=0,this.isUseBold=!1,this.isUseItal=!1,this.isUseUnderline=!1,this.isUseCapitalLock=!1,this.isUseGradient=!1,this.isUseGlow=!1,this.isUseCurve=!1,this.outlineCnt=0,this.shadowCnt=0,this.isUseTextBackground=!1,this.isUseTextPreset=!1,this.isRichText=!1,this.textPresets=new Map,this.stickers=new Map,this.allShapeCnt=0,this.shapes=new Map,this.shapeCategory=new Set,this.allFrameCnt=0,this.frameCnt=0,this.multilFrameCnt=0,this.frames=new Map,this.totalGridCnt=0,this.grids=new Map,this.isUseAdjust=!1,this.documentColorCount=0,this.aiToolPipelines=[],this.textToImageParams={text_to_image_cnt:0,image_to_image_cnt:0}}statisticTextLayer(e){var t,i,a;const{sourceInfo:r,textPreset:s}=e.extra;r?"template"===r.from?this.addTemplateSource(r,e.type):this.textTemplate.set(r.templateId,r.templateName):this.customTextCnt+=1,e.boldWidth&&(this.isUseBold=!0),e.italicDegree&&(this.isUseItal=!0),e.upperCase&&(this.isUseCapitalLock=!0),null!==(t=e.glow)&&void 0!==t&&t.enable&&(this.isUseGlow=!0),null!==(i=e.curve)&&void 0!==i&&i.enable&&(this.isUseCurve=!0),null!==(a=e.background)&&void 0!==a&&a.enable&&(this.isUseTextBackground=!0),s&&(this.isUseTextPreset=!0,this.textPresets.set(s.id,s.name));JSON.parse(e.richText).styles.forEach((e=>{var t,i,a,r,s;e.underline&&(this.isUseUnderline=!0);const o=null!==(t=null===(i=e.strokes)||void 0===i?void 0:i.length)&&void 0!==t?t:0;this.outlineCnt=this.outlineCnt<o?o:this.outlineCnt;const n=null!==(a=null===(r=e.shadows)||void 0===r?void 0:r.length)&&void 0!==a?a:0;this.shadowCnt=this.shadowCnt<n?n:this.shadowCnt,"gradient"===(null===(s=e.fill)||void 0===s||null===(s=s.content)||void 0===s?void 0:s.render_type)&&(this.isUseGradient=!0)})),e.fontDependResources.forEach((e=>{const t=g.fO.getEntry(e.resourceId);t&&this.fonts.set(null==t?void 0:t.key,null==t?void 0:t.name)})),(0,h.ek)(e)&&(this.isRichText=!0)}addTemplateSource(e,t){var i;if("template"!==e.from)return;this.templateMap.set(e.templateId,e);const a=null!==(i=this.templateMaterial.get(t))&&void 0!==i?i:0;this.templateMaterial.set(t,a+1)}getTemplateIds(){return[...this.templateMap.keys()]}getTemplateNames(){return[...this.templateMap.values()].map((e=>e.templateName))}staticImageLayer(e){var t,i,a,r;if(e.filter&&Object.keys(e.filter).length&&(this.isUseAdjust=!0),null!==(t=e.aiTool)&&void 0!==t&&t.pipelines&&(this.aiToolPipelines=this.aiToolPipelines.concat(e.aiTool.pipelines)),null!==(i=e.extra)&&void 0!==i&&i.imageGeneratorType)switch(e.extra.imageGeneratorType){case"text_to_image":this.textToImageParams.image_generator_detail="text_to_image",this.textToImageParams.text_to_image_cnt++;break;case"image_to_image":this.textToImageParams.image_generator_detail="image_to_image",this.textToImageParams.image_to_image_cnt++}if(!(0,p.U0)(e))return;const s=g.fc.getDependency(e.src.resourceId);if(!s)return;const{id:o,name:n}=null!==(a=e.extra.category)&&void 0!==a?a:{id:_.Ic,name:_.Ic};this.stickers.set(s.id,{name:null!==(r=s.name)&&void 0!==r?r:_.Ic,categoryId:o,categoryName:n})}staticShapeLayer(e){this.allShapeCnt+=1,e.extra.sourceInfo&&this.addTemplateSource(e.extra.sourceInfo,e.type),this.shapes.set(e.extra.resourceId,e.title),this.shapeCategory.add(e.type===u.F5.LINE?"line":"shape")}staticFrameLayer(e){e.items.forEach((e=>{var t;this.aiToolPipelines=this.aiToolPipelines.concat((null===(t=e.fill)||void 0===t||null===(t=t.image)||void 0===t||null===(t=t.aiTool)||void 0===t?void 0:t.pipelines)||[])})),this.allFrameCnt+=1,1===e.items.length&&(this.frameCnt+=1),e.items.length>1&&(this.multilFrameCnt+=1),e.extra.sourceInfo&&this.addTemplateSource(e.extra.sourceInfo,e.type),this.frames.set(e.extra.resourceId,e.title)}staticGridLayer(e){this.totalGridCnt+=1,this.grids.set(e.extra.resourceId,e.title)}}function v(e){const t=(0,d.B6)([e]),i=new f;return t?(t.forEach((e=>{switch(e.type){case u.F5.TEXT:i.statisticTextLayer(e);break;case u.F5.SVG_IMAGE:case u.F5.IMAGE:i.staticImageLayer(e);break;case u.F5.SHAPE:case u.F5.LINE:i.staticShapeLayer(e);break;case u.F5.IMAGE_CONTAINER:i.staticFrameLayer(e);break;case u.F5.GRID:i.staticGridLayer(e)}})),i.documentColorCount=(0,d.Ez)(e),i):i}!function(e){e[e.NoUse=0]="NoUse",e[e.Color=1]="Color",e[e.Text=2]="Text",e[e.Theme=3]="Theme"}(s||(s={}));class m extends n.C{constructor(e,t,i,o,n,l,h,g,_,f,m,y){var I;super(),this.pictureId=t,this.eventName="export_time",this.vid="",this.layerSourceInfo=[],this.use_design_card=s.NoUse,this.use_template_theme_card=s.NoUse,this.getPhotoCnt=()=>{const e=(0,d.pf)([this.id],(e=>{var t;return(null==e||null===(t=e.src)||void 0===t?void 0:t.type)===u.lJ.YkImage}),!0),t=(0,d.pf)([this.id],(e=>{var t;return(null==e||null===(t=e.src)||void 0===t?void 0:t.type)===u.lJ.CloudImageSticker}),!0),i=(0,d.pf)([this.id],(e=>{var t,i;return e.type===u.F5.IMAGE&&(null!==(t=null===(i=(0,p.ow)(e,void 0))||void 0===i?void 0:i.pipelines.some((e=>e.toolType===u.no.ImageCutout)))&&void 0!==t&&t)}),!0),a=(0,d.pf)([this.id],(e=>{var t,i;return e.type===u.F5.IMAGE&&(null!==(t=null===(i=(0,p.ow)(e,void 0))||void 0===i?void 0:i.pipelines.some((e=>e.toolType===u.no.ImageBackground)))&&void 0!==t&&t)}),!0);return{cutout_material:"image",lib_photo_cnt:e.length,upload_photo_cnt:t.length,cutout_cnt:i.length,cutout_background_cnt:a.length}},this.getBackgroundParams=()=>{const e=(0,d.wF)([this.id]);return{background_photo_cnt:e?1:0,color_background:e?0:1}},this.getColorParams=()=>{const e=(0,d.pf)([this.id],(e=>{var t,i;return Boolean(e&&"replacePalette"in e&&(null===(t=e.replacePalette)||void 0===t?void 0:t.enable))||Boolean(e&&"effectFilters"in e&&(null===(i=e.effectFilters)||void 0===i?void 0:i.find((e=>e.resourceId===c.internalEffectResource.colorScheme.resourceId))))}));return{use_color_theme:Number(Boolean(null==e?void 0:e.length)),document_color_cnt:this.helper.documentColorCount}},this.getAiToolParams=()=>{if(!this.helper.aiToolPipelines.length)return;const e={is_image_upscaler:0,is_old_restoration:0,is_image_style_transfer:0,is_ai_color_correction:0,is_low_light_image_enhancer:0,image_upscaler_detail:"",image_style_transfer_detail:"",ai_color_correction_detail:"",low_light_image_enhancer_detail:""};return this.helper.aiToolPipelines.forEach((t=>{var i;switch(t.toolType){case u.no.ImageUpscaler:var s,o;if(e.is_image_upscaler=1,e.image_upscaler_detail)e.image_upscaler_detail+=`,${null===(s=t.param)||void 0===s?void 0:s.scale}`;else e.image_upscaler_detail=`${null===(o=t.param)||void 0===o?void 0:o.scale}`;break;case u.no.ImageRestoration:e.is_old_restoration=1;break;case u.no.ImageStyleConversion:case u.no.ImageStyleAvatar:let h="";switch(null===(i=t.param)||void 0===i?void 0:i.styleKey){case a.Manga:h="manga";break;case a.OilPaint:h="oil_painting";break;case r.HongKongCartoon:h="hong_kong_cartoon";break;case r.Manga:h="manga";break;case r.Pop:h="pop";break;case r.ThreeDCartoon:h="3d_cartoon";break;case r.ThreeDGame:h="3d_game"}e.is_image_style_transfer=1,e.image_style_transfer_detail?e.image_style_transfer_detail+=`,${h}`:e.image_style_transfer_detail=h;break;case u.no.ImageAiToning:var n,c;if(e.is_ai_color_correction=1,e.ai_color_correction_detail)e.ai_color_correction_detail+=`,${String(null===(n=t.param)||void 0===n?void 0:n.level)}`;else e.ai_color_correction_detail=String(null===(c=t.param)||void 0===c?void 0:c.level);break;case u.no.ImageNightEnhance:var l,d;if(e.is_low_light_image_enhancer=1,e.low_light_image_enhancer_detail)e.low_light_image_enhancer_detail+=`,${String(null===(l=t.param)||void 0===l?void 0:l.level)}`;else e.low_light_image_enhancer_detail=String(null===(d=t.param)||void 0===d?void 0:d.level)}})),e.image_upscaler_detail||(e.image_upscaler_detail="none"),e.image_style_transfer_detail||(e.image_style_transfer_detail="none"),e.ai_color_correction_detail||(e.ai_color_correction_detail="none"),e.low_light_image_enhancer_detail||(e.low_light_image_enhancer_detail="none"),e},this.id=e,this.name=i,this.format=o,this.resolution=n,this.scale=l,this.helper=v(this.id),this.quality=h,this.transparentBackground=g,this.compressPNG=_,this.flattenPDF=f,this.use_design_card=null!=m?m:this.use_design_card,this.use_template_theme_card=null!=y?y:this.use_template_theme_card;const w=null!==(I=(0,d.B6)([this.id]))&&void 0!==I?I:[];this.layerSourceInfo=w.map((e=>{var t;return null===(t=e.extra)||void 0===t?void 0:t.sourceInfo})).filter(Boolean)}getMapJoinStr(e,t){return e.size<=0?"none":[...e.entries()].map((([e,i])=>"key"===t?e:i)).join(",")}getMaterialTemplateCnt(e){var t;return null!==(t=this.helper.templateMaterial.get(e))&&void 0!==t?t:0}getTemplateReportParams(){const e=new Set([]),t=new Set([]),i=new Set([]),a=new Set([]),r=new Set([]);return[...this.helper.templateMap.values()].forEach((s=>{t.add(s.templateId),i.add(s.templateCategory),e.add(s.templateName),a.add(s.templateCategoryId),r.add(s.templateChannel)})),{template:[...e].filter(Boolean).join(",")||"none",template_id:[...t].filter(Boolean).join(",")||"none",template_category:[...i].filter(Boolean).join(",")||"none",template_category_id:[...a].filter(Boolean).join(",")||"none",cover_template_channel:[...r].filter(Boolean).join(",")||void 0}}getVid(){const e=(0,d.pf)([this.id],(e=>{var t,i;return!(null==e||null===(t=e.extra)||void 0===t||null===(t=t.sourceInfo)||void 0===t||!t.from)&&[u.yU.AiBackground,u.yU.AiModel].includes(null==e||null===(i=e.extra)||void 0===i||null===(i=i.sourceInfo)||void 0===i?void 0:i.from)}),!0);return{vid:e.length?e.map((e=>{var t;return null==e||null===(t=e.extra)||void 0===t?void 0:t.resourceId})).join(","):""}}getLayerSourceFromParams(){const e={is_text_to_draft:u.yU.TextToDraft,use_color_card:u.yU.ColorCard,is_ai_model_tryon:u.yU.AiModel,is_ai_background:u.yU.AiBackground};return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,Number(this.layerSourceInfo.some((e=>e.from===t)))])))}getStickerCnt(){const e=(0,d.pf)([this.id],(e=>{var t;return(null===(t=e.src)||void 0===t?void 0:t.type)===u.lJ.Sticker}),!1),t=(0,d.pf)([this.id],(e=>e.type===u.F5.SVG_IMAGE),!1);return{png_sticker_cnt:e.length-t.length,svg_sticker_cnt:t.length}}getStickedReportParams(){if(this.helper.stickers.size<=0)return{sticker:_.Ic,sticker_id:_.Ic,sticker_category:_.Ic,sticker_category_id:_.Ic};const e=[...this.helper.stickers.entries()].map((([e,t])=>[t.name,e,t.categoryName,t.categoryId]));return{sticker:e.map((e=>e[0])).join(","),sticker_id:e.map((e=>e[1])).join(","),sticker_category:e.map((e=>e[2])).join(","),sticker_category_id:e.map((e=>e[3])).join(",")}}getEventParams(){var e,t,i,a,r,s;const o=this.getTemplateReportParams(),c=n.I.getInstance().getContext(u.ry),h=this.getAiToolParams(),p=(0,l.gO)(),g={from_page:p.from_page||"first_page",enter_from:p.enter_from||"first_page",format:this.format,scale:this.scale,resolution:this.resolution,edittype:"picture_edit",original_edittype:"picture_edit",current_page:"picture_edit",picture_id:this.pictureId,picture_name:`${this.name}.${this.format.toLowerCase()}`,total_material_cnt:null!==(e=null===(t=(0,d.B6)([this.id]))||void 0===t?void 0:t.length)&&void 0!==e?e:0,text_cnt:this.getMaterialTemplateCnt(u.F5.TEXT)+this.helper.customTextCnt+this.helper.textTemplate.size,custom_text_cnt:this.helper.customTextCnt,text_template_cnt:this.helper.textTemplate.size,template_text_cnt:this.getMaterialTemplateCnt(u.F5.TEXT),text_template_name:this.getMapJoinStr(this.helper.textTemplate,"value"),text_template_id:this.getMapJoinStr(this.helper.textTemplate,"key"),text_font_id:this.getMapJoinStr(this.helper.fonts,"key"),text_font_name:this.getMapJoinStr(this.helper.fonts,"value"),use_design_card:this.use_design_card,use_template_theme_card:this.use_template_theme_card,...this.getStickedReportParams(),total_shape_cnt:this.helper.allShapeCnt,shape_cnt:this.helper.allShapeCnt-this.getMaterialTemplateCnt(u.F5.LINE)-this.getMaterialTemplateCnt(u.F5.SHAPE),template_shape_cnt:this.getMaterialTemplateCnt(u.F5.SHAPE)+this.getMaterialTemplateCnt(u.F5.LINE),shape:this.getMapJoinStr(this.helper.shapes,"value"),shape_id:this.getMapJoinStr(this.helper.shapes,"key"),shape_category:this.helper.shapeCategory.size>0?[...this.helper.shapeCategory.values()].join(","):"none",total_frame_cnt:this.helper.allFrameCnt,template_frame_cnt:this.getMaterialTemplateCnt(u.F5.IMAGE_CONTAINER),frame_cnt:this.helper.frameCnt,multilayer_frame_cnt:this.helper.multilFrameCnt,frame:this.getMapJoinStr(this.helper.frames,"value"),frame_id:this.getMapJoinStr(this.helper.frames,"key"),total_grid_cnt:this.helper.totalGridCnt,grid:this.getMapJoinStr(this.helper.grids,"value"),grid_id:this.getMapJoinStr(this.helper.grids,"key"),template_cnt:this.helper.templateMap.size,...o,is_text_ital:this.helper.isUseItal?1:0,is_text_bold:this.helper.isUseBold?1:0,is_text_preset:this.helper.isUseTextPreset?1:0,preset_id:this.getMapJoinStr(this.helper.textPresets,"key"),preset_name:this.getMapJoinStr(this.helper.textPresets,"value"),is_text_gradient:this.helper.isUseGradient?1:0,is_text_bg:this.helper.isUseTextBackground?1:0,is_text_outline:this.helper.outlineCnt>1?2:this.helper.outlineCnt,is_text_shadow:this.helper.shadowCnt>1?2:this.helper.shadowCnt,is_text_curve:this.helper.isUseCurve?1:0,is_text_glow:this.helper.isUseGlow?1:0,is_capital_lock:this.helper.isUseCapitalLock?1:0,is_underline:this.helper.isUseUnderline?1:0,is_adjust:this.helper.isUseAdjust?1:0,is_group:(0,d.ar)([this.id]).length>0?1:0,layer_lock_num:null!==(i=null===(a=(0,d.B6)([this.id]))||void 0===a||null===(a=a.filter((e=>e.isLocked)))||void 0===a?void 0:a.length)&&void 0!==i?i:0,resize_type:null!==(r=null==c?void 0:c.resizeType)&&void 0!==r?r:_.iW.NONE,resize_canvas:null!==(s=null==c?void 0:c.resizeCanvas)&&void 0!==s?s:_.iW.NONE,...this.getPhotoCnt(),...this.getBackgroundParams(),...this.getColorParams(),...(0,d.qJ)([this.id]),...(0,d.x6)([this.id]),...h,quality:this.quality,transparent_bkg:this.transparentBackground,compress_png:this.compressPNG,flatten_pdf:this.flattenPDF,...this.getLayerSourceFromParams(),...this.getVid(),...this.getStickerCnt(),...this.helper.textToImageParams,enter_position:p.position,video_type_id:o.template_id!==_.Ic?3:void 0,template_search_id:p.template_search_id,template_source_tab_name:p.template_tab_name,is_rich_text:this.helper.isRichText?1:0,is_smart_tool:0};return(0,d.EL)(g),g}}!function(e){e.SHOW="show",e.EXPORT="export",e.CANCEL="cancel",e.CLOSE="close",e.SUBMIT_TEMPLATE="submit_template"}(o||(o={}));class y extends n.C{constructor(e){super(),this.eventName="click_exportwindow_option";const{name:t,actionType:i,format:a,resolution:r,scale:s,pageId:o,pageCount:n,quality:c,transparentBackground:l,compressPNG:d,flattenPDF:u}=e;this.draftName=t,this.actionType=i,this.format=a,this.resolution=r,this.scale=s,this.pageId=o,this.pageCount=n,this.quality=c,this.transparentBackground=l,this.compressPNG=d,this.flattenPDF=u}getEventParams(){const e=(0,l.gO)(),t={action_type:this.actionType,draft_name:this.draftName,format:this.format,scale:this.scale,resolution:this.resolution,edittype:"picture_edit",original_edittype:"picture_edit",page_cnt:this.pageCount,page_id:this.pageId,quality:this.quality,transparent_bkg:this.transparentBackground,compress_png:this.compressPNG,flatten_pdf:this.flattenPDF,video_type_id:e.video_type_id};(0,d.EL)(t);const i=e.create_id;return i&&(t.template_id=i),t}}class I extends y{constructor(e){super({actionType:e?o.SHOW:o.CLOSE})}}class w extends y{constructor(e){super({actionType:o.EXPORT,...e})}}class S extends y{constructor(e){super({actionType:o.SUBMIT_TEMPLATE,...e})}}const b=(e,t,i)=>{const a=n.I.getInstance().createContext(u.ry),{width:r,height:s}=e||{};a.isCustom=t,a.resizeCanvas=t?_.iW.MANUAL:`${r}*${s}`,a.resizeType=i?_.iW.AUTO_RESIZE:_.iW.NORMAL_RESIZE};class C{constructor(e){this._storageService=e}_getData(){const e=this._storageService.keyValue.queryAndParse(C.USE_THEME_CARD_RECORD_STORAGE_KEY,JSON.parse);return e.ok&&e.value?e.value:{}}_getDataByPageId(e){var t;return null!==(t=this._getData()[e])&&void 0!==t?t:{useDesignCard:s.NoUse,useTemplateThemeCard:s.NoUse}}_setDataByPageId(e,t){const i=this._getData();i[e]=t,this._storageService.keyValue.set(C.USE_THEME_CARD_RECORD_STORAGE_KEY,JSON.stringify(i))}getData(e){return this._getDataByPageId(e)}useDesignCard(e,t){const i=this._getDataByPageId(e);i.useDesignCard!==t&&(i.useDesignCard=i.useDesignCard+t>s.Theme?s.Theme:i.useDesignCard+t,i.useDesignCard===i.useTemplateThemeCard&&(i.useTemplateThemeCard=s.NoUse),i.useDesignCard+i.useTemplateThemeCard>s.Theme&&(i.useTemplateThemeCard=Math.max(i.useTemplateThemeCard-i.useDesignCard,s.NoUse)),this._setDataByPageId(e,i))}useTemplateThemeCard(e,t){const i=this._getDataByPageId(e);i.useTemplateThemeCard!==t&&(i.useTemplateThemeCard=i.useTemplateThemeCard+t>s.Theme?s.Theme:i.useTemplateThemeCard+t,i.useDesignCard===i.useTemplateThemeCard&&(i.useDesignCard=s.NoUse),i.useDesignCard+i.useTemplateThemeCard>s.Theme&&(i.useDesignCard=Math.max(i.useDesignCard-i.useTemplateThemeCard,s.NoUse)),this._setDataByPageId(e,i))}}function E(e){const{ids:t,name:i,format:a,resolutions:r,scale:s,pageCount:o,quality:n,transparentBackground:c,compressPNG:l,flattenPDF:d,pictureIds:u,editor:h}=e,p=r.map((e=>{var t;return null==e||null===(t=e.trim())||void 0===t?void 0:t.replace(/[()]/g,"")})),g=new Array(t.length).fill(s),_=new Array(t.length).fill(a);new w({pageId:t.join(","),name:i,format:_.join(","),resolution:p.join(","),scale:g.join(","),pageCount:o,quality:n,transparentBackground:c,compressPNG:l,flattenPDF:d}).report(),t.forEach(((e,t)=>{const a=u[t],r=new C(h.getDependence().storageService).getData(e);new m(e,a,i,_[t],p[t],g[t],n,c,l,d,r.useDesignCard,r.useTemplateThemeCard).report()}))}var k;C.USE_THEME_CARD_RECORD_STORAGE_KEY="USE_THEME_CARD_RECORD_STORAGE_KEY",function(e){e.SHOW="show",e.BACK="back",e.DOWNLOAD="download",e.FB_PAGES="fb_pages",e.FB_GROUP="fb_group",e.INS="ins",e.EXPORT="export"}(k||(k={}));class T extends n.C{constructor(e){super(),this.eventName="click_sharewindow_option";const{draftId:t,name:i,actionType:a,format:r,resolution:s,scale:o,pageId:n,pageCount:c,quality:l,transparentBackground:d,compressPNG:u,flattenPDF:h}=e;this.draftId=t,this.draftName=i,this.actionType=a,this.format=r,this.resolution=s,this.scale=o,this.pageId=n,this.pageCount=c,this.quality=l,this.transparentBackground=d,this.compressPNG=u,this.flattenPDF=h}getEventParams(){return{action_type:this.actionType,draft_id:this.draftId,draft_name:this.draftName,format:this.format,scale:this.scale,resolution:this.resolution,edittype:"picture_edit",original_edittype:"picture_edit",is_smart_tool:0,page_cnt:this.pageCount,page_id:this.pageId,quality:this.quality,transparent_bkg:this.transparentBackground,compress_png:this.compressPNG,flatten_pdf:this.flattenPDF}}}function P(e){const{renderSDK:t,ids:i,name:a,format:r,resolutions:s,scale:o,pageCount:n,quality:c,transparentBackground:l,compressPNG:d,flattenPDF:u,pictureIds:h}=e,p=s.map((e=>{var t;return null==e||null===(t=e.trim())||void 0===t?void 0:t.replace(/[()]/g,"")})),g=new Array(i.length).fill(o),_=new Array(i.length).fill(r);new T({draftId:t.model.meta.draftId,actionType:k.EXPORT,pageId:i.join(","),name:a,format:_.join(","),resolution:p.join(","),scale:g.join(","),pageCount:n,quality:c,transparentBackground:l,compressPNG:d,flattenPDF:u}).report(),i.forEach(((e,t)=>{const i=h[t];new m(e,i,a,_[t],p[t],g[t],c,l,d,u).report()}))}function D(e,t,i){new T({actionType:e,draftId:t,name:i}).report()}function x(e,t,i,a,r){var s;const o=null==i||null===(s=i.trim())||void 0===s?void 0:s.replace(/[()]/g,"");new S({pageId:`${Date.now().toString()}`,name:e,format:t,resolution:o,scale:a,pageCount:r}).report()}},4059:(e,t,i)=>{i.d(t,{G:()=>d});var a=i(8757),r=i(37722),s=i(68967),o=i(92204),n=i(67219),c=i(18250),l=i(19426);class d extends r.C{constructor(e,t,i,a="picture_edit",r="picture_edit",s){super(),this.eventName="export_status",this.startTime=Date.now(),this.cost=0,this.templateId=o.Ic,this.pictureId=t,this._currentPage=a,this._originalEditType=r,this._videoId=s,this._format=i,this._helper=(0,l.Wb)(e)}setDownloadFinish(){this.cost=Date.now()-this.startTime,this.isSuccess=!0}setTemplateIdByPageId(e){var t;const i=(null!==(t=(0,n.B6)([e]))&&void 0!==t?t:[]).map((e=>{var t;return null===(t=e.extra)||void 0===t?void 0:t.sourceInfo})).filter(Boolean),r=[...new Set(i.filter((e=>e.from===a.yU.Template)).map((e=>e.templateId)).filter(Boolean))];r.length>0&&(this.templateId=r.join(","))}setCost(e){this.cost=e}setPictureId(e){this.pictureId=e}setDownloadFail(){this.isSuccess=!1}getCustomInfo(){const e=r.I.getInstance().getContext(a.K6);return null!=e&&e.serverReport?JSON.stringify(null==e?void 0:e.serverReport):void 0}getMaterialTemplateCnt(e){var t;return null!==(t=this._helper.templateMaterial.get(e))&&void 0!==t?t:0}getEventParams(){var e,t;const i=r.I.getInstance().getContext(a.K6),c=null!==(e=null==i?void 0:i.draftId)&&void 0!==e?e:o.Ic,l={status:this.isSuccess?"success":"fail",format:this._format,picture_id:this.pictureId,export_type:"picture_edit",original_edittype:this._originalEditType,edittype:"picture_edit",export_time:String(this.cost),text_cnt:this.getMaterialTemplateCnt(a.F5.TEXT)+this._helper.customTextCnt+this._helper.textTemplate.size,draft_id:c,scenario:null!==(t=(0,s.gO)().scenario)&&void 0!==t?t:null==i?void 0:i.modelApi.document.getDocumentMeta().scenario,current_page:this._currentPage,video_id:this._videoId,template_id:this.templateId,is_smart_tool:0,...this._getPwaParams()};return(0,n.EL)(l),l}_getPwaParams(){return{is_pwa:null!==c.tc&&void 0!==c.tc&&(0,c.tc)()?1:0,open_from_pwa:null!==c.XX&&void 0!==c.XX&&(0,c.XX)()?1:0,pwa_from:null===c.MY||void 0===c.MY?void 0:(0,c.MY)()}}}},98996:(e,t,i)=>{i.d(t,{d:()=>s});var a=i(37722);class r extends a.C{constructor(e){super(),this._params=e,this.eventName="import_image_upload"}getEventParams(){return{current_page:this._params.currentPage,format:this._params.format,size:this._params.size,position:this._params.position}}}const s=e=>{new r(e).report()}},4547:(e,t,i)=>{i.d(t,{JG:()=>d,Kp:()=>o,Rz:()=>a,lJ:()=>r,wf:()=>s});var a,r,s,o,n=i(37722),c=i(67986),l=i(92204);!function(e){e.MATERIAL_LIB="material_lib",e.MATERIAL="material",e.CANVAS="canvas",e.PHONE_UPLOADED="phone_uploaded",e.BROWER_OUTSIDE="brower_outside",e.COMPONENT="component",e.UPLOAD_IMAGE="upload_image"}(a||(a={})),function(e){e.CLICK_ADD="click_add",e.DRAG_TO_PANEL="drag_to_panel",e.DRAG_TO_CANVAS="drag_to_canvas",e.PASTE="paste",e.CLICK_COMPONENT="click_component"}(r||(r={})),function(e){e.LOCAL="local",e.DROPBOX="dropbox",e.GOOGLE_DRIVE="google_drive",e.MY_SPACE="my_space",e.LINK="link"}(s||(s={})),function(e){e.SUCCESS="success",e.FAIL="fail",e.CANCEL="cancel"}(o||(o={}));class d extends n.C{constructor(e){super(),this.eventName="import_material",this.materialSource=s.LOCAL,this.isFastImport=!1,this.isLogin=!0,this.materialType="photo",this.status=o.SUCCESS,Object.assign(this,e);const{material:t}=e;if(t){const{name:e,size:i=0,type:a,width:r,height:s}=t;this.materialName=e,this.materialFormat=a,this.materialSize=Math.floor(i/1024).toString(),r&&s&&(this.materialResolution=`${r}x${s}`)}e.failReason&&(this.status=o.FAIL),c.t.info("[tea:import_material]: ",this.getEventParams()),c.t.debug("[debug:tea:import_material]: ",this)}getEventParams(){var e,t,i,a,r,s,o,n,c,d,u;return{raw_space_type:this.rawSpaceType,space_type:this.spaceType,space_user_cnt:this.spaceUserCnt,space_id:null!==(e=this.spaceId)&&void 0!==e?e:l.Ic,material_resolution:null!==(t=this.materialResolution)&&void 0!==t?t:l.Ic,position:null!==(i=this.position)&&void 0!==i?i:l.Ic,material_source:null!==(a=this.materialSource)&&void 0!==a?a:l.Ic,is_fast_import:Number(this.isFastImport),is_login:Number(this.isLogin),fail_reason:this.failReason,import_time:null!==(r=this.importTime)&&void 0!==r?r:l.Ic,material_format:null!==(s=this.materialFormat)&&void 0!==s?s:l.Ic,material_size:null!==(o=this.materialSize)&&void 0!==o?o:l.Ic,material_type:null!==(n=this.materialType)&&void 0!==n?n:l.Ic,material_name:null!==(c=this.materialName)&&void 0!==c?c:l.Ic,status:null!==(d=this.status)&&void 0!==d?d:l.Ic,action_type:null!==(u=this.actionType)&&void 0!==u?u:l.Ic,tool_type:this.toolType,current_page:this.currentPage,batch_type:this.batchType}}}},54282:(e,t,i)=>{i.d(t,{Cj:()=>n});var a,r=i(37722),s=i(92204);!function(e){e.showAllClick="show_all_click",e.hideLayerPanel="hide_layer_panel"}(a||(a={}));class o{constructor(){this.eventName="layer_action"}setAction(e){this.action=e}setActionType(e){this.action_type=e}setPageIndex(e){this.page_no=e+1}getEventParams(){return{action:this.action,action_type:this.action_type,page_no:this.page_no,current_page:"picture_edit"}}}const n=(e,t)=>{const i=new o;i.setAction(t?a.showAllClick:a.hideLayerPanel),i.setActionType(s.l5.Click),i.setPageIndex(e),(e=>{r.I.getInstance().reportEvent(e)})(i)}},27385:(e,t,i)=>{i.d(t,{D_:()=>l,Jm:()=>s,LI:()=>o,bk:()=>n,yD:()=>c});var a=i(37722);class r{constructor(e,t,i,a){this.eventName=e,this.toolType=t,this.id=i,this.duration=a}getEventParams(){return{tool_type:this.toolType,id:this.id,duration:this.duration}}}function s(e,t,i){const s=new r("lv_ai_crop",e,t,i);a.I.getInstance().reportEvent(s)}function o(e,t,i){const s=new r("lv_ai_generate",e,t,i);a.I.getInstance().reportEvent(s)}function n(e,t,i){const s=new r("lv_ai_sync",e,t,i);a.I.getInstance().reportEvent(s)}function c(e,t,i){const s=new r("lv_ai_render",e,t,i);a.I.getInstance().reportEvent(s)}function l(e,t,i){const s=new r("lv_ai_upload_component",e,t,i);a.I.getInstance().reportEvent(s)}},888:(e,t,i)=>{i.d(t,{BV:()=>f,Ds:()=>a,Od:()=>b,Ys:()=>m,hK:()=>v,nE:()=>y,qc:()=>_,tC:()=>w,yx:()=>S});var a,r,s=i(69578),o=i(92204),n=i(54714),c=i(82440),l=i(37722),d=i(68967),u=i(8091),h=i(8757),p=i(25222);!function(e){e.MATERIAL="material",e.MATERIAL_LIB="material_lib",e.CANVAS="canvas"}(a||(a={})),function(e){e.SUCCESS="success",e.FAIL="fail"}(r||(r={}));class g extends l.C{constructor({category:e,subCategory:t,thirdCategory:i,addFrom:a,actionType:r,materialId:n,materialName:c,resolution:d,state:u,forthCategoryId:p,forthCategory:g,rank:_,is_from_capcut:f,optionType:v,pageNo:m,toolType:y,stickerCategory:I,isAddedPage:w}){var S;super(),this.eventName="add_material_to_canvas",this.scene=o.YR.Category,this.rank=0;const b=null===(S=l.I.getInstance().getContext(h.K6))||void 0===S?void 0:S.editorType;this.category=e,this.subCategory=t,this.thirdCategory=i,this.addFrom=a,this.actionType=r,this.materialId=null!=n?n:"-1",this.materialName=null!=c?c:o.Ic,this.resolution=null!=d?d:"",this.forthCategoryId=p,this.forthCategory=g,this.state=u,this.is_from_capcut=f,this.optionType=null!=v?v:s.zf.ADD,this.pageNo=m,this.stickerCategory=I,this.toolType=y,this.isAddedPage=w,this.isBatchProcess=b===h.ot.BatchEditor?1:0,"number"==typeof _&&(this.rank=_)}getEventParams(){var e,t,i,a,r,s,c,l;const d={current_page:"picture_edit",material_name:this.materialName,material_id:this.materialId,action_type:this.actionType,is_from_capcut:this.actionType===n.$u.OuterPaste?this.is_from_capcut:void 0,material_category:this.category,material_subcategory:null!==(e=this.subCategory)&&void 0!==e?e:o.Ic,material_thirdcategory:null!==(t=this.thirdCategory)&&void 0!==t?t:o.Ic,resolution:this.resolution,status:this.state,add_from:this.addFrom,material_subcategory_id:null!==(i=this.subCategory)&&void 0!==i?i:o.Ic,material_thirdcategory_id:null!==(a=this.thirdCategoryId)&&void 0!==a?a:o.Ic,material_forthcategory:null!==(r=this.forthCategory)&&void 0!==r?r:o.Ic,material_forthcategory_id:null!==(s=this.forthCategoryId)&&void 0!==s?s:o.Ic,is_multilayer_frame:null!==(c=this.isMultilayerFrame)&&void 0!==c?c:0,is_batch_process:this.isBatchProcess,grid_cnt:null!==(l=this.gridCnt)&&void 0!==l?l:0,scene:this.scene,rank:this.rank,option_type:this.optionType,page_no:this.pageNo,tool_type:this.toolType,sticker_category:this.stickerCategory,is_added_page:this.isAddedPage,material_channel:this.materialChannel};return this.scene===o.YR.Search&&Object.assign(d,{search_id:this.searchId,search_keyword:this.searchKeyword,keyword_source:this.keywordSource,word_position:this.wordPosition}),d}}class _ extends g{constructor(e,t,i,c){const{sourceFrom:l,id:u,searchId:h,name:g,extraParams:_,rank:f}=e,v="search"===l;super({category:o.c8.TEMPLATE,subCategory:o.Ic,thirdCategory:v?o.Ic:l,materialId:u,materialName:g,actionType:t===n.$u.ClickEvent?s.gF.CLICK:s.gF.DRAG,state:i?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:a.MATERIAL,rank:e.index,pageNo:c}),this.scene=v?o.YR.Search:o.YR.Category,this.rank=f,v&&(this.searchId=h,this.searchKeyword=null==_?void 0:_.searchKeyword,this.keywordSource=null==_?void 0:_.keywordSource,this.wordPosition=null==_?void 0:_.wordPosition);const m=(0,d.gO)().editorType;[p.gg.EditorPC,p.gg.EditorWeb].includes(m)&&(this.thirdCategory="video_cover_template",this.materialChannel=null==_?void 0:_.currentTagName)}}class f extends g{constructor(e,t,i,c,l,d){const{id:u}=e;super({category:o.c8.Apps,subCategory:o.Ic,thirdCategory:"search",materialId:u,actionType:t===n.$u.ClickEvent?s.gF.CLICK:s.gF.DRAG,state:i?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:a.MATERIAL,rank:e.index+1,pageNo:c,toolType:l,isAddedPage:d}),this.scene=o.YR.Category}}class v extends g{constructor(e,t,i,n,l,d=a.MATERIAL_LIB,h,p,g,_,f,v){var m,y;if(super({category:null!=g?g:o.c8.UPLOAD,subCategory:_||(e?"space"===e.sourceFrom?"cloud":"project":o.Ic),thirdCategory:f,materialId:null!==(m=null==e?void 0:e.id)&&void 0!==m?m:o.Ic,materialName:null!==(y=null==e?void 0:e.name)&&void 0!==y?y:o.Ic,actionType:t||s.gF.DRAG,state:i?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:d,rank:null==e?void 0:e.index,optionType:h,is_from_capcut:p?1:0,pageNo:l,toolType:v}),n&&e){var I;const t=null===(I=c.fc.getDependency(e.md5))||void 0===I?void 0:I.transcode;if(t){const e=(0,u.I)(null!=t?t:{},n);this.resolution=`${null==e?void 0:e.width}x${null==e?void 0:e.height}`}}}}class m extends g{constructor(e,t,i,n,c,l){var d;super({category:e,thirdCategory:t.sourceFrom,materialId:t.resourceId,materialName:t.name,actionType:null!=i?i:s.gF.DRAG,state:n?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:a.MATERIAL,forthCategoryId:t.albumId,forthCategory:t.albumName,rank:t.index,is_from_capcut:l?1:0,pageNo:c,stickerCategory:e===o.c8.STICKER?(null===(d=t.sdkExtra)||void 0===d?void 0:d.type)===h.zX.SvgSticker?s.ql.Svg:s.ql.Png:void 0})}}class y extends g{constructor(e){super({category:o.c8.PHOTO,thirdCategory:e.thirdCategory,materialId:e.materialId,materialName:e.materialName,actionType:e.actionType,state:e.isSuccess?r.SUCCESS:r.FAIL,rank:e.rank,optionType:e.optionType,pageNo:e.pageNo}),this.searchId=e.searchId,this.searchKeyword=e.searchKeyword,this.keywordSource=e.keywordSource,this.wordPosition=e.wordPosition,this.scene=e.searchKeyword?o.YR.Search:o.YR.Category}}class I extends g{constructor(e){super({category:o.c8.DESIGN,addFrom:a.MATERIAL,state:e.status?r.SUCCESS:r.FAIL,...e})}}function w(e){new I(e).report()}class S extends g{constructor(e,t,i,n,c){super({category:o.c8.FRAME,thirdCategory:e.sourceFrom,materialId:e.resourceId,materialName:e.name,actionType:null!=t?t:s.gF.DRAG,state:i?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:a.MATERIAL,forthCategoryId:e.albumId,forthCategory:e.albumName,rank:e.index,is_from_capcut:c?1:0,pageNo:n}),this.isMultilayerFrame=e.isMultilayerFrame?1:0}}class b extends g{constructor(e,t,i,n,c){super({category:o.c8.GRID,thirdCategory:e.sourceFrom,materialId:e.resourceId,materialName:e.name,actionType:null!=t?t:s.gF.DRAG,state:i?r.SUCCESS:r.FAIL,resolution:o.Ic,addFrom:a.MATERIAL,forthCategoryId:e.albumId,forthCategory:e.albumName,rank:e.index,is_from_capcut:c?1:0,pageNo:n}),this.gridCnt=e.gridCnt}}},35113:(e,t,i)=>{i.d(t,{B$:()=>b,If:()=>v,Lt:()=>S,M4:()=>C,VO:()=>k,c_:()=>E,lU:()=>y,lr:()=>T,nl:()=>f,oM:()=>w,oT:()=>m,pM:()=>I});var a=i(8757),r=i(37722),s=i(41658),o=i(91372),n=i(60110),c=i(92204),l=i(67219),d=i(11005),u=i(17960),h=i(54282),p=i(69578);class g{constructor(){this.eventName="material_normal_edit"}setMaterialType(e){if(e&&(this.material_type=e,e===c._m.Stickers)){var t;const e=r.I.getInstance().getContext(a.pI),i=(null==e||null===(t=e.layerIds)||void 0===t?void 0:t.length)&&(0,l.tS)(e.layerIds[0]);i&&(i.type===a.F5.SVG_IMAGE?this.stickerCategory=p.ql.Svg:this.stickerCategory=p.ql.Png)}}setAction(e){this.action=e}setActionType(e){this.action_type=e}setPageIndex(e){this.page_no=e+1}setPositionType(e){this.position=e}getEventParams(){return{material_type:this.material_type,action:this.action,action_type:this.action_type,page_no:this.page_no,position:this.position,sticker_category:this.stickerCategory}}}const _=e=>{r.I.getInstance().reportEvent(e)},f=(e,t,i)=>{const a=new g;a.setMaterialType(c._m.Multi),a.setAction(e),a.setActionType(t),a.setPageIndex(i),_(a)},v=(e,t,i)=>{var s;const o=r.I.getInstance().getContext(a.pI),n=(0,l.ee)(null!==(s=null==o?void 0:o.layerIds)&&void 0!==s?s:[]),c=new g;c.setMaterialType(n),c.setAction(e),c.setActionType(t),c.setPageIndex(i),_(c)},m=(e,t,i)=>{const a=new g,r=(0,l.ee)(e);a.setMaterialType(r),a.setAction(c.B$.MOVE),a.setActionType(t),a.setPageIndex(i),_(a)},y=(e,t,i)=>{const a=new g,r=(0,l.ee)(e);a.setMaterialType(r),a.setAction(t),a.setActionType(c.l5.FunctionPanelClick),a.setPageIndex(i),_(a)},I=(e,t,i)=>{const a=r.I.getInstance(),o=new g;o.setPageIndex(i),o.setMaterialType(c._m.Line),o.setActionType(c.l5.Click),(0,s.d)(e[0],t[0],["rotation"],c.aC)&&(o.setAction(c.B$.ROTATE),a.reportEvent(o)),(0,s.d)(e[0],t[0],["scale"],c.aC)&&(o.setAction(c.B$.RESIZE),a.reportEvent(o))},w=(e,t,i,a,r,o)=>{if(r!==d.Z2.dragend&&r!==d.Z2.transformend)return;const n=new g,[u]=t,[h]=i;if(u&&h){if((0,s.d)(u,h,["x","y"],c.aC)&&n.setAction(c.B$.MOVE),(0,s.d)(u,h,["rotation"],c.aC)?n.setAction(c.B$.ROTATE):(0,s.d)(u,h,["scale","width","height"],c.aC)&&n.setAction(c.B$.RESIZE),t.length>1)n.setMaterialType(c._m.Multi);else{const t=(0,l.ee)([e]);n.setMaterialType(t)}n.setPageIndex(o),n.setActionType(a),_(n)}},S=(e,t,i)=>{const a=new g;a.setAction(c.B$.ADJUST),a.setActionType(i);const r=(0,l.ee)([e]);a.setMaterialType(r===c._m.Page?c._m.BackgroundPhoto:r),a.setPageIndex(t),_(a)},b=(e,t,i,a)=>{const r=new g;r.setAction(t),r.setActionType(i);const s=(0,l.ee)([e]);r.setMaterialType(s),r.setPageIndex(a),_(r)},C=(e,t)=>{const i=new g;i.setAction(c.B$.SORT_LAYERS),i.setActionType(c.l5.FunctionPanelClick);const a=(0,l.ee)(e);i.setMaterialType(a),i.setPageIndex(t),i.setPositionType(c.d.FunctionBar),_(i)},E=(e,t,i,a,r)=>{const s=new g;s.setAction(t),s.setActionType(i);const o=(0,l.ee)(e);s.setMaterialType(o),s.setPageIndex(a),r&&s.setPositionType(r),_(s)},k=(e,t)=>{var i;const s=new g,o=r.I.getInstance().getContext(a.pI),n=(0,l.ee)(null!==(i=null==o?void 0:o.layerIds)&&void 0!==i?i:[]);s.setMaterialType(n),s.setAction(c.B$.RIGHT_CLICK),s.setActionType(c.l5.RightClick),s.setPageIndex(e),s.setPositionType(t),_(s)},T=(e,t,i,s)=>{var d,p,f,v;const m=e.accessors.page.getActivePageIndex(),y=new g,I=r.I.getInstance().getContext(a.pI),w=(0,l.ee)(null!==(d=null==I?void 0:I.layerIds)&&void 0!==d?d:[]),S=(0,l.tY)(t,s,w,null!==(p=null==I?void 0:I.layerIds)&&void 0!==p?p:[]);if(((e,t,i,a)=>{if(i!==c._m.Page||a!==c.B$.DELETE||!t)return!1;const{accessors:r}=e,s=r.page.hasBackgroundImage(t),l=r.page.getBackgroundColor(t),d=l&&(0,o.aj)(l,n.GL);return!(!s&&!d)})(e,null==I||null===(f=I.layerIds)||void 0===f?void 0:f[0],w,S))return;if(!S)return;let b;if(S===c.B$.SELECT_LAYER){if(s===u.m)return void(0,h.Cj)(m,!0);b=(0,l.ee)([String(s)])}y.setMaterialType(null!==(v=b)&&void 0!==v?v:w),y.setAction(S),y.setActionType(c.l5.RightClick),y.setPageIndex(m),y.setPositionType(i),_(y)}},56333:(e,t,i)=>{i.d(t,{$6:()=>m,Nv:()=>N,PC:()=>E,QK:()=>R,Rt:()=>U,U2:()=>O,U6:()=>y,W_:()=>L,Xk:()=>S,ZN:()=>B,_B:()=>A,_i:()=>j,_s:()=>x,ah:()=>M,dS:()=>I,f$:()=>a,g1:()=>C,hk:()=>T,mO:()=>f,qw:()=>P,r4:()=>F,y5:()=>D,yw:()=>g,z2:()=>b,zl:()=>w,zr:()=>_});var a,r=i(8757),s=i(92204),o=i(37722),n=i(24657),c=i(67986),l=i(67219),d=i(75318),u=i(78101),h=i(69578);!function(e){e.ChangeTextFont="change_textfont",e.ChangeTextSize="change_textsize",e.ChangeTextColor="change_textcolor",e.TextBold="textbold",e.CancelTextBold="cancel_textbold",e.Italic="italic",e.CancelItalic="cancel_italic",e.Underline="underline",e.CancelUnderline="cancel_underline",e.Uppercase="uppercase",e.CancelUppercase="cancel_uppercase",e.ClickAlign="click_align",e.AlignLeft="align_left",e.AlignCenter="align_center",e.AlignRight="align_right",e.ClickSpacing="click_spacing",e.LetterSpacing="letter_spacing",e.LineSpacing="line_spacing",e.ClickEditMore="click_edit_more",e.ClickBackground="click_background",e.CancelBackground="cancel_background",e.BackgroundOpacity="background_opacity",e.BackgroundCornerRadius="background_cornerradius",e.BackgroundColor="background_color",e.EnterBackgroundColor="enter_background_color",e.ClickShadow="click_shadow",e.CancelShadow="cancel_shadow",e.ShadowOpacity="shadow_opacity",e.ShadowBlur="shadow_blur",e.ShadowDistance="shadow_distance",e.ShadowAngle="shadow_angle",e.ShadowColor="shadow_color",e.EnterShadowColor="enter_shadow_color",e.ClickOutline="click_outline",e.CancelOutline="cancel_outline",e.OutlineWidth="outline_width",e.OutlineColor="outline_color",e.EnterOutlineColor="enter_outline_color",e.ClickGlow="click_glow",e.CancelGlow="cancel_glow",e.GlowColor="glow_color",e.EnterGlowColor="enter_glow_color",e.GlowIntensity="glow_intensity",e.GlowRange="glow_range",e.ClickCurve="click_curve",e.CancelCurve="cancel_curve",e.Curve="curve"}(a||(a={}));const p=[a.ChangeTextFont,a.ChangeTextSize,a.ChangeTextColor,a.TextBold,a.CancelTextBold,a.Italic,a.CancelItalic,a.Underline,a.CancelUnderline,a.ClickShadow,a.CancelShadow,a.ShadowOpacity,a.ShadowBlur,a.ShadowDistance,a.ShadowAngle,a.ShadowColor,a.EnterShadowColor,a.ClickOutline,a.CancelOutline,a.OutlineWidth,a.OutlineColor,a.EnterOutlineColor];var g,_,f,v,m,y,I,w,S,b,C,E;!function(e){e.ClickAdjust="click_adjust",e.ClickFilter="click_filter",e.SelectFilter="select_filter",e.AdjustFilter="adjust_filter",e.ClearFilter="clear_filter",e.ClickEffect="click_effect",e.SelectEffect="select_effect",e.AdjustEffect="adjust_effect",e.ClearEffect="clear_effect",e.AdjustBrightness="adjust_brightness",e.AdjustContrast="adjust_contrast",e.AdjustSaturation="adjust_saturation",e.AdjustExposure="adjust_exposure",e.AdjustHighlight="adjust_highlight",e.AdjustTemperature="adjust_temperature",e.AdjustTint="adjust_tint",e.AdjustVibrance="adjust_vibrance",e.AdjustLight="adjust_light",e.AdjustShadows="adjust_shadows",e.AdjustFade="adjust_fade",e.AdjustTexture="adjust_texture",e.AdjustParticles="adjust_particles",e.ClickCrop="click_crop",e.DoubleClickCrop="double_click_crop",e.ClickReplace="click_replace",e.SelectFromComputer="select_from_computer",e.SelectFromVideo="select_from_video",e.ClickAutoCrop="click_auto_crop",e.ApplyAutoCrop="apply_auto_crop",e.ApplyCrop="apply_crop"}(g||(g={})),function(e){e.ColorFill="color_fill",e.SelectColorLayer="select_layer_color",e.ApplyColorPalette="apply_color_palette",e.ClickShuffle="click_shuffle",e.ResetColor="reset_color"}(_||(_={})),function(e){e.clickImageGeneratorBanner="click_image_generator_banner",e.clickImageGeneratorClose="click_image_generator_close",e.clickImageGenerator="click_image_generator",e.clickUploadImage="click_upload_mage",e.selectStyle="select_style",e.selectRatio="select_ratio",e.wordPromptWeight="word_prompt_weight",e.scale="scale",e.clickGenerate="click_generate",e.clickGenerateCancel="click_generate_cancel",e.clickTryAgain="click_try_again",e.clickStartOver="click_start_over",e.clickGenerateSmilar="click_generate_smilar",e.clickDownload="click_download"}(f||(f={})),function(e){e.ColorFill="color_fill",e.LineStyle="line_style",e.BorderColor="border_color",e.BorderStyle="border_style"}(v||(v={})),function(e){e.Group="group",e.Ungroup="ungroup"}(m||(m={})),function(e){e.ClickCutout="click_cutout",e.CutoutOn="cutout_on",e.CutoutOff="cutout_off",e.CutoutTabClick="cutout_cutout_tab_click",e.CutoutBackgroundTabClick="cutout_background_tab_click",e.CutoutBackgroundClick="cutout_background_click"}(y||(y={})),function(e){e.custom="custom",e.original="original",e.oneOne="1:1",e.nineSixteen="9:16",e.sixteenNine="16:9",e.fourThree="4:3",e.threeOne="3:1"}(I||(I={})),function(e){e.ClickColorScheme="click_color_scheme",e.GenerateColor="generate_color",e.ResetColor="reset_color",e.ClickColorPicker="click_color_picker",e.SelectColor="select_color"}(w||(w={})),function(e){e.ClickEdgeStyle="click_edge_style",e.ClickEdgeStyleReset="click_edge_style_reset",e.ChooseEdgeStyle="choose_edge_style",e.ClickShadow="click_picture_effect_shadow",e.ClickOutline="click_picture_effect_stroke",e.ClickGlow="click_picture_effect_glow",e.ClickFeather="click_picture_effect_feather",e.CancelShadow="cancel_picture_effect_shadow",e.CancelOutline="cancel_picture_effect_stroke",e.CancelGlow="cancel_picture_effect_glow",e.CancelFeather="cancel_picture_effect_feather",e.EnterShadowColor="enter_picture_effect_shadow_color",e.EnterOutlineColor="enter_picture_effect_stroke_color",e.EnterGlowColor="enter_picture_effect_glow_color",e.EditShadowColor="picture_effect_shadow_color",e.EditOutlineColor="picture_effect_stroke_color",e.EditGlowColor="picture_effect_glow_color",e.AdjustShadow="adjust_picture_effect_shadow",e.AdjustOutline="adjust_picture_effect_stroke",e.AdjustGlow="adjust_picture_effect_glow",e.AdjustFeather="adjust_picture_effect_feather"}(S||(S={})),function(e){e.ClickSmartTools="click_smart_tools",e.ImageUpscaler="image_upscaler",e.SelectAiResolution="select_ai_resolution",e.OldRestoration="old_restoration",e.SelectAiRestoration="select_ai_restoration",e.LowLightImageEnhancer="low_light_image_enhancer",e.SelectAiIntensity="select_ai_intensity",e.ImageStyleTransfer="image_style_transfer",e.ClickImageStyle="click_image_style",e.SelectImageStyle="select_image_style",e.ClickPortraitStyle="click_portrait_style",e.SelectPortraitStyle="select_portrait_style",e.AiColorCorrectionOn="ai_color_correction_on",e.AiColorCorrectionOff="ai_color_correction_off",e.AdjustAiColorIntensity="adjust_ai_color_intensity"}(b||(b={})),function(e){e.AdjustGridCorner="adjust_grid_corner",e.AdjustGridSpacingPreset="adjust_grid_spacing_preset",e.AdjustGridSpacingCustom="adjust_grid_spacing_custom"}(C||(C={})),function(e){e.All="all",e.Document="document",e.recommend="recommend"}(E||(E={}));class k{constructor(e){if(this.eventName="material_special_edit",this.materialType=e.materialType,this.actionType=e.type,this.action=e.action,this.background_id=e.backgroundId,this.background_name=e.backgroundName,this.material_id=e.materialId,this.material_name=e.materialName,this.crop_size=e.cropSize,this.font_category=e.fontCategory,this.page_no=e.pageIndex+1,this.value=e.value,this.isRichText=e.isRichText,this.rank=e.rank,this.font_id=e.fontId,this.font_name=e.fontName,this.font_label=e.fontLabel,e.materialType===s._m.Stickers){var t;const e=o.I.getInstance().getContext(r.pI),i=(null==e||null===(t=e.layerIds)||void 0===t?void 0:t.length)&&(0,l.tS)(e.layerIds[0]);i&&(i.type===r.F5.SVG_IMAGE?this.stickerCategory=h.ql.Svg:this.stickerCategory=h.ql.Png)}}getEventParams(){var e,t;return{material_type:this.materialType,action_type:this.actionType,action:this.action,material_id:this.material_id,material_name:this.material_name,background_id:null!==(e=this.background_id)&&void 0!==e?e:"none",background_name:null!==(t=this.background_name)&&void 0!==t?t:"none",crop_size:this.crop_size,font_category:this.font_category,value:this.value,page_no:this.page_no,sticker_category:this.stickerCategory,is_rich_text:this.isRichText?1:0,rank:this.rank,font_id:this.font_id,font_name:this.font_name,font_label:this.font_label}}}const T=(e,t,i)=>{var a;const r=new k({materialType:s._m.Text,action:e,pageIndex:null!==(a=null==i?void 0:i.pageIndex)&&void 0!==a?a:0,type:t,fontCategory:null==i?void 0:i.fontCategory,isRichText:(null==i?void 0:i.range)&&p.includes(e),fontId:null==i?void 0:i.fontId,fontName:null==i?void 0:i.fontName,fontLabel:null==i?void 0:i.fontLabel,rank:null==i?void 0:i.rank});o.I.getInstance().reportEvent(r)};function P(e,t){T(e,s.l5.Click,t)}function D(e,t){const{isHotkeys:i,pageIndex:r,range:o}=t,c=i?s.l5.ShortKey:s.l5.Click,l={fontSize:a.ChangeTextSize,bold:e=>e?a.TextBold:a.CancelTextBold,italic:e=>e?a.Italic:a.CancelItalic,underline:e=>e?a.Underline:a.CancelUnderline,upperCase:e=>e?a.Uppercase:a.CancelUppercase,letterSpacing:a.LetterSpacing,lineHeight:a.LineSpacing,align:e=>{switch(e){case n.Z.center:return a.AlignCenter;case n.Z.left:return a.AlignLeft;default:return a.AlignRight}},background:e=>Object.keys(e).map((e=>({color:a.BackgroundColor,opacity:a.BackgroundOpacity,radius:a.BackgroundCornerRadius}[e]))),shadow:e=>Object.keys(e).map((e=>({color:a.ShadowColor,opacity:a.ShadowOpacity,blur:a.ShadowBlur,distance:a.ShadowDistance,angle:a.ShadowAngle}[e]))),outline:e=>Object.keys(e).map((e=>({color:a.OutlineColor,opacity:a.OutlineColor,width:a.OutlineWidth}[e]))),glow:e=>Object.keys(e).map((e=>({color:a.GlowColor,intensity:a.GlowIntensity,range:a.GlowRange}[e]))),curve:a.Curve};Object.keys(e).map((t=>({attrValue:e[t],action:l[t]}))).forEach((e=>{const{attrValue:t,action:i}=e;if(i)if("function"!=typeof i)T(i,c,{pageIndex:r,range:o});else{const e=i(t);(Array.isArray(e)?e:[e]).forEach((e=>{e&&T(e,c,{pageIndex:r,range:o})}))}}))}function x(e){var t;const{layerId:i,action:a,type:r,cropSize:n,materialId:d,materialName:u,pageIndex:h}=e;if(!(null!==(t=(0,l.tS)(i))&&void 0!==t?t:(0,l.B6)([i])))return void c.t.error("imageEditReport: layer not exist");const p=(0,l.ee)([i]);if(p){const e=new k({materialType:p===s._m.Page?s._m.BackgroundPhoto:p,action:a,pageIndex:h,type:r,materialId:d,materialName:u,cropSize:n});o.I.getInstance().reportEvent(e)}}function A(e,t,i,a){const n=(0,l.tS)(e);if(!n)return void c.t.error("svgImageEditReport: layer not exist");if(n.type!==r.F5.SVG_IMAGE)return;const d=new k({materialType:s._m.Stickers,action:t,pageIndex:a,type:i});o.I.getInstance().reportEvent(d)}function R(e,t,i,a){const r=(e,t)=>{const r=new k({materialType:e,action:t,pageIndex:a,type:i});o.I.getInstance().reportEvent(r)},n=(0,l.tS)(e);if(!n)return void c.t.error("shapeEditReport: layer not exist");const h=null==t?void 0:t.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`)).replace(/^\_/,"");return(0,d.g)(n)?r(s._m.Line,h===v.BorderStyle?v.LineStyle:h):(0,u.I)(n)?r(s._m.Polygon,h):void 0}function F(e,t,i,a){const r=(0,l.ee)(e);if(!r)return;const s=new k({materialType:r,action:t,pageIndex:a,type:i});o.I.getInstance().reportEvent(s)}function M(e,t,i,...a){var s;const n=o.I.getInstance().getContext(r.pI);if(null==n||null===(s=n.layerIds)||void 0===s||!s.length)return;const c=n.layerIds[0];(0,l.tS)(c)&&x({layerId:c,action:e,type:t,materialId:a[0],materialName:a[1],pageIndex:i})}function L(e,t,i,a,r,s){const n=new k({materialType:e,action:t,pageIndex:a,type:i,backgroundId:r,backgroundName:s});o.I.getInstance().reportEvent(n)}function O(e,t,i,a=s.l5.Click){let r=s._m.Stickers;switch(null==t?void 0:t.from){case"textTemplate":r=s._m.Text;break;case"template":r=s._m.Template}const n=new k({materialType:r,action:e,pageIndex:i,type:a});o.I.getInstance().reportEvent(n)}function U(e,t,i){const a=o.I.getInstance().getContext(r.pI),n=null==a?void 0:a.layerIds[0],c=(0,l.yW)(null!=n?n:""),d=new k({materialType:c?s._m.BackgroundPhoto:s._m.Picture,action:e,pageIndex:t,type:s.l5.Click,value:i});o.I.getInstance().reportEvent(d)}function N(e,t,i){const a=new k({materialType:s._m.Picture,action:e,pageIndex:t,type:s.l5.Click,value:i});o.I.getInstance().reportEvent(a)}const j=e=>{const{action:t,pageIndex:i,materialId:a,materialName:n}=e,c=o.I.getInstance().getContext(r.pI),d=null==c?void 0:c.layerIds[0],u=(0,l.yW)(null!=d?d:""),h=new k({materialType:u?s._m.BackgroundPhoto:s._m.Picture,action:t,pageIndex:i,type:s.l5.Click,materialId:a,materialName:n});o.I.getInstance().reportEvent(h)};function B(e){const{layerId:t,action:i,materialId:a,materialName:r,pageIndex:n}=e;if(!(0,l.tS)(t))return void c.t.error("gridEditReport: layer not exist");const d=new k({materialType:s._m.Grid,action:i,pageIndex:n,type:s.l5.Click,materialId:a,materialName:r});o.I.getInstance().reportEvent(d)}},9010:(e,t,i)=>{i.d(t,{$:()=>s,L:()=>a});var a,r=i(19413);!function(e){e.DOWNLOAD="download",e.COMPRESS="compress",e.CREATE_OFFLINE_STAGE="create_offline_stage",e.LOCAL_EXPORT="local_export",e.ORDER="order"}(a||(a={}));class s extends r._B{constructor(e,t,i,a){super(),this.name="export-download-cost",this._subStageCost={},this._downloadRatio="1x",this._downloadRatio=`${e}x`,this._qualityLabel=t,this._exportType=i,this._pageCount=a}setSubStageCosts(e){this._subStageCost=e}getExtraInfo(){return{...this._subStageCost,downloadRatio:this._downloadRatio,qualityLabel:this._qualityLabel,exportType:this._exportType,pageCount:this._pageCount}}}},56268:(e,t,i)=>{i.d(t,{x:()=>a,y:()=>s});var a,r=i(19413);!function(e){e.STICKER="material_sticker",e.TEXT="material_text",e.TEXT_TEMPLATE="material_text_template",e.EVER_IMAGE="material_ever_image",e.SHAPE="material_shape",e.FRAME="material_frame",e.GRID="material_grid",e.TEMPLATE="material_template",e.PHOTO="material_photo",e.DESIGN="material_design"}(a||(a={}));class s extends r._B{constructor(e){super(),this.name="material_render_cost",this.materialName=e}markDataDownloadEnd(){this._dataDownloadEndTime=Date.now()}markModelApplyEnd(){this._modelApplyEndTime=Date.now()}getExtraInfo(){return{material:this.materialName,dataReady:this._dataDownloadEndTime&&this.startTime?this._dataDownloadEndTime-this.startTime:-1,partialVisible:this._modelApplyEndTime&&this.startTime?this._modelApplyEndTime-this.startTime:this.duration}}}},19413:(e,t,i)=>{i.d(t,{_B:()=>n,uh:()=>o});var a=i(37722),r=i(67986);class s{constructor(){this.eventName="graphic_editor_perf",this.timeRecords={}}markStartTime(e=Date.now()){this.startTime=e}markEndTime(e=Date.now()){this.endTime=e}markEndTimeAndReport(e=Date.now()){this.markEndTime(e),this.report()}report(){const e=this.getEventParams();e&&(a.I.getInstance().reportEvent(this.eventName,e),a.I.getInstance().reportSlardarEvent(e.name,e))}get duration(){const{startTime:e,endTime:t}=this;return t&&e?t-e:(r.t.warn(`${this.eventName} ${this.name} need call markStartTime and markEndTime func`),-1)}getEventParams(){if(-1!==this.duration)return{name:this.name,startTime:this.startTime,duration:this.duration}}}class o extends s{constructor(e){super(),this.name=e}}class n extends s{getEventParams(){return{...super.getEventParams(),...this.getExtraInfo()}}}},88233:(e,t,i)=>{i.d(t,{$I:()=>y,$M:()=>m,Bz:()=>v,DT:()=>_,T0:()=>I,d9:()=>w,lA:()=>f,y:()=>p});var a=i(19413),r=i(68967),s=i(52609),o=i(16263),n=i(67986);const c=new Map,l=new Map,d=(()=>{const e="graphic_old_user_key",t=Boolean(localStorage.getItem(e));return t||localStorage.setItem(e,"1"),t?"0":"1"})();function u(){var e,t,a,o;const n=!(0,r.qM)(),{enter_from:c="",create_id:l="",from_page:u="",err_code:h=0,server_cost_time:p}=(0,r.gO)(),g=(0,s.Y)();return{domain:i.g.location.host,effectWasmCached:null!==(e=null===(t=i.g)||void 0===t||null===(t=t.ccWebPerf)||void 0===t?void 0:t.effectWasmCached)&&void 0!==e?e:0,isNewDraft:n?1:0,enterFrom:c,fromPage:u,createId:l,serverErrCode:Number(h),htmlLoadDuration:null!==(a=null==g?void 0:g.htmlLoadDuration)&&void 0!==a?a:-1,redirectDuration:null!==(o=null==g?void 0:g.redirectDuration)&&void 0!==o?o:-1,hasResourceCache:null!=g&&g.hasResourceCache?1:0,serverCreateDraftDuration:p?Number(p):-1,isNewUser:d}}class h extends a._B{constructor(){super(...arguments),this.name="page-partial-visible"}static getInstance(){return h.instance||(h.instance=new h),h.instance}getExtraInfo(){return{...u()}}}class p extends a._B{constructor(){super(...arguments),this.name="page-editor-visible",this.fromJSONP=!1}static getInstance(){return p.instance||(p.instance=new p),p.instance}markEditorEnd(e){this.extraParams=(0,o.l)(e),this.markEndTimeAndReport()}getExtraInfo(){const e={};return[...c.entries()].forEach((t=>e[`stage_${t[0]}`]=t[1])),{...u(),...this.extraParams,...e,fromJSONP:this.fromJSONP?"1":"0"}}}class g extends a._B{constructor(){super(...arguments),this.name="page-panel-visible"}static getInstance(){return g.instance||(g.instance=new g),g.instance}getExtraInfo(){return u()}}const _=e=>{h.getInstance().markStartTime(e),p.getInstance().markStartTime(e),g.getInstance().markStartTime(e)},f=()=>{h.getInstance().markEndTimeAndReport()},v=e=>{p.getInstance().markEditorEnd(e)},m=()=>{g.getInstance().markEndTimeAndReport()};var y;function I(e){l.has(e)?n.t.warn("stage repeat statistic start time",e):l.set(e,Date.now())}function w(e){const t=Date.now(),i=l.get(e);if(!i)return void n.t.warn("stage set end before start",e);const a=t-i;c.get(e)?n.t.warn("stage repeat ",e):c.set(e,a)}!function(e){e.RenderSDK="renderSDK",e.ModelSDK="modelSDK",e.UserInit="userInit",e.RenderSdkInit="renderSdkInit",e.EditorBootstrap="editorBootstrap"}(y||(y={}))},59126:(e,t,i)=>{i.d(t,{PI:()=>o,TG:()=>n,gi:()=>c});var a=i(37722),r=i(92204);class s{constructor(e,t){this.eventName="picture_edit_new_guide",this.action=e,this.type=t}getEventParams(){return{action:this.action,type:this.type}}}const o=(e,t)=>{let i=t;if("number"==typeof t&&(i=Number(t)+1,i<r.kx.STEP_1))return;const o=a.I.getInstance(),n=new s(e,i);o.reportEvent(n)},n=e=>{e+1!==r.kx.STEP_4?o(r.WA.SKIP,e):o(r.WA.GET,e)},c=(e,t)=>{e&&o(r.WA.NEXT,t)}},96442:(e,t,i)=>{i.d(t,{Jm:()=>a,NX:()=>c,V6:()=>s,lU:()=>d,tS:()=>l,zW:()=>u});var a,r,s,o=i(92204),n=i(37722);!function(e){e.Picture="picture",e.Frame="frame",e.MutilFrame="multilayer_frame",e.Page="page",e.Grid="grid"}(a||(a={})),function(e){e.Project="project",e.Cloud="cloud",e.Upload="upload",e.Canvas="canvas"}(r||(r={})),function(e){e.Success="success",e.Failure="failure"}(s||(s={}));class c{constructor(e){this.eventName="picture_replace_status",this.type=e}setSource(e){"project"===e&&(this.source=r.Project),"space"===e&&(this.source=r.Cloud)}getEventParams(){return{type:this.type,status:this.status,source:this.source,action_type:this.actionType}}}function l(e,t){const i=new c(e);i.status=t,i.source=r.Upload,n.I.getInstance().reportEvent(i)}function d(e){const t=new c(e?a.MutilFrame:a.Frame);t.status=s.Success,t.source=r.Canvas,t.actionType=o.H8.Drag,n.I.getInstance().reportEvent(t)}function u(){const e=new c(a.Grid);e.status=s.Success,e.source=r.Canvas,e.actionType=o.H8.Drag,n.I.getInstance().reportEvent(e)}},77449:(e,t,i)=>{i.d(t,{n:()=>o});var a=i(37722),r=i(92204);class s{constructor({action:e,action_type:t,canvas_size:i,resize_type:a,channel:r,page_no:s}){this.eventName="resize_action",this.action=e,this.action_type=t,this.canvas_size=null!=i?i:"",this.channel=null!=r?r:"",this.resize_type=null!=a?a:"",this.page_no=null!=s?s:1}getEventParams(){return{action:this.action,canvas_size:this.canvas_size,action_type:this.action_type,channel:this.channel,resize_type:this.resize_type,page_no:this.page_no}}}const o=(e,t)=>{const i=a.I.getInstance();if(t){const{width:i,height:a,unit:r}=t||{};e.canvas_size=`${i}*${a}${r}`}if(e.action===r.bU.RESIZE_PREVIEW&&!e.canvas_size)return;const o=new s(e);i.reportEvent(o)}},59483:(e,t,i)=>{i.d(t,{m:()=>s});var a=i(37722);class r{constructor(e){this.eventName="distance_measurement",this.currentPage="picture_edit";const{draftId:t,measureType:i,positionType:a}=e;this.draftId=t,this.measureType=i,this.positionType=a}getEventParams(){return{current_page:this.currentPage,draft_id:this.draftId,measure_type:this.measureType,position_type:this.positionType}}}function s(e){const t=new r(e);a.I.getInstance().reportEvent(t)}},47400:(e,t,i)=>{i.d(t,{EE:()=>n,Gg:()=>o});var a=i(37722),r=i(92204);class s{constructor(e){this.options=e,this.eventName="search_result_click",this.searchKeyword=e.searchKeyword,this.keywordSource=e.keywordSource,this.wordPosition=e.wordPosition,this.requestId=e.requestId,this.searchId=e.searchId,this.materialCategory=e.materialCategory,this.materialId=e.materialId,this.materialName=e.materialName,this.rank=e.rank,this.isCommercial=e.isCommercial,this.actionType=e.actionType,this.clickOption=e.optionType}getEventParams(){var e,t;return{material_category:this.materialCategory,search_keyword:this.searchKeyword,keyword_source:this.keywordSource,word_position:this.wordPosition,request_id:this.requestId,search_id:this.searchId,material_id:this.materialId,material_name:this.materialName,rank:this.rank,is_commercial:this.isCommercial,search_result_id:this.materialId,action_type:this.actionType,click_option:this.clickOption,material_subcategory:null!==(e=this.options.materialSubcategory)&&void 0!==e?e:r.Ic,material_subcategory_id:null!==(t=this.options.materialSubcategoryId)&&void 0!==t?t:r.Ic}}}function o(e){const t=new s(e);a.I.getInstance().reportEvent(t)}function n(e,t,i){const{item:r,extraParams:o,rank:n}=e;if(!o)return;const c={...o,materialId:r.web_id,materialName:r.title,rank:n,actionType:t,optionType:i,isCommercial:!0,searchId:r.searchId,requestId:r.requestId},l=new s(c);a.I.getInstance().reportEvent(l)}},76603:(e,t,i)=>{i.d(t,{ER:()=>c,It:()=>g,OK:()=>f,SI:()=>a,TL:()=>S,Td:()=>m,ZU:()=>o,gY:()=>s,l_:()=>r,wW:()=>n,wb:()=>I});var a,r,s,o,n,c,l=i(69757),d=i(8757),u=i(37722),h=i(67219);!function(e){e.submit="submit",e.check="check"}(a||(a={})),function(e){e.Photo="photo",e.Frame="frame",e.Text="text",e.Shape="shape",e.Sticker="sticker",e.Grid="grid"}(r||(r={}));class p{constructor(e,t,i,a,r){this.eventName="template_usability_check_result",this.check_trigger_type=e,this.issue_cnt=t,this.must_fix_cnt=i,this.suggest_fix_cnt=a,this.template_usability_issues=r.length>0?JSON.stringify({template_usability_issues:r.map((e=>({...e,issue_layer_type:e.issue_layer_type.join(",")})))}):void 0}getEventParams(){return{check_trigger_type:this.check_trigger_type,issue_cnt:this.issue_cnt,must_fix_cnt:this.must_fix_cnt,suggest_fix_cnt:this.suggest_fix_cnt,template_usability_issues:this.template_usability_issues}}}function g(e,t){const i=(0,l.NM)(t,d.TN.BottomLine),a=(0,l.NM)(t,d.TN.Suggestion),r=i+a,s={};Object.keys(t).forEach((e=>{t[e].forEach((e=>{var t;const{layer:i}=e,a=i.type;if(a===d.F5.PAGE||a===d.F5.GROUP_LAYER)return;const r=e.id,o=null!==(t=s[r])&&void 0!==t?t:{issue_id:r,issue_type:e.checkType===d.TN.BottomLine?"must_fix":"suggest_fix",issue_layer_type:[]},n=h.Rd[a];n&&(o.issue_layer_type.push(n(i)),s[r]=o)}))}));const o=Object.keys(s).map((e=>s[e]));var n,c,g,_,f;n=e,c=r,g=i,_=a,f=o,u.I.getInstance().reportEvent(new p(n,c,g,_,f))}!function(e){e.Show="show",e.Check="check",e.Locate="locate"}(s||(s={}));class _{constructor(e,t,i,a,r,s,o){this.eventName="template_usability_check_list",this.action=e,this.issue_cnt=t,this.must_fix_cnt=i,this.suggest_fix_cnt=a,this.locate_issue_id=r,this.locate_issue_type=s,this.locate_issue_layer_type=o}getEventParams(){return{action:this.action,issue_cnt:this.issue_cnt,must_fix_cnt:this.must_fix_cnt,suggest_fix_cnt:this.suggest_fix_cnt,locate_issue_id:this.locate_issue_id,locate_issue_type:this.locate_issue_type,locate_issue_layer_type:this.locate_issue_layer_type}}}function f(e,t,i,a,r){const{layer:o,type:n}=null!=a?a:{},c=t+i;let l,p,g;const f=null==o?void 0:o.type;if(e===s.Locate&&f&&f!==d.F5.PAGE&&f!==d.F5.GROUP_LAYER){l=null==r?void 0:r.join(","),p=n===d.TN.BottomLine?"must_fix":"suggest_fix";const e=h.Rd[f];e&&(g=e(o))}!function(e,t,i,a,r,s,o){u.I.getInstance().reportEvent(new _(e,t,i,a,r,s,o))}(e,c,t,i,l,p,g)}class v{constructor(){this.eventName="click_usability_check_icon"}getEventParams(){return{}}}function m(){u.I.getInstance().reportEvent(new v)}!function(e){e.Show="show",e.Check="check",e.Ignore="ignore"}(o||(o={})),function(e){e.mustFix="must_fix",e.suggestFix="suggest_fix"}(n||(n={}));class y{constructor(e,t){this.eventName="usability_issue_popup",this.action=e,this.popup_type=t}getEventParams(){return{action:this.action,popup_type:this.popup_type}}}function I(e,t){u.I.getInstance().reportEvent(new y(e,t))}!function(e){e.Success="success",e.Fail="fail",e.Cancel="cancel"}(c||(c={}));class w{constructor(e,t,i,a){this.eventName="template_publish_status",this.status=e,this.template_id=t,this.fail_reason=i,this.suggest_fix_cnt=a}getEventParams(){return{status:this.status,template_id:this.template_id,template_type:"picture",fail_reason:this.fail_reason,suggest_fix_cnt:this.suggest_fix_cnt}}}function S(e,t,i,a){u.I.getInstance().reportEvent(new w(e,t,i,a))}},67219:(e,t,i)=>{i.d(t,{B6:()=>w,EL:()=>R,Ez:()=>C,Rd:()=>x,ar:()=>b,ee:()=>P,pf:()=>T,qJ:()=>k,tS:()=>y,tY:()=>D,wF:()=>S,x6:()=>E,yW:()=>I});var a=i(8757),r=i(37722),s=i(91372),o=i(15516),n=i(68967),c=i(92204),l=i(49824),d=i(21204),u=i(50650),h=i(90949),p=i(75318),g=i(78101),_=i(7430),f=i(91275),v=i(54714),m=i(76603);function y(e){var t;const i=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi.common;return null==i?void 0:i.getLayersByFilter(!0,(t=>t.id===e))[0]}function I(e){var t;const i=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi.page;return null==i?void 0:i.getPageById(e)}function w(e){const t=r.I.getInstance().getContext(a.K6);if(!t)return;if(null==e||!e.length)return t.modelApi.common.getLayersByFilter(!0,(()=>!0));const i=[];return e.forEach((e=>{t.modelApi.page.getPageLayersByFilter(e,!0,(e=>(i.push(e),!0)))})),i}function S(e){var t;const i=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi.document;return e.reduce(((e,t)=>{const a=null==i?void 0:i.getPageBackgroundImage(t);return a?[...e,a]:e}),[])}function b(e){var t;const i=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi.page,s=[];return e.forEach((e=>{null==i||i.getPageLayersByFilter(e,!1,(e=>e.type===a.F5.GROUP_LAYER&&(s.push(e),!0)))})),s}function C(e){var t,i;const o=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi.aigc,n=null!==(i=null==o?void 0:o.getDraftUsedColor(e))&&void 0!==i?i:[],c=new Set;return n.forEach((e=>{e&&c.add((0,s.GG)(e))})),c.size}function E(e){var t,i,s,o,n;const c=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi,u={},h=e=>{null==e||e.forEach((e=>{var t;let i=null!==(t=u[e.type])&&void 0!==t?t:0;const a=i?i++:1;u[e.type]=a}))};return e.forEach((e=>{null==c||c.page.getPageLayersByFilter(e,!0,(e=>((0,l.CU)(e)&&e.items.forEach((e=>{var t;e.fill.fillType===a.lm.IMAGE&&h(null===(t=e.fill.image)||void 0===t?void 0:t.postProcessEffects)})),(0,d.MD)(e)&&h(e.postProcessEffects),!0)))})),{picture_effect_shadow:null!==(i=u[a.zI.SHADOW])&&void 0!==i?i:0,picture_effect_stroke:null!==(s=u[a.zI.OUTLINE])&&void 0!==s?s:0,picture_effect_glow:null!==(o=u[a.zI.GLOW])&&void 0!==o?o:0,picture_effect_feather:null!==(n=u[a.zI.FEATHER])&&void 0!==n?n:0}}function k(e){var t;const i=null===(t=r.I.getInstance().getContext(a.K6))||void 0===t?void 0:t.modelApi,s={id:[],name:[],set:new Set},n={id:[],name:[],set:new Set},c=(e,t)=>{null==e||e.forEach((e=>{if(e.resourceId in o.KL)return;const i=e.type===a.Yl.FILTER?s:n;(null==t||!t.includes(e.resourceId))&&i.set.add(e.resourceId),i.id.push(e.id),i.name.push(e.name)}))};return e.forEach((e=>{var t;c(null==i||null===(t=i.document.getPageBackgroundImage(e))||void 0===t?void 0:t.effectFilters),null==i||i.page.getPageLayersByFilter(e,!0,(e=>{var t;((0,l.CU)(e)&&e.items.forEach((t=>{var i,r;t.fill.fillType===a.lm.IMAGE&&c(null===(i=t.fill.image)||void 0===i?void 0:i.effectFilters,null===(r=e.extra.sourceInfo)||void 0===r?void 0:r.templateEffectFilters)})),(0,d.MD)(e))&&c(e.effectFilters,null===(t=e.extra.sourceInfo)||void 0===t?void 0:t.templateEffectFilters);return!0}))})),{filter_cnt:s.set.size,filter_id:s.id.join(",")||"none",filter:s.name.join(",")||"none",special_effect_cnt:n.set.size,special_effect_id:n.id.join(",")||"none",special_effect:n.name.join(",")||"none"}}function T(e,t,i=!1){const r=w(e);if(null==r||!r.length)return[];const s=new Map;return null==r||r.forEach((e=>{var t,r,o,n,c;const l=(null===(t=e.src)||void 0===t?void 0:t.resourceId)||(null===(r=e.src)||void 0===r?void 0:r.path)||(null===(o=e.src)||void 0===o?void 0:o.md5)||(null===(n=e.font)||void 0===n?void 0:n.resourceId)||(null===(c=e.extra)||void 0===c?void 0:c.resourceId);if(s.set(l,e),i&&e.type===a.F5.IMAGE_CONTAINER){const{items:t}=e;t.forEach((({fill:e})=>{const{image:t}=e;t&&s.set(t.id,t)}))}})),[...s.values()].filter((e=>{var i;return null===(i=null==t?void 0:t(e))||void 0===i||i}))}function P(e){if(!e)return;if((null==e?void 0:e.length)>1)return c._m.Multi;if(0===(null==e?void 0:e.length))return c._m.Page;const t=null==e?void 0:e[0],i=y(t);if(I(t))return c._m.Page;if(!i)return;const a={[c._m.Text]:u.qd,[c._m.Group]:h.C,[c._m.Frames]:l.CU,[c._m.MultiFrame]:l.uR,[c._m.Line]:p.g,[c._m.Polygon]:g.I,[c._m.Grid]:_.Ty,[c._m.Stickers]:d.U0,[c._m.Picture]:d.Or};return Object.keys(a).find((e=>{const t=a[e];if("function"==typeof t&&t(i))return e}))}function D(e,t,i,a=[]){switch(e){case f.g.Export:return c.B$.EXPORT;case f.g.Delete:return c.B$.DELETE;case f.g.Copy:return c.B$.COPY;case f.g.Paste:return c.B$.PASTE;case f.g.Group:return i!==c._m.Multi?c.B$.UNGROUP:c.B$.GROUP;case f.g.Layer:return v.g[null!=t?t:""];case f.g.Flip:return v.sS[null!=t?t:""];case f.g.Duplicate:return c.B$.DUPLICATE;case f.g.Align:return v.dN[null!=t?t:""];case f.g.SelectLayer:return c.B$.SELECT_LAYER;case f.g.SetPageBackgroundImage:return c.B$.SET_BACKGROUND;case f.g.DetachPageBackgroundImage:return c.B$.DETACH_BACKGROUND;case f.g.Lock:return function(e){return e.every((e=>{const t=y(e);return null==t?void 0:t.isLocked}))}(a)?c.B$.UNLOCK:c.B$.LOCK}}const x={[a.F5.TEXT]:()=>m.l_.Text,[a.F5.IMAGE]:e=>e&&(0,d.U0)(e)?m.l_.Sticker:m.l_.Photo,[a.F5.SVG_IMAGE]:()=>m.l_.Sticker,[a.F5.IMAGE_CONTAINER]:()=>m.l_.Frame,[a.F5.LINE]:()=>m.l_.Shape,[a.F5.SHAPE]:()=>m.l_.Shape,[a.F5.GRID]:()=>m.l_.Grid};function A(){const{referrer:e}=window.document,t=e?new URL(e):null,i=(0,n.gO)().utm_source;return(!t||t.hostname!==window.location.hostname)&&"extension"===i}function R(e){const t=A(),i=function(){let e="";A()&&(e=(0,n.gO)().utm_campaign||"");return e}(),a=(0,n.gO)();t&&("chatgpt"===i&&a.create_id?e.tool_type="chatgpt_search":e.tool_type=i)}},19566:(e,t,i)=>{i.d(t,{S:()=>r});var a=i(37722);class r extends a.C{constructor(e){super(),this.eventName="video_cover_edit_action",this._action=e.action,this._cover_draft_id=e.cover_draft_id,this._video_draft_id=e.video_draft_id}getEventParams(){return{action:this._action,cover_draft_id:this._cover_draft_id,video_draft_id:this._video_draft_id,current_page:"picture_edit"}}}},16073:(e,t,i)=>{i.d(t,{GV:()=>c,Gy:()=>a,KY:()=>r,Vo:()=>o});var a,r,s,o,n=i(67126);!function(e){e.uploading="uploading",e.processing="processing",e.rendering="rendering",e.upload_success="uploading_success",e.process_success="processing_success",e.upload_failed="upload_failed",e.process_failed="process_failed"}(a||(a={})),function(e){e.MAIN="MAIN",e.BACKGROUND="BACKGROUND",e.DESIGN="DESIGN"}(r||(r={})),function(e){e.WORKSPACE_ID="workspaceId",e.FROM_PAGE="from_page",e.ENTER_FROM="enter_from",e.POSITION="position"}(s||(s={})),function(e){e.MULTIPLE_IDLE="multipleIdle",e.MULTIPLE_SIZE="multipleSize",e.MULTIPLE_PRESETS="multiplePresets",e.MULTIPLE_AI_MODEL="multipleAIModel"}(o||(o={}));const c=(0,n.yh)("batch-editor-service")},44001:(e,t,i)=>{var a;i.d(t,{fJ:()=>r});const r=50;a=window.__batchMaxTasks},1956:(e,t,i)=>{i.d(t,{BJ:()=>n});var a,r,s,o=i(67126);!function(e){e[e.idle=0]="idle",e[e.processing=1]="processing",e[e.ready=2]="ready",e[e.failure=3]="failure"}(a||(a={})),function(e){e.Preset="Preset",e.Design="Design"}(r||(r={})),function(e){e.Init="Init",e.Loading="Loading",e.Result="Result",e.Error="Error"}(s||(s={}));const n=(0,o.yh)("batch-editor-ui-preset")},44773:(e,t,i)=>{i.d(t,{j:()=>r});var a=i(67126);i(8757);const r=(0,a.yh)("batch-editor-ui-size")},84435:(e,t,i)=>{i.d(t,{k:()=>a});const a=(0,i(67126).yh)("batch-editor-ui")},47087:(e,t,i)=>{i.d(t,{w:()=>a});const a=(0,i(67126).yh)("document-model")},24149:(e,t,i)=>{i.d(t,{d:()=>a,j:()=>s});var a,r=i(67126);!function(e){e.SUCCESS="success",e.FAIL="fail",e.SAVING="saving"}(a||(a={}));const s=(0,r.yh)("draft-manager")},25351:(e,t,i)=>{i.d(t,{l:()=>a});const a=(0,i(67126).yh)("graphic-draft-move-service")},6343:(e,t,i)=>{i.d(t,{A:()=>s,t:()=>a});var a,r=i(67126);!function(e){e.PNG="png",e.JPG="jpg",e.PDF="pdf"}(a||(a={}));const s=(0,r.yh)("graphic-export")},24253:(e,t,i)=>{i.d(t,{r:()=>s});var a=i(67126),r=i(69412);const s=(0,a.LO)(r.Ui)},33690:(e,t,i)=>{i.d(t,{j:()=>s});var a=i(67126),r=i(81666);const s=(0,a.LO)(r.Y)},7081:(e,t,i)=>{i.d(t,{L:()=>a});const a=(0,i(67126).yh)("image-effect")},54155:(e,t,i)=>{i.d(t,{I:()=>r,t:()=>a});const a="MaterialEverCloud",r="fakeId:"},51825:(e,t,i)=>{i.d(t,{X:()=>a});const a=(0,i(67126).yh)("projectMaterialManagerService")},51728:(e,t,i)=>{i.d(t,{q:()=>r});var a=i(39089);function r(e){var t,i,r;const s=function(e){const t=e.imageAsyncResize,i=(0,a.Jw)(e);return t?i?"success":"transcoding":i?"success":"failure"}(e),o=function(e){var t,i;if(e.previewUrl)return e.previewUrl;const a=Object.keys(null!==(t=e.imageTranscodeInfo)&&void 0!==t?t:{}).sort(((e,t)=>Number(e)-Number(t)));return null==e||null===(i=e.imageTranscodeInfo)||void 0===i||null===(i=i[null==a?void 0:a[0]])||void 0===i?void 0:i.preview_url}(e);return{mode:"login",id:e.id,everCloudId:e.id,platformId:e.id,status:s,progress:"transcoding"===s?.7:1,name:e.name,cover:o||"",owner:e.owner,type:e.type,size:e.size,coverKey:e.previewKey,sourcePath:e.sourcePath,url:null!==(t=null!==(i=null===(r=e.imageTranscodeInfo)||void 0===r||null===(r=r.origin)||void 0===r?void 0:r.preview_url)&&void 0!==i?i:o)&&void 0!==t?t:"",md5:e.md5,width:e.width,height:e.height,meta:e.meta,transcodeInfo:(n=e.imageTranscodeInfo,Object.values(n||{}).reduce(((e,t)=>{const{width:i,height:a,preview_url:r,key:s}=t;return r&&(e[`${i}x${a}`]={full_url:r,width:i,height:a,aesKey:s}),e}),{}))};var n}},39089:(e,t,i)=>{i.d(t,{C0:()=>n,Jw:()=>o});var a,r=i(22169);!function(e){e[e.UNTRANSCODE=-1]="UNTRANSCODE",e[e.SUCCESS=0]="SUCCESS",e[e.PROCESSING=1]="PROCESSING",e[e.FAILED=2]="FAILED",e[e.TIMEOUT=3]="TIMEOUT"}(a||(a={}));const s=[{targets:["360","480","720"]},{targets:["720","1080","origin"]}];function o(e,t){return(0,r.merge)({},{strategy:s},t).strategy.map((t=>t.targets.reduce(((t,i)=>{var a;if(t)return t;const r=null===(a=e.imageTranscodeInfo)||void 0===a?void 0:a[(s=i,"origin"!==s?`${s}`:"origin")];var s;return Boolean((null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(null==r?void 0:r.preview_url))}),!1))).reduce(((e,t)=>e&&t),!0)}function n(e,t,i){return(0,r.merge)({},{strategy:s},i).strategy.map((i=>i.targets.reduce(((i,r)=>{if(i)return i;return t.get(`${r}_${e}`)===a.SUCCESS}),!1))).reduce(((e,t)=>e&&t),!0)}},63040:(e,t,i)=>{i.d(t,{N:()=>a});const a=(0,i(67126).yh)("sideMenuFileDragService")},49384:(e,t,i)=>{i.d(t,{W:()=>a});const a=(0,i(67126).yh)("text-edit")},88494:(e,t,i)=>{i.d(t,{ZO:()=>o,ob:()=>a,sy:()=>r});var a,r,s=i(67126);!function(e){e.GOOGLE_DRIVE="GoogleDrive",e.DROPBOX="Dropbox"}(a||(a={})),function(e){e.MY_DEVICE="My Device",e.MYSPACE="My Space"}(r||(r={}));const o=(0,s.yh)("upload")},67656:(e,t,i)=>{i.d(t,{C:()=>ot});var a,r=i(88494),s=i(55610),o=i(27175),n=i(14463);!function(e){e[e.Success=0]="Success",e[e.Uploading=1]="Uploading",e[e.Failure=-1]="Failure",e[e.Insufficient=-2]="Insufficient"}(a||(a={}));var c=i(22169);function l(e){switch(e){case a.Success:return"transcoding";case a.Uploading:return"uploading";case a.Failure:case a.Insufficient:default:return"failure"}}function d(e){return{mode:"login",id:e.id,everCloudId:e.fileId,name:e.name,cover:e.coverUrl,status:l(e.status),progress:100*e.progress,url:"",md5:e.md5,workspaceId:e.workspaceId}}var u=i(42058);const h=(()=>{const e={file:{acceptType:[],acceptSuffix:[]},video:{acceptType:[],acceptSuffix:[]},audio:{acceptType:[],acceptSuffix:[]},image:{acceptType:["image/jpeg","image/jpg","image/png","image/heif","image/heic","image/avif","image/vnd.adobe.photoshop","image/svg+xml","image/bmp","image/tiff","image/webp","image/x-icon"],acceptSuffix:[".jpeg",".jpg",".png",".heif",".heic",".avif",".psd",".svg",".bmp",".tif",".tiff",".webp",".ico"]}},t=t=>[...e[t].acceptType,...e[t].acceptSuffix].join(",");return{file:{...e.file,accept:t("file")},video:{...e.video,accept:t("video")},audio:{...e.audio,accept:t("audio")},image:{...e.image,accept:t("image")},allAccept:`${t("video")},${t("audio")},${t("image")}`}})();class p{constructor(e){this._uploadFileList=[],this._onFileUploadStates=[],this.extraParams={},this.broadcastFileStatus=e=>{this._onFileUploadStates.forEach((t=>{t(e,this.extraParams)}))},this._uploadListener=e=>{var t;e.workspaceId=this.workspaceId;const i=this._uploadFileList.find((t=>t.id===e.id)),s=(0,c.get)(null===(t=this._thirdpartyStorageModal)||void 0===t?void 0:t.getService(),"state.context.platform");var o,n;i?(null===(o=(n=this.extraParams).smartToolPageImportReport)||void 0===o||o.call(n,this.extraParams.channel===r.ob.DROPBOX?"drop_box":"google_drive"),this.broadcastFileStatus({type:s,data:d(e)}),e.status===a.Success&&(this._uploadFileList=this._uploadFileList.filter((t=>t.id!==e.id))),e.status===a.Insufficient&&this._showUserSpaceInsufficient()):(this.broadcastFileStatus({type:s,isNewFile:!0,data:d(e)}),this._uploadFileList.unshift(e))},this._options=e,this._initThirdpartySdk(),this._showUserSpaceInsufficient=e.showUserSpaceInsufficient,this.workspaceId=e.workspaceId}_initThirdpartySdk(){if(this._thirdpartyInitPromise)return this._thirdpartyInitPromise;const{draftId:e,workspaceId:t,reqDomain:a}=this._options;this._thirdpartyInitPromise=Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,67632)).then((({LvThirdpartyStorageModal:i})=>{var r,s;this._thirdpartyStorageModal=new i({acceptMime:h.image.acceptSuffix,isBOE:!1,draftId:e,spaceId:t,reqDomain:a,multiple:null!==(r=this._options.multi)&&void 0!==r&&r,desc:o.ZP.t("web_graphic_thirdparty_storage_desc",{},"Only photos can be selected"),currentPage:null!==(s=this._options.currentPage)&&void 0!==s?s:"picture_edit",cookieConsent:n.cookieConsent,expandModalInstance:this._thirdpartyStorageExpandModalInstance,countLimit:this._options.maxCount,toolType:this._options.toolType}),this._thirdpartyStorageModal.onUpload(this._uploadListener)}))}registerOnUploadListener(e){this._onFileUploadStates.push(e)}unRegisterOnUploadListener(e){this._onFileUploadStates=this._onFileUploadStates.filter((t=>t!==e))}async show(e,t){var i;await this._initThirdpartySdk(),null===(i=this._thirdpartyStorageModal)||void 0===i||i.show(e),t&&(this.extraParams={...t,channel:e})}setThirdpartyStorageExpandModalInstance(e){var t,i;this._thirdpartyStorageExpandModalInstance=e,null===(t=this._thirdpartyStorageModal)||void 0===t||null===(i=t.setExpandModalInstance)||void 0===i||i.call(t,e)}async setToolType(e){var t;await this._initThirdpartySdk(),null===(t=this._thirdpartyStorageModal)||void 0===t||t.setToolType(e)}async deleteFile(e){await this._initThirdpartySdk();const t=this._uploadFileList.find((t=>t.id===e));var i;t&&await(null===(i=this._thirdpartyStorageModal)||void 0===i?void 0:i.delete(t))}async retryUpload(e){var t;await this._initThirdpartySdk();const i=this._uploadFileList.find((t=>t.id===e));(0,u.Y2)(i,"upload record not existed"),null===(t=this._thirdpartyStorageModal)||void 0===t||t.retry(i.id)}}var g=i(35545),_=i(77685),f=i(40673),v=i(13659),m=i(4271),y=i(36702),I=i(24451),w=i(72322);async function S(e,t,a){var r;const s=Boolean(await(null==t||null===(r=t.isSupportExpand)||void 0===r?void 0:r.call(t))),n=y.Z.error({title:o.ZP.t("web_graphic_upload_failure_title",{},"Couldn't upload"),closable:!0,content:o.ZP.t("delete_or_enlarge",{},"Your cloud space has reached the storage limit. You can delete some of your cloud files or expand your cloud storage."),onCancel:a,footer:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(I.Z,{onClick:()=>{null==e||e(),n.close(),null==a||a()},children:o.ZP.t("web_graphic_upload_material_status_retry",{},"Retry")}),(0,w.jsx)(I.Z,{onClick:()=>{s?null==t||t.show({type:m.c.CAPACITY_BUY,reporterParams:{pageFrom:m.K1.spaceUpgrade,currentPage:"picture_edit",enterFrom:"upload_fail"}}):i.g.open(`${window.location.protocol}//${window.location.host}/my-cloud`),n.close(),null==a||a()},children:s?o.ZP.t("web_first_subscribe_text_upgrading",{},"Upgrade"):o.ZP.t("web_graphic_space_go_to_delete",{},"Go to delete")})]})});return n}var b,C=i(20631);!function(e){e[e.UNTRANSCODE=-1]="UNTRANSCODE",e[e.SUCCESS=0]="SUCCESS",e[e.PROCESSING=1]="PROCESSING",e[e.FAILED=2]="FAILED",e[e.TIMEOUT=3]="TIMEOUT"}(b||(b={}));const E=[{targets:["360","480","720"]},{targets:["720","1080","origin"]}];function k(e,t){return(0,c.merge)({},{strategy:E},t).strategy.map((t=>t.targets.reduce(((t,i)=>{var a;if(t)return t;const r=null===(a=e.imageTranscodeInfo)||void 0===a?void 0:a[(s=i,"origin"!==s?`${s}`:"origin")];var s;return Boolean((null==r?void 0:r.width)&&(null==r?void 0:r.height)&&(null==r?void 0:r.preview_url))}),!1))).reduce(((e,t)=>e&&t),!0)}var T=i(67986);function P({evercloudInstance:e,everFileInfo:t,resolutions:i,onProgress:a}){let r=!1;const s=()=>new Promise((async s=>{const o=await e.getAssetByFileId(t.everCloudId);if(k(o))return null==a||a(100),void s((0,v.ly)());if(!o.imageAsyncResize)return void s((0,v.wf)(-1,"transcode failure with old data"));const n=await e.getImagesTranscodeStatus(i.map((e=>({ids:[t.everCloudId],resolution:e})))),l=e=>{const{everCloudId:i}=t;if("success"===e.status){if(o=i,l=e.data,(0,c.merge)({},{strategy:E},d).strategy.map((e=>e.targets.reduce(((e,t)=>e||l.get(`${t}_${o}`)===b.SUCCESS),!1))).reduce(((e,t)=>e&&t),!0))return null==a||a(100),r=!0,n.destroy(),s((0,v.ly)()),!0}var o,l,d;return!1};n.onProcess=e=>{l(e)},n.done().then((e=>{if(!r){l(e)||(T.t.warn("[ever-cloud-plugin][project]: transcode asset failure"),t.status="failure",s((0,v.wf)(-1,"transcode failure")))}}))}));return Promise.race([s(),new Promise((e=>{setTimeout((async()=>{if(!r){T.t.warn(`${t.everCloudId} get transcode status timeout, retry to fetch.`);const i=await s();e(i)}}),15e3)}))])}function D(e){var t,i,a;const r=function(e){const t=e.imageAsyncResize,i=k(e);return t?i?"success":"transcoding":i?"success":"failure"}(e),s=function(e){var t,i;if(e.previewUrl)return e.previewUrl;const a=Object.keys(null!==(t=e.imageTranscodeInfo)&&void 0!==t?t:{}).sort(((e,t)=>Number(e)-Number(t)));return null==e||null===(i=e.imageTranscodeInfo)||void 0===i||null===(i=i[null==a?void 0:a[0]])||void 0===i?void 0:i.preview_url}(e);return{mode:"login",id:e.id,everCloudId:e.id,platformId:e.id,status:r,progress:"transcoding"===r?.7:1,name:e.name,cover:s||"",owner:e.owner,type:e.type,size:e.size,coverKey:e.previewKey,sourcePath:e.sourcePath,url:null!==(t=null!==(i=null===(a=e.imageTranscodeInfo)||void 0===a||null===(a=a.origin)||void 0===a?void 0:a.preview_url)&&void 0!==i?i:s)&&void 0!==t?t:"",md5:e.md5,width:e.width,height:e.height,meta:e.meta,transcodeInfo:(o=e.imageTranscodeInfo,Object.values(o).reduce(((e,t)=>{const{width:i,height:a,preview_url:r,key:s}=t;return e[`${i}x${a}`]={full_url:r,width:i,height:a,aesKey:s},e}),{}))};var o}class x{constructor(){this._isLocked=!1,this.reset()}get done(){return this._statusPromise}get isLocked(){return this._isLocked}resolve(e){this._isLocked=!1,this._statusPromiseResolve(e)}reject(e){this._isLocked=!1,this._statusPromiseReject(e)}dispose(){this._statusPromiseResolve(),this._statusPromise=void 0}reset(){(0,u.Y2)(!this.isLocked,"current waiter is lock, unsupport reset"),this._isLocked=!0,this._statusPromise=new Promise(((e,t)=>{this._statusPromiseResolve=e,this._statusPromiseReject=t}))}}const A=.7,R=20113;class F{constructor({data:e,...t}){this._resultWaiter=new x,this.options=t,this.options.batchMaterialType?this.observableData=(0,C.LO)({...e,meta:{...e.meta,batchMaterialType:this.options.batchMaterialType}}):this.observableData=(0,C.LO)(e),this._listenerUploadStatusHandler=this._listenThirdpartyUploadStatus.bind(this),t.thirdpartyUploadHelper.registerOnUploadListener(this._listenerUploadStatusHandler)}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get toJS(){return(0,C.ZN)(this.observableData)}get isSuccess(){return"success"===this.observableData.status}async onDone(){return await this._resultWaiter.done,{result:this.toJS,errInfo:this._errInfo}}dispose(){this.options.thirdpartyUploadHelper.unRegisterOnUploadListener(this._listenerUploadStatusHandler)}canRetryUpload(){return Boolean(this.options.upload)}retryUpload(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),this.options.thirdpartyUploadHelper.retryUpload(this.id))}retryTranscode(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),this.options.evercloudInstance.triggerImageResize({ids:[this.everCloudId]}),(0,C.z)((()=>{this.observableData.status="transcoding"})),this._listenTranscodeResult())}cancelUpload(){this.options.thirdpartyUploadHelper.deleteFile(this.id)}canSync(){return!1}sync(){return Promise.reject(new Error("no need to sync"))}async delete(){await this.options.evercloudInstance.deleteAsset({ids:[this.id]}),this.dispose()}_listenThirdpartyUploadStatus(e){var t,i,a;if(e.data.id===this.observableData.id)switch(e.data.status){case"transcoding":(0,C.z)((()=>{var t;this.observableData.everCloudId=e.data.everCloudId,this.observableData.status="transcoding",this.observableData.progress=(null!==(t=e.data.progress)&&void 0!==t?t:0)*A})),null===(t=this.options.upload)||void 0===t||null===(i=t.onUploadSuccess)||void 0===i||i.call(t,this.observableData),this._listenTranscodeResult();break;case"uploading":(0,C.z)((()=>{var t;this.observableData.status="uploading",this.observableData.progress=(null!==(t=e.data.progress)&&void 0!==t?t:0)*A}));break;case"failure":(0,C.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:-1,message:e.data.status},null===(a=this._resultWaiter)||void 0===a||a.resolve()}}async _listenTranscodeResult(){const{evercloudInstance:e}=this.options;await e.forceSyncPullUpdates();const t=await P({evercloudInstance:e,everFileInfo:(0,C.ZN)(this.observableData),resolutions:[...s.bF,"origin"]});if(t.ok){var i,a;const t=await e.getAssetByFileId(this.everCloudId);(0,C.z)((()=>{const{id:e,...i}=D(t);Object.assign(this.observableData,{...i,meta:{...i.meta,batchMaterialType:this.options.batchMaterialType}})})),null===(i=this.options.upload)||void 0===i||null===(a=i.onTranscodeSuccess)||void 0===a||a.call(i,this.observableData)}else{var r;(0,C.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:t.code,message:t.msg},null===(r=this._resultWaiter)||void 0===r||r.resolve()}}resetWaiter(){var e;this._errInfo=void 0,null===(e=this._resultWaiter)||void 0===e||e.reset()}}class M{constructor(){this._awaitQueue=[],this._locked=!1}get isLocked(){return this._locked}acquire(){if(this._locked){return new Promise(((e,t)=>{this._awaitQueue.push({resolve:e,reject:t})}))}return this._locked=!0,Promise.resolve()}release(){if(!this._locked)throw new Error("mutex lock is not locked.");this._locked=!1;const e=this._awaitQueue.pop();e&&(this._locked=!0,e.resolve())}}class L{constructor({data:e,...t}){this.options=t,this.options.batchMaterialType?this.observableData=(0,C.LO)({...e,meta:{...e.meta,batchMaterialType:this.options.batchMaterialType}}):this.observableData=(0,C.LO)(e),"success"===e.status&&(this._resultWaiter=new x,this._resultWaiter.resolve()),"waiting"===e.status&&this.retryUpload(),"transcoding"===e.status&&this.retryTranscode()}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get isSuccess(){return"success"===this.observableData.status}get toJS(){return(0,C.ZN)(this.observableData)}async onDone(){return await this._resultWaiter.done,{result:this.toJS,errInfo:this._errInfo}}dispose(){var e;this._resultWaiter.dispose(),null===(e=this._uploadRequest)||void 0===e||e.destroy()}canRetryUpload(){var e;return Boolean(null===(e=this.options.upload)||void 0===e?void 0:e.file)}retryUpload(){var e,t,i;if(null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked)return;this.resetWaiter();const{evercloudInstance:a,upload:r}=this.options;(0,u.Y2)(null==r?void 0:r.file,"not allow to upload file without upload params"),r.checkAndUpdateUserSpace(r.file.size)||(0,C.z)((()=>{this.observableData.status="failure"})),(0,C.z)((()=>{this.observableData.status="waiting",this.observableData.progress=0})),null===(t=this.options.upload)||void 0===t||null===(i=t.onStartToUpload)||void 0===i||i.call(t),a.uploadAsset({file:r.file,skipDuplicate:!0,fileType:null!=r&&r.isSilence?"file":void 0}).then((e=>{this._uploadRequest=e,e.onIdle=()=>{(0,C.z)((()=>{var e;this.observableData.status="uploading",null===(e=r.onProgress)||void 0===e||e.call(r,0)}))},e.onProgress=e=>{var t;const i=e.done/e.total*100*A;(0,C.z)((()=>{this.observableData.progress=i})),null===(t=r.onProgress)||void 0===t||t.call(r,i)},e.onFinish=e=>{var t,i,a;(this._uploadRequest=void 0,"success"===e.status)&&(this.options.upload.file=void 0,(0,C.z)((()=>{this.observableData.everCloudId=e.fileId,this.observableData.md5=e.md5,this.observableData.status="transcoding",this.observableData.progress=70})),null===(t=r.onUploadSuccess)||void 0===t||t.call(r,this.observableData),null==r||null===(i=r.onProgress)||void 0===i||i.call(r,70),this._listenTranscodeResult());"error"===e.status&&((0,C.z)((()=>{this.observableData.status="failure"})),e.errInfo.code===s.tN.INSUFFICIENT_SPACE&&this.options.upload.showUserSpaceInsufficient(),this._errInfo=e.errInfo,null===(a=this._resultWaiter)||void 0===a||a.resolve())}}))}retryTranscode(){var e;null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked||(this.resetWaiter(),(0,C.z)((()=>{this.observableData.status="transcoding"})),this.options.evercloudInstance.triggerImageResize({ids:[this.everCloudId]}),this._listenTranscodeResult())}cancelUpload(){var e;null===(e=this._uploadRequest)||void 0===e||e.cancel()}canSync(){return!1}sync(){return Promise.reject(new Error("no need to sync"))}async delete(){await this.options.evercloudInstance.deleteAsset({ids:[this.everCloudId]}),this.dispose()}async _listenTranscodeResult(){var e;const{evercloudInstance:t}=this.options,i=await P({evercloudInstance:t,everFileInfo:(0,C.ZN)(this.observableData),resolutions:[...s.bF,"origin"],onProgress:null===(e=this.options.upload)||void 0===e?void 0:e.onProgress});if(i.ok){var a;const e=await t.getAssetByFileId(this.everCloudId);(0,C.z)((()=>{const{id:t,...i}=D(e);Object.assign(this.observableData,{...i,meta:{...i.meta,batchMaterialType:this.options.batchMaterialType}})})),null===(a=this._resultWaiter)||void 0===a||a.resolve()}else{var r;(0,C.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:i.code,message:i.msg},null===(r=this._resultWaiter)||void 0===r||r.resolve()}}resetWaiter(){this._errInfo=void 0,this._resultWaiter=new x}}var O=i(48018),U=i(73842),N=i(16172),j=i(24380),B=i(48048),W=i.n(B);class G{static factory(){return G.streamMd5||(G.streamMd5=new G),G.streamMd5}constructor(){this._initAwaitLock=new j.G,this.sliceSize=5*Math.pow(2,20),this._sdk=new(W())({entry:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/stream-md5/streaming_md5.js",wasm:"https://lf16-web-buz.capcut.com/obj/capcut-web-buz-us/stream-md5/streaming_md5.wasm"}),this._sdk.init().then((e=>{this.handler=e,this._initAwaitLock.initDone()}))}getFileMd5(e){return new Promise((async(t,i)=>{await this._initAwaitLock.awaitForInit();let a=0;const r=new FileReader;let s=!0;await this.handler.start();const o=()=>{const t=a*this.sliceSize;let i=t+this.sliceSize;i+this.sliceSize>=e.size&&(s=!1,i=e.size),r.readAsArrayBuffer(e.slice(t,i))};r.onload=async e=>{const r=e.target.result;if(await this.handler.update(r),a++,s)o();else{let e;try{e=await this.handler.end()}catch(n){i(e)}t(e)}},r.onerror=e=>{i(e)},o()}))}}class z{constructor({data:e,...t}){this._allowSyncLocker=new O.G,this.options=t,this.observableData=(0,C.LO)(e),"success"===e.status&&(this._resultWaiter=new x,this._resultWaiter.resolve()),"waiting"===e.status&&(this._calcFileMd5(),this.retryUpload()),"transcoding"===e.status&&this._listenTranscodeResult()}get id(){return this.observableData.id}get everCloudId(){return this.observableData.everCloudId}get isSuccess(){return"success"===this.observableData.status}get toJS(){return(0,C.ZN)(this.observableData)}async onDone(){return await this._resultWaiter.done,{result:this.toJS,errInfo:this._errInfo}}dispose(){var e;this._resultWaiter.dispose(),null===(e=this._uploadRequest)||void 0===e||e.destroy()}canRetryUpload(){var e;return Boolean(null===(e=this.options.upload)||void 0===e?void 0:e.file)}retryUpload(){var e;if(null!==(e=this._resultWaiter)&&void 0!==e&&e.isLocked)return;this.resetWaiter();const{evercloudInstance:t,upload:i}=this.options;(0,u.Y2)(null==i?void 0:i.file,"not allow to upload file without upload params"),(0,C.z)((()=>{this.observableData.status="waiting",this.observableData.progress=0})),t.uploadAssetNoLogin({file:i.file,skipDuplicate:!0,fileType:null!=i&&i.isSilence?"file":void 0}).then((e=>{this._uploadRequest=e,e.onIdle=()=>{(0,C.z)((()=>{var e;this.observableData.status="uploading",null===(e=i.onProgress)||void 0===e||e.call(i,0)}))},e.onProgress=e=>{var t;const a=e.done/e.total*100*A;(0,C.z)((()=>{this.observableData.status="uploading",this.observableData.progress=a})),null===(t=i.onProgress)||void 0===t||t.call(i,a)},e.onFinish=e=>{var t,a;(this._uploadRequest=void 0,"success"===e.status)&&((0,C.z)((()=>{this.observableData.platformId=e.fileId,this.observableData.status="transcoding",this.observableData.progress=70})),null==i||null===(t=i.onProgress)||void 0===t||t.call(i,70),this._listenTranscodeResult());"error"===e.status&&((0,C.z)((()=>{this.observableData.status="failure"})),this._errInfo=e.errInfo,null===(a=this._resultWaiter)||void 0===a||a.resolve())}}))}retryTranscode(){(0,u.Y2)("\u6682\u65f6\u4e0d\u652f\u6301\u89e6\u53d1\u91cd\u65b0\u8f6c\u7801")}cancelUpload(){var e;null===(e=this._uploadRequest)||void 0===e||e.cancel()}delete(){return this.dispose(),Promise.resolve()}canSync(){return"un-login"===this.observableData.mode&&"failure"!==this.observableData.status}async sync(){await this._allowSyncLocker.awaitForInit(),(0,C.z)((()=>{this.observableData.status="syncing"}));try{var e;const t=await this.options.evercloudInstance.syncVideoToEverCloud(this.observableData.vid,{fileSize:null!==(e=this.observableData.size)&&void 0!==e?e:0,resouceType:this.groupTypeToSyncResourceType(this.observableData.type)}),i=await t.done();if(i.errInfo)U.Z.warning(o.ZP.t("{placeholder0}_synchronization_failed",{placeholder0:this.observableData.name},"Couldn\u2019t sync {placeholder0}")),(0,C.z)((()=>{this.observableData.status="failure"}));else{const{assetId:e}=i.data,t=await this.options.evercloudInstance.getAssetByFileId(e);(0,C.z)((()=>{const{id:e,...i}=D(t);Object.assign(this.observableData,i)}))}}catch(s){let e=-1;try{e=JSON.parse(s).code}catch(n){}var t,i,a,r;if((0,C.z)((()=>{this.observableData.status="sync-failure"})),e===R)null===(t=this.options.upload)||void 0===t||null===(i=t.showSyncFileErrorModal)||void 0===i||i.call(t,"expand");else null===(a=this.options.upload)||void 0===a||null===(r=a.showSyncFileErrorModal)||void 0===r||r.call(a,"error"),U.Z.warning(o.ZP.t("{placeholder0}_synchronization_failed",{placeholder0:this.observableData.name},"Couldn\u2019t sync {placeholder0}"));throw s}}async _listenTranscodeResult(){const{evercloudInstance:e}=this.options;(0,u.Y2)(this.observableData.platformId,"not has platformId could not query");const t=await(await e.getVideoAssetTranscodeStatusNoSign(this.observableData.platformId)).done();if(t.data){const{image:e}=t.data,i=await Promise.all([this._formatTranscodeInfo(await(0,N.S)(this.options.upload.file),"origin"),this._formatTranscodeInfo(e.image_360p_url),this._formatTranscodeInfo(e.image_720p_url),this._formatTranscodeInfo(e.image_1080p_url)]);this.options.upload.file=void 0,(0,C.z)((()=>{Object.assign(this.observableData,{status:"success",vid:e.source,cover:e.image_360p_url,url:e.origin,width:i[0].origin.width,height:i[0].origin.height,transcodeInfo:i.reduce(((e,t)=>e={...e,...t}),{})})})),this._allowSyncLocker.initDone()}else if(t.errInfo){var i;(0,C.z)((()=>{this.observableData.status="failure"})),this._errInfo={code:t.errInfo.code,message:t.errInfo.msg},null===(i=this._resultWaiter)||void 0===i||i.resolve()}}async _calcFileMd5(){const e=G.factory(),t=await e.getFileMd5(this.options.upload.file);(0,C.z)((()=>{this.observableData.md5=t}))}async _formatTranscodeInfo(e,t){const i=await(a=e,new Promise(((e,t)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){e({width:i.width,height:i.height})},i.onerror=function(){t(new Error("could not load img"))},i.src=a})));var a;return{[null!=t?t:`${i.width}x${i.height}`]:{full_url:e,width:i.width,height:i.height}}}groupTypeToSyncResourceType(e){switch(e){case"video":default:return 1;case"audio":return 2;case"image":return 3}}resetWaiter(){this._errInfo=void 0,this._resultWaiter=new x}}function K(e){return new Promise((t=>{const i=new FileReader;i.onload=e=>{t(e.target.result)},i.readAsDataURL(e)}))}function H(e){return["image/jpeg","image/jpg","image/png","image/svg+xml","image/bmp","image/webp","image/x-icon"].includes(e.type)}async function Z(e,t){return{mode:t,id:`fakeId::${e.name}:${Math.round(1e3*Math.random())}`,name:e.name,everCloudId:void 0,type:(0,s.Gt)(e.type),cover:"",uploadBlobCover:H(e)?await K(e):"",status:"waiting",progress:0,url:"",md5:"",size:e.size,sourcePath:`${e.name}`}}var Y=i(70126);const V="list-NoIO6A",$="divider-zyUaSD",q="item-Vs6V8R";var J=i(92356),X=i(80887),Q=i(47612),ee=i(18571),te=i(92202),ie=i(5789),ae=i.n(ie),re=i(25062),se=i(58895),oe=i(41790);const ne="modalArea-GiTRrg",ce="modalContent-hu2jFJ",le="dropdownArea-akRlHs",de="dropdownContent-bUd6qY",ue="dropdownContentText-GklwTs",he="coverContent-NoSDw6",pe="materialCard-cZZQqn",ge="cardCover-pGOE7z",_e="cardImage-GQv2S4",fe="cardCover-active-Iyoz4I",ve="cardBottom-MTmnQF",me="cardTitle-XofugU",ye="hasNotLogin-pGOSpi",Ie="hasNotLoginIcon-RYfLfZ",we="hasNotLoginTitle-DML9F3",Se="hasNotLoginText-GlgRzI",be="hasNotLoginBtn-JPPoJE",Ce="emptySpace-mgX9uK",Ee="emptyText-g44I6w",ke="modalFooter-yQDsJw",Te="footerButton-wYoQzC",Pe="footerButtonDisable-L8zmWz",De="dropdownMenu-eRkVi9",xe="menuItem-DXTSXe";var Ae=i(14906),Re=i(92822),Fe=i(44001);const Me=e=>{const{fileMaterial:t,onMaterialCardClick:i}=e;if(!t)return null;return(0,w.jsxs)("div",{className:pe,onClick:()=>{i(t)},children:[(0,w.jsx)("div",{className:ae()(ge,{[fe]:t.selected}),children:(0,w.jsx)("img",{src:null==t?void 0:t.decodeCoverUrl,alt:"",className:_e})}),(0,w.jsxs)("div",{className:ve,children:[(0,w.jsx)("div",{className:me,children:null==t?void 0:t.name}),(0,w.jsx)(re.Z,{checked:t.selected,style:{display:"none"}})]})]},t.id)},Le=e=>{const{initWorkspaceId:t,hasLogin:i,workspaceList:a,getCurrentSpaceMaterials:s,switchCurrentWorkspace:n,onSignInPopup:c,updateObservableData:l,synchronizeMaterialToProject:d,callback:u,copyFileToDraftWorkspace:h,multi:p=!1,maxCount:g,smartToolPageImportReport:_}=e,[f,v]=(0,ee.useState)(!0),[m,S]=(0,ee.useState)(),[b,C]=(0,ee.useState)(),E=(0,ee.useRef)(new Map),[k,T]=(0,ee.useState)(!0),P=e=>{var t;if(null===(t=E.current)||void 0===t?void 0:t.get(e.id))if(p){var i;if(g&&b&&(null==b||null===(i=b.filter((e=>e.selected)))||void 0===i?void 0:i.length)>=g)return void U.Z.error({content:o.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:Fe.fJ},"You can edit up to {number0} pages at the same time"),duration:2e3});const t=E.current.entries();for(const i of t){const[t,a]=i;t===e.id&&E.current.set(t,{file:e,selected:!a.selected})}C((e=>null==e?void 0:e.map((e=>{var t,i;return e.selected=null!==(t=null===(i=E.current.get(e.id))||void 0===i?void 0:i.selected)&&void 0!==t&&t,e}))))}else{const t=E.current.entries();for(const i of t){const[t,a]=i;t===e.id?E.current.set(t,{file:e,selected:!0}):E.current.set(t,{file:e,selected:!1})}C((t=>null==t?void 0:t.map((t=>(t.selected=t.id===e.id,t)))))}E.current.forEach(((e,t)=>{e.selected&&T(!1)}))},D=(0,w.jsx)(se.Z,{className:De,children:null==a?void 0:a.map(((e,t)=>(0,w.jsx)(se.Z.Item,{className:xe,onClick:()=>(async e=>{const t=null==a?void 0:a.find((t=>t.workspace_id===e));T(!0),E.current=new Map,t&&S(t),await n(e);const i=await s();if(i){const e=[];await Promise.all(i.map((async t=>{const i=await je(t);if(i){const t=Object.assign(i,{selected:!1});e.push(t),E.current.set(i.id,{file:i,selected:!1})}}))),C(e)}})(e.workspace_id),children:e.name},t.toString())))});(0,ee.useEffect)((()=>{if((async()=>{t&&await n(t);const e=await s();e&&e.map((async e=>{const t=await je(e);var i;t&&(C((e=>{const i=Object.assign(t,{selected:!1});return e?[...e,i]:[i]})),null===(i=E.current)||void 0===i||i.set(e.id,{file:t,selected:!1}))}))})(),a&&t){const e=a.find((e=>e.workspace_id===t));e&&S(e)}}),[]);const x=e=>(0,w.jsx)("strong",{children:e},e),A=()=>{c(),v(!1)},R=()=>i?(0,w.jsxs)("div",{className:ce,children:[(0,w.jsx)("div",{className:le,children:(0,w.jsx)(oe.Z,{droplist:D,position:"bl",trigger:"click",getPopupContainer:()=>document.body,children:(0,w.jsxs)("div",{className:de,children:[(0,w.jsx)("div",{className:ue,children:null==m?void 0:m.name}),(0,w.jsx)(Ae.DDv,{size:16})]})})}),0===(null==b?void 0:b.length)?(0,w.jsxs)("div",{className:Ce,children:[(0,w.jsx)(Ae.NRP,{size:100}),(0,w.jsx)("div",{className:Ee,children:o.ZP.t("web_graphic_materials_empty",{},"There's nothing here yet.")})]}):(0,w.jsx)("div",{className:he,children:null==b?void 0:b.map((e=>(0,w.jsx)(Me,{onMaterialCardClick:P,fileMaterial:e},e.id)))})]}):(0,w.jsxs)("div",{className:ye,children:[(0,w.jsx)("div",{className:Ie,children:(0,w.jsx)(Ae.ZrO,{size:60})}),(0,w.jsx)("div",{className:we,children:o.ZP.t("log_web_cloud_web_project",{},"Log in to sync Cloud projects")}),(0,w.jsx)("div",{className:Se,children:o.ZP.t("log_web_in_web_agree_web_pp",{strong:x,"user-agreement":Re.j3,"privacy-policy":Re.pu},"By clicking Log in, you agree to the Terms and Conditions and Privacy Policy. Read it carefully.")}),(0,w.jsx)("div",{className:be,onClick:A,children:o.ZP.t("web_log_in_to_save",{},"Sign in")})]});return(0,ee.useEffect)((()=>{R()}),[i]),(0,w.jsx)(y.Z,{title:o.ZP.t("web_space_modal_title",{},"Select the footage you want to use"),visible:f,autoFocus:!1,focusLock:!0,onCancel:()=>v(!1),footer:(0,w.jsx)("div",{className:ke,children:(0,w.jsx)(I.Z,{className:ae()(Te,{[Pe]:k}),onClick:async()=>{var e;null==_||_("my_space");const t=[];null===(e=E.current)||void 0===e||e.forEach((e=>{e.selected&&(t.push(e.file),l(e.file))}));const i={type:r.sy.MYSPACE,data:t[0]};t[0].workspaceId=null==m?void 0:m.workspace_id,u(i),v(!1),await h(t[0]),await d(t[0].md5)},disabled:k,children:o.ZP.t("web_space_modal_continue",{},"Continue")})}),className:ne,unmountOnExit:!0,children:R()})};var Oe,Ue=i(27385),Ne=i(55971);!function(e){e.MATERIAL_LIB="material_lib",e.MATERIAL="material",e.CANVAS="canvas"}(Oe||(Oe={}));const je=async e=>{if(e.coverKey)for(const[i,a]of Object.entries(e))if("cover"===i&&a)try{const t=await(0,te.V)({url:e.cover,key:e.coverKey}),i=new Blob([t.buffer]),a=URL.createObjectURL(i);e.decodeCoverUrl=a}catch(t){return void T.t.error("decode error",t)}return e},Be=Object.values(r.ob),We=Object.values(r.sy),Ge=e=>{const{className:t,reportParams:i,initWorkspaceId:a,workspaceList:s,hasLogin:n,childRef:c,uploadMaterialInProject:l,callback:d,showThirdpartyUploadModal:u,getCurrentSpaceMaterials:p,switchCurrentWorkspace:g,renderLoginUserPopup:_,updateObservableData:f,synchronizeMaterialToProject:v,onHide:m,importMaterialReport:y,copyFileToDraftWorkspace:S,multi:b=!1,maxCount:C,smartToolPageReport:E,smartToolPageImportReport:k,style:T,forceVisible:P,dropdownDom:D}=e,[x,A]=(0,ee.useState)(!0),{height:R,top:F,left:M}=null==c?void 0:c.getBoundingClientRect(),L=(0,ee.useRef)(0),O=()=>{P&&(null==D||D.unmount())};(0,ee.useEffect)((()=>{window.innerHeight-F<300?L.current=F-180:L.current=F+R+4}),[]);const N=()=>_(),j={...i,onUploadSuccess:(e,t)=>{(0,Ue.D_)(null==i?void 0:i.toolType,e,t)},smartToolPageImportReport:k},B=(e,t)=>{if(Be.includes(e)){if(!t)return void _();null==E||E(e===r.ob.DROPBOX?Ne.td.DROPBOX:Ne.td.GOOGLE_DRIVE),u(e,j)}else e===r.sy.MYSPACE&&(null==E||E(Ne.td.MY_SPACE),(e=>{const t="my-space-modal";let i=document.getElementById(t);i||(i=document.createElement("div"),i.id=t,i.style.position="absolute",document.body.append(i)),Y.createRoot(i).render((0,w.jsx)(Le,{...e}))})({initWorkspaceId:a,workspaceList:s,hasLogin:n,updateObservableData:f,onSignInPopup:N,getCurrentSpaceMaterials:p,switchCurrentWorkspace:g,callback:({data:e})=>{},synchronizeMaterialToProject:v,copyFileToDraftWorkspace:S,multi:b,maxCount:C,smartToolPageImportReport:k}));A(!1),null==m||m(),O()},W=async()=>{await p()},G=async e=>{A(!1),null==m||m(),O();try{const t=await l({file:e,onDone:W,meta:{position:Oe.MATERIAL,...j}}),i=await je(t.result);if(i){const e={type:r.sy.MY_DEVICE,data:i};d(e)}}catch(t){U.Z.error(t.message||o.ZP.t("file_upload_failed",{},"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"))}},z={[r.ob.DROPBOX]:{icon:(0,w.jsx)(Ae.bWW,{size:20},r.ob.DROPBOX),name:o.ZP.t("web_component_text_upload_from_dropbox",{},"Dropbox")},[r.ob.GOOGLE_DRIVE]:{icon:(0,w.jsx)(Ae.nmA,{size:20},r.ob.GOOGLE_DRIVE),name:o.ZP.t("web_component_text_upload_google_drive",{},"Google Drive")},[r.sy.MYSPACE]:{icon:(0,w.jsx)(Ae.PW_,{size:20},r.sy.MYSPACE),name:o.ZP.t("web_component_text_upload_from_space",{},"My Space")},[r.sy.MY_DEVICE]:{icon:(0,w.jsx)(Ae.POA,{size:20},r.sy.MY_DEVICE),name:o.ZP.t("web_component_text_upload_from_device",{},"My Device")}};return(0,w.jsx)(Q.Z,{popupVisible:null!=P?P:x,popup:()=>(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)("div",{className:ae()(V,t),style:{top:L.current,left:M,...T},children:[We.map(((e,t)=>e===r.sy.MY_DEVICE?(0,w.jsx)(J.Z,{multiple:b,showUploadList:!1,autoUpload:!1,onChange:(e,t)=>{null==k||k("my_device"),t.originFile&&G(t.originFile)},accept:h.image.accept,style:{width:"100%"},limit:{maxCount:b?null!=C?C:1e3:1},onExceedLimit:e=>{U.Z.error(o.ZP.t("web_smart_tools_text_pictures_exceeded",{number0:Fe.fJ},"You can edit up to {number0} pages at the same time")),e.splice(0,C).forEach((e=>G(e)))},children:(0,w.jsx)(I.Z,{className:q,icon:z[e].icon,onClick:()=>{null==E||E(Ne.td.SELECT_MATERIAL),A(!1)},children:z[e].name})},z[e].name):(0,w.jsx)(I.Z,{className:q,icon:z[e].icon,onClick:()=>B(e,n),children:z[e].name},t))),(0,w.jsx)(X.Z,{className:$}),Be.map(((e,t)=>(0,w.jsx)(I.Z,{className:q,icon:z[e].icon,onClick:()=>B(e,n),children:z[e].name},t)))]})}),getPopupContainer:()=>document.body,trigger:"click",popupAlign:{top:100},clickOutsideToClose:!0,unmountOnExit:!1,onClickOutside:()=>{A(!1),!P&&(null==m||m())},children:(0,w.jsx)("div",{style:{display:"none"}})})};class ze{async init(e){this._innerInstance||(this._innerInstance=await this.createSpaceInstance(e))}async switchSpace(e){this._innerInstance&&s.m7.destroySdk(this._innerInstance.spaceId),this._innerInstance=await this.createSpaceInstance(e)}async createSpaceInstance(e){const{id:t,dcName:i,host:a,media:r}=e;return await s.m7.getSdkInstance({spaceId:t,dcName:i,netconf:{base:a,media:r}})}async fetchAllSpaceFiles(){if(!this._innerInstance)return[];return(await this._innerInstance.getAssets({})).filter((e=>"image"===e.type&&"image/gif"!==e.mime&&""!==e.name)).sort(((e,t)=>t.updatedAt-e.updatedAt)).map((e=>D(e))).filter((e=>"success"===e.status))}async copyFileToOtherSpace(e,t){if(!this._innerInstance)return!1;if(this._innerInstance.spaceId===t.id)return!0;const{id:i,md5:a,meta:r}=e,s=await this.createSpaceInstance(t);if(!s)return!1;try{if(await s.getAssetByMd5(a))return!0}catch(n){}const o=await s.copyFromSpace({fromSpace:this._innerInstance.spaceId,fromIdc:this._innerInstance.idc,resourceId:i,resourceType:0,meta:null!=r?r:{}});try{return await o.done(),!0}catch(n){T.t.error("copy file to other space error",e,t)}return!1}async deleteFile(e){var t;return await(null===(t=this._innerInstance)||void 0===t?void 0:t.deleteAsset({ids:[e]})),!0}}var Ke,He,Ze,Ye,Ve,$e=i(26690),qe=i(11042),Je=i(47006),Xe=i(31067),Qe=i(24149),et=i(51825),tt=i(4547),it=i(74532),at=function(e,t,i,a){var r,s=arguments.length,o=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var n=e.length-1;n>=0;n--)(r=e[n])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o},rt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},st=function(e,t){return function(i,a){t(i,a,e)}};let ot=class extends g.JT{constructor(e,t,i,a,r){if(super(),this.accountService=e,this.workspaceService=t,this.draftManagerService=i,this.userMaterialsService=a,this.projectMaterialService=r,this.observableData=(0,C.LO)({allEverFileInfos:[]}),this.generalShowUserSpaceInsufficient=S,this._onMaterialChange=this._store.add(new _.Q),this.onMaterialChange=this._onMaterialChange.event,this._requestSpaceStorageLocker=new M,this._changeCallbacks=[],this._syncPackageDone=!1,this._spaceResetStorage=void 0,this._draftId=i.draftId,this._draftEvercloudInstance=this.userMaterialsService.getBaseEvercloud(),this.isSigned=e.hasLogin,this.isSigned)this._draftWorkspaceId=this.draftManagerService.workspaceId,this.initSpaceInstance(),this._initEvercloudServiceByLogin(),this.projectMaterialService.listenExpandInstance(this.draftManagerService.workspaceId||this.workspaceService.workspaceList[0].workspace_id,(e=>{this._expandInstance=e}));else{const e=this.draftManagerService.onStateChange((t=>{t.isAvailable&&(e.dispose(),this._draftWorkspaceId=i.workspaceId,this.currentWorkSpaceId=i.workspaceId,this.initSpaceInstance(),this.isSigned=!0,this._initEvercloudServiceByLogin(),this._syncAllAssetToPackage())}));this._noSignEverCloudInitPromise=this._initEvercloudServiceByUnLogin()}this._autoNotify()}async showThirdpartyUploadModal(e,t){this.isSigned&&(await this._initEverCloudSdk(),null!=t&&t.toolType&&this.thirdpartyUploadHelper.setToolType(null==t?void 0:t.toolType),this.thirdpartyUploadHelper.show(e,t))}registerThirdpartyUploadStatesCallback(e){this.thirdpartyUploadHelper.registerOnUploadListener(e)}destroyExpandModal(){this._expandModal=void 0}showUserSpaceInsufficient(){this._expandModal||S(this._retryAllUploadFailFiles.bind(this),this._expandInstance,this.destroyExpandModal.bind(this)).then((e=>this._expandModal=e))}get materials(){return this.observableData.allEverFileInfos.map((e=>e.toJS))}initUploadComponent(e,t,i={}){this.batchMaterialType=null==i?void 0:i.batchMaterialType,(i.multi||i.maxCount)&&this._initThirdpartyHelper({multi:i.multi,maxCount:i.maxCount,currentPage:i.currentPage,toolType:i.toolType});const a=(e=>{const t="upload-dropdown-container";let i=document.getElementById(t);i||(i=document.createElement("div"),i.id=t,i.style.position="absolute",document.body.append(i));const a=Y.createRoot(i);return a.render((0,w.jsx)(Ge,{...e,dropdownDom:a})),a})({...i,childRef:e,initWorkspaceId:this._draftWorkspaceId,workspaceList:this.isSigned?this.workspaceService.workspaceList:[],hasLogin:this.isSigned,showThirdpartyUploadModal:this.showThirdpartyUploadModal.bind(this),uploadMaterialInProject:this.uploadMaterialInProject.bind(this),getCurrentSpaceMaterials:this.getCurrentSpaceMaterials.bind(this),switchCurrentWorkspace:this.switchCurrentWorkspace.bind(this),renderLoginUserPopup:this.renderLoginUserPopup.bind(this),updateObservableData:this.updateObservableData.bind(this),synchronizeMaterialToProject:this.synchronizeMaterialToProject.bind(this),copyFileToDraftWorkspace:this.copyFileToDraftWorkspace.bind(this),importMaterialReport:this._importMaterialReport.bind(this),callback:t});return this.isSigned&&this.registerThirdpartyUploadStatesCallback(t),a}updateObservableData(e){var t;e.workspaceId=null!==(t=e.workspaceId)&&void 0!==t?t:this._draftWorkspaceId,e.meta={...e.meta,batchMaterialType:this.batchMaterialType};const i={id:e.id,observableData:e,everCloudId:e.everCloudId,toJS:e,onDone:()=>Promise.resolve({result:e}),canRetryUpload:()=>!1,retryUpload:()=>{},retryTranscode:()=>{},cancelUpload:()=>{},canSync:()=>{},sync:()=>Promise.resolve(),delete:()=>Promise.resolve(),dispose:()=>{}};this.observableData.allEverFileInfos=[i,...this.observableData.allEverFileInfos],this._notifyChange()}async uploadFileToProject(e){await(this.accountService.hasLogin?this._everCloudInitPromise:this._noSignEverCloudInitPromise);const{file:t,isSilence:i=!1,onProgress:a}=e;if(!(0,s.J5)({file:t,accepts:["image"]})&&!i)throw new Error(o.ZP.t("file_types_not_supported_by_{placeholder0}",{placeholder0:t.name},"{placeholder0} is not supported"));let r;return r=this.accountService.hasLogin?new L({evercloudInstance:this._draftEvercloudInstance,upload:{file:t,isSilence:i,onProgress:a,onStartToUpload:()=>{this._spaceResetStorage&&(this._spaceResetStorage.space-=t.size)},onUploadSuccess:e=>{this.checkFileUniqueWhenUploadSuccess(e)},checkAndUpdateUserSpace:async e=>await this._getResetSpaceStorage()<e,showUserSpaceInsufficient:this.showUserSpaceInsufficient.bind(this)},data:await Z(t,"login"),batchMaterialType:this.batchMaterialType}):new z({evercloudInstance:this._draftEvercloudInstance,upload:{file:t,isSilence:i,onProgress:a,showSyncFileErrorModal:this._showSyncFailureModal.bind(this)},data:await Z(t,"un-login")}),r.observableData.workspaceId=this._draftWorkspaceId,i||(this.observableData.allEverFileInfos=[r,...this.observableData.allEverFileInfos],this._notifyChange()),r.onDone()}async initSpaceInstance(){const e=this.workspaceService.workspaceList.find((e=>e.workspace_id===this._draftWorkspaceId));return!!e&&(this._currentSpaceInstance=new ze,await this._currentSpaceInstance.init({id:e.space_id,dcName:e.space_idc,host:e.space_host,media:e.space_res_host}),!0)}async _syncAllAssetToPackage(){try{await this._everCloudInitPromise;const e=this.observableData.allEverFileInfos.filter((e=>"un-login"===e.observableData.mode&&e.canSync()));await Promise.all(e.map((e=>e.sync()))),this.draftManagerService.bootstrap()}catch(e){throw e}}retryUpload(e){const t=this.observableData.allEverFileInfos.find((t=>t.id===e));(0,u.Y2)(t,"material not found, could not retry. check logic"),(0,u.Y2)(null==t?void 0:t.canRetryUpload(),"material can not retry"),null==t||t.retryUpload()}canRetryUploadById(e){var t,i;return null!==(t=null===(i=this.observableData.allEverFileInfos.find((t=>t.id===e)))||void 0===i?void 0:i.canRetryUpload())&&void 0!==t&&t}reset(){this.observableData.allEverFileInfos.map((e=>e.dispose())),this.observableData.allEverFileInfos=[]}deleteMaterial(e){const t=this.observableData.allEverFileInfos.find((t=>t.id===e));return(0,u.Y2)(t,"not found target"),t.dispose(),this.observableData.allEverFileInfos=this.observableData.allEverFileInfos.filter((t=>t.id!==e)),Promise.resolve()}cancelUpload(e,t){const i=this.observableData.allEverFileInfos.find((t=>t.id===e));(0,u.Y2)(i,"file not existed"),i.cancelUpload(),this.observableData.allEverFileInfos=this.observableData.allEverFileInfos.filter((t=>t.id!==e)),this._importMaterialReport({...t,material:i.toJS,status:tt.Kp.CANCEL})}async switchCurrentWorkspace(e){var t;const i=this.workspaceService.workspaceList.find((t=>t.workspace_id===e));i&&(this.currentWorkSpaceId=i.workspace_id,await(null===(t=this._currentSpaceInstance)||void 0===t?void 0:t.switchSpace({id:i.space_id,dcName:i.space_idc,host:i.space_host,media:i.space_res_host})),this._everCloudInitPromise=await this._draftEvercloudInstance.changeSpace({spaceId:i.space_id,dcName:i.space_idc,netconf:{base:i.space_host,media:i.space_res_host}}))}async getCurrentSpaceMaterials(){var e;const t=await(null===(e=this._currentSpaceInstance)||void 0===e?void 0:e.fetchAllSpaceFiles());return null==t?void 0:t.map((e=>(e.workspaceId=this.currentWorkSpaceId,e)))}waitForUnLoginSync(){return Promise.resolve()}renderLoginUserPopup(e){this.accountService.login({execAfterLogin:async()=>{var t;await this.waitForUnLoginSync(),null==e||null===(t=e.execAfterLogin)||void 0===t||t.call(e)},reportParams:Object.assign({},{currentPage:"picture_edit"},null==e?void 0:e.reportParams)})}uploadMaterialInProject({file:e,isSilence:t=!1,onProgress:i,onDone:a,meta:r}){const s=Date.now();return this.uploadFileToProject({file:e,onProgress:i,isSilence:t}).then((async e=>{var t,i;(null==a||a(e.result,e.errInfo),this.materials.map((e=>e.id)).includes(e.result.id))&&(this._importMaterialReport({...r,material:e.result,uploadStartTime:s,...e.errInfo?{status:tt.Kp.FAIL,failReason:e.errInfo.message}:void 0}),null==r||null===(t=r.onUploadSuccess)||void 0===t||t.call(r,null===(i=e.result)||void 0===i?void 0:i.id,Date.now()-s),await this.synchronizeMaterialToProject(e.result.md5));return e}))}async synchronizeMaterialToProject(e){if(this.isSigned)try{await this._everCloudInitPromise;const t=await this._draftEvercloudInstance.getAssetByMd5(e);this.projectMaterialService.addEverCloudFile(t)}catch(t){T.t.error("synchronizeMaterial error",t)}}async _initEverCloudSdk(){if(this._everCloudInitPromise)return this._everCloudInitPromise;const e=this.workspaceService.getWorkspace(this.draftManagerService.workspaceId);await new Promise((e=>{this.userMaterialsService.isReady?e():(0,f.V)(this.userMaterialsService.onReady)((()=>{e()}))})),this._everCloudInitPromise=await this._draftEvercloudInstance.changeSpace({spaceId:e.space_id,dcName:e.space_idc,netconf:{base:e.space_host,media:e.space_res_host}})}_retryAllUploadFailFiles(){this._spaceResetStorage=void 0;const e=this.observableData.allEverFileInfos.filter((e=>e.canRetryUpload()));for(const t of e)t.retryUpload()}_initThirdpartyHelper(e){(0,u.Y2)(this.accountService.hasLogin,"user is not sign"),this.thirdpartyUploadHelper=new p({workspaceId:this._draftWorkspaceId,reqDomain:this.accountService.userProfile.reqDomain,draftId:this._draftId,showUserSpaceInsufficient:this.showUserSpaceInsufficient.bind(this),multi:null==e?void 0:e.multi,maxCount:null==e?void 0:e.maxCount,currentPage:null==e?void 0:e.currentPage,toolType:null==e?void 0:e.toolType}),this.projectMaterialService.listenExpandInstance(this.draftManagerService.workspaceId||this.workspaceService.workspaceList[0].workspace_id,(e=>{this.thirdpartyUploadHelper.setThirdpartyStorageExpandModalInstance(e)})),this.thirdpartyUploadHelper.registerOnUploadListener((({type:e,isNewFile:t,data:i},a)=>{t&&(0,C.z)((()=>{const t=Date.now();this.observableData.allEverFileInfos=[new F({thirdpartyUploadHelper:this.thirdpartyUploadHelper,evercloudInstance:this._draftEvercloudInstance,upload:{onUploadSuccess:e=>{this.checkFileUniqueWhenUploadSuccess(e)},onTranscodeSuccess:i=>{var s;this.thirdpartyUploadHelper.broadcastFileStatus({type:e,data:i}),this._importMaterialReport({...a,material:i,uploadStartTime:t,materialSource:e===r.ob.GOOGLE_DRIVE?tt.wf.GOOGLE_DRIVE:tt.wf.DROPBOX}),null==a||null===(s=a.onUploadSuccess)||void 0===s||s.call(a,null==i?void 0:i.id,Date.now()-t)}},data:i,batchMaterialType:this.batchMaterialType}),...this.observableData.allEverFileInfos.filter((e=>e.id!==i.id))]}))}))}_initEvercloudServiceByLogin(){this._everCloudInitPromise=this._initEverCloudSdk(),this._initThirdpartyHelper()}checkFileUniqueWhenUploadSuccess(e){(0,C.z)((()=>{const{allEverFileInfos:t}=this.observableData;if(t.reduce(((t,i,a)=>(i.everCloudId===e.everCloudId&&t.push(a),t)),[]).length>1){const i=t.find((t=>t.id===e.id)),a=t.filter((t=>t.id!==e.id));this.observableData.allEverFileInfos=i?[i,...a]:a}}))}async _initEvercloudServiceByUnLogin(){await new Promise((e=>{this.userMaterialsService.isReady?e():this.userMaterialsService.onReady((()=>{e()}))})),await this._draftEvercloudInstance.noSignInit()}async _getResetSpaceStorage(){if(await this._requestSpaceStorageLocker.acquire(),this._spaceResetStorage&&Date.now()-this._spaceResetStorage.updateTime<=6e4)return this._requestSpaceStorageLocker.release(),this._spaceResetStorage.space;const e=await this._draftEvercloudInstance.resetSpaceStorage(this._draftWorkspaceId);return this._spaceResetStorage={space:e,updateTime:Date.now()},this._requestSpaceStorageLocker.release(),this._spaceResetStorage.space}_notifyChange(){for(const e of this._changeCallbacks)e(this.observableData.allEverFileInfos.map((e=>e.toJS)));this._onMaterialChange.fire(this.materials)}_autoNotify(){let e=[];(0,C.N7)(this.observableData,(t=>{e.forEach((e=>e())),"allEverFileInfos"===t.name&&(e=t.newValue.map((e=>(0,C.N7)(e.observableData,(()=>{this._notifyChange()}))))),this._notifyChange()}))}_showSyncFailureModal(e){this._syncPackageDone&&"expand"===e&&this.showUserSpaceInsufficient()}async copyFileToDraftWorkspace(e){const t=()=>{it.Z.error(o.ZP.t("web_graphic_actions_failure_tips",{},"Operaction failure, please try again later."))};if(this.projectMaterialService.materials.find((t=>t.md5===e.md5)))return(0,v.ly)();if(this.draftManagerService.workspaceId){const a=this.workspaceService.workspaceList.find((e=>e.workspace_id===this.draftManagerService.workspaceId));(0,u.Y2)(a&&this._currentSpaceInstance,"not found target space");const r={id:a.space_id,dcName:a.space_idc,host:a.space_host,media:a.space_res_host};try{if(!await this._currentSpaceInstance.copyFileToOtherSpace({id:e.everCloudId,md5:e.md5},r))return t(),(0,v.wf)(-1,"copy file from failure from server")}catch(i){try{if(JSON.parse(i).code===s.tN.INSUFFICIENT_SPACE)return this.projectMaterialService.showUserSpaceInsufficient(),(0,v.wf)(-1,"no space")}catch{}return t(),(0,v.wf)(-1,"server failure")}}return await this.projectMaterialService.copyMaterialFromSpace(e),(0,v.ly)()}_importMaterialReport({materialId:e,uploadStartTime:t,thirdpartyUploadType:i,...a}){if(e&&(a.material=this.materials.find((t=>t.id===e))),t&&(a.importTime=Date.now()-t),i){const e={[r.ob.DROPBOX]:tt.wf.DROPBOX,[r.ob.GOOGLE_DRIVE]:tt.wf.GOOGLE_DRIVE};a.materialSource=e[i]}if(this.isSigned&&this._draftWorkspaceId){const e=this.workspaceService.getWorkspace(this.draftManagerService.workspaceId);new tt.JG({spaceId:this._draftWorkspaceId,spaceType:e.space_type,rawSpaceType:e.raw_space_type,spaceUserCnt:e.member_cnt,...a}).report()}else new tt.JG({...a}).report()}};ot=at([st(0,$e.D),st(1,qe.WL),st(2,Qe.j),st(3,Xe.b),st(4,et.X),rt("design:paramtypes",["function"==typeof(Ke=void 0!==Je.Gw&&Je.Gw)?Ke:Object,"function"==typeof(He=void 0!==qe.WL&&qe.WL)?He:Object,"function"==typeof(Ze=void 0!==Qe.j&&Qe.j)?Ze:Object,"function"==typeof(Ye=void 0!==Xe.b&&Xe.b)?Ye:Object,"function"==typeof(Ve=void 0!==et.X&&et.X)?Ve:Object])],ot)},25222:(e,t,i)=>{i.d(t,{J9:()=>r,MX:()=>c,_d:()=>n,gg:()=>a});var a,r,s,o=i(43825);!function(e){e.Main="main",e.EditorPC="pc",e.EditorWeb="web",e.EditorBatch="batch"}(a||(a={})),function(e){e.Single="single",e.Multi="multi",e.Batch="batch"}(r||(r={})),function(e){e.Small="Small",e.Middle="Middle",e.Large="Large"}(s||(s={}));var n;!function(e){e.headline_1="headline_1",e.headline_2="headline_2",e.headline_3="headline_3"}(n||(n={}));const c=[{classNameSuffix:"headline-title-1",textKey:n.headline_1,text:"",textSize:s.Large,defaultWidth:750,defaultHeight:120.000056,fontSize:24,color:o.SQ,boldWidth:.008},{classNameSuffix:"headline-title-2",textKey:n.headline_2,textSize:s.Middle,text:"",defaultWidth:750,defaultHeight:90.000001,fontSize:18,color:o.SQ,boldWidth:.008},{classNameSuffix:"regular-text",textKey:n.headline_3,textSize:s.Small,text:"",defaultWidth:750,defaultHeight:60.000009999999996,fontSize:12,color:o.SQ,boldWidth:0}]},71713:(e,t,i)=>{var a;i.d(t,{q:()=>a}),function(e){e.image="IMAGE",e.element="ELEMENT"}(a||(a={}))},4271:(e,t,i)=>{var a,r,s;i.d(t,{K1:()=>s,c:()=>a,lp:()=>r}),function(e){e.CAPACITY_INSUFFICIENT="CAPACITY_INSUFFICIENT",e.CAPACITY_INSUFFICIENT_WITH_BUY="CAPACITY_INSUFFICIENT_WITH_BUY",e.CAPACITY_BUY="CAPACITY_BUY",e.UPLOAD_FULL_SPACE_RESOLVE="UPLOAD_FULL_SPACE_RESOLVE",e.VIP_BUY="VIP_BUY",e.MANAGEMENT="MANAGEMENT"}(a||(a={})),function(e){e.SUCCESS="SUCCESS",e.FAIL="FAIL",e.PROCESSING="PROCESSING"}(r||(r={})),function(e){e.UpgradeToPro="upgrade_to_pro",e.profileIconUpgrade="profile_icon_upgrade",e.spaceUpgrade="space_upgrade",e.spaceLimitUpgrade="space_limit_upgrade",e.removeWatermarkUpgrade="remove_watermark_upgrade",e.allowDownloadUpgrade="allow_download_upgrade",e.editUpgradeToUnlock="edit_upgrade_to_unlock",e.exportUpgradeToPro="export_upgrade_to_pro"}(s||(s={}))},61135:(e,t,i)=>{i.d(t,{p:()=>a});const a=i(18571).createContext({active:!1,renderByAuto:!1,needReportPanelLoad:!1})},83433:(e,t,i)=>{function a(e,t,i){let{width:a,height:r}=t;const{width:s,height:o}=e;i&&(a-=i.x,r-=i.y);const n=Math.min(a/s,r/o);return{adjustedWidth:s*n,adjustedHeight:o*n}}function r(e){const t=e.getInitialSourceClientOffset(),i=e.getInitialClientOffset();if(!t||!i)return{x:0,y:0};return{x:i.x-t.x,y:i.y-t.y}}function s(e,t){const{x:i,y:a}=r(e);return{x:i/t.containerWidth*t.width,y:a/t.containerHeight*t.height}}i.d(t,{V3:()=>r,c3:()=>s,vh:()=>a})},9586:(e,t,i)=>{function a(){return!1}i.d(t,{r:()=>a})},97326:(e,t,i)=>{i.d(t,{h:()=>r,t:()=>a});const a=async(e,t,a=1)=>{const{default:r}=await Promise.all([i.e(592),i.e(444),i.e(425),i.e(29),i.e(542),i.e(430),i.e(294),i.e(922),i.e(377),i.e(52),i.e(435),i.e(774),i.e(54),i.e(880),i.e(375),i.e(933),i.e(188),i.e(408),i.e(611),i.e(429),i.e(634),i.e(458),i.e(550),i.e(873)]).then(i.bind(i,74858)),s=await r.getFilefromDataUrl(e,t);return r(s,{initialQuality:a,alwaysKeepResolution:!0})},r=async(e,t)=>URL.createObjectURL(await a(e,t))},38720:(e,t,i)=>{i.d(t,{H:()=>r,P:()=>a});const a=(e,t)=>{if(t){const[i,a]=t;return Number((e/i*a).toFixed(2))}return e},r=(e,t)=>{if(t){const[i,a]=t;return Number((e/a*i).toFixed(2))}return e}},5821:(e,t,i)=>{i.d(t,{C3:()=>u,Gu:()=>c,ax:()=>l});var a=i(54643),r=i(25222),s=i(57123),o=i(22169);const n=s.cE.tool,c=e=>{const t=(0,a.Ln)(e).width/1080;return r.MX.map((e=>({...e,fontSize:e.fontSize*t,defaultWidth:e.defaultWidth*t,defaultHeight:e.defaultHeight*t})))},l=e=>{var t,i,a;const r={fontSize:e.size,font:e.font,colorPick:n.color(null===(t=e.fill)||void 0===t?void 0:t.content),bold:e.bold,italic:e.italic,underline:e.underline};return null!==(i=e.shadows)&&void 0!==i&&i.length&&Object.assign(r,{shadow:e.shadows.map((e=>n.shadow(e)))}),null!==(a=e.strokes)&&void 0!==a&&a.length&&Object.assign(r,{outline:e.strokes.map((e=>n.outline(e)))}),r},d=["fontSize","font","colorPick","bold","italic","underline","shadow","outline"],u=e=>{const t={};return null==e||e.styles.forEach(((e,i)=>{const a=l(e);i?d.forEach((e=>{const i=e;void 0!==t[i]&&(["shadow","outline"].includes(i)||(0,o.isEqual)(t[i],a[i])||(t[i]=void 0))})):d.forEach((e=>{var i;Object.assign(t,{[e]:null!==(i=a[e])&&void 0!==i?i:void 0})}))})),t}}}]);